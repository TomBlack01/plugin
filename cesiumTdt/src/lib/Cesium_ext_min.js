"use strict";!function(t){t&&(t.GeoOption={GeoCamera:!0,GeoCameraEventAggregator:!0,GeoScreenSpaceCameraController:!0},t.GEO_VERSION_NUMBER="$ Cesium Version: 1.40 build-20190301 $")}(window.Cesium),function(g){var t=g.DrawCircleWidget=function(t,e){this.viewer=t.viewer,this.color=t.color?t.color:g.Color.RED.withAlpha(.3),this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.ellipsoid=this.scene.globe.ellipsoid,this.mode=t.mode?t.mode:1,this.appearance=new g.PerInstanceColorAppearance,this.callback=e||null};function e(t,e){for(var i=0;i<e.length;i++)e.get(i).name==t&&(e.remove(e.get(i)),i--)}t.prototype.activate=function(){if(!this.handler){this.handler=new g.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var s,l,h=this,c=[];this._array_=c,this._circles_=s=[],this._labels_=l,this.handler.setInputAction(function(t){h.lastP=t;var e=h.scene.pickPosition(t.position);if(!e){var i=h.camera.getPickRay(t.position);e=h.scene.globe.pick(i,h.scene)}if(e){if(g.Cartographic.fromCartesian(e).height<0){i=h.camera.getPickRay(t.position);e=h.scene.globe.pick(i,h.scene)}if(c[0]=e,0<c.length){var r=new g.CircleGeometry({center:e,radius:0,height:0});r.name="draw_circle";var n=new g.GroundPrimitive({geometryInstances:new g.GeometryInstance({geometry:r,attributes:{color:g.ColorGeometryInstanceAttribute.fromColor(h.color)}}),appearance:h.appearance,classificationType:g.ClassificationType.BOTH,interleave:!0});n.name="draw_circle",s.push({geometry:{center:e,radius:0,height:0},primitive:n}),h.primitives.add(n)}}},g.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(t){var e=h.scene.pickPosition(t.endPosition);if(!e){var i=h.camera.getPickRay(t.endPosition);e=h.scene.globe.pick(i,h.scene)}if(!e)return l&&(h.primitives.remove(l),l=null),void(h._labels_=l);if((a=g.Cartographic.fromCartesian(e).height)<0){i=h.camera.getPickRay(t.endPosition);e=h.scene.globe.pick(i,h.scene)}var r=g.Cartographic.fromCartesian(e),n=g.Math.toDegrees(r.longitude),o=g.Math.toDegrees(r.latitude),a=r.height;if(0<c.length){s[0];h.primitives.remove(s[0].primitive),s[0].geometry.radius=g.Cartesian3.distance(s[0].geometry.center,e),3189100<s[0].geometry.radius&&(s[0].geometry.radius=3189100),s[0].primitive=new g.GroundPrimitive({geometryInstances:new g.GeometryInstance({geometry:new g.CircleGeometry({center:s[0].geometry.center.clone(),radius:s[0].geometry.radius,height:s[0].geometry.height}),attributes:{color:g.ColorGeometryInstanceAttribute.fromColor(h.color)}}),appearance:h.appearance,classificationType:g.ClassificationType.BOTH,interleave:!0}),s[0].primitive.name="draw_circle",h.primitives.add(s[0].primitive)}l||((l=h.primitives.add(new g.LabelCollection)).name="draw_label",l.add({text:"左键单击开始绘制，右键单击结束绘制",font:"15px Microsoft YaHei",showBackground:!0})),l.get(l.length-1).position=g.Cartesian3.fromDegrees(n,o,a),h._labels_=l},g.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(t){h.drawEnd(t)},g.ScreenSpaceEventType.RIGHT_CLICK)}},t.prototype.drawEnd=function(t){var e=this._array_,i=this._circles_,r=this._labels_;t=t||this.lastP,this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",r&&(this.primitives.remove(r),r=null);var n=this.scene.pickPosition(t.position);if(!n){var o=this.camera.getPickRay(t.position);n=this.scene.globe.pick(o,this.scene)}if(n){if(g.Cartographic.fromCartesian(n).height<0){o=this.camera.getPickRay(t.position);n=this.scene.globe.pick(o,this.scene)}var a=g.Cartographic.fromCartesian(n);g.Math.toDegrees(a.longitude),g.Math.toDegrees(a.latitude),a.height,this.mode;if(0<e.length&&(this.primitives.remove(i[0].primitive),i[0].geometry.radius=g.Cartesian3.distance(i[0].geometry.center,n),3189100<i[0].geometry.radius&&(i[0].geometry.radius=3189100),i[0].primitive=new g.GroundPrimitive({geometryInstances:new g.GeometryInstance({geometry:new g.CircleGeometry({center:i[0].geometry.center.clone(),radius:i[0].geometry.radius,height:i[0].geometry.height}),attributes:{color:g.ColorGeometryInstanceAttribute.fromColor(this.color)}}),appearance:this.appearance,classificationType:g.ClassificationType.BOTH,interleave:!0}),i[0].primitive.name="draw_circle",this.primitives.add(i[0].primitive),this.callback)){var s=g.CircleGeometry.createGeometry(new g.CircleGeometry({center:i[0].geometry.center.clone(),radius:i[0].geometry.radius,height:i[0].geometry.height})),l=new g.Entity({polygon:{hierarchy:{positions:function(){for(var t=[],e=s.attributes.position.values,i=0;i<e.length;i+=3)t.push(new g.Cartesian3(e[i],e[i+1],e[i+2]));return t}()}}});this.callback(l)}e=[],i=[]}},t.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",e("draw_label",this.primitives),e("draw_circle",this.primitives),function(t,e){for(var i=e.values,r=0;r<i.length;r++)i[r].name==t&&(e.remove(i[r]),r--)}("draw_circle",this.viewer.entities)}}(window.Cesium),function(g){var t=g.DrawHeightWidget=function(t,e){this.viewer=t.viewer,this.color=t.color?t.color:g.Color.CHARTREUSE.withAlpha(.5),this.lineWidth=t.lineWidth?t.lineWidth:2,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.ellipsoid=this.scene.globe.ellipsoid,this.callback=e||null};function e(t,e){for(var i=0;i<e.length;i++)e.get(i).name==t&&(e.remove(e.get(i)),i--)}t.prototype.activate=function(){if(!this.handler){this.handler=new g.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var s,l,h=this,c=[];this.handler.setInputAction(function(t){if(!(0<c.length)){var e=h.camera.getPickRay(t.position),i=h.scene.globe.pick(e,h.scene);if(i){var r=g.Cartographic.fromCartesian(i),n=g.Math.toDegrees(r.longitude),o=g.Math.toDegrees(r.latitude),a=r.height;0==c.length&&(c.push(n),c.push(o),c.push(a),c.push(n),c.push(o),c.push(a),c.push(n),c.push(o),c.push(a),(s=h.primitives.add(new g.PolylineCollection)).name="draw_polyline",s.add({polyline:{}}),s.get(s.length-1).width=h.lineWidth,s.get(s.length-1).loop=!0,s.get(s.length-1).material.uniforms.color=h.color,s.get(s.length-1).positions=g.Cartesian3.fromDegreesArrayHeights(c))}}},g.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(t){var e=h.camera.getPickRay(t.endPosition),i=h.scene.globe.pick(e,h.scene);if(i){var r=g.Cartographic.fromCartesian(i),n=g.Math.toDegrees(r.longitude),o=g.Math.toDegrees(r.latitude),a=r.height;9==c.length&&(c[3]=n,c[4]=o,c[5]=a,c[2]>=c[5]?(c[6]=c[0],c[7]=c[1],c[8]=c[5]):(c[6]=c[3],c[7]=c[4],c[8]=c[2]),s.get(s.length-1).positions=g.Cartesian3.fromDegreesArrayHeights(c)),l||((l=h.primitives.add(new g.LabelCollection)).name="draw_label",l.add({text:"左键单击开始绘制，右键单击结束绘制",font:"16px sans-serif",showBackground:!0,disableDepthTestDistance:Number.POSITIVE_INFINITY})),l.get(l.length-1).position=g.Cartesian3.fromDegrees(n,o,a)}else l&&(h.primitives.remove(l),l=null)},g.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(t){if(h.handler=h.handler&&h.handler.destroy(),h.viewer.canvas.style.cursor="default",l&&(h.primitives.remove(l),l=null),h.callback){var e=new g.Entity({polyline:{positions:g.Cartesian3.fromDegreesArrayHeights(c)}});h.callback(e)}},g.ScreenSpaceEventType.RIGHT_CLICK)}},t.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",e("draw_label",this.primitives),e("draw_polyline",this.primitives)}}(window.Cesium),function(l){var t=l.DrawPointWidget=function(t,e){this.viewer=t.viewer,this.color=t.color?t.color:l.Color.RED,this.pixelSize=t.pixelSize?t.pixelSize:10,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.ellipsoid=this.scene.globe.ellipsoid,this.callback=e||null};function e(t,e){for(var i=0;i<e.length;i++)e.get(i).name==t&&(e.remove(e.get(i)),i--)}t.prototype.activate=function(){if(!this.handler){this.handler=new l.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var n,o,a=this,s=[];this.handler.setInputAction(function(t){var e=a.scene.pickPosition(t.position);if(!e){var i=a.camera.getPickRay(t.position);e=a.scene.globe.pick(i,a.scene)}if(e){if(l.Cartographic.fromCartesian(e).height<0){i=a.camera.getPickRay(t.position);e=a.scene.globe.pick(i,a.scene)}if(s[0]=e,n?n.removeAll():(n=a.primitives.add(new l.PointPrimitiveCollection)).name="draw_point",n.add({position:e,color:a.color,pixelSize:a.pixelSize,disableDepthTestDistance:30}),a.handler=a.handler&&a.handler.destroy(),a.viewer.canvas.style.cursor="default",o&&(a.primitives.remove(o),o=null),a.callback){var r=new l.Entity({position:s[0],point:{}});a.callback(r)}}},l.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(t){var e=a.scene.pickPosition(t.endPosition);if(!e){var i=a.camera.getPickRay(t.endPosition);e=a.scene.globe.pick(i,a.scene)}if(e){if(l.Cartographic.fromCartesian(e).height<0){i=a.camera.getPickRay(t.endPosition);e=a.scene.globe.pick(i,a.scene)}o||((o=a.primitives.add(new l.LabelCollection)).name="draw_label",o.add({text:"左键单击进行绘制",font:"15px Microsoft YaHei",showBackground:!0})),o.get(o.length-1).position=e}else o&&(a.primitives.remove(o),o=null)},l.ScreenSpaceEventType.MOUSE_MOVE)}},t.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",e("draw_label",this.primitives),e("draw_point",this.primitives)}}(window.Cesium),function(d){var t=d.DrawPolygonWidget=function(t,e){this.viewer=t.viewer,this.color=t.color?t.color:d.Color.CHARTREUSE.withAlpha(.5),this.lineWidth=t.lineWidth?t.lineWidth:2,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.ellipsoid=this.scene.globe.ellipsoid,this.callback=e||null,this.count=0};function e(t,e){for(var i=0;i<e.length;i++)e.get(i).name==t&&(e.remove(e.get(i)),i--)}t.prototype.activate=function(){if(!this.handler){this.handler=new d.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var l,h,c=this,g=[],s=[],u=[];this._array_=s,this._array2_=u,this._polylines_=l,this._labels_=h,this.handler.setInputAction(function(t){c.lastP=t;var e=c.scene.pickPosition(t.position);if(!e){var i=c.camera.getPickRay(t.position);e=c.scene.globe.pick(i,c.scene)}if(e){if((a=d.Cartographic.fromCartesian(e).height)<0){i=c.camera.getPickRay(t.position);e=c.scene.globe.pick(i,c.scene)}var r=d.Cartographic.fromCartesian(e);s.push(e);var n=d.Math.toDegrees(r.longitude),o=d.Math.toDegrees(r.latitude),a=r.height;u.push([n,o]),g.push(n),g.push(o),g.push(a),3==g.length&&((l=c.primitives.add(new d.PolylineCollection)).name="draw_polyline",l.add({polyline:{}}),l.get(l.length-1).width=c.lineWidth,l.get(l.length-1).loop=!0,l.get(l.length-1).material.uniforms.color=c.color,l.get(l.length-1).positions=d.Cartesian3.fromDegreesArrayHeights(g)),3<g.length&&(l.get(l.length-1).positions=d.Cartesian3.fromDegreesArrayHeights(g)),c._polylines_=l}},d.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(t){var e=c.scene.pickPosition(t.endPosition);if(!e){var i=c.camera.getPickRay(t.endPosition);e=c.scene.globe.pick(i,c.scene)}if(e){if((a=d.Cartographic.fromCartesian(e).height)<0){i=c.camera.getPickRay(t.endPosition);e=c.scene.globe.pick(i,c.scene)}var r=d.Cartographic.fromCartesian(e),n=d.Math.toDegrees(r.longitude),o=d.Math.toDegrees(r.latitude),a=r.height;if(3<=g.length){var s=g.concat();s.push(n),s.push(o),s.push(a),l.get(l.length-1).positions=d.Cartesian3.fromDegreesArrayHeights(s)}h||((h=c.primitives.add(new d.LabelCollection)).name="draw_label",h.add({text:"左键单击开始绘制，右键单击结束绘制",font:"15px Microsoft YaHei",showBackground:!0})),h.get(h.length-1).position=d.Cartesian3.fromDegrees(n,o,a),c._labels_=h}},d.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(t){c.drawEnd(t)},d.ScreenSpaceEventType.RIGHT_CLICK),this.count++}},t.prototype.drawEnd=function(t){if(0!=this._array_.length){var e=this._array_,i=this._array2_,r=this._polylines_,n=this._labels_;t||(console.log("点击按钮结束绘制"),t=this.lastP),this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",n&&(this.primitives.remove(n),n=null);var o=this.scene.pickPosition(t.position);if(!o){var a=this.camera.getPickRay(t.position);o=this.scene.globe.pick(a,this.scene)}if(o){if(d.Cartographic.fromCartesian(o).height<0){a=this.camera.getPickRay(t.position);o=this.scene.globe.pick(a,this.scene)}e.push(o);var s=d.Cartographic.fromCartesian(o),l=d.Math.toDegrees(s.longitude),h=d.Math.toDegrees(s.latitude);i.push([l,h]),r.get(r.length-1).material.uniforms.color=d.Color.DODGERBLUE.withAlpha(0);var c=new d.GroundPrimitive({geometryInstances:[],appearance:new d.PerInstanceColorAppearance,show:!0,classificationType:d.ClassificationType.BOTH}),g=new d.GeometryInstance({geometry:d.PolygonGeometry.fromPositions({positions:e,vertexFormat:d.EllipsoidSurfaceAppearance.VERTEX_FORMAT}),attributes:{color:d.ColorGeometryInstanceAttribute.fromColor(d.Color.GREEN.withAlpha(.3))}});if(c.geometryInstances.push(g),this.primitives.add(c).name="draw_polygon",this.callback){var u=new d.Entity({polygon:{hierarchy:{positions:e}}});this.callback(u)}this._array_=[],this._polylines_=null}}},t.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",e("draw_label",this.primitives),e("draw_polyline",this.primitives),e("draw_polygon",this.primitives)}}(window.Cesium),function(l){var t=l.DrawPolylineWidget=function(t,e){this.viewer=t.viewer,this.lineColor=l.defaultValue(t.lineColor,l.Color.CHARTREUSE.withAlpha(.5)),this.lineWidth=l.defaultValue(t.lineWidth,1),this.lineLoop=l.defaultValue(t.lineLoop,!0),this.lineClampGround=l.defaultValue(t.lineClampGround,!0),this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.primitives=this.scene.primitives,this.callback=e||null};function e(t,e){for(var i=0;i<e.length;i++)e.get(i).name==t&&(e.remove(e.get(i)),i--)}function h(t){return[l.Math.toDegrees(l.Cartographic.fromCartesian(t).longitude),l.Math.toDegrees(l.Cartographic.fromCartesian(t).latitude),l.Cartographic.fromCartesian(t).height]}t.prototype.screenToCartesian=function(t){if(this.lineClampGround){if(!(i=this.scene.pickPosition(t))){var e=this.camera.getPickRay(t);i=this.scene.globe.pick(e,this.scene)}if(!i)return;if(l.Cartographic.fromCartesian(i).height<0){e=this.camera.getPickRay(t);i=this.scene.globe.pick(e,this.scene)}}else{e=this.camera.getPickRay(t);var i=this.scene.globe.pick(e,this.scene)}return i},t.prototype.createGroundPrimitive=function(t){if(this.lineWidth&&this.lineColor&&this.primitives){var e=new l.GroundPrimitive({geometryInstances:new l.GeometryInstance({geometry:new l.CorridorGeometry({vertexFormat:l.VertexFormat.POSITION_ONLY,positions:t,width:this.lineWidth}),attributes:{color:l.ColorGeometryInstanceAttribute.fromColor(this.lineColor)}}),classificationType:l.ClassificationType.BOTH});return this.primitives.add(e)}return!1},t.prototype.createPrimitive=function(t){if(this.lineWidth&&this.lineColor&&this.primitives){var e=this.primitives.add(new l.PolylineCollection);return e.add({polyline:{}}),e.get(e.length-1).width=this.lineWidth,e.get(e.length-1).material.uniforms.color=this.lineColor,e.get(e.length-1).positions=t,e}return!1},t.prototype.activate=function(){if(!this.handler){this.handler=new l.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var o=[];this.degreesArrayHeights=[],this._labels=null;var a=this;this.handler.setInputAction(function(t){var e=a.screenToCartesian(t.position);o.push(e),a.degreesArrayHeights=a.degreesArrayHeights.concat(h(e));var i=o.length,r=[],n=[];1==i?r=[o[i-1]]:n=a.lineLoop?(r=[o[i-2],o[i-1]],[o[0],o[i-1]]):(r=[o[i-2],o[i-1]],[]),a.lineClampGround?(a.primitives.remove(a.temporaryGroundPrimitive),a.primitives.remove(a.concatGroundPrimitive),a.fixedGroundPrimitive=a.createGroundPrimitive(r),a.fixedGroundPrimitive.name="draw_polyline",a.concatGroundPrimitive=a.createGroundPrimitive(n),a.concatGroundPrimitive.name="draw_polylineConcat"):(a.primitives.remove(a.concatPrimitive),a.primitives.remove(a.temporaryPrimitive),a.fixedPrimitive=a.createPrimitive(r),a.fixedPrimitive.name="draw_polyline",a.concatPrimitive=a.createPrimitive(n),a.concatPrimitive.name="draw_polylineConcat")},l.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(t){var e=a.screenToCartesian(t.endPosition);if(e){var i=o.length;if(i)if(a.lineClampGround){a.primitives.remove(a.temporaryGroundPrimitive),a.primitives.remove(a.concatGroundPrimitive);var r=a.lineLoop&&2<=i?[o[i-1],e.clone(),o[0]]:[o[i-1],e.clone()];a.temporaryGroundPrimitive=a.createGroundPrimitive(r),a.temporaryGroundPrimitive.name="draw_polylineTemple"}else{a.primitives.remove(a.temporaryPrimitive),a.primitives.remove(a.concatPrimitive);var n=a.lineLoop&&2<=i?[o[i-1],e.clone(),o[0]]:[o[i-1],e.clone()];a.temporaryPrimitive=a.createPrimitive(n),a.temporaryPrimitive.name="draw_polylineTemple"}a._labels||(a._labels=a.primitives.add(new l.LabelCollection),a._labels.name="draw_label",a._labels.add({text:"左键单击开始绘制，右键单击结束绘制",font:"15px Microsoft YaHei",showBackground:!0})),a._labels.get(a._labels.length-1).position=e}else a._labels&&(a.primitives.remove(a._labels),a._labels=null)},l.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(t){a.drawEnd(o,t)},l.ScreenSpaceEventType.RIGHT_CLICK)}},t.prototype.drawEnd=function(t,e){var i=this._labels;this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",i&&(this.primitives.remove(i),i=null);var r=this.screenToCartesian(e.position);t.push(r),this.degreesArrayHeights=this.degreesArrayHeights.concat(h(r));var n=t.length;if(this.lineClampGround){this.primitives.remove(this.temporaryGroundPrimitive),this.primitives.remove(this.concatGroundPrimitive);var o=this.lineLoop&&2<n?[t[n-2],t[n-1],t[0]]:[t[n-2],t[n-1]];this.finalGroundPrimitive=this.createGroundPrimitive(o),this.finalGroundPrimitive.name="draw_polyline"}else{this.primitives.remove(this.temporaryPrimitive),this.primitives.remove(this.concatPrimitive);var a=this.lineLoop&&2<n?[t[n-2],t[n-1],t[0]]:[t[n-2],t[n-1]];this.finalPrimitive=this.createPrimitive(a),this.finalPrimitive.name="draw_polyline"}if(this.callback){var s=new l.Entity({polyline:{positions:l.Cartesian3.fromDegreesArrayHeights(this.degreesArrayHeights)}});this.callback(s)}},t.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",e("draw_label",this.primitives),e("draw_polyline",this.primitives)}}(window.Cesium);var xp={version:"1.0.0",createTime:"2018.6.19",author:"xupinhui"},doubleArrowDefualParam={type:"doublearrow",headHeightFactor:.25,headWidthFactor:.3,neckHeightFactor:.85,fixPointCount:4,neckWidthFactor:.15},tailedAttackArrowDefualParam={headHeightFactor:.18,headWidthFactor:.3,neckHeightFactor:.85,neckWidthFactor:.15,tailWidthFactor:.1,headTailFactor:.8,swallowTailFactor:1};xp.algorithm={},xp.algorithm.doubleArrow=function(t){this.connPoint=null;var e={controlPoint:this.tempPoint4=null,polygonalPoint:null};if(!((s=(this.points=t).length)<2)){if(2==s)return t;var i,r,n=this.points[0],o=this.points[1],a=this.points[2],s=t.length;this.tempPoint4=3==s?xp.algorithm.getTempPoint4(n,o,a):this.points[3],this.connPoint=3==s||4==s?P.PlotUtils.mid(n,o):this.points[4],r=P.PlotUtils.isClockWise(n,o,a)?(i=xp.algorithm.getArrowPoints(n,this.connPoint,this.tempPoint4,!1),xp.algorithm.getArrowPoints(this.connPoint,o,a,!0)):(i=xp.algorithm.getArrowPoints(o,this.connPoint,a,!1),xp.algorithm.getArrowPoints(this.connPoint,n,this.tempPoint4,!0));var l=i.length,h=(l-5)/2,c=i.slice(0,h),g=i.slice(h,5+h),u=i.slice(5+h,l),d=r.slice(0,h),p=r.slice(h,5+h),C=r.slice(5+h,l);d=P.PlotUtils.getBezierPoints(d);var m=P.PlotUtils.getBezierPoints(C.concat(c.slice(1)));u=P.PlotUtils.getBezierPoints(u);var f=d.concat(p,m,g,u),v=xp.algorithm.array2Dto1D(f);e.controlPoint=[n,o,a,this.tempPoint4,this.connPoint],e.polygonalPoint=Cesium.Cartesian3.fromDegreesArray(v)}return e},xp.algorithm.getTempPoint4=function(t,e,i,r){this.type=doubleArrowDefualParam.type,this.headHeightFactor=doubleArrowDefualParam.headHeightFactor,this.headWidthFactor=doubleArrowDefualParam.headWidthFactor,this.neckHeightFactor=doubleArrowDefualParam.neckHeightFactor,this.neckWidthFactor=doubleArrowDefualParam.neckWidthFactor;var n=P.PlotUtils.mid(t,e),o=P.PlotUtils.distance(n,i),a=P.PlotUtils.getThirdPoint(i,n,0,.3*o,!0),s=P.PlotUtils.getThirdPoint(i,n,0,.5*o,!0),l=[n,a=P.PlotUtils.getThirdPoint(n,a,P.Constants.HALF_PI,o/5,r),s=P.PlotUtils.getThirdPoint(n,s,P.Constants.HALF_PI,o/4,r),i],h=xp.algorithm.getArrowHeadPoints(l,this.headHeightFactor,this.headWidthFactor,this.neckHeightFactor,this.neckWidthFactor),c=h[0],g=h[4],u=P.PlotUtils.distance(t,e)/P.PlotUtils.getBaseLength(l)/2,d=xp.algorithm.getArrowBodyPoints(l,c,g,u),p=d.length,C=d.slice(0,p/2),m=d.slice(p/2,p);return C.push(c),m.push(g),(C=C.reverse()).push(e),(m=m.reverse()).push(t),C.reverse().concat(h,m)},xp.algorithm.array2Dto1D=function(t){var e=[];return t.forEach(function(t){e.push(t[0]),e.push(t[1])}),e},xp.algorithm.getArrowPoints=function(t,e,i,r){this.type=doubleArrowDefualParam.type,this.headHeightFactor=doubleArrowDefualParam.headHeightFactor,this.headWidthFactor=doubleArrowDefualParam.headWidthFactor,this.neckHeightFactor=doubleArrowDefualParam.neckHeightFactor,this.neckWidthFactor=doubleArrowDefualParam.neckWidthFactor;var n=P.PlotUtils.mid(t,e),o=P.PlotUtils.distance(n,i),a=P.PlotUtils.getThirdPoint(i,n,0,.3*o,!0),s=P.PlotUtils.getThirdPoint(i,n,0,.5*o,!0),l=[n,a=P.PlotUtils.getThirdPoint(n,a,P.Constants.HALF_PI,o/5,r),s=P.PlotUtils.getThirdPoint(n,s,P.Constants.HALF_PI,o/4,r),i],h=xp.algorithm.getArrowHeadPoints(l,this.headHeightFactor,this.headWidthFactor,this.neckHeightFactor,this.neckWidthFactor),c=h[0],g=h[4],u=P.PlotUtils.distance(t,e)/P.PlotUtils.getBaseLength(l)/2,d=xp.algorithm.getArrowBodyPoints(l,c,g,u),p=d.length,C=d.slice(0,p/2),m=d.slice(p/2,p);return C.push(c),m.push(g),(C=C.reverse()).push(e),(m=m.reverse()).push(t),C.reverse().concat(h,m)},xp.algorithm.getArrowHeadPoints=function(t,e,i){this.type=doubleArrowDefualParam.type,this.headHeightFactor=doubleArrowDefualParam.headHeightFactor,this.headWidthFactor=doubleArrowDefualParam.headWidthFactor,this.neckHeightFactor=doubleArrowDefualParam.neckHeightFactor,this.neckWidthFactor=doubleArrowDefualParam.neckWidthFactor;var r=P.PlotUtils.getBaseLength(t)*this.headHeightFactor,n=t[t.length-1],o=(P.PlotUtils.distance(e,i),r*this.headWidthFactor),a=r*this.neckWidthFactor,s=r*this.neckHeightFactor,l=P.PlotUtils.getThirdPoint(t[t.length-2],n,0,r,!0),h=P.PlotUtils.getThirdPoint(t[t.length-2],n,0,s,!0),c=P.PlotUtils.getThirdPoint(n,l,P.Constants.HALF_PI,o,!1),g=P.PlotUtils.getThirdPoint(n,l,P.Constants.HALF_PI,o,!0);return[P.PlotUtils.getThirdPoint(n,h,P.Constants.HALF_PI,a,!1),c,n,g,P.PlotUtils.getThirdPoint(n,h,P.Constants.HALF_PI,a,!0)]},xp.algorithm.getArrowBodyPoints=function(t,e,i,r){for(var n=P.PlotUtils.wholeDistance(t),o=P.PlotUtils.getBaseLength(t)*r,a=(o-P.PlotUtils.distance(e,i))/2,s=0,l=[],h=[],c=1;c<t.length-1;c++){var g=P.PlotUtils.getAngleOfThreePoints(t[c-1],t[c],t[c+1])/2,u=(o/2-(s+=P.PlotUtils.distance(t[c-1],t[c]))/n*a)/Math.sin(g),d=P.PlotUtils.getThirdPoint(t[c-1],t[c],Math.PI-g,u,!0),p=P.PlotUtils.getThirdPoint(t[c-1],t[c],g,u,!1);l.push(d),h.push(p)}return l.concat(h)},xp.algorithm.getTempPoint4=function(t,e,i){var r,n,o,a=P.PlotUtils.mid(t,e),s=P.PlotUtils.distance(a,i),l=P.PlotUtils.getAngleOfThreePoints(t,a,i);return l<P.Constants.HALF_PI?(r=s*Math.sin(l),n=s*Math.cos(l),o=P.PlotUtils.getThirdPoint(t,a,P.Constants.HALF_PI,r,!1),P.PlotUtils.getThirdPoint(a,o,P.Constants.HALF_PI,n,!0)):l>=P.Constants.HALF_PI&&l<Math.PI?(r=s*Math.sin(Math.PI-l),n=s*Math.cos(Math.PI-l),o=P.PlotUtils.getThirdPoint(t,a,P.Constants.HALF_PI,r,!1),P.PlotUtils.getThirdPoint(a,o,P.Constants.HALF_PI,n,!1)):l>=Math.PI&&l<1.5*Math.PI?(r=s*Math.sin(l-Math.PI),n=s*Math.cos(l-Math.PI),o=P.PlotUtils.getThirdPoint(t,a,P.Constants.HALF_PI,r,!0),P.PlotUtils.getThirdPoint(a,o,P.Constants.HALF_PI,n,!0)):(r=s*Math.sin(2*Math.PI-l),n=s*Math.cos(2*Math.PI-l),o=P.PlotUtils.getThirdPoint(t,a,P.Constants.HALF_PI,r,!0),P.PlotUtils.getThirdPoint(a,o,P.Constants.HALF_PI,n,!1))},xp.algorithm.tailedAttackArrow=function(t){t=xp.algorithm.dereplication(t),this.tailWidthFactor=tailedAttackArrowDefualParam.tailWidthFactor,this.swallowTailFactor=tailedAttackArrowDefualParam.swallowTailFactor,this.swallowTailPnt=tailedAttackArrowDefualParam.swallowTailPnt;var e={controlPoint:null,polygonalPoint:null};if(!((p=(e.controlPoint=t).length)<2)){if(2==t.length)return e.polygonalPoint=t,e;var i=t,r=i[0],n=i[1];P.PlotUtils.isClockWise(i[0],i[1],i[2])&&(r=i[1],n=i[0]);var o=[P.PlotUtils.mid(r,n)].concat(i.slice(2)),a=xp.algorithm.getAttackArrowHeadPoints(o,r,n,tailedAttackArrowDefualParam),s=a[0],l=a[4],h=P.PlotUtils.distance(r,n),c=P.PlotUtils.getBaseLength(o),g=c*this.tailWidthFactor*this.swallowTailFactor;this.swallowTailPnt=P.PlotUtils.getThirdPoint(o[1],o[0],0,g,!0);var u=h/c,d=xp.algorithm.getAttackArrowBodyPoints(o,s,l,u),p=d.length,C=[r].concat(d.slice(0,p/2));C.push(s);var m,f=[n].concat(d.slice(p/2,p));f.push(l),C=P.PlotUtils.getQBSplinePoints(C),f=P.PlotUtils.getQBSplinePoints(f),m=xp.algorithm.array2Dto1D(C.concat(a,f.reverse(),[this.swallowTailPnt,C[0]])),e.polygonalPoint=Cesium.Cartesian3.fromDegreesArray(m)}return e},xp.algorithm.getAttackArrowHeadPoints=function(t,e,i,r){this.headHeightFactor=r.headHeightFactor,this.headTailFactor=r.headTailFactor,this.headWidthFactor=r.headWidthFactor,this.neckWidthFactor=r.neckWidthFactor,this.neckHeightFactor=r.neckHeightFactor;var n=P.PlotUtils.getBaseLength(t),o=n*this.headHeightFactor,a=t[t.length-1];n=P.PlotUtils.distance(a,t[t.length-2]);var s=P.PlotUtils.distance(e,i);o>s*this.headTailFactor&&(o=s*this.headTailFactor);var l=o*this.headWidthFactor,h=o*this.neckWidthFactor,c=(o=n<o?n:o)*this.neckHeightFactor,g=P.PlotUtils.getThirdPoint(t[t.length-2],a,0,o,!0),u=P.PlotUtils.getThirdPoint(t[t.length-2],a,0,c,!0),d=P.PlotUtils.getThirdPoint(a,g,P.Constants.HALF_PI,l,!1),p=P.PlotUtils.getThirdPoint(a,g,P.Constants.HALF_PI,l,!0);return[P.PlotUtils.getThirdPoint(a,u,P.Constants.HALF_PI,h,!1),d,a,p,P.PlotUtils.getThirdPoint(a,u,P.Constants.HALF_PI,h,!0)]},xp.algorithm.getAttackArrowBodyPoints=function(t,e,i,r){for(var n=P.PlotUtils.wholeDistance(t),o=P.PlotUtils.getBaseLength(t)*r,a=(o-P.PlotUtils.distance(e,i))/2,s=0,l=[],h=[],c=1;c<t.length-1;c++){var g=P.PlotUtils.getAngleOfThreePoints(t[c-1],t[c],t[c+1])/2,u=(o/2-(s+=P.PlotUtils.distance(t[c-1],t[c]))/n*a)/Math.sin(g),d=P.PlotUtils.getThirdPoint(t[c-1],t[c],Math.PI-g,u,!0),p=P.PlotUtils.getThirdPoint(t[c-1],t[c],g,u,!1);l.push(d),h.push(p)}return l.concat(h)},xp.algorithm.dereplication=function(t){var e=t[t.length-1],i=!1,r=[];return r=t.filter(function(t){if(t[0]!=e[0]&&t[1]!=e[1])return t;i=!0}),i&&r.push(e),r};var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(S){var M=S.DrawHelper=function(){var C=S.Ellipsoid.WGS84,p={billBoard:[],primitives:[]};function m(t){this._scene=t.scene,this._tooltip=function(t){function e(t){var e=document.createElement("DIV");e.className="twipsy right";var i=document.createElement("DIV");i.className="twipsy-arrow",e.appendChild(i);var r=document.createElement("DIV");r.className="twipsy-inner",e.appendChild(r),this._div=e,this._title=r,t.appendChild(e)}return e.prototype.setVisible=function(t){this._div.style.display=t?"block":"none"},e.prototype.showAt=function(t,e){t&&e&&(this.setVisible(!0),this._title.innerHTML=e,this._div.style.left=t.x+10+"px",this._div.style.top=t.y-this._div.clientHeight/2+"px")},new e(t)}(t.container),this._surfaces=[],this.initialiseHandlers(),this.enhancePrimitives()}m.prototype.initialiseHandlers=function(){var i,r=this._scene,n=this,t=new S.ScreenSpaceEventHandler(r.canvas);function e(t,e){if(1!=n._handlersMuted){var i=r.pick(e);i&&i.primitive&&i.primitive[t]&&i.primitive[t](e)}}t.setInputAction(function(t){e("leftClick",t.position)},S.ScreenSpaceEventType.LEFT_CLICK),t.setInputAction(function(t){e("leftDoubleClick",t.position)},S.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),t.setInputAction(function(t){if(1!=n._handlersMuted){var e=r.pick(t.endPosition);!i||e&&i==e.primitive||(i.isDestroyed&&i.isDestroyed()||i.mouseOut(t.endPosition),i=null),e&&e.primitive&&((e=e.primitive).mouseOut&&(i=e),e.mouseMove&&e.mouseMove(t.endPosition))}},S.ScreenSpaceEventType.MOUSE_MOVE),t.setInputAction(function(t){e("leftUp",t.position)},S.ScreenSpaceEventType.LEFT_UP),t.setInputAction(function(t){e("leftDown",t.position)},S.ScreenSpaceEventType.LEFT_DOWN)},m.prototype.setListener=function(t,e,i){t[e]=i},m.prototype.muteHandlers=function(t){this._handlersMuted=t},m.prototype.registerEditableShape=function(e){var i=this;E(e,"mouseMove",function(t){e.setHighlighted(!0),e._editMode||i._tooltip.showAt(t,"点击以编辑图形")}),E(e,"mouseOut",function(t){e.setHighlighted(!1),i._tooltip.setVisible(!1)}),E(e,"leftClick",function(t){e.setEditMode(!0),p.primitives.push(e)}),E(e,"leftDoubleClick",function(t){p.primitives.push(e)})},m.prototype.startDrawing=function(t){this.disableAllEditMode(),this.editCleanUp&&this.editCleanUp(),this.editCleanUp=t,this.muteHandlers(!0)},m.prototype.stopDrawing=function(){this.editCleanUp&&(this.editCleanUp(),this.editCleanUp=null),this.muteHandlers(!1)},m.prototype.disableAllHighlights=function(){this.setHighlighted(void 0)},m.prototype.setHighlighted=function(t){this._highlightedSurface&&!this._highlightedSurface.isDestroyed()&&this._highlightedSurface!=t&&this._highlightedSurface.setHighlighted(!1),this._highlightedSurface=t},m.prototype.disableAllEditMode=function(){this.setEdited(void 0)},m.prototype.setEdited=function(t){this._editedSurface&&!this._editedSurface.isDestroyed()&&this._editedSurface.setEditMode(!1),this._editedSurface=t};var t=S.Material.fromType(S.Material.ColorType);t.uniforms.color=new S.Color(1,1,0,.5);var e={ellipsoid:S.Ellipsoid.WGS84,textureRotationAngle:0,height:0,asynchronous:!0,show:!0,debugShowBoundingVolume:!1},i=b(e,{appearance:new S.EllipsoidSurfaceAppearance({aboveGround:!1}),material:t,granularity:Math.PI/180}),a=b(e,{}),l=b(e,{}),h=b(e,{}),c=(b(i,{rotation:0}),b(e,{width:5,geodesic:!0,granularity:1e4,appearance:new S.PolylineMaterialAppearance({aboveGround:!1}),material:t})),r=(n.prototype.initialiseOptions=function(t){x(this,t),this._ellipsoid=void 0,this._granularity=void 0,this._height=void 0,this._textureRotationAngle=void 0,this._id=void 0,this._createPrimitive=!0,this._primitive=void 0,this._outlinePolygon=void 0},n.prototype.setAttribute=function(t,e){this[t]=e,this._createPrimitive=!0},n.prototype.getAttribute=function(t){return this[t]},n.prototype.update=function(t,e,i){if(!S.defined(this.ellipsoid))throw new S.DeveloperError("this.ellipsoid must be defined.");if(!S.defined(this.appearance))throw new S.DeveloperError("this.material must be defined.");if(this.granularity<0)throw new S.DeveloperError("this.granularity and scene2D/scene3D overrides must be greater than zero.");if(this.show&&(this._createPrimitive||S.defined(this._primitive))){if(this._createPrimitive||this._ellipsoid!==this.ellipsoid||this._granularity!==this.granularity||this._height!==this.height||this._textureRotationAngle!==this.textureRotationAngle||this._id!==this.id){var r=this.getGeometry();if(!r)return;this._createPrimitive=!1,this._ellipsoid=this.ellipsoid,this._granularity=this.granularity,this._height=this.height,this._textureRotationAngle=this.textureRotationAngle,this._id=this.id,this._primitive=this._primitive&&this._primitive.destroy(),this._primitive=new S.Primitive({geometryInstances:new S.GeometryInstance({geometry:r,id:this.id,pickPrimitive:this}),appearance:this.appearance,asynchronous:this.asynchronous}),this._outlinePolygon=this._outlinePolygon&&this._outlinePolygon.destroy(),this.strokeColor&&this.getOutlineGeometry&&(this._outlinePolygon=new S.Primitive({geometryInstances:new S.GeometryInstance({geometry:this.getOutlineGeometry(),attributes:{color:S.ColorGeometryInstanceAttribute.fromColor(this.strokeColor)}}),appearance:new S.PerInstanceColorAppearance({flat:!0,renderState:{depthTest:{enabled:!0},lineWidth:1}})}))}var n=this._primitive;n.appearance.material=this.material,n.debugShowBoundingVolume=this.debugShowBoundingVolume,n.update(t,e,i),this._outlinePolygon&&this._outlinePolygon.update(t,e,i)}},n.prototype.isDestroyed=function(){return!1},n.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),S.destroyObject(this)},n.prototype.setStrokeStyle=function(t,e){this.strokeColor&&this.strokeColor.equals(t)&&this.strokeWidth==e||(this._createPrimitive=!0,this.strokeColor=t,this.strokeWidth=e)},n);function n(){}function o(t){if(!S.defined(t.extent))throw new S.DeveloperError("Extent is required");t=b(t,i),this.initialiseOptions(t),this.setExtent(t.extent)}function s(t){t=b(t,i),this.initialiseOptions(t),this.isPolygon=!0}function g(t){t=b(t,i),this.initialiseOptions(t),this.isPolygon=!0}function u(t){t=b(t,c),this.initialiseOptions(t)}m.ExtentPrimitive=((o.prototype=new r).setExtent=function(t){this.setAttribute("extent",t)},o.prototype.getExtent=function(){return this.getAttribute("extent")},o.prototype.getGeometry=function(){if(S.defined(this.extent))return S.PolygonGeometry.fromPositions({positions:this.extent,height:this.height,vertexFormat:S.EllipsoidSurfaceAppearance.VERTEX_FORMAT,stRotation:this.textureRotationAngle,ellipsoid:this.ellipsoid,granularity:this.granularity})},o.prototype.getOutlineGeometry=function(){return S.PolygonOutlineGeometry.fromPositions({positions:this.extent})},o),m.PolygonPrimitive=((s.prototype=new r).setPositions=function(t){this.setAttribute("positions",t)},s.prototype.getPositions=function(){return this.getAttribute("positions")},s.prototype.setCustom=function(t){this.setAttribute("custom")},s.prototype.getCustom=function(t){return this.getAttribute("custom")},s.prototype.getGeometry=function(){if(S.defined(this.positions)&&!(this.positions.length<3))return S.PolygonGeometry.fromPositions({positions:this.positions,height:this.height,vertexFormat:S.EllipsoidSurfaceAppearance.VERTEX_FORMAT,stRotation:this.textureRotationAngle,ellipsoid:this.ellipsoid,granularity:this.granularity})},s.prototype.getOutlineGeometry=function(){return S.PolygonOutlineGeometry.fromPositions({positions:this.getPositions()})},s),m.TailedAttackPrimitive=((g.prototype=new r).setPositions=function(t){this.setAttribute("positions",t)},g.prototype.getPositions=function(){return this.getAttribute("positions")},g.prototype.setCustom=function(t){this.setAttribute("custom")},g.prototype.getCustom=function(t){return this.getAttribute("custom")},g.prototype.getGeometry=function(){if(S.defined(this.positions)&&!(this.positions.length<3))return S.PolygonGeometry.fromPositions({positions:this.positions,height:this.height,vertexFormat:S.EllipsoidSurfaceAppearance.VERTEX_FORMAT,stRotation:this.textureRotationAngle,ellipsoid:this.ellipsoid,granularity:this.granularity})},g.prototype.getOutlineGeometry=function(){return S.PolygonOutlineGeometry.fromPositions({positions:this.getPositions()})},g),m.PolylinePrimitive=((u.prototype=new r).setPositions=function(t){this.setAttribute("positions",t)},u.prototype.setWidth=function(t){this.setAttribute("width",t)},u.prototype.setGeodesic=function(t){this.setAttribute("geodesic",t)},u.prototype.getPositions=function(){return this.getAttribute("positions")},u.prototype.getWidth=function(){return this.getAttribute("width")},u.prototype.getGeodesic=function(t){return this.getAttribute("geodesic")},u.prototype.getGeometry=function(){if(S.defined(this.positions)&&!(this.positions.length<2))return new S.PolylineGeometry({positions:this.positions,height:this.height,width:this.width<1?1:this.width,vertexFormat:S.EllipsoidSurfaceAppearance.VERTEX_FORMAT,ellipsoid:this.ellipsoid})},u);var f={iconUrl:"/geomap-api/JsCesuimDemo/resource/images/img_plot/dragIcon.png",shiftX:0,shiftY:0},v={iconUrl:"/geomap-api/JsCesuimDemo/resource/images/img_plot/dragIcon.png",shiftX:0,shiftY:0},A={iconUrl:"/geomap-api/JsCesuimDemo/resource/images/img_plot/dragIconLight.png",shiftX:0,shiftY:0};function I(t){return[t[7],t[3]]}function _(t){var e=S.Cartographic.fromCartesian(t);return[S.Math.toDegrees(e.longitude),S.Math.toDegrees(e.latitude)]}function y(t,e){if(!(t.length<2||e.length<2)){var i=Math.PI/8.5,r=Math.PI/13,n=[];n[0]=t,n[1]=e;var o=n[0],a=n[1],s=P.PlotUtils.getBaseLength(n),l=.15*s,h=.2*s,c=.25*s,g=P.PlotUtils.getThirdPoint(a,o,P.Constants.HALF_PI,l,!0),u=P.PlotUtils.getThirdPoint(a,o,P.Constants.HALF_PI,l,!1),d=P.PlotUtils.getThirdPoint(o,a,i,c,!1),p=P.PlotUtils.getThirdPoint(o,a,i,c,!0),C=P.PlotUtils.getThirdPoint(o,a,r,h,!1),m=P.PlotUtils.getThirdPoint(o,a,r,h,!0),f=[];return f.push(g[0],g[1],C[0],C[1],d[0],d[1],a[0],a[1],p[0],p[1],m[0],m[1],u[0],u[1],o[0],o[1]),S.Cartesian3.fromDegreesArray(f)}}function w(t){for(var e=[],i=0;i<t.length;i++){var r=S.Cartesian3.fromDegrees(t[i][0],t[i][1],0);e.push(r)}return e}m.prototype.createBillboardGroup=function(t,e,i){var r=new m.BillboardGroup(this,e);return r.addBillboards(t,i),r},(m.BillboardGroup=function(t,e){this._drawHelper=t,this._scene=t._scene,this._options=b(e,f);var i=new S.BillboardCollection;this._scene.primitives.add(i),this._billboards=i,this._orderedBillboards=[]}).prototype.createBillboard=function(t,r){var n=this._billboards.add({show:!0,position:t,pixelOffset:new S.Cartesian2(this._options.shiftX,this._options.shiftY),eyeOffset:new S.Cartesian3(0,0,0),horizontalOrigin:S.HorizontalOrigin.CENTER,verticalOrigin:S.VerticalOrigin.CENTER,scale:1,image:this._options.iconUrl,color:new S.Color(1,1,1,1)});if(r){var o=function(t){e.enableRotate=t},a=function(){for(var t=0,e=s._orderedBillboards.length;t<e&&s._orderedBillboards[t]!=n;++t);return t},s=this,e=this._scene.screenSpaceCameraController;if(r.dragHandlers){s=this;E(n,"leftDown",function(t){function i(t){e.destroy(),o(!0),r.dragHandlers.onDragEnd&&r.dragHandlers.onDragEnd(a(),t)}var e=new S.ScreenSpaceEventHandler(s._scene.canvas);e.setInputAction(function(t){var e=s._scene.camera.pickEllipsoid(t.endPosition,C);e?function(t){n.position=t;for(var e=0,i=s._orderedBillboards.length;e<i&&s._orderedBillboards[e]!=n;++e);r.dragHandlers.onDrag&&r.dragHandlers.onDrag(a(),t)}(e):i(e)},S.ScreenSpaceEventType.MOUSE_MOVE),e.setInputAction(function(t){i(s._scene.camera.pickEllipsoid(t.position,C))},S.ScreenSpaceEventType.LEFT_UP),o(!1),r.dragHandlers.onDragStart&&r.dragHandlers.onDragStart(a(),s._scene.camera.pickEllipsoid(t,C))})}r.onDoubleClick&&E(n,"leftDoubleClick",function(t){r.onDoubleClick(a())}),r.onClick&&E(n,"leftClick",function(t){r.onClick(a())}),r.tooltip&&(E(n,"mouseMove",function(t){s._drawHelper._tooltip.showAt(t,r.tooltip())}),E(n,"mouseOut",function(t){s._drawHelper._tooltip.setVisible(!1)}))}return n},m.BillboardGroup.prototype.insertBillboard=function(t,e,i){this._orderedBillboards.splice(t,0,this.createBillboard(e,i))},m.BillboardGroup.prototype.addBillboard=function(t,e){this._orderedBillboards.push(this.createBillboard(t,e))},m.BillboardGroup.prototype.removeLastBillboard=function(){this._billboards.remove(this._orderedBillboards.pop())},m.BillboardGroup.prototype.addBillboards=function(t,e){for(var i=0;i<t.length;i++)this.addBillboard(t[i],e)},m.BillboardGroup.prototype.updateBillboardsPositions=function(t){for(var e=0;e<t.length;e++)this.getBillboard(e).position=t[e]},m.BillboardGroup.prototype.countBillboards=function(){return this._orderedBillboards.length},m.BillboardGroup.prototype.getBillboard=function(t){return this._orderedBillboards[t]},m.BillboardGroup.prototype.removeBillboard=function(t){this._billboards.remove(this.getBillboard(t)),this._orderedBillboards.splice(t,1)},m.BillboardGroup.prototype.remove=function(){this._billboards=this._billboards&&this._billboards.removeAll()&&this._billboards.destroy()},m.BillboardGroup.prototype.setOnTop=function(){this._scene.primitives.raiseToTop(this._billboards)},m.prototype.startDrawingPolygon=function(t){t=b(t,i);this.startDrawingPolyshape(!0,t)},m.prototype.startDrawingPolyline=function(i){i=b(i,c);this.startDrawing(function(){t.remove(r),l.remove(),e.destroy(),a.setVisible(!1)});var r,n=this,o=this._scene,t=o.primitives,a=this._tooltip;(r=new M.PolylinePrimitive(i)).asynchronous=!1,t.add(r);var s=[],l=new m.BillboardGroup(this,f),e=new S.ScreenSpaceEventHandler(o.canvas);e.setInputAction(function(t){if(null!=t.position){var e=o.camera.pickEllipsoid(t.position,C);e&&(0==s.length&&(s.push(e.clone()),l.addBillboard(s[0])),2<=s.length&&(r.positions=s,r._createPrimitive=!0),s.push(e),l.addBillboard(e))}},S.ScreenSpaceEventType.LEFT_CLICK),e.setInputAction(function(t){var e=t.endPosition;if(null!=e)if(0==s.length)a.showAt(e,"<p>Click to add first point</p>");else{var i=o.camera.pickEllipsoid(e,C);i&&(s.pop(),i.y+=1+Math.random(),s.push(i),2<=s.length&&(r.positions=s,r._createPrimitive=!0),l.getBillboard(s.length-1).position=i,a.showAt(e,"<p>Click to add new point ("+s.length+")</p>"+(2<s.length?"<p>Double click to finish drawing</p>":"")))}},S.ScreenSpaceEventType.MOUSE_MOVE),e.setInputAction(function(t){var e=t.position;if(null!=e){if(s.length<4)return;if(o.camera.pickEllipsoid(e,C)&&(n.stopDrawing(),"function"==typeof i.callback)){s.length;i.callback(s)}}},S.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)},m.prototype.startDrawingTailedAttack=function(e){this.startDrawing(function(){t.remove(h),o.remove(),r.destroy(),l.setVisible(!1)}),this.firstTime=!0,this.options=e;var i=this,s=this._scene,t=s.primitives,l=this._tooltip,h=new M.TailedAttackPrimitive(e);/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent)?h.asynchronous=!0:h.asynchronous=!1,t.add(h);var c=[],g=[],o=new m.BillboardGroup(this,f),r=new S.ScreenSpaceEventHandler(s.canvas);this.positions=c,this.minPoints=2,this.poly=h,r.setInputAction(function(t){if(null!=t.position){var e=s.camera.pickEllipsoid(t.position,C),i=S.Cartographic.fromCartesian(e),r=[S.Math.toDegrees(i.longitude),S.Math.toDegrees(i.latitude)];if(e){if(0==g.length&&(c.push(e.clone()),o.addBillboard(c[0])),g.length<3&&g.push(r),2<=g.length){g.push(r);var n=xp.algorithm.tailedAttackArrow(g);h.positions=n.polygonalPoint,h.custom=n.controlPoint,h._createPrimitive=!0}c.push(e),5<=c.length&&o.removeLastBillboard(),o.addBillboard(e)}}},S.ScreenSpaceEventType.LEFT_CLICK),r.setInputAction(function(t){var e=t.endPosition;if(null!=e)if(0==c.length)l.showAt(e,"<p>点击以增加第一个控制点</p>");else{var i=s.camera.pickEllipsoid(e,C),r=S.Cartographic.fromCartesian(i),n=[S.Math.toDegrees(r.longitude),S.Math.toDegrees(r.latitude)];if(i){if(c.pop(),i.y+=1+Math.random(),c.push(i),3<=g.length&&(g.pop(),g.push(n)),2==g.length&&g.push(n),2<c.length){var o=xp.algorithm.tailedAttackArrow(g);h.positions=o?o.polygonalPoint:null,h.custom=o?o.controlPoint:null,h._createPrimitive=!0}var a=3==c.length?"<p>双击可结束绘制</p>":"单击以增加一个新的控制点";l.showAt(e,a)}}},S.ScreenSpaceEventType.MOUSE_MOVE),r.setInputAction(function(t){i.drawEnd(t,e)},S.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)},m.prototype.drawEnd=function(t,e){var i,r=this.positions,n=this.minPoints,o=this.poly;e=this.options;if(null==t){if(this.firstTime){if(this.stopDrawing(),"function"!=typeof e.callback)return;r.length;e.callback(o.positions,o.custom),this.firstTime=!1}}else if(null!=(i=t.position)){if(r.length<n+2)return;if(scene.camera.pickEllipsoid(i,C)&&(this.stopDrawing(),"function"==typeof e.callback)){r.length;e.callback(o.positions,o.custom)}}},m.prototype.startDrawingPolyshape=function(t,e){this.startDrawing(function(){r.remove(s),o.remove(),n.destroy(),h.setVisible(!1)}),this.firstTime=!0,this.options=e;var s,i=this,l=this._scene,r=l.primitives,h=this._tooltip;this.minPoints=2,s=t?new M.PolygonPrimitive(e):new M.PolylinePrimitive(e),/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent)?s.asynchronous=!0:s.asynchronous=!1,r.add(s);var c=[],g=[],o=new m.BillboardGroup(this,f),n=new S.ScreenSpaceEventHandler(l.canvas);this.poly=s,this.positions=c,n.setInputAction(function(t){if(null!=t.position){var e=l.camera.pickEllipsoid(t.position,C),i=S.Cartographic.fromCartesian(e),r=[S.Math.toDegrees(i.longitude),S.Math.toDegrees(i.latitude)];if(e){if(0==g.length&&(c.push(e.clone()),o.addBillboard(c[0])),g.length<3&&g.push(r),2<=g.length){var n=xp.algorithm.doubleArrow(g);s.positions=n.polygonalPoint,s.custom=n.controlPoint,s._createPrimitive=!0}c.push(e),5<=c.length&&o.removeLastBillboard(),o.addBillboard(e)}}},S.ScreenSpaceEventType.LEFT_CLICK),n.setInputAction(function(t){var e=t.endPosition;if(null!=e)if(0==c.length)h.showAt(e,"<p>点击以增加第一个控制点</p>");else{var i=l.camera.pickEllipsoid(e,C),r=S.Cartographic.fromCartesian(i),n=[S.Math.toDegrees(r.longitude),S.Math.toDegrees(r.latitude)];if(i){if(c.pop(),i.y+=1+Math.random(),c.push(i),3==g.length&&(g.pop(),g.push(n)),2==g.length&&g.push(n),2<=c.length){var o=xp.algorithm.doubleArrow(g);s.positions=o?o.polygonalPoint:null,s.custom=o?o.controlPoint:null,s._createPrimitive=!0}var a=3==c.length?"<p>双击可结束绘制</p>":"单击以增加一个新的控制点";h.showAt(e,a)}}},S.ScreenSpaceEventType.MOUSE_MOVE),n.setInputAction(function(t){i.drawEnd(t,e)},S.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)},m.prototype.startDrawingExtent=function(s){s=b(s,i);this.startDrawing(function(){null!=d&&c.remove(d),p.remove(),t.destroy(),g.setVisible(!1)});var l=this,h=this._scene,c=this._scene.primitives,g=this._tooltip,u=[],d=null,p=null,t=new S.ScreenSpaceEventHandler(h.canvas);t.setInputAction(function(t){if(null!=t.position){var e=h.camera.pickEllipsoid(t.position,C);if(e)if(null==d){var i=S.Cartographic.fromCartesian(e),r=S.Math.toDegrees(i.longitude),n=S.Math.toDegrees(i.latitude);u.push(r,n);var o=y(u,u);d=new m.ExtentPrimitive({extent:o,asynchronous:!1,material:s.material}),c.add(d),p=new m.BillboardGroup(l,f);var a=w([u,u]);p.addBillboards(a)}else if(l.stopDrawing(),"function"==typeof s.callback){i=S.Cartographic.fromCartesian(e),r=S.Math.toDegrees(i.longitude),n=S.Math.toDegrees(i.latitude);s.callback(y(u,[r,n]))}}},S.ScreenSpaceEventType.LEFT_DOWN),t.setInputAction(function(t){var e=t.endPosition;if(null!=e)if(null==d)g.showAt(e,"<p>点击开始绘制</p>");else{var i=h.camera.pickEllipsoid(e,C);if(i){var r=S.Cartographic.fromCartesian(i),n=S.Math.toDegrees(r.longitude),o=S.Math.toDegrees(r.latitude),a=y(u,[n,o]);d.setExtent(a);var s=w([u,[n,o]]);p.updateBillboardsPositions(s),g.showAt(e,"<p>拖动改变箭头</p><p>再次点击结束绘制</p>")}}},S.ScreenSpaceEventType.MOUSE_MOVE)},m.prototype.enhancePrimitives=function(){var d=this;function t(t){d._scene;this._highlighted&&this._highlighted==t||!0!==this._editMode&&((this._highlighted=t)?(d.setHighlighted(this),this._strokeColor=this.strokeColor,this.setStrokeStyle(S.Color.fromCssColorString("white"),this.strokeWidth)):this._strokeColor?this.setStrokeStyle(this._strokeColor,this.strokeWidth):this.setStrokeStyle(void 0,void 0))}function i(t){if(this._editMode!=t)if(d.disableAllHighlights(),t){d.setEdited(this);var i=d._scene,r=this;if(null==this._markers){var n=function(t,e){var i=t-1<0?e.length-1:t-1;i<l.countBillboards()&&(l.getBillboard(i).position=a(i)),(i=t)<l.countBillboards()&&(l.getBillboard(i).position=a(i))},o=function(){r.executeListeners({name:"onEdited",positions:r.positions})},a=function(t){var e=r.positions;return C.cartographicToCartesian(new S.EllipsoidGeodesic(C.cartesianToCartographic(e[t]),C.cartesianToCartographic(e[t<e.length-1?t+1:0])).interpolateUsingFraction(.5))},s=new m.BillboardGroup(d,v);p.billBoard.push(s);var l=new m.BillboardGroup(d,A);p.billBoard.push(l);var h={dragHandlers:{onDrag:function(t,e){r.positions[t]=e,n(t,r.positions),r._createPrimitive=!0},onDragEnd:function(){r._createPrimitive=!0,o()}},onDoubleClick:function(t){r.positions.length<4||(r.positions.splice(t,1),r._createPrimitive=!0,s.removeBillboard(t),l.removeBillboard(t),n(t,r.positions),o())},tooltip:function(){if(3<r.positions.length)return"Double click to remove this point"}};s.addBillboards(r.positions,h),this._markers=s;for(var e=[],c=0,g=r.positions.length+(this.isPolygon?0:-1);c<g;c++)e.push(a(c));var u={dragHandlers:{onDragStart:function(t,e){this.index=t+1,r.positions.splice(this.index,0,e),r._createPrimitive=!0},onDrag:function(t,e){r.positions[this.index]=e,r._createPrimitive=!0},onDragEnd:function(t,e){s.insertBillboard(this.index,e,h),l.getBillboard(this.index-1).position=a(this.index-1),l.insertBillboard(this.index,a(this.index),u),r._createPrimitive=!0,o()}},tooltip:function(){return"Drag to create a new point"}};l.addBillboards(e,u),this._editMarkers=l,this._globeClickhandler=new S.ScreenSpaceEventHandler(i.canvas),this._globeClickhandler.setInputAction(function(t){var e=i.pick(t.position);e&&e.primitive||r.setEditMode(!1)},S.ScreenSpaceEventType.LEFT_CLICK),s.setOnTop(),l.setOnTop()}this._editMode=!0}else null!=this._markers&&(this._markers.remove(),this._editMarkers.remove(),this._markers=null,this._editMarkers=null,this._globeClickhandler.destroy()),this._editMode=!1}S.Billboard.prototype.setEditable=function(){if(!this._editable){this._editable=!0;var r=this,n=this;E(r,"leftDown",function(t){function i(t){e.destroy(),o(!0),n.executeListeners({name:"dragEnd",positions:t})}var e=new S.ScreenSpaceEventHandler(d._scene.canvas);e.setInputAction(function(t){var e=d._scene.camera.pickEllipsoid(t.endPosition,C);e?function(t){r.position=t,n.executeListeners({name:"drag",positions:t})}(e):i(e)},S.ScreenSpaceEventType.MOUSE_MOVE),e.setInputAction(function(t){i(d._scene.camera.pickEllipsoid(t.position,C))},S.ScreenSpaceEventType.LEFT_UP),o(!1)}),T(r)}function o(t){d._scene.screenSpaceCameraController.enableRotate=t}},M.PolylinePrimitive.prototype.setEditable=function(){if(!this.setEditMode){var t=this;t.isPolygon=!1,t.asynchronous=!1,d.registerEditableShape(t),t.setEditMode=i;var e=this.width;t.setHighlighted=function(t){!0!==this._editMode&&(t?(d.setHighlighted(this),this.setWidth(2*e)):this.setWidth(e))},t.getExtent=function(){return S.Extent.fromCartographicArray(C.cartesianArrayToCartographicArray(this.positions))},T(t),t.setEditMode(!1)}},M.PolygonPrimitive.prototype.setEditable=function(){var o=this;o.asynchronous=!1;var r=d._scene;d.registerEditableShape(o),o.setEditMode=function(t){if(this._editMode!=t)if(d.disableAllHighlights(),t){if(d.setEdited(this),null==this._markers){var n=new m.BillboardGroup(d,v);p.billBoard.push(n);var e={dragHandlers:{onDrag:function(t,e){var i=o.custom;i[t]=_(e);var r=xp.algorithm.doubleArrow(i);o.positions=r.polygonalPoint,o.custom=r.controlPoint,o._createPrimitive=!0,n.updateBillboardsPositions(w(o.custom))},onDragEnd:function(){o.executeListeners({name:"onEdited",positions:o.positions})}},tooltip:function(){return"拖动以钳击形状"}},i=o.custom;n.addBillboards(w(i),e),this._markers=n,this._globeClickhandler=new S.ScreenSpaceEventHandler(r.canvas),this._globeClickhandler.setInputAction(function(t){var e=r.pick(t.position);console.log("PolygonPrimitive单击"),e&&e.primitive||o.setEditMode(!1)},S.ScreenSpaceEventType.LEFT_CLICK),n.setOnTop()}this._editMode=!0}else null!=this._markers&&(this._markers.remove(),this._markers=null,this._globeClickhandler.destroy()),this._editMode=!1},o.setHighlighted=t,T(o),o.setEditMode(!1)},M.TailedAttackPrimitive.prototype.setEditable=function(){var o=this;o.asynchronous=!1;var r=d._scene;d.registerEditableShape(o),o.setEditMode=function(t){if(this._editMode!=t)if(d.disableAllHighlights(),t){if(d.setEdited(this),null==this._markers){var n=new m.BillboardGroup(d,v);p.billBoard.push(n);var e={dragHandlers:{onDrag:function(t,e){var i=o.custom;i[t]=_(e);var r=xp.algorithm.tailedAttackArrow(i);o.positions=r.polygonalPoint,o.custom=r.controlPoint,o._createPrimitive=!0,n.updateBillboardsPositions(w(o.custom))},onDragEnd:function(){o.executeListeners({name:"onEdited",positions:o.positions})}},tooltip:function(){return"拖动以改变形状"}},i=o.custom;n.addBillboards(w(i),e),this._markers=n,this._globeClickhandler=new S.ScreenSpaceEventHandler(r.canvas),this._globeClickhandler.setInputAction(function(t){var e=r.pick(t.position);console.log("TailedAttackPrimitive单击"),e&&e.primitive||o.setEditMode(!1)},S.ScreenSpaceEventType.LEFT_CLICK),n.setOnTop()}this._editMode=!0}else null!=this._markers&&(this._markers.remove(),this._markers=null,this._globeClickhandler.destroy()),this._editMode=!1},o.setHighlighted=t,T(o),o.setEditMode(!1)},M.ExtentPrimitive.prototype.setEditable=function(){if(!this.setEditMode){var a=this,i=d._scene;d.registerEditableShape(a),a.asynchronous=!1,a.setEditMode=function(t){if(this._editMode!=t)if(d.disableAllHighlights(),t){if(d.setEdited(this),null==this._markers){var o=new m.BillboardGroup(d,v);p.billBoard.push(o);var e={dragHandlers:{onDrag:function(t,e){var i=_(e),r=_(o.getBillboard((t+1)%2).position),n=0==t?y(i,r):y(r,i);a.setExtent(n),o.updateBillboardsPositions(I(a.extent))},onDragEnd:function(){a.executeListeners({name:"onEdited",extent:a.extent})}},tooltip:function(){return"拖动以改变此箭头形状"}};o.addBillboards(I(a.extent),e),this._markers=o,this._globeClickhandler=new S.ScreenSpaceEventHandler(i.canvas),this._globeClickhandler.setInputAction(function(t){var e=i.pick(t.position);console.log("ExtentPrimitive单击"),e&&e.primitive||a.setEditMode(!1)},S.ScreenSpaceEventType.LEFT_CLICK),o.setOnTop()}this._editMode=!0}else null!=this._markers&&(this._markers.remove(),this._markers=null,this._globeClickhandler.destroy()),this._editMode=!1},a.setHighlighted=t,T(a),a.setEditMode(!1)}}},m.DrawHelperWidget=function(t,e){if(!S.defined(e.container))throw new S.DeveloperError("Container is required");x(e,{markerIcon:"./img/glyphicons_242_google_maps.png",polylineIcon:"./img/glyphicons_097_vector_path_line.png",polygonIcon:"./img/qianjijiantou.png",circleIcon:"./img/glyphicons_095_vector_path_circle.png",tailedAttackArrowIcon:"./img/gongjijiantou.png",extentIcon:"./img/zhijiaojiantou.png",clearIcon:"./img/glyphicons_067_cleaning.png",polylineDrawingOptions:c,polygonDrawingOptions:a,extentDrawingOptions:l,circleDrawingOptions:h});var i=this,s=document.createElement("DIV");function r(t,e,i,r){var n=document.createElement("DIV");n.className="button",n.title=i,s.appendChild(n),n.onclick=r;var o=document.createElement("SPAN");n.appendChild(o);var a=document.createElement("IMG");return a.src=e,o.appendChild(a),n}s.className="toolbar",e.container.appendChild(s);var n=t._scene;r(0,e.extentIcon,"点击以绘制直箭头",function(){t.startDrawingExtent({callback:function(t){i.executeListeners({name:"extentCreated",extent:t})}})}),r(0,e.polygonIcon,"点击以绘制钳击箭头",function(){t.startDrawingPolygon({callback:function(t,e){i.executeListeners({name:"polygonCreated",positions:t,custom:e})}})}),r(0,e.tailedAttackArrowIcon,"点击以绘制攻击箭头",function(){t.startDrawingTailedAttack({callback:function(t,e){i.executeListeners({name:"tailedAttackCreated",positions:t,custom:e})}})});var o=document.createElement("DIV");o.className="divider",s.appendChild(o),r(0,e.clearIcon,"Remove all primitives",function(){for(var t=p.primitives.length,e=p.billBoard.length,i=0;i<t;i++){var r=p.primitives.pop();r._globeClickhandler.destroy(),n.primitives.remove(r)}for(i=0;i<e;i++)p.billBoard.pop().remove()}),T(this)},m.prototype.addToolbar=function(t,e){return e=b(e,{container:t}),new m.DrawHelperWidget(this,e)},m.DrawWidget=function(t,e){var i=this;"extentCreated"==e&&t.startDrawingExtent({callback:function(t){i.executeListeners({name:"extentCreated",extent:t})}}),"polygonCreated"==e&&t.startDrawingPolygon({callback:function(t,e){i.executeListeners({name:"polygonCreated",positions:t,custom:e})}}),"tailedAttackCreated"==e&&t.startDrawingTailedAttack({callback:function(t,e){i.executeListeners({name:"tailedAttackCreated",positions:t,custom:e})}}),T(this)},m.ClearWidget=function(){var t=drawHelper._scene,e=p.primitives.length,i=p.billBoard.length;if(0!=e&&p.primitives[e-1]._editMode){for(var r=0;r<1;r++){var n=p.primitives[e-1];n._globeClickhandler.destroy(),t.primitives.remove(n)}for(r=0;r<1;r++)p.billBoard[i-1].remove();p={billBoard:[],primitives:[]},T(this)}},m.prototype.active=function(t){return new m.DrawWidget(this,t)},m.prototype.clear=function(){return new m.ClearWidget(this)};function d(t,e){if(null==t||"object"!=(void 0===t?"undefined":_typeof(t)))return t;if(t.constructor!=Object&&t.constructor!=Array)return t;if(t.constructor==Date||t.constructor==RegExp||t.constructor==Function||t.constructor==String||t.constructor==Number||t.constructor==Boolean)return new t.constructor(t);for(var i in e=e||new t.constructor,t)e[i]=void 0===e[i]?d(t[i],null):e[i];return e}function x(t,e){var i;for(i in t=t||{},e)void 0===t[i]&&(t[i]=d(e[i]))}function b(t,e){var i,r=d(t);for(i in e)void 0===r[i]&&(r[i]=d(e[i]));return r}function E(t,e,i){t[e]=i}function T(t){t._listeners={},t.addListener=function(t,e){return this._listeners[t]=this._listeners[t]||[],this._listeners[t].push(e),this._listeners[t].length},t.executeListeners=function(t,e){if(this._listeners[t.name]&&0<this._listeners[t.name].length)for(var i=0;i<this._listeners[t.name].length;i++)this._listeners[t.name][i](t);else e&&e(t)}}return m}()}(window.Cesium);var P={version:"1.0.0",PlotUtils:{}};if(P.PlotUtils.distance=function(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))},P.PlotUtils.wholeDistance=function(t){for(var e=0,i=0;i<t.length-1;i++)e+=P.PlotUtils.distance(t[i],t[i+1]);return e},P.PlotUtils.getBaseLength=function(t){return Math.pow(P.PlotUtils.wholeDistance(t),.99)},P.PlotUtils.mid=function(t,e){return[(t[0]+e[0])/2,(t[1]+e[1])/2]},P.PlotUtils.getCircleCenterOfThreePoints=function(t,e,i){var r=[(t[0]+e[0])/2,(t[1]+e[1])/2],n=[r[0]-t[1]+e[1],r[1]+t[0]-e[0]],o=[(t[0]+i[0])/2,(t[1]+i[1])/2],a=[o[0]-t[1]+i[1],o[1]+t[0]-i[0]];return P.PlotUtils.getIntersectPoint(r,n,o,a)},P.PlotUtils.getIntersectPoint=function(t,e,i,r){if(t[1]==e[1]){var n=(r[0]-i[0])/(r[1]-i[1]),o=n*(t[1]-i[1])+i[0],a=t[1];return[o,a]}if(i[1]!=r[1])return s=(e[0]-t[0])/(e[1]-t[1]),n=(r[0]-i[0])/(r[1]-i[1]),[o=s*(a=(s*t[1]-t[0]-n*i[1]+i[0])/(s-n))-s*t[1]+t[0],a];var s=(e[0]-t[0])/(e[1]-t[1]);return[o=s*(i[1]-t[1])+t[0],a=i[1]]},P.PlotUtils.getAzimuth=function(t,e){var i,r=Math.asin(Math.abs(e[1]-t[1])/P.PlotUtils.distance(t,e));return e[1]>=t[1]&&e[0]>=t[0]?i=r+Math.PI:e[1]>=t[1]&&e[0]<t[0]?i=P.Constants.TWO_PI-r:e[1]<t[1]&&e[0]<t[0]?i=r:e[1]<t[1]&&e[0]>=t[0]&&(i=Math.PI-r),i},P.PlotUtils.getAngleOfThreePoints=function(t,e,i){var r=P.PlotUtils.getAzimuth(e,t)-P.PlotUtils.getAzimuth(e,i);return r<0?r+P.Constants.TWO_PI:r},P.PlotUtils.isClockWise=function(t,e,i){return(i[1]-t[1])*(e[0]-t[0])>(e[1]-t[1])*(i[0]-t[0])},P.PlotUtils.getPointOnLine=function(t,e,i){return[e[0]+t*(i[0]-e[0]),e[1]+t*(i[1]-e[1])]},P.PlotUtils.getCubicValue=function(t,e,i,r,n){var o=1-(t=Math.max(Math.min(t,1),0)),a=t*t,s=a*t,l=o*o,h=l*o;return[h*e[0]+3*l*t*i[0]+3*o*a*r[0]+s*n[0],h*e[1]+3*l*t*i[1]+3*o*a*r[1]+s*n[1]]},P.PlotUtils.getThirdPoint=function(t,e,i,r,n){var o=P.PlotUtils.getAzimuth(t,e),a=n?o+i:o-i,s=r*Math.cos(a),l=r*Math.sin(a);return[e[0]+s,e[1]+l]},P.PlotUtils.getArcPoints=function(t,e,i,r){var n,o,a=[],s=r-i;s=s<0?s+P.Constants.TWO_PI:s;for(var l=0;l<=P.Constants.FITTING_COUNT;l++){var h=i+s*l/P.Constants.FITTING_COUNT;n=t[0]+e*Math.cos(h),o=t[1]+e*Math.sin(h),a.push([n,o])}return a},P.PlotUtils.getBisectorNormals=function(t,e,i,r){var n=P.PlotUtils.getNormal(e,i,r),o=Math.sqrt(n[0]*n[0]+n[1]*n[1]),a=n[0]/o,s=n[1]/o,l=P.PlotUtils.distance(e,i),h=P.PlotUtils.distance(i,r);if(o>P.Constants.ZERO_TOLERANCE)if(P.PlotUtils.isClockWise(e,i,r)){var c=t*l,g=i[0]-c*s,u=i[1]+c*a,d=[g,u];c=t*h;var p=[g=i[0]+c*s,u=i[1]-c*a]}else c=t*l,d=[g=i[0]+c*s,u=i[1]-c*a],c=t*h,p=[g=i[0]-c*s,u=i[1]+c*a];else d=[g=i[0]+t*(e[0]-i[0]),u=i[1]+t*(e[1]-i[1])],p=[g=i[0]+t*(r[0]-i[0]),u=i[1]+t*(r[1]-i[1])];return[d,p]},P.PlotUtils.getNormal=function(t,e,i){var r=t[0]-e[0],n=t[1]-e[1],o=Math.sqrt(r*r+n*n);r/=o,n/=o;var a=i[0]-e[0],s=i[1]-e[1],l=Math.sqrt(a*a+s*s);return[r+(a/=l),n+(s/=l)]},P.PlotUtils.getCurvePoints=function(t,e){for(var i=[P.PlotUtils.getLeftMostControlPoint(e)],r=0;r<e.length-2;r++){var n=e[r],o=e[r+1],a=e[r+2],s=P.PlotUtils.getBisectorNormals(t,n,o,a);i=i.concat(s)}var l=P.PlotUtils.getRightMostControlPoint(e);i.push(l);var h=[];for(r=0;r<e.length-1;r++){n=e[r],o=e[r+1],h.push(n);for(t=0;t<P.Constants.FITTING_COUNT;t++){var c=P.PlotUtils.getCubicValue(t/P.Constants.FITTING_COUNT,n,i[2*r],i[2*r+1],o);h.push(c)}h.push(o)}return h},P.PlotUtils.getLeftMostControlPoint=function(e){var i=e[0],r=e[1],n=e[2],o=P.PlotUtils.getBisectorNormals(0,i,r,n)[0],a=P.PlotUtils.getNormal(i,r,n);if(Math.sqrt(a[0]*a[0]+a[1]*a[1])>P.Constants.ZERO_TOLERANCE)var s=P.PlotUtils.mid(i,r),l=i[0]-s[0],h=i[1]-s[1],c=2/P.PlotUtils.distance(i,r),g=-c*h,u=c*l,d=g*g-u*u,p=2*g*u,C=u*u-g*g,m=o[0]-s[0],f=o[1]-s[1],v=s[0]+d*m+p*f,A=s[1]+p*m+C*f;else v=i[0]+t*(r[0]-i[0]),A=i[1]+t*(r[1]-i[1]);return[v,A]},P.PlotUtils.getRightMostControlPoint=function(e){var i=e.length,r=e[i-3],n=e[i-2],o=e[i-1],a=P.PlotUtils.getBisectorNormals(0,r,n,o)[1],s=P.PlotUtils.getNormal(r,n,o);if(Math.sqrt(s[0]*s[0]+s[1]*s[1])>P.Constants.ZERO_TOLERANCE)var l=P.PlotUtils.mid(n,o),h=o[0]-l[0],c=o[1]-l[1],g=2/P.PlotUtils.distance(n,o),u=-g*c,d=g*h,p=u*u-d*d,C=2*u*d,m=d*d-u*u,f=a[0]-l[0],v=a[1]-l[1],A=l[0]+p*f+C*v,I=l[1]+C*f+m*v;else A=o[0]+t*(n[0]-o[0]),I=o[1]+t*(n[1]-o[1]);return[A,I]},P.PlotUtils.getBezierPoints=function(t){if(t.length<=2)return t;for(var e=[],i=t.length-1,r=0;r<=1;r+=.01){for(var n=y=0,o=0;o<=i;o++){var a=P.PlotUtils.getBinomialFactor(i,o),s=Math.pow(r,o),l=Math.pow(1-r,i-o);n+=a*s*l*t[o][0],y+=a*s*l*t[o][1]}e.push([n,y])}return e.push(t[i]),e},P.PlotUtils.getBinomialFactor=function(t,e){return P.PlotUtils.getFactorial(t)/(P.PlotUtils.getFactorial(e)*P.PlotUtils.getFactorial(t-e))},P.PlotUtils.getFactorial=function(t){if(t<=1)return 1;if(2==t)return 2;if(3==t)return 6;if(4==t)return 24;if(5==t)return 120;for(var e=1,i=1;i<=t;i++)e*=i;return e},P.PlotUtils.getQBSplinePoints=function(t){if(t.length<=2)return t;var e=[],i=t.length-2-1;e.push(t[0]);for(var r=0;r<=i;r++)for(var n=0;n<=1;n+=.05){for(var o=y=0,a=0;a<=2;a++){var s=P.PlotUtils.getQuadricBSplineFactor(a,n);o+=s*t[r+a][0],y+=s*t[r+a][1]}e.push([o,y])}return e.push(t[t.length-1]),e},P.PlotUtils.getQuadricBSplineFactor=function(t,e){return 0==t?Math.pow(e-1,2)/2:1==t?(-2*Math.pow(e,2)+2*e+1)/2:2==t?Math.pow(e,2)/2:0},P.Constants={TWO_PI:2*Math.PI,HALF_PI:Math.PI/2,FITTING_COUNT:100,ZERO_TOLERANCE:1e-4},function(g){var t=g.MeasureAreaWidget=function(t,e){this.viewer=t.viewer,this.color=t.color?t.color:g.Color.CHARTREUSE.withAlpha(.5),this.lineWidth=t.lineWidth?t.lineWidth:2,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.ellipsoid=this.scene.globe.ellipsoid,this.count=0,this.entityNames=[],this.labelNames=[],this.mode=t.mode?t.mode:1};function u(t,e,i,r){var n=t.add(new g.LabelCollection);n.name="result_labelArea"+r,n.add({text:e,font:"16px sans-serif",showBackground:!0,disableDepthTestDistance:Number.POSITIVE_INFINITY}),n.get(n.length-1).position=i[i.length-1]}function i(t,e){for(var i=0;i<e.length;i++)void 0!==e.get(i).name&&-1<e.get(i).name.indexOf(t)&&(e.remove(e.get(i)),i--)}function r(t,e){for(var i=e.values,r=0;r<i.length;r++)-1<i[r].name.indexOf(t)&&(e.remove(i[r]),r--)}t.prototype.activate=function(){if(this.handler=this.handler&&this.handler.destroy(),!this.handler){this.handler=new g.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var n,o,r,a=this,s=[];this._array_=s,this._polylines_=n,this._labels_=o,this.handler.setInputAction(function(t){if(a.lastP=t,1==a.mode)var e=a.camera.getPickRay(t.position),i=a.scene.globe.pick(e,a.scene);else i=a.scene.pickPosition(t.position);i&&(s.push(i),1==s.length&&((n=a.primitives.add(new g.PolylineCollection)).name="draw_polyline",n.add({polyline:{}}),n.get(n.length-1).width=a.lineWidth,n.get(n.length-1).loop=!0,n.get(n.length-1).material.uniforms.color=a.color,n.get(n.length-1).positions=s),3<=s.length&&(n.get(n.length-1).positions=s,/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent)&&a.measureEnd()),a._polylines_=n,/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent)&&((r=a.primitives.add(new g.PointPrimitiveCollection)).name="draw_point",r.add({position:i,color:g.Color.WHITE,outlineColor:g.Color.RED,outlineWidth:1,pixelSize:5})))},g.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(t){if(!/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent)){if(1==a.mode)var e=a.camera.getPickRay(t.endPosition),i=a.scene.globe.pick(e,a.scene);else i=a.scene.pickPosition(t.endPosition);if(!i)return void(o&&(a.primitives.remove(o),o=null));if(1<=s.length){var r=s.concat();r.push(i),n.get(n.length-1).positions=r}o||((o=a.primitives.add(new g.LabelCollection)).name="draw_label",o.add({text:"左键单击开始绘制，右键单击结束绘制",font:"16px sans-serif",showBackground:!0,pixelOffset:new g.Cartesian2(10,10),disableDepthTestDistance:Number.POSITIVE_INFINITY})),o.get(o.length-1).position=i,a._labels_=o}},g.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(t){a.measureEnd(),a.handler=a.handler&&a.handler.destroy(),a.viewer.canvas.style.cursor="default"},g.ScreenSpaceEventType.RIGHT_CLICK)}},t.prototype.selectFeatures=function(t){this.handler=this.handler&&this.handler.destroy(),this.handler=new g.ScreenSpaceEventHandler(this.canvas);var n=this;this.handler.setInputAction(function(t){var e=n.viewer.scene.pick(new g.Cartesian2(t.position.x,t.position.y));if(null!=e&&null!=e.id&&null!=e.id.polygon){e.id.polygon.material.color=g.Color.CHARTREUSE;var i=e.id.name,r=i.replace(/draw_polygon/,"result_labelArea");n.entityNames.push(i),n.labelNames.push(r)}},g.ScreenSpaceEventType.LEFT_CLICK)},t.prototype.delete=function(){this.handler=this.handler&&this.handler.destroy();for(var t=0;t<this.entityNames.length;t++)r(this.entityNames[t],this.viewer.entities);for(var e=0;e<this.labelNames.length;e++)i(this.labelNames[e],this.primitives);this.count=0,this.entityNames=[],this.labelNames=[]},t.prototype.measureEnd=function(t){if(null!=this._array_&&0!=this._array_.length){if(this._labels_&&(this.primitives.remove(this._labels_),this._labels_=null),t=t||this.lastP,1==this.mode)var e=this.camera.getPickRay(t.position),i=this.scene.globe.pick(e,this.scene);else i=this.scene.pickPosition(t.position);if(i){this._array_.push(i),this._polylines_.get(this._polylines_.length-1).material.uniforms.color=g.Color.CHARTREUSE.withAlpha(0),this.viewer.entities.add({name:"draw_polygon"+this.count,polygon:{hierarchy:{positions:this._array_},material:this.color,perPositionHeight:!1}});for(var r=[],n=0;n<this._array_.length;n++){var o=g.Cartographic.fromCartesian(this._array_[n]),a=g.Math.toDegrees(o.longitude),s=g.Math.toDegrees(o.latitude);r.push([a,s])}r.push(r[0]);var l,h=turf.polygon([r]),c=turf.area(h);l=c<1e6?"总面积："+c.toFixed(2)+"m²":"总面积："+(c/1e6).toFixed(2)+"km²",/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent)?(4<this.primitives.length&&this.primitives.remove(this.primitives.get(this.primitives.length-2)),u(this.primitives,l,this._array_)):(u(this.primitives,l,this._array_,this.count),this.count++)}}},t.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",i("result_labelArea",this.primitives),i("draw_label",this.primitives),i("draw_polyline",this.primitives),r("draw_polygon",this.viewer.entities)}}(window.Cesium),function(v){var t=v.MeasureDistanceWidget=function(t,e){this.viewer=t.viewer,this.color=t.color?t.color:v.Color.CHARTREUSE.withAlpha(.5),this.lineWidth=t.lineWidth?t.lineWidth:2,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.entities=this.viewer.entities,this.ellipsoid=this.scene.globe.ellipsoid,this.mode=t.mode?t.mode:1,this.count=0,this.tags=[]};function e(t,e){for(var i=0;i<e.length;i++)e.get(i).name==t&&(e.remove(e.get(i)),i--)}function i(t,e){for(var i=0;i<e.length;i++)e.get(i).tag==t&&(e.remove(e.get(i)),i--)}function r(t,e){for(var i=e.values,r=0;r<i.length;r++)i[r].tag==t&&(e.remove(i[r]),r--)}t.prototype.activate=function(){var l=this;l.count++,this.handler=new v.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var h,c,s,g=[];this._array_=g,this._polylines_=h,this._labels_=c,this.handler.setInputAction(function(t){if(l.lastP=t,3==l.mode)var e=l.scene.pickPosition(t.position);else{var i=l.camera.getPickRay(t.position);e=l.scene.globe.pick(i,l.scene)}if(e){var r=v.Cartographic.fromCartesian(e),n=v.Math.toDegrees(r.longitude),o=v.Math.toDegrees(r.latitude),a=r.height;g.push(n),g.push(o),g.push(a),3==g.length&&((h=l.primitives.add(new v.PolylineCollection)).tag=l.mode+"_"+l.count,h.name="draw_polyline",h.add({polyline:{}}),h.get(h.length-1).width=l.lineWidth,h.get(h.length-1).material.uniforms.color=l.color,h.get(h.length-1).positions=v.Cartesian3.fromDegreesArrayHeights(g)),3<g.length&&(h.get(h.length-1).positions=v.Cartesian3.fromDegreesArrayHeights(g)),l._polylines_=h,(s=l.primitives.add(new v.PointPrimitiveCollection)).tag=l.mode+"_"+l.count,s.name="draw_point",s.add({position:e,color:v.Color.WHITE,outlineColor:v.Color.RED,outlineWidth:1,pixelSize:l.pixelSize}),l.flag=!1,l.measureEnd(t)}},v.ScreenSpaceEventType.LEFT_DOWN),this.handler.setInputAction(function(t){if(3==l.mode)var e=l.scene.pickPosition(t.endPosition);else{var i=l.camera.getPickRay(t.endPosition);e=l.scene.globe.pick(i,l.scene)}if(!e)return console.log("!cartesian"),void(c&&(l.primitives.remove(c),c=null));var r=v.Cartographic.fromCartesian(e),n=v.Math.toDegrees(r.longitude),o=v.Math.toDegrees(r.latitude),a=r.height;if(/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent))c=null;else{if(3<=g.length){var s=g.concat();s.push(n),s.push(o),s.push(a),h.get(h.length-1).positions=v.Cartesian3.fromDegreesArrayHeights(s)}c&&0!=c.length||((c=l.primitives.add(new v.LabelCollection)).name="draw_label",c.tag=l.mode+"_"+l.count,c.add({text:"左键单击开始绘制，右键单击结束绘制",font:"16px sans-serif",showBackground:!0,pixelOffset:new v.Cartesian2(10,10),disableDepthTestDistance:Number.POSITIVE_INFINITY})),c.get(c.length-1).position=v.Cartesian3.fromDegrees(n,o,a)}l._labels_=c},v.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(t){if(l.flag=!0,t=l.lastP,3==l.mode)var e=l.scene.pickPosition(t.position);else{var i=l.camera.getPickRay(t.position);e=l.scene.globe.pick(i,l.scene)}if(e){var r=v.Cartographic.fromCartesian(e),n=v.Math.toDegrees(r.longitude),o=v.Math.toDegrees(r.latitude),a=r.height;(s=l.primitives.add(new v.PointPrimitiveCollection)).tag=l.mode+"_"+l.count,s.name="draw_point",s.add({position:e,color:v.Color.WHITE,outlineColor:v.Color.RED,outlineWidth:1,pixelSize:l.pixelSize}),l._array_.push(n),l._array_.push(o),l._array_.push(a),l.measureEnd(t),l.handler=l.handler&&l.handler.destroy(),l.viewer.canvas.style.cursor="default",l._array_=[],l._polylines_=null}},v.ScreenSpaceEventType.RIGHT_CLICK)},t.prototype.measureEnd=function(t){if(null!=this._array_&&0!=this._array_.length){if(/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent))this._array_=this._array_;else if(!t){console.log("点击按钮结束绘制"),t=this.lastP;var e=this.camera.getPickRay(t.position),i=this.scene.globe.pick(e,this.scene);if(!i)return;var r=v.Cartographic.fromCartesian(i),n=v.Math.toDegrees(r.longitude),o=v.Math.toDegrees(r.latitude),a=r.height;this._array_[this._array_.length-1]==a&&this._array_[this._array_.length-2]==o&&this._array_[this._array_.length-3]==n?this._array_=this._array_:(this._array_.push(n),this._array_.push(o),this._array_.push(a))}this._labels_&&(this.primitives.remove(this._labels_),this._labels_=null);var s=this.mode;if(2==this.mode){var l=function(t,e){for(var i=[],r=0;r<t.length/3-1;r++){var n=3*r,o=t[n],a=t[1+n],s=t[2+n],l=t[3+n],h=t[4+n],c=t[5+n];i.push(o),i.push(a),i.push(s);for(var g=0;g<100;g++){var u={longitude:v.Math.toRadians(o),latitude:v.Math.toRadians(a),height:s},d={longitude:v.Math.toRadians(l),latitude:v.Math.toRadians(h),height:c},p=v.Math.lerp(u.longitude,d.longitude,.01*(g+1)),C=v.Math.lerp(u.latitude,d.latitude,.01*(g+1)),m={longitude:p,latitude:C},f=e.globe.getHeight(m);i.push(v.Math.toDegrees(p)),i.push(v.Math.toDegrees(C)),i.push(f)}i.push(l),i.push(h),i.push(c)}return i}(this._array_,this.scene);this._polylines_.get(this._polylines_.length-1).material.uniforms.color=v.Color.CHARTREUSE.withAlpha(0),this.viewer.entities.add({tag:this.mode+"_"+this.count,name:"draw_polyline",polyline:{positions:v.Cartesian3.fromDegreesArrayHeights(l),width:this.lineWidth,material:this.color}})}var h,c=v.Cartesian3.fromDegreesArrayHeights(v.defined(l)?l:this._array_),g=0;new v.EllipsoidGeodesic;if(1==s||3==s){for(var u=1;u<c.length;u++)g+=v.Cartesian3.distance(c[u-1],c[u]);h=0==g?"起点":0<g&&g<1e3?this.flag?"总长："+g.toFixed(2)+"m":g.toFixed(2)+"m":this.flag?"总长："+(g/1e3).toFixed(2)+"km":(g/1e3).toFixed(2)+"km"}else if(2==s){for(u=1;u<c.length;u++)g+=v.Cartesian3.distance(c[u-1],c[u]);h=0==g?"起点":0<g&&g<1e3?this.flag?"总长："+g.toFixed(2)+"m":g.toFixed(2)+"m":this.flag?"总长："+(g/1e3).toFixed(2)+"km":(g/1e3).toFixed(2)+"km"}!function(t,e,i,r,n){var o=i.add(new v.LabelCollection);o.name="result_label",o.tag=t+"_"+e,o.add({text:r,font:"16px sans-serif",showBackground:!0,backgroundColor:new v.Color(1,0,0,.3),pixelOffset:new v.Cartesian2(10,10),disableDepthTestDistance:Number.POSITIVE_INFINITY}),o.get(o.length-1).position=n[n.length-1],3<i.length&&"result_label"==i._primitives[i.length-3].name&&(i._primitives[i.length-3]._labels[0].backgroundColor=new v.Color(0,1,0,.3))}(s,this.count,this.primitives,h,c)}},t.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",e("draw_point",this.primitives),e("result_label",this.primitives),e("draw_label",this.primitives),e("draw_polyline",this.primitives),function(t,e){for(var i=e.values,r=0;r<i.length;r++)i[r].name==t&&(e.remove(i[r]),r--)}("draw_polyline",this.viewer.entities)},t.prototype.selectFeatures=function(){var i=this;this.handler||(this.handler=new v.ScreenSpaceEventHandler(this.canvas),this.handler.setInputAction(function(t){var e=viewer.scene.pick(t.position);e&&(e.primitive._polylineCollection&&(i.tags.push(e.primitive._polylineCollection.tag),e.primitive.material.uniforms.color=v.Color.YELLOW.withAlpha(.5)),e.id&&e.id._polyline&&(i.tags.push(e.id.tag),e.id._polyline.material.color=v.Color.YELLOW.withAlpha(.5)))},v.ScreenSpaceEventType.LEFT_CLICK))},t.prototype.delete=function(t){if(this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",this.tags&&0<this.tags.length)for(var e=0;e<this.tags.length;e++)i(this.tags[e],this.primitives),r(this.tags[e],this.viewer.entities)}}(window.Cesium),function(l){var t=l.MeasureElevationWidget=function(t,e){this.viewer=t.viewer,this.color=t.color?t.color:l.Color.YELLOW,this.pixelSize=t.pixelSize?t.pixelSize:10,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.ellipsoid=this.scene.globe.ellipsoid,this.count=0,this.tags=[],this.mode=t.mode?t.mode:1};function e(t,e){for(var i=0;i<e.length;i++)e.get(i).name==t&&(e.remove(e.get(i)),i--)}function i(t,e){for(var i=0;i<e.length;i++)e.get(i).tag==t&&(e.remove(e.get(i)),i--)}t.prototype.activate=function(){this.count++,this.handler&&(this.handler=this.handler&&this.handler.destroy()),this.handler=new l.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var n,o,a=this,s=[];this.handler.setInputAction(function(t){if(2==a.mode)var e=a.scene.pickPosition(t.position);else{var i=a.camera.getPickRay(t.position);e=a.scene.globe.pick(i,a.scene)}if(e){s[0]=e,n?n.removeAll():((n=a.primitives.add(new l.PointPrimitiveCollection)).tag=a.count,n.name="draw_point"),n.add({position:e,color:a.color,pixelSize:a.pixelSize}),a.handler=a.handler&&a.handler.destroy(),a.viewer.canvas.style.cursor="default",o&&(a.primitives.remove(o),o=null);var r="高程值："+l.Cartographic.fromCartesian(s[0]).height.toFixed(2)+"m";!function(t,e,i,r){var n=t.add(new l.LabelCollection);n.name="result_label",n.tag=r,n.add({text:e,font:"16px sans-serif",showBackground:!0,pixelOffset:new l.Cartesian2(6,2),disableDepthTestDistance:Number.POSITIVE_INFINITY}),n.get(n.length-1).position=i[i.length-1]}(a.primitives,r,s,a.count)}},l.ScreenSpaceEventType.LEFT_DOWN)},t.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",e("result_label",this.primitives),e("draw_point",this.primitives)},t.prototype.selectFeatures=function(){var i=this;this.handler||(this.handler=new l.ScreenSpaceEventHandler(this.canvas),this.handler.setInputAction(function(t){var e=viewer.scene.pick(t.position);"draw_point"===e.collection.name?e.primitive&&(i.tags.push(e.collection.tag),e.primitive.color=l.Color.YELLOW.withAlpha(.5)):alert("您选择的不是高程点！")},l.ScreenSpaceEventType.LEFT_CLICK))},t.prototype.delete=function(t){if(this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",this.tags&&0<this.tags.length)for(var e=0;e<this.tags.length;e++)i(this.tags[e],this.primitives)}}(window.Cesium),function(g){var t=g.MeasureHeightWidget=function(t,e){this.viewer=t.viewer,this.color=t.color?t.color:g.Color.CHARTREUSE.withAlpha(.5),this.lineWidth=t.lineWidth?t.lineWidth:2,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.ellipsoid=this.scene.globe.ellipsoid,this.callback=e||function(){},this.count=0,this.entityNames=[],this.labelNames=[],this.pointNames=[],this.mode=t.mode?t.mode:1};function l(t,e,i,r){var n=t.add(new g.LabelCollection);n.name="result_labelHeight"+r,n.add({text:e,font:"16px sans-serif",showBackground:!0,disableDepthTestDistance:Number.POSITIVE_INFINITY}),n.get(n.length-1).position=g.Cartesian3.fromDegrees(i[i.length-3],i[i.length-2],i[i.length-1])}function e(t,e){for(var i=0;i<e.length;i++)void 0!==e.get(i).name&&-1<e.get(i).name.indexOf(t)&&(e.remove(e.get(i)),i--)}function r(t,e){for(var i=0;i<e.length;i++)e.get(i).name==t&&(e.remove(e.get(i)),i--)}t.prototype.activate=function(){if(this.handler=this.handler&&this.handler.destroy(),!this.handler){this.handler=new g.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var s,l,h=this,c=[];this._array_=c,this._polylines_=s,this._labels_=void 0,this.handler.setInputAction(function(t){if(2==h.mode)var e=h.scene.pickPosition(t.position);else{var i=h.camera.getPickRay(t.position);e=h.scene.globe.pick(i,h.scene)}if(e){var r=g.Cartographic.fromCartesian(e),n=g.Math.toDegrees(r.longitude),o=g.Math.toDegrees(r.latitude),a=r.height;0<c.length&&(9==c.length&&(c[3]=n,c[4]=o,c[5]=a,c[2]>=c[5]?(c[6]=c[0],c[7]=c[1],c[8]=c[5]):(c[6]=c[3],c[7]=c[4],c[8]=c[2]),s.get(s.length-1).positions=g.Cartesian3.fromDegreesArrayHeights(c)),(l=h.primitives.add(new g.PointPrimitiveCollection)).name="draw_point"+h.count,l.add({position:e,color:h.color,pixelSize:h.pixelSize}),h._array_=c,h.measureEnd()),0==c.length&&(c.push(n),c.push(o),c.push(a),c.push(n),c.push(o),c.push(a),c.push(n),c.push(o),c.push(a),(s=h.primitives.add(new g.PolylineCollection)).name="draw_polyline"+h.count,s.add({polyline:{}}),s.get(s.length-1).width=h.lineWidth,s.get(s.length-1).loop=!0,s.get(s.length-1).material.uniforms.color=h.color,s.get(s.length-1).positions=g.Cartesian3.fromDegreesArrayHeights(c),(l=h.primitives.add(new g.PointPrimitiveCollection)).name="draw_point"+h.count,l.add({position:e,color:h.color,pixelSize:h.pixelSize}))}},g.ScreenSpaceEventType.LEFT_CLICK)}},t.prototype.selectFeatures=function(t){this.handler=this.handler&&this.handler.destroy(),this.handler=new g.ScreenSpaceEventHandler(this.canvas);var o=this;this.handler.setInputAction(function(t){var e=o.viewer.scene.pick(t.position);if(null!=e){if(null!=e.collection&&null!=e.collection.name&&null!=e.primitive&&null!=e.primitive.material){e.primitive.material.uniforms.color=g.Color.CHARTREUSE;var i=e.collection.name,r=i.replace(/draw_polyline/,"result_labelHeight"),n=i.replace(/draw_polyline/,"draw_point");o.entityNames.push(i),o.labelNames.push(r),o.pointNames.push(n)}}else alert("没有选中目标")},g.ScreenSpaceEventType.LEFT_CLICK)},t.prototype.delete=function(t){this.handler=this.handler&&this.handler.destroy();for(var e=0;e<this.entityNames.length;e++)r(this.entityNames[e],this.primitives);for(var i=0;i<this.labelNames.length;i++)r(this.labelNames[i],this.primitives);for(i=0;i<this.pointNames.length;i++)r(this.pointNames[i],this.primitives);this.count=0,this.entityNames=[],this.labelNames=[],this.pointNames=[]},t.prototype.measureEnd=function(){var t;this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",this._labels_&&(this.primitives.remove(this._labels_),this._labels_=null),(a=[]).push((this._array_[0]+this._array_[3])/2),a.push((this._array_[1]+this._array_[4])/2),t=this._array_[2]>=this._array_[5]?(a.push(this._array_[5]),this._array_[5]):(a.push(this._array_[2]),this._array_[2]);var e=g.Cartesian3.fromDegrees(this._array_[0],this._array_[1],t),i=g.Cartesian3.fromDegrees(this._array_[3],this._array_[4],t),r=g.Cartesian3.distance(e,i);n=r<1e3?"水平距离："+r.toFixed(2)+"m":"水平距离："+(r/1e3).toFixed(2)+"km",l(this.primitives,n,a,this.count);var n,o=Math.abs(this._array_[2]-this._array_[5]),a=[];this._array_[2]>=this._array_[5]?(a.push(this._array_[0]),a.push(this._array_[1])):(a.push(this._array_[3]),a.push(this._array_[4])),a.push((this._array_[2]+this._array_[5])/2),n=o<1e3?"垂直高度："+o.toFixed(2)+"m":"垂直高度："+(o/1e3).toFixed(2)+"km",l(this.primitives,n,a,this.count),(a=[]).push((this._array_[0]+this._array_[3])/2),a.push((this._array_[1]+this._array_[4])/2),a.push((this._array_[2]+this._array_[5])/2);var s=Math.sqrt(Math.pow(r,2)+Math.pow(o,2));n=s<1e3?"空间距离："+s.toFixed(2)+"m":"空间距离："+(s/1e3).toFixed(2)+"km",l(this.primitives,n,a,this.count),this.count++,this.callback(r,o,s,this._array_)},t.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",e("result_labelHeight",this.primitives),e("draw_label",this.primitives),e("draw_polyline",this.primitives),e("draw_point",this.primitives)}}(window.Cesium),function(a){function t(t,e){if(!a.defined(t))throw new DeveloperError("viewer is required.");e=a.defaultValue(e,a.defaultValue.EMPTY_OBJECT),this._viewer=t,this._isEnable=a.defaultValue(e.isEnable,!0),this._splitDirection=a.defaultValue(e.splitDirection,a.ImagerySplitDirection.LEFT),this._slider=function(r){var n=document.createElement("div");n.className="geo-split-slider",r.container.appendChild(n);var t=new a.ScreenSpaceEventHandler(n),o=!1;function e(t){if(o){var e=t.endPosition.x,i=(n.offsetLeft+e)/n.parentElement.offsetWidth;n.style.left=100*i+"%",r.scene.imagerySplitPosition=i}}return t.setInputAction(function(){o=!0},a.ScreenSpaceEventType.LEFT_DOWN),t.setInputAction(function(){o=!0},a.ScreenSpaceEventType.PINCH_START),t.setInputAction(e,a.ScreenSpaceEventType.MOUSE_MOVE),t.setInputAction(e,a.ScreenSpaceEventType.PINCH_MOVE),t.setInputAction(function(){o=!1},a.ScreenSpaceEventType.LEFT_UP),t.setInputAction(function(){o=!1},a.ScreenSpaceEventType.PINCH_END),n}(t),this.updateImagerySplitPosition()}t.prototype.enableLayers=function(t){for(var e=a.defaultValue(t,[]),i=e.length-1;0<=i;i--){e[i].splitDirection=this._splitDirection}},t.prototype.updateImagerySplitPosition=function(){var t=this._viewer,e=this._slider;t.scene.imagerySplitPosition=e.offsetLeft/e.parentElement.offsetWidth},a.GeoSplitSliderWidget=t}(window.Cesium),function(n){n.Map=function(t,e){if((e=e||{}).baseLayerPicker=n.defaultValue(e.baseLayerPicker,!1),e.timeline=n.defaultValue(e.timeline,!1),e.animation=n.defaultValue(e.animation,!1),e.homeButton=n.defaultValue(e.homeButton,!1),e.navigationHelpButton=n.defaultValue(e.navigationHelpButton,!1),e.orderIndependentTranslucency=n.defaultValue(e.orderIndependentTranslucency,!0),e.sceneMode=n.defaultValue(e.sceneMode,n.SceneMode.SCENE3D),e.scene3DOnly=n.defaultValue(e.scene3DOnly,!0),e.maxLevel=n.defaultValue(e.maxLevel,25),e.geocoder=n.defaultValue(e.geocoder,!1),e.fullscreenButton=n.defaultValue(e.fullscreenButton,!1),!n.defined(e.imageryProvider)){var i=function(){for(var t="",e=new RegExp("(^|(.*?\\/))(Cesium.js)(\\?|$)"),i=document.getElementsByTagName("script"),r=0,n=i.length;r<n;r++){var o=i[r].getAttribute("src");if(o){var a=o.match(e);if(a){t=a[1];break}}}return t}(),r=new n.SingleTileImageryProvider({url:i+"Assets/Images/Earth.jpg",rectangle:n.Rectangle.fromDegrees(-180,-90,180,90)});e.imageryProvider=r}return new n.Viewer(t,e)}}(window.Cesium),function(s){var i=s.defaultValue,t=s.GeoClipping=function(t,e){t=i(t,s.defaultValue.EMPTY_OBJECT),this.steps=i(t.steps,64),this.edgeWidth=i(t.edgeWidth,2),this.edgeColor=i(t.edgeColor,s.Color.WHITE),this.cylinderRadius=i(t.cylinderRadius,50),this.clippingModeUnion=i(t.clippingModeUnion,!0),this.enabled=i(t.enabled,!0),this.clippingPlanes=void 0,this.modelEntityClippingPlanes=void 0};t.prototype.computePlanes=function(t){t=s.defined(t)?t:this.steps;for(var e=s.Math.TWO_PI/t,i=[],r=0;r<t;r++){var n=r*e,o=new s.Cartesian3;o.x=1,o.y=Math.tan(n),n>s.Math.PI_OVER_TWO&&(o.x=-1,o.y*=-1),n>s.Math.PI&&(o.x=-1),n>3*s.Math.PI_OVER_TWO&&(o.x=1,o.y=-o.y),s.Cartesian3.normalize(o,o);var a=new s.ClippingPlane(o,this.cylinderRadius);i.push(a)}return this.clippingPlanes=i},t.prototype.createClippingPlanes=function(t,e){for(var i=new s.ClippingPlaneCollection({modelMatrix:s.defined(t)?t:s.Matrix4.IDENTITY,edgeWidth:this.edgeWidth,edgeColor:this.edgeColor,unionClippingRegions:this.clippingModeUnion,enabled:this.enabled}),r=this.computePlanes(e),n=0;n<r.length;n++)i.add(r[n]);return this.modelEntityClippingPlanes=i}}(window.Cesium),function(r){var t=r.GeoFlood=function(t,e){this.viewer=t.viewer,this.scene=this.viewer.scene,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.cartesianArrayHeights=null,this.fragmentShader=null,this.normalMapUrl=null,this.geometry=null,this.appearance=null,this.callback=e||null};t.prototype.createWaterFace=function(t,e,i){return this.primitive&&this.clear(),this.primitive=this.creatPrimitive(t,e,i),this.primitive},t.prototype.creatPrimitive=function(t,e,i){if(t&&e&&!(e&&e.length<3))return this.fragmentShader="varying vec3 v_positionMC;\n\t\t\t\t\tvarying vec3 v_positionEC;\n\t\t\t\t\tvarying vec2 v_st;\n\t\t\t\t\t\n\t\t\t\t\tvoid main()\n\t\t\t\t\t{\n\t\t\t\t\t\tczm_materialInput materialInput;\n\t\t\t\t\t\tvec3 normalEC = normalize(czm_normal3D * czm_geodeticSurfaceNormal(v_positionMC, vec3(0.0), vec3(1.0)));\n\t\t\t\t\t#ifdef FACE_FORWARD\n\t\t\t\t\t\tnormalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n\t\t\t\t\t#endif\n\t\t\t\t\t\tmaterialInput.s = v_st.s;\n\t\t\t\t\t\tmaterialInput.st = v_st;\n\t\t\t\t\t\tmaterialInput.str = vec3(v_st, 0.0);\n\t\t\t\t\t\tmaterialInput.normalEC = normalEC;\n\t\t\t\t\t\tmaterialInput.tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(v_positionMC, materialInput.normalEC);\n\t\t\t\t\t\tvec3 positionToEyeEC = -v_positionEC;\n\t\t\t\t\t\tmaterialInput.positionToEyeEC = positionToEyeEC;\n\t\t\t\t\t\tczm_material material = czm_getMaterial(materialInput);\n\t\t\t\t\t#ifdef FLAT\n\t\t\t\t\t\tgl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n\t\t\t\t\t#else\n\t\t\t\t\t\tgl_FragColor = czm_phong(normalize(positionToEyeEC), material);\n\t\t\t\t\t\tgl_FragColor.a = 1.0;\n\t\t\t\t\t#endif\n\t\t\t\t\t}\n\t\t\t\t\t",this.normalMapUrl=t,this.geometry=function(t,e){return new r.PolygonGeometry({polygonHierarchy:new r.PolygonHierarchy(r.Cartesian3.fromDegreesArrayHeights(t)),extrudedHeight:e||0,perPositionHeight:!1,closeTop:!0,closeBottom:!0,vertexFormat:r.EllipsoidSurfaceAppearance.VERTEXT_FORMAT})}(e,i),this.appearance||(this.appearance=function(t,e){return new r.EllipsoidSurfaceAppearance({material:new r.Material({translucent:!1,fabric:{type:"Water",uniforms:{normalMap:e,frequency:90,animationSpeed:.03,amplitude:90,specularIntensity:5}}}),fragmentShaderSource:t})}(this.fragmentShader,this.normalMapUrl)),this.primitives.add(new r.Primitive({allowPicking:!0,geometryInstances:new r.GeometryInstance({geometry:this.geometry,id:"GEOFlood_ID"}),vertexCacheOptimize:!0,appearance:this.appearance,interleave:!0,asynchronous:!1,cull:!1,releaseGeometryInstances:!0,show:!0}))},t.prototype.clear=function(){this.canvas.style.cursor="default",this.primitive&&this.primitives.remove(this.primitive)},t.prototype.clearPrimitive=function(t){t&&this.primitives.remove(t)},t.prototype.destroy=function(){this.clear(),this.viewer=void 0,this.scene=void 0,this.canvas=void 0,this.primitives=void 0,this.callback=void 0}}(window.Cesium),function(o){var a=o.defaultValue,t=o.GeoLimitHeight=function(t,e){t=a(t,o.defaultValue.EMPTY_OBJECT),this.viewer=t.viewer,this.scene=this.viewer.scene,this.entities=this.viewer.entities};t.prototype.analysis=function(t){t=a(t,o.defaultValue.EMPTY_OBJECT),this.targetHeight=a(t.targetHeight,0);var e=t.labelOption,i=t.polygonPlaneOption,r=t.polygonFitOption;e&&this.drawLabel(e),i&&this.drawPolygonPlane(i),r&&this.drawPolygonFit(r)},t.prototype.drawLabel=function(t){return this.clearLabelEntity(),t=a(t,o.defaultValue.EMPTY_OBJECT),this.labelEntity=this.entities.add({position:a(t.labelPosition,new o.Cartesian2(0,0,0)),label:{text:a(t.labelText,""),pixelOffset:a(t.labelPixelOffset,new o.Cartesian2(0,-60)),fillColor:a(t.labelFillColor,new o.Color(0,0,1,1)),font:a(t.labelFont,"18px 楷体"),outlineColor:a(t.labelOutlineColor,new o.Color(0,0,1,1)),outlineWidth:a(t.labelOutlineWidth,1.8),style:o.defaultValue(t.labelStyle,o.LabelStyle.FILL_AND_OUTLINE),show:a(t.labelShow,!0),disableDepthTestDistance:Number.POSITIVE_INFINITY}}),!0},t.prototype.drawPolygonPlane=function(t){return this.clearPolygonPlaneEntity(),t=a(t,o.defaultValue.EMPTY_OBJECT),this.polygonPlaneEntity=this.entities.add({polygon:{hierarchy:a(t.polygonPlaneHierarchy,new o.Cartesian3(0,0,0)),perPositionHeight:a(t.polygonPlanePerPositionHeight,!1),height:a(t.polygonPlaneHeight,this.targetHeight),material:a(t.polygonPlaneMaterial,o.Color.YELLOW.withAlpha(.3)),outline:a(t.polygonPlaneOutline,!0),outlineColor:a(t.polygonPlaneOutlineColor,o.Color.WHITE),show:a(t.polygonPlaneShow,!0)}}),!0},t.prototype.drawPolygonFit=function(t){this.clearPolygonFitPrimitive();var e=(t=a(t,o.defaultValue.EMPTY_OBJECT)).polygonFitPositions;if(!e||0==e.length)return console.error("请输入有效的坐标数组！"),!1;var i=function(t,e,i,r){return new o.GeometryInstance({geometry:new o.PolygonGeometry({polygonHierarchy:new o.PolygonHierarchy(o.Cartesian3.fromDegreesArray(t)),height:e,extrudedHeight:i}),attributes:{color:o.ColorGeometryInstanceAttribute.fromColor(r)}})}(e,a(t.polygonFitHeight,this.targetHeight),a(t.polygonFitExtrudedHeight,1e4),a(t.polygonFitColor,new o.Color(1,0,0,.5))),r=new o.PerInstanceColorAppearance({flat:!0}),n=new o.ClassificationPrimitive({geometryInstances:[i],appearance:r,classificationType:o.ClassificationType.CESIUM_3D_TILE});return this.polygonFitPrimitive=this.scene.primitives.add(n),!0},t.prototype.clearLabelEntity=function(){this.labelEntity&&this.entities.contains(this.labelEntity)&&(this.entities.remove(this.labelEntity),this.labelEntity=void 0)},t.prototype.clearPolygonPlaneEntity=function(){this.polygonPlaneEntity&&this.entities.contains(this.polygonPlaneEntity)&&(this.entities.remove(this.polygonPlaneEntity),this.polygonPlaneEntity=void 0)},t.prototype.clearPolygonFitPrimitive=function(){this.polygonFitPrimitive&&this.scene.primitives.contains(this.polygonFitPrimitive)&&(this.scene.primitives.remove(this.polygonFitPrimitive),this.polygonFitPrimitive=void 0)},t.prototype.clearAll=function(){this.clearLabelEntity(),this.clearPolygonPlaneEntity(),this.clearPolygonFitPrimitive()}}(window.Cesium),function(M){var y="GeoPLSViewShed3D_TIP",u="GeoPLSViewShed3D_LIGHTPOINT",w="GeoPLSViewShed3D_BOUNDARY",P="GeoPLSViewShed3D_DASHLINE",x="GeoPLSViewShed3D_DSP",b="GeoPLSViewShed3D_ORIENTLINE",t=M.GeoPLSViewShed3D=function(t,e){this.viewer=t.viewer,this.scene=this.viewer.scene,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.groundPrimitives=this.scene.groundPrimitives,this.callback=e||null,this._pointLightHeight=M.defaultValue(t.pointLightHeight,.2),this._pointLightPixelSize=M.defaultValue(t.pointLightPixelSize,5),this._pointLightColor=M.defaultValue(t.pointLightColor,M.Color.YELLOW),this._boundaryWidth=M.defaultValue(t.boundaryWidth,4),this._boundaryColor=M.defaultValue(t.boundaryColor,M.Color.YELLOW),this._orientLineWidth=M.defaultValue(t.orientLineWidth,8),this._orientLineColor=M.defaultValue(t.orientLineColor,new M.Color(1,1,0,.5)),this._baseDEMLerpCfg=M.defaultValue(t.baseDEMLerpCfg,{}),this._intervalAnalysis=M.defaultValue(t.intervalAnalysis,!0),this._pointLightCamera=void 0,parseFloat(M.VERSION)<1.5&&console.error("当前Cesium版本："+M.VERSION+",点光源可视域分析暂不支持该版本，请更换至1.50以上的版本!")};function d(t,e,i,r,n,o){for(var a=[],s=[],l=parseInt(t.realTimeRadius/i),h=0;h<l;h++){var c={longitude:e[0],latitude:e[1],height:e[2]},g={longitude:e[3],latitude:e[4],height:e[5]},u=M.Math.lerp(c.longitude,g.longitude,1/l*(h+1)),d=M.Math.lerp(c.latitude,g.latitude,1/l*(h+1)),p={longitude:u,latitude:d},C=t.scene.globe.getHeight(p),m=M.Cartesian3.fromRadians(u,d,C);a.push(m);var f={longitude:e[0],latitude:e[1],height:C},v=M.Cartographic.toCartesian(f),A=M.Cartesian3.distance(v,m),I=(C-e[2])/A;s.push(I)}for(var _=[],y=[],w=[],P=[0],x=0;x<s.length-1;x++)_.length||s[x+1]<s[x]&&(_.push(s[x]),y.push(x)),_.length&&(s[x]>_[_.length-1]&&s[x+1]<s[x]&&(_.push(s[x]),y.push(x)),s[x]>_[_.length-1]&&s[x-1]<_[_.length-1]&&(w.push(s[x]),P.push(x)));y.push(s.length-1);var b=y.concat(P);b.sort(function(t,e){return t-e});for(var E=[],T=0;T<b.length-1;T++){var S=[a[b[T]],a[b[T+1]]];E=T%2==0?E.concat(D(S,o,r,!0)):E.concat(D(S,o,n,!0))}return E}function E(t,e,i){var r=t.scene.pickPosition(e);if(r){var n=M.Cartographic.fromCartesian(r);if(n.height<0){t.scene.globe.depthTestAgainstTerrain=!0,t.viewer.terrainShadows=M.ShadowMode.ENABLED;var o=t.scene.camera.getPickRay(e),a=t.scene.globe.pick(o,t.scene);n=M.Cartographic.fromCartesian(a)}i=i||0;var s=M.Cartesian3.fromRadians(n.longitude,n.latitude,n.height+i),l=M.Cartographic.fromCartesian(s);return[M.Math.toDegrees(l.longitude),M.Math.toDegrees(l.latitude),l.height]}}function T(t,e,i,r){var n=t.add(new M.LabelCollection);return n.add({text:e,font:"16px sans-serif",showBackground:!0,position:i,pixelOffset:new M.Cartesian2(10,-30),style:M.LabelStyle.FILL_AND_OUTLINE}),n.name=r,n}function D(t,e,i,r){var n=[],o=r?t:M.Cartesian3.fromDegreesArray(t),a=new M.GeometryInstance({geometry:new M.GroundPolylineGeometry({positions:o,width:e}),attributes:{color:M.ColorGeometryInstanceAttribute.fromColor(i)}});return n.push(a),n}function S(t,e,i){var r=t.add(new M.GroundPolylinePrimitive({geometryInstances:e,appearance:new M.PolylineColorAppearance({translucent:!0})}));return r.name=i,r}function R(t,e,i){for(var r=0;r<t.length;r++)t.name==i&&(e.position&&(t.get(r).position=e.position),e.text&&(t.get(r).text=e.text),void 0!==e.showBackground&&(t.get(r).showBackground=e.showBackground),e.backgroundColor&&(t.get(r).backgroundColor=e.backgroundColor),void 0!==e.horizontalOrigin&&(t.get(r).horizontalOrigin=e.horizontalOrigin),void 0!==e.verticalOrigin&&(t.get(r).verticalOrigin=e.verticalOrigin),e.pixelOffset&&(t.get(r).pixelOffset=e.pixelOffset),e.fillColor&&(t.get(r).fillColor=e.fillColor),e.outlineWidth&&(t.get(r).outlineWidth=e.outlineWidth),e.outlineColor&&(t.get(r).outlineColor=e.outlineColor))}function L(t,e){for(var i=0;i<e.length;i++)e.get(i).name==t&&(e.remove(e.get(i)),i--)}t.prototype.activate=function(){this.clear(),this.canvas.style.cursor="crosshair";var C=null,m=null,f=null,v=null,A=!0,g=null,I=null,_=this;this.handler=new M.ScreenSpaceEventHandler(this.canvas),this.handler.setInputAction(function(t){if(A){g=E(_,t.position,_._pointLightHeight),I=M.Cartesian3.fromDegrees(g[0],g[1],g[2]),L(y,_.primitives),A=!1,_.firstLeftClick=A,C=null,L(u,_.primitives);var e=_.primitives.add(new M.PointPrimitiveCollection);e.name=u,e.add({position:I,color:_._pointLightColor,pixelSize:_._pointLightPixelSize})}else if(_.scene.globe.depthTestAgainstTerrain=!1,_.scene.shadowMap.enableGeoPLSViewShed3D=!0,_.canvas.style.cursor="default",_.handler&&!_.handler.isDestroyed()&&_.handler.destroy(),L(y,_.primitives),A=!0,_.firstLeftClick=A,C=null,_._baseDEMLerpCfg.enable)if(_._intervalAnalysis)_.angleInterval=M.defaultValue(_._baseDEMLerpCfg.angleInterval,1),_.timeInterval=M.defaultValue(_._baseDEMLerpCfg.timeInterval,100),_.num=0,setTimeout(function(){!function t(e){if(e.num%(2*e.angleInterval)==0){var i={longitude:e.boundaryPositionArr[e.num],latitude:e.boundaryPositionArr[e.num+1]},r=e.scene.globe.getHeight(i),n=[e.startPointLng,e.startPointLat,e.startPointHgt,i.longitude,i.latitude,r],o=M.defaultValue(e._baseDEMLerpCfg.interpolationBase,10),a=M.defaultValue(e._baseDEMLerpCfg.visibleColor,new M.Color(0,1,0,.8)),s=M.defaultValue(e._baseDEMLerpCfg.invisibleColor,new M.Color(1,0,0,.8)),l=M.defaultValue(e._baseDEMLerpCfg.lineWidth,5),h=d(e,n,o,a,s,l);S(e.scene.groundPrimitives,h,w)}e.num+=2*e.angleInterval;e.num<720&&setTimeout(function(){t(e)},e.timeInterval)}(_)},_.timeInterval);else{for(var i=[],r=0;r<_.boundaryPositionArr.length;r++)if(r%2==0){var n={longitude:_.boundaryPositionArr[r],latitude:_.boundaryPositionArr[r+1]},o=_.scene.globe.getHeight(n),a=[_.startPointLng,_.startPointLat,_.startPointHgt,n.longitude,n.latitude,o],s=M.defaultValue(_._baseDEMLerpCfg.interpolationBase,10),l=M.defaultValue(_._baseDEMLerpCfg.visibleColor,new M.Color(0,1,0,.8)),h=M.defaultValue(_._baseDEMLerpCfg.invisibleColor,new M.Color(1,0,0,.8)),c=M.defaultValue(_._baseDEMLerpCfg.lineWidth,5);d(_,a,s,l,h,c),i=i.concat(radiusLineInstance)}S(_.scene.groundPrimitives,i,w)}},M.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(t){if(_.tipPosition=_.scene.pickPosition(t.endPosition),_.tipPosition&&(A&&(C?R(C,{position:_.tipPosition},y):C=T(_.primitives,"单击左键确定可视域位置",_.tipPosition,y)),!A)){C?R(C,{position:_.tipPosition},y):C=T(_.primitives,"单击左键固定可视域半径",_.tipPosition,y);var e=E(_,t.endPosition),i=M.Cartesian3.fromDegrees(e[0],e[1],e[2]);if(v=M.Cartesian3.distance(I,i),L(w,_.groundPrimitives),L(b,_.groundPrimitives),v){var r=M.Math.toDegrees(M.Cartographic.fromCartesian(I).longitude),n=M.Math.toDegrees(M.Cartographic.fromCartesian(I).latitude),o=M.Cartographic.fromCartesian(I).height,a=function(t,e,i){for(var r=[],n=0;n<=360;n++){var o=i*Math.sin(n*Math.PI/180),a=i*Math.cos(n*Math.PI/180),s=6356725+21412*(90-e)/90,l=s*Math.cos(e*Math.PI/180),h=t+o/l*180/Math.PI,c=e+a/s*180/Math.PI;r.push(h),r.push(c)}return r}(r,n,v),s=D(a,_._boundaryWidth,_._boundaryColor),l=(S(_.groundPrimitives,s,w),[r,n,a[0],a[1]]),h=(function(t,e,i,r,n){var o=new M.GeometryInstance({geometry:new M.GroundPolylineGeometry({positions:M.Cartesian3.fromDegreesArray(e),width:i})}),a=t.add(new M.GroundPolylinePrimitive({geometryInstances:o,appearance:new M.PolylineMaterialAppearance({material:new M.Material({fabric:{type:"PolylineArrow",uniforms:{color:r}}})})}));a.name=n}(_.groundPrimitives,l,_._orientLineWidth,_._orientLineColor,b),[r,n,o,r,n,o+v/3]),c=M.Color.fromAlpha(M.Color.YELLOW,.7);f?f.polyline.positions=M.Cartesian3.fromDegreesArrayHeights(h):f=function(t,e,i,r,n){return t.add({name:n,polyline:{positions:M.Cartesian3.fromDegreesArrayHeights(e),width:i,material:new M.PolylineDashMaterialProperty({color:r,dashLength:5})}})}(_.viewer.entities,h,2,c,P);var g=M.Cartesian3.fromDegrees(r,n,o+v/3),u="视高："+_._pointLightHeight.toFixed(2)+"米\n半径："+v.toFixed(4)+"米\n经度："+r.toFixed(6)+"度\n纬度："+n.toFixed(6)+"度",d={position:g,text:u,showBackground:!0,backgroundColor:M.Color.fromAlpha(M.Color.WHITE,.8),horizontalOrigin:M.HorizontalOrigin.CENTER,verticalOrigin:M.VerticalOrigin.BOTTOM,pixelOffset:new M.Cartesian2(0,0),fillColor:M.Color.BLACK};if(R(m||(m=T(_.primitives,u,g,x)),d,x),_._baseDEMLerpCfg.enable||_.dynamicAnalysis(I,v),_.pointLightPosition=I,_.realTimeRadius=v,_.firstLeftClick=A,_._baseDEMLerpCfg.enable){_.startPointLng=M.Math.toRadians(r),_.startPointLat=M.Math.toRadians(n),_.startPointHgt=o,_.boundaryPositionArr=[];for(var p=0;p<a.length;p++)_.boundaryPositionArr.push(M.Math.toRadians(a[p]));_.realTimeRadius=v}}}},M.ScreenSpaceEventType.MOUSE_MOVE)},t.prototype.dynamicAnalysis=function(t,e){var i,r;t&&e&&(null==this._pointLightCamera?(this._pointLightCamera=new M.Camera(this.scene),this._pointLightCamera.position=t,i={context:this.scene.context,lightCamera:this._pointLightCamera,isPointLight:!0},this.scene.shadowMap.destroy(),this.scene.shadowMap=new M.ShadowMap(i),(r=this.scene.shadowMap).size=1024,r._pointLightRadius=e,r._terrainBias.depthBias=0,r.enabled=!0,r.enableGeoPLSViewShed3D=!0):(r=this.scene.shadowMap)._pointLightRadius=e)},t.prototype.clear=function(){this._baseDEMLerpCfg.enable&&(this.num=721),this.scene.globe.depthTestAgainstTerrain=!1,this.scene.shadowMap.enabled=!1,this.scene.shadowMap.enableGeoPLSViewShed3D=void 0,this.canvas.style.cursor="default",this._pointLightCamera=void 0,this.handler&&!this.handler.isDestroyed()&&this.handler.destroy(),L(y,this.primitives),L(x,this.primitives),L(u,this.primitives),L(w,this.groundPrimitives),L(b,this.groundPrimitives),function(t,e){for(var i=0;i<e.values.length;i++)e.values[i].name==t&&(e.remove(e.values[i]),i--)}(P,this.viewer.entities)},t.prototype.destroy=function(){this.clear(),this.viewer=void 0,this._pointLightHeight=void 0,this.scene=void 0,this.canvas=void 0,this.primitives=void 0,this.callback=void 0,this._pointLightCamera=void 0}}(window.Cesium),function(D){var i="GeoProfile",t=D.GeoProfile=function(t,e){this.viewer=t.viewer,this.scene=this.viewer.scene};t.prototype.getLerpValue=function(t,e){this.lng_origin=t[0],this.lat_origin=t[1],this.hgt_origin=t[2],this.lng_destination=t[t.length-3],this.lat_destination=t[t.length-2],this.hgt_destination=t[t.length-1];for(var i=[],r=0;r<t.length-3;r+=3){var n=D.Cartesian3.fromDegrees(t[r],t[r+1]),o=D.Cartesian3.fromDegrees(t[r+3],t[r+4]),a=D.Cartesian3.distance(n,o);i.push(a),D.Cartesian3.distance(n,o)}for(var s=0,l=[],h=0;h<i.length;h++){var c=Math.floor(i[h]/e);l.push(c),s+=c}this.samplingNum=s;var g=[],u=[];for(r=0;r<l.length;r++){for(var d=0;d<=l[r];d++){var p=d*e;if(i[r]-p<=e)g.push(1);else{var C=p/i[r];g.push(C)}}u.push(g),g=[]}for(var m=[],f=[],v=[],A=[],I=(r=0,0);I<u.length;I++){for(d=0;d<u[I].length;d++){var _=D.Math.lerp(t[r],t[r+3],u[I][d]),y=D.Math.lerp(t[r+1],t[r+4],u[I][d]),w={longitude:D.Math.toRadians(_),latitude:D.Math.toRadians(y)},P=Number(this.scene.globe.getHeight(w).toFixed(2));v.push(P),m.push(D.Cartesian3.fromDegrees(_,y,P)),f.push(D.Cartesian3.fromDegrees(_,y,0))}r+=3}var x=Math.min.apply(null,v);this.minHeight=x;var b=Math.max.apply(null,v);this.maxHeight=b;var E=0;for(r=0;r<m.length-1;r++)E+=D.Cartesian3.distance(m[r],m[r+1]);this.surfaceLen=E;var T=D.Cartesian3.distance(m[0],m[m.length-1]);this.straightLen=T;var S=0;for(I=0;I<f.length-1;I++)S+=D.Cartesian3.distance(f[I],f[I+1]),A.push(S.toFixed(2));A.unshift(0);var M={};return M.YValueArray=v,M.addLenArray=A,M.lerpCoordnatesArray=m,M},t.prototype.drawChart=function(t,e){var n=document.getElementById(e);n.onmousedown=function(t){var e=t||event,i=e.clientX-n.offsetLeft,r=e.clientY-n.offsetTop;document.onmousemove=function(t){var e=t||event;n.style.left=e.clientX-i+"px",n.style.top=e.clientY-r+"px"},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null}};var i=echarts.init(n),r={title:{x:"center",padding:15,text:"剖面示意图",textStyle:{color:"#ccc",fontStyle:"normal",fontWeight:"bold",fontFamily:"sans-serif",fontSize:18}},tooltip:{trigger:"axis",confine:!0,formatter:function(t){return"长度: "+t[0].name+"<br />高程: "+t[0].value}},grid:{left:"2%",right:"12%",bottom:"3%",containLabel:!0},xAxis:{splitArea:{show:!1},splitLine:{show:!1,lineStyle:{color:["#aaa"],width:1,type:"solid"}},type:"category",boundaryGap:!1,data:t.addLenArray,name:"长度(米)",nameTextStyle:{color:"#ccc",fontWeight:"bolder"},axisLine:{lineStyle:{color:"rgba(0.0, 128, 255, 0.6)",width:4}},axisLabel:{color:"#ccc",fontWeight:"bolder"}},yAxis:{splitArea:{show:!1},splitLine:{show:!0,lineStyle:{color:["#aaa"],width:1,type:"dashed"}},type:"value",name:"高程(米)",nameTextStyle:{color:"#ccc",fontWeight:"bolder"},axisLine:{lineStyle:{color:"rgba(0.0, 128, 255, 0.6)",width:4}},axisLabel:{color:"#ccc",fontWeight:"bolder"}},series:[{type:"line",data:t.YValueArray,areaStyle:{color:"rgba(0.0,255.0,255.0,0.8)"}}]};i.setOption(r);var o=document.createElement("table"),a=document.createElement("tbody"),s=document.createElement("tr"),l=document.createElement("td");l.innerHTML="起点经度："+this.lng_origin.toFixed(6),s.appendChild(l);var h=document.createElement("td");h.innerHTML="起点高程："+t.YValueArray[0].toFixed(2),s.appendChild(h);var c=document.createElement("td");c.innerHTML="投影距离："+Number(t.addLenArray[t.addLenArray.length-1]).toFixed(2),s.appendChild(c),a.appendChild(s);var g=document.createElement("tr"),u=document.createElement("td");u.innerHTML="起点纬度："+this.lat_origin.toFixed(6),g.appendChild(u);var d=document.createElement("td");d.innerHTML="终点高程："+t.YValueArray[t.YValueArray.length-1].toFixed(2),g.appendChild(d);var p=document.createElement("td");p.innerHTML="地表距离："+this.surfaceLen.toFixed(2),g.appendChild(p),a.appendChild(g);var C=document.createElement("tr"),m=document.createElement("td");m.innerHTML="终点经度："+this.lng_destination.toFixed(6),C.appendChild(m);var f=document.createElement("td");f.innerHTML="最高高程："+this.maxHeight,C.appendChild(f);var v=document.createElement("td");v.innerHTML="直线距离："+this.straightLen.toFixed(2),C.appendChild(v),a.appendChild(C);var A=document.createElement("tr"),I=document.createElement("td");I.innerHTML="终点纬度："+this.lat_destination.toFixed(6),A.appendChild(I);var _=document.createElement("td");_.innerHTML="最低高程："+this.minHeight,A.appendChild(_);var y=document.createElement("td");return y.innerHTML="采样点数："+this.samplingNum,A.appendChild(y),a.appendChild(A),o.appendChild(a),n.appendChild(o),this.oTable=o,this.chartContainer=n,this.myChart=i},t.prototype.drawMark=function(t){t=D.defaultValue(t,{});var e=this.scene.primitives.add(new D.BillboardCollection);e.add({position:t.originCoordanate,image:t.originImage,verticalOrigin:D.VerticalOrigin.BOTTOM,scale:.2}),e.add({position:t.destinationCoordanate,image:t.destinationImage,verticalOrigin:D.VerticalOrigin.BOTTOM,scale:.2}),e.name=i},t.prototype.clearMark=function(){for(var t=0;t<this.scene.primitives.length;t++)this.scene.primitives.get(t).name==i&&(this.scene.primitives.remove(this.scene.primitives.get(t)),t--)},t.prototype.clearChart=function(){this.myChart&&(this.myChart.clear(),this.myChart=null),this.oTable&&this.chartContainer&&this.chartContainer.removeChild(this.oTable)},t.prototype.clear=function(){this.clearChart(),this.clearMark()}}(window.Cesium),function(u){var n="GEOSIGHTLINE_TIP",o="GEOSIGHTLINEBILLBOARD",d="REDLINE",p="GREENLINE",t=u.GeoSightline=function(t,e){this.viewer=t.viewer,this.observeRelativeHeight=t.observeRelativeHeight,this.targetRelativeHeight=t.targetRelativeHeight,this.observeImage=t.observeImage,this.targetImage=t.targetImage,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.entities=this.viewer.entities,this.callback=e||null,this.objectsToExclude=[],this.observeActualPosition=null,this.targetActualPosition=null,this.observeEntity=null,this.targetEntity=null,parseFloat(u.VERSION)<1.5&&console.error("当前Cesium版本："+u.VERSION+",通视分析暂不支持该版本，请更换至1.50以上的版本!")};function a(t,e,i){if(t.scene){var r=t.scene.pickPosition(e);if(1.58<=parseFloat(u.VERSION)){var n=viewer.scene.clampToHeight(r);n&&(r=n)}var o,a=u.Cartographic.fromCartesian(r);if(a.height<0){var s=t.camera.getPickRay(e),l=t.scene.globe.pick(s,t.scene);a=u.Cartographic.fromCartesian(l),t.scene.globe.depthTestAgainstTerrain=!0}return i=i||1,o=a.height+i,u.Cartesian3.fromRadians(a.longitude,a.latitude,o)}}function s(t,e,i,r){var n=t.add(new u.LabelCollection);return n.add({text:e,font:"16px sans-serif",showBackground:!0,position:i,pixelOffset:new u.Cartesian2(10,-10)}),n.name=r,n}function l(t,e,i){for(var r=0;r<t.length;r++)t.name==i&&(t.get(r).position=e)}function h(t,e){i(t,e)}function c(t,e,i){var r=t.add(new u.BillboardCollection);return r.add({position:e,image:i,scale:.4,verticalOrigin:u.VerticalOrigin.MIDDLE}),r.name=o,r}function i(t,e){for(var i=0;i<e.length;i++)e.get(i).name==t&&(e.remove(e.get(i)),i--)}function e(t,e){for(var i=0;i<e._entities._array.length;i++)e._entities._array[i].name==t&&(e.remove(e._entities._array[i]),i--)}t.prototype.activate=function(){this.scene.globe.depthTestAgainstTerrain=!1,this.destroyHandler(),this.clear(),1.52==parseFloat(u.VERSION)&&(this.scene.enableGeoSightline=!0),1.58<=parseFloat(u.VERSION)&&(this.scene.enableGeoSightline=!1),this.canvas.style.cursor="crosshair";var e=null,i=!0,r=this;this.handler=new u.ScreenSpaceEventHandler(this.canvas),this.handler.setInputAction(function(t){i?(r.clear(),r.observeActualPosition=a(r,t.position,r.observeRelativeHeight),c(r.primitives,r.observeActualPosition,r.observeImage),h(n,r.primitives),e=null,i=!1):(r.targetActualPosition=a(r,t.position,r.targetRelativeHeight),c(r.primitives,r.targetActualPosition,r.targetImage),r.pickFromRays(),h(n,r.primitives),i=!(e=null),r.scene.enableGeoSightline=!1,r.destroyHandler())},u.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(t){r.tipPosition=r.scene.pickPosition(t.endPosition),r.tipPosition&&(i&&(e?l(e,r.tipPosition,n):e=s(r.primitives,"单击左键确定观察点",r.tipPosition,n)),i||(e?l(e,r.tipPosition,n):e=s(r.primitives,"单击左键确定目标点",r.tipPosition,n)))},u.ScreenSpaceEventType.MOUSE_MOVE)},t.prototype.pickFromRays=function(){var t=new u.Cartesian3(0,0,0);this.objectsToExclude=[this.observeEntity,this.targetEntity];var e=u.Cartesian3.normalize(u.Cartesian3.subtract(this.targetActualPosition,this.observeActualPosition,new u.Cartesian3),new u.Cartesian3),i=new u.Ray(this.observeActualPosition,e),r=[],n=[],o=[];r=this.scene.drillPickFromRay(i,1e3,this.objectsToExclude);var a=u.Cartesian3.distance(this.observeActualPosition,this.targetActualPosition);if(0!==r.length&&!r[0].position)for(var s=1;s<Math.floor(a)+1;s++)if(u.Cartesian3.lerp(this.observeActualPosition,this.targetActualPosition,s*(1/Math.floor(a)),t),e=u.Cartesian3.normalize(u.Cartesian3.subtract(this.targetActualPosition,this.observeActualPosition,new u.Cartesian3),new u.Cartesian3),i=new u.Ray(t,e),r=[],n=[],o=[],null,0<(r=this.scene.drillPickFromRay(i,1,this.objectsToExclude)).length){r[0].position||(u.Cartesian3.lerp(this.observeActualPosition,this.targetActualPosition,s*(1/Math.floor(a)),t),r[0].position=t);break}if(0==r.length)n=[this.observeActualPosition,this.targetActualPosition];else{var l=u.Cartesian3.normalize(u.Cartesian3.subtract(r[0].position,this.observeActualPosition,new u.Cartesian3),new u.Cartesian3),h=u.Cartesian3.normalize(u.Cartesian3.subtract(r[0].position,this.targetActualPosition,new u.Cartesian3),new u.Cartesian3);if(l.x.toFixed(8)==h.x.toFixed(8)&&l.y.toFixed(8)==h.y.toFixed(8)&&l.z.toFixed(8)==h.z.toFixed(8))n=[this.targetActualPosition,this.observeActualPosition];else{n=[this.observeActualPosition,r[0].position],o=[r[0].position,this.targetActualPosition];var c={name:d,polyline:{positions:o,width:7,followSurface:!1,material:new u.PolylineArrowMaterialProperty(u.Color.RED)}};this.entities.add(c)}}var g={name:p,polyline:{positions:n,width:2,followSurface:!1,material:u.Color.GREEN}};this.entities.add(g)},t.prototype.clear=function(){this.primitives&&(i(n,this.primitives),i(o,this.primitives)),this.entities&&(e(d,this.entities),e(p,this.entities))},t.prototype.destroyHandler=function(){this.handler=this.handler&&this.handler.destroy(),this.canvas.style.cursor="default"},t.prototype.destroy=function(){this.scene.enableGeoSightline=!1,this.scene.globe.depthTestAgainstTerrain=!1,this.destroyHandler(),this.clear(),this.viewer=void 0,this.observeRelativeHeight=void 0,this.targetRelativeHeight=void 0,this.scene=void 0,this.camera=void 0,this.canvas=void 0,this.primitives=void 0,this.entities=void 0,this.ellipsoid=void 0,this.callback=void 0,this.objectsToExclude=void 0,this.observeEntity=null,this.targetEntity=null}}(window.Cesium),function(C){var i=C.defaultValue,t=C.GeoSkyLine=function(t,e){this.viewer=t.viewer,this.scene=this.viewer.scene,this.canvas=this.viewer.canvas,this.entities=this.viewer.entities,this.skyLineShow=i(t.skylineShow,!0),this.skyLineWidth=i(t.skyLineWidth,2),this.skyLineMaterial=i(t.skyLineMaterial,C.Color.RED.clone()),this.skyLineDepthFailMaterial=i(t.skyLineDepthFailMaterial,void 0),this.skyLineVolumeMaterial=i(t.skyLineVolumeMaterial,C.Color.ORANGE.clone()),this.skyLineVolumeOutLine=i(t.skyLineVolumeOutLine,!1),this.skyLineVolumeOutLineColor=i(t.skyLineVolumeOutLineColor,C.Color.BLACK.clone()),this.extrudeRatio=i(t.extrudeRatio,1.2)};t.prototype.calculateSkyLinePositions=function(){if(!this.skyLine){for(var t=[],e={addLenArray:[],YValueArray:[]},i=this.canvas.width,r=this.canvas.height,n=50,o=[],a=0;a<i;a+=parseInt(i/3))for(var s=0;s<r;s++){var l=new C.Cartesian2(a,s);if(this.scene.pickPosition(l)){o.push(s);break}}Math.max.apply(null,o)<10&&(n=1);for(var h=0;h<i;h+=3)for(var c=0;c<r;c+=n){var g=new C.Cartesian2(h,c);if(this.scene.pickPosition(g))for(a=c-1;c-n<=a;a-=1){var u=new C.Cartesian2(h,a);if(!this.scene.pickPosition(u)){var d=new C.Cartesian2(h,a+1),p=this.scene.pickPosition(d);t.push(p),e.YValueArray.push(r-a),e.addLenArray.push(h),c=r;break}}}this.data=e,this.skyLinePositions=t,this.cameraPosition=this.viewer.camera.position.clone(),this.cameraHeight=C.Cartographic.fromCartesian(this.cameraPosition).height}},t.prototype.drawSkyLine=function(){this.skyLine||(this.skyLinePositions||this.calculateSkyLinePositions(),this.skyLine=this.entities.add({name:"GeoSkyLine",polyline:{positions:this.skyLinePositions,width:this.skyLineWidth,show:this.skyLineShow,material:this.skyLineMaterial,depthFailMaterial:this.skyLineDepthFailMaterial}}))},t.prototype.drawSkyLineVolume=function(){this.skyLineVolume||(this.skyLinePositions||this.calculateSkyLinePositions(),this.skyLinePositions=this.skyLinePositions.concat([this.cameraPosition]),this.skyLinePositions.push(this.skyLinePositions[0]),this.skyLineVolume=this.entities.add({name:"GeoSkyLineVolume",polygon:{hierarchy:this.skyLinePositions,extrudedHeight:this.cameraHeight/this.extrudeRatio,perPositionHeight:!0,material:this.skyLineVolumeMaterial,outline:this.skyLineVolumeOutLine,outlineColor:this.skyLineVolumeOutLineColor}}))},t.prototype.drawChart=function(t){if(!this.myChart&&(this.skyLinePositions||this.calculateSkyLinePositions(),this.data)){var n=document.getElementById(t);n.onmousedown=function(t){var e=t||event,i=e.clientX-n.offsetLeft,r=e.clientY-n.offsetTop;document.onmousemove=function(t){var e=t||event;n.style.left=e.clientX-i+"px",n.style.top=e.clientY-r+"px"},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null}};var e=echarts.init(n),i={title:{x:"center",padding:15,text:"天际线示意图",textStyle:{color:"#ccc",fontStyle:"normal",fontWeight:"bold",fontFamily:"sans-serif",fontSize:18}},tooltip:{trigger:"axis",confine:!0,formatter:function(t){return"宽度: "+t[0].name+"<br />高度: "+t[0].value}},grid:{left:"2%",right:"12%",bottom:"3%",containLabel:!0},xAxis:{splitArea:{show:!1},splitLine:{show:!1,lineStyle:{color:["#aaa"],width:1,type:"solid"}},type:"category",boundaryGap:!1,data:this.data.addLenArray,name:"宽度(PX)",nameTextStyle:{color:"#ccc",fontWeight:"bolder"},axisLine:{lineStyle:{color:"rgba(0.0, 128, 255, 0.6)",width:4}},axisLabel:{color:"#ccc",fontWeight:"bolder"}},yAxis:{splitArea:{show:!1},splitLine:{show:!0,lineStyle:{color:["#aaa"],width:1,type:"dashed"}},type:"value",name:"高度(PX)",nameTextStyle:{color:"#ccc",fontWeight:"bolder"},axisLine:{lineStyle:{color:"rgba(0.0, 128, 255, 0.6)",width:4}},axisLabel:{color:"#ccc",fontWeight:"bolder"}},series:[{type:"line",data:this.data.YValueArray,areaStyle:{color:"rgba(0.0,255.0,255.0,0.8)"}}]};return e.setOption(i),this.chartContainer=n,this.myChart=e}},t.prototype.clearChart=function(){this.myChart&&(this.myChart.clear(),this.myChart=null)},t.prototype.clear=function(){this.clearChart(),this.skyLine&&(this.entities.remove(this.skyLine),this.skyLine=void 0),this.skyLineVolume&&(this.entities.remove(this.skyLineVolume),this.skyLineVolume=void 0),this.data=void 0,this.skyLinePositions=void 0,this.cameraPosition=void 0,this.cameraHeight=void 0,this.skyLinePositions=void 0}}(window.Cesium),function(I){function u(t){t.length<3||!function(t){var e=t[0],i=t[1],r=t[2],n=I.Cartesian3.subtract(i,e,new I.Cartesian3),o=I.Cartesian3.subtract(r,e,new I.Cartesian3),a=I.Cartesian3.cross(n,o,new I.Cartesian3);return 0<=I.Cartesian3.dot(e,a)}(t)&&t.reverse()}(I.GeoExcavationRegion=function(t){this.viewer=t.viewer,this.scene=this.viewer.scene,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this._samplingPoints=t.samplingPoints,this._sideMaterial=t.sideMaterial,this._bottomMaterial=t.bottomMaterial,this._interNumber=I.defaultValue(t.interNumber,20),this._depth=I.defaultValue(t.depth,-500),this._sideMaterial=I.defaultValue(t.sideMaterial,new I.StripeMaterialProperty({evenColor:I.Color.YELLOW.withAlpha(1)})),this._bottomMaterial=I.defaultValue(t.bottomMaterial,new I.StripeMaterialProperty({evenColor:I.Color.BLUE.withAlpha(1)})),this._entitys=[],!this._samplingPoints||this._samplingPoints.length<=2||(function(t,e){u(t);for(var i=t.length,r=[],n=0;n<i;++n){var o=(n+1)%i,a=I.Cartesian3.add(t[n],t[o],new I.Cartesian3);a=I.Cartesian3.multiplyByScalar(a,.5,a);var s=I.Cartesian3.normalize(a,new I.Cartesian3),l=I.Cartesian3.subtract(t[o],a,new I.Cartesian3);l=I.Cartesian3.normalize(l,l);var h=I.Cartesian3.cross(l,s,new I.Cartesian3);h=I.Cartesian3.normalize(h,h);var c=new I.Plane(h,0),g=I.Plane.getPointDistance(c,a);r.push(new I.ClippingPlane(h,g))}e.scene.globe.clippingPlanes=new I.ClippingPlaneCollection({planes:r,edgeWidth:2,edgeColor:I.Color.WHITE})}(this._samplingPoints,this.viewer),function(t){for(var e=t.interNumber,i=t.holeDepth,r=t.arrPoints,n=t.earth,o=t.sideMaterial,a=t.bottomMaterial,s=t.entitys,l=[],h=0;h<r.length;h++){var c=n.scene.globe.ellipsoid.cartesianToCartographic(r[h]);if(c.height=0,l.push(c),h==r.length-1)for(var g=1;g<=e;g++){var u=I.Cartesian3.lerp(r[h],r[0],g/e,new I.Cartesian3);(d=I.Cartographic.fromCartesian(u)).height=0,l.push(d)}else for(g=1;g<=e;g++){var d;u=I.Cartesian3.lerp(r[h],r[h+1],g/e,new I.Cartesian3);(d=I.Cartographic.fromCartesian(u)).height=0,l.push(d)}}for(h=0;h<l.length;h++){var p=n.scene.globe.getHeight(l[h]);l[h].height=p}var C=[];for(h=0;h<l.length;h++){var m=(h+1)%l.length,f=[];f.push(I.Math.toDegrees(l[h].longitude)),f.push(I.Math.toDegrees(l[h].latitude)),f.push(l[h].height),f.push(I.Math.toDegrees(l[m].longitude)),f.push(I.Math.toDegrees(l[m].latitude)),f.push(l[m].height),f.push(I.Math.toDegrees(l[m].longitude)),f.push(I.Math.toDegrees(l[m].latitude)),f.push(l[m].height+i),f.push(I.Math.toDegrees(l[h].longitude)),f.push(I.Math.toDegrees(l[h].latitude)),f.push(l[h].height+i),C.push(I.Math.toDegrees(l[h].longitude)),C.push(I.Math.toDegrees(l[h].latitude)),C.push(l[h].height+i);var v=n.entities.add({polygon:{hierarchy:I.Cartesian3.fromDegreesArrayHeights(f),material:o,perPositionHeight:!0}});s.push(v)}var A=n.entities.add({polygon:{hierarchy:I.Cartesian3.fromDegreesArrayHeights(C),material:a,perPositionHeight:!0}});s.push(A)}({arrPoints:this._samplingPoints,earth:this.viewer,holeDepth:this._depth,interNumber:this._interNumber,sideMaterial:this._sideMaterial,bottomMaterial:this._bottomMaterial,entitys:this._entitys}))}).prototype.destroy=function(){for(var t=0;t<this._entitys.length;t++)this.viewer.entities.remove(this._entitys[t]);this._entitys.length=0,this.viewer.scene.globe.clippingPlanes.destroy()}}(window.Cesium),function(o){o.defaultValue;var t=o.GeoTerrainExcavate=function(t,e){this.viewer=t.viewer,this.scene=this.viewer.scene,this.canvas=this.scene.canvas,this.entities=this.viewer.entities,this._callback=e,this.depth=o.defaultValue(t.depth,-500),this._sideMaterial=t.sideMaterial,this._bottomMaterial=t.bottomMaterial,this._outPoints=[],this._arrayVertex=[],this._polylineCollection=void 0,this._vPolyline=void 0,this._vertexNum=0,this._excavationRegion=void 0,this.viewer.scene.globe.depthTestAgainstTerrain=!0};t.prototype.activate=function(){if(this.clear(),!this.handler){this.handler=new o.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var n=this;this.handler.setInputAction(function(t){var e=n.viewer.camera.getPickRay(t.position),i=n.viewer.scene.globe.pick(e,n.viewer.scene);n._arrayVertex.push(i);var r=o.Cartographic.fromCartesian(i);n._outPoints.push(o.Math.toDegrees(r.longitude)),n._outPoints.push(o.Math.toDegrees(r.latitude)),n._outPoints.push(r.height),null==n._polylineCollection&&(n._polylineCollection=n.viewer.scene.primitives.add(new o.PolylineCollection),n._polylineCollection.name="draw_polyline",n._vPolyline=n._polylineCollection.add({polyline:{}}),n._vPolyline.width=2,n._vPolyline.loop=!1,n._vPolyline.material.uniforms.color={red:1,green:0,blue:0,alpha:1}),n._vPolyline.positions=n._arrayVertex,n._vertexNum++},o.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(t){if(null!=n._polylineCollection){var e=n.viewer.camera.getPickRay(t.endPosition),i=n.viewer.scene.globe.pick(e,n.viewer.scene);n._arrayVertex.length>n._vertexNum&&n._arrayVertex.pop(),n._arrayVertex.push(i),n._vPolyline.positions=n._arrayVertex}},o.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(t){if(null!=n._polylineCollection){var e=n.viewer.camera.getPickRay(t.position),i=n.viewer.scene.globe.pick(e,n.viewer.scene),r=o.Cartographic.fromCartesian(i);n._outPoints.push(o.Math.toDegrees(r.longitude)),n._outPoints.push(o.Math.toDegrees(r.latitude)),n._outPoints.push(r.height),n._polylineCollection.remove(n._vPolyline),n.viewer.scene.primitives.remove(n._polylineCollection),n.handler.destroy(),n.handler=void 0,n._polylineCollection=void 0,n._vPolyline=void 0,n._vertexNum=0,n.viewer.canvas.style.cursor="default",n._excavationRegion=new o.GeoExcavationRegion({viewer:n.viewer,samplingPoints:n._arrayVertex,depth:n.depth,sideMaterial:n._sideMaterial,bottomMaterial:n._bottomMaterial,interNumber:10}),n._callback(n._outPoints)}},o.ScreenSpaceEventType.RIGHT_CLICK)}},t.prototype.clear=function(){this._excavationRegion&&(this._outPoints.length=0,this._arrayVertex.length=0,this._excavationRegion.destroy(),this._excavationRegion=void 0)}}(window.Cesium),function(h){var c=h.defaultValue;(h.GeoTerrainSlope=function(t,e){t=c(t,c.EMPTY_OBJECT),this.viewer=t.viewer,this.scene=this.viewer.scene,this.canvas=this.scene.canvas,this.camera=this.scene.camera,this.primitives=this.scene.primitives,this.callback=e||null,this.contourUniforms={},this.shadingUniforms={}}).prototype.updateMaterial=function(t){var e=!1;if(t&&t.contour){e=c(t.contour.enable,!1);var i=c(t.contour.width,2),r=c(t.contour.spacing,150),n=c(t.contour.color,h.Color.RED.clone())}var o="none";if(t&&t.selectedShading&&(o=t.selectedShading,-1==["elevation","slope","aspect","none"].indexOf(o)))return alert("输入值可选elevation,slope,aspect,none中的一个！"),!1;var a,s=-414,l=8777;return t&&t.minHeight&&(s=t.minHeight),t&&t.maxHeight&&(l=t.maxHeight),e?("elevation"===o?(a=new h.Material({fabric:{type:"ElevationColorContour",materials:{contourMaterial:{type:"ElevationContour"},elevationRampMaterial:{type:"ElevationRamp"}},components:{diffuse:"contourMaterial.alpha == 0.0 ? elevationRampMaterial.diffuse : contourMaterial.diffuse",alpha:"max(contourMaterial.alpha, elevationRampMaterial.alpha)"}},translucent:!1}),this.shadingUniforms=a.materials.elevationRampMaterial.uniforms,this.shadingUniforms.minimumHeight=s,this.shadingUniforms.maximumHeight=l,this.contourUniforms=a.materials.contourMaterial.uniforms):"slope"===o?(a=new h.Material({fabric:{type:"SlopeColorContour",materials:{contourMaterial:{type:"ElevationContour"},slopeRampMaterial:{type:"SlopeRamp"}},components:{diffuse:"contourMaterial.alpha == 0.0 ? slopeRampMaterial.diffuse : contourMaterial.diffuse",alpha:"max(contourMaterial.alpha, slopeRampMaterial.alpha)"}},translucent:!0}),this.shadingUniforms=a.materials.slopeRampMaterial.uniforms,this.contourUniforms=a.materials.contourMaterial.uniforms):"aspect"===o?(a=new h.Material({fabric:{type:"AspectColorContour",materials:{contourMaterial:{type:"ElevationContour"},aspectRampMaterial:{type:"AspectRamp"}},components:{diffuse:"contourMaterial.alpha == 0.0 ? aspectRampMaterial.diffuse : contourMaterial.diffuse",alpha:"max(contourMaterial.alpha, aspectRampMaterial.alpha)"}},translucent:!1}),this.shadingUniforms=a.materials.aspectRampMaterial.uniforms,this.contourUniforms=a.materials.contourMaterial.uniforms):(a=h.Material.fromType("ElevationContour"),this.contourUniforms=a.uniforms),this.contourUniforms.width=i,this.contourUniforms.spacing=r,this.contourUniforms.color=n):"elevation"===o?(a=h.Material.fromType("ElevationRamp"),this.shadingUniforms=a.uniforms,this.shadingUniforms.minimumHeight=s,this.shadingUniforms.maximumHeight=l):"slope"===o?(a=h.Material.fromType("SlopeRamp"),this.shadingUniforms=a.uniforms):"aspect"===o&&(a=h.Material.fromType("AspectRamp"),this.shadingUniforms=a.uniforms),"none"!==o&&(this.shadingUniforms.image=function(t){var e=document.createElement("canvas");e.width=100,e.height=1;var i,r=e.getContext("2d");"elevation"===t?i=g:"slope"===t?i=u:"aspect"===t&&(i=d);var n=r.createLinearGradient(0,0,100,0);7==i.length?(n.addColorStop(i[0],"#000000"),n.addColorStop(i[1],"#2747E0"),n.addColorStop(i[2],"#D33B7D"),n.addColorStop(i[3],"#D33038"),n.addColorStop(i[4],"#FF9742"),n.addColorStop(i[5],"#ffd700"),n.addColorStop(i[6],"#ffffff")):(n.addColorStop(i[0],"#0a8d33"),n.addColorStop(i[1],"#599668"),n.addColorStop(i[2],"#afdd76"),n.addColorStop(i[3],"#fafcb4"),n.addColorStop(i[4],"#f2b602"),n.addColorStop(i[5],"#eea706"),n.addColorStop(i[6],"#df7702"),n.addColorStop(i[7],"#a52100"),n.addColorStop(i[8],"#682b06"),n.addColorStop(i[9],"#6a2402"),n.addColorStop(i[10],"#420202"));return r.fillStyle=n,r.fillRect(0,0,100,1),e}(o)),this.scene.globe.material=a,!0};var g=[0,.045,.1,.15,.37,.54,1],u=[0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1],d=[0,.2,.4,.6,.8,.9,1]}(window.Cesium),function(N){var t=N.GeoTilesetFlatten=function(t){t=N.defaultValue(t,N.defaultValue.EMPTY_OBJECT),this._ready=!1,this.dirty=!1,this.polys=[],this.isCartesian3Point=N.defaultValue(t.isCartesian3Point,!0),this.show=N.defaultValue(t.show,!0),this.ellipsoid=N.defaultValue(t.ellipsoid,N.Ellipsoid.WGS84)};function e(t){var e=t.content._model;N.defined(e)&&N.defined(e.platSlot)&&delete e.platSlot}function i(t){var e=t.content._model;if(N.defined(e)){var i=e.platSlot;if(!N.defined(i))throw new N.DeveloperError("storing of model vertex buffers is fail.")}}t.prototype.bindTileset=function(t){if(!N.defined(t))throw new N.DeveloperError("parameter tileset is required.");if(N.defined(this._tileset))throw new N.DeveloperError("There is a tileset already, Only One Bind");this._tileset=t,(this._tileset.platBodyDebug=this).dirty=!0,this._tileset.tileUnload.addEventListener(e),this._tileset.tileLoad.addEventListener(i)},t.prototype.showPlat=function(t){this.show!=t&&(that.dirty=!0),this.show=t},t.prototype.isPlatShow=function(t){return this.show},t.prototype.isPlatDirty=function(){return this.dirty},t.prototype.clearPlatDirty=function(){this.dirty=!1},t.prototype.addPlatArea=function(t){var e=this;if(void 0!==t&&t instanceof Array){var i=t.length;if(!(i<3)){for(var r=[],n=e.isCartesian3Point,o=0;o<i;o++){var a=t[o];n?void 0!==a.height?r.push(N.Cartesian3.fromRadians(a.longitude,a.latitude,a.height,e.ellipsoid)):r.push(N.Cartesian3.clone(a,new N.Cartesian3)):void 0!==a.height?r.push(N.Cartographic.clone(a,new N.Cartographic)):r.push(N.Cartographic.fromCartesian(a,e.ellipsoid,new N.Cartographic))}if(e.isCartesian3Point){if(!r[0].equals(r[i-1])){var s=N.Cartesian3.clone(r[0],new N.Cartesian3);r.push(s)}}else if(!N.Cartographic.equals(r[0],r[i-1])){s=N.Cartographic.clone(r[0],new N.Cartographic);r.push(s)}var l={};l.platPickPoints=r,l._show=!0,e.polys.push(l);var h=e.polys.length-1;return e.dirty=!0,e.initPlatBodyDebug(),this._ready=!0,h}}},t.prototype.getPlatArea=function(t){if(void 0!==t&&"number"==typeof t&&t<this.polys.length){var e=this.polys[t];if(void 0===e)return;var i=e.platPickPoints;if(void 0===i)return;for(var r=[],n=0;n<i.length;n++){var o=N.Cartesian3.clone(i[n],new N.Cartesian3);r.push(o)}return r}},t.prototype.removePlatArea=function(t){void 0!==t&&"number"==typeof t&&t<this.polys.length&&(delete this.polys[t],this.dirty=!0)},t.prototype.showPlatArea=function(t,e){void 0!==t&&"number"==typeof t&&t<this.polys.length&&(this.polys[t]._show=e,this.dirty=!0)},t.prototype.initRegionMatrixes=function(t){var e=t,i=e._pickObject.content._tile;if(N.defined(e._runtime.rootNodes)&&!(e._runtime.rootNodes.length<1)){var r=i._boundingVolume._orientedBoundingBox.halfAxes,n=i._boundingVolume._orientedBoundingBox.center,o={};if(o.matOrg=this.createHalfMatrix(r),o.matOrgI=this.invertMatrix(o.matOrg),N.defined(o.matOrgI)&&(o.matPrj=N.Transforms.eastNorthUpToFixedFrame(n,this.ellipsoid,new N.Matrix4),o.matPrjI=this.invertMatrix(o.matPrj),N.defined(o.matPrjI)))return o.modelMatrix=N.Matrix4.clone(e._runtime.rootNodes[0].computedMatrix,new N.Matrix4),o}},t.prototype.initBoxMatrixes=function(t){var e=t,i=e._pickObject.content._tile;if(N.defined(e._runtime.rootNodes)&&!(e._runtime.rootNodes.length<1)){var r=i._boundingVolume._orientedBoundingBox.center,n={};if(n.matPrj=N.Transforms.eastNorthUpToFixedFrame(r,this.ellipsoid,new N.Matrix4),n.matPrjI=this.invertMatrix(n.matPrj),N.defined(n.matPrjI)&&(n.modelMatrix=N.Matrix4.clone(e._runtime.rootNodes[0].computedMatrix,new N.Matrix4),n.modelMatrixI=this.invertMatrix(n.modelMatrix),N.defined(n.modelMatrixI)))return n}},t.prototype.toPlatRegionModel=function(t,e){var i=e,r=i.platSlot.buffers,n=r.length,o=this.initRegionMatrixes(i);if(N.defined(o)){this.initializePlatPoly(i);for(var a=0;a<n;a++){var s=r[a];if(void 0!==s)if(1!=s.showPlat){s.showPlat=!0;for(var l=s.buffer.slice(0),h=new Float32Array(l.buffer,l.byteOffset,l.length/Float32Array.BYTES_PER_ELEMENT),c=0,g=[],u=[],d=0;d<h.length;d+=3){var p=new N.Cartesian3(h[d],h[d+1],h[d+2]);u.push(p),(C=N.Matrix4.multiplyByPoint(o.matOrgI,p,new N.Cartesian3)).z<c&&(c=C.z),g.push(C)}for(d=0;d<g.length;d++){var C=g[d];p=u[d];p=N.Matrix4.multiplyByPoint(o.modelMatrix,p,new N.Cartesian3),p=N.Matrix4.multiplyByPoint(o.matPrjI,p,new N.Cartesian3),this.isPlatPoint(i,p)&&(C.z=c),C=N.Matrix4.multiplyByPoint(o.matOrg,C,new N.Cartesian3),h[3*d]=C.x,h[3*d+1]=C.y,h[3*d+2]=C.z}this.replaceCommandVertexBuffer(i,l,a,t)}}i.platSlot.platPolys=void 0}},t.prototype.toPlatBoxModel=function(t,e){var i=this,r=e,n=r.platSlot.buffers,o=n.length,a=i.initBoxMatrixes(r);if(N.defined(a)){var s={};i.initializePlatPoly(r);for(var l=0;l<o;l++){var h=n[l];if(!h.showPlat||i.isPlatDirty()){h.showPlat=!0;for(var c=h.buffer.slice(0),g=new Float32Array(c.buffer,c.byteOffset,c.length/Float32Array.BYTES_PER_ELEMENT),u=0;u<g.length;u+=3){var d=new N.Cartesian3(g[u],g[u+1],g[u+2]);d=N.Cartesian3.clone(d);var p=N.Matrix4.multiplyByPoint(a.modelMatrix,d,new N.Cartesian3);s.pt=p,d=N.Matrix4.multiplyByPoint(a.matPrjI,p,new N.Cartesian3),i.isPlatPoint(r,d,s)&&(p=N.Matrix4.multiplyByPoint(a.modelMatrixI,s.pt,new N.Cartesian3),g[u]=p.x,g[u+1]=p.y,g[u+2]=p.z)}i.replaceCommandVertexBuffer(r,c,l,t)}}r.platSlot.platPolys=void 0}},t.prototype.toPlatModel=function(t,e){var i=e._pickObject.content._tile._header.boundingVolume.region;N.defined(i)?this.toPlatRegionModel(t,e):this.toPlatBoxModel(t,e)},t.prototype.toUnplatModel=function(t,e){for(var i=e,r=i.platSlot.buffers,n=r.length,o=0;o<n;o++){var a=r[o];if(void 0!==a)if(0!=a.showPlat){a.showPlat=!1;var s=a.buffer.slice(0);this.replaceCommandVertexBuffer(i,s,o,t)}}i.platSlot.platPolys=void 0},t.prototype.platModel=function(t,e){var i=e;if(this._ready&&void 0!==i.platSlot&&void 0!==i.platSlot.buffers&&!(i.platSlot.buffers.length<1)){var r=this.hitPlatTest(i);(r||i.platSlot.isUsed)&&(i.platSlot.isUsed=!0,r?this.toPlatModel(t,e):this.toUnplatModel(t,e))}},t.prototype.hitPlatTest=function(t){var e=t,i=this.polys,r=i.length;if(r<1)return!1;for(var n=0;n<r;n++){var o=i[n];if(void 0!==o&&(void 0!==o.platPickRegion&&this.hitPlatTestByRegion(e,o.platPickRegion)))return!0}return!1},t.prototype.initPlatBodyDebug=function(){var t=this,e=t.ellipsoid;if(t.isCartesian3Point){if(void 0===(a=t.polys))return;if(void 0===(s=a.length)||s<1)return;if(!t.dirty)return;for(var i=0;i<s;i++){if(void 0!==(l=a[i])&&!N.defined(l.platPickRegion)){if(void 0===(d=l.platPickPoints))return;if(void 0===(p=d.length)||p<1)return;for(var r=0;r<p;r++){var n=N.Cartesian3.clone(d[r],new N.Cartesian3),o=N.Cartographic.fromCartesian(n,e);0!=r?(c>o.longitude?c=o.longitude:h<o.longitude&&(h=o.longitude),g>o.latitude?g=o.latitude:u<o.latitude&&(u=o.latitude)):(h=c=o.longitude,g=u=o.latitude)}l.platPickRegion={west:c,south:g,east:h,north:u}}}}else{var a,s;if(void 0===(a=t.polys))return;if(void 0===(s=a.length)||s<1)return;if(!t.dirty)return;for(i=0;i<s;i++){var l;if(void 0!==(l=a[i])&&!N.defined(l.platPickRegion)){var h,c,g,u,d,p;if(void 0===(d=l.platPickPoints))return;if(void 0===(p=d.length)||p<1)return;h=c=d[0].longitude,g=u=d[0].latitude;for(r=1;r<p;r++){c>(n=N.Cartographic.clone(d[r],new N.Cartographic)).longitude?c=n.longitude:h<n.longitude&&(h=n.longitude),g>n.latitude?g=n.latitude:u<n.latitude&&(u=n.latitude)}l.platPickRegion={west:c,south:g,east:h,north:u}}}}},t.prototype.createTileRegion=function(t){var e=t._header.boundingVolume;if(N.defined(e)){if(void 0!==e.region){var i=e.region;if(!N.defined(i))return;return{west:i[0],south:i[1],east:i[2],north:i[3]}}if(e.box){if(!N.defined(t._boundingVolume))return;var r=t._boundingVolume._orientedBoundingBox;if(!N.defined(r))return;var n,o=N.Cartesian3.add,a=N.Cartesian3.subtract,s=[];for(n=0;n<3;n++){var l=new N.Cartesian3(r.halfAxes[3*n],r.halfAxes[3*n+1],r.halfAxes[3*n+2]),h=[];h.push({f:o,a:l}),h.push({f:a,a:l}),s.push(h)}var c,g,u,d,p,C,m=this.ellipsoid,f=r.center,v=[],A=s[0],I=s[1],_=s[2];for(n=0;n<A.length;n++)for(var y=A[n],w=N.Cartesian3.clone(f,new N.Cartesian3),P=y.f(w,y.a,new N.Cartesian3),x=0;x<I.length;x++)for(var b=I[x],E=b.f(P,b.a,new N.Cartesian3),T=0;T<_.length;T++){var S=_[T],M=S.f(E,S.a,new N.Cartesian3);v.push(M)}for(c=g=v[0].x,u=d=v[0].y,p=C=v[0].z,n=1;n<v.length;n++){var D=v[n];c>D.x?c=D.x:g<D.x&&(g=D.x),u>D.y?u=D.y:d<D.y&&(d=D.y),p>D.z?p=D.z:C<D.z&&(C=D.z)}var R,L,F,O,k=[];for(k.push(N.Cartographic.fromCartesian(new N.Cartesian3(c,u,p),m,new N.Cartographic)),k.push(N.Cartographic.fromCartesian(new N.Cartesian3(g,d,C),m,new N.Cartographic)),n=0;n<k.length;n++){var B=k[n];0!=n?(R>B.longitude?R=B.longitude:L<B.longitude&&(L=B.longitude),O>B.latitude?O=B.latitude:F<B.latitude&&(F=B.latitude)):(R=L=B.longitude,F=O=B.latitude)}return{west:R,south:O,east:L,north:F}}}},t.prototype.hitPlatTestByRegion=function(t,e){return!!N.defined(e)},t.prototype.initializePlatPoly=function(t){this.isCartesian3Point?this.initializeCartesianPlatPoly(t):this.initializeCartographicPlatPoly(t)},t.prototype.initializeCartesianPlatPoly=function(t){var e=this,i=t,r=i.platSlot;if(N.defined(r.platPolys)){if(!e.isPlatDirty())return;delete r.platPolys}var n,o=e.ellipsoid,a=e.polys;if(N.defined(i._runtime.rootNodes)&&(n=i._runtime.rootNodes[0].computedMatrix),N.defined(n)){var s=e.invertMatrix(n);if(N.defined(s)){r.platPolys=[];var l,h,c=r.platPolys;for(h=0;h<a.length;h++){var g=a[h];if(N.defined(g)){var u,d,p,C,m=g.platPickPoints,f=new N.Cartesian3,v=[];for(l=1;l<m.length;l++){var A=m[l];f=N.Cartesian3.add(f,A,new N.Cartesian3);var I=N.Matrix4.multiplyByPoint(s,A,new N.Cartesian3);v.push(I),N.defined(u)?(u>I.x?u=I.x:p<I.x&&(p=I.x),d>I.y?d=I.y:C<I.y&&(C=I.y)):(u=p=I.x,d=C=I.y)}f=N.Cartesian3.divideByScalar(f,v.length,new N.Cartesian3);var _={pts:v,minX:u,minY:d,maxX:p,maxY:C,compressPlane:e.initCompressPlane(o,f),show:g._show};c.push(_)}}}}},t.prototype.initializeCartographicPlatPoly=function(t){var e=this,i=t,r=i._pickObject.content._tile,n=i.platSlot;if(N.defined(n.platPolys)){if(!e.isPlatDirty())return;n.platPolys=void 0}var o,a=e.ellipsoid,s=e.polys;if(N.defined(r._boundingVolume)&&N.defined(r._boundingVolume._orientedBoundingBox)&&(o=r._boundingVolume._orientedBoundingBox.center),N.defined(o)){var l,h=N.Transforms.eastNorthUpToFixedFrame(o,a,new N.Matrix4),c=e.invertMatrix(h);if(N.defined(c))if(N.defined(i._runtime)&&N.defined(i._runtime.rootNodes)&&0<i._runtime.rootNodes.length&&N.defined(i._runtime.rootNodes[0])&&(l=i._runtime.rootNodes[0].computedMatrix),N.defined(l)){var g=e.invertMatrix(l);if(N.defined(g)){n.platPolys=[];var u,d,p=n.platPolys;for(d=0;d<s.length;d++){var C=s[d];if(N.defined(C)){var m=C.platPickPoints;if(N.defined(m)&&!(m.length<1)){var f,v,A,I,_=new N.Cartesian3,y=[];for(u=0;u<m.length;u++){var w,P=m[u];if(e.isCartesian3Point)w=N.Cartesian3.clone(P,new N.Cartesian3),_=N.Cartesian3.add(_,w,new N.Cartesian3),w=N.Matrix4.multiplyByPoint(g,w,new N.Cartesian3);else{w=N.Cartographic.clone(P,new N.Cartographic);var x=N.Cartesian3.fromRadians(w.longitude,w.latitude,0,a);_=N.Cartesian3.add(_,x,new N.Cartesian3),w=N.Matrix4.multiplyByPoint(c,x,new N.Cartesian3)}y.push(w),N.defined(f)?(f>w.x?f=w.x:A<w.x&&(A=w.x),v>w.y?v=w.y:I<w.y&&(I=w.y)):(f=A=w.x,v=I=w.y)}_=N.Cartesian3.divideByScalar(_,y.length,new N.Cartesian3);var b={pts:y,minX:f,minY:v,maxX:A,maxY:I,compressPlane:e.initCompressPlane(a,_)};p.push(b)}}}}}}},t.prototype.initCompressPlane=function(t,e){var i=N.Cartesian3.clone(e,new N.Cartesian3),r=N.Cartographic.fromCartesian(i,t,new N.Cartographic),n=N.Cartesian3.fromRadians(r.longitude,r.latitude,0,t);if(!i.equals(n))return N.Plane.fromPointNormal(i,N.Cartesian3.normalize(N.Cartesian3.subtract(i,n,new N.Cartesian3),new N.Cartesian3))},t.prototype.isPlatPointNoResult=function(t,e){for(var i=t.platSlot.platPolys,r=N.Cartesian3.clone(e,new N.Cartesian3),n=0;n<i.length;n++){var o=i[n];if(N.defined(o)&&this.isInsidedPoint(o,r))return!0}return!1},t.prototype.isPlatPointResult=function(t,e,i){for(var r=t.platSlot.platPolys,n=N.Cartesian3.clone(e,new N.Cartesian3),o=N.Cartesian3.clone(i.pt,new N.Cartesian3),a=!1,s=0;s<r.length;s++){var l=r[s];if(N.defined(l))if(this.isInsidedPoint(l,n)){0;var h=this.mapPosition(l.compressPlane,o);N.defined(h)&&(o=h),a=!0}else;}return a&&(i.pt=o),a},t.prototype.isPlatPoint=function(t,e,i){return N.defined(i)?this.isPlatPointResult(t,e,i):this.isPlatPointNoResult(t,e)},t.prototype.mapPosition=function(t,e){if(N.defined(t)&&N.defined(e)&&N.defined(t.normal)){var i=N.Cartesian3.clone(t.normal,new N.Cartesian3),r=N.Cartesian3.clone(e,new N.Cartesian3),n=new N.Ray(r,i),o=N.IntersectionTests.rayPlane(n,t);if(N.defined(o))return r;var a=N.Cartesian3.negate(i,new N.Cartesian3),s=new N.Ray(r,a),l=N.IntersectionTests.rayPlane(s,t);if(!N.defined(l))return r;var h=N.Cartesian3.distance(l,r);return N.Cartesian3.add(r,N.Cartesian3.multiplyByScalar(a,h,new N.Cartesian3),new N.Cartesian3)}},t.prototype.isInsidedPoint=function(t,e){var i=this;if(!N.defined(t))return!1;if(!N.defined(t.show)||!t.show)return!1;if(!N.defined(e))return!1;var r,n,o=e.x,a=e.y;if(o<t.minX||o>t.maxX||a<t.minY||a>t.maxY)return!1;var s,l,h,c,g,u,d={z:!1,b:!1,t:!1},p=t.pts,C=p.length;for(r=0,n=C-1;r<C;n=r++){if(s=p[r],l=p[n],h=s.x,c=s.y,g=l.x,u=l.y,i.isEqualFloat(u,c)){if(i.isEqualFloat(a,c)){if(i.isEqualFloat(o,h))return!0;if(i.isEqualFloat(o,g))return!0;if(o<h==g<o)return!0}}else if(i.isEqualFloat(a,c)){if(i.isEqualFloat(o,h))return!0;h<o&&(u<a?d.b=!d.b:d.t=!d.t)}else if(i.isEqualFloat(a,u)){if(i.isEqualFloat(o,g))return!0;g<o&&(c<a?d.b=!d.b:d.t=!d.t)}if(a<c!=a<u){var m=(g-h)/(u-c);if(m*=a-c,m+=h,i.isEqualFloat(o,m))return!0;o<m&&(d.z=!d.z)}}return d.t==d.b?d.t?!d.z:d.z:void 0},t.prototype.isEqualFloat=function(t,e,i){if(N.defined(i)||(i=1e-8),!N.defined(t))return!1;if(!N.defined(e))return!1;var r=t-e;return(r=Math.abs(r))<i},t.prototype.replaceCommandVertexBuffer=function(t,e,i,r){var n=t;if(N.defined(e)&&N.defined(i)&&"number"==typeof i&&N.defined(r)&&N.defined(r.context)){var o=n._nodeCommands;if(N.defined(o))if(!(o.length<=i)){var a=N.Buffer.createVertexBuffer({context:r.context,typedArray:e,usage:N.BufferUsage.STATIC_DRAW});if(N.defined(a)){var s=o[i];if(N.defined(s)){var l=s.command;if(N.defined(l)){var h=l._vertexArray;if(N.defined(h)){var c=h._attributes;if(N.defined(c)&&0<c.length){var g=c[0];if(!N.defined(g))return;var u=g.vertexBuffer;N.defined(u)&&!u.isDestroyed()&&u.vertexArrayDestroyable&&u.destroy(),g.vertexBuffer=a;var d=h._vao;N.defined(d)&&(r.context.glDeleteVertexArray(h._vao),h._vao=void 0)}}}}}}}},t.prototype.storeVertexBuffer=function(t){if(N.defined(t)){var e=t;if(!N.defined(e.platSlot)){var i=e._pickObject;if(N.defined(i)){var r=i.content;if(N.defined(r)){var n=r._tileset;if(N.defined(n)&&N.defined(n.platBodyDebug)){var o=e._loadResources;if(N.defined(o)){var a=e._cachedGltf._gltf;if(N.defined(a)){var s=a.accessors;if(N.defined(s)){var l=a.bufferViews;if(N.defined(l)){var h=a.meshes;if(N.defined(h)){e.platSlot={},e.platSlot.buffers=[],e.platSlot.isUsed=!1;for(var c=0;c<h.length;c++){var g=h[c];if(N.defined(g)){var u=g.primitives;if(N.defined(u))for(var d=0;d<u.length;d++){var p=u[d];if(N.defined(p)){var C=p.attributes;if(N.defined(C))for(var m in C)if("POSITION"===m){var f=l[s[C[m]].bufferView],v=o.getBuffer(f),A=v.slice(0,v.length);e.platSlot.buffers.push({buffer:A,showPlat:!1})}}}}}}}}}}}}}}}},t.prototype.invertMatrix=function(t){var e=void 0;try{e=N.Matrix4.inverse(t,new N.Matrix4)}catch(t){}return e},t.prototype.createMatrix=function(t){if(N.defined(t)){var e=new N.Matrix4;return N.Matrix4.setColumn(e,0,new N.Cartesian4(t[0].x,t[0].y,t[0].z,0),e),N.Matrix4.setColumn(e,1,new N.Cartesian4(t[1].x,t[1].y,t[1].z,0),e),N.Matrix4.setColumn(e,2,new N.Cartesian4(t[2].x,t[2].y,t[2].z,0),e),N.Matrix4.setColumn(e,3,new N.Cartesian4(0,0,0,1),e),e}},t.prototype.createHalfMatrix=function(t){if(N.defined(t)){for(var e=[],i=0;i<3;i++)e.push(this.createNormal(t[3*i],t[3*i+1],t[3*i+2]));return this.createMatrix(e)}},t.prototype.createNormal=function(t,e,i){return N.Cartesian3.normalize(new N.Cartesian3(t,e,i),new N.Cartesian3)}}(window.Cesium),function(h){var l="GEOVIEWRADAR_TIP",a="GEOVIEWRADAR_LIGHTPOINT",t=h.GeoViewRadar=function(t,e){this.viewer=t.viewer,this.pointLightHeight=h.defaultValue(t.pointLightHeight,.2),this.boundingSphereStackPartitions=h.defaultValue(t.boundingSphereStackPartitions,100),this.boundingSphereSlicePartitions=h.defaultValue(t.boundingSphereSlicePartitions,80),this.boundingSphereSubdivisions=h.defaultValue(t.boundingSphereSubdivisions,100),this.scene=this.viewer.scene,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.callback=e||null,parseFloat(h.VERSION)<1.5&&console.error("当前Cesium版本："+h.VERSION+",雷达分析暂不支持该版本，请更换至1.50以上的版本!")};function c(t,e,i){var r=t.scene.pickPosition(e);if(r){var n=h.Cartographic.fromCartesian(r);if(n.height<0){t.scene.globe.depthTestAgainstTerrain=!0,t.viewer.terrainShadows=h.ShadowMode.CAST_ONLY;var o=t.scene.camera.getPickRay(e),a=t.scene.globe.pick(o,t.scene);n=h.Cartographic.fromCartesian(a)}i=i||0;var s=h.Cartesian3.fromRadians(n.longitude,n.latitude,n.height+i),l=h.Cartographic.fromCartesian(s);return[h.Math.toDegrees(l.longitude),h.Math.toDegrees(l.latitude),l.height]}}function g(t,e,i,r){var n=t.add(new h.LabelCollection);return n.add({text:e,font:"16px sans-serif",showBackground:!0,position:i,pixelOffset:new h.Cartesian2(10,-30)}),n.name=r,n}function u(t,e,i){for(var r=0;r<t.length;r++)t.name==i&&(t.get(r).position=e)}function i(t,e){s(t,e)}function s(t,e){for(var i=0;i<e.length;i++)e.get(i).name==t&&(e.remove(e.get(i)),i--)}t.prototype.activate=function(){this.clear(),this.canvas.style.cursor="crosshair";var r=null,n=null,o=!0,e=null,a=null,s=this;this.handler=new h.ScreenSpaceEventHandler(this.canvas),this.handler.setInputAction(function(t){r=(o=o?(e=c(s,t.position,s.pointLightHeight),a=h.Cartesian3.fromDegrees(e[0],e[1],e[2]),i(l,s.primitives),!1):(s.scene.shadowMap.enableGeoViewRadar=!0,s.canvas.style.cursor="default",s.handler&&!s.handler.isDestroyed()&&s.handler.destroy(),i(l,s.primitives),!0),s.firstLeftClick=o,null)},h.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(t){if(s.tipPosition=s.scene.pickPosition(t.endPosition),s.tipPosition&&(o&&(r?u(r,s.tipPosition,l):r=g(s.primitives,"单击左键确定雷达位置",s.tipPosition,l)),!o)){r?u(r,s.tipPosition,l):r=g(s.primitives,"单击左键固定雷达半径",s.tipPosition,l);var e=c(s,t.endPosition),i=h.Cartesian3.fromDegrees(e[0],e[1],e[2]);n=h.Cartesian3.distance(a,i),s.dynamicAnalysis(a,n),s.pointLightPosition=a,s.realTimeRadius=n,s.firstLeftClick=o}},h.ScreenSpaceEventType.MOUSE_MOVE)},t.prototype.dynamicAnalysis=function(t,e){if(t&&e){var i=new h.Camera(this.scene);i.position=t,s(a,this.primitives);var r,n=this.primitives.add(new h.PointPrimitiveCollection);n.name=a,n.add({position:t,color:h.Color.YELLOW,pixelSize:5}),r={context:this.scene.context,lightCamera:i,isPointLight:!0},this.scene.shadowMap.destroy(),this.scene.shadowMap=new h.ShadowMap(r);var o=this.scene.shadowMap;o.enabled=!0,o.debugShow=!0,o.enableGeoViewRadar=!0,o.size=1024,o._pointLightRadius=e,o._boundingSphere.stackPartitions=this.boundingSphereStackPartitions,o._boundingSphere.slicePartitions=this.boundingSphereSlicePartitions,o._boundingSphere.subdivisions=this.boundingSphereSubdivisions}},t.prototype.clear=function(){this.scene.shadowMap.enabled=!1,this.scene.shadowMap.enableGeoViewRadar=void 0,this.canvas.style.cursor="default",this.handler&&!this.handler.isDestroyed()&&this.handler.destroy(),i(l,this.primitives),s(a,this.primitives)},t.prototype.destroy=function(){this.clear(),this.viewer=void 0,this.pointLightHeight=void 0,this.scene=void 0,this.canvas=void 0,this.primitives=void 0,this.callback=void 0}}(window.Cesium),function(C){var d="GEOVIEWSHED3D_TIP",m="GEOVIEWSHED3D_SPOTID",t=C.GeoViewShed3D=function(t,e){this.viewer=t.viewer,this.spotLightHeight=C.defaultValue(t.spotLightHeight,1),this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.callback=e||null,this._shadowMapNum=0,this._spotLightCameraList=[],null==this.scene.expandShadowMapList&&(this.scene.expandShadowMapList=[]),parseFloat(C.VERSION)<1.5&&console.error("当前Cesium版本："+C.VERSION+",可视域分析暂不支持该版本，请更换至1.50以上的版本!")};function p(t,e,i){var r=t.scene.pickPosition(e);if(r){var n=C.Cartographic.fromCartesian(r);if(n.height<0){t.scene.globe.depthTestAgainstTerrain=!0,t.viewer.terrainShadows=C.ShadowMode.ENABLED;var o=t.camera.getPickRay(e),a=t.scene.globe.pick(o,t.scene);n=C.Cartographic.fromCartesian(a)}i=i||0;var s=C.Cartesian3.fromRadians(n.longitude,n.latitude,n.height+i),l=C.Cartographic.fromCartesian(s);return[C.Math.toDegrees(l.longitude),C.Math.toDegrees(l.latitude),l.height]}}function f(t,e,i,r){var n=t.add(new C.LabelCollection);return n.add({text:e,font:"16px sans-serif",showBackground:!0,position:i,pixelOffset:new C.Cartesian2(10,-10)}),n.name=r,n}function v(t,e,i){for(var r=0;r<t.length;r++)t.name==i&&(t.get(r).position=e)}function i(t,e){!function(t,e){for(var i=0;i<e.length;i++)e.get(i).name==t&&(e.remove(e.get(i)),i--)}(t,e)}function A(t,e){for(var i=0;i<e.length;i++)e.get(i).id==t&&(e.remove(e.get(i)),i--)}t.prototype.activate=function(){var o=null,t=this._spotLightCameraList.length;this._spotLightCameraList[t]=new C.Camera(this.scene),this.scene.shadowMap.enabled=!1;var a=null,s=null,l=null;this.handler&&!this.handler.isDestroyed()&&this.handler.destroy(),this.canvas.style.cursor="crosshair";var h=this,c=!0,g=null,u=null;this.handler=new C.ScreenSpaceEventHandler(this.canvas),this.handler.setInputAction(function(t){c?(g=p(h,t.position,h.spotLightHeight),c=!1,h.firstLeftClick=c,i(d,h.primitives),o=null):(h.handler&&!h.handler.isDestroyed()&&h.handler.destroy(),c=!0,h.firstLeftClick=c,h.canvas.style.cursor="default",i(d,h.primitives),o=null,h._shadowMapNum++)},C.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(t){if(h.tipPosition=h.scene.pickPosition(t.endPosition),h.tipPosition&&(c&&(o?v(o,h.tipPosition,d):o=f(h.primitives,"单击左键确定观察位置",h.tipPosition,d)),!c)){o?v(o,h.tipPosition,d):o=f(h.primitives,"单击左键固定视域范围",h.tipPosition,d),u=p(h,t.endPosition),a=turf.bearing(turf.point([g[0],g[1]]),turf.point([u[0],u[1]]));var e=turf.distance(turf.point([g[0],g[1]]),turf.point([u[0],u[1]])),i=u[2]-g[2];s=C.Math.toDegrees(Math.atan(i/(1e3*e)));var r=C.Cartesian3.fromDegrees(g[0],g[1],g[2]),n=C.Cartesian3.fromDegrees(u[0],u[1],u[2]);l=C.Cartesian3.distance(r,n),h.analysis({observePtCoordinate:g,frustumLength:l,frustumHead:a,frustumPitch:s,frustumField:30}),h.spotLightPosition=g,h.realTimeHeading=a,h.realTimePitching=s,h.realTimeDistance=l,h.realTimeFieldAngle=30,h.firstLeftClick=c}},C.ScreenSpaceEventType.MOUSE_MOVE)},t.prototype.analysis=function(t){var e=t.observePtCoordinate,i=t.frustumLength,r=t.frustumHead,n=t.frustumPitch,o=t.frustumField;if(null!=e&&null!=i&&null!=r&&null!=n&&null!=o){var a=C.Cartesian3.fromDegrees(e[0],e[1],e[2]),s=C.Math.toRadians(r),l=C.Math.toRadians(n),h=this._spotLightCameraList.length,c=m+(h-1),g=this.scene.expandShadowMapList.length;g>this._shadowMapNum&&this.scene.expandShadowMapList.splice(g-1,1);var u,d=this._spotLightCameraList[h-1];d.frustum=new C.PerspectiveFrustum({fov:C.Math.toRadians(o),aspectRatio:1.6,near:1,far:i}),u={context:this.scene.context,lightCamera:d,cascadesEnabled:!1,darkness:.5,isPointLight:!1},this.scene.expandShadowMapList.push(new C.ShadowMap(u));var p=this.scene.expandShadowMapList[this.scene.expandShadowMapList.length-1];p._terrainBias.depthBias=0,p.enabled=!0,p.size=2048,p.enableGeoViewShed3D=!0,d.lookAt(a,new C.HeadingPitchRange(s,l,1e-21)),A(c,this.primitives),this.primitives.add(new C.DebugCameraPrimitive({camera:d,color:C.Color.fromHsl(1,1,1,1),id:c}))}},t.prototype.clear=function(){this.scene.shadowMap.enableGeoViewShed3D=void 0;for(var t=this._spotLightCameraList.length,e=0;e<t;e++){A(m+e,this.primitives)}i(d,this.primitives),this._spotLightCameraList.length=0,this.scene.expandShadowMapList.length=0},t.prototype.destroy=function(){this.scene.shadowMap.enableGeoViewShed3D=void 0,this.handler&&!this.handler.isDestroyed()&&this.handler.destroy(),this.scene.shadowMap.enabled=!1,this.canvas.style.cursor="default",this.clear(),this.viewer=void 0,this.spotLightHeight=void 0,this.scene=void 0,this.camera=void 0,this.canvas=void 0,this.primitives=void 0,this.ellipsoid=void 0,this.callback=void 0}}(window.Cesium),function(E){var p="GeoVolumeCalculate_LINE",C="GeoVolumeCalculate_TIP",m="GeoVolumeCalculate_GON",f="GeoVolumeCalculate_DEGON",v="GeoVolumeCalculate_CORAL",t=E.GeoVolumeCalculate=function(t,e){this.viewer=t.viewer,this.scene=this.viewer.scene,this.canvas=this.scene.canvas,this.camera=this.scene.camera,this.primitives=this.scene.primitives,this.designElevation=t.designElevation?t.designElevation:4e3,this.samplingPointsNumber=t.samplingPointsNumber?t.samplingPointsNumber:500,this.callback=e||null};function T(t,e){for(var i=0,r=0;r<e.length;r++)if(e[r]==t&&i++,2==i)return!0}function S(t,e,i,r,n,o,a){var s={},l=turf.polygon([[t.geometry.coordinates[0][i[0]],e[0],e[1],t.geometry.coordinates[0][i[0]]]]),h=turf.area(l),c=a-r,g=1/3*h*c,u=turf.polygon([[t.geometry.coordinates[0][i[1]],e[0],e[1],t.geometry.coordinates[0][i[1]]]]),d=turf.area(u),p=a-n,C=turf.polygon([[t.geometry.coordinates[0][i[1]],t.geometry.coordinates[0][i[2]],e[0],e[1],t.geometry.coordinates[0][i[1]]]]),m=turf.area(C),f=turf.polygon([[t.geometry.coordinates[0][i[1]],t.geometry.coordinates[0][i[2]],e[1],e[0],t.geometry.coordinates[0][i[1]]]]),v=turf.area(f),A=v<m?m:v,I=1/3*d*p+1/3*(A-d)*(p+(a-o));return 0<=c?(s.fillVolume=g,s.fillArea=h,s.excavationVolume=I,s.excavationArea=A):(s.fillVolume=I,s.fillArea=A,s.excavationVolume=g,s.excavationArea=h),s}function M(t,e,i,r,n,o,a,s,l){var h={},c=Math.abs(t/(t-e)),g=new E.Cartesian3(0,0,0),u=E.Cartesian3.fromRadians(i.geometry.coordinates[0][r][0],i.geometry.coordinates[0][n][1],s),d=E.Cartesian3.fromRadians(i.geometry.coordinates[0][n][0],i.geometry.coordinates[0][n][1],l),p=E.Cartographic.fromCartesian(E.Cartesian3.lerp(u,d,c,g));return h.intersection=[p.longitude,p.latitude],h.vertexSerial=[o,a],h}function r(t,e){return t.add({name:C,position:e,label:{text:"左键点击绘制，右键点击结束",font:"15px sans-serif",showBackground:!0,pixeloffset:new E.Cartesian2(0,20)}})}function A(t,e){for(var i=0;i<e.values.length;i++)e.values[i].name==t&&(e.remove(e.values[i]),i--)}t.prototype.activate=function(){this.canvas.style.cursor="crosshair";var s=0,l=this,h=[],c=[],g=[],u=[],d=[];this.handler=new E.ScreenSpaceEventHandler(this.canvas),this.handler.setInputAction(function(t){var e=l.camera.getPickRay(t.position),i=l.scene.globe.pick(e,l.scene);c.push(i);var r=E.Cartographic.fromCartesian(i),n=E.Math.toDegrees(r.longitude),o=E.Math.toDegrees(r.latitude),a=r.height;g.push(n,o,a),u.push(n,o,l.designElevation),h=s?(d[s-1].polyline.positions.getValue().shift(),[d[0].polyline.positions.getValue()[1],i,d[s-1].polyline.positions.getValue()[0]]):[i,i,i],l.polylineEntity=l.viewer.entities.add({name:p,polyline:{positions:h,clampToGround:!0,width:5,material:new E.PolylineOutlineMaterialProperty({color:E.Color.ORANGE,outlineWidth:2,outlineColor:E.Color.BLACK})}}),d.push(l.polylineEntity),s++},E.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(t){if(h.length){var e=l.camera.getPickRay(t.endPosition),i=l.scene.globe.pick(e,l.scene);h.splice(h.length-2,1,i),d[s-1].polyline.positions=h,l.labelEntity?l.labelEntity.position=i:l.labelEntity=r(l.viewer.entities,i)}else l.labelEntity?l.labelEntity.position=i:l.labelEntity=r(l.viewer.entities,i)},E.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(t){var e=l.camera.getPickRay(t.position),i=l.scene.globe.pick(e,l.scene);c.push(i);var r=E.Cartographic.fromCartesian(i),n=E.Math.toDegrees(r.longitude),o=E.Math.toDegrees(r.latitude),a=r.height;g.push(n,o,a),u.push(n,o,l.designElevation),l.handler.destroy(),l.canvas.style.cursor="default",l.labelEntity&&A(C,l.viewer.entities),l.polylineEntity&&A(p,l.viewer.entities),l.VOLUME=l.volumeAnalysis(l.scene,g,l.designElevation,l.samplingPointsNumber),l.callback(l.VOLUME),l.designPolygonEntity=l.viewer.entities.add({name:f,polygon:{hierarchy:{positions:E.Cartesian3.fromDegreesArrayHeights(u)},material:E.Color.BLUE.withAlpha(.8),perPositionHeight:!0}}),l.polygonEntity=l.viewer.entities.add({name:m,polygon:{hierarchy:{positions:c},material:E.Color.GREEN.withAlpha(.5)}}),l.designPolygonEntity_coral=l.viewer.entities.add({name:v,polygon:{hierarchy:{positions:E.Cartesian3.fromDegreesArrayHeights(u)},material:E.Color.CORAL.withAlpha(.5),perPositionHeight:!0,outline:!0,outlineColor:E.Color.YELLOW.withAlpha(1),extrudedHeight:0,closeTop:!0,closeBottom:!1}})},E.ScreenSpaceEventType.RIGHT_CLICK)},t.prototype.volumeAnalysis=function(t,e,v,i){for(var A,I={features:[]},r=t.globe.ellipsoid,n=[],o=E.Cartesian3.fromDegreesArrayHeights(e),a=0;a<o.length;a++){var s=E.Math.toDegrees(r.cartesianToCartographic(o[a]).longitude),l=E.Math.toDegrees(r.cartesianToCartographic(o[a]).latitude);n.push([s,l])}n.push([E.Math.toDegrees(r.cartesianToCartographic(o[0]).longitude),E.Math.toDegrees(r.cartesianToCartographic(o[0]).latitude)]);var h=turf.lineString(n),c=turf.bbox(h),g=turf.randomPoint(2*i,{bbox:c}),u=turf.polygon([n]);for(a=0;a<g.features.length;a++){var d=turf.point(g.features[a].geometry.coordinates);turf.booleanPointInPolygon(d,u)||(g.features.splice(a,1),a--)}var p=[],C=o.concat(o[0]);for(a=0;a<C.length-1;a++)for(var m=1;m<Math.ceil(i/10);m++){var f=new E.Cartesian3(0,0,0);f=E.Cartesian3.lerp(C[a],C[a+1],m*(1/Math.ceil(i/10)),f),p.push(f)}o=o.concat(p);var _=[],y=[];for(a=0;a<o.length;a++){var w=r.cartesianToCartographic(o[a]).longitude,P=r.cartesianToCartographic(o[a]).latitude;_.push(new E.Cartographic(w,P)),y.push([w,P])}for(a=0;a<g.features.length;a++){var x=E.Math.toRadians(g.features[a].geometry.coordinates[0]),b=E.Math.toRadians(g.features[a].geometry.coordinates[1]);_.push(new E.Cartographic(x,b))}return t.sampleHeightMostDetailed(_).then(function(t){I.type="FeatureCollection";for(var e=0;e<t.length;e++)I.features.push({type:"Feature",geometry:{coordinates:[t[e].longitude,t[e].latitude],type:"Point"},properties:{z:t[e].height}});A=turf.tin(I,"z");var i=0,r=0,n=0,o=0,a=v;for(e=0;e<A.features.length;e++){var s=A.features[e].properties.a-a,l=A.features[e].properties.b-a,h=A.features[e].properties.c-a,c=[],g=[];if(s*l<0||s*h<0||l*h<0){if(s*l<0){var u=M(s,l,A.features[e],0,1,"a","b",A.features[e].properties.a,A.features[e].properties.b);c.push(u.intersection),g.push(u.vertexSerial[0],u.vertexSerial[1])}if(s*h<0){u=M(s,h,A.features[e],0,2,"a","c",A.features[e].properties.a,A.features[e].properties.c);c.push(u.intersection),g.push(u.vertexSerial[0],u.vertexSerial[1])}if(l*h<0){u=M(l,h,A.features[e],1,2,"b","c",A.features[e].properties.b,A.features[e].properties.c);c.push(u.intersection),g.push(u.vertexSerial[0],u.vertexSerial[1])}var d;if(T("a",g))r+=(d=S(A.features[e],c,[0,1,2],A.features[e].properties.a,A.features[e].properties.b,A.features[e].properties.c,a)).fillVolume,o+=d.fillArea,i+=d.excavationVolume,n+=d.excavationArea;if(T("b",g))r+=(d=S(A.features[e],c,[1,0,2],A.features[e].properties.b,A.features[e].properties.a,A.features[e].properties.c,a)).fillVolume,o+=d.fillArea,i+=d.excavationVolume,n+=d.excavationArea;if(T("c",g))r+=(d=S(A.features[e],c,[2,0,1],A.features[e].properties.c,A.features[e].properties.a,A.features[e].properties.b,a)).fillVolume,o+=d.fillArea,i+=d.excavationVolume,n+=d.excavationArea}else{var p=turf.polygon([A.features[e].geometry.coordinates[0]]),C=turf.area(p),m=1/3*[a-A.features[e].properties.a+(a-A.features[e].properties.b)+(a-A.features[e].properties.c)];0<=m?(r+=C*m,o+=C):(i+=C*m,n+=C)}}var f={fillVolume:Number(r.toFixed(3)),excavationVolume:Number(Math.abs(i).toFixed(3)),totalVolume:Number(r.toFixed(3))+Number(Math.abs(i).toFixed(3)),fillArea:Number(o.toFixed(3)),excavationArea:Number(n.toFixed(3)),totalArea:Number(o.toFixed(3))+Number(n.toFixed(3))};return new Promise(function(t){t(f)})})},t.prototype.clear=function(){this.canvas.style.cursor="default",this.handler&&!this.handler.isDestroyed()&&this.handler.destroy(),this.polylineEntity&&A(p,this.viewer.entities),this.labelEntity&&A(C,this.viewer.entities),this.polygonEntity&&A(m,this.viewer.entities),this.designPolygonEntity&&A(f,this.viewer.entities),this.designPolygonEntity_coral&&A(v,this.viewer.entities),this.polylineEntity=void 0,this.labelEntity=void 0},t.prototype.destroy=function(){this.clear(),this.viewer=void 0,this.scene=void 0,this.canvas=void 0,this.camera=void 0,this.primitives=void 0,this.designElevation=void 0,this.samplingPointsNumber=void 0,this.callback=void 0}}(window.Cesium),function(d){var t=d.SingleBuildingWidget=function(t,e,i){this.viewer=t.viewer,this.scene=this.viewer.scene,this.globe=this.viewer.scene.globe,this.data=t.data?t.data:{},this.classificationPrimitiveCollection=new d.PrimitiveCollection,this.scene.primitives.add(this.classificationPrimitiveCollection),this.callback_click=e||function(){},this.callback_move=i||function(){},this.show=void 0===t.show||t.show,this.fillColor=t.fillColor?t.fillColor:d.Color.CORNFLOWERBLUE.withAlpha(.3),this.highlightColor_click=t.highlightColor_click?t.highlightColor_click:d.Color.YELLOW.withAlpha(.3),this.highlightColor_move=t.highlightColor_move?t.highlightColor_move:d.Color.WHITE.withAlpha(.2),this._INTERSECTED_FLOOR=null,this._INTERSECTED_FLOOR2=null,this._INTERSECTED_FLOOR3=null,this.handler=new d.ScreenSpaceEventHandler(this.viewer.canvas)};d.defineProperties(t.prototype,{show:{set:function(t){this._show=t,this.classificationPrimitiveCollection.show=t},get:function(){return this._show}}}),t.prototype.extrudeToBuilding=function(){var t=this;if(this.clear(),this._INTERSECTED_FLOOR=null,this._INTERSECTED_FLOOR2=null,this._INTERSECTED_FLOOR3=null,this.classificationPrimitiveCollection.show=this._show,t.data&&t.data.geometry){var e=0;if(t.data.properties.baseHeight)e=t.data.properties.baseHeight;else if(t.scene.sampleHeightSupported){var i=t.data.geometry.coordinates[0][0],r=new d.Cartographic(d.Math.toRadians(i[0]),d.Math.toRadians(i[1]));e=t.scene.sampleHeight(r)}else(e=t.globe.getHeight({longitude:d.Math.toRadians(t.data.geometry.coordinates[0][0][0]),latitude:d.Math.toRadians(t.data.geometry.coordinates[0][0][1])}))||console.error("地形还未准备好！");if(!e)return void console.warn("建筑物基础高度baseHeight是必需的！");for(var n=t.data.properties.levels,o=[],a=0;a<t.data.geometry.coordinates[0].length;a++)o.push(t.data.geometry.coordinates[0][a][0]),o.push(t.data.geometry.coordinates[0][a][1]);for(var s=0,l=0;l<n.length;l++){var h=e+s,c=h+n[l],g=new d.GeometryInstance({geometry:d.PolygonGeometry.fromPositions({positions:d.Cartesian3.fromDegreesArray(o),height:h,extrudedHeight:c,vertexFormat:d.EllipsoidSurfaceAppearance.VERTEX_FORMAT}),attributes:{color:d.ColorGeometryInstanceAttribute.fromColor(this.fillColor)},id:{tag:"GEO_SINGLEBUILDING",description:t.data,level:l+1}}),u=new d.ClassificationPrimitive({geometryInstances:g,classificationType:d.ClassificationType.BOTH});this.classificationPrimitiveCollection.add(u),s+=n[l]}}},t.prototype.activate=function(){var o=this;o.handler.setInputAction(function(t){var e=o.scene.pick(t.position);if(e&&e.id&&"GEO_SINGLEBUILDING"==e.id.tag){if(o.callback_click(e),o._INTERSECTED_FLOOR&&o._INTERSECTED_FLOOR!=e)o._INTERSECTED_FLOOR.primitive.getGeometryInstanceAttributes(o._INTERSECTED_FLOOR.id).color=d.ColorGeometryInstanceAttribute.toValue(o.fillColor);if(o._INTERSECTED_FLOOR=e,o._INTERSECTED_FLOOR3){var i=o._INTERSECTED_FLOOR3._primitiveOptions.geometryInstances[0].id,r=o._INTERSECTED_FLOOR3.getGeometryInstanceAttributes(i);r.color.toString()==d.ColorGeometryInstanceAttribute.toValue(o.highlightColor_click).toString()&&(r.color=d.ColorGeometryInstanceAttribute.toValue(o.fillColor))}var n=o._INTERSECTED_FLOOR.primitive.getGeometryInstanceAttributes(o._INTERSECTED_FLOOR.id);if(n.color.toString()==d.ColorGeometryInstanceAttribute.toValue(o.highlightColor_click).toString())return;n.color=d.ColorGeometryInstanceAttribute.toValue(o.highlightColor_click)}},d.ScreenSpaceEventType.LEFT_CLICK),o.handler.setInputAction(function(t){var e=o.scene.pick(t.endPosition);if(e&&e.id&&"GEO_SINGLEBUILDING"==e.id.tag){if(o.callback_move(e),o._INTERSECTED_FLOOR2&&o._INTERSECTED_FLOOR2!=e)o._INTERSECTED_FLOOR2.primitive.getGeometryInstanceAttributes(o._INTERSECTED_FLOOR2.id).color=d.ColorGeometryInstanceAttribute.toValue(o.fillColor);if(o._INTERSECTED_FLOOR2=e,o._INTERSECTED_FLOOR){var i=o._INTERSECTED_FLOOR.primitive.getGeometryInstanceAttributes(o._INTERSECTED_FLOOR.id);i.color.toString()==d.ColorGeometryInstanceAttribute.toValue(o.fillColor).toString()&&(i.color=d.ColorGeometryInstanceAttribute.toValue(o.highlightColor_click))}var r=o._INTERSECTED_FLOOR2.primitive.getGeometryInstanceAttributes(o._INTERSECTED_FLOOR2.id);if(r.color.toString()==d.ColorGeometryInstanceAttribute.toValue(o.highlightColor_move).toString())return;r.color=d.ColorGeometryInstanceAttribute.toValue(o.highlightColor_move)}},d.ScreenSpaceEventType.MOUSE_MOVE)},t.prototype.highlightFloor=function(t){var e=null;if(this.data&&this.data.geometry&&this._show&&(e=this.classificationPrimitiveCollection.get(t-1))){if(this._INTERSECTED_FLOOR3&&this._INTERSECTED_FLOOR3!=e){var i=this._INTERSECTED_FLOOR3._primitiveOptions.geometryInstances[0].id;this._INTERSECTED_FLOOR3.getGeometryInstanceAttributes(i).color=d.ColorGeometryInstanceAttribute.toValue(this.fillColor)}this._INTERSECTED_FLOOR3=e;var r=this._INTERSECTED_FLOOR3._primitiveOptions.geometryInstances[0].id;this._INTERSECTED_FLOOR3.getGeometryInstanceAttributes(r).color=d.ColorGeometryInstanceAttribute.toValue(this.highlightColor_click)}return e},t.prototype.clear=function(){this.classificationPrimitiveCollection.removeAll()},t.prototype.deActivate=function(){this.handler.removeInputAction(d.ScreenSpaceEventType.MOUSE_MOVE),this.handler.removeInputAction(d.ScreenSpaceEventType.LEFT_CLICK)},t.prototype.destroy=function(){this.clear(),this.classificationPrimitiveCollection.destroy(),this.classificationPrimitiveCollection=void 0,this.handler=this.handler&&this.handler.destroy(),this.viewer=void 0,this.data=void 0,this.fillColor=void 0,this.highlightColor_click=void 0,this.highlightColor_move=void 0,this._INTERSECTED_FLOOR=void 0,this._INTERSECTED_FLOOR2=void 0,this._INTERSECTED_FLOOR3=void 0}}(window.Cesium),function(s){s.FlyAround=function(t){this.viewer=t.viewer,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.heading=s.Math.toDegrees(this.camera.heading),this.pitch=s.Math.toDegrees(this.camera.pitch),this.dip_angle=s.Math.toRadians(-30),this.speed=t.speed,this.height=0,this.distance=0,this.isFlying=t.isFlying,this.deltaHeight=0,this.deltaRadians=s.Math.toRadians(1),this.deltaDistance=0,this.roll=0,this.keyEvent()},s.FlyAround.prototype.play=function(r,n){var o=this,a=this.camera.heading;this.scene.preRender.addEventListener(function(t,e){if(o.isFlying){o.heading=s.Math.toDegrees(t.camera.heading),o.pitch=s.Math.toDegrees(t.camera.pitch);var i=a+=s.Math.toRadians(o.speed);o.height=(n[2]+o.deltaHeight).toFixed(1),o.distance=(r+o.deltaDistance).toFixed(1),o.camera.setView({destination:s.Cartesian3.fromDegrees(n[0],n[1],n[2]+o.deltaHeight),orientation:{heading:i,pitch:o.dip_angle,roll:o.roll}}),o.camera.moveBackward(r+o.deltaDistance)}})},s.FlyAround.prototype.pause=function(){this.viewer.scene.postRender.removeEventListener(this.play,this)},s.FlyAround.prototype.continue=function(){0!=this.viewer.entities._entities.length?(this.viewer.scene.postRender.removeEventListener(this.play,this),this.viewer.scene.postRender.addEventListener(this.play,this)):this.viewer.scene.postRender.removeEventListener(this.play,this)},s.FlyAround.prototype.stop=function(){this.viewer.scene.postRender.removeEventListener(this.play,this),this.viewer.entities.removeAll(),document.removeEventListener("keydown",this.keydownOption)},s.FlyAround.prototype.keyEvent=function(){var e=this;document.addEventListener("keydown",function(t){switch(t.keyCode){case 40:t.shiftKey?e.deltaHeight-=10:(e.dip_angle-=e.deltaRadians,e.dip_angle<-s.Math.TWO_PI&&(e.dip_angle+=s.Math.TWO_PI));break;case 38:t.shiftKey?e.deltaHeight+=10:(e.dip_angle+=e.deltaRadians,e.dip_angle>-s.Math.TWO_PI&&(e.dip_angle-=s.Math.TWO_PI));break;case 39:t.shiftKey?(e.roll+=e.deltaRadians,e.roll>s.Math.TWO_PI&&(e.roll-=s.Math.TWO_PI)):e.deltaDistance-=50;break;case 37:t.shiftKey?(e.roll-=e.deltaRadians,e.roll<s.Math.TWO_PI&&(e.roll+=s.Math.TWO_PI)):e.deltaDistance+=50}})}}(window.Cesium),function(a){a.FreeFlight=function(t){this.viewer=t.viewer,this.direct=t.direct,this.pitch=t.pitch,this.roll=t.roll,this.height=t.height,this.speed=t.speed,this.lon=t.lon,this.lat=t.lat,this.planePrimitive=t.planePrimitive,this.hpRoll=t.hpRoll,this.fromBehind=t.fromBehind,this.isFlying=t.isFlying,this.position=t.position,this.fixedFrameTransform=t.fixedFrameTransform,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.pathPosition=new a.SampledPositionProperty,this.speedVector=new a.Cartesian3,this.center=new a.Cartesian3,this.hpRange=new a.HeadingPitchRange,this.deltaRadians=a.Math.toRadians(3),this.init(),this.keyEvent()},a.FreeFlight.prototype.init=function(){var r=this,n=this.scene.screenSpaceCameraController,o=0;this.planePrimitive.readyPromise.then(function(t){t.activeAnimations.addAll({speedup:.5,loop:a.ModelAnimationLoop.REPEAT}),o=2*Math.max(t.boundingSphere.radius,r.camera.frustum.near),n.minimumZoomDistance=.5*o,a.Matrix4.multiplyByPoint(t.modelMatrix,t.boundingSphere.center,r.center);var e=a.Math.toRadians(230),i=a.Math.toRadians(-20);r.hpRange.heading=e,r.hpRange.pitch=i,r.hpRange.range=50*o,r.camera.lookAt(r.center,r.hpRange)}),viewer.entities.add({position:this.pathPosition,name:"path",path:{show:!0,leadTime:0,trailTime:60,width:2,resolution:1,material:new a.PolylineGlowMaterialProperty({glowPower:.3,color:a.Color.PALEGOLDENROD})}})},a.FreeFlight.prototype.animation=function(){if(this.isFlying){this.direct=a.Math.toDegrees(this.hpRoll.heading).toFixed(1),this.pitch=a.Math.toDegrees(this.hpRoll.pitch).toFixed(1),this.roll=a.Math.toDegrees(this.hpRoll.roll).toFixed(1),this.speed=this.speed,this.speedVector=a.Cartesian3.multiplyByScalar(a.Cartesian3.UNIT_X,this.speed/10,this.speedVector);var t=a.Matrix4.multiplyByPoint(this.planePrimitive.modelMatrix,this.speedVector,this.position);this.pathPosition.addSample(a.JulianDate.now(),t),a.Transforms.headingPitchRollToFixedFrame(t,this.hpRoll,a.Ellipsoid.WGS84,this.fixedFrameTransform,this.planePrimitive.modelMatrix);var e=a.Cartographic.fromCartesian(t);this.lon=a.Math.toDegrees(e.longitude),this.lat=a.Math.toDegrees(e.latitude),this.height=e.height,this.fromBehind&&(a.Matrix4.multiplyByPoint(this.planePrimitive.modelMatrix,this.planePrimitive.boundingSphere.center,this.center),this.hpRange.heading=this.hpRoll.heading,this.hpRange.pitch=this.hpRoll.pitch,this.camera.lookAt(this.center,this.hpRange))}},a.FreeFlight.prototype.play=function(){this.viewer.scene.postRender.addEventListener(this.animation,this)},a.FreeFlight.prototype.pause=function(){this.viewer.scene.postRender.removeEventListener(this.animation,this)},a.FreeFlight.prototype.continue=function(){0!=this.viewer.entities._entities.length?(this.viewer.scene.postRender.removeEventListener(this.animation,this),this.viewer.scene.postRender.addEventListener(this.animation,this)):this.viewer.scene.postRender.removeEventListener(this.animation,this)},a.FreeFlight.prototype.stop=function(){this.viewer.scene.postRender.removeEventListener(this.animation,this),this.viewer.entities.removeAll(),this.scene.primitives.removeAll(),document.removeEventListener("keydown",this.keydownOption)},a.FreeFlight.prototype.keyEvent=function(){var e=this;document.addEventListener("keydown",function(t){switch(t.keyCode){case 40:t.shiftKey?e.speed=Math.max(--e.speed,1):(e.hpRoll.pitch-=e.deltaRadians,e.hpRoll.pitch<-a.Math.TWO_PI&&(e.hpRoll.pitch+=a.Math.TWO_PI));break;case 38:t.shiftKey?e.speed=Math.min(++e.speed,100):(e.hpRoll.pitch+=e.deltaRadians,e.hpRoll.pitch>a.Math.TWO_PI&&(e.hpRoll.pitch-=a.Math.TWO_PI));break;case 39:t.shiftKey?(e.hpRoll.roll+=e.deltaRadians,e.hpRoll.roll>a.Math.TWO_PI&&(e.hpRoll.roll-=a.Math.TWO_PI)):(e.hpRoll.heading+=e.deltaRadians,e.hpRoll.heading>a.Math.TWO_PI&&(e.hpRoll.heading-=a.Math.TWO_PI));break;case 37:t.shiftKey?(e.hpRoll.roll-=e.deltaRadians,e.hpRoll.roll<0&&(e.hpRoll.roll+=a.Math.TWO_PI)):(e.hpRoll.heading-=e.deltaRadians,e.hpRoll.heading<0&&(e.hpRoll.heading+=a.Math.TWO_PI))}})}}(window.Cesium),function(l){l.RouteFly=function(t){this.viewer=t.viewer,this.cartographicArray=t.cartographicArray,this.pointArray=t.pointArray,this.start=t.start,this.stop=t.stop,this.speed=t.speed,this.deltaHeight=l.defaultValue(t.deltaHeight,10),this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.cartesian3=new l.Cartesian3(0,0,0),this.initialHeading=[],this.keydownOption=null,this.point=[],this.bearing=[],this.differentBearing=[],this.reduceBearing=[],this.HorizontalRadian=0,this.VerticalRadians=0,this.i=0,this.keyEvent()},l.RouteFly.prototype.init=function(){for(var t=0;t<this.pointArray.length;t++)this.point.push(turf.point(this.pointArray[t]));for(var e=0;e<this.point.length-1;e++)this.bearing.push(turf.bearing(this.point[e],this.point[e+1]));for(t=0;t<this.bearing.length;t++)this.initialHeading.push(l.Math.toRadians(this.bearing[t]));for(var i=0;i<this.bearing.length-1;i++)this.bearing[i+1]-this.bearing[i]<-180?(this.differentBearing.push(l.Math.toRadians(this.bearing[i+1]-this.bearing[i]+360)),this.reduceBearing.push(l.Math.toRadians(this.bearing[i+1]-this.bearing[i]+360))):180<this.bearing[i+1]-this.bearing[i]?(this.differentBearing.push(l.Math.toRadians(this.bearing[i+1]-this.bearing[i]-360)),this.reduceBearing.push(l.Math.toRadians(Math.abs(this.bearing[i+1]-this.bearing[i]-360)))):(this.differentBearing.push(l.Math.toRadians(this.bearing[i+1]-this.bearing[i])),this.reduceBearing.push(l.Math.toRadians(Math.abs(this.bearing[i+1]-this.bearing[i]))))},l.RouteFly.prototype.initializationFly=function(){this.viewer.clock.startTime=this.start.clone(),this.viewer.clock.stopTime=this.stop.clone(),this.viewer.clock.currentTime=this.start.clone(),this.viewer.clock.clockRange=l.ClockRange.CLAMPED},l.RouteFly.prototype.computeCirclularFlight=function(t){for(var e=new l.SampledPositionProperty,i=0;i<t.length;i++){var r=l.JulianDate.addSeconds(this.start,i,new l.JulianDate),n=l.Cartesian3.fromRadians(Number(t[i][0]),Number(t[i][1]),Number(t[i][2]));e.addSample(r,n),this.viewer.entities.add({position:n,point:{pixelSize:2,color:l.Color.TRANSPARENT,outlineColor:l.Color.YELLOW,outlineWidth:2}})}return e},l.RouteFly.prototype.animation=function(){if(this.cartographicArray){var t=this.computeCirclularFlight(this.cartographicArray),e=this.viewer.entities.add({availability:new l.TimeIntervalCollection([new l.TimeInterval({start:this.start,stop:this.stop})]),position:t});this.cartesian3=e.position.getValue(this.viewer.clock.currentTime);var i=this.scene.globe.ellipsoid;if(null==this.cartesian3)this.viewer.clock.multiplier=0,document.removeEventListener("keydown",this.keydownOption),this.viewer.scene.postRender.removeEventListener(this.animation);else{var r=i.cartesianToCartographic(this.cartesian3),n=Math.floor(1e5*l.Math.toDegrees(r.latitude))/1e5,o=Math.floor(1e5*l.Math.toDegrees(r.longitude))/1e5,a=(Math.floor(1e5*r.height),1e3*turf.distance(turf.point(this.pointArray[this.i+1]),turf.point([o,n,0]))),s=turf.distance(turf.point(this.pointArray[this.i]),turf.point(this.pointArray[this.i+1]));a<=1*(50+this.deltaHeight)/10?(this.camera.setView({destination:l.Cartesian3.fromDegrees(l.Math.toDegrees(this.cartographicArray[this.i+1][0]),l.Math.toDegrees(this.cartographicArray[this.i+1][1]),50+this.deltaHeight),orientation:{heading:this.initialHeading[this.i]+this.HorizontalRadian,pitch:l.Math.toRadians(0)+this.VerticalRadians,roll:0}}),this.viewer.clock.multiplier=0,this.i<this.reduceBearing.length?this.reduceBearing[this.i]<1e-5?(this.HorizontalRadian=0,this.i+=1,this.viewer.clock.multiplier=this.speed):(this.HorizontalRadian+=this.differentBearing[this.i]/200,this.reduceBearing[this.i]-=Math.abs(this.differentBearing[this.i]/200)):(this.viewer.clock.multiplier=0,document.removeEventListener("keydown",this.keydownOption),this.viewer.scene.postRender.removeEventListener(this.animation,this))):(this.camera.setView({destination:l.Cartesian3.fromDegrees(l.Math.toDegrees(r.longitude),l.Math.toDegrees(r.latitude),50+this.deltaHeight),orientation:{heading:this.initialHeading[this.i],pitch:l.Math.toRadians(0)+this.VerticalRadians,roll:0}}),this.viewer.clock.multiplier=1<s?this.speed*(1/s):this.speed*(1-s))}}},l.RouteFly.prototype.play=function(){this.initializationFly(),this.init(),this.scene.postRender.addEventListener(this.animation,this)},l.RouteFly.prototype.pause=function(){this.scene.postRender.removeEventListener(this.animation,this)},l.RouteFly.prototype.continue=function(){this.scene.postRender.removeEventListener(this.animation,this),this.scene.postRender.addEventListener(this.animation,this)},l.RouteFly.prototype.STOP=function(){this.scene.postRender.removeEventListener(this.animation,this),this.viewer.entities.removeAll(),document.removeEventListener("keydown",this.keydownOption),this.viewer=null,this.cartographicArray=null,this.pointArray=null,this.start=null,this.stop=null,this.speed=null,this.scene=null,this.camera=null,this.cartesian3=new l.Cartesian3(0,0,0),this.initialHeading=[],this.keydownOption=null,this.point=[],this.bearing=[],this.differentBearing=[],this.reduceBearing=[],this.deltaHeight=l.defaultValue(this.deltaHeight,10),this.HorizontalRadian=0,this.VerticalRadians=0,this.i=0},l.RouteFly.prototype.reset=function(t){this.viewer&&(this.scene.postRender.removeEventListener(this.animation,this),this.cartesian3=new l.Cartesian3(0,0,0),this.initialHeading=[],this.keydownOption=null,this.point=[],this.bearing=[],this.differentBearing=[],this.reduceBearing=[],this.deltaHeight=l.defaultValue(this.deltaHeight,10),this.HorizontalRadian=0,this.VerticalRadians=0,this.i=0,this.play())},l.RouteFly.prototype.keyEvent=function(){var e=this;this.keydownOption=function(t){switch(t.keyCode){case 40:t.shiftKey?e.deltaHeight-=1:e.VerticalRadians-=.01;break;case 38:t.shiftKey?e.deltaHeight+=1:e.VerticalRadians+=.01}},document.addEventListener("keydown",this.keydownOption)}}(window.Cesium),function(o){o.WalkBrowse=function(t){this.viewer=t.viewer,this.pointArray=t.pointArray,this.orientationAngle=[],this.point1=turf.point(this.pointArray[0]),this.point2=turf.point(this.pointArray[1]),this.point3=turf.point(this.pointArray[2]),this.bearing1=turf.bearing(this.point1,this.point2),this.bearing2=turf.bearing(this.point2,this.point3),this.drawMarker(),this.init()},o.WalkBrowse.prototype.animation=function(){var t=this.viewer.scene.globe.ellipsoid,e=this.viewer.camera.position,i=t.cartesianToCartographic(e),r=Math.floor(1e5*o.Math.toDegrees(i.latitude))/1e5,n=Math.floor(1e5*o.Math.toDegrees(i.longitude))/1e5;n==this.pointArray[1][0]&&r==this.pointArray[1][1]?(this.orientationAngle.push(o.Math.toDegrees(this.viewer.camera.heading)),1e-12<=this.bearing2-o.Math.toDegrees(this.viewer.camera.heading)?(this.viewer.camera.moveForward(0),this.viewer.camera.lookRight(o.Math.toRadians((this.bearing2-this.orientationAngle[0])/200))):(this.orientationAngle=[],this.viewer.camera.setView({destination:o.Cartesian3.fromDegrees(this.pointArray[1][0],this.pointArray[1][1],this.pointArray[1][2]),orientation:{heading:o.Math.toRadians(this.bearing2),pitch:o.Math.toRadians(0)}}),this.viewer.camera.moveForward(this.viewer.clock.multiplier))):-1e-5<n-this.pointArray[2][0]&&-1e-5<r-this.pointArray[2][1]?this.viewer.camera.moveForward(0):this.viewer.camera.moveForward(this.viewer.clock.multiplier)},o.WalkBrowse.prototype.init=function(){this.viewer.camera.setView({destination:o.Cartesian3.fromDegrees(this.pointArray[0][0],this.pointArray[0][1],this.pointArray[0][2]),orientation:{heading:o.Math.toRadians(this.bearing1),pitch:o.Math.toRadians(0)}})},o.WalkBrowse.prototype.drawMarker=function(){this.viewer.entities.add({position:o.Cartesian3.fromDegrees(this.pointArray[1][0],this.pointArray[1][1]),point:{pixelSize:2,color:o.Color.TRANSPARENT,outlineColor:o.Color.YELLOW,outlineWidth:2}}),this.viewer.entities.add({position:o.Cartesian3.fromDegrees(this.pointArray[2][0],this.pointArray[2][1]),point:{pixelSize:2,color:o.Color.TRANSPARENT,outlineColor:o.Color.RED,outlineWidth:2}})},o.WalkBrowse.prototype.play=function(){0==this.viewer.entities._entities.length&&this.drawMarker(),this.viewer.scene.postRender.removeEventListener(this.animation,this),this.viewer.camera.setView({destination:o.Cartesian3.fromDegrees(this.pointArray[0][0],this.pointArray[0][1],this.pointArray[0][2]),orientation:{heading:o.Math.toRadians(this.bearing1),pitch:o.Math.toRadians(0)}}),this.viewer.scene.postRender.addEventListener(this.animation,this)},o.WalkBrowse.prototype.pause=function(){this.viewer.scene.postRender.removeEventListener(this.animation,this)},o.WalkBrowse.prototype.continue=function(){0!=this.viewer.entities._entities.length?(this.viewer.scene.postRender.removeEventListener(this.animation,this),this.viewer.scene.postRender.addEventListener(this.animation,this)):this.viewer.scene.postRender.removeEventListener(this.animation,this)},o.WalkBrowse.prototype.stop=function(){this.viewer.scene.postRender.removeEventListener(this.animation,this),this.viewer.entities.removeAll(),this.init()}}(window.Cesium),function(T){var t=T.GeoCylinderApertureSpreadEffect=function(t){t=t||{},this._center=T.Cartesian3.fromRadians(t.center.longitude,t.center.latitude,t.center.height),this._maxRadius=t.radius,this._height=t.height,this._drawCommandAlpha=null,this._drawCommandOpaque=null,this._needUpdate=!1,this._va=null,this._boundingVolume=null,this._color=t.color?t.color.clone():new T.Color(.5,.8,1,1),this._speed=t.speed?t.speed:1,this._speed*=4,this._actived=!t.actived||t.actived,this._time=0,this._lastTime=0,this._life=this._maxRadius/this._speed,this._hSpeed=2*this._height/this._life,this._modelTransform=null,this._metallicFactor=t.metallicFactor?t.metallicFactor:.115,this._roughnessFactor=t.roughnessFactor?t.roughnessFactor:.918,this._emissiveFactor=t.emissiveFactor?t.emissiveFactor.clone():new T.Cartesian3(.6,.6,.6),this._initTransform()};T.defineProperties(t.prototype,{actived:{get:function(){return this._actived},set:function(t){this._actived=t}}}),t.prototype._initTransform=function(){this._modelTransform=T.Transforms.eastNorthUpToFixedFrame(this._center)},t.prototype.update=function(t){if(this._actived&&(this._updateTime(),this._fetchGeometry(t),this._updateCommands(t),this._drawCommandAlpha&&this._va)){var e=t.commandList;e.push(this._drawCommandAlpha),e.push(this._drawCommandOpaque)}},t.prototype.destroy=function(){this._actived=!1,this._va&&(this._va.destroy(),this._va=null),this._drawCommandAlpha&&(this._drawCommandAlpha.vertexArray=null,this._drawCommandAlpha.shaderProgram&&(this._drawCommandAlpha.shaderProgram.destroy(),this._drawCommandAlpha.shaderProgram=null),this._drawCommandAlpha.owner=null,this._drawCommandAlpha=null),this._drawCommandOpaque&&(this._drawCommandOpaque.vertexArray=null,this._drawCommandOpaque.shaderProgram&&(this._drawCommandOpaque.shaderProgram.destroy(),this._drawCommandOpaque.shaderProgram=null),this._drawCommandOpaque.owner=null,this._drawCommandOpaque=null)},t.prototype._fetchGeometry=function(t){this._updateVA(t)},t.prototype._updateTime=function(){this._time>=this._life&&(this._time=0);var t=T.getTimestamp()/1e3;0<this._lastTime?(this._time+=t-this._lastTime,this._lastTime=t,this._time>this._life&&(this._time=this._life)):this._lastTime=t},t.prototype._updateCommands=function(t){this._updateAlphaCommand(t),this._updateOpaqueCommand(t)},t.prototype._updateAlphaCommand=function(t){var e=t.context,i=this;if(!this._drawCommandAlpha){var r=this._drawCommandAlpha=new T.DrawCommand;r.pass=T.Pass.TRANSLUCENT,r.owner=this,r.modelMatrix=this._modelTransform,r.renderState=T.RenderState.fromCache({cull:{enabled:!1},depthTest:{enabled:!0,func:T.WebGLConstants.LEQUAL},depthMask:!1,blending:T.BlendingState.ALPHA_BLEND}),r.shaderProgram=T.ShaderProgram.fromCache({context:e,defines:["HDR"],vertexShaderSource:s,fragmentShaderSource:l,attributeLocations:{aPoint:0,aNormal:1,aT:2}}),r.uniformMap={u_color:function(){return i._color},u_metallicFactor:function(){return i._metallicFactor},u_roughnessFactor:function(){return i._roughnessFactor},u_emissiveFactor:function(){return i._emissiveFactor},u_normalMatrix:function(){return T.Matrix4.multiplyTransformation(t.camera.viewMatrix,i._modelTransform,n),T.Matrix4.inverse(n,o),T.Matrix4.getRotation(o,a),T.Matrix3.transpose(a,a)}}}this._drawCommandAlpha.vertexArray=this._va};var n=new T.Matrix4,o=new T.Matrix4,a=new T.Matrix3;t.prototype._updateOpaqueCommand=function(t){var e=t.context,i=this;if(!this._drawCommandOpaque){var r=this._drawCommandOpaque=new T.DrawCommand;r.pass=T.Pass.OPAQUE,r.owner=this,r.modelMatrix=this._modelTransform,r.renderState=T.RenderState.fromCache({cull:{enabled:!1},depthTest:{enabled:!0,func:T.WebGLConstants.LEQUAL},depthMask:!1}),r.shaderProgram=T.ShaderProgram.fromCache({context:e,defines:["HDR"],vertexShaderSource:s,fragmentShaderSource:h,attributeLocations:{aPoint:0,aNormal:1,aT:2}}),r.uniformMap={u_color:function(){return i._color},u_metallicFactor:function(){return i._metallicFactor},u_roughnessFactor:function(){return i._roughnessFactor},u_emissiveFactor:function(){return i._emissiveFactor},u_normalMatrix:function(){return T.Matrix4.multiplyTransformation(t.camera.viewMatrix,i._modelTransform,n),T.Matrix4.inverse(n,o),T.Matrix4.getRotation(o,a),T.Matrix3.transpose(a,a)}}}this._drawCommandOpaque.vertexArray=this._va},t.prototype._updateVA=function(t){this._va&&(this._va.destroy(),this._va=null);var e=T.Math.TWO_PI,i=this._time*this._speed;if(!(i<1e-5)){var r=0;if(this._time/this._life<.5)r=this._hSpeed*this._time;else{var n=this._life-this._time;r=this._hSpeed*n}var o=this._computeStepCount(i);if(!(r<1e-5)){for(var a,s,l,h,c=t.context,g=e/o,u=2*o,d=3*u,p=T.ComponentDatatype.createTypedArray(T.ComponentDatatype.FLOAT,3*u),C=T.ComponentDatatype.createTypedArray(T.ComponentDatatype.FLOAT,3*u),m=T.ComponentDatatype.createTypedArray(T.ComponentDatatype.FLOAT,u),f=T.ComponentDatatype.createTypedArray(T.ComponentDatatype.UNSIGNED_SHORT,d),v=0,A=0,I=0,_=0,y=0;y<o;y++)a=y*g,s=i*Math.cos(a),l=i*Math.sin(a),h=0,p[v++]=s,p[v++]=l,p[v++]=h,C[A++]=s,C[A++]=l,C[A++]=0,m[I++]=0,h=r,p[v++]=s,p[v++]=l,p[v++]=h,C[A++]=s,C[A++]=l,C[A++]=0,f[_++]=2*y,f[_++]=(y+1)%o*2,f[_++]=2*y+1,f[_++]=2*y+1,f[_++]=(y+1)%o*2,f[_++]=(y+1)%o*2+1,m[I++]=1;var w=T.Buffer.createVertexBuffer({context:c,typedArray:p,usage:T.BufferUsage.STATIC_DRAW}),P=[];P.push({index:0,vertexBuffer:w,componentsPerAttribute:3,componentDatatype:T.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:12,normalize:!1});var x=T.Buffer.createVertexBuffer({context:c,typedArray:C,usage:T.BufferUsage.STATIC_DRAW});P.push({index:1,vertexBuffer:x,componentsPerAttribute:3,componentDatatype:T.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:12,normalize:!1});var b=T.Buffer.createVertexBuffer({context:c,typedArray:m,usage:T.BufferUsage.STATIC_DRAW});P.push({index:2,vertexBuffer:b,componentsPerAttribute:1,componentDatatype:T.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:4,normalize:!1});var E=T.Buffer.createIndexBuffer({context:c,typedArray:f,usage:T.BufferUsage.STATIC_DRAW,indexDatatype:T.IndexDatatype.UNSIGNED_SHORT});this._va=new T.VertexArray({context:c,attributes:P,indexBuffer:E}),this._updateBoundingVolume(i,r)}}},t.prototype._computeStepCount=function(t){var e=10<t?1/t:.1,i=2*Math.asin(e);return Math.round(T.Math.TWO_PI/i)},t.prototype._updateBoundingVolume=function(t,e){var i=Math.sqrt(t*t+e+e);this._boundingVolume=new T.BoundingSphere(T.Cartesian3.ZERO,i+1),T.BoundingSphere.transform(this._boundingVolume,this._modelTransform,this._boundingVolume)};var s="attribute vec3 aPoint;\nattribute vec3 aNormal;\nattribute float aT;\nuniform mat3 u_normalMatrix;\nvarying vec3 v_normalEC;\nvarying vec3 v_positionEC;\nvarying float v_t;\nvoid main(){\n   v_positionEC = (czm_modelViewRelativeToEye * vec4(aPoint, 1.0)).xyz;\n   v_normalEC = u_normalMatrix * aNormal;\n   gl_Position = czm_modelViewProjection * vec4(aPoint, 1.0);\n   v_t = aT;\n}",l="uniform vec4 u_color;\nuniform float u_metallicFactor;\nuniform float u_roughnessFactor;\nuniform vec3 u_emissiveFactor;\nvarying vec3 v_normalEC;\nvarying vec3 v_positionEC;\nvarying float v_t;\nconst float M_PI = 3.141592653589793;\nvec3 fresnelSchlick2(vec3 f0, vec3 f90, float VdotH) \n{\n    return f0 + (f90 - f0) * pow(clamp(1.0 - VdotH, 0.0, 1.0), 5.0);\n}\nfloat smithVisibilityG1(float NdotV, float roughness) \n{\n    float k = (roughness + 1.0) * (roughness + 1.0) / 8.0;\n    return NdotV / (NdotV * (1.0 - k) + k);\n}\nfloat smithVisibilityGGX(float roughness, float NdotL, float NdotV) \n{\n    return smithVisibilityG1(NdotL, roughness) * smithVisibilityG1(NdotV, roughness);\n}\nfloat GGX(float roughness, float NdotH) \n{\n    float roughnessSquared = roughness * roughness;\n    float f = (NdotH * roughnessSquared - NdotH) * NdotH + 1.0;\n    return roughnessSquared / (M_PI * f * f);\n}\nvec3 lambertianDiffuse(vec3 diffuseColor) \n{\n    return diffuseColor / M_PI;\n}\nvec3 LINEARtoSRGB(vec3 linearIn) \n{\n#ifndef HDR \n    return pow(linearIn, vec3(1.0/2.2));\n#else \n    return linearIn;\n#endif \n}\nvoid main(){\n   vec3 n = normalize(v_normalEC);\n   if (!gl_FrontFacing){\n       n = -n;\n   }\n   vec4 baseColorWithAlpha = u_color;\n   if (v_t > 0.5){       baseColorWithAlpha.a = (2.0 - v_t * 2.0);\n   }\n   else{\n       baseColorWithAlpha.a = 1.0;\n   }\n   vec3 baseColor = baseColorWithAlpha.rgb;\n   float metalness = clamp(u_metallicFactor, 0.0, 1.0);\n   float roughness = clamp(u_roughnessFactor, 0.04, 1.0);\n   vec3 v = -normalize(v_positionEC);\n   vec3 lightColor = vec3(1.5, 1.4, 1.2);\n   vec3 l = normalize(czm_sunDirectionEC);\n   vec3 h = normalize(v + l);\n   float NdotL = clamp(dot(n, l), 0.001, 1.0);\n   float NdotV = abs(dot(n, v)) + 0.001;\n   float NdotH = clamp(dot(n, h), 0.0, 1.0);\n   float LdotH = clamp(dot(l, h), 0.0, 1.0);\n   float VdotH = clamp(dot(v, h), 0.0, 1.0);\n   vec3 f0 = vec3(0.04);\n   vec3 diffuseColor = baseColor * (1.0 - metalness) * (1.0 - f0);\n   vec3 specularColor = mix(f0, baseColor, metalness);\n   float alpha = roughness * roughness;\n   float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);\n   vec3 r90 = vec3(clamp(reflectance * 25.0, 0.0, 1.0));\n   vec3 r0 = specularColor.rgb;\n   vec3 F = fresnelSchlick2(r0, r90, VdotH);\n   float G = smithVisibilityGGX(alpha, NdotL, NdotV);\n   float D = GGX(alpha, NdotH);\n   vec3 diffuseContribution = (1.0 - F) * lambertianDiffuse(diffuseColor);\n   vec3 specularContribution = F * G * D / (4.0 * NdotL * NdotV);\n   vec3 color = NdotL * lightColor * (diffuseContribution + specularContribution);\n   color += u_emissiveFactor;\n   color = LINEARtoSRGB(color);\n   gl_FragColor = vec4(color, baseColorWithAlpha.a);\n}",h="uniform vec4 u_color;\nuniform float u_metallicFactor;\nuniform float u_roughnessFactor;\nuniform vec3 u_emissiveFactor;\nvarying vec3 v_normalEC;\nvarying vec3 v_positionEC;\nvarying float v_t;\nconst float M_PI = 3.141592653589793;\nvec3 fresnelSchlick2(vec3 f0, vec3 f90, float VdotH) \n{\n    return f0 + (f90 - f0) * pow(clamp(1.0 - VdotH, 0.0, 1.0), 5.0);\n}\nfloat smithVisibilityG1(float NdotV, float roughness) \n{\n    float k = (roughness + 1.0) * (roughness + 1.0) / 8.0;\n    return NdotV / (NdotV * (1.0 - k) + k);\n}\nfloat smithVisibilityGGX(float roughness, float NdotL, float NdotV) \n{\n    return smithVisibilityG1(NdotL, roughness) * smithVisibilityG1(NdotV, roughness);\n}\nfloat GGX(float roughness, float NdotH) \n{\n    float roughnessSquared = roughness * roughness;\n    float f = (NdotH * roughnessSquared - NdotH) * NdotH + 1.0;\n    return roughnessSquared / (M_PI * f * f);\n}\nvec3 lambertianDiffuse(vec3 diffuseColor) \n{\n    return diffuseColor / M_PI;\n}\nvec3 LINEARtoSRGB(vec3 linearIn) \n{\n#ifndef HDR \n    return pow(linearIn, vec3(1.0/2.2));\n#else \n    return linearIn;\n#endif \n}\nvoid main(){\n   if (v_t > 0.5){discard;}\n   vec3 n = normalize(v_normalEC);\n   if (!gl_FrontFacing){\n       n = -n;\n   }\n   vec4 baseColorWithAlpha = u_color;\n   baseColorWithAlpha.a = 1.0;\n   vec3 baseColor = baseColorWithAlpha.rgb;\n   float metalness = clamp(u_metallicFactor, 0.0, 1.0);\n   float roughness = clamp(u_roughnessFactor, 0.04, 1.0);\n   vec3 v = -normalize(v_positionEC);\n   vec3 lightColor = vec3(1.5, 1.4, 1.2);\n   vec3 l = normalize(czm_sunDirectionEC);\n   vec3 h = normalize(v + l);\n   float NdotL = clamp(dot(n, l), 0.001, 1.0);\n   float NdotV = abs(dot(n, v)) + 0.001;\n   float NdotH = clamp(dot(n, h), 0.0, 1.0);\n   float LdotH = clamp(dot(l, h), 0.0, 1.0);\n   float VdotH = clamp(dot(v, h), 0.0, 1.0);\n   vec3 f0 = vec3(0.04);\n   vec3 diffuseColor = baseColor * (1.0 - metalness) * (1.0 - f0);\n   vec3 specularColor = mix(f0, baseColor, metalness);\n   float alpha = roughness * roughness;\n   float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);\n   vec3 r90 = vec3(clamp(reflectance * 25.0, 0.0, 1.0));\n   vec3 r0 = specularColor.rgb;\n   vec3 F = fresnelSchlick2(r0, r90, VdotH);\n   float G = smithVisibilityGGX(alpha, NdotL, NdotV);\n   float D = GGX(alpha, NdotH);\n   vec3 diffuseContribution = (1.0 - F) * lambertianDiffuse(diffuseColor);\n   vec3 specularContribution = F * G * D / (4.0 * NdotL * NdotV);\n   vec3 color = NdotL * lightColor * (diffuseContribution + specularContribution);\n   color += u_emissiveFactor;\n   color = LINEARtoSRGB(color);\n   gl_FragColor = vec4(color, baseColorWithAlpha.a);\n}"}(window.Cesium),function(c){var t=c.GeoHeatMap=function(t,e){return this.viewer=t.viewer,this.heatmapOptions=t.heatmapOptions,this.dataOptions=t.dataOptions,this.defaults={minCanvasSize:700,maxCanvasSize:2e3,useEntities:!0,radiusFactor:60,spacingFactor:1.5,maxOpacity:.8,minOpacity:.1,blur:.85,gradient:{.3:"blue",.65:"yellow",.8:"orange",.95:"red"}},this.heatmapOptions.useEntities=c.defaultValue(this.heatmapOptions.useEntities,this.defaults.useEntities),this.heatmapOptions.gradient=c.defaultValue(this.heatmapOptions.gradient,this.defaults.gradient),this.heatmapOptions.maxOpacity=c.defaultValue(this.heatmapOptions.maxOpacity,this.defaults.maxOpacity),this.heatmapOptions.minOpacity=c.defaultValue(this.heatmapOptions.minOpacity,this.defaults.minOpacity),this.heatmapOptions.blur=c.defaultValue(this.heatmapOptions.blur,this.defaults.blur),this};t.prototype._computeBounds=function(t){if(t&&t.features&&0<t.features.length&&t.features[0].geometry&&t.features[0].geometry.coordinates){for(var e={west:t.features[0].geometry.coordinates[0],south:t.features[0].geometry.coordinates[1],east:t.features[0].geometry.coordinates[0],north:t.features[0].geometry.coordinates[1]},i=0;i<t.features.length;i++){var r=t.features[i].geometry.coordinates[0],n=t.features[i].geometry.coordinates[1];e.west=r>e.west?e.west:r,e.east=r>e.east?r:e.east,e.south=n>e.south?e.south:n,e.north=n>e.north?n:e.north}return e}return!1},t.prototype._getContainer=function(t,e,i){var r=document.createElement("div");return i&&r.setAttribute("id",i),r.setAttribute("style","width: "+t+"px; height: "+e+"px; margin: 0px; display: none;"),document.body.appendChild(r),r},t.prototype._getImageryProvider=function(t){var e=t._heatmap.getDataURL(),i=new c.SingleTileImageryProvider({url:e,rectangle:t._rectangle});return i._tilingScheme=new c.WebMercatorTilingScheme({rectangleSouthwestInMeters:new c.Cartesian2(t._mbounds.west,t._mbounds.south),rectangleNortheastInMeters:new c.Cartesian2(t._mbounds.east,t._mbounds.north)}),i},t.prototype._getID=function(t){for(var e="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<(t||8);r++)e+=i.charAt(Math.floor(Math.random()*i.length));return e};var r=new c.WebMercatorProjection;t.prototype.wgs84ToMercator=function(t){var e=r.project(c.Cartographic.fromDegrees(t.x,t.y));return{x:e.x,y:e.y}},t.prototype.wgs84ToMercatorBB=function(t){var e=r.project(c.Cartographic.fromDegrees(t.west,t.south)),i=r.project(c.Cartographic.fromDegrees(t.east,t.north));return{north:i.y,east:i.x,south:e.y,west:e.x}},t.prototype.mercatorToWgs84=function(t){var e=r.unproject(new c.Cartesian3(t.x,t.y));return{x:e.longitude,y:e.latitude}},t.prototype.mercatorToWgs84BB=function(t){var e=r.unproject(new c.Cartesian3(t.west,t.south)),i=r.unproject(new c.Cartesian3(t.east,t.north));return{north:this.rad2deg(i.latitude),east:this.rad2deg(i.longitude),south:this.rad2deg(e.latitude),west:this.rad2deg(e.longitude)}},t.prototype.deg2rad=function(t){return t*(Math.PI/180)},t.prototype.rad2deg=function(t){return t/(Math.PI/180)},t.prototype.wgs84PointToHeatmapPoint=function(t){return this.mercatorPointToHeatmapPoint(this.wgs84ToMercator(t))},t.prototype.mercatorPointToHeatmapPoint=function(t){var e={};return e.x=Math.round((t.x-this._xoffset)/this._factor+this._spacing),e.y=Math.round((t.y-this._yoffset)/this._factor+this._spacing),e.y=this.height-e.y,e},t.prototype._setWidthAndHeight=function(t){this.width=0<t.east&&t.west<0?t.east+Math.abs(t.west):Math.abs(t.east-t.west),this.height=0<t.north&&t.south<0?t.north+Math.abs(t.south):Math.abs(t.north-t.south),this._factor=1,this.width>this.height&&this.width>this.defaults.maxCanvasSize?(this._factor=this.width/this.defaults.maxCanvasSize,this.height/this._factor<this.defaults.minCanvasSize&&(this._factor=this.height/this.defaults.minCanvasSize)):this.height>this.width&&this.height>this.defaults.maxCanvasSize?(this._factor=this.height/this.defaults.maxCanvasSize,this.width/this._factor<this.defaults.minCanvasSize&&(this._factor=this.width/this.defaults.minCanvasSize)):this.width<this.height&&this.width<this.defaults.minCanvasSize?(this._factor=this.width/this.defaults.minCanvasSize,this.height/this._factor>this.defaults.maxCanvasSize&&(this._factor=this.height/this.defaults.maxCanvasSize)):this.height<this.width&&this.height<this.defaults.minCanvasSize&&(this._factor=this.height/this.defaults.minCanvasSize,this.width/this._factor>this.defaults.maxCanvasSize&&(this._factor=this.width/this.defaults.maxCanvasSize)),this.width=this.width/this._factor,this.height=this.height/this._factor},t.prototype.setData=function(t,e,i){if(this._id=this._getID(),this._initBounds=this._computeBounds(i),this._mbounds=this.wgs84ToMercatorBB(this._initBounds),this._setWidthAndHeight(this._mbounds),this.heatmapOptions.radius=Math.round(this.heatmapOptions.radius?this.heatmapOptions.radius:this.width>this.height?this.width/this.defaults.radiusFactor:this.height/this.defaults.radiusFactor),this._spacing=this.heatmapOptions.radius*this.defaults.spacingFactor,this._xoffset=this._mbounds.west,this._yoffset=this._mbounds.south,this.width=Math.round(this.width+2*this._spacing),this.height=Math.round(this.height+2*this._spacing),this._mbounds.west-=this._spacing*this._factor,this._mbounds.east+=this._spacing*this._factor,this._mbounds.south-=this._spacing*this._factor,this._mbounds.north+=this._spacing*this._factor,this.bounds=this.mercatorToWgs84BB(this._mbounds),this._rectangle=c.Rectangle.fromDegrees(this.bounds.west,this.bounds.south,this.bounds.east,this.bounds.north),this._container?(this._id&&this._container.setAttribute("id",this._id),this._container.setAttribute("style","width: "+this.width+"px; height: "+this.height+"px; margin: 0px; display: none;")):this._container=this._getContainer(this.width,this.height,this._id),this.heatmapOptions.container=this._container,this._heatmap?this._heatmap.repaint():this._heatmap=h337.create(this.heatmapOptions),this._container.children[0].setAttribute("id",this._id+"-hm"),i&&0<i.features.length&&null!==t&&!1!==t&&null!==e&&!1!==e){for(var r=[],n=0;n<i.features.length;n++){var o={};o.x=i.features[n].geometry.coordinates[0],o.y=i.features[n].geometry.coordinates[1],o.value=i.features[n].properties.z,r.push(o)}for(var a=[],s=0;s<r.length;s++){var l=r[s],h=this.wgs84PointToHeatmapPoint(l);!l.value&&0!==l.value||(h.value=l.value),a.push(h)}return this._heatmap.setData({min:t,max:e,data:a}),this.updateLayer(),!0}return!1},t.prototype.show=function(t){this._layer&&(this._layer.show=t)},t.prototype.remove=function(){this._layer&&(this.viewer.scene.imageryLayers.remove(this._layer),this.viewer.entities.remove(this._layer))},t.prototype.updateLayer=function(){if(this.heatmapOptions.useEntities&&this.viewer.entities){this._layer&&this.viewer.entities.remove(this._layer);var t=new c.ImageMaterialProperty({image:this._heatmap._renderer.canvas});"1.21"<=c.VERSION?t.transparent=!0:"1.16"<=c.VERSION&&(t.alpha=.99),this._layer=this.viewer.entities.add({show:!0,rectangle:{coordinates:this._rectangle,material:t}})}else this._layer&&this.viewer.scene.imageryLayers.remove(this._layer),this._layer=this.viewer.scene.imageryLayers.addImageryProvider(this._getImageryProvider(this))}}(window.Cesium),function(A){function n(){this._position=null,this._actived=!1,this._speed=0,this._direction=null,this._baseScale=1,this._life=0,this._time=0,this._mode=0}n.prototype.active=function(){this._actived=!0,this._time=0},n.prototype.update=function(t){this._actived&&(this._time+=t,this._time>this._life&&(this._actived=!1))},A.defineProperties(n.prototype,{position:{get:function(){return this._position},set:function(t){t&&(this._position=t.clone(this._position))}},direction:{get:function(){return this._direction},set:function(t){t&&(this._direction=t.clone(this._direction))}},actived:{get:function(){return this._actived}},speed:{get:function(){return this._speed},set:function(t){this._speed=t}},baseScale:{get:function(){return this._baseScale},set:function(t){this._baseScale=t}},life:{get:function(){return this._life},set:function(t){this._life=t}},time:{get:function(){return this._time}},mode:{get:function(){return this._mode},set:function(t){this._mode=t}}});var o=new A.Cartesian3,t=A.GeoLineFireEffect=function(t){t=t||{},this._url=t.url?A.buildModuleUrl(t.url):null,this._url_1=t.urlTop?A.buildModuleUrl(t.urlTop):null,this._explode=t.explode?t.explode:0,this._positions=[],this._scene=t.viewer.scene,this._clock=viewer.clock;var e=t.scale?t.scale:1;this._startScale=2*e,this._endScale=.1*e,this._imageSize=1*e,this._startColor=new A.Color(1,1,1,1),this._endColor=new A.Color(.8,0,0,.01),t.smoking&&(this._endColor.red=1-t.smoking);var i=t.life?t.life:1;this._minLife=.5*i,this._maxLife=2*i;var r=t.speed?t.speed:1;if(this._minSpeed=7*r,this._maxSpeed=20*r,this._count=t.count?t.count:0,this._radius=t.radius?t.radius:1,this._grow=t.grow?t.grow:4,this._fires=[],this._texture_0=null,this._texture_1=null,this._drawCommand=null,this._pointsArray=null,this._directionsArray=null,this._speedScaleLifeTimesArray=null,this._needUpdate=!0,this._preTime=0,this._time=0,this._loadTexture(),this._initFires(this._count),t.positions&&t.positions.length)for(var n=t.positions,o=0;o<n.length;o++)this.addPosition(n[o])};A.defineProperties(t.prototype,{explode:{get:function(){return this._explode},set:function(t){this._explode=t}},scale:{get:function(){return this._imageSize},set:function(t){this._startScale=2*t,this._endScale=.1*t,this._imageSize=1*t}},life:{get:function(){return this._maxLife/2},set:function(t){this._minLife=.5*t,this._maxLife=2*t}},speed:{get:function(){return this._maxSpeed/20},set:function(t){this._minSpeed=7*t,this._maxSpeed=20*t}},radius:{get:function(){return this._radius},set:function(t){this._radius=t}},grow:{get:function(){return this._grow},set:function(t){this._grow=t}},pntsCount:{get:function(){return this._positions.length}},smoking:{get:function(){return 1-this._endColor.red},set:function(t){this._endColor.red=1-t}}}),t.prototype.addPosition=function(t){if(t&&void 0!==t.longitude){t=A.Cartesian3.fromRadians(t.longitude,t.latitude,t.height);var e=10,i=this._positions.length;if(0<i){var r=this._positions[i-1];o=A.Cartesian3.subtract(t,r,o),e=A.Cartesian3.magnitude(o)}e<.5||(this._positions.push(t.clone()),this._growFires(this._grow,e))}},t.prototype.destroy=function(){this._scene=null,this._clock=null,this._drawCommand&&(this._drawCommand.vertexArray&&(this._drawCommand.vertexArray.destroy(),this._drawCommand.vertexArray=null),this._drawCommand.shaderProgram&&(this._drawCommand.shaderProgram.destroy(),this._drawCommand.shaderProgram=null),this._drawCommand._owner=null,this._drawCommand=null),this._texture_0&&(this._texture_0.destroy(),this._texture_0=null),this._texture_1&&(this._texture_1.destroy(),this._texture_1=null),this._fires.length=0,this._positions.length=0,this._pointsArray=null,this._directionsArray=null,this._speedScaleLifeTimesArray=null},t.prototype._loadTexture=function(){var e=this,i=e._scene.frameState.context;this._url&&A.Resource.fetchImage(this._url).then(function(t){e._texture_0=new A.Texture({context:i,source:t},function(t){})}),this._url_1&&A.Resource.fetchImage(this._url_1).then(function(t){e._texture_1=new A.Texture({context:i,source:t},function(t){})})},t.prototype._emissionPosition=function(){var t=this._positions.length;if(t<1)return null;if(t<2)return this._positions[0].clone(o),o.x+=A.Math.randomBetween(0,1)*this._radius,o.y+=A.Math.randomBetween(0,1)*this._radius,o.z+=A.Math.randomBetween(0,1)*this._radius,o;var e=A.Math.randomBetween(0,t-1);e=Math.floor(e);var i=this._positions[e],r=this._positions[e+1],n=A.Math.randomBetween(0,1);return o=A.Cartesian3.lerp(i,r,n,o)},t.prototype._initFires=function(t){if(t&&!(t<1))for(var e=0;e<t;e++){var i=new n;this._fires.push(i)}},t.prototype._growFires=function(t,e){t=Math.round(t*e),this._count+=t;for(var i=0;i<t;i++){var r=new n;this._fires.push(r)}},t.prototype._initFire=function(t){t.position=this._emissionPosition(),t.position&&(t.direction=A.Cartesian3.normalize(t.position,new A.Cartesian3)),t.speed=A.Math.randomBetween(this._minSpeed,this._maxSpeed),t.life=A.Math.randomBetween(this._minLife,this._maxLife),t.baseScale=A.Math.randomBetween(.5,5),(t.mode=0)<this._explode&&(A.Math.randomBetween(0,1)>1-this._explode&&(t.mode=1,t.baseScale*=1.2,t.life*=.2,t.speed*=2));return null!=t.position},t.prototype._updateFire=function(t){t.update(this._time),t.actived||this._initFire(t)&&t.active()},t.prototype._updateTime=function(t){var e;if(e=this._clock.shouldAnimate?t.time.secondsOfDay:A.getTimestamp()/1e3,0==this._preTime)this._preTime=e;else{var i=e-this._preTime;i>this._maxLife&&(i=this._maxLife),this._time=i,this._preTime=e}},t.prototype.update=function(t){this._updateTime(t);var e=this._count;if(!(e<1||e!=this._fires.length||this._positions.length<1)&&this._texture_0){if(this._needUpdate){for(var i=0;i<e;i++){var r=this._fires[i];this._updateFire(r)}this._updateCommand(t),this._needUpdate=!1}else this._needUpdate=!0;this._isCommandReady()&&t.commandList.push(this._drawCommand)}},t.prototype.updateNext=function(t){this._isCommandReady()&&t.commandList.push(this._drawCommand)},t.prototype._updateCommand=function(t){var e=this._drawCommand;e||((e=this._drawCommand=new A.DrawCommand).pass=A.Pass.TRANSLUCENT,e.owner=this,e.count=6),e.instanceCount=this._count,this._updateCommandVA(t,e),this._updateCommandBoundingVolume(t,e),this._updateCommandShaderProgram(t,e),this._updateCommandUniforms(t,e),this._updateCommandRenderState(t,e),this._updateCommandModelMatrix(t,e)},t.prototype._isCommandReady=function(){var t=this._drawCommand;return!!t&&(!!t.vertexArray&&(!!t.boundingVolume&&(!!t.shaderProgram&&(!!t.uniformMap&&!!t.renderState))))};var I={aPlane:0,aPosition:1,aDirection:2,aSpeedScaleLifeTime:3,aTexcoord:4};t.prototype._updateCommandVA=function(t,e){var i=this._count,r=t.context;this._pointsArray||(this._pointsArray=A.ComponentDatatype.createTypedArray(A.ComponentDatatype.FLOAT,3*i));var n=this._pointsArray;this._directionsArray||(this._directionsArray=A.ComponentDatatype.createTypedArray(A.ComponentDatatype.FLOAT,4*i));var o=this._directionsArray;this._speedScaleLifeTimesArray||(this._speedScaleLifeTimesArray=A.ComponentDatatype.createTypedArray(A.ComponentDatatype.FLOAT,4*i));for(var a=this._speedScaleLifeTimesArray,s=0;s<i;s++){var l=this._fires[s],h=l.position;n[3*s]=h.x,n[3*s+1]=h.y,n[3*s+2]=h.z;var c=l.direction;o[4*s]=c.x,o[4*s+1]=c.y,o[4*s+2]=c.z,o[4*s+3]=l.mode,a[4*s]=l.speed,a[4*s+1]=l.baseScale,a[4*s+2]=l.life,a[4*s+3]=l.time}var g=A.Buffer.createVertexBuffer({context:r,typedArray:new Float32Array([-1,0,1,0,.5,2,-.5,2]),usage:A.BufferUsage.STATIC_DRAW}),u=A.Buffer.createVertexBuffer({context:r,typedArray:n,usage:A.BufferUsage.STATIC_DRAW}),d=A.Buffer.createVertexBuffer({context:r,typedArray:o,usage:A.BufferUsage.STATIC_DRAW}),p=A.Buffer.createVertexBuffer({context:r,typedArray:a,usage:A.BufferUsage.STATIC_DRAW}),C=A.Buffer.createVertexBuffer({context:r,typedArray:new Float32Array([0,0,1,0,1,1,0,1]),usage:A.BufferUsage.STATIC_DRAW}),m=A.Buffer.createIndexBuffer({context:r,typedArray:new Uint16Array([0,1,2,0,2,3]),usage:A.BufferUsage.STATIC_DRAW,indexDatatype:A.IndexDatatype.UNSIGNED_SHORT}),f=[];f.push({index:I.aPosition,vertexBuffer:u,componentsPerAttribute:3,componentDatatype:A.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:12,normalize:!1,instanceDivisor:1}),f.push({index:I.aDirection,vertexBuffer:d,componentsPerAttribute:4,componentDatatype:A.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:16,normalize:!1,instanceDivisor:1}),f.push({index:I.aSpeedScaleLifeTime,vertexBuffer:p,componentsPerAttribute:4,componentDatatype:A.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:16,normalize:!1,instanceDivisor:1}),f.push({index:I.aTexcoord,vertexBuffer:C,componentsPerAttribute:2,componentDatatype:A.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:8,normalize:!1}),f.push({index:I.aPlane,vertexBuffer:g,componentsPerAttribute:2,componentDatatype:A.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:8,normalize:!1});var v=new A.VertexArray({context:r,attributes:f,indexBuffer:m});e.vertexArray&&e.vertexArray.destroy(),e.vertexArray=v},t.prototype._updateCommandBoundingVolume=function(t,e){var i=this._positions.length;if(!(i<1))if(i<2)e.boundingVolume=new A.BoundingSphere(this._positions[0].clone(),this._radius);else{for(var r=new A.BoundingSphere(this._positions[0].clone(),this._radius),n=1;n<i;n++)r=A.BoundingSphere.expand(r,this._positions[n],r);e.boundingVolume=r}},t.prototype._updateCommandShaderProgram=function(t,e){if(!e.shaderProgram){var i=t.context;e.shaderProgram=A.ShaderProgram.fromCache({context:i,vertexShaderSource:r,fragmentShaderSource:a,attributeLocations:I})}},t.prototype._updateCommandUniforms=function(t,e){var i=e.uniformMap={};if(!i||!i._ready){var r=this;i._ready=!0,i.u_startScale=function(){return r._startScale},i.u_endScale=function(){return r._endScale},i.u_imageSize=function(){return r._imageSize},i.u_startColor=function(){return r._startColor},i.u_endColor=function(){return r._endColor},i.u_texture_0=function(){return r._texture_0},i.u_texture_1=function(){return r._texture_1?r._texture_1:r._texture_0}}},t.prototype._updateCommandRenderState=function(t,e){e.renderState||(e.renderState=A.RenderState.fromCache({cull:{enabled:!1},depthTest:{enabled:!0,func:A.WebGLConstants.LEQUAL},depthMask:!1,blending:A.BlendingState.ALPHA_BLEND}))},t.prototype._updateCommandModelMatrix=function(t,e){e.modelMatrix||(e.modelMatrix=A.Matrix4.IDENTITY)};var r="attribute vec2 aPlane;\nattribute vec3 aPosition;\nattribute vec4 aDirection;\nattribute vec4 aSpeedScaleLifeTime;\nattribute vec2 aTexcoord;\nuniform vec4 u_startColor;\nuniform vec4 u_endColor;\nuniform float u_startScale;\nuniform float u_endScale;\nuniform float u_imageSize;\nvarying vec3 v_texcoord_0;\nvarying vec4 v_colorFact;\nvarying float v_texIndex;\nvec4 computePosition(vec3 position, vec2 plane, vec3 direction, float imageSize, float baseScale, float speed, float time){\n   vec3 v = normalize(direction) * speed * time;\n   v += position;\n   vec4 result = czm_modelView * vec4(v, 1.0);\n   result.xy += plane * imageSize * baseScale;\n   return result;\n}\nvoid main()\n{\n   float speed = aSpeedScaleLifeTime.x;\n   float baseScale = aSpeedScaleLifeTime.y;\n   float life = aSpeedScaleLifeTime.z;\n   float time = aSpeedScaleLifeTime.w;\n   float t = time / life;\n   baseScale *= mix(u_startScale, u_endScale, t);\n   vec4 positionEC = computePosition(aPosition, aPlane, aDirection.xyz, u_imageSize, baseScale, speed, time);\n   gl_Position = czm_projection * positionEC;\n   v_texcoord_0.xy = aTexcoord;\n   v_texcoord_0.z = aDirection.w;\n   if (t > 0.618){\n       v_texIndex = 2.0;\n   }\n   else if (t > 0.382){\n       v_texIndex = 1.0;\n   }\n   else{\n       v_texIndex = 0.0;\n   }\n   if (t > 0.618){\n       v_colorFact = vec4(1.0 - t);\n   }\n   else{\n       v_colorFact = mix(u_startColor, u_endColor, t);\n   }\n}",a="varying vec3 v_texcoord_0;\nvarying vec4 v_colorFact;\nvarying float v_texIndex;\nuniform sampler2D u_texture_0;\nuniform sampler2D u_texture_1;\nvoid main()\n{\n   int mode = int(v_texcoord_0.z);\n   vec4 color = vec4(0.0);\n   if (mode == 0){\n       if (v_texIndex == 1.0){\n           color = texture2D(u_texture_1, v_texcoord_0.xy);\n       }\n       else{\n           color = texture2D(u_texture_0, v_texcoord_0.xy);\n       }\n   }\n   else if (mode == 1){\n       if (v_texIndex == 1.0){\n           color = texture2D(u_texture_1, v_texcoord_0.xy);\n       }\n       else{\n           color = texture2D(u_texture_0, v_texcoord_0.xy);\n       }\n       color.rg *= 1.4;\n   }\n   else if (mode == 2){\n       color = v_colorFact;\n   }\n   if (color.a == 1.0){\n       float mc = max(max(color.r, color.g), color.b);\n       color.a = mc;\n   }\n   else{\n       if (color.a > 0.995){\n           color.a = 0.0;\n       }\n   }\n   color = czm_gammaCorrect(color);\n   vec4 fact = czm_gammaCorrect(v_colorFact);\n   color *= fact;\n   if (color.a < 0.1){discard;}\n   gl_FragColor = color;\n}"}(window.Cesium),function(A){function n(){this._position=null,this._actived=!1,this._speed=0,this._direction=null,this._baseScale=1,this._life=0,this._time=0,this._mode=0,this._alphaFact=0,this._normalFact=1}n.prototype.active=function(){this._actived=!0,this._time=0};var r=new A.Cartesian3,o=new A.Cartesian3;n.prototype.update=function(t){if(this._actived)if(this._time+=t,this._time>this._life)this._actived=!1;else{var e=A.Cartesian3.normalize(this._position,r),i=A.Cartesian3.multiplyByScalar(this._direction,this._normalFact,o);A.Cartesian3.add(e,i,e),A.Cartesian3.normalize(e,this._direction),A.Cartesian3.multiplyByScalar(this._direction,t*this._speed,e),A.Cartesian3.add(this._position,e,this._position),.025<this._speed&&(this._speed-=.025)}},A.defineProperties(n.prototype,{position:{get:function(){return this._position},set:function(t){t&&(this._position=t.clone(this._position))}},direction:{get:function(){return this._direction},set:function(t){t&&(this._direction=t.clone(this._direction))}},actived:{get:function(){return this._actived}},speed:{get:function(){return this._speed},set:function(t){this._speed=t}},baseScale:{get:function(){return this._baseScale},set:function(t){this._baseScale=t}},life:{get:function(){return this._life},set:function(t){this._life=t}},time:{get:function(){return this._time}},mode:{get:function(){return this._mode},set:function(t){this._mode=t}},alphaFact:{get:function(){return this._alphaFact},set:function(t){this._alphaFact=t}},normalFact:{get:function(){return this._normalFact},set:function(t){this._normalFact=t}}});var a=new A.Cartesian3,t=A.GeoLineSmokeEffect=function(t){if(t=t||{},this._url=t.url?A.buildModuleUrl(t.url):null,this._positions=[],this._scene=t.viewer.scene,this._clock=viewer.clock,this.scale=t.scale?t.scale:1,this._startColor=new A.Color,this._endColor=new A.Color,this.density=t.density?t.density:.5,this.life=t.life?t.life:1,this.speed=t.speed?t.speed:1,this.normalFactor=t.normalFactor?t.normalFactor:1,this._count=t.count?t.count:600,this._radius=t.radius?t.radius:.5,this._grow=t.grow?t.grow:60,this._smokes=[],this._texture_0=null,this._drawCommandAlpha=null,this._drawCommandOpaque=null,this._pointsArray=null,this._directionsArray=null,this._speedScaleLifeTimesArray=null,this._needUpdate=!0,this._needTime=0,this._preTime=0,this._time=0,this._door=.075,this._loadTexture(),this._initSmokes(this._count),t.positions&&t.positions.length)for(var e=t.positions,i=e.length,r=0;r<i;r++)this.addPosition(e[r])};A.defineProperties(t.prototype,{scale:{get:function(){return this._imageSize},set:function(t){this._startScale=.7*t,this._endScale=1.6*t,this._imageSize=1*t}},life:{get:function(){return this._maxLife/4},set:function(t){this._minLife=2.5*t,this._maxLife=4*t}},speed:{get:function(){return this._maxSpeed/6},set:function(t){this._minSpeed=1.5*t,this._maxSpeed=6*t}},radius:{get:function(){return this._radius},set:function(t){this._radius=t}},grow:{get:function(){return this._grow},set:function(t){this._grow=t}},pntsCount:{get:function(){return this._positions.length}},density:{get:function(){return 1-this._endColor.red},set:function(t){t=1-t,this._endColor.red=t,this._endColor.green=t,this._endColor.blue=t,this._endColor.alpha=.715,this._startColor.red=Math.min(1,t+.3),this._startColor.green=Math.min(1,t+.3),this._startColor.blue=Math.min(1,t+.3),this._startColor.alpha=1}},normalFactor:{get:function(){this._maxNormalFactor},set:function(t){this._minNormalFactor=5*t,this._maxNormalFactor=16*t}}});var s=new A.Cartesian3;t.prototype.addPosition=function(t){if(t&&void 0!==t.longitude){t=A.Cartesian3.fromRadians(t.longitude,t.latitude,t.height,void 0,s);var e=10,i=this._positions.length;if(0<i){var r=this._positions[i-1];a=A.Cartesian3.subtract(t,r,a),e=A.Cartesian3.magnitude(a)}e<.5||(this._positions.push(t.clone()),this._growSmokes(this._grow,e))}},t.prototype.destroy=function(){this._scene=null,this._clock=null,this._drawCommandAlpha&&(this._drawCommandAlpha.vertexArray&&(this._drawCommandAlpha.vertexArray.destroy(),this._drawCommandAlpha.vertexArray=null),this._drawCommandAlpha.shaderProgram&&(this._drawCommandAlpha.shaderProgram.destroy(),this._drawCommandAlpha.shaderProgram=null),this._drawCommandAlpha._owner=null,this._drawCommandAlpha=null),this._drawCommandOpaque&&(this._drawCommandOpaque.vertexArray&&(this._drawCommandOpaque.vertexArray.destroy(),this._drawCommandOpaque.vertexArray=null),this._drawCommandOpaque.shaderProgram&&(this._drawCommandOpaque.shaderProgram.destroy(),this._drawCommandOpaque.shaderProgram=null),this._drawCommandOpaque._owner=null,this._drawCommandOpaque=null),this._texture_0&&(this._texture_0.destroy(),this._texture_0=null),this._smokes.length=0,this._positions.length=0,this._pointsArray=null,this._directionsArray=null,this._speedScaleLifeTimesArray=null},t.prototype._loadTexture=function(){var e=this,i=e._scene.frameState.context;e._url&&(e._texture_0&&(e._texture_0.destroy(),e._texture_0=null),A.Resource.fetchImage(e._url).then(function(t){e._texture_0=new A.Texture({context:i,source:t},function(t){})}))},t.prototype._emissionPosition=function(){var t=this._positions.length;if(t<1)return null;if(t<2)return this._positions[0].clone(a),a.x+=A.Math.randomBetween(0,1)*this._radius,a.y+=A.Math.randomBetween(0,1)*this._radius,a.z+=A.Math.randomBetween(0,1)*this._radius,a;var e=A.Math.randomBetween(0,t-1);e=Math.floor(e);var i=this._positions[e],r=this._positions[e+1],n=A.Math.randomBetween(0,1);return a=A.Cartesian3.lerp(i,r,n,a)},t.prototype._initSmokes=function(t){if(t&&!(t<1))for(var e=0;e<t;e++){var i=new n;this._smokes.push(i)}},t.prototype._growSmokes=function(t,e){t=Math.round(t*e),this._count+=t;for(var i=0;i<t;i++){var r=new n;this._smokes.push(r)}};var l=new A.Cartesian3,h=new A.Quaternion,c=new A.Matrix4,g=new A.Matrix3;t.prototype._initSmoke=function(t){var e=this._emissionPosition();if(!e)return!1;if(t.position=e.clone(t.position),t.position){t.direction||(t.direction=new A.Cartesian3),A.Cartesian3.normalize(t.position,t.direction);var i=A.Math.randomBetween(.5,1.570789),r=A.Math.randomBetween(0,6.28318),n=A.Quaternion.fromAxisAngle(t.direction,r,h);if(t.direction.equals(A.Cartesian3.UNIT_X)){var o=A.Cartesian3.cross(t.direction,A.Cartesian3.UNIT_Z,l);A.Cartesian3.normalize(o,o),r=A.Quaternion.fromAxisAngle(o,i,h)}else{o=A.Cartesian3.cross(t.direction,A.Cartesian3.UNIT_X,l);A.Cartesian3.normalize(o,o),r=A.Quaternion.fromAxisAngle(o,i,h)}var a=A.Quaternion.multiply(n,r,n),s=A.Matrix4.fromRotationTranslation(A.Matrix3.fromQuaternion(a,g),void 0,c);A.Matrix4.multiplyByPointAsVector(s,t.direction,t.direction),A.Cartesian3.normalize(t.direction,t.direction)}return t.speed=A.Math.randomBetween(this._minSpeed,this._maxSpeed),t.life=A.Math.randomBetween(this._minLife,this._maxLife),t.baseScale=A.Math.randomBetween(.5,5),t.mode=0,t.alphaFact=A.Math.randomBetween(this._startColor.alpha,this._endColor.alpha),t.normalFact=A.Math.randomBetween(this._minNormalFactor,this._maxNormalFactor),null!=t.position},t.prototype._updateSmoke=function(t){t.update(this._time),t.actived||this._initSmoke(t)&&0<this._udoor&&(t.active(),this._udoor-=1)},t.prototype._updateTime=function(t){var e;if(e=this._clock.shouldAnimate?t.time.secondsOfDay:A.getTimestamp()/1e3,0==this._preTime)this._preTime=e;else{var i=e-this._preTime;i>this._maxLife&&(i=this._maxLife),this._time=i,this._preTime=e}},t.prototype.update=function(t){this._updateTime(t);var e=this._count;if(!(e<1||e!=this._smokes.length||this._positions.length<1)&&this._texture_0){if(this._needUpdate){this._udoor=this._door*e;for(var i=0;i<e;i++){var r=this._smokes[i];this._updateSmoke(r)}this._updateCommand(t),this._needUpdate=!1}else this._needUpdate=!0;this._isCommandReady()&&(t.commandList.push(this._drawCommandAlpha),t.commandList.push(this._drawCommandOpaque))}},t.prototype.updateNext=function(t){this._isCommandReady()&&(t.commandList.push(this._drawCommandAlpha),t.commandList.push(this._drawCommandOpaque))},t.prototype._updateCommand=function(t){var e=this._drawCommandAlpha;e||((e=this._drawCommandAlpha=new A.DrawCommand).pass=A.Pass.TRANSLUCENT,e.owner=this,e.count=6),e.instanceCount=this._count,this._updateCommandVA(t,e),this._updateCommandBoundingVolume(t,e),this._updateCommandShaderProgramAlpha(t,e),this._updateCommandUniforms(t,e),this._updateCommandRenderStateAlpha(t,e),this._updateCommandModelMatrix(t,e);var i=this._drawCommandOpaque;i||((i=this._drawCommandOpaque=new A.DrawCommand).pass=A.Pass.OPAQUE,i.owner=this,i.count=6),i.instanceCount=this._count,this._updateCommandRepeatVA(t,i),this._updateCommandBoundingVolume(t,i),this._updateCommandShaderProgramOpaque(t,i),this._updateCommandUniforms(t,i),this._updateCommandRenderStateOpaque(t,i),this._updateCommandModelMatrix(t,i)},t.prototype._isCommandReady=function(){var t=this._drawCommandAlpha;return!!t&&(!!t.vertexArray&&(!!t.boundingVolume&&(!!t.shaderProgram&&(!!t.uniformMap&&!!t.renderState))))};var I={aPlane:0,aPosition:1,aDirection:2,aSpeedScaleLifeTime:3,aTexcoord:4};t.prototype._updateCommandVA=function(t,e){var i=this._count,r=t.context;this._pointsArray||(this._pointsArray=A.ComponentDatatype.createTypedArray(A.ComponentDatatype.FLOAT,4*i));var n=this._pointsArray;this._directionsArray||(this._directionsArray=A.ComponentDatatype.createTypedArray(A.ComponentDatatype.FLOAT,4*i));var o=this._directionsArray;this._speedScaleLifeTimesArray||(this._speedScaleLifeTimesArray=A.ComponentDatatype.createTypedArray(A.ComponentDatatype.FLOAT,4*i));for(var a=this._speedScaleLifeTimesArray,s=0;s<i;s++){var l=this._smokes[s],h=l.position;n[4*s]=h.x,n[4*s+1]=h.y,n[4*s+2]=h.z,n[4*s+3]=l.alphaFact;var c=l.direction;o[4*s]=c.x,o[4*s+1]=c.y,o[4*s+2]=c.z,o[4*s+3]=l.mode,a[4*s]=l.speed,a[4*s+1]=l.baseScale,a[4*s+2]=l.life,a[4*s+3]=l.time}var g=A.Buffer.createVertexBuffer({context:r,typedArray:new Float32Array([-.5,0,.5,0,1,2,-1,2]),usage:A.BufferUsage.STATIC_DRAW}),u=A.Buffer.createVertexBuffer({context:r,typedArray:n,usage:A.BufferUsage.STATIC_DRAW}),d=A.Buffer.createVertexBuffer({context:r,typedArray:o,usage:A.BufferUsage.STATIC_DRAW}),p=A.Buffer.createVertexBuffer({context:r,typedArray:a,usage:A.BufferUsage.STATIC_DRAW}),C=A.Buffer.createVertexBuffer({context:r,typedArray:new Float32Array([0,0,1,0,1,1,0,1]),usage:A.BufferUsage.STATIC_DRAW}),m=A.Buffer.createIndexBuffer({context:r,typedArray:new Uint16Array([0,1,2,0,2,3]),usage:A.BufferUsage.STATIC_DRAW,indexDatatype:A.IndexDatatype.UNSIGNED_SHORT}),f=[];f.push({index:I.aPosition,vertexBuffer:u,componentsPerAttribute:4,componentDatatype:A.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:16,normalize:!1,instanceDivisor:1}),f.push({index:I.aDirection,vertexBuffer:d,componentsPerAttribute:4,componentDatatype:A.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:16,normalize:!1,instanceDivisor:1}),f.push({index:I.aSpeedScaleLifeTime,vertexBuffer:p,componentsPerAttribute:4,componentDatatype:A.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:16,normalize:!1,instanceDivisor:1}),f.push({index:I.aTexcoord,vertexBuffer:C,componentsPerAttribute:2,componentDatatype:A.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:8,normalize:!1}),f.push({index:I.aPlane,vertexBuffer:g,componentsPerAttribute:2,componentDatatype:A.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:8,normalize:!1});var v=new A.VertexArray({context:r,attributes:f,indexBuffer:m});e.vertexArray&&e.vertexArray.destroy(),e.vertexArray=v},t.prototype._updateCommandRepeatVA=function(t,e){this._count;var i=t.context;if(this._pointsArray){var r=this._pointsArray,n=this._directionsArray,o=this._speedScaleLifeTimesArray,a=A.Buffer.createVertexBuffer({context:i,typedArray:new Float32Array([-.5,0,.5,0,1,2,-1,2]),usage:A.BufferUsage.STATIC_DRAW}),s=A.Buffer.createVertexBuffer({context:i,typedArray:r,usage:A.BufferUsage.STATIC_DRAW}),l=A.Buffer.createVertexBuffer({context:i,typedArray:n,usage:A.BufferUsage.STATIC_DRAW}),h=A.Buffer.createVertexBuffer({context:i,typedArray:o,usage:A.BufferUsage.STATIC_DRAW}),c=A.Buffer.createVertexBuffer({context:i,typedArray:new Float32Array([0,0,1,0,1,1,0,1]),usage:A.BufferUsage.STATIC_DRAW}),g=A.Buffer.createIndexBuffer({context:i,typedArray:new Uint16Array([0,1,2,0,2,3]),usage:A.BufferUsage.STATIC_DRAW,indexDatatype:A.IndexDatatype.UNSIGNED_SHORT}),u=[];u.push({index:I.aPosition,vertexBuffer:s,componentsPerAttribute:4,componentDatatype:A.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:16,normalize:!1,instanceDivisor:1}),u.push({index:I.aDirection,vertexBuffer:l,componentsPerAttribute:4,componentDatatype:A.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:16,normalize:!1,instanceDivisor:1}),u.push({index:I.aSpeedScaleLifeTime,vertexBuffer:h,componentsPerAttribute:4,componentDatatype:A.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:16,normalize:!1,instanceDivisor:1}),u.push({index:I.aTexcoord,vertexBuffer:c,componentsPerAttribute:2,componentDatatype:A.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:8,normalize:!1}),u.push({index:I.aPlane,vertexBuffer:a,componentsPerAttribute:2,componentDatatype:A.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:8,normalize:!1});var d=new A.VertexArray({context:i,attributes:u,indexBuffer:g});e.vertexArray&&e.vertexArray.destroy(),e.vertexArray=d}};var u=new A.BoundingSphere;t.prototype._updateCommandBoundingVolume=function(t,e){var i=this._positions.length;if(i<1)e.boundingVolume=null;else if(i<2)u.center=this._positions[0].clone(u.center),u.radius=this._radius+this._maxSpeed*this._maxLife,e.boundingVolume=u;else{u.center=this._positions[0].clone(u.center),u.radius=this._radius;for(var r=1;r<i;r++)A.BoundingSphere.expand(u,this._positions[r],u);e.boundingVolume=u}},t.prototype._updateCommandShaderProgramAlpha=function(t,e){if(!e.shaderProgram){var i=t.context;e.shaderProgram=A.ShaderProgram.fromCache({context:i,vertexShaderSource:d,fragmentShaderSource:p,attributeLocations:I})}},t.prototype._updateCommandShaderProgramOpaque=function(t,e){if(!e.shaderProgram){var i=t.context;e.shaderProgram=A.ShaderProgram.fromCache({context:i,vertexShaderSource:C,fragmentShaderSource:m,attributeLocations:I})}},t.prototype._updateCommandUniforms=function(t,e){var i=e.uniformMap={};if(!i||!i._ready){var r=this;i._ready=!0,i.u_startScale=function(){return r._startScale},i.u_endScale=function(){return r._endScale},i.u_imageSize=function(){return r._imageSize},i.u_startColor=function(){return r._startColor},i.u_endColor=function(){return r._endColor},i.u_texture_0=function(){return r._texture_0}}},t.prototype._updateCommandRenderStateAlpha=function(t,e){e.renderState||(e.renderState=A.RenderState.fromCache({cull:{enabled:!1},depthTest:{enabled:!0,func:A.WebGLConstants.LEQUAL},depthMask:!1,blending:A.BlendingState.ALPHA_BLEND}))},t.prototype._updateCommandRenderStateOpaque=function(t,e){e.renderState||(e.renderState=A.RenderState.fromCache({cull:{enabled:!1},depthTest:{enabled:!0,func:A.WebGLConstants.LEQUAL},depthMask:!0}))},t.prototype._updateCommandModelMatrix=function(t,e){e.modelMatrix||(e.modelMatrix=A.Matrix4.IDENTITY)};var d="attribute vec2 aPlane;\nattribute vec4 aPosition;\nattribute vec4 aDirection;\nattribute vec4 aSpeedScaleLifeTime;\nattribute vec2 aTexcoord;\nuniform vec4 u_startColor;\nuniform vec4 u_endColor;\nuniform float u_startScale;\nuniform float u_endScale;\nuniform float u_imageSize;\nvarying vec3 v_texcoord_0;\nvarying vec4 v_colorFact;\nvec4 computePosition(vec3 position, vec2 plane, vec3 direction, float imageSize, float baseScale, float speed, float time){\n   vec3 v = position;\n   vec4 result = czm_modelView * vec4(v, 1.0);\n   result /= result.w;\n   result.xy += plane * imageSize * baseScale;\n   return result;\n}\nvoid main()\n{\n   float speed = aSpeedScaleLifeTime.x;\n   float baseScale = aSpeedScaleLifeTime.y;\n   float life = aSpeedScaleLifeTime.z;\n   float time = aSpeedScaleLifeTime.w;\n   float t = time / life;\n   baseScale *= mix(u_startScale, u_endScale, t);\n   vec4 positionEC = computePosition(aPosition.xyz, aPlane, aDirection.xyz, u_imageSize, baseScale, speed, time);\n   gl_Position = czm_projection * positionEC;\n   v_texcoord_0.xy = aTexcoord;\n   v_texcoord_0.z = t;\n   v_colorFact = vec4(mix(u_startColor.rgb, u_endColor.rgb, aPosition.w * (u_startColor.a + u_endColor.a) / 2.0), aPosition.w);\n}",p="varying vec3 v_texcoord_0;\nvarying vec4 v_colorFact;\nuniform sampler2D u_texture_0;\nvoid main()\n{\n   vec4 color = vec4(0.0);\n   color = texture2D(u_texture_0, v_texcoord_0.xy);\n   color = czm_gammaCorrect(color);\n   vec4 fact = v_colorFact;\n   color *= fact;\n   if (v_texcoord_0.z > 0.9){color.a *= 0.1;}\n   gl_FragColor = color;\n}",C="attribute vec2 aPlane;\nattribute vec4 aPosition;\nattribute vec4 aDirection;\nattribute vec4 aSpeedScaleLifeTime;\nattribute vec2 aTexcoord;\nuniform vec4 u_startColor;\nuniform vec4 u_endColor;\nuniform float u_startScale;\nuniform float u_endScale;\nuniform float u_imageSize;\nvarying vec3 v_texcoord_0;\nvarying vec4 v_colorFact;\nvec4 computePosition(vec3 position, vec2 plane, vec3 direction, float imageSize, float baseScale, float speed, float time){\n   vec3 v = position;\n   vec4 result = czm_modelView * vec4(v, 1.0);\n   result /= result.w;\n   result.xy += plane * imageSize * baseScale;\n   return result;\n}\nvoid main()\n{\n   float speed = aSpeedScaleLifeTime.x;\n   float baseScale = aSpeedScaleLifeTime.y;\n   float life = aSpeedScaleLifeTime.z;\n   float time = aSpeedScaleLifeTime.w;\n   float t = time / life;\n   baseScale *= mix(u_startScale, u_endScale, t);\n   vec4 positionEC = computePosition(aPosition.xyz, aPlane, aDirection.xyz, u_imageSize, baseScale, speed, time);\n   gl_Position = czm_projection * positionEC;\n   v_texcoord_0.xy = aTexcoord;\n   v_texcoord_0.z = t;\n   v_colorFact = vec4(mix(u_startColor.rgb, u_endColor.rgb, aPosition.w * (u_startColor.a + u_endColor.a) / 2.0), aPosition.w);\n}",m="varying vec3 v_texcoord_0;\nvarying vec4 v_colorFact;\nuniform sampler2D u_texture_0;\nvoid main()\n{\n   if (v_texcoord_0.z > 0.9){discard;}\n   vec4 color = vec4(0.0);\n   color = texture2D(u_texture_0, v_texcoord_0.xy);\n   color = czm_gammaCorrect(color);\n   vec4 fact = v_colorFact;\n   color *= fact;\n   if (color.a < 0.746){discard;}\n   gl_FragColor = color;\n}"}(window.Cesium),function(E){function t(t){t=e(t,e.EMPTY_OBJECT),this.viewer=t.viewer,this.playing=t.playing,this.data=t.data,this.sampleMaxHeight=e(t.sampleMaxHeight,2e4),this.sampleMaxPoint=e(t.sampleMaxPoint,50),this._data=[],this._name=i+"_"+E.createGuid(),this._lines=[],this.setData(this.data),this.render()}t.prototype.setData=function(t){var i=this;this._data=[];var r=this;t instanceof Array&&t.forEach(function(t){var e=function(t,e,i,r){var n=[],o=E.Cartographic.fromCartesian(t),a=E.Cartographic.fromCartesian(e),s=180*o.longitude/Math.PI,l=180*o.latitude/Math.PI,h=180*a.longitude/Math.PI,c=180*a.latitude/Math.PI,g=Math.sqrt((s-h)*(s-h)+(l-c)*(l-c))*i,u=E.Cartesian3.clone(t),d=E.Cartesian3.clone(e),p=E.Cartesian3.distance(u,E.Cartesian3.ZERO),C=E.Cartesian3.distance(d,E.Cartesian3.ZERO);if(E.Cartesian3.normalize(u,u),E.Cartesian3.normalize(d,d),0==E.Cartesian3.distance(u,d))return n;var m=E.Cartesian3.angleBetween(u,d);n.push(t);for(var f=1;f<r-1;f++){var v=1*f/(r-1),A=1-v,I=Math.sin(A*m)/Math.sin(m),_=Math.sin(v*m)/Math.sin(m),y=E.Cartesian3.multiplyByScalar(u,I,new E.Cartesian3),w=E.Cartesian3.multiplyByScalar(d,_,new E.Cartesian3),P=E.Cartesian3.add(y,w,new E.Cartesian3),x=v*Math.PI,b=p*A+C*v+Math.sin(x)*g;P=E.Cartesian3.multiplyByScalar(P,b,P),n.push(P)}return n.push(e),n}(E.Cartesian3.fromDegrees.apply(i,t.posititons[0]),E.Cartesian3.fromDegrees.apply(i,t.posititons[1]),r.sampleMaxHeight,r.sampleMaxPoint);r._data.push({posititons:e,color:t.color,width:t.width,duration:t.duration})})},t.prototype.getData=function(){return this._data},t.prototype._createPolylines=function(){var t=this._data,i=this._lines,r=this.viewer.entities,n=this._name,o=this;this._clearPolylines(),t instanceof Array&&t.forEach(function(t){var e=new E.Entity({name:n,polyline:{positions:t.posititons,width:t.width,material:new a({color:t.color,width:t.width,duration:t.duration,playing:o.playing})}});i.push(e),r.add(e)})},t.prototype.render=function(){this._createPolylines()},t.prototype._clearPolylines=function(){var t=this._lines,e=this.viewer.entities;t.forEach(function(t){e.remove(t)}),t.length=0},t.prototype.play=function(e){this.playing="boolean"==typeof e?e:!this.playing;var t=this._lines;e=this.playing;t.forEach(function(t){t.polyline.material.playing=e})},t.prototype.destroy=function(){};var e=E.defaultValue,i=(E.defined,"GEOODLINE");function a(t){this._definitionChanged=new E.Event,this._color=void 0,this._colorSubscription=void 0,this.color=t.color,this.width=t.width,this.duration=t.duration,this.playing=t.playing,this._time=(new Date).getTime()}E.defineProperties(a.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}},color:E.createPropertyDescriptor("color")}),a.prototype.getType=function(t){return i},a.prototype.getValue=function(t,e){return E.defined(e)||(e={}),e.color=E.Property.getValueOrClonedDefault(this._color,t,E.Color.WHITE,e.color),e.totoalFrameCount=this.playing?60*this.duration:0,e},a.prototype.equals=function(t){return this===t},delete E.Material._materialCache._materials[i],E.Material._materialCache.addMaterial(i,{fabric:{type:i,uniforms:{color:new E.Color(1,1,0,1),totoalFrameCount:450},source:"\n\t\tczm_material czm_getMaterial(czm_materialInput materialInput)\n\t\t{\n\t\t    czm_material material = czm_getDefaultMaterial(materialInput);\n\t\t    vec2 st = materialInput.st;\n\t\t    float t = mod(czm_frameNumber, totoalFrameCount) / totoalFrameCount; \n\t\t    t *= 1.03;\n\t\t    float alpha = smoothstep(t- 0.03, t, st.s) * step(-t, -st.s); \n\t\t    alpha += 0.1;\n\t\t    material.diffuse = color.rgb;\n\t\t    material.alpha = alpha;\n\t\t    return material;\n\t\t}\n    "},translucent:function(){return!0}}),E.GeoODLine=t}(window.Cesium),function(p){var t=p.GeoOutlineFireEffect=function(t){this._viewer=t.viewer,this._actived=!!t.actived&&t.actived,this._fireEffect=null,this._postProcess=null,this._viewMatrix=p.Matrix4.IDENTITY,this._assigned=[],this._framebuffer=null,this._depthAttachment=null,this._clearCommand=null,this._groundTexture=null,this._xPlane=null,this._yPlane=null,this._zPlane=null,this._xyRange=null,this._needUpdate=!1,this._checkPositionsOrder(t),this._createGroundTexture(t),this._createFireEffect(t),this._createXYPlanes(t),this._createPostProcess(t)};p.defineProperties(t.prototype,{explode:{get:function(){return this._fireEffect?this._fireEffect.explode:0},set:function(t){this._fireEffect&&(this._fireEffect.explode=t)}},scale:{get:function(){return this._fireEffect?this._fireEffect.scale:1},set:function(t){this._fireEffect&&(this._fireEffect.scale=t)}},life:{get:function(){return this._fireEffect?this._fireEffect.life:0},set:function(t){this._fireEffect&&(this._fireEffect.life=t)}},speed:{get:function(){return this._fireEffect?this._fireEffect.speed:0},set:function(t){this._fireEffect&&(this._fireEffect.speed=t)}},radius:{get:function(){return this._fireEffect?this._fireEffect.radius:0},set:function(t){this._fireEffect&&(this._fireEffect.radius=t)}},grow:{get:function(){return this._fireEffect?this._fireEffect.grow:0},set:function(t){this._fireEffect&&(this._fireEffect.grow=t)}},smoking:{get:function(){return this._fireEffect?this._fireEffect.smoking:0},set:function(t){this._fireEffect&&(this._fireEffect.smoking=t)}},actived:{get:function(){return this._actived},set:function(t){this._actived=t}}}),t.prototype.update=function(t){this._actived?(this._updateAssiged(t),this._postProcess&&(this._viewMatrix=t.camera._invViewMatrix,this._groundTexture?this._postProcess.enabled=!0:this._postProcess.enabled=!1)):this._postProcess&&(this._postProcess.enabled=!1)},t.prototype._createFireEffect=function(t){if(t&&!this._fireEffect){var e=t.positions;if(e&&void 0!==e.length&&!(e.length<1)){var i=e.length;e[0]!=e[i-1]&&e.push(e[0].clone()),t.explode||(t.explode=.21),t.smoking||(t.smoking=.15),t.scale||(t.scale=1),t.life||(t.life=1.1),t.speed||(t.speed=1.7),this._fireEffect=new p.GeoLineFireEffect(t)}}};var n=new p.Cartesian3,o=new p.Cartesian3;t.prototype._computePlane=function(t,e){var i=p.Cartesian3.cross(e,t,n);p.Cartesian3.normalize(i,i);var r=p.Cartesian3.lerp(t,e,.5,o);return new p.Cartesian4(i.x,i.y,i.z,-p.Cartesian3.dot(i,r))},t.prototype._appendAreaPlanes=function(t,e,i,r){t.push(this._computePlane(e,i)),t.push(this._computePlane(i,r)),t.push(this._computePlane(r,e))},t.prototype._createAssignedFrameBuffer=function(t){var e=this,i=t.context,r=i.drawingBufferWidth,n=i.drawingBufferHeight;e._depthAttachment&&(e._depthAttachment.destroy(),e._depthAttachment=null),e._framebuffer&&(e._framebuffer.destroy(),e._framebuffer=null);var o=new p.Texture({context:i,width:r,height:n,pixelFormat:p.PixelFormat.DEPTH_STENCIL,pixelDatatype:p.PixelDatatype.UNSIGNED_INT_24_8,sampler:new p.Sampler({wrapS:p.TextureWrap.CLAMP_TO_EDGE,wrapT:p.TextureWrap.CLAMP_TO_EDGE,minificationFilter:p.TextureMinificationFilter.NEAREST,magnificationFilter:p.TextureMagnificationFilter.NEAREST})}),a=new p.Framebuffer({context:i,depthStencilTexture:o,destroyAttachments:!1});e._clearCommand||(e._clearCommand=new p.ClearCommand({depth:1,color:new p.Color})),e._framebuffer=a,e._depthAttachment=o},t.prototype.addFireEffect=function(t){(t=t||{}).explode=t.explode?.2*t.explode:.2,t.smoking=t.smoking?.95*t.smoking:.95,t.life=t.life?4.5*t.life:4.5,t.scale=t.scale?t.scale:1,t.radius=t.radius?.5*t.radius:.5,t.speed=t.speed?.4*t.speed:.4;var e=new p.GeoLineFireEffect(t);this._assigned.push(e)},t.prototype.addSmokeEffect=function(t){var e=new p.GeoLineSmokeEffect(t);this._assigned.push(e)},t.prototype._updateAssiged=function(t){var e=this;this._fireEffect&&this._fireEffect.update(t);for(var i=e._assigned.length,r=0;r<i;r++){e._assigned[r].update(t)}if(e._framebuffer&&e._framebuffer._depthStencilTexture._width==t.context.drawingBufferWidth&&e._framebuffer._depthStencilTexture._height==t.context.drawingBufferHeight||e._createAssignedFrameBuffer(t),e._framebuffer){var n=t.context,o=t.commandList,a=t.commandList=[];a.push(e._clearCommand);for(r=0;r<i;r++){e._assigned[r].updateNext(t)}e._fireEffect.updateNext(t),t.commandList=o;var s=e._viewer.scene._view.passState,l=s.framebuffer;if(s.framebuffer=e._framebuffer,0<a.length)for(var h=0;h<a.length;h++){a[h].execute(n,s)}s.framebuffer=l}},t.prototype._createPostProcess=function(t){if(t&&!this._postProcess){var e=t.positions;if(e){var i=e.length;if(i&&!(i<4)){var r=this;i-=2;for(var n=[],o=p.Cartesian3.fromRadians(e[0].longitude,e[0].latitude,e[0].height),a=1;a<i&&!(12<=a);a++){var s=p.Cartesian3.fromRadians(e[a].longitude,e[a].latitude,e[a].height),l=p.Cartesian3.fromRadians(e[a+1].longitude,e[a+1].latitude,e[a+1].height);this._appendAreaPlanes(n,o,s,l)}var h="uniform mat4 u_nViewMatrix;\nuniform int u_count;\nuniform vec4 u_planes["+12..toString()+"];\nuniform vec4 u_xPlane;\nuniform vec4 u_yPlane;\nuniform vec4 u_zPlane;\nuniform vec2 u_xyRange;\nuniform sampler2D colorTexture;\nuniform sampler2D depthTexture;\nuniform sampler2D u_assignedTexture;\nuniform sampler2D u_groundTexture;\nvarying vec2 v_textureCoordinates;\nvec4 toEye(in vec2 uv, in float depth){\n    vec2 xy = vec2((uv.x * 2.0 - 1.0),(uv.y * 2.0 - 1.0));\n    vec4 posInCamera = czm_inverseProjection * vec4(xy, depth, 1.0);\n    posInCamera = posInCamera / posInCamera.w;\n    return posInCamera;\n}\nfloat getDepth(in vec4 depth){\n    float z_window = czm_unpackDepth(depth);\n    z_window = czm_reverseLogDepth(z_window);\n    float n_range = czm_depthRange.near;\n    float f_range = czm_depthRange.far;\n    return (2.0 * z_window - n_range - f_range) / (f_range - n_range);\n}\nvec2 getGroundTexCoord(in vec3 position){\n    float x = czm_planeDistance(u_xPlane, position) / u_xyRange.x;\n    float y = czm_planeDistance(u_yPlane, position) / u_xyRange.y;\n    return vec2(x * 4.0, y * 4.0);\n}\nvoid main(){\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\n    vec4 currD = texture2D(depthTexture, v_textureCoordinates);\n    if(currD.r>=1.0){\n        gl_FragColor = color;\n        return;\n    }\n    vec4 assigned = texture2D(u_assignedTexture, v_textureCoordinates);\n    if(assigned.r < 1.0){\n        gl_FragColor = color;\n        return;\n    }\n    float depth = getDepth(currD);\n    vec4 positionEC = toEye(v_textureCoordinates, depth);\n    vec4 position = u_nViewMatrix * positionEC;\n    position /= position.w;\n    float z = czm_planeDistance(u_zPlane, position.xyz);\n    vec2 gndTexCoord = getGroundTexCoord(position.xyz);\n    vec4 colorGround = texture2D(u_groundTexture, gndTexCoord);\n    for (int i = 0; i < "+12..toString()+"; i += 3){\n        if (i >= u_count){\n            break;\n        }\n        float d0 = czm_planeDistance(u_planes[i], position.xyz);\n        float d1 = czm_planeDistance(u_planes[i+1], position.xyz);\n        float d2 = czm_planeDistance(u_planes[i+2], position.xyz);\n        if (d0 > 0.0 && d1 > 0.0 && d2 > 0.0){\n           if (z < -1000.0){break;}\n           color += colorGround * vec4(0.5);\n           break;\n        }\n    }\n    gl_FragColor = color;\n}";this._postProcess=new p.PostProcessStage({fragmentShader:h,uniforms:{u_nViewMatrix:function(){return r._viewMatrix},u_planes:function(){return n},u_count:function(){return n.length},u_assignedTexture:function(){return r._depthAttachment},u_groundTexture:function(){return r._groundTexture},u_xPlane:function(){return r._xPlane},u_yPlane:function(){return r._yPlane},u_zPlane:function(){return r._zPlane},u_xyRange:function(){return r._xyRange}}}),this._postProcess.enabled=!1,this._viewer.scene.postProcessStages.add(this._postProcess)}}}},t.prototype._checkPositionsOrder=function(t){var e=t.positions;if(e&&void 0!==e.length&&!(e.length<4)){var i=p.Cartesian3.fromRadians(e[0].longitude,e[0].latitude,e[0].height),r=p.Cartesian3.fromRadians(e[1].longitude,e[1].latitude,e[1].height),n=p.Cartesian3.fromRadians(e[2].longitude,e[2].latitude,e[2].height),o=p.Cartesian3.subtract(r,i,new p.Cartesian3),a=p.Cartesian3.subtract(n,i,new p.Cartesian3),s=p.Cartesian3.cross(a,o,new p.Cartesian3);p.Cartesian3.dot(s,i)<0&&e.reverse()}},t.prototype._createXYPlanes=function(t){var e=t.positions;if(e&&void 0!==e.length&&!(e.length<4)){var i=p.Cartesian3.fromRadians(e[0].longitude,e[0].latitude,e[0].height),r=p.Cartesian3.fromRadians(e[1].longitude,e[1].latitude,e[1].height),n=p.Cartesian3.fromRadians(e[2].longitude,e[2].latitude,e[2].height),o=p.Cartesian3.subtract(r,i,new p.Cartesian3),a=p.Cartesian3.subtract(n,i,new p.Cartesian3),s=p.Cartesian3.magnitude(o),l=p.Cartesian3.magnitude(a);p.Cartesian3.normalize(o,o),p.Cartesian3.normalize(a,a);var h=p.Cartesian3.cross(a,o,new p.Cartesian3);p.Cartesian3.normalize(h,h);var c=p.Cartesian3.dot(a,o)*s,g=Math.max(s,c),u=p.Cartesian3.cross(o,h,new p.Cartesian3);p.Cartesian3.normalize(u,u);var d=p.Cartesian3.dot(a,u)*l;this._xPlane=new p.Cartesian4(o.x,o.y,o.z,-p.Cartesian3.dot(o,i)),this._yPlane=new p.Cartesian4(u.x,u.y,u.z,-p.Cartesian3.dot(u,i)),this._zPlane=new p.Cartesian4(h.x,h.y,h.z,-p.Cartesian3.dot(h,i)),this._xyRange=new p.Cartesian2(g,d)}},t.prototype._createGroundTexture=function(t){if(t.urlGround&&!this._groundTexture){var e=this,i=e._viewer.scene.frameState.context,r=p.buildModuleUrl(t.urlGround);p.Resource.fetchImage(r).then(function(t){e._groundTexture=new p.Texture({context:i,source:t,sampler:new p.Sampler({wrapS:p.TextureWrap.REPEAT,wrapT:p.TextureWrap.REPEAT,minificationFilter:p.TextureMinificationFilter.NEAREST,magnificationFilter:p.TextureMagnificationFilter.NEAREST})},function(t){})})}},t.prototype.destroy=function(){this._fireEffect&&(this._fireEffect.destroy(),this._fireEffect=null),this._postProcess&&(this._postProcess.enabled=!1,this._viewer.scene.postProcessStages.remove(this._postProcess),this._postProcess=null),this._viewMatrix=null;for(var t=0;t<this._assigned.length;t++)this._assigned[t].destroy(),this._assigned[t]=null;this._assigned=null,this._framebuffer&&(this._framebuffer.destroy(),this._framebuffer=null),this._depthAttachment&&(this._depthAttachment.destroy(),this._depthAttachment=null),this._clearCommand=null,this._groundTexture=null,this._xPlane=null,this._yPlane=null,this._zPlane=null,this._xyRange=null,this._viewer=null}}(window.Cesium),function(o){var t=o.GeoScanCircleEffect=function(t){this._viewer=t.viewer,this._radius=t.radius;var e=t.center;this._center=o.Cartesian3.fromRadians(e.longitude,e.latitude,e.height),this._color=t.color.clone(),this._lineWidth=t.lineWidth?t.lineWidth:1,this._speed=t.speed?t.speed:1,this._repeat=!t.repeat||t.repeat,this._scanCirclePostProcess=null,this._scanAperturePostProcess=null,this._lastTime=0;var i=o.Cartesian3.normalize(this._center,new o.Cartesian3);this._normal=function(){return i};var r=this._radius/this._speed;this._life=function(){return r},this._setLife=function(t){r=t};var n=0;this._time=function(){return n},this._setTime=function(t){n=t},this._enabled=!0,this._deathEvent=new o.Event,this._invViewMatrix=null};o.defineProperties(t.prototype,{normal:{get:function(){return this._normal()}},life:{get:function(){return this._life()}},time:{get:function(){return this._time()},set:function(t){this._setTime(t)}},speed:{get:function(){return this._speed},set:function(t){this._speed!=t&&(this._speed=t,this._setLife(this._radius/this._speed))}},lineWidth:{get:function(){return this._lineWidth},set:function(t){this._lineWidth=t}},color:{get:function(){return this._color},set:function(t){this._color=t.clone()}},repeat:{get:function(){return this._repeat},set:function(t){this._repeat=t}},deathEvent:{get:function(){return this._deathEvent}},enabled:{get:function(){return this._enabled},set:function(t){this._enabled=t}},center:{get:function(){return this._center}},invViewMatrix:{get:function(){return this._invViewMatrix}}}),t.prototype.update=function(t){this._enabled?(this._updateTime(),this._enabled&&this._updatePostProcesses(t)):this._scanCirclePostProcess&&(this._scanCirclePostProcess.enabled=!1)},t.prototype.destroy=function(){this._scanCirclePostProcess&&(this._scanCirclePostProcess.enabled=!1,this._viewer.scene.postProcessStages.remove(this._scanCirclePostProcess),this._scanCirclePostProcess=null)},t.prototype._updateTime=function(){var t=o.getTimestamp()/1e3;if(0==this._lastTime)this._lastTime=t,this.time=0;else{var e=t-this._lastTime,i=this.life;i<e&&(e=i),this.time+=e,this.time>i&&(this._repeat||this._death(),this.time=0),this._lastTime=t}},t.prototype._death=function(){this._enabled=!1,this._deathEvent.raiseEvent()},t.prototype._updatePostProcesses=function(t){var e=t.camera;this._invViewMatrix=e.inverseViewMatrix.clone(this._invViewMatrix),this._updateScanCirclePostProcess(t)},t.prototype._updateScanCirclePostProcess=function(t){var e=this;if(e._scanCirclePostProcess)this._scanCirclePostProcess.enabled=!0;else{var i=new o.Cartesian4;e._scanCirclePostProcess=new o.PostProcessStage({fragmentShader:"uniform sampler2D colorTexture;\nuniform sampler2D depthTexture;\nuniform mat4 u_invViewMatrix;\nuniform vec3 u_center;\nuniform vec3 u_normal;\nuniform vec4 u_color;\nuniform vec4 u_param0;\nvarying vec2 v_textureCoordinates;\nvec4 getPosition(vec4 vd, vec2 uv){\n   float zd = czm_unpackDepth(vd);\n   zd = czm_reverseLogDepth(zd);\n   float d = (2.0 * zd - czm_depthRange.near - czm_depthRange.far) / (czm_depthRange.far - czm_depthRange.near);\n   vec2 xy = vec2((uv.x * 2.0 - 1.0), (uv.y * 2.0 - 1.0));\n   vec4 position = czm_inverseProjection * vec4(xy, d, 1.0);\n   position = u_invViewMatrix * position;\n   position /= position.w;\n   return position;\n}\nfloat distance0(vec3 c, vec3 n, vec3 p){\n   vec3 b = normalize(p - c);\n   n = normalize(n);\n   if (all(equal(n, b))){\n       return 0.0;\n   }\n   vec3 nc = cross(b, n);\n   b = cross(n, nc);\n   b = normalize(b);\n   return dot(b, p) - dot(b, c);\n}\nvoid main(){\n   vec4 color = texture2D(colorTexture, v_textureCoordinates);\n   vec4 currD = texture2D(depthTexture, v_textureCoordinates);\n   if(currD.r>=1.0){\n       gl_FragColor = color;\n       return;\n   }\n   vec4 position = getPosition(currD, v_textureCoordinates);\n   float z = distance0(u_center, u_normal, position.xyz);\n   float d = u_param0.z * u_param0.y;\n   float hw = u_param0.w / 2.0;\n   float hd = dot(u_normal, position.xyz) - dot(u_normal, u_center);\n   if (z < (d + hw) && z > (d - hw) && hd > -10000.0){\n       z = abs(z - d) / hw;\n       color.rgb = mix(color.rgb, u_color.rgb, u_color.a * (exp(-(pow(z, 5.0)))));\n   }\n   gl_FragColor = color;\n}",uniforms:{u_invViewMatrix:function(){return e.invViewMatrix},u_center:function(){return e.center},u_normal:function(){return e.normal},u_color:function(){return e.color},u_param0:function(){return i.x=e.life,i.y=e.time,i.z=e.speed,i.w=e.lineWidth,i}}}),e._scanCirclePostProcess.enabled=!1,e._viewer.scene.postProcessStages.add(e._scanCirclePostProcess)}}}(window.Cesium),function(s){var t=s.GeoWind=function(t,e){return this.viewer=t.viewer,this.data=t.data,this.level=t.level,this.rectangle=t.rectangle,this.options=t.options,this.options.velocityScale=s.defaultValue(this.options.velocityScale,.11),this.options.particleMultiplier=s.defaultValue(this.options.particleMultiplier,.002),this.options.maxWindIntensity=s.defaultValue(this.options.maxWindIntensity,30),this.options.lineWidth=s.defaultValue(this.options.lineWidth,2),this.options.opacity=s.defaultValue(this.options.opacity,.6),this.options.colors=s.defaultValue(this.options.colors,["#00ffff","#64f0ff","#87e1ff","#a0d0ff","#b5c0ff","#c6adff","#d49bff","#e185ff","#ec6dff","#ff1edb"]),this.canvas=document.createElement("canvas"),this.canvasContext=this.canvas.getContext("2d"),this._initWindy(),this.setData(this.data),this};t.prototype._initWindy=function(){var w=this;this.Windy=function(){function n(t,e,i,r,n,o){var a=1-t,s=1-e,l=a*s,h=t*s,c=a*e,g=t*e,u=i[0]*l+r[0]*h+n[0]*c+o[0]*g,d=i[1]*l+r[1]*h+n[1]*c+o[1]*g;return[u,d,Math.sqrt(u*u+d*d)]}function c(t){var e=null,i=null;return t.forEach(function(t){switch(t.header.parameterCategory+","+t.header.parameterNumber){case"2,2":e=t;break;case"2,3":i=t;break;default:t}}),function(t,e){var i=t.data,r=e.data;return{header:t.header,data:function(t){return[i[t],r[t]]},interpolate:n}}(e,i)}function l(t){return t/180*Math.PI}function D(t){return t/(Math.PI/180)}function h(t){return Math.log(Math.tan(t/2+Math.PI/4))}function o(b,E,i){var T={},S=t,M=[],r=b.x;function n(t){for(var e,i,r,n,o,a,s,l,h,c,g,u,d,p,C,m,f,v,A,I=[],_=b.y;_<=b.yMax;_+=2){var y=(u=t,d=_,void 0,C=(p=E).east-p.west,m=p.width/D(C)*360/(2*Math.PI),f=m/2*Math.log((1+Math.sin(p.south))/(1-Math.sin(p.south))),v=(p.height+f-d)/m,A=180/Math.PI*(2*Math.atan(Math.exp(v))-Math.PI/2),[D(p.west)+u/p.width*D(C),A]),w=y[0],P=y[1];if(isFinite(w)){var x=L(w,P);x&&(e=T,i=w,r=P,n=t,o=_,a=S,l=E,void 0,h=(s=x)[0]*a,c=s[1]*a,g=R(e,i,r,n,o,l),s[0]=g[0]*h+g[2]*c,s[1]=g[1]*h+g[3]*c,x=s,I[_+1]=I[_]=x)}}M[t+1]=M[t]=I}!function t(){for(var e=Date.now();r<b.width;)if(n(r),r+=2,1e3<Date.now()-e)return void setTimeout(t,25);!function(r,n,t){function o(t,e){var i=r[Math.round(t)];return i&&i[Math.round(e)]||s}o.release=function(){r=[]},o.randomize=function(t){for(var e,i,r=0;null===o(e=Math.round(Math.floor(Math.random()*n.width)+n.x),i=Math.round(Math.floor(Math.random()*n.height)+n.y))[2]&&r++<30;);return t.x=e,t.y=i,t},t(n,o)}(M,b,i)}()}function a(e,s){function i(t){return"#"==t.charAt(0)?t.substring(1,7):t}var r,n,l=(r=g,n=[],C.forEach(function(t){n.push("rgba("+function(t){return parseInt(i(t).substring(0,2),16)}(t)+", "+function(t){return parseInt(i(t).substring(2,4),16)}(t)+", "+function(t){return parseInt(i(t).substring(4,6),16)}(t)+", "+p+")")}),n.indexFor=function(t){return Math.floor(Math.min(t,r)/r*(n.length-1))},n),h=l.map(function(){return[]}),t=Math.round(e.width*e.height*d);/android|blackberry|iemobile|ipad|iphone|ipod|opera mini|webos/i.test(navigator.userAgent)&&(t*=.075);for(var o=[],a=0;a<t;a++)o.push(s.randomize({age:Math.floor(100*Math.random())+0}));var c=w.canvasContext;c.lineWidth=u,c.fillStyle="rgba(0, 0, 0, 0.97)",function t(){try{y.timer=setTimeout(function(){requestAnimationFrame(t),h.forEach(function(t){t.length=0}),o.forEach(function(t){100<t.age&&(s.randomize(t).age=0);var e=t.x,i=t.y,r=s(e,i),n=r[2];if(null===n)t.age=100;else{var o=e+r[0],a=i+r[1];null!==s(o,a)[2]?(t.xt=o,t.yt=a,h[l.indexFor(n)].push(t)):(t.x=o,t.y=a)}t.age+=1}),function(){var t=c.globalCompositeOperation;c.globalCompositeOperation="destination-in",c.fillRect(e.x,e.y,e.width,e.height),c.globalCompositeOperation=t,h.forEach(function(t,e){0<t.length&&(c.beginPath(),c.strokeStyle=l[e],t.forEach(function(t){c.moveTo(t.x,t.y),c.lineTo(t.xt,t.yt),t.x=t.xt,t.y=t.yt}),c.stroke())})}()},50)}catch(t){console.error(t)}}()}var t=w.options.velocityScale,g=w.options.maxWindIntensity,u=w.options.lineWidth,d=w.options.particleMultiplier,p=w.options.opacity,C=w.options.colors,s=[NaN,NaN,null],m=2*Math.PI,f=Math.pow(10,-5.2),A=function(t){return null!=t},I=function(t,e){return t-e*Math.floor(t/e)},R=function(t,e,i,r,n,o){var a=e<0?f:-f,s=i<0?f:-f,l=v(i,e+a,o),h=v(i+s,e,o),c=Math.cos(i/360*m);return[(l[0]-r)/a/c,(l[1]-n)/a/c,(h[0]-r)/s,(h[1]-n)/s]},v=function(t,e,i){var r=h(i.south),n=h(i.north),o=i.width/(i.east-i.west),a=i.height/(n-r),s=h(l(t));return[(l(e)-i.west)*o,s=(n-s)*a]},_=function(){y.field&&y.field.release(),y.timer&&clearTimeout(y.timer)},L=function(t){var d=c(t),e=d.header,p=e.lo1,C=e.la1,m=e.dx,f=e.dy,i=e.nx,r=e.ny,n=new Date(e.refTime);n.setHours(n.getHours()+e.forecastTime);for(var v=[],o=0,a=360<=Math.floor(i*m),s=0;s<r;s++){for(var l=[],h=0;h<i;h++,o++)l[h]=d.data(o);a&&l.push(l[0]),v[s]=l}return function(t,e){var i,r=I(t-p,360)/m,n=(C-e)/f,o=Math.floor(r),a=o+1,s=Math.floor(n),l=s+1;if(i=v[s]){var h=i[o],c=i[a];if(A(h)&&A(c)&&(i=v[l])){var g=i[o],u=i[a];if(A(g)&&A(u))return d.interpolate(r-o,n-s,h,c,g,u)}}return null}}(w.data),y={start:function(t,e,i,r){var n={south:l(r[0][1]),north:l(r[1][1]),east:l(r[1][0]),west:l(r[0][0]),width:e,height:i};_(),o(function(t,e,i){var r=t[0],n=t[1],o=Math.round(r[0]),a=Math.max(Math.floor(r[1],0),0);Math.min(Math.ceil(n[0],e),e-1);return{x:o,y:a,xMax:e,yMax:Math.min(Math.ceil(n[1],i),i-1),width:e,height:i}}(t,e,i),n,function(t,e){y.field=e,a(t,e)})},stop:_};return y}},t.prototype._calculateBounds=function(){var t=this.rectangle[0][0],e=this.rectangle[1][1],i=this.rectangle[1][0],r=this.rectangle[0][1],n=this.level,o=this._locationCoordinate(t,r,n),a=this._locationCoordinate(i,e,n);this._size=[512*Math.abs(o[0]-a[0]),512*Math.abs(o[1]-a[1])],this._bounds=[[t,r],[i,e]],this._rectangle=s.Rectangle.fromDegrees(t,r,i,e)},t.prototype._locationCoordinate=function(t,e,i){return[(180+t)*Math.pow(2,i)/360,(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))*Math.pow(2,i)/360]},t.prototype._getCenterPoint=function(){var t=this.viewer.canvas,e=new s.Cartesian2(t.clientWidth/2,t.clientHeight/2),i=this.viewer.camera.getPickRay(e);return this.viewer.scene.globe.pick(i,this.viewer.scene)||this.viewer.camera.pickEllipsoid(e)},t.prototype._getLevel=function(){var t=s.Ellipsoid.WGS84,e=this._getCenterPoint();if(!e){var i=this.viewer.scene.globe,r=this.viewer.camera.positionCartographic.clone(),n=i.getHeight(r);r.height=n||0,e=t.cartographicToCartesian(r)}var o=s.Cartesian3.distance(e,this.viewer.camera.position)/1405.5;return Math.log2(78271.51696402031/o)-1.2},t.prototype.show=function(t){this._layer&&(this._layer.show=t)},t.prototype.remove=function(){this._layer&&this.viewer.entities.remove(this._layer)},t.prototype.updateLayer=function(){var t=this;this._calculateBounds(),this.canvas.width=Math.round(this._size[0]),this.canvas.height=Math.round(this._size[1]),setTimeout(function(){t.windy.start([[0,0],t._size],t._size[0],t._size[1],t._bounds)},1),this._layer&&this.viewer.entities.remove(this._layer);var e=new s.ImageMaterialProperty({image:new s.CallbackProperty(function(){return t.canvas.toDataURL()},!1)});"1.21"<=s.VERSION?e.transparent=!0:"1.16"<=s.VERSION&&(e.alpha=.99),this._layer=this.viewer.entities.add({rectangle:{coordinates:this._rectangle,material:e}})},t.prototype.setData=function(t){this.data=t,this.windy=new this.Windy,this.updateLayer()}}(window.Cesium),function(C){var m="GEO_OVERVIEW_ICO_SOURCE",f="GEO_OVERVIEW_ICO_LAYER",a="GEO_OVERVIWE_ICO_ID";function v(t,e){t=C.defaultValue(t,C.defaultValue.EMPTY_OBJECT);this.viewer=t.viewer,this.map2D=null,this.map2DOptions=C.defaultValue(t.map2DOptions,{mapCRS:{topTileExtent:[-180,-270,180,90],coordtransform:"none"},style:{version:8,sources:{tdt_source_overview:{type:"raster",tiles:["http://t3.tianditu.com/vec_c/wmts?SERVICE=WMTS&REQUEST=GetTile&LAYER=vec&TILEMATRIXSET=c&FORMAT=tiles&VERSION=1.0.0&STYLE=default&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&tk=e90d56e5a09d1767899ad45846b0cefd"],tileSize:256}},layers:[{id:"tdt_layer_overview",type:"raster",source:"tdt_source_overview",layout:{visibility:"visible"}}]},zoom:4,center:[112.939,31.377],renderWorldCopies:!1,isIntScrollZoom:!0,isAttributionControl:!1}),this.width=t.width,this.height=t.height,this.layout=C.defaultValue(t.layout,"BR"),this.movingTargetIco=t.movingTargetIco,this.movingTargetIcoSize=C.defaultValue(t.movingTargetIcoSize,1),this.movingTargetZoomLevel=C.defaultValue(t.movingTargetZoomLevel,14),this.callback="function"==typeof e?e:function(){},this.scalable=!1,this._isReady=!1,this._latelyUpdateStamp=0,this._modelType=v.modelType.ROAM,this._initOverview(),this._bindEvent()}v.prototype._initOverview=function(){var t=this.viewer.cesiumWidget.container.parentElement,e=document.createElement("div");e.className="geo-cesium-viewer-overview",e.style.display="block",e.style.position="absolute",e.style.width=this.width+"px",e.style.height=this.height+"px",this.layout.toLocaleUpperCase().startsWith("B")?e.style.bottom="5px":this.layout.toLocaleUpperCase().startsWith("T")&&(e.style.top="5px"),this.layout.toLocaleUpperCase().endsWith("R")?e.style.right="5px":this.layout.toLocaleUpperCase().endsWith("L")&&(e.style.left="5px"),t.appendChild(e);var i=document.createElement("div");i.style.position="absolute",i.style.width=i.style.height="100%",e.appendChild(i),this.map2DOptions.container||(this.map2DOptions.container=i),this.map2D=new GeoGlobe.Map(this.map2DOptions)},v.prototype._bindEvent=function(){var o=this;this.map2D.on("load",function(){var n=o.map2D;n.loadImage(o.movingTargetIco,function(t,e){var i=o.movingTargetIcoSize,r=n.getCenter().toArray();n.addImage(a,e),n.addSource(m,{type:"geojson",data:{type:"Point",coordinates:r}}),n.addLayer({id:f,source:m,type:"symbol",layout:{"icon-image":a,"icon-size":i,"icon-rotate":0}}),o._isReady=!0,o.callback&&o.callback(o)})}),this.viewer.scene.preRender.addEventListener(function(){o.updateAimingRect()})},v.prototype._unbindEvent=function(){for(var t=this.viewer.scene.preRender._listeners,e=0;e<t.length;e++)"GEOOVERVIEW_3D_RENDER_EVENT"===t[e].name&&t.splice(e,1)},v.prototype.getMap2D=function(){return this.map2D},v.prototype.getMap2DLayer=function(t){return this.map2D?this.map2D.getLayer(t):null},v.prototype.addMap2DLayer=function(t,e){return this.map2D?this.map2D.addLayer(t,e):null},v.prototype.removeMap2DLayer=function(t){return this.map2D?this.map2D.removeLayer(t):null},v.prototype.getMap2DSource=function(t){return this.map2D?this.map2D.getSource(t):null},v.prototype.addMap2DSource=function(t,e){return this.map2D?this.map2D.addSource(t,e):null},v.prototype.removeMap2DSource=function(t){return this.map2D?this.map2D.removeSource(t):null},v.prototype.updateAimingRect=function(){var t=(new Date).getTime();if(!(t-this._latelyUpdateStamp<600)&&(this._latelyUpdateStamp=t,this.viewer&&this._isReady)){this.viewer,this.viewer.scene;var e,i,r=this.viewer.canvas,n=this.viewer.camera,o=this.viewer.scene.globe,a=this.map2D;if(this._modelType===v.modelType.ROAM){var s=C.Ellipsoid.WGS84,l=null,h=new C.Cartesian2(r.clientWidth/2,r.clientHeight/2),c=this.viewer.camera.getPickRay(h);if(!(l=(l=this.viewer.scene.globe.pick(c,this.viewer.scene))||n.pickEllipsoid(h))){var g=n.positionCartographic.clone(),u=o.getHeight(g);g.height=u||0,l=s.cartographicToCartesian(g)}var d=C.Cartesian3.distance(l,n.position)/1405.5;e=Math.log2(78271.51696402031/d)-5.2;var p=s.cartesianToCartographic(l);i=[C.Math.toDegrees(p.longitude),C.Math.toDegrees(p.latitude)],this.scalable||a.setZoom(e),a.setCenter(i),a.getSource(m).setData({type:"Point",coordinates:i})}else if(this._modelType===v.modelType.WALK){e=this.movingTargetZoomLevel,this.scalable||a.setZoom(e);l=n.positionCartographic.clone();i=[C.Math.toDegrees(l.longitude),C.Math.toDegrees(l.latitude)],a.setCenter(i),a.getSource(m).setData({type:"Point",coordinates:i})}a.setLayoutProperty(f,"icon-rotate",C.Math.toDegrees(n.heading))}},v.prototype.setModel=function(e){0<Object.keys(C.GeoOverviewWidget.modelType).filter(function(t){return C.GeoOverviewWidget.modelType[t]===e}).length&&(this._modelType=e)},v.prototype.setScalable=function(t){this.scalable="boolean"!=typeof t||t},v.modelType={ROAM:0,WALK:1},C.GeoOverviewWidget=v}(window.Cesium),function(e){var t=e.GeoGeographicTilingScheme=function(t){t=e.defaultValue(t,{}),this._numberOfLevelZeroTilesX=e.defaultValue(t.numberOfLevelZeroTilesX,1),this._numberOfLevelZeroTilesY=e.defaultValue(t.numberOfLevelZeroTilesY,.5),this._ellipsoid=e.defaultValue(t.ellipsoid,e.Ellipsoid.WGS84),this._rectangle=e.defaultValue(t.rectangle,e.Rectangle.MAX_VALUE),this._projection=new e.GeographicProjection(this._ellipsoid)};t.prototype=new e.GeographicTilingScheme,delete t.prototype._numberOfLevelZeroTilesX,delete t.prototype._numberOfLevelZeroTilesY,delete t.prototype._ellipsoid,delete t.prototype._rectangle,delete t.prototype._projection,t.prototype.getNumberOfYTilesAtLevel=function(t){return this._numberOfLevelZeroTilesY*Math.pow(2,t)}}(window.Cesium),function(m){var p=m.GeoTerrainProvider=function(t){if(t=m.defaultValue(t,m.defaultValue.EMPTY_OBJECT),!m.defined(t.urls))throw new m.DeveloperError("options.urls is required.");this._dataType=m.defaultValue(t.dataType,m.GeoTerrainProvider.INT),this._tileType=m.defaultValue(t.tileType,p.HEIGHTMAP),this._urls=t.urls,this._urls_length=this._urls.length,this._url_i=0,this._url_step=0,this._maxTerrainLevel=m.defaultValue(t.dataType,m.GeoTerrainProvider.INT),this._errorEvent=new m.Event,this._ready=!1,this._readyPromise=m.when.defer(),this._proxy=t.proxy,this._terrainDataStructure={heightScale:.001,heightOffset:-1e3,elementsPerHeight:3,stride:4,elementMultiplier:256,isBigEndian:!0};var e=t.credit;"string"==typeof e&&(e=new m.Credit(e)),this._credit=e,this._tilingScheme=void 0,this._rectangles=[];var i=m.defaultValue(t.ellipsoid,m.Ellipsoid.WGS84);this._tilingScheme=new m.GeographicTilingScheme({ellipsoid:i}),this._heightmapWidth=64,this._heightmapHeight=64,this._levelZeroMaximumGeometricError=m.TerrainProvider.getEstimatedLevelZeroGeometricErrorForAHeightmap(i,Math.min(this._heightmapWidth,this._heightmapHeight),this._tilingScheme.getNumberOfXTilesAtLevel(0)),this._ready=!0,this._readyPromise.resolve(!0),this._name=t.name,this._opacity=t.opacity,this._maxExtent=t.maxExtent,this._topLevel=m.defaultValue(t.topLevel,5),this._bottomLevel=m.defaultValue(t.bottomLevel,25)};function C(e,t){return(t=m.defined(t)?t:new m.Request).url=e,t.requestFunction=function(){var t=new XMLHttpRequest;return t.open("GET",e,!0),t.responseType="arraybuffer",t.async=!1,t.send(null),function(n){var o=m.when.defer();return n.onreadystatechange=function(){if(4===n.readyState&&200===n.status&&m.defined(n.response)){for(var t=new DataView(n.response),e=new Uint8Array(t.byteLength),i=0;i<t.byteLength;)e[i]=t.getUint8(i,!0),i++;var r=function(t){if(t.length<1e3)return;var e=new Zlib.Inflate(t);return m.defined(e)?e.decompress():void 0}(e);m.defined(r)?o.resolve(r):o.reject(void 0)}},o.promise}(t)},m.RequestScheduler.request(t)}m.defineProperties(p.prototype,{errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){return this._credit}},tilingScheme:{get:function(){if(!this.ready)throw new m.DeveloperError("requestTileGeometry must not be called before ready returns true.");return this._tilingScheme}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},hasWaterMask:{get:function(){return!1}},hasVertexNormals:{get:function(){return!1}}}),p.prototype.requestTileGeometry=function(r,n,o,t){if(!this.ready)throw new m.DeveloperError("requestTileGeometry must not be called before ready returns true.");1<this._urls_length&&(this._url_step<8?this._url_step++:(this._url_step=0,this._url_i++,this._url_i>=this._urls_length&&(this._url_i=0)));var e=this._urls[this._url_i];this._tilingScheme.getNumberOfYTilesAtLevel(o);if(o<this._bottomLevel&&o>=this._topLevel){var i,a=-1===e.indexOf("?")?"?":"&",s=e+a+"x="+r+"&y="+n+"&l="+(o+1),l=this._proxy;if(m.defined(l)&&(s=l.getURL(s)),t=m.defaultValue(t,!0)){if(i=C(s,t),!m.defined(i))return}else i=C(s);if(this._tileType==p.QUANTIZED_MESH)return i.then(function(t){return function(t,e,i,r,n,o,a){var s=a.littleEndianExtensionSize,l=0,h=3*Float64Array.BYTES_PER_ELEMENT,c=4*Float64Array.BYTES_PER_ELEMENT,g=3*Uint16Array.BYTES_PER_ELEMENT,u=Uint16Array.BYTES_PER_ELEMENT,d=3*u,p=new DataView(e),C=new Cartesian3(p.getFloat64(l,!0),p.getFloat64(l+8,!0),p.getFloat64(l+16,!0));l+=h;var m=p.getFloat32(l,!0);l+=Float32Array.BYTES_PER_ELEMENT;var f=p.getFloat32(l,!0);l+=Float32Array.BYTES_PER_ELEMENT;var v=new BoundingSphere(new Cartesian3(p.getFloat64(l,!0),p.getFloat64(l+8,!0),p.getFloat64(l+16,!0)),p.getFloat64(l+h,!0));l+=c;var A=new Cartesian3(p.getFloat64(l,!0),p.getFloat64(l+8,!0),p.getFloat64(l+16,!0));l+=h;var I=p.getUint32(l,!0);l+=Uint32Array.BYTES_PER_ELEMENT;var _=new Uint16Array(e,l,3*I);l+=I*g,65536<I&&(u=Uint32Array.BYTES_PER_ELEMENT,d=3*u);var y=_.subarray(0,I),w=_.subarray(I,2*I),P=_.subarray(2*I,3*I);AttributeCompression.zigZagDeltaDecode(y,w,P),l%u!=0&&(l+=u-l%u);var x=p.getUint32(l,!0);l+=Uint32Array.BYTES_PER_ELEMENT;var b=IndexDatatype.createTypedArrayFromArrayBuffer(I,e,l,3*x);l+=x*d;for(var E=0,T=b.length,S=0;S<T;++S){var M=b[S];b[S]=E-M,0===M&&++E}var D=p.getUint32(l,!0);l+=Uint32Array.BYTES_PER_ELEMENT;var R=IndexDatatype.createTypedArrayFromArrayBuffer(I,e,l,D);l+=D*u;var L=p.getUint32(l,!0);l+=Uint32Array.BYTES_PER_ELEMENT;var F=IndexDatatype.createTypedArrayFromArrayBuffer(I,e,l,L);l+=L*u;var O=p.getUint32(l,!0);l+=Uint32Array.BYTES_PER_ELEMENT;var k=IndexDatatype.createTypedArrayFromArrayBuffer(I,e,l,O);l+=O*u;var B=p.getUint32(l,!0);l+=Uint32Array.BYTES_PER_ELEMENT;var N,V,z=IndexDatatype.createTypedArrayFromArrayBuffer(I,e,l,B);l+=B*u;for(;l<p.byteLength;){var G=p.getUint8(l,!0);l+=Uint8Array.BYTES_PER_ELEMENT;var U=p.getUint32(l,s);if(l+=Uint32Array.BYTES_PER_ELEMENT,G===QuantizedMeshExtensionIds.OCT_VERTEX_NORMALS&&t._requestVertexNormals)N=new Uint8Array(e,l,2*I);else if(G===QuantizedMeshExtensionIds.WATER_MASK&&t._requestWaterMask)V=new Uint8Array(e,l,U);else if(G===QuantizedMeshExtensionIds.METADATA&&t._requestMetadata){var H=p.getUint32(l,!0);if(0<H){var W=getStringFromTypedArray(new Uint8Array(e),l+Uint32Array.BYTES_PER_ELEMENT,H),j=JSON.parse(W).available;if(defined(j))for(var Y=0;Y<j.length;++Y)for(var q=i+Y+1,Z=j[Y],X=t._tilingScheme.getNumberOfYTilesAtLevel(q),K=0;K<Z.length;++K){var Q=Z[K],J=X-Q.endY-1,$=X-Q.startY-1;t.availability.addAvailableTileRange(q,Q.startX,J,Q.endX,$),a.availability.addAvailableTileRange(q,Q.startX,J,Q.endX,$)}}a.availabilityTilesLoaded.addAvailableTileRange(i,r,n,r,n)}l+=U}var tt,et=5*t.getLevelMaximumGeometricError(i),it=t._tilingScheme.tileXYToRectangle(r,n,i);it.width<CesiumMath.PI_OVER_TWO+CesiumMath.EPSILON5&&(tt=OrientedBoundingBox.fromRectangle(it,m,f,t._tilingScheme.ellipsoid));return new QuantizedMeshTerrainData({center:C,minimumHeight:m,maximumHeight:f,boundingSphere:v,orientedBoundingBox:tt,horizonOcclusionPoint:A,quantizedVertices:_,encodedNormals:N,indices:b,westIndices:R,southIndices:F,eastIndices:k,northIndices:z,westSkirtHeight:et,southSkirtHeight:et,eastSkirtHeight:et,northSkirtHeight:et,childTileMask:t.availability.computeChildMaskForTile(i,r,n),waterMask:V,credits:t._tileCredits})}(provider,t,o,r,n)});var h=this;return m.when(i,function(t){var e=h.transformBuffer(t);if(m.defined(e)){var i=new m.HeightmapTerrainData({buffer:e,width:h._heightmapWidth,height:h._heightmapHeight,childTileMask:f(h,r,n,o),structure:h._terrainDataStructure});return i._skirtHeight=6e3,i}})}if(o<this._topLevel){var c=this._heightmapWidth,g=this._heightmapHeight,u=f(this,r,n,o),d=this._terrainDataStructure;return new m.HeightmapTerrainData({buffer:this.getvHeightBuffer(),width:c,height:g,childTileMask:u,structure:d})}},p.prototype.getLevelMaximumGeometricError=function(t){if(!this.ready)throw new m.DeveloperError("requestTileGeometry must not be called before ready returns true.");return this._levelZeroMaximumGeometricError/(1<<t)},p.prototype.getTileDataAvailable=function(t,e,i){if(i<25)return!0},p.prototype.getvHeightBuffer=function(){var t=this._vHeightBuffer;if(!m.defined(t)){t=new Uint8ClampedArray(this._heightmapWidth*this._heightmapHeight*4);for(var e=0;e<this._heightmapWidth*this._heightmapHeight*4;)t[e++]=15,t[e++]=66,t[e++]=64,t[e++]=255;this._vHeightBuffer=t}return t},p.prototype.transformBuffer=function(t){var e=2;this._dataType===m.GeoTerrainProvider.INT?e=2:this._dataType===m.GeoTerrainProvider.FLOAT&&(e=4);var i=t;if(i.length!==22500*e)return null;for(var r,n,o,a,s,l=new ArrayBuffer(e),h=new DataView(l),c=this._heightmapWidth,g=this._heightmapHeight,u=new Uint8Array(c*g*4),d=0;d<g;d++)for(var p=0;p<c;p++){a=parseInt(149*d/(g-1)),s=parseInt(149*p/(c-1)),149*d/(g-1),149*p/(c-1),(1e4<(r=4===e?(n=e*(150*a+s),h.setInt8(0,i[n]),h.setInt8(1,i[n+1]),h.setInt8(2,i[n+2]),h.setInt8(3,i[n+3]),h.getFloat32(0,!0)):i[n=e*(150*a+s)]+256*i[n+1])||r<-2e3)&&(r=0);var C=(r+1e3)/.001;u[o=4*(d*c+p)]=C/65536,u[1+o]=(C-256*u[o]*256)/256,u[2+o]=C-256*u[o]*256-256*u[1+o],u[3+o]=255}return u};var u=new m.Rectangle;function f(t,e,i,r){for(var n=t._tilingScheme,o=t._rectangles,a=n.tileXYToRectangle(e,i,r),s=0,l=0;l<o.length&&15!==s;++l){var h=o[l];if(!(h.maxLevel<=r)){var c=h.rectangle,g=m.Rectangle.intersection(c,a,u);m.defined(g)&&(d(n,c,2*e,2*i,r+1)&&(s|=4),d(n,c,2*e+1,2*i,r+1)&&(s|=8),d(n,c,2*e,2*i+1,r+1)&&(s|=1),d(n,c,2*e+1,2*i+1,r+1)&&(s|=2))}}return s}function d(t,e,i,r,n){var o=t.tileXYToRectangle(i,r,n);return m.defined(m.Rectangle.intersection(o,e,u))}p.INT="int",p.FLOAT="float",p.QUANTIZED_MESH="quantized-mesh",p.HEIGHTMAP="heightmap"}(window.Cesium),1.5<=Cesium.VERSION||1.5<=Cesium.VERSION.substring(0,4)){var fixGltf=function(a){if(a.extensionsUsed&&(!a.extensionsUsed||-1!=a.extensionsUsed.indexOf("KHR_technique_webgl"))){var t=a.extensionsUsed.indexOf("KHR_technique_webgl"),e=a.extensionsRequired.indexOf("KHR_technique_webgl");if(-1!==t){a.extensionsRequired.splice(e,1,"KHR_techniques_webgl"),a.extensionsUsed.splice(t,1,"KHR_techniques_webgl"),a.extensions=a.extensions||{},a.extensions.KHR_techniques_webgl={},a.extensions.KHR_techniques_webgl.programs=a.programs,a.extensions.KHR_techniques_webgl.shaders=a.shaders,a.extensions.KHR_techniques_webgl.techniques=a.techniques;var s=a.extensions.KHR_techniques_webgl.techniques;a.materials.forEach(function(t,e){a.materials[e]&&a.materials[e].name&&(a.materials[e].extensions={KHR_technique_webgl:{technique:a.materials[e].technique,values:{diffuse:0}}}),void 0===a.materials[e].extensions&&(a.materials[e].extensions={},a.materials[e].extensions.KHR_technique_webgl={}),a.materials[e].extensions.KHR_technique_webgl.values=a.materials[e].values,a.materials[e].extensions.KHR_techniques_webgl=a.materials[e].extensions.KHR_technique_webgl;var i=a.materials[e].extensions.KHR_techniques_webgl;for(var r in i.values){void 0===i.technique&&(i.technique=a.materials[e].technique);var n=s[i.technique].uniforms;for(var o in n)if(n[o]===r){i.values[o]=i.values[r],delete i.values[r];break}}}),s.forEach(function(t){for(var e in t.attributes){var i=t.attributes[e];t.attributes[e]=t.parameters[i]}for(var r in t.uniforms){i=t.uniforms[r];t.uniforms[r]=t.parameters[i]}})}}};Object.defineProperties(Cesium.Model.prototype,{_cachedGltf:{set:function(t){this._vtxf_cachedGltf=t,this._vtxf_cachedGltf&&this._vtxf_cachedGltf._gltf&&fixGltf(this._vtxf_cachedGltf._gltf)},get:function(){return this._vtxf_cachedGltf}}})}_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(s){var e=s.defaultValue;s.defined;function t(t){t=e(t,e.EMPTY_OBJECT),this.viewer=t.viewer,this.tileset=t.tileset,this.source=t.source,this.autoActivate=e(t.autoActivate,!0),this.active=e(t.active,null),this.originalColor=e(t.originalColor,s.Color.fromBytes(255,50,50,1)),this.moveColor=e(t.moveColor,s.Color.fromBytes(255,50,50,122)),this.selectedColor=e(t.selectedColor,s.Color.fromBytes(50,255,50,122)),this.selectedFeature=void 0,this.groundPrimitiveCollection=new s.PrimitiveCollection,this.source&&"geojson"===this.source.type&&this._loadGeoJSON(this.source.data),this.handler=new s.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.autoActivate&&this.activateAction(),this._seletedEvent=new s.Event}s.defineProperties(t.prototype,{seletedEvent:{get:function(){return this._seletedEvent}}}),t.prototype._loadGeoJSON=function(t){var e=this;if("object"===(void 0===t?"undefined":_typeof(t)))this._loadGroundPrimitives(t);else if("string"==typeof t){var i=new window.XMLHttpRequest;i.open("GET",t,!0),i.withCredentials=!1,i.setRequestHeader("Accept","application/json"),i.onerror=function(){console.error(i.statusText)},i.onload=function(){if(200<=i.status&&i.status<300&&i.response){var t=JSON.parse(i.response);e._loadGroundPrimitives(t)}},i.send()}else console.warn("data的类型不被支持!")},t.prototype._loadGroundPrimitives=function(t){this.groundPrimitiveCollection.isDestroyed()&&(this.groundPrimitiveCollection=new s.PrimitiveCollection);for(var e=0;e<t.features.length;e++){var i=t.features[e];if("Polygon"===i.geometry.type){for(var r=[],n=0;n<i.geometry.coordinates[0].length;n++)r.push(i.geometry.coordinates[0][n][0]),r.push(i.geometry.coordinates[0][n][1]);var o=new s.GeometryInstance({geometry:s.PolygonGeometry.fromPositions({positions:s.Cartesian3.fromDegreesArray(r),vertexFormat:s.EllipsoidSurfaceAppearance.VERTEX_FORMAT}),attributes:{color:s.ColorGeometryInstanceAttribute.fromColor(this.originalColor)},id:{tag:"GEO_MONOMER_FEATURE",description:i}}),a=new s.GroundPrimitive({geometryInstances:o,appearance:new s.PerInstanceColorAppearance,show:!0,classificationType:s.ClassificationType.BOTH});this.groundPrimitiveCollection.add(a)}else console.warn("要素类型是"+i.geometry.type+"类型，该类型不被支持！")}this.viewer.scene.primitives.add(this.groundPrimitiveCollection)},t.prototype.reloadGeoJSON=function(t){this.groundPrimitiveCollection&&this.groundPrimitiveCollection.destroy(),this._loadGeoJSON(t)},t.prototype.isContaintFeature=function(t){return this.groundPrimitiveCollection.contains(t.primitive)},t.prototype.activateAction=function(){if(!0!==this.active){this.active=!0;var n=this,o=null,a=null;n.handler.setInputAction(function(t){if(o&&o.id&&"GEO_MONOMER_FEATURE"==o.id.tag){if(a&&a.id&&o&&o.id&&o.id.description===a.id.description)return;o.primitive.getGeometryInstanceAttributes(o.id).color=s.ColorGeometryInstanceAttribute.toValue(n.originalColor),o=void 0}for(var e=void 0,i=n.viewer.scene.drillPick(t.endPosition,10),r=0;r<i.length;r++)if(i[r]&&i[r].id&&"GEO_MONOMER_FEATURE"==i[r].id.tag){e=i[r];break}if(s.defined(e)&&(!a&&e&&e.id&&"GEO_MONOMER_FEATURE"==e.id.tag||e&&e.id&&a&&a.id&&e.id.description!==a.id.description)){if(!n.isContaintFeature(e))return;(o=e).primitive.getGeometryInstanceAttributes(e.id).color=s.ColorGeometryInstanceAttribute.toValue(n.moveColor)}},s.ScreenSpaceEventType.MOUSE_MOVE),n.handler.setInputAction(function(t){a&&(a.primitive.getGeometryInstanceAttributes(a.id).color=s.ColorGeometryInstanceAttribute.toValue(n.originalColor),a=void 0);for(var e=void 0,i=n.viewer.scene.drillPick(t.position,10),r=0;r<i.length;r++)if(i[r]&&i[r].id&&"GEO_MONOMER_FEATURE"==i[r].id.tag){e=i[r];break}if(s.defined(e)&&a!==e){if(e&&e.id&&a!==e){if(!n.isContaintFeature(e))return;(a=e).primitive.getGeometryInstanceAttributes(e.id).color=s.ColorGeometryInstanceAttribute.toValue(n.selectedColor),n.selectedFeature=a}e&&a&&o&&e.id===o.id&&(o=void 0),e&&e.id&&n._seletedEvent.raiseEvent(e)}},s.ScreenSpaceEventType.LEFT_CLICK)}},t.prototype.deactivateAction=function(){if(!0===this.active){this.active=!1;if(this.selectedFeature&&this.selectedFeature.id)this.selectedFeature.primitive.getGeometryInstanceAttributes(this.selectedFeature.id).color=s.ColorGeometryInstanceAttribute.toValue(this.originalColor),this.selectedFeature=null;this.handler.removeInputAction(s.ScreenSpaceEventType.MOUSE_MOVE),this.handler.removeInputAction(s.ScreenSpaceEventType.LEFT_CLICK)}},t.prototype.destroy=function(){this.deactivateAction(),this.handler=this.handler&&this.handler.destroy(),this.groundPrimitiveCollection=this.groundPrimitiveCollection&&this.groundPrimitiveCollection.destroy(),this.viewer=void 0,this.tileset=void 0,this.source=void 0,this.originalColor=void 0,this.moveColor=void 0,this.selectedColor=void 0,this.selectedFeature=void 0},s.Cesium3DTilesetMonomer=t}(window.Cesium),function(t){var p=t.BoundingSphere,d=t.Cartesian2,N=t.Cartesian3,A=t.Cartesian4,r=t.Cartographic,C=t.defaultValue,V=t.defined,e=t.defineProperties,g=t.DeveloperError,s=t.EasingFunction,m=t.Ellipsoid,z=t.EllipsoidGeodesic,n=t.Event,l=t.HeadingPitchRange,i=t.HeadingPitchRoll,f=t.Intersect,h=t.IntersectionTests,G=t.Math,v=t.Matrix3,I=t.Matrix4,U=t.OrthographicFrustum,c=t.OrthographicOffCenterFrustum,a=t.PerspectiveFrustum,_=t.Quaternion,u=t.Ray,y=t.Rectangle,w=t.Transforms,P=t.CameraFlightPath,x=t.MapMode2D,b=t.SceneMode;function E(t){if(!V(t))throw new g("scene is required.");this._scene=t,this._transform=I.clone(I.IDENTITY),this._invTransform=I.clone(I.IDENTITY),this._actualTransform=I.clone(I.IDENTITY),this._actualInvTransform=I.clone(I.IDENTITY),this._transformChanged=!1,this.position=new N,this._position=new N,this._positionWC=new N,this._positionCartographic=new r,this.direction=new N,this._direction=new N,this._directionWC=new N,this.up=new N,this._up=new N,this._upWC=new N,this.right=new N,this._right=new N,this._rightWC=new N,this.frustum=new a,this.frustum.aspectRatio=t.drawingBufferWidth/t.drawingBufferHeight,this.frustum.fov=G.toRadians(60),this.defaultMoveAmount=1e5,this.defaultLookAmount=Math.PI/60,this.defaultRotateAmount=Math.PI/3600,this.defaultZoomAmount=1e5,this.constrainedAxis=void 0,this.maximumZoomFactor=1.5,this._moveStart=new n,this._moveEnd=new n,this._changed=new n,this._changedPosition=void 0,this._changedDirection=void 0,this._changedFrustum=void 0,this.percentageChanged=.5,this._viewMatrix=new I,this._invViewMatrix=new I,T(this),this._mode=b.SCENE3D,this._modeChanged=!0;var e=t.mapProjection;this._projection=e,this._maxCoord=e.project(new r(Math.PI,G.PI_OVER_TWO)),this._max2Dfrustum=void 0,this._suspendTerrainAdjustment=!1,Xt(this,E.DEFAULT_VIEW_RECTANGLE,this.position,!0);var i=N.magnitude(this.position);i+=i*E.DEFAULT_VIEW_FACTOR,N.normalize(this.position,this.position),N.multiplyByScalar(this.position,i,this.position)}function T(t){I.computeView(t._position,t._direction,t._up,t._right,t._viewMatrix),I.multiply(t._viewMatrix,t._actualInvTransform,t._viewMatrix),I.inverseTransformation(t._viewMatrix,t._invViewMatrix)}E.TRANSFORM_2D=new I(0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1),E.TRANSFORM_2D_INVERSE=I.inverseTransformation(E.TRANSFORM_2D,new I),E.DEFAULT_VIEW_RECTANGLE=y.fromDegrees(-95,-20,-70,90),E.DEFAULT_VIEW_FACTOR=.5,E.DEFAULT_OFFSET=new l(0,-G.PI_OVER_FOUR,0),E.prototype._updateCameraChanged=function(){var t=this;if(0!==t._changed.numberOfListeners){var e=t.percentageChanged;if(t._mode!==b.SCENE2D){if(!V(t._changedDirection))return t._changedPosition=N.clone(t.positionWC,t._changedPosition),void(t._changedDirection=N.clone(t.directionWC,t._changedDirection));var i,r=G.acosClamped(N.dot(t.directionWC,t._changedDirection));i=V(t.frustum.fovy)?r/(.5*t.frustum.fovy):r;var n=N.distance(t.positionWC,t._changedPosition)/t.positionCartographic.height;(e<i||e<n)&&(t._changed.raiseEvent(Math.max(i,n)),t._changedPosition=N.clone(t.positionWC,t._changedPosition),t._changedDirection=N.clone(t.directionWC,t._changedDirection))}else{if(!V(t._changedFrustum))return t._changedPosition=N.clone(t.position,t._changedPosition),void(t._changedFrustum=t.frustum.clone());var o,a=t.position,s=t._changedPosition,l=t.frustum,h=t._changedFrustum,c=a.x+l.left,g=a.x+l.right,u=s.x+h.left,d=s.x+h.right,p=a.y+l.bottom,C=a.y+l.top,m=s.y+h.bottom,f=s.y+h.top,v=Math.max(c,u),A=Math.min(g,d),I=Math.max(p,m),_=Math.min(C,f);if(A<=v||C<=I)o=1;else{var y=h;c<u&&d<g&&p<m&&f<C&&(y=l),o=1-(A-v)*(_-I)/((y.right-y.left)*(y.top-y.bottom))}e<o&&(t._changed.raiseEvent(o),t._changedPosition=N.clone(t.position,t._changedPosition),t._changedFrustum=t.frustum.clone(t._changedFrustum))}}};var S=new I,M=new r;E.prototype._adjustHeightForTerrain=function(){var t=this._scene,e=t.screenSpaceCameraController,i=e.enableCollisionDetection,r=e.minimumCollisionTerrainHeight,n=e.minimumZoomDistance;if(!this._suspendTerrainAdjustment&&i){var o=this._mode,a=t.globe;if(V(a)&&o!==b.SCENE2D&&o!==b.MORPHING){var s,l,h=a.ellipsoid,c=t.mapProjection;I.equals(this.transform,I.IDENTITY)||(s=I.clone(this.transform,S),l=N.magnitude(this.position),this._setTransform(I.IDENTITY));var g=M;o===b.SCENE3D?h.cartesianToCartographic(this.position,g):c.unproject(this.position,g);var u=!1;if(g.height<r){var d=a.getHeight(g);V(d)&&(d+=n,g.height<d&&(g.height=d,o===b.SCENE3D?h.cartographicToCartesian(g,this.position):c.project(g,this.position),u=!0))}V(s)&&(this._setTransform(s),u&&(N.normalize(this.position,this.position),N.negate(this.position,this.direction),N.multiplyByScalar(this.position,Math.max(l,n),this.position),N.normalize(this.direction,this.direction),N.cross(this.direction,this.up,this.right),N.cross(this.right,this.direction,this.up)))}}};var D=new r,R=new N,L=new N,F=new A,O=new A,k=new A,B=new A,H=new A;var W=new N;function o(t){var e=t._mode,i=!1,r=0;e===b.SCENE2D&&(i=(r=t.frustum.right-t.frustum.left)!==t._positionCartographic.height);var n=t._position,o=!N.equals(n,t.position)||i;o&&(n=N.clone(t.position,t._position));var a=t._direction,s=!N.equals(a,t.direction);s&&(N.normalize(t.direction,t.direction),a=N.clone(t.direction,t._direction));var l=t._up,h=!N.equals(l,t.up);h&&(N.normalize(t.up,t.up),l=N.clone(t.up,t._up));var c=t._right,g=!N.equals(c,t.right);g&&(N.normalize(t.right,t.right),c=N.clone(t.right,t._right));var u=t._transformChanged||t._modeChanged;t._transformChanged=!1,u&&(I.inverseTransformation(t._transform,t._invTransform),t._mode===b.COLUMBUS_VIEW||t._mode===b.SCENE2D?I.equals(I.IDENTITY,t._transform)?I.clone(E.TRANSFORM_2D,t._actualTransform):t._mode===b.COLUMBUS_VIEW?function(t){w.basisTo2D(t._projection,t._transform,t._actualTransform)}(t):function(t){var e=t._projection,i=e.ellipsoid,r=I.getColumn(t._transform,3,F),n=i.cartesianToCartographic(r,D),o=e.project(n,R),a=O;a.x=o.z,a.y=o.x,a.z=o.y,a.w=1;var s=A.clone(A.UNIT_X,H),l=A.add(I.getColumn(t._transform,0,L),r,L);i.cartesianToCartographic(l,n),e.project(n,o);var h=k;h.x=o.z,h.y=o.x,h.z=o.y,h.w=0,N.subtract(h,a,h),h.x=0;var c=B;if(N.magnitudeSquared(h)>G.EPSILON10)N.cross(s,h,c);else{var g=A.add(I.getColumn(t._transform,1,L),r,L);i.cartesianToCartographic(g,n),e.project(n,o),c.x=o.z,c.y=o.x,c.z=o.y,c.w=0,N.subtract(c,a,c),c.x=0,N.magnitudeSquared(c)<G.EPSILON10&&(A.clone(A.UNIT_Y,h),A.clone(A.UNIT_Z,c))}N.cross(c,s,h),N.normalize(h,h),N.cross(s,h,c),N.normalize(c,c),I.setColumn(t._actualTransform,0,h,t._actualTransform),I.setColumn(t._actualTransform,1,c,t._actualTransform),I.setColumn(t._actualTransform,2,s,t._actualTransform),I.setColumn(t._actualTransform,3,a,t._actualTransform)}(t):I.clone(t._transform,t._actualTransform),I.inverseTransformation(t._actualTransform,t._actualInvTransform),t._modeChanged=!1);var d=t._actualTransform;if(o||u)if(t._positionWC=I.multiplyByPoint(d,n,t._positionWC),e===b.SCENE3D||e===b.MORPHING)t._positionCartographic=t._projection.ellipsoid.cartesianToCartographic(t._positionWC,t._positionCartographic);else{var p=W;p.x=t._positionWC.y,p.y=t._positionWC.z,p.z=t._positionWC.x,e===b.SCENE2D&&(p.z=r),t._projection.unproject(p,t._positionCartographic)}if(s||h||g){var C=N.dot(a,N.cross(l,c,W));if(Math.abs(1-C)>G.EPSILON2){var m=1/N.magnitudeSquared(l),f=N.dot(l,a)*m,v=N.multiplyByScalar(a,f,W);l=N.normalize(N.subtract(l,v,t._up),t._up),N.clone(l,t.up),c=N.cross(a,l,t._right),N.clone(c,t.right)}}(s||u)&&(t._directionWC=I.multiplyByPointAsVector(d,a,t._directionWC),N.normalize(t._directionWC,t._directionWC)),(h||u)&&(t._upWC=I.multiplyByPointAsVector(d,l,t._upWC),N.normalize(t._upWC,t._upWC)),(g||u)&&(t._rightWC=I.multiplyByPointAsVector(d,c,t._rightWC),N.normalize(t._rightWC,t._rightWC)),(o||s||h||g||u)&&T(t)}function j(t,e){var i;return i=G.equalsEpsilon(Math.abs(t.z),1,G.EPSILON3)?Math.atan2(e.y,e.x)-G.PI_OVER_TWO:Math.atan2(t.y,t.x)-G.PI_OVER_TWO,G.TWO_PI-G.zeroToTwoPi(i)}function Y(t){return G.PI_OVER_TWO-G.acosClamped(t.z)}function q(t,e,i){var r=0;return G.equalsEpsilon(Math.abs(t.z),1,G.EPSILON3)||(r=Math.atan2(-i.z,e.z),r=G.zeroToTwoPi(r+G.TWO_PI)),r}var Z=new I,X=new I;e(E.prototype,{transform:{get:function(){return this._transform}},inverseTransform:{get:function(){return o(this),this._invTransform}},viewMatrix:{get:function(){return o(this),this._viewMatrix}},inverseViewMatrix:{get:function(){return o(this),this._invViewMatrix}},positionCartographic:{get:function(){return o(this),this._positionCartographic}},positionWC:{get:function(){return o(this),this._positionWC}},directionWC:{get:function(){return o(this),this._directionWC}},upWC:{get:function(){return o(this),this._upWC}},rightWC:{get:function(){return o(this),this._rightWC}},heading:{get:function(){if(this._mode!==b.MORPHING){var t=this._projection.ellipsoid,e=I.clone(this._transform,Z),i=w.eastNorthUpToFixedFrame(this.positionWC,t,X);this._setTransform(i);var r=j(this.direction,this.up);return this._setTransform(e),r}}},pitch:{get:function(){if(this._mode!==b.MORPHING){var t=this._projection.ellipsoid,e=I.clone(this._transform,Z),i=w.eastNorthUpToFixedFrame(this.positionWC,t,X);this._setTransform(i);var r=Y(this.direction);return this._setTransform(e),r}}},roll:{get:function(){if(this._mode!==b.MORPHING){var t=this._projection.ellipsoid,e=I.clone(this._transform,Z),i=w.eastNorthUpToFixedFrame(this.positionWC,t,X);this._setTransform(i);var r=q(this.direction,this.up,this.right);return this._setTransform(e),r}}},moveStart:{get:function(){return this._moveStart}},moveEnd:{get:function(){return this._moveEnd}},changed:{get:function(){return this._changed}}}),E.prototype.update=function(t){if(!V(t))throw new g("mode is required.");if(t===b.SCENE2D&&!(this.frustum instanceof c))throw new g("An OrthographicOffCenterFrustum is required in 2D.");if(!(t!==b.SCENE3D&&t!==b.COLUMBUS_VIEW||this.frustum instanceof a||this.frustum instanceof U))throw new g("A PerspectiveFrustum or OrthographicFrustum is required in 3D and Columbus view");var e=!1;if(t!==this._mode&&(this._mode=t,this._modeChanged=t!==b.MORPHING,e=this._mode===b.SCENE2D),e){var i=this._max2Dfrustum=this.frustum.clone();if(!(i instanceof c))throw new g("The camera frustum is expected to be orthographic for 2D camera control.");var r=i.top/i.right;i.right=2*this._maxCoord.x,i.left=-i.right,i.top=r*i.right,i.bottom=-i.top}this._mode===b.SCENE2D&&mt(this,this.position);var n=this._scene.globe,o=!V(n)||n._surface.tileProvider.ready&&0===n._surface._tileLoadQueueHigh.length&&0===n._surface._tileLoadQueueMedium.length&&0===n._surface._tileLoadQueueLow.length&&0===n._surface._debug.tilesWaitingForChildren;this._suspendTerrainAdjustment&&(this._suspendTerrainAdjustment=!o),this._adjustHeightForTerrain()};var K=new N,Q=new N,J=new N;E.prototype._setTransform=function(t){var e=N.clone(this.positionWC,K),i=N.clone(this.upWC,Q),r=N.clone(this.directionWC,J);I.clone(t,this._transform),this._transformChanged=!0,o(this);var n=this._actualInvTransform;I.multiplyByPoint(n,e,this.position),I.multiplyByPointAsVector(n,r,this.direction),I.multiplyByPointAsVector(n,i,this.up),N.cross(this.direction,this.up,this.right),o(this)};var $=new d,tt=new u,et=new N,it=new N;E.prototype._adjustOrthographicFrustum=function(t){if(this.frustum instanceof U&&(t||!(this._positionCartographic.height<15e4)))if(I.equals(I.IDENTITY,this.transform)){var e,i,r=this._scene,n=r._globe;if(V(n)){var o=$;o.x=r.drawingBufferWidth/2,o.y=r.drawingBufferHeight/2;var a=this.getPickRay(o,tt);if(e=n.pick(a,r,et),r.pickPositionSupported&&(i=r.pickPositionWorldCoordinates(o,it)),V(e)&&V(i)){var s=V(i)?N.distance(i,this.positionWC):Number.POSITIVE_INFINITY,l=V(e)?N.distance(e,this.positionWC):Number.POSITIVE_INFINITY;this.frustum.width=Math.min(s,l)}else V(i)?this.frustum.width=N.distance(i,this.positionWC):V(e)&&(this.frustum.width=N.distance(e,this.positionWC))}if(!V(n)||!V(e)&&!V(i)){var h=Math.max(this.positionCartographic.height,0);this.frustum.width=h}}else this.frustum.width=N.magnitude(this.position)};var rt=new N,nt=new I,ot=new I,at=new _,st=new v,lt=new r;var ht=new N,ct=new N,gt=new N;function ut(t,e,i,r){var n=N.clone(i.direction,ht),o=N.clone(i.up,ct);if(t._scene.mode===b.SCENE3D){var a=t._projection.ellipsoid,s=w.eastNorthUpToFixedFrame(e,a,Z),l=I.inverseTransformation(s,X);I.multiplyByPointAsVector(l,n,n),I.multiplyByPointAsVector(l,o,o)}var h=N.cross(n,o,gt);return r.heading=j(n,o),r.pitch=Y(n),r.roll=q(n,o,h),r}var dt={destination:void 0,orientation:{direction:void 0,up:void 0,heading:void 0,pitch:void 0,roll:void 0},convert:void 0,endTransform:void 0},pt=new i;E.prototype.setView=function(t){t=C(t,C.EMPTY_OBJECT);var e=C(t.orientation,C.EMPTY_OBJECT),i=this._mode;if(i!==b.MORPHING){V(t.endTransform)&&this._setTransform(t.endTransform);var r=C(t.convert,!0),n=C(t.destination,N.clone(this.positionWC,rt));V(n)&&V(n.west)&&(n=this.getRectangleCameraCoordinates(n,rt),r=!1),V(e.direction)&&(e=ut(this,n,e,dt.orientation)),pt.heading=C(e.heading,0),pt.pitch=C(e.pitch,-G.PI_OVER_TWO),pt.roll=C(e.roll,0),this._suspendTerrainAdjustment=!1,i===b.SCENE3D?function(t,e,i){var r=I.clone(t.transform,nt),n=w.eastNorthUpToFixedFrame(e,t._projection.ellipsoid,ot);t._setTransform(n),N.clone(N.ZERO,t.position),i.heading=i.heading-G.PI_OVER_TWO;var o=_.fromHeadingPitchRoll(i,at),a=v.fromQuaternion(o,st);v.getColumn(a,0,t.direction),v.getColumn(a,2,t.up),N.cross(t.direction,t.up,t.right),t._setTransform(r),t._adjustOrthographicFrustum(!0)}(this,n,pt):i===b.SCENE2D?function(t,e,i,r){var n=I.clone(t.transform,nt);if(t._setTransform(I.IDENTITY),!N.equals(e,t.positionWC)){if(r){var o=t._projection,a=o.ellipsoid.cartesianToCartographic(e,lt);e=o.project(a,rt)}d.clone(e,t.position);var s=.5*-e.z,l=-s,h=t.frustum;if(s<l){var c=h.top/h.right;h.right=l,h.left=s,h.top=h.right*c,h.bottom=-h.top}}if(t._scene.mapMode2D===x.ROTATE){i.heading=i.heading-G.PI_OVER_TWO,i.pitch=-G.PI_OVER_TWO,i.roll=0;var g=_.fromHeadingPitchRoll(i,at),u=v.fromQuaternion(g,st);v.getColumn(u,2,t.up),N.cross(t.direction,t.up,t.right)}t._setTransform(n)}(this,n,pt,r):function(t,e,i,r){var n=I.clone(t.transform,nt);if(t._setTransform(I.IDENTITY),!N.equals(e,t.positionWC)){if(r){var o=t._projection,a=o.ellipsoid.cartesianToCartographic(e,lt);e=o.project(a,rt)}N.clone(e,t.position)}i.heading=i.heading-G.PI_OVER_TWO;var s=_.fromHeadingPitchRoll(i,at),l=v.fromQuaternion(s,st);v.getColumn(l,0,t.direction),v.getColumn(l,2,t.up),N.cross(t.direction,t.up,t.right),t._setTransform(n),t._adjustOrthographicFrustum(!0)}(this,n,pt,r)}};var Ct=new N;function mt(t,e){var i,r,n=t._scene.mapMode2D===x.ROTATE,o=t._maxCoord.x,a=t._maxCoord.y;i=n?-(r=o):(r=e.x-2*o,e.x+2*o),e.x>o&&(e.x=r),e.x<-o&&(e.x=i),e.y>a&&(e.y=a),e.y<-a&&(e.y=-a)}E.prototype.flyHome=function(t){var e=this._mode;if(e===b.MORPHING&&this._scene.completeMorph(),e===b.SCENE2D)this.flyTo({destination:E.DEFAULT_VIEW_RECTANGLE,duration:t,endTransform:I.IDENTITY});else if(e===b.SCENE3D){var i=this.getRectangleCameraCoordinates(E.DEFAULT_VIEW_RECTANGLE),r=N.magnitude(i);r+=r*E.DEFAULT_VIEW_FACTOR,N.normalize(i,i),N.multiplyByScalar(i,r,i),this.flyTo({destination:i,duration:t,endTransform:I.IDENTITY})}else if(e===b.COLUMBUS_VIEW){var n=this._projection.ellipsoid.maximumRadius,o=new N(0,-1,1);o=N.multiplyByScalar(N.normalize(o,o),5*n,o),this.flyTo({destination:o,duration:t,orientation:{heading:0,pitch:-Math.acos(N.normalize(o,Ct).z),roll:0},endTransform:I.IDENTITY,convert:!1})}},E.prototype.worldToCameraCoordinates=function(t,e){if(!V(t))throw new g("cartesian is required.");return V(e)||(e=new A),o(this),I.multiplyByVector(this._actualInvTransform,t,e)},E.prototype.worldToCameraCoordinatesPoint=function(t,e){if(!V(t))throw new g("cartesian is required.");return V(e)||(e=new N),o(this),I.multiplyByPoint(this._actualInvTransform,t,e)},E.prototype.worldToCameraCoordinatesVector=function(t,e){if(!V(t))throw new g("cartesian is required.");return V(e)||(e=new N),o(this),I.multiplyByPointAsVector(this._actualInvTransform,t,e)},E.prototype.cameraToWorldCoordinates=function(t,e){if(!V(t))throw new g("cartesian is required.");return V(e)||(e=new A),o(this),I.multiplyByVector(this._actualTransform,t,e)},E.prototype.cameraToWorldCoordinatesPoint=function(t,e){if(!V(t))throw new g("cartesian is required.");return V(e)||(e=new N),o(this),I.multiplyByPoint(this._actualTransform,t,e)},E.prototype.cameraToWorldCoordinatesVector=function(t,e){if(!V(t))throw new g("cartesian is required.");return V(e)||(e=new N),o(this),I.multiplyByPointAsVector(this._actualTransform,t,e)};var ft=new N;E.prototype.move=function(t,e){if(!V(t))throw new g("direction is required.");var i=this.position;N.multiplyByScalar(t,e,ft),N.add(i,ft,i),this._mode===b.SCENE2D&&mt(this,i),this._adjustOrthographicFrustum(!0)},E.prototype.moveForward=function(t){t=C(t,this.defaultMoveAmount),this.move(this.direction,t)},E.prototype.moveBackward=function(t){t=C(t,this.defaultMoveAmount),this.move(this.direction,-t)},E.prototype.moveUp=function(t){t=C(t,this.defaultMoveAmount),this.move(this.up,t)},E.prototype.moveDown=function(t){t=C(t,this.defaultMoveAmount),this.move(this.up,-t)},E.prototype.moveRight=function(t){t=C(t,this.defaultMoveAmount),this.move(this.right,t)},E.prototype.moveLeft=function(t){t=C(t,this.defaultMoveAmount),this.move(this.right,-t)},E.prototype.lookLeft=function(t){t=C(t,this.defaultLookAmount),this.look(this.up,-t)},E.prototype.lookRight=function(t){t=C(t,this.defaultLookAmount),this.look(this.up,t)},E.prototype.lookUp=function(t){t=C(t,this.defaultLookAmount),this.look(this.right,-t)},E.prototype.lookDown=function(t){t=C(t,this.defaultLookAmount),this.look(this.right,t)};var vt=new _,At=new v;E.prototype.look=function(t,e){if(!V(t))throw new g("axis is required.");var i=C(e,this.defaultLookAmount),r=_.fromAxisAngle(t,-i,vt),n=v.fromQuaternion(r,At),o=this.direction,a=this.up,s=this.right;v.multiplyByVector(n,o,o),v.multiplyByVector(n,a,a),v.multiplyByVector(n,s,s)},E.prototype.twistLeft=function(t){t=C(t,this.defaultLookAmount),this.look(this.direction,t)},E.prototype.twistRight=function(t){t=C(t,this.defaultLookAmount),this.look(this.direction,-t)};var It=new _,_t=new v;E.prototype.rotate=function(t,e){if(!V(t))throw new g("axis is required.");var i=C(e,this.defaultRotateAmount),r=_.fromAxisAngle(t,-i,It),n=v.fromQuaternion(r,_t);v.multiplyByVector(n,this.position,this.position),v.multiplyByVector(n,this.direction,this.direction),v.multiplyByVector(n,this.up,this.up),N.cross(this.direction,this.up,this.right),N.cross(this.right,this.direction,this.up),this._adjustOrthographicFrustum(!1)},E.prototype.rotateDown=function(t){bt(this,t=C(t,this.defaultRotateAmount))},E.prototype.rotateUp=function(t){bt(this,-(t=C(t,this.defaultRotateAmount)))};var yt=new N,wt=new N,Pt=new N,xt=new N;function bt(t,e){var i=t.position,r=N.normalize(i,yt);if(V(t.constrainedAxis)){var n=N.equalsEpsilon(r,t.constrainedAxis,G.EPSILON2),o=N.equalsEpsilon(r,N.negate(t.constrainedAxis,xt),G.EPSILON2);if(n||o)(n&&e<0||o&&0<e)&&t.rotate(t.right,e);else{var a=N.normalize(t.constrainedAxis,wt),s=N.dot(r,a),l=G.acosClamped(s);0<e&&l<e&&(e=l-G.EPSILON4),s=N.dot(r,N.negate(a,xt)),l=G.acosClamped(s),e<0&&l<-e&&(e=-l+G.EPSILON4);var h=N.cross(a,r,Pt);t.rotate(h,e)}}else t.rotate(t.right,e)}function Et(t,e){V(t.constrainedAxis)?t.rotate(t.constrainedAxis,e):t.rotate(t.up,e)}function Tt(t,e){var i,r=t.frustum;if(!(r instanceof c&&V(r.left)&&V(r.right)&&V(r.bottom)&&V(r.top)))throw new g("The camera frustum is expected to be orthographic for 2D camera control.");if(e*=.5,Math.abs(r.top)+Math.abs(r.bottom)>Math.abs(r.left)+Math.abs(r.right)){var n=r.top-e,o=r.bottom+e,a=t._maxCoord.y;t._scene.mapMode2D===x.ROTATE&&(a*=t.maximumZoomFactor),a<o&&(n=-(o=a)),n<=o&&(o=-(n=1)),i=r.right/r.top,r.top=n,r.bottom=o,r.right=r.top*i,r.left=-r.right}else{var s=r.right-e,l=r.left+e,h=t._maxCoord.x;t._scene.mapMode2D===x.ROTATE&&(h*=t.maximumZoomFactor),h<s&&(l=-(s=h)),s<=l&&(l=-(s=1)),i=r.top/r.right,r.right=s,r.left=l,r.top=r.right*i,r.bottom=-r.top}}function St(t,e){t.move(t.direction,e)}E.prototype.rotateRight=function(t){Et(this,-(t=C(t,this.defaultRotateAmount)))},E.prototype.rotateLeft=function(t){Et(this,t=C(t,this.defaultRotateAmount))},E.prototype.zoomIn=function(t){t=C(t,this.defaultZoomAmount),this._mode===b.SCENE2D?Tt(this,t):St(this,t)},E.prototype.zoomOut=function(t){t=C(t,this.defaultZoomAmount),this._mode===b.SCENE2D?Tt(this,-t):St(this,-t)},E.prototype.getMagnitude=function(){return this._mode===b.SCENE3D?N.magnitude(this.position):this._mode===b.COLUMBUS_VIEW?Math.abs(this.position.z):this._mode===b.SCENE2D?Math.max(this.frustum.right-this.frustum.left,this.frustum.top-this.frustum.bottom):void 0};var Mt=new I;E.prototype.lookAt=function(t,e){if(!V(t))throw new g("target is required");if(!V(e))throw new g("offset is required");if(this._mode===b.MORPHING)throw new g("lookAt is not supported while morphing.");var i=w.eastNorthUpToFixedFrame(t,m.WGS84,Mt);this.lookAtTransform(i,e)};var Dt=new N,Rt=new _,Lt=new _,Ft=new v;function Ot(t,e,i){e=G.clamp(e,-G.PI_OVER_TWO,G.PI_OVER_TWO),t=G.zeroToTwoPi(t)-G.PI_OVER_TWO;var r=_.fromAxisAngle(N.UNIT_Y,-e,Rt),n=_.fromAxisAngle(N.UNIT_Z,-t,Lt),o=_.multiply(n,r,n),a=v.fromQuaternion(o,Ft),s=N.clone(N.UNIT_X,Dt);return v.multiplyByVector(a,s,s),N.negate(s,s),N.multiplyByScalar(s,i,s),s}E.prototype.lookAtTransform=function(t,e){if(!V(t))throw new g("transform is required");if(this._mode===b.MORPHING)throw new g("lookAtTransform is not supported while morphing.");if(this._setTransform(t),V(e)){var i;if(i=V(e.heading)?Ot(e.heading,e.pitch,e.range):e,this._mode===b.SCENE2D){d.clone(d.ZERO,this.position),N.negate(i,this.up),this.up.z=0,N.magnitudeSquared(this.up)<G.EPSILON10&&N.clone(N.UNIT_Y,this.up),N.normalize(this.up,this.up),this._setTransform(I.IDENTITY),N.negate(N.UNIT_Z,this.direction),N.cross(this.direction,this.up,this.right),N.normalize(this.right,this.right);var r=this.frustum,n=r.top/r.right;return r.right=.5*N.magnitude(i),r.left=-r.right,r.top=n*r.right,r.bottom=-r.top,void this._setTransform(t)}N.clone(i,this.position),N.negate(this.position,this.direction),N.normalize(this.direction,this.direction),N.cross(this.direction,N.UNIT_Z,this.right),N.magnitudeSquared(this.right)<G.EPSILON10&&N.clone(N.UNIT_X,this.right),N.normalize(this.right,this.right),N.cross(this.right,this.direction,this.up),N.normalize(this.up,this.up),this._adjustOrthographicFrustum(!0)}};var kt,Bt=new r,Nt=new r,Vt=new N,zt=new N,Gt=new N,Ut=new N,Ht=new N,Wt=new N,jt=new N,Yt=new N,qt={direction:new N,right:new N,up:new N};function Zt(t,e,i,r){return Math.abs(N.dot(e,i))/r-N.dot(t,i)}function Xt(t,e,i,r){var n=t._projection.ellipsoid,o=r?t:qt,a=e.north,s=e.south,l=e.east,h=e.west;l<h&&(l+=G.TWO_PI);var c,g=.5*(h+l);if(s<-G.PI_OVER_TWO+G.RADIANS_PER_DEGREE&&a>G.PI_OVER_TWO-G.RADIANS_PER_DEGREE)c=0;else{var u=Bt;u.longitude=g,u.latitude=a,u.height=0;var d=Nt;d.longitude=g,d.latitude=s,d.height=0;var p=kt;V(p)&&p.ellipsoid===n||(kt=p=new z(void 0,void 0,n)),p.setEndPoints(u,d),c=p.interpolateUsingFraction(.5,Bt).latitude}var C=Bt;C.longitude=g,C.latitude=c,C.height=0;var m=n.cartographicToCartesian(C,jt),f=Bt;f.longitude=l,f.latitude=a;var v=n.cartographicToCartesian(f,Vt);f.longitude=h;var A=n.cartographicToCartesian(f,Gt);f.longitude=g;var I=n.cartographicToCartesian(f,Ht);f.latitude=s;var _=n.cartographicToCartesian(f,Wt);f.longitude=l;var y=n.cartographicToCartesian(f,Ut);f.longitude=h;var w=n.cartographicToCartesian(f,zt);N.subtract(A,m,A),N.subtract(y,m,y),N.subtract(v,m,v),N.subtract(w,m,w),N.subtract(I,m,I),N.subtract(_,m,_);var P=n.geodeticSurfaceNormal(m,o.direction);N.negate(P,P);var x=N.cross(P,N.UNIT_Z,o.right);N.normalize(x,x);var b,E=N.cross(x,P,o.up);if(t.frustum instanceof U){var T,S,M=Math.max(N.distance(v,A),N.distance(y,w)),D=Math.max(N.distance(v,y),N.distance(A,w)),R=t.frustum._offCenterFrustum.right/t.frustum._offCenterFrustum.top,L=D*R;L<M?S=(T=M)/R:(S=D,T=L),b=Math.max(T,S)}else{var F=Math.tan(.5*t.frustum.fovy),O=t.frustum.aspectRatio*F;if(b=Math.max(Zt(P,E,A,F),Zt(P,E,y,F),Zt(P,E,v,F),Zt(P,E,w,F),Zt(P,E,I,F),Zt(P,E,_,F),Zt(P,x,A,O),Zt(P,x,y,O),Zt(P,x,v,O),Zt(P,x,w,O),Zt(P,x,I,O),Zt(P,x,_,O)),s<0&&0<a){var k=Bt;k.longitude=h,k.latitude=0,k.height=0;var B=n.cartographicToCartesian(k,Yt);N.subtract(B,m,B),b=Math.max(b,Zt(P,E,B,F),Zt(P,x,B,O)),k.longitude=l,B=n.cartographicToCartesian(k,Yt),N.subtract(B,m,B),b=Math.max(b,Zt(P,E,B,F),Zt(P,x,B,O))}}return N.add(m,N.multiplyByScalar(P,-b,Yt),i)}var Kt=new r,Qt=new N,Jt=new N;var $t=new r,te=new N,ee=new N;E.prototype.getRectangleCameraCoordinates=function(t,e){if(!V(t))throw new g("rectangle is required");var i=this._mode;return V(e)||(e=new N),i===b.SCENE3D?Xt(this,t,e):i===b.COLUMBUS_VIEW?function(t,e,i){var r=t._projection;e.west>e.east&&(e=y.MAX_VALUE);var n=t._actualTransform,o=t._actualInvTransform,a=Kt;a.longitude=e.east,a.latitude=e.north;var s=r.project(a,Qt);I.multiplyByPoint(n,s,s),I.multiplyByPoint(o,s,s),a.longitude=e.west,a.latitude=e.south;var l=r.project(a,Jt);if(I.multiplyByPoint(n,l,l),I.multiplyByPoint(o,l,l),i.x=.5*(s.x-l.x)+l.x,i.y=.5*(s.y-l.y)+l.y,V(t.frustum.fovy)){var h=Math.tan(.5*t.frustum.fovy),c=t.frustum.aspectRatio*h;i.z=.5*Math.max((s.x-l.x)/c,(s.y-l.y)/h)}else{var g=s.x-l.x,u=s.y-l.y;i.z=Math.max(g,u)}return i}(this,t,e):i===b.SCENE2D?function(t,e,i){var r=t._projection;e.west>e.east&&(e=y.MAX_VALUE);var n=$t;n.longitude=e.east,n.latitude=e.north;var o=r.project(n,te);n.longitude=e.west,n.latitude=e.south;var a,s,l=r.project(n,ee),h=.5*Math.abs(o.x-l.x),c=.5*Math.abs(o.y-l.y),g=t.frustum.right/t.frustum.top,u=c*g;return u<h?s=(a=h)/g:(s=c,a=u),c=Math.max(2*a,2*s),i.x=.5*(o.x-l.x)+l.x,i.y=.5*(o.y-l.y)+l.y,(n=r.unproject(i,n)).height=c,i=r.project(n,i)}(this,t,e):void 0};var ie=new u;var re=new u;var ne=new u;E.prototype.pickEllipsoid=function(t,e,i){if(!V(t))throw new g("windowPosition is required.");var r=this._scene.canvas;if(0!==r.clientWidth&&0!==r.clientHeight){if(V(i)||(i=new N),e=C(e,m.WGS84),this._mode===b.SCENE3D)i=function(t,e,i,r){i=C(i,m.WGS84);var n=t.getPickRay(e,ie),o=h.rayEllipsoid(n,i);if(o){var a=0<o.start?o.start:o.stop;return u.getPoint(n,a,r)}}(this,t,e,i);else if(this._mode===b.SCENE2D)i=function(t,e,i,r){var n=t.getPickRay(e,re).origin;n.z=0;var o=i.unproject(n);if(!(o.latitude<-G.PI_OVER_TWO||o.latitude>G.PI_OVER_TWO))return i.ellipsoid.cartographicToCartesian(o,r)}(this,t,this._projection,i);else{if(this._mode!==b.COLUMBUS_VIEW)return;i=function(t,e,i,r){var n=t.getPickRay(e,ne),o=-n.origin.x/n.direction.x;u.getPoint(n,o,r);var a=i.unproject(new N(r.y,r.z,0));if(!(a.latitude<-G.PI_OVER_TWO||a.latitude>G.PI_OVER_TWO||a.longitude<-Math.PI||a.longitude>Math.PI))return i.ellipsoid.cartographicToCartesian(a,r)}(this,t,this._projection,i)}return i}};var oe=new N,ae=new N,se=new N;var le=new N;E.prototype.getPickRay=function(t,e){if(!V(t))throw new g("windowPosition is required.");V(e)||(e=new u);var i=this.frustum;return V(i.aspectRatio)&&V(i.fov)&&V(i.near)?function(t,e,i){var r=t._scene.canvas,n=r.clientWidth,o=r.clientHeight,a=Math.tan(.5*t.frustum.fovy),s=t.frustum.aspectRatio*a,l=t.frustum.near,h=2/n*e.x-1,c=2/o*(o-e.y)-1,g=t.positionWC;N.clone(g,i.origin);var u=N.multiplyByScalar(t.directionWC,l,oe);N.add(g,u,u);var d=N.multiplyByScalar(t.rightWC,h*l*s,ae),p=N.multiplyByScalar(t.upWC,c*l*a,se),C=N.add(u,d,i.direction);return N.add(C,p,C),N.subtract(C,g,C),N.normalize(C,C),i}(this,t,e):function(t,e,i){var r=t._scene.canvas,n=r.clientWidth,o=r.clientHeight,a=t.frustum;V(a._offCenterFrustum)&&(a=a._offCenterFrustum);var s=2/n*e.x-1;s*=.5*(a.right-a.left);var l=2/o*(o-e.y)-1;l*=.5*(a.top-a.bottom);var h=i.origin;return N.clone(t.position,h),N.multiplyByScalar(t.right,s,le),N.add(le,h,h),N.multiplyByScalar(t.up,l,le),N.add(le,h,h),N.clone(t.directionWC,i.direction),t._mode===b.COLUMBUS_VIEW&&N.fromElements(i.origin.z,i.origin.x,i.origin.y,i.origin),i}(this,t,e)};var he=new N,ce=new N;E.prototype.distanceToBoundingSphere=function(t){if(!V(t))throw new g("boundingSphere is required.");var e=N.subtract(this.positionWC,t.center,he),i=N.multiplyByScalar(this.directionWC,N.dot(e,this.directionWC),ce);return Math.max(0,N.magnitude(i)-t.radius)};var ge=new d;function ue(i,r,t,e,n,o){var a=N.clone(r);return t.y>e?a.y-=t.y-e:t.y<-e&&(a.y+=-e-t.y),t.z>n?a.z-=t.z-n:t.z<-n&&(a.z+=-n-t.z),{easingFunction:s.EXPONENTIAL_OUT,startObject:{time:0},stopObject:{time:1},duration:o,update:function(t){var e=N.lerp(r,a,t.time,new N);i.worldToCameraCoordinatesPoint(e,i.position)}}}E.prototype.getPixelSize=function(t,e,i){if(!V(t))throw new g("boundingSphere is required.");if(!V(e))throw new g("drawingBufferWidth is required.");if(!V(i))throw new g("drawingBufferHeight is required.");var r=this.distanceToBoundingSphere(t),n=this.frustum.getPixelDimensions(e,i,r,ge);return Math.max(n.x,n.y)};var de=new N,pe=new N,Ce=new N,me=new N;E.prototype.createCorrectPositionTween=function(t){if(!V(t))throw new g("duration is required.");if(this._mode===b.COLUMBUS_VIEW)return function(t,e){var i=t.position,r=t.direction,n=t.worldToCameraCoordinatesVector(N.UNIT_X,de),o=-N.dot(n,i)/N.dot(n,r),a=N.add(i,N.multiplyByScalar(r,o,pe),pe);t.cameraToWorldCoordinatesPoint(a,a),i=t.cameraToWorldCoordinatesPoint(t.position,Ce);var s=Math.tan(.5*t.frustum.fovy),l=t.frustum.aspectRatio*s,h=N.magnitude(N.subtract(i,a,me)),c=l*h,g=s*h,u=t._maxCoord.x,d=t._maxCoord.y,p=Math.max(c-u,u),C=Math.max(g-d,d);if(i.z<-p||i.z>p||i.y<-C||i.y>C){var m=a.y<-p||a.y>p,f=a.z<-C||a.z>C;if(m||f)return ue(t,i,a,p,C,e)}}(this,t)};var fe=new N,ve={destination:void 0,heading:void 0,pitch:void 0,roll:void 0,duration:void 0,complete:void 0,cancel:void 0,endTransform:void 0,maximumHeight:void 0,easingFunction:void 0};E.prototype.cancelFlight=function(){V(this._currentFlight)&&(this._currentFlight.cancelTween(),this._currentFlight=void 0)},E.prototype.flyTo=function(t){var e=(t=C(t,C.EMPTY_OBJECT)).destination;if(!V(e))throw new g("destination is required.");if(this._mode!==b.MORPHING){this.cancelFlight();var i=C(t.orientation,C.EMPTY_OBJECT);if(V(i.direction)&&(i=ut(this,e,i,dt.orientation)),V(t.duration)&&t.duration<=0){var r=dt;return r.destination=t.destination,r.orientation.heading=i.heading,r.orientation.pitch=i.pitch,r.orientation.roll=i.roll,r.convert=t.convert,r.endTransform=t.endTransform,this.setView(r),void("function"==typeof t.complete&&t.complete())}var n=V(e.west);n&&(e=this.getRectangleCameraCoordinates(e,fe));var o,a=this;ve.destination=e,ve.heading=i.heading,ve.pitch=i.pitch,ve.roll=i.roll,ve.duration=t.duration,ve.complete=function(){o===a._currentFlight&&(a._currentFlight=void 0),V(t.complete)&&t.complete()},ve.cancel=t.cancel,ve.endTransform=t.endTransform,ve.convert=!n&&t.convert,ve.maximumHeight=t.maximumHeight,ve.pitchAdjustHeight=t.pitchAdjustHeight,ve.flyOverLongitude=t.flyOverLongitude,ve.flyOverLongitudeWeight=t.flyOverLongitudeWeight,ve.easingFunction=t.easingFunction;var s=this._scene;o=s.tweens.add(P.createTween(s,ve)),this._currentFlight=o}};function Ae(t,e,i){V(i)||(i=l.clone(E.DEFAULT_OFFSET));var r=t._scene.screenSpaceCameraController.minimumZoomDistance,n=t._scene.screenSpaceCameraController.maximumZoomDistance,o=i.range;if(!V(o)||0===o){var a=e.radius;0===a?i.range=100:t.frustum instanceof U||t._mode===b.SCENE2D?i.range=function(t,e){var i,r,n=t.frustum;V(n._offCenterFrustum)&&(n=n._offCenterFrustum);var o=n.right/n.top,a=e*o;return a<e?r=(i=e)/o:(r=e,i=a),1.5*Math.max(i,r)}(t,a):i.range=function(t,e){var i=t.frustum,r=Math.tan(.5*i.fovy),n=i.aspectRatio*r;return Math.max(e/n,e/r)}(t,a),i.range=G.clamp(i.range,r,n)}return i}E.prototype.viewBoundingSphere=function(t,e){if(!V(t))throw new g("boundingSphere is required.");if(this._mode===b.MORPHING)throw new g("viewBoundingSphere is not supported while morphing.");e=Ae(this,t,e),this.lookAt(t.center,e)};var Ie=new I,_e=new N,ye=new N,we=new N,Pe=new N,xe=new A,be=new _,Ee=new v;E.prototype.flyToBoundingSphere=function(t,e){if(!V(t))throw new g("boundingSphere is required.");e=C(e,C.EMPTY_OBJECT);var i=this._mode===b.SCENE2D||this._mode===b.COLUMBUS_VIEW;this._setTransform(I.IDENTITY);var r,n=Ae(this,t,e.offset);r=i?N.multiplyByScalar(N.UNIT_Z,n.range,_e):Ot(n.heading,n.pitch,n.range);var o,a,s=w.eastNorthUpToFixedFrame(t.center,m.WGS84,Ie);if(I.multiplyByPoint(s,r,r),!i){if(o=N.subtract(t.center,r,ye),N.normalize(o,o),a=I.multiplyByPointAsVector(s,N.UNIT_Z,we),1-Math.abs(N.dot(o,a))<G.EPSILON6){var l=_.fromAxisAngle(o,n.heading,be),h=v.fromQuaternion(l,Ee);N.fromCartesian4(I.getColumn(s,1,xe),a),v.multiplyByVector(h,a,a)}var c=N.cross(o,a,Pe);N.cross(c,o,a),N.normalize(a,a)}this.flyTo({destination:r,orientation:{direction:o,up:a},duration:e.duration,complete:e.complete,cancel:e.cancel,endTransform:e.endTransform,maximumHeight:e.maximumHeight,easingFunction:e.easingFunction,flyOverLongitude:e.flyOverLongitude,flyOverLongitudeWeight:e.flyOverLongitudeWeight,pitchAdjustHeight:e.pitchAdjustHeight})};var Te=new N,Se=new N,Me=new N,De=new N,Re=[new N,new N,new N,new N];var Le=new d,Fe=new N,Oe=[new r,new r,new r,new r];function ke(t,e,i,r,n,o){Le.x=t,Le.y=e;var a=r.pickEllipsoid(Le,n,Fe);return V(a)?(Oe[i]=n.cartesianToCartographic(a,Oe[i]),1):(Oe[i]=n.cartesianToCartographic(o[i],Oe[i]),0)}E.prototype.computeViewRectangle=function(t,e){t=C(t,m.WGS84);var i=this.frustum.computeCullingVolume(this.positionWC,this.directionWC,this.upWC),r=new p(N.ZERO,t.maximumRadius);if(i.computeVisibility(r)!==f.OUTSIDE){var n=this._scene.canvas,o=n.clientWidth,a=n.clientHeight,s=0,l=function(t,e){var i,r,n=e.radii,o=t.positionWC,a=N.multiplyComponents(e.oneOverRadii,o,Te),s=N.magnitude(a),l=N.normalize(a,Se);r=N.equalsEpsilon(l,N.UNIT_Z,G.EPSILON10)?(i=new N(0,1,0),new N(0,0,1)):(i=N.normalize(N.cross(N.UNIT_Z,l,Me),Me),N.normalize(N.cross(l,i,De),De));var h=Math.sqrt(N.magnitudeSquared(a)-1),c=N.multiplyByScalar(l,1/s,Te),g=h/s,u=N.multiplyByScalar(i,g,Se),d=N.multiplyByScalar(r,g,Me),p=N.add(c,d,Re[0]);N.subtract(p,u,p),N.multiplyComponents(n,p,p);var C=N.subtract(c,d,Re[1]);N.subtract(C,u,C),N.multiplyComponents(n,C,C);var m=N.subtract(c,d,Re[2]);N.add(m,u,m),N.multiplyComponents(n,m,m);var f=N.add(c,d,Re[3]);return N.add(f,u,f),N.multiplyComponents(n,f,f),Re}(this,t);if(s+=ke(0,0,0,this,t,l),s+=ke(0,a,1,this,t,l),s+=ke(o,a,2,this,t,l),(s+=ke(o,0,3,this,t,l))<2)return y.MAX_VALUE;e=y.fromCartographicArray(Oe,e);for(var h=0,c=Oe[3].longitude,g=0;g<4;++g){var u=Oe[g].longitude,d=Math.abs(u-c);d>G.PI?h+=G.TWO_PI-d:h+=d,c=u}return G.equalsEpsilon(Math.abs(h),G.TWO_PI,G.EPSILON9)&&(e.west=-G.PI,e.east=G.PI,0<=Oe[0].latitude?e.north=G.PI_OVER_TWO:e.south=-G.PI_OVER_TWO),e}},E.prototype.switchToPerspectiveFrustum=function(){if(!(this._mode===b.SCENE2D||this.frustum instanceof a)){var t=this._scene;this.frustum=new a,this.frustum.aspectRatio=t.drawingBufferWidth/t.drawingBufferHeight,this.frustum.fov=G.toRadians(60)}},E.prototype.switchToOrthographicFrustum=function(){if(!(this._mode===b.SCENE2D||this.frustum instanceof U)){var t=this._scene;this.frustum=new U,this.frustum.aspectRatio=t.drawingBufferWidth/t.drawingBufferHeight,this.frustum.width=N.magnitude(this.position);var e=this.frustum.projectionMatrix;V(e)&&this._adjustOrthographicFrustum(!0)}},E.clone=function(t,e){return V(e)||(e=new E(t._scene)),N.clone(t.position,e.position),N.clone(t.direction,e.direction),N.clone(t.up,e.up),N.clone(t.right,e.right),I.clone(t._transform,e.transform),e._transformChanged=!0,e},t.GeoCamera=E}(window.Cesium),function(t){var g=t.Cartesian2,u=t.defined,e=t.defineProperties,i=t.destroyObject,n=t.DeveloperError,r=t.KeyboardEventModifier,o=t.Math,a=t.ScreenSpaceEventHandler,d=t.ScreenSpaceEventType,p=t.CameraEventType;function C(t,e){var i=t;return u(e)&&(i+="+"+e),i}function s(e,t,n){var o=C(p.PINCH,t),a=e._update,s=e._isDown,i=e._eventStartPosition,r=e._pressTime,l=e._releaseTime;a[o]=!0,s[o]=!1,i[o]=new g;var h=e._movement[o];u(h)||(h=e._movement[o]={}),h.distance={startPosition:new g,endPosition:new g},h.angleAndHeight={startPosition:new g,endPosition:new g},h.prevAngle=0,e._eventHandler.setInputAction(function(t){e._buttonsDown++,s[o]=!0,r[o]=new Date,g.lerp(t.position1,t.position2,.5,i[o])},d.PINCH_START,t),e._eventHandler.setInputAction(function(){e._buttonsDown=Math.max(e._buttonsDown-1,0),s[o]=!1,l[o]=new Date},d.PINCH_END,t),e._eventHandler.setInputAction(function(t){if(s[o]){a[o]?(function(t,e){g.clone(t.distance.startPosition,e.distance.startPosition),g.clone(t.distance.endPosition,e.distance.endPosition),g.clone(t.angleAndHeight.startPosition,e.angleAndHeight.startPosition),g.clone(t.angleAndHeight.endPosition,e.angleAndHeight.endPosition)}(t,h),a[o]=!1,h.prevAngle=h.angleAndHeight.startPosition.x):(g.clone(t.distance.endPosition,h.distance.endPosition),g.clone(t.angleAndHeight.endPosition,h.angleAndHeight.endPosition));for(var e=h.angleAndHeight.endPosition.x,i=h.prevAngle,r=2*Math.PI;e>=i+Math.PI;)e-=r;for(;e<i-Math.PI;)e+=r;h.angleAndHeight.endPosition.x=-e*n.clientWidth/12,h.angleAndHeight.startPosition.x=-i*n.clientWidth/12}},d.PINCH_MOVE,t)}function l(t,e){var i=C(p.WHEEL,e),r=t._update;r[i]=!0;var n=t._movement[i];u(n)||(n=t._movement[i]={}),n.startPosition=new g,n.endPosition=new g,t._eventHandler.setInputAction(function(t){var e=10*o.toRadians(t);r[i]?(g.clone(g.ZERO,n.startPosition),n.endPosition.x=0,n.endPosition.y=e,r[i]=!1):n.endPosition.y=n.endPosition.y+e},d.WHEEL,e)}function h(e,t,i){var r=C(i,t),n=e._isDown,o=e._eventStartPosition,a=e._pressTime,s=e._releaseTime;n[r]=!1,o[r]=new g;var l,h,c=e._lastMovement[r];u(c)||(c=e._lastMovement[r]={startPosition:new g,endPosition:new g,valid:!1}),i===p.LEFT_DRAG?(l=d.LEFT_DOWN,h=d.LEFT_UP):i===p.RIGHT_DRAG?(l=d.RIGHT_DOWN,h=d.RIGHT_UP):i===p.MIDDLE_DRAG&&(l=d.MIDDLE_DOWN,h=d.MIDDLE_UP),e._eventHandler.setInputAction(function(t){e._buttonsDown++,c.valid=!1,n[r]=!0,a[r]=new Date,g.clone(t.position,o[r])},l,t),e._eventHandler.setInputAction(function(){e._buttonsDown=Math.max(e._buttonsDown-1,0),n[r]=!1,s[r]=new Date},h,t)}function c(t,e){g.clone(t.startPosition,e.startPosition),g.clone(t.endPosition,e.endPosition)}function m(n,o){var a=n._update,s=n._movement,l=n._lastMovement,h=n._isDown;for(var t in p)if(p.hasOwnProperty(t)){var e=p[t];if(u(e)){var i=C(e,o);a[i]=!0,u(n._lastMovement[i])||(n._lastMovement[i]={startPosition:new g,endPosition:new g,valid:!1}),u(n._movement[i])||(n._movement[i]={startPosition:new g,endPosition:new g})}}n._eventHandler.setInputAction(function(t){for(var e in p)if(p.hasOwnProperty(e)){var i=p[e];if(u(i)){var r=C(i,o);h[r]&&(a[r]?(c(s[r],l[r]),l[r].valid=!0,c(t,s[r]),a[r]=!1):g.clone(t.endPosition,s[r].endPosition))}}g.clone(t.endPosition,n._currentMousePosition)},d.MOUSE_MOVE,o)}function f(t){if(!u(t))throw new n("canvas is required.");for(var e in this._eventHandler=new a(t,!0),this._update={},this._movement={},this._lastMovement={},this._isDown={},this._eventStartPosition={},this._pressTime={},this._releaseTime={},this._buttonsDown=0,this._currentMousePosition=new g,l(this,void 0),s(this,void 0,t),h(this,void 0,p.LEFT_DRAG),h(this,void 0,p.RIGHT_DRAG),h(this,void 0,p.MIDDLE_DRAG),m(this,void 0),r)if(r.hasOwnProperty(e)){var i=r[e];u(i)&&(l(this,i),s(this,i,t),h(this,i,p.LEFT_DRAG),h(this,i,p.RIGHT_DRAG),h(this,i,p.MIDDLE_DRAG),m(this,i))}}e(f.prototype,{currentMousePosition:{get:function(){return this._currentMousePosition}},anyButtonDown:{get:function(){var t=!(this._update[C(p.WHEEL)]&&this._update[C(p.WHEEL,r.SHIFT)]&&this._update[C(p.WHEEL,r.CTRL)]&&this._update[C(p.WHEEL,r.ALT)]);return 0<this._buttonsDown||t}}}),f.prototype.isMoving=function(t,e){if(!u(t))throw new n("type is required.");var i=C(t,e);return!this._update[i]},f.prototype.getMovement=function(t,e){if(!u(t))throw new n("type is required.");var i=C(t,e);return this._movement[i]},f.prototype.getLastMovement=function(t,e){if(!u(t))throw new n("type is required.");var i=C(t,e),r=this._lastMovement[i];if(r.valid)return r},f.prototype.isButtonDown=function(t,e){if(!u(t))throw new n("type is required.");var i=C(t,e);return this._isDown[i]},f.prototype.getStartMousePosition=function(t,e){if(!u(t))throw new n("type is required.");if(t===p.WHEEL)return this._currentMousePosition;var i=C(t,e);return this._eventStartPosition[i]},f.prototype.getButtonPressTime=function(t,e){if(!u(t))throw new n("type is required.");var i=C(t,e);return this._pressTime[i]},f.prototype.getButtonReleaseTime=function(t,e){if(!u(t))throw new n("type is required.");var i=C(t,e);return this._releaseTime[i]},f.prototype.reset=function(){for(var t in this._update)this._update.hasOwnProperty(t)&&(this._update[t]=!0)},f.prototype.isDestroyed=function(){return!1},f.prototype.destroy=function(){return this._eventHandler=this._eventHandler&&this._eventHandler.destroy(),i(this)},t.GeoCameraEventAggregator=f}(window.Cesium),function(p){var t=p.GeoCloudPrimitive=function(t){t=t||{},this._height=p.defaultValue(t.height,9e3);var e=p.defaultValue(t.url,"../../../resource/images/cloud.jpg");this._url_0=p.buildModuleUrl(e),this._speedScale=p.defaultValue(t.speedScale,1),this._base=0,this._step=1e-4,this._gamma=p.defaultValue(t.gamma,new p.Cartesian4(.83,1.03,1.4,.25)),this._isInverse=p.defaultValue(t.isInverse,!1),this._animationMatrix=new p.Matrix4,this._radius=null,this._colorTexture_0=null,this._requestUrl=!1,this._requestCommand=!1,this._actived=!0};p.defineProperties(t.prototype,{actived:{get:function(){return this._actived},set:function(t){this._actived=t}},isInverse:{get:function(){return this._isInverse},set:function(t){this._isInverse=t}},redGamma:{get:function(){return this._gamma.x},set:function(t){t=p.Math.clamp(t,0,2),this._gamma.x=t}},greenGamma:{get:function(){return this._gamma.y},set:function(t){t=p.Math.clamp(t,0,2),this._gamma.y=t}},blueGamma:{get:function(){return this._gamma.z},set:function(t){t=p.Math.clamp(t,0,2),this._gamma.z=t}},alphaGamma:{get:function(){return this._gamma.w},set:function(t){t=p.Math.clamp(t,0,1),this._gamma.w=t}},speedScale:{get:function(){return this._speedScale},set:function(t){this._speedScale=t}},url:{set:function(t){var e=p.defaultValue(t,"../../../resource/images/10.jpg");this._url_0=p.buildModuleUrl(e),this._colorTexture_0&&(this._colorTexture_0.destroy(),this._colorTexture_0=null)}}}),t.prototype._isTexturesReady=function(){return!!this._colorTexture_0},t.prototype._createTexture=function(t){var e=this;e._context=t,e._requestUrl||e._colorTexture_0||(e._requestUrl=!0,p.when(p.Resource.fetchImage({url:this._url_0})).then(function(t){e._colorTexture_0=new p.Texture({context:e._context,source:t,pixelFormat:p.PixelFormat.RGBA,pixelDatatype:p.PixelDatatype.UNSIGNED_BYTE})}).otherwise(function(t){console.log("CloudPrimitive fetchImage is failed!")}))},t.prototype.update=function(t){if(this._actived&&t.passes.render){var e=t.commandList,i=t.context;this._createTexture(i),this._isTexturesReady()&&(this._drawCommand||this._timeoutWorkerCommand(i),this._drawCommand&&(this._updateAnimationMatrix(),e.push(this._drawCommand)))}};var r=new p.Quaternion,n=new p.Matrix3;t.prototype._updateAnimationMatrix=function(){var t=this._base*p.Math.TWO_PI;this._isInverse&&(t=-t);var e=p.Quaternion.fromAxisAngle(p.Cartesian3.UNIT_Z,t,r),i=p.Matrix3.fromQuaternion(e,n);this._animationMatrix=p.Matrix4.fromRotationTranslation(i,void 0,this._animationMatrix),this._base+=this._step*this._speedScale,1<this._base&&(this._base=0)},t.prototype._timeoutWorkerCommand=function(t){var e=this;setTimeout(function(){e._createCommandByWorker(t)},500)};t.prototype._createCommandByWorker=function(t){var g=this;if(!g._requestCommand){g._requestCommand=!0;var u=t,e=g._height+p.Ellipsoid.WGS84.radii.x+15e4;g._radius=e;var i=new Blob(["var PI = Math.PI;\nvar TWO_PI = PI * 2.0;\nvar PI_OVER_TWO = PI / 2.0;\nonmessage = function (e) {\n   var params = e.data;\n   var xCount = params.xCount;\n   if (!xCount){\n       postMessage({error:true});\n       return;\n   }\n   var yCount = params.yCount;\n   if (!yCount){\n       postMessage({error:true});\n       return;\n   }\n   var radius = params.radius;\n   if (!radius){\n       postMessage({error:true});\n       return;\n   }\n   var pointsCount = (xCount + 1) * (yCount - 1) + 2 * xCount;\n   var pointsArray = new Float32Array(3 * pointsCount);\n   var texcoordArray = new Float32Array(2 * pointsCount);\n   var ptIndex = 0;\n   var tcIndex = 0;\n   var hFovRad = PI * 2.0;\n   var vFovRad = PI;\n   var angleH = 0;\n   var angelV = 0;\n   var stepHRad = hFovRad / xCount;\n   var stepVRad = vFovRad / yCount;\n   for (var F = 0; F < xCount; F++){\n       pointsArray[ptIndex ++] = 0.0;\n       pointsArray[ptIndex ++] = 0.0;\n       pointsArray[ptIndex ++] = -radius;\n       texcoordArray[tcIndex ++] = F / xCount + 1 / (xCount * 2.0);\n       texcoordArray[tcIndex ++] = 0.0;\n   }\n   var startHRad = -PI;\n   var startVRad = -PI_OVER_TWO + stepVRad;\n   var tt = 0.0;\n   for (var U = 0; U < yCount - 1; U++) {\n       angelV = startVRad + U * stepVRad;\n       for (var F = 0; F < xCount + 1; F++) {\n           angleH = startHRad + F * stepHRad;\n           pointsArray[ptIndex ++] = radius * Math.cos(angelV) * Math.cos(angleH);\n           pointsArray[ptIndex ++] = radius * Math.cos(angelV) * Math.sin(angleH);\n           pointsArray[ptIndex ++] = radius * Math.sin(angelV);\n           tt = 0.5 + angleH / hFovRad;\n           texcoordArray[tcIndex ++] = tt;\n           texcoordArray[tcIndex ++] = (U + 1) / yCount;\n       }\n   }\n   for (var F = 0; F < xCount; F++){\n       pointsArray[ptIndex ++] = 0.0;\n       pointsArray[ptIndex ++] = 0.0;\n       pointsArray[ptIndex ++] = radius;\n       texcoordArray[tcIndex ++] = F / xCount + 1 / (xCount * 2.0);\n       texcoordArray[tcIndex ++] = 1.0;\n   }\n   var faceIndexCount = (xCount * (yCount - 2) + xCount) * 6;\n   var faceIndexArray = new Uint16Array(faceIndexCount);\n   var faceIndex = 0;\n   for (var F = 0; F < xCount; F ++){\n       faceIndexArray[faceIndex ++] = F;\n       faceIndexArray[faceIndex ++] = F + xCount + 1;\n       faceIndexArray[faceIndex ++] = F + xCount;\n   }\n   for (var U = 0; U < yCount - 2; U ++){\n       for (var F = 0; F < xCount; F ++){\n           faceIndexArray[faceIndex ++] = F + xCount + U * (xCount + 1);\n           faceIndexArray[faceIndex ++] = F + xCount + 1 + U * (xCount + 1);\n           faceIndexArray[faceIndex ++] = F + xCount + 1 + (U + 1) * (xCount + 1);\n           faceIndexArray[faceIndex ++] = F + xCount + U * (xCount + 1);\n           faceIndexArray[faceIndex ++] = F + xCount + 1 + (U + 1) * (xCount + 1);\n           faceIndexArray[faceIndex ++] = F + xCount + (U + 1) * (xCount + 1);\n       }\n   }\n   for (var F = 0; F < xCount; F ++){\n       faceIndexArray[faceIndex ++] = F + xCount + (yCount - 2) * (xCount + 1);\n       faceIndexArray[faceIndex ++] = F + xCount + 1 + (yCount - 2) * (xCount + 1);\n       faceIndexArray[faceIndex ++] = pointsCount - (xCount - F);\n   }\n   postMessage({\n       pointsArray: pointsArray,\n       texcoordArray: texcoordArray,\n       faceIndexArray: faceIndexArray\n   }, [pointsArray.buffer, texcoordArray.buffer, faceIndexArray.buffer]);\n};\nonerror = function(error){\n   debugger;\n}"],{type:"application/javascript"}),d=new Worker(URL.createObjectURL(i));d.onmessage=function(t){var e=t.data.pointsArray,i=t.data.texcoordArray,r=t.data.faceIndexArray,n=p.Buffer.createIndexBuffer({context:u,typedArray:r,usage:p.BufferUsage.STATIC_DRAW,indexDatatype:p.IndexDatatype.UNSIGNED_SHORT}),o=[],a=p.Buffer.createVertexBuffer({context:u,typedArray:e,usage:p.BufferUsage.STATIC_DRAW});o.push({index:0,vertexBuffer:a,componentsPerAttribute:3,componentDatatype:p.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:12,normalize:!1});var s=p.Buffer.createVertexBuffer({context:u,typedArray:i,usage:p.BufferUsage.STATIC_DRAW});o.push({index:1,vertexBuffer:s,componentsPerAttribute:2,componentDatatype:p.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:8,normalize:!1});var l=new p.VertexArray({context:u,attributes:o,indexBuffer:n}),h=new p.DrawCommand({owner:g,primitiveType:p.PrimitiveType.TRIANGLES});h.vertexArray=l;var c={cull:{enabled:!1},depthMask:!1,depthTest:{enabled:!0},blending:{color:p.Color.WHITE,enabled:!0,equationRgb:p.WebGLConstants.FUNC_ADD,equationAlpha:p.WebGLConstants.FUNC_ADD,functionSourceRgb:p.WebGLConstants.ONE,functionDestinationRgb:p.WebGLConstants.ZERO,functionSourceAlpha:p.WebGLConstants.ZERO,functionDestinationAlpha:p.WebGLConstants.ONE}};h.renderState=p.RenderState.fromCache(c),h.shaderProgram=g._createShaderProgram(u),h.uniformMap={u_colorTexture_0:function(){return g._colorTexture_0},u_animationMatrix:function(){return g._animationMatrix},u_gamma:function(){return g._gamma}},h.pass=p.Pass.TRANSLUCENT,h.cull=!1,h.boundingVolume=new p.BoundingSphere(p.Cartesian3.ZERO,g._radius),h._card="GeoCloudPrimitive",g._drawCommand=h,d.terminate()},d.onerror=function(t){},d.postMessage({xCount:36,yCount:36,radius:e})}},t.prototype._createShaderProgram=function(t){var e="";e=function(t){return t+="        void main()\n        {\n            vec4 p = vec4(a_position, 1.0);\n            v_texcoord_0 = a_texcoord_0;\n            gl_Position = czm_modelViewProjection * u_animationMatrix * p;\n        }\n        "}(e=function(t){return t+="        attribute vec3 a_position;\n        attribute vec2 a_texcoord_0;\n        uniform mat4 u_animationMatrix;\n        varying vec2 v_texcoord_0;\n        "}(e));var i="";i=function(t){return t+="        float computeW(vec4 color){\n            float w = color.w;\n            if (w == 1.0){\n                //w = min(min(color.r, color.g), color.b);\n                w = sin(color.r * color.g * color.b * 1.5707963);\n            }\n            w = pow(w, u_gamma.w * 10.0);\n            return w;\n        }\n        void main()\n        {\n            vec4 color_0 = texture2D(u_colorTexture_0, v_texcoord_0);\n            color_0.w = computeW(color_0);\n            color_0.rgb *= u_gamma.xyz;\n            gl_FragColor = color_0;\n        }\n        "}(i=function(t){return t+="        uniform sampler2D u_colorTexture_0;\n        uniform vec4 u_gamma;\n        varying vec2 v_texcoord_0;\n        "}(i));return p.ShaderProgram.replaceCache({context:t,shaderProgram:void 0,vertexShaderSource:e,fragmentShaderSource:i,attributeLocations:{a_position:0,a_texcoord_0:1}})}}(window.Cesium),function(u){function t(t,e){if(!u.defined(t))throw new DeveloperError("viewer is required.");if(this._viewer=t,e=u.defaultValue(e,u.defaultValue.EMPTY_OBJECT),!u.defined(e.center))throw new DeveloperError("center is required.");this._center=e.center,this._height=u.defaultValue(e.height,u.GeoDynamicCircle.DEFAULT_HEIGHT),this._radius=u.defaultValue(e.radius,u.GeoDynamicCircle.DEFAULT_RADIUS),this._color=u.defaultValue(e.color,u.GeoDynamicCircle.DEFAULT_COLOR);var i=this._center.x,r=this._center.y,n=u.defaultValue(this._center.z,0),o=u.defaultValue(this._radius,0),a=this._color;this._bottomEllipse=null,this._waveEllipse=null,this._createDynamicCircle(i,r,n,o,a)}t.prototype.removeAll=function(){if(this._viewer){var t=this._viewer.entities;t.remove(this._bottomEllipse),t.remove(this._waveEllipse)}},t.prototype.setColor=function(t){this._color=u.defaultValue(t,u.GeoDynamicCircle.DEFAULT_COLOR),this._bottomEllipse.ellipse.material.color=this._color,this._waveEllipse.ellipse.material.color=this._color},t.prototype.getColor=function(){return this._color},t.prototype.setRadius=function(t){this._radius=u.defaultValue(t,u.GeoDynamicCircle.DEFAULT_RADIUS),this._bottomEllipse.ellipse.semiMajorAxis=this._radius,this._bottomEllipse.ellipse.semiMajorAxis=this._radius,this._waveEllipse.ellipse.semiMajorAxis=this._radius,this._waveEllipse.ellipse.semiMajorAxis=this._radius},t.prototype.getRadius=function(){return this._radius},t.prototype.setCenter=function(t){if(!u.defined(t))throw new DeveloperError("position is required.");this._bottomEllipse.position=position,this._waveEllipse.position=position,this._center=position},t.prototype._createDynamicCircle=function(t,e,i,r,n){var o=this._viewer,a=u.Math.toRadians(30),s=0;if(!this._bottomEllipse){var l=o.entities.add({position:u.Cartesian3.fromDegrees(t,e,i),ellipse:{semiMinorAxis:r,semiMajorAxis:r,material:new u.ImageMaterialProperty({color:n,image:function(){var t=document.createElement("canvas");t.width=512,t.height=512;var e=t.getContext("2d"),i=e.createRadialGradient(256,256,0,256,256,256);return i.addColorStop(.1,"rgba(255, 255, 255, 1.0)"),i.addColorStop(.2,"rgba(255, 255, 255, 0.0)"),i.addColorStop(.3,"rgba(255, 255, 255, 0.9)"),i.addColorStop(.5,"rgba(255, 255, 255, 0.0)"),i.addColorStop(.9,"rgba(255, 255, 255, 0.2)"),i.addColorStop(1,"rgba(255, 255, 255, 1.0)"),e.clearRect(0,0,512,512),e.beginPath(),e.arc(256,256,256,0,2*Math.PI,!0),e.fillStyle=i,e.fill(),e.restore(),t}(),transparent:!0})}});this._bottomEllipse=l}if(!this._waveEllipse){var h=o.entities.add({position:u.Cartesian3.fromDegrees(t,e,i),name:"Wave ellipse on surface",ellipse:{semiMinorAxis:new u.CallbackProperty(g,!1),semiMajorAxis:new u.CallbackProperty(g,!1),rotation:new u.CallbackProperty(c,!1),stRotation:new u.CallbackProperty(c,!1),material:new u.ImageMaterialProperty({color:n,image:function(){var t=document.createElement("canvas");t.width=512,t.height=512;var e=t.getContext("2d");return e.clearRect(0,0,512,512),e.strokeStyle="rgb(255, 255, 255)",e.setLineDash([80,80]),e.lineWidth=30,e.arc(256,256,241,0,2*Math.PI,!0),e.stroke(),t}(),transparent:!0})}});this._waveEllipse=h}function c(){return a+=.05}function g(){return 25e3<=(s+=250)&&(s=0),s}},u.GeoDynamicCircle=t,u.GeoDynamicCircle.DEFAULT_HEIGHT=0,u.GeoDynamicCircle.DEFAULT_RADIUS=25e3,u.GeoDynamicCircle.DEFAULT_COLOR=u.Color.WHITE}(window.Cesium),function(u){var e=u.defaultValue;function t(t){t=e(t,e.EMPTY_OBJECT),this.viewer=t.viewer,this.scene=this.viewer.scene,this.scene.screenSpaceCameraController.enableGeoLocateRatate=!1,this.primitives=this.scene.primitives,this.topCylinderColor=e(t.topCylinderColor,new u.Color(1,0,0,.5)),this.bottomCylinderColor=e(t.bottomCylinderColor,new u.Color(0,1,0,.5)),this.createPrestrainPrimitive(),this.active()}function d(t,e,i,r){return new u.GeometryInstance({geometry:new u.EllipseGeometry({center:t,semiMajorAxis:e,semiMinorAxis:i,height:r,vertexFormat:u.EllipsoidSurfaceAppearance.VERTEXT_FORMAT})})}function p(t,e,i,r,n,o,a,s,l,h){return new u.GeometryInstance({geometry:new u.CylinderGeometry({length:t,topRadius:e,bottomRadius:i,vertexFormat:u.VertexFormat.POSITION_AND_NORMAL}),attributes:{color:new u.ColorGeometryInstanceAttribute(r,n,o,a)},modelMatrix:u.Matrix4.multiplyByTranslation(u.Transforms.eastNorthUpToFixedFrame(u.Cartesian3.fromDegrees(s,l,h)),new u.Cartesian3(0,0,0),new u.Matrix4)})}function C(t,e){return new u.Primitive({allowPicking:!0,geometryInstances:t,vertexCacheOptimize:!0,appearance:e,interleave:!0,asynchronous:!1,cull:!1,releaseGeometryInstances:!0,show:!0})}u.defineProperties(t.prototype,{}),t.prototype.createPrestrainPrimitive=function(){var t=d(u.Cartesian3.UNIT_X,1e-4,1e-4,1e-4);this.ellipseAppearance=function(t){return new u.EllipsoidSurfaceAppearance({translucent:!0,material:new u.Material({fabric:{type:"Image",uniforms:{image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAA6E2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS41LWMwMTQgNzkuMTUxNDgxLCAyMDEzLzAzLzEzLTEyOjA5OjE1ICAgICAgICAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgICAgICAgICAgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIgogICAgICAgICAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgICAgICAgICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIj4KICAgICAgICAgPHhtcDpDcmVhdG9yVG9vbD5BZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpPC94bXA6Q3JlYXRvclRvb2w+CiAgICAgICAgIDx4bXA6Q3JlYXRlRGF0ZT4yMDE5LTA2LTExVDA5OjQ2OjU3KzA4OjAwPC94bXA6Q3JlYXRlRGF0ZT4KICAgICAgICAgPHhtcDpNb2RpZnlEYXRlPjIwMTktMDYtMTFUMTA6MTY6NTMrMDg6MDA8L3htcDpNb2RpZnlEYXRlPgogICAgICAgICA8eG1wOk1ldGFkYXRhRGF0ZT4yMDE5LTA2LTExVDEwOjE2OjUzKzA4OjAwPC94bXA6TWV0YWRhdGFEYXRlPgogICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3BuZzwvZGM6Zm9ybWF0PgogICAgICAgICA8cGhvdG9zaG9wOkNvbG9yTW9kZT4zPC9waG90b3Nob3A6Q29sb3JNb2RlPgogICAgICAgICA8cGhvdG9zaG9wOklDQ1Byb2ZpbGU+c1JHQiBJRUM2MTk2Ni0yLjE8L3Bob3Rvc2hvcDpJQ0NQcm9maWxlPgogICAgICAgICA8eG1wTU06SW5zdGFuY2VJRD54bXAuaWlkOjNkNWU2OTU5LTZiOTMtZTQ0Mi1hNmFkLWVhMmExOWQxZGI0MTwveG1wTU06SW5zdGFuY2VJRD4KICAgICAgICAgPHhtcE1NOkRvY3VtZW50SUQ+eG1wLmRpZDo5ODQ4MzQ2Ny03Mjg5LTUzNGQtOTUyOC05MGY3MWU0MTEwMmU8L3htcE1NOkRvY3VtZW50SUQ+CiAgICAgICAgIDx4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ+eG1wLmRpZDo5ODQ4MzQ2Ny03Mjg5LTUzNGQtOTUyOC05MGY3MWU0MTEwMmU8L3htcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD4KICAgICAgICAgPHhtcE1NOkhpc3Rvcnk+CiAgICAgICAgICAgIDxyZGY6U2VxPgogICAgICAgICAgICAgICA8cmRmOmxpIHJkZjpwYXJzZVR5cGU9IlJlc291cmNlIj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmFjdGlvbj5jcmVhdGVkPC9zdEV2dDphY3Rpb24+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDppbnN0YW5jZUlEPnhtcC5paWQ6OTg0ODM0NjctNzI4OS01MzRkLTk1MjgtOTBmNzFlNDExMDJlPC9zdEV2dDppbnN0YW5jZUlEPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6d2hlbj4yMDE5LTA2LTExVDA5OjQ2OjU3KzA4OjAwPC9zdEV2dDp3aGVuPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6c29mdHdhcmVBZ2VudD5BZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpPC9zdEV2dDpzb2Z0d2FyZUFnZW50PgogICAgICAgICAgICAgICA8L3JkZjpsaT4KICAgICAgICAgICAgICAgPHJkZjpsaSByZGY6cGFyc2VUeXBlPSJSZXNvdXJjZSI+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDphY3Rpb24+c2F2ZWQ8L3N0RXZ0OmFjdGlvbj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0Omluc3RhbmNlSUQ+eG1wLmlpZDozZDVlNjk1OS02YjkzLWU0NDItYTZhZC1lYTJhMTlkMWRiNDE8L3N0RXZ0Omluc3RhbmNlSUQ+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDp3aGVuPjIwMTktMDYtMTFUMTA6MTY6NTMrMDg6MDA8L3N0RXZ0OndoZW4+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDpzb2Z0d2FyZUFnZW50PkFkb2JlIFBob3Rvc2hvcCBDQyAoV2luZG93cyk8L3N0RXZ0OnNvZnR3YXJlQWdlbnQ+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDpjaGFuZ2VkPi88L3N0RXZ0OmNoYW5nZWQ+CiAgICAgICAgICAgICAgIDwvcmRmOmxpPgogICAgICAgICAgICA8L3JkZjpTZXE+CiAgICAgICAgIDwveG1wTU06SGlzdG9yeT4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgICAgPHRpZmY6WFJlc29sdXRpb24+NzIwMDAwLzEwMDAwPC90aWZmOlhSZXNvbHV0aW9uPgogICAgICAgICA8dGlmZjpZUmVzb2x1dGlvbj43MjAwMDAvMTAwMDA8L3RpZmY6WVJlc29sdXRpb24+CiAgICAgICAgIDx0aWZmOlJlc29sdXRpb25Vbml0PjI8L3RpZmY6UmVzb2x1dGlvblVuaXQ+CiAgICAgICAgIDxleGlmOkNvbG9yU3BhY2U+MTwvZXhpZjpDb2xvclNwYWNlPgogICAgICAgICA8ZXhpZjpQaXhlbFhEaW1lbnNpb24+NjQ8L2V4aWY6UGl4ZWxYRGltZW5zaW9uPgogICAgICAgICA8ZXhpZjpQaXhlbFlEaW1lbnNpb24+NjQ8L2V4aWY6UGl4ZWxZRGltZW5zaW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKPD94cGFja2V0IGVuZD0idyI/Pu16zW8AAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAEbhJREFUeNrsW3t0VPWd//x+9955ZDKTyeRNnrxCXEGEgAqyQXqEWmtdtbj0gVsaaVfWB6tSjh5r67J2j0qhPrrWcnqaLisKVK0bLdsKIiBGBOVhSYiERwghk5AQ8pqZ3Dv3/r77x/yGjrOZyUSC7jnu95zfyeP+Ht/f5/5+3/dlRIQvM3F8yenzACAPwDIAc0cwZhyABwBUXGrm1Es4dz6AbwGYB+BvAPzrCMZ6AHwfwE0A3gewGcChS8EkuwQy4DYA1QBKAZwDsA/AWwB2AwiN4GRWArgRwLUACgB0A3gNwDP/VwH4HoD7ANgB/BnAbwHUj9Lc2QDuBPB3AHwAXgHw41GZmYguts0mov1EdISIVozCfMO1hUT0ARE1EdGdFzvfxTKzjoi6ieipz2Hj8W0JEZ0moneJKOPzBiCfiE4Q0SEiKv0CNh/bXiaiEBF97bOM/ywyYB6APwFYB+DeEYzzAZgG4DKp5nwAFPlMABgA0AzgKIADAFpGMPcdAH4H4LERapsRn4BvUoS+l2J/HxEtJaI3iaiXUieLiN4jooeJaGKKa11GRANE9ItLdQVulszNSaFvERE9TUQ9iXZomqZlGIZpGIZlGIY5DCCvSWE73LppRNRBRGtG+wrMBLBXWnO7hun7UwAPAXDE/M+sq6s7vmfPnuaGhgZ/a2tr/7lz53TTNIkxxgCQ1+vVxowZk15eXp47c+bM0qqqqvEulys9bu71cm5/kvVdADoB/ATAz0fDDvDKCX8IoCZJvyskg1Oj//D7/Z01NTUf1NbW1h88eNCv67oBQOGca3a7XeGcI7q+YRjCNE0TQBgAr6ioyLnhhhsmLV68eEZlZeWEmHX6APwjgI1JeJkAoAnAfADbLhaAj+XbX5qkz3cAbLjwuk1z8LHHHvvjunXr9nZ2dp5XFMWTm5vrstvtXModBoDFiyPGGMnx1N3dPRgMBns1TbMtWrRoyqpVq24cO3bsmJj+qwGsTMLTrdJy9ADo/6wAPCIdmaIkfR4AsCb6x7Zt2w7de++9f2hsbDzjdruzc3JynEIIQUQqgHR5Naxij9s2PsOT7rQM5VjfQH/TQCgktYIpGTYUReEDAwPm2bNnz2ZkZLgef/zxr95zzz0LYtZ+CcB3k/D2nwBKkjliyQAoAnAawBQAhxP0uRvAL6N/rFmzZsuKFStqATjHjRvnE0KYROQAkCn9gBYAJwG0PVKcWzY1M+M6h6JkHusPvPPAsdP7pANVJptXAtGvqqra3t4eCAQCnXfcccc169ev/36MI/eyPIGJKCCv74aRAvA2gDapY4eimwC8Ef3jwQcffHnt2rVbMzMzC3w+n900TZKucEA6RB/W3TTvOBgD0zToRw7foR9peJQrWqlWNvZRraT0KTJNgAhzdh/IkzbDLOkIdXLOjXA4zFpbW1vnzp07cevWrcs1TbPL5X8O4EcJ+LwdwAsAskYSD7haSv4fJnheAKA2+sfDDz+8ee3atdvy8/OLvV6vZpqmDcAYadA8DWDT/oeWH3dMvgKOK66E88pKqJneYqurZ6Le3GkTg4ZHzc6C4s2A4s3A+zdd1yGNrdXSk8wQQnhVVbXKyspKdu7ceXzBggXPArAkCysA3JKA199LrbFqJAD8Qh6tRO5rbVSI1dTU7HziiSf+nJeXV+h0OiGEcEvBs1lai60AYLafiTR/K8JtLTarv6+YGCAEQIKXkBAVZFo2CpugsBldZ0B6fr8CoBNRLoBwWVlZ4Y4dO45WV1f/R9xGvQn4/RGAf0oVgHEAxkp9OxQtATADAI4cOXKqurp6o8fjyXW5XFxu3gHg1/HqJ7h/T7R5Qvveuz58+uQk6FL8G+HJYlCvIgE7MQX0v9mql8e8h4jyAFiFhYVFNTU1u2tqanbGBHfWJeD5vwG0A7gnFQAeAvAhgPNDPNPkkQYAWrp06UYAak5OjtOyLLt88+uk6vwUmaeaI635pMc4eaLK6usdz5yAogFWZ+v4cMuxK3m6Q1NzfFAyPUNtokuezBARZdpsNkpPT8+97777Xvf7/V0x9/2KBCDUyCjTsADMTWLwLAOQAQDr169/t66urqm0tDTHNE0BIEfq3Y+HNM+uW4D0r94Mx7SrMkiIKhEIljAVUDIBq/+8xzjdMoMBecxmA1OURIK5W54uuxDClpeX5xoYGAg98sgjb8T0eTLB2BekAzYpGQDXyp+vJdH5ICJz9erVOzVN83LOhYzYHJGRoKGDj3kF0AqLoXgyJtLAwAQYAszOwNI0kA5YXQFP+GzHlHDrKY/RcjKZbXJMCsZc0zTNnJyc3BdffPFAU1NTq3x+QwK7JSBVcHUyAL4rOw1F18g4H2praw8cPnz4TEFBgVsIoch5XkvGdejghwgd+rBcP940R/QEXOAAc6gAY4AJUMDyit7+vwVDCfdmDGedbpF3Ot3tdqvhcNhYt25dXVx4bijaCaBKmspDAjA9ibOzKPrLpk2bDgLQOOdRP/+g9OUTkggFYDQfqzSaPqkSuqlBYQDngACYBpAYzDLbz8xnmlZqGzt2OAAMuRmvZVkiLS3N++abbzbouh7VWt9Mor2yASxMBMDSJFHXrwBAT09Pb11d3SmPx+ORRpQqDZ2k5Jw5C6rbPZkCfdOgQAVnkTAIAJ6pgKm6qh87Osns6ipNMV2xTwpqm8/nczY2Nnbt2rWrST6bJu2QeDog7YXfJwLgsLwr8ZQDYDIA7N27t7mlpaXX4/FoUuV1yChOUhLBwBirp28K6brKnWBMkwAQwO0M4IDoBUSQplJYTEoBgF4AxwG4VVUFALFnz57mOGNuKKqX40aUGKmIgtXQ0NBORJaqqoyI0qTbGRxugv4d7/xDuKmtQnQDzEkAWZHGAMYBywBMAejNLTcyTi0AfpYCX80ApsmTqDU2Np6NeZYKiCkDcEGqnjlzpj/Gh1BlrGBYKszUzgyUF+4z9IIuxcHPCzDBAHAOUlRuWSHdEQ7odueEMW32orxPcOCTVKbtkN4jUxRF8/v9AzHPikcTgAuWSXd3dzhOiwRTmcCVQVudqnoQYZ7GbUwnzgVxBs4AaAohCIX6LZVl2wLwOc6myFcwCoDdbmc9PT1hy7KEoig8ludRzQ3KYManrncq4zb1TW4Ph1m7SRwAg2AcBEABQVEYzNAgwrqBzEAx0vuyU2XnwtqRyBqYEAJKYkPqMwPAYgD4TLm05T3XFrmddpdiU7lOsAQxBgEwEuCWgG6EedgSfFzIo2f3Oc8lMMWHezk0FM+jAYB1wRnQtNiJKSa2n5SKHcZSZuqzLJNl2zjvFWAMBMaIiDOCzdBdImxxj6WccAu8BOD1FPlnACCEgKqqTFEUFs/zaADQfUEf5uTYZfwORCQAuFOZYHJ5vvr2lg8mnT7dWcrcOZZ8ZRH+VQUUDCjcHDQ1jHOEzZzcFPlyyz2QrusiKyvLxjln8TyPBgCnLrzJ4uKMaEJFRnDzU5lg2pVFGz/6+NRXTncZpU63TdEUDi7lAFc4Bp0KINyC2R1vChJvpchXAQCFMUZCCKOwsNATpyJTysOnQo1RaT916tQxmqZp4XCYpNFUImN+yWPr3rQTmT5PPZwOy7QIXFVgd2rQbAoM04RmV5Gd6+lLc9q2M8aaU+RrHIBBeQ3MKVOmFMQZPCMG4FsyGBJPAwA+AoDp06eXlZeXZ/X09AzKE+ADcPmwCDb6RV5W2geluZ5DRm8IpmGBAFiWQDBggCwaTE/TPjQtq30goKfC+xjJ64Cu65bNZrPPmTNnXIyvsHeIMQqAbwO4LhEAj0Zd3iHoLQCw2+2OefPmjQ8Gg33yvgWTmJ0X6Fx3wCwfn7N74rjsAzAFhBDSCmTgjEFV+HFF4X8yDPNsMJgSALMBOBljZmdnZ2D69OkFM2bMGC+f7ZIJlKH8meejEa2hANgcm9mJo5ejvyxevHgGAKbrugDQI83OymTcTqrIM0vLshp9eZ5GxeOEKYDBUBhEBM2mwONxnPT5XNuyfK7urCzXcJvPkrGLLsaYYppm38KFC6+I2c/GJJHsvQB+kwiADQAKE0j24wA+AICrr7560vXXXz+xra2tWxod/TITk1CoGoaFYCgMu11pzc11tUEIMdCvQ9dNKJyhpNh7bOb04voZ04qMyiuLhgNgIQAHY0w/d+5cMDs721tdXT07Gn0DsCnBuFnyJPckAuCYvO9LEkxwwUF59NFH5wPQQ6GQYIz1So8xUSAC7+05ibd3HEVPz2Dz2OLs3RrnvVb3AMIDRrhoTObxMQXew5wzcIUjYskmpCp5hDsYY2pfX1/n/fffPyczMzMaRVkn9xBPpQBy48N9Q630qhQUQ9EbMvSFqqqqy5csWXKV3+9vVxRFlbH3WQC+MdTAvBw3crPTMbY06+SEcdm7HC6tHyAwjetOp7anr09vqD/SjobGDjQeTegKTJa8damqyk6ePNk9adKkwpUrV94Q0+enCcbeD+BEvH0wFABrAYyXKbGh6M7oL88888zf5+fnZ5w4ceK8qqpMhqlulu3TCrvAg4ICD/Lz3B2Zmc73XS77ABw2OF2OQE62e2uG23FIVRRoaqQNQdMRyQoHOOeD3d3dOoBATU3Nt1VVtcVsvisB37dhiHQ5T6Dy3olNeMbR+9Fj5PF43LW1tT8goqDf7w+oqmpKF/UbEqi06KCGI+1oONKOQ385g2PHu7o0RTnPnXZwzvQsb9rHBXme4Ji8DERbHH0dwA8ADHLO+0KhEJ0/f97/3HPPLZw1a1ZFjIxalcgVkY7TllQtwX+WE06UAY94qpa6dOzMmTMnvvLKK0sWLlz4W7/fj4KCApdpmm0ArpJG0lsA3ms44o86LFAUbnrcjsbCPPdVlhBdgaDe390dgG6Y8etcJqO8lwHoUhRFDwQC1NHRcWbFihUL4jLFX0siNx6WexpRcvTf5SZmJnheBuATADYA2Lx58/uLFi1aD8A5fvz4TMuyTCLyylNwTBpSDZVzftwBwMs5+3pPT+iq3t7Qac5ZDSJVpWg/+csMAOUyrjdFWnmdqqryzs7Owb6+vo6VK1cuePLJJxfFGXCJJP8qmTC5bKQAMHkdqpNMfo28EgCA3bt3NyxatGh9W1vb+YKCgnyn08kty4JMpjili9sqZUW/VFlRjzINkWxykdQoFoDznHOLiHhzc3MXAOv555+/ddmyZdfHCbenE/CXK69kJYD9IwUAiNTq/lFuoC9BnznymDsB4Ny5c+eXL1/+yoYNGz4CYCssLPTZbDYuhBDytKTJnzzOZxfStA7Juw4hBFpbW/sty+qdPXv2hGefffbWysrK8pgx9wF4Lgn/hxFJ8y9P+JZTiG/8Th7HqUn6lAP4AyJV4ZHMxZYtH61Zs2bX9u3bjwMQaWlpHq/Xa9c0jUtXeujAg2VRf3+/0dvb2w/AnDx5csFdd901++6774596zoiRRHJkjFPyqtRmjTSk2KApx7AnlgVmODKvIC4moLt27cffvXVVw/u3LnzRFNTU7dhGEaSaA0xxpSSkpKMWbNmldxyyy1Tbr/99umcc3tcdufO2NB2giTORumqd4wGAC5EqkWeSiFcPR/Av0ij6K/Ry2AwsH///pb6+np/S0tLb2dn56BpmtFYHnw+n1ZYWOiuqKjInzZtWnFeXp4vbt4ziFSB/nqY9a9FpDS/CsC7qcTRUm1FRNRPRD9Jsf/tRLSNLp4+JqIHiciRwprziEgQ0W2Xqli6SJa8bhjBmMtlyevbsrJ8OBokon1EtJqI5o5gnbvl+FsudbG0S+blwogUTnePYGyGzMyWIVLOosZogAFEqshOIHkl6FC0AZGPKRYAqBtpKPliytR7R+OjhYto1xDRUSL6CxF5vogPJhYS0Rki2k1E0z7HjfuIaD0RdRHRz77IL0ZivxxpJqLXiejqS7jxQiL6lVxry2h8rDGaH00VSRV5jTR3axEpZe28yHlV6cp+RxpcLQD+DcNXraeW8roEn81lIvIlyXyZoOxApHDqNzK8nuocy6ROL5GW3x5E6gXrR5NZdom/HZ6MSEXGfGnAvJTiuKnSwTkI4L8A7LhUDLL//3j6S05fegD+ZwD3gk1Njxe3yQAAAABJRU5ErkJggg=="}}}),fragmentShaderSource:t})}("varying vec3 v_positionMC;\n\t\t\t\t\tvarying vec3 v_positionEC;\n\t\t\t\t\tvarying vec2 v_st;\n\t\t\t\t\t\n\t\t\t\t\tvoid main()\n\t\t\t\t\t{\n\t\t\t\t\t\tczm_materialInput materialInput;\n\t\t\t\t\t\tvec3 normalEC = normalize(czm_normal3D * czm_geodeticSurfaceNormal(v_positionMC, vec3(0.0), vec3(1.0)));\n\t\t\t\t\t#ifdef FACE_FORWARD\n\t\t\t\t\t\tnormalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n\t\t\t\t\t#endif\n\t\t\t\t\t\tmaterialInput.s = v_st.s;\n\t\t\t\t\t\tmaterialInput.st = v_st;\n\t\t\t\t\t\tmaterialInput.str = vec3(v_st, 0.0);\n\t\t\t\t\t\tmaterialInput.normalEC = normalEC;\n\t\t\t\t\t\tmaterialInput.tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(v_positionMC, materialInput.normalEC);\n\t\t\t\t\t\tvec3 positionToEyeEC = -v_positionEC;\n\t\t\t\t\t\tmaterialInput.positionToEyeEC = positionToEyeEC;\n\t\t\t\t\t\tczm_material material = czm_getMaterial(materialInput);\n\t\t\t\t\t#ifdef FLAT\n\t\t\t\t\t\tgl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n\t\t\t\t\t#else\n\t\t\t\t\t\tgl_FragColor = czm_phong(normalize(positionToEyeEC), material);\n\t\t\t\t\t\tif(gl_FragColor.r==1.0&&gl_FragColor.g==1.0&&gl_FragColor.b==1.0&&gl_FragColor.a==1.0){\n\t\t\t\t\t\t\tgl_FragColor.a = 0.0;\n\t\t\t\t\t\t}\n\t\t\t\t\t#endif\n\t\t\t\t\t}\n\t\t\t\t\t");var e=C(t,this.ellipseAppearance);this.primitives.add(e),this.prestrainEllipsePrimitive=e;var i=C([p(1e-4,1e-4,0,1,0,0,0,0,0,0),p(1e-4,0,1e-4,1,0,0,0,0,0,0)],new u.PerInstanceColorAppearance);this.primitives.add(i),this.prestrainCylinderPrimitive=i},t.prototype.active=function(){var c=null,g=this,t=new u.ScreenSpaceEventHandler(this.scene.canvas);t.setInputAction(function(t){if(!g.viewer.trackedEntity){g.scene.screenSpaceCameraController.enableInputs=!1;var e=void 0;if(e=null==g.scene.pick(t.position)?g.scene.globe.pick(g.viewer.camera.getPickRay(t.position),g.scene):g.scene.pickPosition(t.position)){var i=u.Cartographic.fromCartesian(e),r=u.Math.toDegrees(i.longitude),n=u.Math.toDegrees(i.latitude),o=i.height+.5,a=u.Cartesian3.distance(g.viewer.camera.position,e)/80,s=g.viewer.entities.add({id:"pointEntity",position:e,point:{color:new u.Color(1,1,1,0)}});s.enableGeoLocateRatate=!0,g.viewer.trackedEntity=s,g.scene.screenSpaceCameraController.enableGeoLocateRatate=!0;var l=C(d(e,a,a,o),g.ellipseAppearance);g.primitives.add(l),g.ellipsePrimitive=l;var h=C([p(.3*a,.1*a,0,g.topCylinderColor.red,g.topCylinderColor.green,g.topCylinderColor.blue,g.topCylinderColor.alpha,r,n,o+.2*a),p(.3*a,0,.1*a,g.bottomCylinderColor.red,g.bottomCylinderColor.green,g.bottomCylinderColor.blue,g.bottomCylinderColor.alpha,r,n,o-.2*a)],new u.PerInstanceColorAppearance);g.primitives.add(h),g.cylinderPrimitive=h,g.scene.screenSpaceCameraController.rotateEventTypes=u.CameraEventType.MIDDLE_DRAG,c=setTimeout(function(){g.scene.screenSpaceCameraController.enableInputs=!0},10),g.scene.globe.depthTestAgainstTerrain=!1}}},u.ScreenSpaceEventType.MIDDLE_DOWN),t.setInputAction(function(t){g.viewer.trackedEntity.enableGeoLocateRatate&&(clearTimeout(c),g.prestrainEllipsePrimitive&&g.primitives.remove(g.prestrainEllipsePrimitive),g.prestrainCylinderPrimitive&&g.primitives.remove(g.prestrainCylinderPrimitive),g.ellipsePrimitive&&g.primitives.remove(g.ellipsePrimitive),g.cylinderPrimitive&&g.primitives.remove(g.cylinderPrimitive),g.viewer.entities.removeById("pointEntity"),c=null,g.prestrainEllipsePrimitive=null,g.prestrainCylinderPrimitive=null,g.ellipsePrimitive=null,g.cylinderPrimitive=null,g.viewer.trackedEntity=void 0,g.scene.screenSpaceCameraController.enableGeoLocateRatate=!1,g.scene.screenSpaceCameraController.rotateEventTypes=u.CameraEventType.LEFT_DRAG,g.scene.screenSpaceCameraController.enableInputs=!0)},u.ScreenSpaceEventType.MIDDLE_UP)},u.GeoLocateRatate=t}(window.Cesium),function(T){var o=T.GeoRayPick=function(t,e){if(e=void 0===e||e,this.ready=!1,t){this.ready=!0,this.scene=t,this.isOnly=e;var i=new T.BoundingRectangle(0,0,256,256),r=new T.Camera(t);r.frustum=new T.OrthographicFrustum({width:1,aspectRatio:1,near:.01,far:1e3}),this._pickOffscreenView=new T.View(t,r,i),this.deferred=T.when.defer(),this.promise=this.deferred.promise}};o.prototype.doPick=function(t,e){var i=this;if(!i.ready)return null;var r=null;return i._update(t,e),i.promise.then(function(t){r=i._pick(t)}),r};var r=new T.BoundingSphere;function d(t){var e=t.camera,i=t._frameState;i.commandList.length=0,i.shadowMaps.length=0,i.brdfLutGenerator=t._brdfLutGenerator,i.environmentMap=t.skyBox&&t.skyBox._cubeMap,i.mode=t._mode,i.morphTime=t.morphTime,i.mapProjection=t.mapProjection,i.camera=e,i.cullingVolume=e.frustum.computeCullingVolume(e.positionWC,e.directionWC,e.upWC),i.occluder=function(t){var e=t.globe.ellipsoid;return r.radius=e.minimumRadius,T.Occluder.fromBoundingSphere(r,t.camera.positionWC)}(t),i.terrainExaggeration=t._terrainExaggeration,i.minimumDisableDepthTestDistance=t._minimumDisableDepthTestDistance,i.invertClassification=t.invertClassification,i.useLogDepth=!1,i.sunColor=t._sunColor,t._actualInvertClassificationColor=T.Color.clone(t.invertClassificationColor,t._actualInvertClassificationColor),T.InvertClassification.isTranslucencySupported(t._context)||(t._actualInvertClassificationColor.alpha=1),i.invertClassificationColor=t._actualInvertClassificationColor,i.maximumScreenSpaceError=t.globe.maximumScreenSpaceError,function(t){t.render=!1,t.pick=!1,t.depth=!1,t.postProcess=!1,t.offscreen=!1,t.async=!1}(i.passes)}var p=new T.CullingVolume;function S(t,e,i,r){var n=e._frameState;if(t instanceof T.ClearCommand)t.execute(i,r);else{n.useLogDepth&&T.defined(t.derivedCommands.logDepth)&&(t=t.derivedCommands.logDepth.command);var o=n.passes;if(o.pick||o.depth){if(o.pick&&!o.depth&&T.defined(t.derivedCommands.picking))return void(t=t.derivedCommands.picking.pickCommand).execute(i,r);if(T.defined(t.derivedCommands.depth))return void(t=t.derivedCommands.depth.depthOnlyCommand).execute(i,r)}t.execute(i,r)}}function s(t,e,i){return t.boundingVolume.distanceSquaredTo(i)-e.boundingVolume.distanceSquaredTo(i)+T.Math.EPSILON12}function M(t,e,i,r){var n=t.context;T.mergeSort(r,s,t.camera.positionWC);for(var o=r.length,a=0;a<o;++a)e(r[a],t,n,i)}var D=new T.OrthographicFrustum;function C(t,e,i){var r=t._view;t.frameState.commandList.length=0,function(t){var e=t._frameState;t._groundPrimitives.update(e),t._primitives.update(e),t._globe&&t._globe.render(e)}(t),r.createPotentiallyVisibleSet(t),T.defined(i)&&function(t,e,i){var r=t._context,n=t._environmentState,o=t._view;n.originalFramebuffer=e.framebuffer;var a=t._clearColorCommand;T.Color.clone(i,a.color),a.execute(r,e),n.useGlobeDepthFramebuffer=!0,o.globeDepth.update(r,e,o.viewport,t._hdr),o.globeDepth.clear(r,e,i),n.useOIT=!1,n.usePostProcess=!1,n.usePostProcessSelected=!1,e.framebuffer=o.globeDepth.framebuffer,a.execute(r,e),n.useInvertClassification=!1}(t,e,i),function(t,e){var i=t.camera,r=t.context,n=r.uniformState;n.updateCamera(i);var o=i.frustum.clone(D);o.near=i.frustum.near,o.far=i.frustum.far,n.updateFrustum(o),n.updatePass(T.Pass.ENVIRONMENT);for(var a,s,l,h,c=t._environmentState,g=t._view,u=M,d=c.clearGlobeDepth,p=c.useDepthPlane,C=t._depthClearCommand,m=t._stencilClearCommand,f=t._depthPlane,v=g.frustumCommandsList,A=v.length,I=0;I<A;++I){var _=A-I-1,y=v[_];o.near=0!=_?y.near*t.opaqueFrustumNearOffset:y.near,o.far=y.far,n.updateFrustum(o);var w=g.globeDepth;C.execute(r,e),r.stencilBuffer&&m.execute(r,e),n.updatePass(T.Pass.GLOBE);var P=y.commands[T.Pass.GLOBE],x=y.indices[T.Pass.GLOBE];for(a=0;a<x;++a)S(P[a],t,r,e);for(T.defined(w)&&c.useGlobeDepthFramebuffer&&w.executeCopyDepth(r,e),n.updatePass(T.Pass.TERRAIN_CLASSIFICATION),P=y.commands[T.Pass.TERRAIN_CLASSIFICATION],x=y.indices[T.Pass.TERRAIN_CLASSIFICATION],a=0;a<x;++a)S(P[a],t,r,e);for(n.updatePass(T.Pass.CLASSIFICATION),P=y.commands[T.Pass.CLASSIFICATION],x=y.indices[T.Pass.CLASSIFICATION],a=0;a<x;++a)S(P[a],t,r,e);for(d&&C.execute(r,e),n.updatePass(T.Pass.CESIUM_3D_TILE),P=y.commands[T.Pass.CESIUM_3D_TILE],x=y.indices[T.Pass.CESIUM_3D_TILE],a=0;a<x;++a)S(P[a],t,r,e);for(n.updatePass(T.Pass.CESIUM_3D_TILE_CLASSIFICATION),P=y.commands[T.Pass.CESIUM_3D_TILE_CLASSIFICATION],x=y.indices[T.Pass.CESIUM_3D_TILE_CLASSIFICATION],a=0;a<x;++a)S(P[a],t,r,e);for(n.updatePass(T.Pass.CLASSIFICATION),P=y.commands[T.Pass.CLASSIFICATION],x=y.indices[T.Pass.CLASSIFICATION],a=0;a<x;++a)S(P[a],t,r,e);for(0<x&&r.stencilBuffer&&m.execute(r,e),d&&p&&f.execute(r,e),n.updatePass(T.Pass.OPAQUE),P=y.commands[T.Pass.OPAQUE],x=y.indices[T.Pass.OPAQUE],a=0;a<x;++a)S(P[a],t,r,e);if(0!=_&&(o.near=y.near,n.updateFrustum(o)),n.updatePass(T.Pass.TRANSLUCENT),(P=y.commands[T.Pass.TRANSLUCENT]).length=y.indices[T.Pass.TRANSLUCENT],u(t,S,e,P),r.depthTexture&&t.useDepthPicking&&c.useGlobeDepthFramebuffer){var b=w.framebuffer.depthStencilTexture,E=(s=_,h=l=void 0,l=t._view.pickDepths,h=l[s],T.defined(h)||(h=new T.PickDepth,l[s]=h),h);E.update(r,b),E.executeCopyDepth(r,e)}}}(t,e)}var m=new T.Cartesian3,f=new T.Cartesian3,v=new T.BoundingRectangle,A=new T.Color(0,0,0,0);o.prototype._update=function(t,e){var i=this.scene,r=i._context,n=r.uniformState,o=i._frameState,a=this._pickOffscreenView,s=(i._view=a).camera,l=t.direction,h=T.Cartesian3.cross(l,e,m);T.Cartesian3.normalize(h,h);e=T.Cartesian3.clone(e,f);s.position=t.origin,s.direction=l,s.up=e,s.right=h;var c=T.BoundingRectangle.clone(a.viewport,v),g=a.pickFramebuffer.begin(c,a.viewport);i._jobScheduler.disableThisFrame(),d(i),o.invertClassification=!1,o.passes.pick=!0,o.passes.offscreen=!0,o.passes.async=!1,o.pickEx=!0,n.update(o),function(t){var e=t._frameState,i=t._environmentState;i.skyAtmosphereCommand=void 0,i.skyBoxCommand=void 0,i.sunDrawCommand=void 0,i.sunComputeCommand=void 0,i.moonCommand=void 0,i.clearGlobeDepth=!0,(i.useDepthPlane=!0)&&t._depthPlane.update(e),i.renderTranslucentDepthForPick=!1,i.useWebVR=!1;for(var r=e.cullingVolume,n=p.planes,o=0;o<5;++o)n[o]=r.planes[o];r=p}(i),C(i,g,A),function(t,e){var i=t._context,r=t._environmentState,n=t._view;e.framebuffer=r.originalFramebuffer,n.globeDepth.executeCopyColor(i,e)}(i,g);var u=a.pickFramebuffer.end(c);o.pickEx=!1,i._view=i._defaultView,r.endFrame(),this.deferred.resolve({object:u,ray:t})},o.prototype._pick=function(t){var e,i,r,n,o=t.object,a=t.ray,s=this._pickOffscreenView,l=this.scene,h=l._context;if(h.depthTexture)for(var c=s.frustumCommandsList.length,g=0;g<c;++g){var u=(i=g,n=r=void 0,r=s.pickDepths,n=r[i],T.defined(n)||(n=new T.PickDepth,r[i]=n),n).getDepthEx(h,0,0,s.viewport.width,s.viewport.height,this.isOnly);if(0<u&&u<=1){var d=s.frustumCommandsList[g],p=d.near*(0!==g?l.opaqueFrustumNearOffset:1),C=p+u*(d.far-p);e=T.Ray.getPoint(a,C);break}}return{object:o,position:e}};var I=new T.Cartesian4,_=new T.Cartesian4(1,1/255,1/65025,1/16581375);function a(t,e){if(!T.defined(t._content)||!T.defined(t._content._model)||!t._content._model.ready)return!1;var i=t._boundingVolume;return e.computeVisibilityWithPlaneMask(i,T.CullingVolume.MASK_INDETERMINATE)!==T.CullingVolume.MASK_OUTSIDE}T.PickDepth.prototype.getDepthEx=function(t,e,i,r,n,o){r=void 0!==r?r:1,n=void 0!==n?n:1,o=void 0===o||o;var a=t.readPixels({x:e,y:i,width:r,height:n,framebuffer:this._framebuffer});if(!a)return 0;for(var s=[],l=0;l<r;l++)for(var h=0;h<n;h++){var c=4*h*r+l,g=T.Cartesian4.unpack(a,c,I);T.Cartesian4.divideByScalar(g,255,g);var u=T.Cartesian4.dot(g,_);s.push(u)}var d=Math.floor(.5*r)+Math.floor(.5*n)*r,p=s[d];if(0<p&&p<=1)return p;if(o)return 0;var C=0,m=0;for(l=0;l<r;l++)for(h=0;h<n;h++){c=h*r+l;0<(p=s[d])&&p<1&&(C+=p,m++)}return m<1?0:C/m},T.PickDepth.prototype.getPixelsEx=function(t,e,i,r,n){return r=void 0!==r?r:1,n=void 0!==n?n:1,{arrayBufferView:t.readPixels({x:e,y:i,width:r,height:n,framebuffer:this._framebuffer}),width:r,height:n}},T.PickFramebuffer.prototype.getPixelsEx=function(t,e){return t=void 0!==t?t:1,e=void 0!==e?e:1,{arrayBufferView:this._context.readPixels({x:0,y:0,width:t,height:e,framebuffer:this._fb}),width:t,height:e}},o.pick=function(t,e,i,r){if(r=void 0===r||r,!t)return null;if(t._picker)t._picker.isOnly=r;else{var n=new o(t,r,"watchPlane");t._picker=n,T.Scene.prototype._originalDestory=T.Scene.prototype.destroy,T.Scene.prototype.destroy=function(){this._picker&&(this._picker.destroy(),this._picker=null),this._originalDestory()},T.Cesium3DTile.prototype._visibility_Old=T.Cesium3DTile.prototype.visibility,T.Cesium3DTile.prototype.visibility=function(t,e){var i=t.cullingVolume,r=function(t,e){if(e.mode!==T.SceneMode.SCENE3D&&!T.defined(t._boundingVolume2D)){var i=t._boundingVolume.boundingSphere,r=T.BoundingSphere.projectTo2D(i,e.mapProjection,l);t._boundingVolume2D=new T.TileBoundingSphere(r.center,r.radius)}return e.mode!==T.SceneMode.SCENE3D?t._boundingVolume2D:t._boundingVolume}(this,t),n=this._tileset,o=n.clippingPlanes;if(T.defined(o)&&o.enabled){var a=o.computeIntersectionWithBoundingVolume(r,n.clippingPlanesOriginMatrix);if(this._isClipped=a!==Intersect.INSIDE,a===Intersect.OUTSIDE)return CullingVolume.MASK_OUTSIDE}return t.camera.__proto__._hookUpdate&&!0===t.pickEx?function(t,e,i){if(i===T.CullingVolume.MASK_OUTSIDE||i===T.CullingVolume.MASK_INSIDE)return i;for(var r=T.CullingVolume.MASK_INSIDE,n=t.planes,o=0,a=n.length;o<a;++o){var s=o<31?1<<o:0;if(!(o<31&&0==(i&s))){var l=c(e._orientedBoundingBox,T.Plane.fromCartesian4(n[o],h));if(l===T.Intersect.OUTSIDE)return T.CullingVolume.MASK_OUTSIDE;l===T.Intersect.INTERSECTING&&(r|=s)}}return r}(i,r,e):i.computeVisibilityWithPlaneMask(r,e)}}return t._picker.doPick(e,i)},o.prototype.destroy=function(){this.scene=null,this._pickOffscreenView.destroy(),this._pickOffscreenView=null,T.Cesium3DTile.prototype._visibility_Old&&(T.Cesium3DTile.prototype.visibility=T.Cesium3DTile.prototype._visibility_Old,delete T.Cesium3DTile.__proto__._visibility_Old)},T.Cesium3DTileset.prototype._originalUpdate=T.Cesium3DTileset.prototype.update,T.Cesium3DTileset.prototype.update=function(t){!0===t.passes.pick&&!0===t.pickEx?this._updatePicked(t):this._originalUpdate(t)},T.Cesium3DTileset.prototype._updatePicked=function(t){var e,i,r=this._selectedTiles,n=r.length,o=t.cullingVolume;for(e=0;e<n;++e)(i=r[e])&&a(i,o)&&i.update(this,t)};var l=new T.BoundingSphere;var h=new T.Plane(new T.Cartesian3,0);function c(t,e){var i=t.center,r=e.normal,n=t.halfAxes,o=r.x,a=r.y,s=r.z,l=Math.abs(o*n[T.Matrix3.COLUMN0ROW0]+a*n[T.Matrix3.COLUMN0ROW1]+s*n[T.Matrix3.COLUMN0ROW2])+Math.abs(o*n[T.Matrix3.COLUMN1ROW0]+a*n[T.Matrix3.COLUMN1ROW1]+s*n[T.Matrix3.COLUMN1ROW2])+Math.abs(o*n[T.Matrix3.COLUMN2ROW0]+a*n[T.Matrix3.COLUMN2ROW1]+s*n[T.Matrix3.COLUMN2ROW2]),h=T.Cartesian3.dot(r,i)+e.distance;return h<=-(l*=2)?T.Intersect.OUTSIDE:l<=h?T.Intersect.INSIDE:T.Intersect.INTERSECTING}}(window.Cesium),function(rt){var nt=rt.Cartesian2,ot=rt.Cartesian3,at=rt.Cartesian4,i=rt.Cartographic,I=rt.defaultValue,st=rt.defined,t=rt.destroyObject,r=rt.DeveloperError,B=rt.Ellipsoid,e=rt.HeadingPitchRoll,N=rt.IntersectionTests,p=rt.isArray,n=rt.KeyboardEventModifier,lt=rt.Math,V=rt.Matrix3,z=rt.Matrix4,ht=rt.OrthographicFrustum,G=rt.Plane,U=rt.Quaternion,F=rt.Ray,H=rt.Transforms,o=rt.CameraEventAggregator,a=rt.CameraEventType,s=rt.MapMode2D,ct=rt.SceneMode,gt=rt.SceneTransforms,l=rt.TweenCollection;function h(t){if(!st(t))throw new r("scene is required.");this.constrainedPitch=-lt.PI_OVER_SIX,this.enableInputs=!0,this.enableTranslate=!0,this.enableZoom=!0,this.enableRotate=!0,this.enableTilt=!0,this.enableLook=!0,this.inertiaSpin=.9,this.inertiaTranslate=.9,this.inertiaZoom=.8,this.maximumMovementRatio=.1,this.bounceAnimationTime=3,this.minimumZoomDistance=1,this.maximumZoomDistance=Number.POSITIVE_INFINITY,this.translateEventTypes=a.LEFT_DRAG,this.zoomEventTypes=[a.WHEEL,a.PINCH],this.rotateEventTypes=a.LEFT_DRAG,this.tiltEventTypes=[a.RIGHT_DRAG,a.MIDDLE_DRAG,a.PINCH,{eventType:a.LEFT_DRAG,modifier:n.CTRL},{eventType:a.RIGHT_DRAG,modifier:n.CTRL}],this.lookEventTypes={eventType:a.LEFT_DRAG,modifier:n.SHIFT},this.minimumPickingTerrainHeight=15e4,this._minimumPickingTerrainHeight=this.minimumPickingTerrainHeight,this.minimumCollisionTerrainHeight=15e3,this._minimumCollisionTerrainHeight=this.minimumCollisionTerrainHeight,this.minimumTrackBallHeight=-75e5,this._minimumTrackBallHeight=this.minimumTrackBallHeight,this.enableCollisionDetection=!0,this._scene=t,this._globe=void 0,this._ellipsoid=void 0,rt.GeoOption&&rt.GeoOption.GeoCameraEventAggregator?this._aggregator=new rt.GeoCameraEventAggregator(t.canvas):this._aggregator=new o(t.canvas),this._lastInertiaSpinMovement=void 0,this._lastInertiaZoomMovement=void 0,this._lastInertiaTranslateMovement=void 0,this._lastInertiaTiltMovement=void 0,this._tweens=new l,this._tween=void 0,this._horizontalRotationAxis=void 0,this._tiltCenterMousePosition=new nt(-1,-1),this._tiltCenter=new ot,this._rotateMousePosition=new nt(-1,-1),this._rotateStartPosition=new ot,this._strafeStartPosition=new ot,this._zoomMouseStart=new nt(-1,-1),this._zoomWorldPosition=new ot,this._useZoomWorldPosition=!1,this._tiltCVOffMap=!1,this._looking=!1,this._rotating=!1,this._strafing=!1,this._zoomingOnVector=!1,this._rotatingZoom=!1;var e=t.mapProjection;this._maxCoord=e.project(new i(Math.PI,lt.PI_OVER_TWO)),this._zoomFactor=5,this._rotateFactor=void 0,this._rotateRateRangeAdjustment=void 0,this._maximumRotateRate=1.77,this._minimumRotateRate=2e-4,this._minimumZoomRate=20,this._maximumZoomRate=5906376272e3}var C=.4;function m(t,e,i,r,n,o,a){var s=o[a];st(s)||(s=o[a]={startPosition:new nt,endPosition:new nt,motion:new nt,active:!1});var l=t.getButtonPressTime(e,i),h=t.getButtonReleaseTime(e,i),c=l&&h&&(h.getTime()-l.getTime())/1e3,g=new Date,u=h&&(g.getTime()-h.getTime())/1e3;if(l&&h&&c<C){var d=function(t,e){if(t<0)return 0;var i=25*(1-e);return Math.exp(-i*t)}(u,r);if(s.active)s.startPosition=nt.clone(s.endPosition,s.startPosition),s.endPosition=nt.multiplyByScalar(s.motion,d,s.endPosition),s.endPosition=nt.add(s.startPosition,s.endPosition,s.endPosition),s.motion=nt.clone(nt.ZERO,s.motion);else{var p=t.getLastMovement(e,i);if(!st(p)||function(t){return nt.equalsEpsilon(t.startPosition,t.endPosition,lt.EPSILON14)}(p))return;s.motion.x=.5*(p.endPosition.x-p.startPosition.x),s.motion.y=.5*(p.endPosition.y-p.startPosition.y),s.startPosition=nt.clone(p.startPosition,s.startPosition),s.endPosition=nt.multiplyByScalar(s.motion,d,s.endPosition),s.endPosition=nt.add(s.startPosition,s.endPosition,s.endPosition),s.active=!0}if(isNaN(s.endPosition.x)||isNaN(s.endPosition.y)||nt.distance(s.startPosition,s.endPosition)<.5)return void(s.active=!1);if(!t.isButtonDown(e,i))n(o,t.getStartMousePosition(e,i),s)}else s.active=!1}var f=[];function c(t,e,i,r,n,o){if(st(i)){var a=t._aggregator;p(i)||(f[0]=i,i=f);for(var s=i.length,l=0;l<s;++l){var h=i[l],c=st(h.eventType)?h.eventType:h,g=h.modifier,u=a.isMoving(c,g)&&a.getMovement(c,g),d=a.getStartMousePosition(c,g);t.enableInputs&&e&&(u?r(t,d,u):n<1&&m(a,c,g,n,r,t,o))}}}var ut=new F,dt=new ot,pt=new nt,Ct=new ot,mt=new nt,ft=new ot,vt=new ot,At=new ot,It=new ot,_t=new ot,yt=new ot,wt=new ot,Pt=new ot,xt=new ot,bt=new ot,Et=new ot,Tt=new ot,St=new ot,Mt=new ot,Dt=new ot,Rt=new ot,Lt=new ot,Ft=new ot,Ot={orientation:new e};function d(t,e,i,r,n,o){var a=1;st(o)&&(a=lt.clamp(Math.abs(o),.25,1));var s=t.minimumZoomDistance*a,l=t.maximumZoomDistance,h=r*(n-s);h=lt.clamp(h,t._minimumZoomRate,t._maximumZoomRate);var c=i.endPosition.y-i.startPosition.y;if(!(t.autoResetHeadingPitch&&c<0&&function(t,e){var i=at.clone(at.UNIT_W),r=at.clone(at.UNIT_W),n=t._scene,o=n.globe.ellipsoid,a=n.camera,s=n.canvas;if(1.5<=Math.abs(a.pitch)&&(a.heading<=.25||6.03<=a.heading))return!1;var l=a.pickEllipsoid(new rt.Cartesian2(0,s.clientHeight),o,i),h=a.pickEllipsoid(new rt.Cartesian2(s.clientWidth,s.clientHeight),o,r);if(l&&h&&Math.abs(l.x-h.x)<8e4&&Math.abs(l.y-h.y)<8e4)return!1;var c=new rt.Ray;c=a.getPickRay(e,c);var g=n.globe.pick(c,n);g||(c.origin=a.positionWC,c.direction=a.directionWC,g=n.globe.pick(c,n));var u=o.cartographicToCartesian(viewer.camera.positionCartographic,new rt.Cartesian3),d=(o.geodeticSurfaceNormal(g),new rt.BoundingSphere(g,0));return a.flyToBoundingSphere(d,{offset:new rt.HeadingPitchRange(0,rt.Math.toRadians(-90),rt.Cartesian3.distance(u,g)),duration:0}),!0}(t,e))){var g=c/t._scene.canvas.clientHeight,u=h*(g=Math.min(g,t.maximumMovementRatio));if(!(0<u&&Math.abs(n-s)<1||u<0&&Math.abs(n-l)<1)){n-u<s?u=n-s-1:l<n-u&&(u=n-l);var d=t._scene,p=d.camera,C=d.mode,m=Ot.orientation;if(m.heading=p.heading,m.pitch=p.pitch,m.roll=p.roll,p.frustum instanceof ht)0<Math.abs(u)&&(p.zoomIn(u),p._adjustOrthographicFrustum());else{var f,v=nt.equals(e,t._zoomMouseStart),A=t._zoomingOnVector,I=t._rotatingZoom;if(v||(t._zoomMouseStart=nt.clone(e,t._zoomMouseStart),st(t._globe)&&(f=C!==ct.SCENE2D?kt(t,e,dt):p.getPickRay(e,ut).origin),st(f)?(t._useZoomWorldPosition=!0,t._zoomWorldPosition=ot.clone(f,t._zoomWorldPosition)):t._useZoomWorldPosition=!1,A=t._zoomingOnVector=!1,I=t._rotatingZoom=!1),t._useZoomWorldPosition){var _=C===ct.COLUMBUS_VIEW;if(p.positionCartographic.height<2e6&&(I=!0),!v||I){if(C===ct.SCENE2D){var y=t._zoomWorldPosition,w=p.position;if(!ot.equals(y,w)&&p.positionCartographic.height<2*t._maxCoord.x){var P=p.position.x,x=ot.subtract(y,w,Ct);ot.normalize(x,x);var b=ot.distance(y,w)*u/(.5*p.getMagnitude());p.move(x,.5*b),(p.position.x<0&&0<P||0<p.position.x&&P<0)&&(f=p.getPickRay(e,ut).origin,t._zoomWorldPosition=ot.clone(f,t._zoomWorldPosition))}}else if(C===ct.SCENE3D){var E=ot.normalize(p.position,_t);if(p.positionCartographic.height<3e3&&Math.abs(ot.dot(p.direction,E))<.6)_=!0;else{var T=d.canvas,S=mt;S.x=T.clientWidth/2,S.y=T.clientHeight/2;var M=kt(t,S,ft);if(st(M)&&p.positionCartographic.height<1e6){var D=wt;ot.clone(p.position,D);var R=t._zoomWorldPosition,L=yt;if(L=ot.normalize(R,L),ot.dot(L,E)<0)return;var F=Dt,O=bt;ot.clone(p.direction,O),ot.add(D,ot.multiplyByScalar(O,1e3,Rt),F);var k=Et,B=Tt;ot.subtract(R,D,k),ot.normalize(k,B);var N=ot.dot(E,B);if(0<=N)return void(t._zoomMouseStart.x=-1);var V=Math.acos(-N),z=ot.magnitude(D),G=ot.magnitude(R),U=z-u,H=ot.magnitude(k),W=Math.asin(lt.clamp(H/G*Math.sin(V),-1,1))-Math.asin(lt.clamp(U/G*Math.sin(V),-1,1))+V,j=Pt;ot.normalize(D,j);var Y=xt;Y=ot.cross(B,j,Y),Y=ot.normalize(Y,Y),ot.normalize(ot.cross(j,Y,Rt),O),ot.multiplyByScalar(ot.normalize(F,Rt),ot.magnitude(F)-u,F),ot.normalize(D,D),ot.multiplyByScalar(D,U,D);var q=St;ot.multiplyByScalar(ot.add(ot.multiplyByScalar(j,Math.cos(W)-1,Lt),ot.multiplyByScalar(O,Math.sin(W),Ft),Rt),U,q),ot.add(D,q,D),ot.normalize(F,j),ot.normalize(ot.cross(j,Y,Rt),O);var Z=Mt;return ot.multiplyByScalar(ot.add(ot.multiplyByScalar(j,Math.cos(W)-1,Lt),ot.multiplyByScalar(O,Math.sin(W),Ft),Rt),ot.magnitude(F),Z),ot.add(F,Z,F),ot.clone(D,p.position),ot.normalize(ot.subtract(F,D,Rt),p.direction),ot.clone(p.direction,p.direction),ot.cross(p.direction,p.up,p.right),ot.cross(p.right,p.direction,p.up),void p.setView(Ot)}if(st(M)){var X=ot.normalize(M,vt),K=ot.normalize(t._zoomWorldPosition,At),Q=ot.dot(K,X);if(0<Q&&Q<1){var J=lt.acosClamped(Q),$=ot.cross(K,X,It),tt=u/(Math.abs(J)>lt.toRadians(20)?.75*p.positionCartographic.height:p.positionCartographic.height-u);p.rotate($,J*tt)}}else _=!0}}t._rotatingZoom=!_}if(!v&&_||A){var et=gt.wgs84ToWindowCoordinates(d,t._zoomWorldPosition,pt),it=(C!==ct.COLUMBUS_VIEW&&nt.equals(e,t._zoomMouseStart)&&st(et)?p.getPickRay(et,ut):p.getPickRay(e,ut)).direction;C===ct.COLUMBUS_VIEW&&ot.fromElements(it.y,it.z,it.x,it),p.move(it,u),t._zoomingOnVector=!0}else p.zoomIn(u);p.setView(Ot)}else p.zoomIn(u)}}}}var g=new F,u=new F,v=new ot;function A(t,e,i){var r=t._scene.camera,n=r.getPickRay(i.startPosition,g).origin,o=r.getPickRay(i.endPosition,u).origin,a=ot.subtract(n,o,v),s=ot.magnitude(a);0<s&&(ot.normalize(a,a),r.move(a,s))}function _(t,e,i){st(i.distance)&&(i=i.distance);var r=t._scene.camera;d(t,e,i,t._zoomFactor,r.getMagnitude())}var y=new nt,w=new nt;function P(t,e,i){if(st(i.angleAndHeight))!function(t,e,i){var r=t._rotateFactor*t._rotateRateRangeAdjustment;r>t._maximumRotateRate&&(r=t._maximumRotateRate);r<t._minimumRotateRate&&(r=t._minimumRotateRate);var n=t._scene,o=n.camera,a=n.canvas,s=(i.endPosition.x-i.startPosition.x)/a.clientWidth;s=Math.min(s,t.maximumMovementRatio);var l=r*s*Math.PI*4;o.twistRight(l)}(t,0,i.angleAndHeight);else{var r=t._scene,n=r.camera,o=r.canvas,a=o.clientWidth,s=o.clientHeight,l=y;l.x=2/a*i.startPosition.x-1,l.y=2/s*(s-i.startPosition.y)-1,l=nt.normalize(l,l);var h=w;h.x=2/a*i.endPosition.x-1,h.y=2/s*(s-i.endPosition.y)-1,h=nt.normalize(h,h);var c=lt.acosClamped(l.x);l.y<0&&(c=lt.TWO_PI-c);var g=lt.acosClamped(h.x);h.y<0&&(g=lt.TWO_PI-g);var u=g-c;n.twistRight(u)}}var x=new F,b=new ot,E=new ot;function kt(t,e,i){var r=t._scene,n=t._globe,o=r.camera;if(st(n)){var a;r.pickPositionSupported&&(a=r.pickPositionWorldCoordinates(e,b));var s=o.getPickRay(e,x),l=n.pick(s,r,E);return(st(a)?ot.distance(a,o.positionWC):Number.POSITIVE_INFINITY)<(st(l)?ot.distance(l,o.positionWC):Number.POSITIVE_INFINITY)?ot.clone(a,i):ot.clone(l,i)}}var T=new F,S=new F,M=new ot,D=new ot,R=new ot,L=new ot,O=new G(ot.UNIT_X,0),k=new nt,W=new nt;function j(t,e,i){if(ot.equals(e,t._translateMousePosition)||(t._looking=!1),ot.equals(e,t._strafeMousePosition)||(t._strafing=!1),t._looking)Oe(t,e,i);else if(t._strafing)Kt(t,e,i);else{var r,n=t._scene.camera,o=nt.clone(i.startPosition,k),a=nt.clone(i.endPosition,W),s=n.getPickRay(o,T),l=ot.clone(ot.ZERO,L),h=ot.UNIT_X;if(n.position.z<t._minimumPickingTerrainHeight&&(r=kt(t,o,M),st(r)&&(l.x=r.x)),l.x>n.position.z&&st(r))return ot.clone(r,t._strafeStartPosition),t._strafing=!0,Kt(t,e,i),void(t._strafeMousePosition=nt.clone(e,t._strafeMousePosition));var c=G.fromPointNormal(l,h,O);s=n.getPickRay(o,T);var g=N.rayPlane(s,c,M),u=n.getPickRay(a,S),d=N.rayPlane(u,c,D);if(!st(g)||!st(d))return t._looking=!0,Oe(t,e,i),void nt.clone(e,t._translateMousePosition);var p=ot.subtract(g,d,R),C=p.x;p.x=p.y,p.y=p.z,p.z=C;var m=ot.magnitude(p);m>lt.EPSILON6&&(ot.normalize(p,p),n.move(p,m))}}var Y=new nt,q=new F,Z=new ot,X=new ot,K=new z,Q=new z,J=new ot,$=new G(ot.UNIT_X,0),tt=new ot,et=new i,it=new z,Bt=new U,Nt=new V,Vt=new ot;function zt(t,e,i){if(st(i.angleAndHeight)&&(i=i.angleAndHeight),nt.equals(e,t._tiltCenterMousePosition)||(t._tiltCVOffMap=!1,t._looking=!1),t._looking)Oe(t,e,i);else{var r=t._scene.camera,n=t._maxCoord,o=Math.abs(r.position.x)-n.x<0&&Math.abs(r.position.y)-n.y<0;t._tiltCVOffMap||!o||r.position.z>t._minimumPickingTerrainHeight?(t._tiltCVOffMap=!0,function(t,e,i){var r=t._scene,n=r.camera,o=r.canvas,a=Y;a.x=o.clientWidth/2,a.y=o.clientHeight/2;var s,l=n.getPickRay(a,q),h=ot.UNIT_X,c=l.origin,g=l.direction,u=ot.dot(h,g);Math.abs(u)>lt.EPSILON6&&(s=-ot.dot(h,c)/u);if(!st(s)||s<=0)return t._looking=!0,Oe(t,e,i),nt.clone(e,t._tiltCenterMousePosition);var d=ot.multiplyByScalar(g,s,Z);ot.add(c,d,d);var p=r.mapProjection,C=p.ellipsoid;ot.fromElements(d.y,d.z,d.x,d);var m=p.unproject(d,et);C.cartographicToCartesian(m,d);var f=H.eastNorthUpToFixedFrame(d,C,K),v=t._globe,A=t._ellipsoid;t._globe=void 0,t._ellipsoid=B.UNIT_SPHERE,t._rotateFactor=1,t._rotateRateRangeAdjustment=1;var I=z.clone(n.transform,it);n._setTransform(f),re(t,e,i,ot.UNIT_Z),n._setTransform(I),t._globe=v;var _=(t._ellipsoid=A).maximumRadius;t._rotateFactor=1/_,t._rotateRateRangeAdjustment=_}(t,e,i)):function(t,e,i){var r,n,o=t._scene,a=o.camera,s=ot.UNIT_X;if(nt.equals(e,t._tiltCenterMousePosition))r=ot.clone(t._tiltCenter,Z);else{if(a.position.z<t._minimumPickingTerrainHeight&&(r=kt(t,e,Z)),!st(r)){var l,h=(n=a.getPickRay(e,q)).origin,c=n.direction,g=ot.dot(s,c);if(Math.abs(g)>lt.EPSILON6&&(l=-ot.dot(s,h)/g),!st(l)||l<=0)return t._looking=!0,Oe(t,e,i),nt.clone(e,t._tiltCenterMousePosition);r=ot.multiplyByScalar(c,l,Z),ot.add(h,r,r)}nt.clone(e,t._tiltCenterMousePosition),ot.clone(r,t._tiltCenter)}var u=o.canvas,d=Y;d.x=u.clientWidth/2,d.y=t._tiltCenterMousePosition.y,n=a.getPickRay(d,q);var p=ot.clone(ot.ZERO,J);p.x=r.x;var C=G.fromPointNormal(p,s,$),m=N.rayPlane(n,C,X),f=a._projection,v=f.ellipsoid;ot.fromElements(r.y,r.z,r.x,r);var A=f.unproject(r,et);v.cartographicToCartesian(A,r);var I,_=H.eastNorthUpToFixedFrame(r,v,K);I=st(m)?(ot.fromElements(m.y,m.z,m.x,m),A=f.unproject(m,et),v.cartographicToCartesian(A,m),H.eastNorthUpToFixedFrame(m,v,Q)):_;var y=t._globe,w=t._ellipsoid;t._globe=void 0,t._ellipsoid=B.UNIT_SPHERE,t._rotateFactor=1,t._rotateRateRangeAdjustment=1;var P=ot.UNIT_Z,x=z.clone(a.transform,it);a._setTransform(_);var b=ot.cross(ot.UNIT_Z,ot.normalize(a.position,tt),tt),E=ot.dot(a.right,b);if(re(t,e,i,P,!1,!0),a._setTransform(I),E<0){i.startPosition.y>i.endPosition.y&&(P=void 0);var T=a.constrainedAxis;a.constrainedAxis=void 0,re(t,e,i,P,!0,!1),a.constrainedAxis=T}else re(t,e,i,P,!0,!1);if(st(a.constrainedAxis)){var S=ot.cross(a.direction,a.constrainedAxis,Vt);ot.equalsEpsilon(S,ot.ZERO,lt.EPSILON6)||(ot.dot(S,a.right)<0&&ot.negate(S,S),ot.cross(S,a.direction,a.up),ot.cross(a.direction,a.up,a.right),ot.normalize(a.up,a.up),ot.normalize(a.right,a.right))}a._setTransform(x),t._globe=y;var M=(t._ellipsoid=w).maximumRadius;t._rotateFactor=1/M,t._rotateRateRangeAdjustment=M;var D=ot.clone(a.positionWC,tt);if(a._adjustHeightForTerrain(),!ot.equals(a.positionWC,D)){a._setTransform(I),a.worldToCameraCoordinatesPoint(D,D);var R=ot.magnitudeSquared(D);ot.magnitudeSquared(a.position)>R&&(ot.normalize(a.position,a.position),ot.multiplyByScalar(a.position,Math.sqrt(R),a.position));var L=ot.angleBetween(D,a.position),F=ot.cross(D,a.position,D);ot.normalize(F,F);var O=U.fromAxisAngle(F,L,Bt),k=V.fromQuaternion(O,Nt);V.multiplyByVector(k,a.direction,a.direction),V.multiplyByVector(k,a.up,a.up),ot.cross(a.direction,a.up,a.right),ot.cross(a.right,a.direction,a.up),a._setTransform(x)}}(t,e,i)}}var Gt=new nt,Ut=new F,Ht=new ot;function Wt(t,e,i){st(i.distance)&&(i=i.distance);var r=t._scene,n=r.camera,o=r.canvas,a=Gt;a.x=o.clientWidth/2,a.y=o.clientHeight/2;var s,l,h=n.getPickRay(a,Ut);if(n.position.z<t._minimumPickingTerrainHeight&&(s=kt(t,a,Ht)),st(s))l=ot.distance(h.origin,s);else{var c=ot.UNIT_X,g=h.origin,u=h.direction;l=-ot.dot(c,g)/ot.dot(c,u)}d(t,e,i,t._zoomFactor,l)}var jt=new F,Yt=new G(ot.UNIT_X,0),qt=new ot,Zt=new ot,Xt=new ot;function Kt(t,e,i){var r=t._scene,n=r.camera,o=kt(t,i.startPosition,Xt);if(st(o)){var a=i.endPosition,s=n.getPickRay(a,jt),l=ot.clone(n.direction,Zt);r.mode===ct.COLUMBUS_VIEW&&ot.fromElements(l.z,l.x,l.y,l);var h=G.fromPointNormal(o,l,Yt),c=N.rayPlane(s,h,qt);st(c)&&(l=ot.subtract(o,c,l),r.mode===ct.COLUMBUS_VIEW&&ot.fromElements(l.y,l.z,l.x,l),ot.add(n.position,l,n.position))}}var Qt=new ot,Jt=new i,$t=new ot,te=new B,ee=new ot;function ie(t,e,i){var r=t._scene.camera;if(z.equals(r.transform,z.IDENTITY)){var n,o,a,s=t._ellipsoid.geodeticSurfaceNormal(r.position,ee),l=t._ellipsoid.cartesianToCartographic(r.positionWC,Jt).height,h=t._globe;if(st(h)&&l<t._minimumPickingTerrainHeight&&(a=kt(t,i.startPosition,Xt),st(a))){var c=r.getPickRay(i.startPosition,x),g=t._ellipsoid.geodeticSurfaceNormal(a);Math.abs(ot.dot(c.direction,g))<.05&&!t._looking&&(t._rotating=!1,t._strafing=!0)}nt.equals(e,t._rotateMousePosition)?t._looking?Oe(t,e,i,s):t._rotating?re(t,e,i):t._strafing?(ot.clone(a,t._strafeStartPosition),Kt(t,0,i)):(n=ot.magnitude(t._rotateStartPosition),(o=$t).x=o.y=o.z=n,ue(t,e,i,B.fromCartesian3(o,te))):(t._looking=!1,t._rotating=!1,t._strafing=!1,st(h)&&l<t._minimumPickingTerrainHeight?st(a)?ot.magnitude(r.position)<ot.magnitude(a)?(ot.clone(a,t._strafeStartPosition),t._strafing=!0,Kt(t,0,i)):(n=ot.magnitude(a),(o=$t).x=o.y=o.z=n,ue(t,e,i,B.fromCartesian3(o,te)),ot.clone(a,t._rotateStartPosition)):(t._looking=!0,Oe(t,e,i,s)):st(r.pickEllipsoid(i.startPosition,t._ellipsoid,Qt))?(ue(t,e,i,t._ellipsoid),ot.clone(Qt,t._rotateStartPosition)):l>t._minimumTrackBallHeight?(t._rotating=!0,re(t,e,i)):(t._looking=!0,Oe(t,e,i,s)),nt.clone(e,t._rotateMousePosition))}else{i&&i.startPosition&&i.endPosition&&(e=i.endPosition,i.endPosition=i.startPosition,i.startPosition=e,i.endPosition.x=(i.startPosition.x+i.endPosition.x)/2,i.endPosition.y=(i.startPosition.y+i.endPosition.y)/2);var u=function(t){var e=t._scene,i=e.camera,r=e._globe._ellipsoid,n=H.eastNorthUpToFixedFrame(i.position,r,Ie),o=z.clone(i.transform,ye);i._setTransform(n);var a=new ot;return a=z.multiplyByPoint(i.viewMatrix,a,a),i._setTransform(o),a}(t);r.pitch>lt.clamp(t.constrainedPitch,-lt.PI,0)&&0<=i.startPosition.y-i.endPosition.y||0<u.y&&i.startPosition.y-i.endPosition.y<=0?re(t,e,i,ot.UNIT_Z,!1,!0):re(t,e,i)}}function re(t,e,i,r,n,o){n=I(n,!1),o=I(o,!1);var a=t._scene,s=a.camera,l=a.canvas,h=s.constrainedAxis;st(r)&&(s.constrainedAxis=r);var c=ot.magnitude(s.position),g=t._rotateFactor*(c-t._rotateRateRangeAdjustment);g>t._maximumRotateRate&&(g=t._maximumRotateRate),g<t._minimumRotateRate&&(g=t._minimumRotateRate);var u=(i.startPosition.x-i.endPosition.x)/l.clientWidth,d=(i.startPosition.y-i.endPosition.y)/l.clientHeight;u=Math.min(u,t.maximumMovementRatio),d=Math.min(d,t.maximumMovementRatio);var p=g*u*Math.PI*2,C=g*d*Math.PI;n||s.rotateRight(-p),o||(1==t.enableGeoLocateRatate&&(s.constrainedAxis=void 0),s.rotateUp(C)),s.constrainedAxis=h}var ne=at.clone(at.UNIT_W),oe=at.clone(at.UNIT_W),ae=new ot,se=new ot,le=new ot,he=new ot,ce=new nt,ge=new nt;function ue(t,e,i,r){var n=t._scene.camera,o=nt.clone(i.startPosition,ce),a=nt.clone(i.endPosition,ge),s=n.pickEllipsoid(o,r,ne),l=n.pickEllipsoid(a,r,oe);if(!st(s)||!st(l))return t._rotating=!0,void re(t,0,i);if(s=n.worldToCameraCoordinates(s,s),l=n.worldToCameraCoordinates(l,l),st(n.constrainedAxis)){var h=n.constrainedAxis,c=ot.mostOrthogonalAxis(h,ae);ot.cross(c,h,c),ot.normalize(c,c);var g=ot.cross(h,c,se),u=ot.magnitude(s),d=ot.dot(h,s),p=Math.acos(d/u),C=ot.multiplyByScalar(h,d,le);ot.subtract(s,C,C),ot.normalize(C,C);var m=ot.magnitude(l),f=ot.dot(h,l),v=Math.acos(f/m),A=ot.multiplyByScalar(h,f,he);ot.subtract(l,A,A),ot.normalize(A,A);var I=Math.acos(ot.dot(C,c));ot.dot(C,g)<0&&(I=lt.TWO_PI-I);var _=Math.acos(ot.dot(A,c));ot.dot(A,g)<0&&(_=lt.TWO_PI-_);var y,w=I-_;y=ot.equalsEpsilon(h,n.position,lt.EPSILON2)?n.right:ot.cross(h,n.position,ae);var P,x=ot.cross(h,y,ae),b=ot.dot(x,ot.subtract(s,h,se)),E=ot.dot(x,ot.subtract(l,h,se));P=0<b&&0<E?v-p:0<b&&E<=0?0<ot.dot(n.position,h)?-p-v:p+v:p-v,n.rotateRight(w),n.rotateUp(P)}else{ot.normalize(s,s),ot.normalize(l,l);var T=ot.dot(s,l),S=ot.cross(s,l,ae);if(T<1&&!ot.equalsEpsilon(S,ot.ZERO,lt.EPSILON14)){var M=Math.acos(T);n.rotate(S,M)}}}var de=new ot,pe=new i;function Ce(t,e,i){st(i.distance)&&(i=i.distance);var r=t._ellipsoid,n=t._scene,o=n.camera,a=n.canvas,s=Gt;s.x=a.clientWidth/2,s.y=a.clientHeight/2;var l,h,c=o.getPickRay(s,Ut),g=r.cartesianToCartographic(o.position,pe).height;g<t._minimumPickingTerrainHeight&&(l=kt(t,s,Ht)),h=st(l)?ot.distance(c.origin,l):g;var u=ot.normalize(o.position,de);d(t,e,i,t._zoomFactor,h,ot.dot(u,o.direction))}var me=new nt,fe=new F,ve=new ot,Ae=new ot,Ie=new z,_e=new z,ye=new z,we=new U,Pe=new V,xe=new i,be=new ot;function Ee(t,e,i){var r=t._scene.camera;if(i&&i.startPosition&&i.endPosition&&(e=i.endPosition,i.endPosition=i.startPosition,i.startPosition=e,i.endPosition.x=(i.startPosition.x+i.endPosition.x)/2,i.endPosition.y=(i.startPosition.y+i.endPosition.y)/2),z.equals(r.transform,z.IDENTITY))if(st(i.angleAndHeight)&&(i=i.angleAndHeight),nt.equals(e,t._tiltCenterMousePosition)||(t._tiltOnEllipsoid=!1,t._looking=!1),t._looking){var n=t._ellipsoid.geodeticSurfaceNormal(r.position,be);Oe(t,e,i,n)}else{var o=t._ellipsoid.cartesianToCartographic(r.position,xe);t._tiltOnEllipsoid||o.height>t._minimumCollisionTerrainHeight?(t._tiltOnEllipsoid=!0,function(t,e,i){var r=t._ellipsoid,n=t._scene,o=n.camera,a=.25*t.minimumZoomDistance,s=r.cartesianToCartographic(o.positionWC,Te).height;if(s-a-1<lt.EPSILON3&&i.endPosition.y-i.startPosition.y<0)return;var l=n.canvas,h=me;h.x=l.clientWidth/2,h.y=l.clientHeight/2;var c,g=o.getPickRay(h,fe),u=N.rayEllipsoid(g,r);if(st(u))c=F.getPoint(g,u.start,ve);else{if(!(s>t._minimumTrackBallHeight)){t._looking=!0;var d=t._ellipsoid.geodeticSurfaceNormal(o.position,be);return Oe(t,e,i,d),nt.clone(e,t._tiltCenterMousePosition)}var p=N.grazingAltitudeLocation(g,r);if(!st(p))return;var C=r.cartesianToCartographic(p,xe);C.height=0,c=r.cartographicToCartesian(C,ve)}var m=H.eastNorthUpToFixedFrame(c,r,Ie),f=t._globe,v=t._ellipsoid;t._globe=void 0,t._ellipsoid=B.UNIT_SPHERE,t._rotateFactor=1,t._rotateRateRangeAdjustment=1;var A=z.clone(o.transform,ye);o._setTransform(m),o.pitch>lt.clamp(t.constrainedPitch,-lt.PI,0)&&0<=i.startPosition.y-i.endPosition.y?re(t,0,i,ot.UNIT_Z,!1,!0):re(t,0,i,ot.UNIT_Z);o._setTransform(A),t._globe=f;var I=(t._ellipsoid=v).maximumRadius;t._rotateFactor=1/I,t._rotateRateRangeAdjustment=I}(t,e,i)):function(t,e,i){var r,n,o,a=t._ellipsoid,s=t._scene,l=s.camera;if(nt.equals(e,t._tiltCenterMousePosition))r=ot.clone(t._tiltCenter,ve);else{if(r=kt(t,e,ve),!st(r)){if(n=l.getPickRay(e,fe),o=N.rayEllipsoid(n,a),!st(o)){if(a.cartesianToCartographic(l.position,xe).height<=t._minimumTrackBallHeight){t._looking=!0;var h=t._ellipsoid.geodeticSurfaceNormal(l.position,be);Oe(t,e,i,h),nt.clone(e,t._tiltCenterMousePosition)}return}r=F.getPoint(n,o.start,ve)}nt.clone(e,t._tiltCenterMousePosition),ot.clone(r,t._tiltCenter)}var c=s.canvas,g=me;g.x=c.clientWidth/2,g.y=t._tiltCenterMousePosition.y,n=l.getPickRay(g,fe);var u=ot.magnitude(r),d=ot.fromElements(u,u,u,$t),p=B.fromCartesian3(d,te);if(o=N.rayEllipsoid(n,p),!st(o))return;var C=ot.magnitude(n.origin)>u?o.start:o.stop,m=F.getPoint(n,C,Ae),f=H.eastNorthUpToFixedFrame(r,a,Ie),v=H.eastNorthUpToFixedFrame(m,p,_e),A=t._globe,I=t._ellipsoid;t._globe=void 0,t._ellipsoid=B.UNIT_SPHERE,t._rotateFactor=1,t._rotateRateRangeAdjustment=1;var _=ot.UNIT_Z,y=z.clone(l.transform,ye);l._setTransform(f);var w=ot.cross(m,l.positionWC,Vt),P=ot.dot(l.rightWC,w);if(re(t,0,i,_,!1,!0),l._setTransform(v),P<0){i.startPosition.y>i.endPosition.y&&(_=void 0);var x=l.constrainedAxis;l.constrainedAxis=void 0,re(t,0,i,_,!0,!1),l.constrainedAxis=x}else(l.pitch<lt.clamp(t.constrainedPitch,-lt.PI,0)||i.startPosition.y-i.endPosition.y<=0)&&re(t,0,i,_,!0,!1);if(st(l.constrainedAxis)){var b=ot.cross(l.direction,l.constrainedAxis,Vt);ot.equalsEpsilon(b,ot.ZERO,lt.EPSILON6)||(ot.dot(b,l.right)<0&&ot.negate(b,b),ot.cross(b,l.direction,l.up),ot.cross(l.direction,l.up,l.right),ot.normalize(l.up,l.up),ot.normalize(l.right,l.right))}l._setTransform(y),t._globe=A;var E=(t._ellipsoid=I).maximumRadius;t._rotateFactor=1/E,t._rotateRateRangeAdjustment=E;var T=ot.clone(l.positionWC,Vt);if(l._adjustHeightForTerrain(),!ot.equals(l.positionWC,T)){l._setTransform(v),l.worldToCameraCoordinatesPoint(T,T);var S=ot.magnitudeSquared(T);ot.magnitudeSquared(l.position)>S&&(ot.normalize(l.position,l.position),ot.multiplyByScalar(l.position,Math.sqrt(S),l.position));var M=ot.angleBetween(T,l.position),D=ot.cross(T,l.position,T);ot.normalize(D,D);var R=U.fromAxisAngle(D,M,we),L=V.fromQuaternion(R,Pe);V.multiplyByVector(L,l.direction,l.direction),V.multiplyByVector(L,l.up,l.up),ot.cross(l.direction,l.up,l.right),ot.cross(l.right,l.direction,l.up),l._setTransform(y)}}(t,e,i)}}var Te=new i;var Se=new nt,Me=new nt,De=new F,Re=new F,Le=new ot,Fe=new ot;function Oe(t,e,i,r){var n=t._scene.camera,o=Se;o.x=i.startPosition.x,o.y=0;var a=Me;a.x=i.endPosition.x,a.y=0;var s,l,h=n.getPickRay(o,De),c=n.getPickRay(a,Re),g=0;n.frustum instanceof ht?(s=h.origin,l=c.origin,ot.add(n.direction,s,s),ot.add(n.direction,l,l),ot.subtract(s,n.position,s),ot.subtract(l,n.position,l),ot.normalize(s,s),ot.normalize(l,l)):(s=h.direction,l=c.direction);var u=ot.dot(s,l);u<1&&(g=Math.acos(u)),g=i.startPosition.x>i.endPosition.x?-g:g;var d=t._horizontalRotationAxis;if(st(r)?n.look(r,-g):st(d)?n.look(d,-g):n.lookLeft(g),o.x=0,o.y=i.startPosition.y,a.x=0,a.y=i.endPosition.y,h=n.getPickRay(o,De),c=n.getPickRay(a,Re),g=0,n.frustum instanceof ht?(s=h.origin,l=c.origin,ot.add(n.direction,s,s),ot.add(n.direction,l,l),ot.subtract(s,n.position,s),ot.subtract(l,n.position,l),ot.normalize(s,s),ot.normalize(l,l)):(s=h.direction,l=c.direction),(u=ot.dot(s,l))<1&&(g=Math.acos(u)),g=i.startPosition.y>i.endPosition.y?-g:g,r=I(r,d),st(r)){var p=n.direction,C=ot.negate(r,Le),m=ot.equalsEpsilon(p,r,lt.EPSILON2),f=ot.equalsEpsilon(p,C,lt.EPSILON2);if(m||f)(m&&g<0||f&&0<g)&&n.look(n.right,-g);else{u=ot.dot(p,r);var v=lt.acosClamped(u);0<g&&v<g&&(g=v-lt.EPSILON4),u=ot.dot(p,C),v=lt.acosClamped(u),g<0&&v<-g&&(g=-v+lt.EPSILON4);var A=ot.cross(r,p,Fe);n.look(A,g)}}else n.lookUp(g)}h.prototype.update=function(){z.equals(this._scene.camera.transform,z.IDENTITY)?(this._globe=this._scene.globe,this._ellipsoid=st(this._globe)?this._globe.ellipsoid:this._scene.mapProjection.ellipsoid):(this._globe=void 0,this._ellipsoid=B.UNIT_SPHERE),this._minimumCollisionTerrainHeight=this.minimumCollisionTerrainHeight*this._scene.terrainExaggeration,this._minimumPickingTerrainHeight=this.minimumPickingTerrainHeight*this._scene.terrainExaggeration,this._minimumTrackBallHeight=this.minimumTrackBallHeight*this._scene.terrainExaggeration;var t=this._ellipsoid.maximumRadius;this._rotateFactor=1/t,this._rotateRateRangeAdjustment=t;var e=this._scene.mode;e===ct.SCENE2D?function(t){var e=t._scene.mapMode2D===s.ROTATE;z.equals(z.IDENTITY,t._scene.camera.transform)?(c(t,t.enableTranslate,t.translateEventTypes,A,t.inertiaTranslate,"_lastInertiaTranslateMovement"),c(t,t.enableZoom,t.zoomEventTypes,_,t.inertiaZoom,"_lastInertiaZoomMovement"),e&&c(t,t.enableRotate,t.tiltEventTypes,P,t.inertiaSpin,"_lastInertiaTiltMovement")):(c(t,t.enableZoom,t.zoomEventTypes,_,t.inertiaZoom,"_lastInertiaZoomMovement"),e&&c(t,t.enableRotate,t.translateEventTypes,P,t.inertiaSpin,"_lastInertiaSpinMovement"))}(this):e===ct.COLUMBUS_VIEW?(this._horizontalRotationAxis=ot.UNIT_Z,function(t){var e=t._scene.camera;if(z.equals(z.IDENTITY,e.transform)){var i=t._tweens;if(t._aggregator.anyButtonDown&&i.removeAll(),c(t,t.enableTilt,t.tiltEventTypes,zt,t.inertiaSpin,"_lastInertiaTiltMovement"),c(t,t.enableTranslate,t.translateEventTypes,j,t.inertiaTranslate,"_lastInertiaTranslateMovement"),c(t,t.enableZoom,t.zoomEventTypes,Wt,t.inertiaZoom,"_lastInertiaZoomMovement"),c(t,t.enableLook,t.lookEventTypes,Oe),!(t._aggregator.anyButtonDown||st(t._lastInertiaZoomMovement)&&t._lastInertiaZoomMovement.active||st(t._lastInertiaTranslateMovement)&&t._lastInertiaTranslateMovement.active||i.contains(t._tween))){var r=e.createCorrectPositionTween(t.bounceAnimationTime);st(r)&&(t._tween=i.add(r))}i.update()}else c(t,t.enableRotate,t.rotateEventTypes,re,t.inertiaSpin,"_lastInertiaSpinMovement"),c(t,t.enableZoom,t.zoomEventTypes,Ce,t.inertiaZoom,"_lastInertiaZoomMovement")}(this)):e===ct.SCENE3D&&(this._horizontalRotationAxis=void 0,function(t){c(t,t.enableRotate,t.rotateEventTypes,ie,t.inertiaSpin,"_lastInertiaSpinMovement"),c(t,t.enableZoom,t.zoomEventTypes,Ce,t.inertiaZoom,"_lastInertiaZoomMovement"),c(t,t.enableTilt,t.tiltEventTypes,Ee,2,"_lastInertiaTiltMovement"),c(t,t.enableLook,t.lookEventTypes,Oe)}(this)),this._aggregator.reset()},h.prototype.isDestroyed=function(){return!1},h.prototype.destroy=function(){return this._tweens.removeAll(),this._aggregator=this._aggregator&&this._aggregator.destroy(),t(this)},rt.GeoScreenSpaceCameraController=h}(window.Cesium),function(x){function h(e,t,i,r){var n=this;if(n._viewer=i,n._source=e,n._videoProject=r,n._context=t,n._canvas=null,n._texture=null,n._context2D=null,n._width=0,n._height=0,n._dirty=!1,n._sampler=null,n._errorEvent=new x.Event,e&&e instanceof HTMLVideoElement){e.addEventListener("timeupdate",function t(){n._updateSize(Math.round(.1*e.videoWidth),Math.round(.1*e.videoHeight)),e.removeEventListener("timeupdate",t)})}i.clock.onTick.addEventListener(function(){n._updateTexture()})}h.prototype._getCurrentTexture=function(){return this._texture},x.defineProperties(h.prototype,{ErrorEvent:{get:function(){return this._errorEvent}}}),h.prototype._updateSize=function(t,e){t&&(this._width=t),e&&(this._height=e),this._dirty=!0},h.prototype._render=function(t){},h.prototype._createSampler=function(){this._sampler||(this._sampler=new x.Sampler)},h.prototype._updateTexture=function(){this._videoProject&&this._videoProject.fillVideo&&(this._context&&this._source?this._source.readyState<2||(!this._source.videoWidth||this._source.videoWidth<10?this._texture&&(this._texture.destroy(),this._texture=null):this._texture?this._texture.copyFrom(this._source):this._texture=new x.Texture({context:this._context,source:this._source,pixelFormat:x.PixelFormat.RGBA,pixelDatatype:x.PixelDatatype.UNSIGNED_BYTE})):this._errorEvent.raiseEvent("params"))},h.prototype._fetchVideo=function(){var t=x.when.defer();if(2<=this._source.readyState){var e=this._source.videoWidth,i=this._source.videoHeight;this._context2D.drawImage(this._source,0,0,e,i,0,0,this._width,this._height),t.resolve(this._canvas)}else t.reject(null);return t},h.prototype._createTexture=function(t){this._texture?this._texture.copyFrom(t):this._texture=new x.Texture({context:this._context,source:t,pixelFormat:x.PixelFormat.RGBA,pixelDatatype:x.PixelDatatype.UNSIGNED_BYTE,sampler:this._sampler})},h.prototype._recreateParseCanvas=function(){this._width<1||this._height<1||(this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.width=x.Math.nextPowerOfTwo(this._width),this._canvas.height=x.Math.nextPowerOfTwo(this._height),this._context2D=this._canvas.getContext("2d"))},h.prototype._readVideoFramePixels=function(){var t=this._source.videoWidth,e=this._source.videoHeight;return this._context2D.drawImage(this._source,0,0,t,e,0,0,this._width,this._height),this._canvas},h.prototype._createSource=function(t){return{arrayBufferView:new Uint8Array(t),width:this._width,height:this._height}},h.prototype.destroy=function(){this._source=null,this._context2D=null,this._context=null,this._canvas=null,this._videoProject=null,this._sampler=null,this._errorEvent=new x.Event,this._texture&&(this._texture.destroy(),this._texture=null)};function c(t,e){this._videoProjection=e,this._scene=t,this._fs=null,this._uniforms=null,this._actived=!1,this._postStage=null,this._videoTexture=null,this._createEvent=new x.Event,this._addEvent=new x.Event,this._removeEvent=new x.Event}c.prototype.destroy=function(){this._destroyPostStage(),this._videoProjection=null,this._scene=null,this._createEvent=null,this._addEvent=null,this._removeEvent=null,this._videoTexture=null},c._FS_Cone="uniform float mixNum;\nuniform float videoDistance;\nuniform sampler2D colorTexture;\nuniform sampler2D videoMapTexture;\nuniform sampler2D videoTexture;\nuniform sampler2D depthTexture;\nuniform mat4 videoMapMatrix;\nuniform mat4 videoViewMatrix;\nuniform vec3 videoMapPosition;\nvarying vec2 v_textureCoordinates;\nvec4 toEye(in vec2 uv, in float depth){\n    vec2 xy = vec2((uv.x * 2.0 - 1.0),(uv.y * 2.0 - 1.0));\n    vec4 posInCamera =czm_inverseProjection * vec4(xy, depth, 1.0);\n    posInCamera = posInCamera / posInCamera.w;\n    return posInCamera;\n}\nfloat getDepth(in vec4 depth){\n    float z_window = czm_unpackDepth(depth);\n    z_window = czm_reverseLogDepth(z_window);\n    float n_range = czm_depthRange.near;\n    float f_range = czm_depthRange.far;\n    return (2.0 * z_window - n_range - f_range) / (f_range - n_range);\n}\nbool videoVisibility(sampler2D shadowMap, vec4 position){\n    float visibility = step(position.z, texture2D(shadowMap, position.xy).r);\n    return (visibility == 1.0);\n}\nvoid main()\n{\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\n    vec4 currD = texture2D(depthTexture, v_textureCoordinates);\n    if(currD.r>=1.0){\n        gl_FragColor = color;\n        return;\n    }\n    float depth = getDepth(currD);\n    vec4 positionEC = toEye(v_textureCoordinates, depth);\n    vec4 videoPosition = videoMapMatrix * positionEC;\n    videoPosition /= videoPosition.w;\n    if (any(lessThan(videoPosition.xyz, vec3(0.0))) || any(greaterThan(videoPosition.xyz, vec3(1.0))))\n    {\n        gl_FragColor = color;\n        return;\n    }\n    bool visibility = videoVisibility(videoMapTexture, videoPosition);\n    if(visibility){\n        vec4 videoColor = texture2D(videoTexture, videoPosition.xy);\n        gl_FragColor = vec4(mix(color.rgb, videoColor.rgb, mixNum), 1.0);\n    }else{\n        gl_FragColor = color;\n    }\n}",c._FS_Cone_Fill="uniform float mixNum;\nuniform float videoDistance;\nuniform sampler2D colorTexture;\nuniform sampler2D videoMapTexture;\nuniform sampler2D depthTexture;\nuniform mat4 videoMapMatrix;\nuniform mat4 videoViewMatrix;\nuniform vec3 videoMapPosition;\nuniform vec4 u_videoColor;\nvarying vec2 v_textureCoordinates;\nvec4 toEye(in vec2 uv, in float depth){\n    vec2 xy = vec2((uv.x * 2.0 - 1.0),(uv.y * 2.0 - 1.0));\n    vec4 posInCamera =czm_inverseProjection * vec4(xy, depth, 1.0);\n    posInCamera = posInCamera / posInCamera.w;\n    return posInCamera;\n}\nfloat getDepth(in vec4 depth){\n    float z_window = czm_unpackDepth(depth);\n    z_window = czm_reverseLogDepth(z_window);\n    float n_range = czm_depthRange.near;\n    float f_range = czm_depthRange.far;\n    return (2.0 * z_window - n_range - f_range) / (f_range - n_range);\n}\nbool videoVisibility(sampler2D shadowMap, vec4 position){\n    float visibility = step(position.z, texture2D(shadowMap, position.xy).r);\n    return (visibility == 1.0);\n}\nvoid main()\n{\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\n    vec4 currD = texture2D(depthTexture, v_textureCoordinates);\n    if(currD.r>=1.0){\n        gl_FragColor = color;\n        return;\n    }\n    float depth = getDepth(currD);\n    vec4 positionEC = toEye(v_textureCoordinates, depth);\n    vec4 videoPosition = videoMapMatrix * positionEC;\n    videoPosition /= videoPosition.w;\n    if (any(lessThan(videoPosition.xyz, vec3(0.0))) || any(greaterThan(videoPosition.xyz, vec3(1.0))))\n    {\n        gl_FragColor = color;\n        return;\n    }\n    bool visibility = videoVisibility(videoMapTexture, videoPosition);\n    if(visibility){\n        vec4 videoColor = u_videoColor;\n        gl_FragColor = vec4(mix(color.rgb, videoColor.rgb, mixNum), 1.0);\n    }else{\n        gl_FragColor = color;\n    }\n}",c._FS_Sphere="uniform float mixNum;\nuniform float videoDistance;\nuniform sampler2D colorTexture;\nuniform sampler2D videoMapTexture;\nuniform sampler2D videoTexture;\nuniform sampler2D depthTexture;\nuniform mat4 videoMapMatrix;\nuniform mat4 videoViewMatrix;\nuniform vec3 videoMapPosition;\nuniform vec4 u_videoColor;\nvarying vec2 v_textureCoordinates;\nvec4 toEye(in vec2 uv, in float depth){\n    vec2 xy = vec2((uv.x * 2.0 - 1.0),(uv.y * 2.0 - 1.0));\n    vec4 posInCamera =czm_inverseProjection * vec4(xy, depth, 1.0);\n    posInCamera = posInCamera / posInCamera.w;\n    return posInCamera;\n}\nfloat getDepth(in vec4 depth){\n    float z_window = czm_unpackDepth(depth);\n    z_window = czm_reverseLogDepth(z_window);\n    float n_range = czm_depthRange.near;\n    float f_range = czm_depthRange.far;\n    return (2.0 * z_window - n_range - f_range) / (f_range - n_range);\n}\nbool videoVisibility(sampler2D shadowMap, vec4 position){\n    float visibility = step(position.z, texture2D(shadowMap, position.xy).r);\n    return (visibility == 1.0);\n}\nvoid main()\n{\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\n    vec4 currD = texture2D(depthTexture, v_textureCoordinates);\n    if(currD.r>=1.0){\n        gl_FragColor = color;\n        return;\n    }\n    float depth = getDepth(currD);\n    vec4 positionEC = toEye(v_textureCoordinates, depth);\n    vec4 videoPosition = videoMapMatrix * positionEC;\n    videoPosition /= videoPosition.w;\n    if (any(lessThan(videoPosition.xyz, vec3(0.0))) || any(greaterThan(videoPosition.xyz, vec3(1.0))))\n    {\n        gl_FragColor = color;\n        return;\n    }\n    bool visibility = videoVisibility(videoMapTexture, videoPosition);\n    if(visibility){\n        mat4 viewScene = videoViewMatrix;\n        vec4 positionWC = viewScene * positionEC;\n        positionWC /= positionWC.w;\n        depth = length(videoMapPosition - positionWC.xyz);\n        if(depth - videoDistance > -0.5){\n            gl_FragColor = color;\n            return;\n        }\n        vec4 videoColor = texture2D(videoTexture, videoPosition.xy);\n        gl_FragColor = vec4(mix(color.rgb, videoColor.rgb, mixNum), 1.0);\n    }else{\n        gl_FragColor = color;\n    }\n}",c._FS_Sphere_Fill="uniform float mixNum;\nuniform float videoDistance;\nuniform sampler2D colorTexture;\nuniform sampler2D videoMapTexture;\nuniform sampler2D depthTexture;\nuniform mat4 videoMapMatrix;\nuniform mat4 videoViewMatrix;\nuniform vec3 videoMapPosition;\nuniform vec4 u_videoColor;\nvarying vec2 v_textureCoordinates;\nvec4 toEye(in vec2 uv, in float depth){\n    vec2 xy = vec2((uv.x * 2.0 - 1.0),(uv.y * 2.0 - 1.0));\n    vec4 posInCamera =czm_inverseProjection * vec4(xy, depth, 1.0);\n    posInCamera = posInCamera / posInCamera.w;\n    return posInCamera;\n}\nfloat getDepth(in vec4 depth){\n    float z_window = czm_unpackDepth(depth);\n    z_window = czm_reverseLogDepth(z_window);\n    float n_range = czm_depthRange.near;\n    float f_range = czm_depthRange.far;\n    return (2.0 * z_window - n_range - f_range) / (f_range - n_range);\n}\nbool videoVisibility(sampler2D shadowMap, vec4 position){\n    float visibility = step(position.z, texture2D(shadowMap, position.xy).r);\n    return (visibility == 1.0);\n}\nvoid main()\n{\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\n    vec4 currD = texture2D(depthTexture, v_textureCoordinates);\n    if(currD.r>=1.0){\n        gl_FragColor = color;\n        return;\n    }\n    float depth = getDepth(currD);\n    vec4 positionEC = toEye(v_textureCoordinates, depth);\n    vec4 videoPosition = videoMapMatrix * positionEC;\n    videoPosition /= videoPosition.w;\n    if (any(lessThan(videoPosition.xyz, vec3(0.0))) || any(greaterThan(videoPosition.xyz, vec3(1.0))))\n    {\n        gl_FragColor = color;\n        return;\n    }\n    bool visibility = videoVisibility(videoMapTexture, videoPosition);\n    if(visibility){\n        mat4 viewScene = videoViewMatrix;\n        vec4 positionWC = viewScene * positionEC;\n        positionWC /= positionWC.w;\n        depth = length(videoMapPosition - positionWC.xyz);\n        if(depth - videoDistance > -0.5){\n            gl_FragColor = color;\n            return;\n        }\n        vec4 videoColor = u_videoColor;\n        gl_FragColor = vec4(mix(color.rgb, videoColor.rgb, mixNum), 1.0);\n    }else{\n        gl_FragColor = color;\n    }\n}",x.defineProperties(c.prototype,{CreationEvent:{get:function(){return this._createEvent}},AddToSceneEvent:{get:function(){return this._addEvent}},RemoveFromSceneEvent:{get:function(){return this._removeEvent}}}),c.prototype._updateState=function(){var t=this._videoProjection;if(t){if(this._videoTexture=t._getCurrentVideoTexture(),this._videoTexture)t.fillVideo||(this._videoTexture=null);else if(t.fillVideo)return void this._removeFromScene();this._createUniforms(),this._createPostStage(),this._addToScene()}},c.prototype._clearData=function(){this._uniforms=null,this._removeFromScene()},c.prototype._addToScene=function(){this._postStage&&(this._scene.postProcessStages.contains(this._postStage)||(this._scene.postProcessStages.add(this._postStage),this._addEvent.raiseEvent(this)))},c.prototype._removeFromScene=function(){this._postStage&&this._scene.postProcessStages.contains(this._postStage)&&(this._scene.postProcessStages.remove(this._postStage),this._postStage=null,this._removeEvent.raiseEvent(this))},c.prototype._createUniforms=function(){if(!this._uniforms){var t=this,e=t._videoProjection;t._videoTexture?this._uniforms={mixNum:function(){return e.mixFactor},videoMapTexture:function(){return e._getShadowMapTexture()},videoTexture:function(){return t._videoTexture},videoMapMatrix:function(){return e._getShadowMapMatrix()},videoViewMatrix:function(){return e._getViewMatrix()},videoDistance:function(){return e.fovDistance},videoMapPosition:function(){return e.position},u_videoColor:function(){return e.hitlineColor}}:this._uniforms={mixNum:function(){return e.mixFactor},videoMapTexture:function(){return e._getShadowMapTexture()},videoMapMatrix:function(){return e._getShadowMapMatrix()},videoViewMatrix:function(){return e._getViewMatrix()},videoDistance:function(){return e.fovDistance},videoMapPosition:function(){return e.position},u_videoColor:function(){return e.hitlineColor}}}},c.prototype._updatePost=function(){var t=this._postStage;t&&(t.enabled=this._videoProjection._actived)},c.prototype._createPostStage=function(){if(!this._postStage){var t=null;t=1==this._videoProjection.hitlineType?this._videoTexture?c._FS_Cone:c._FS_Cone_Fill:this._videoTexture?c._FS_Sphere:c._FS_Sphere_Fill,this._postStage=new x.PostProcessStage({fragmentShader:t,enabled:!1,uniforms:this._uniforms}),this._createEvent.raiseEvent(this)}},c.prototype._destroyPostStage=function(){this._postStage&&this._removeFromScene(),this._uniforms=null};function a(){this._minFovX=a._MinFovX,this._maxFovX=a._MaxFovX,this._minFovY=a._MinFovY,this._maxFovY=a._MaxFovY,this._minFovDistance=a._MinFovDistance,this._maxFovDistance=a._MaxFovDistance,this._minHeading=a._MinHeading,this._maxHeading=a._MaxHeading,this._minPitch=a._MinPitch,this._maxPitch=a._MaxPitch,this._minRoll=a._MinRoll,this._maxRoll=a._MaxRoll,this._minSegmentCount=a._MinSegmentCount,this._maxSegmentCount=a._MaxSegmentCount,this._isInvSphere=!1,this._isSphereType=!0}x.defineProperties(a.prototype,{minFovX:{get:function(){return this._minFovX},set:function(t){this._minFovX=t}},maxFovX:{get:function(){return this._maxFovX},set:function(t){this._maxFovX=t}},minFovY:{get:function(){return this._minFovY},set:function(t){this._minFovY=t}},maxFovY:{get:function(){return this._maxFovY},set:function(t){this._maxFovY=t}},minFovDistance:{get:function(){return this._minFovDistance},set:function(t){this._minFovDistance=t}},maxFovDistance:{get:function(){return this._maxFovDistance},set:function(t){this._maxFovDistance=t}},minHeading:{get:function(){return this._minHeading},set:function(t){this._minHeading=t}},maxHeading:{get:function(){return this._maxHeading},set:function(t){this._maxHeading=t}},minPitch:{get:function(){return this._minPitch},set:function(t){this._minPitch=t}},maxPitch:{get:function(){return this._maxPitch},set:function(t){this._maxPitch=t}},minRoll:{get:function(){return this._minRoll},set:function(t){this._minRoll=t}},maxRoll:{get:function(){return this._maxRoll},set:function(t){this._maxRoll=t}},minSegmentCount:{get:function(){return this._minSegmentCount},set:function(t){this._minSegmentCount=t}},maxSegmentCount:{get:function(){return this._maxSegmentCount},set:function(t){this._maxSegmentCount=t}},isInvSphere:{get:function(){return this._isInvSphere},set:function(t){this._isInvSphere=t}},isSphereType:{get:function(){return this._isSphereType},set:function(t){this._isSphereType=t}}}),a._MinSegmentCount=5,a._MaxSegmentCount=10,a._MinFovX=1,a._MaxFovX=160,a._MinFovY=1,a._MaxFovY=90,a._MinFovDistance=1,a._MaxFovDistance=500,a._MinHeading=-180,a._MaxHeading=180,a._MinRoll=-90,a._MaxRoll=90,a._MinPitch=-90,a._MaxPitch=90,a.prototype.clampSegmentCount=function(t){return t?t<this._minSegmentCount?this._minSegmentCount:t>this._maxSegmentCount?this._maxSegmentCount:t:this._minSegmentCount},a.prototype.clampFovX=function(t){return t?t<this._minFovX?this._minFovX:t>this._maxFovX?this._maxFovX:t:this._maxFovX},a.prototype.clampFovY=function(t){return t?t<this._minFovY?this._minFovY:t>this._maxFovY?this._maxFovY:t:this._maxFovY},a.prototype.clampFovDistance=function(t){return t?t<this._minFovDistance?this._minFovDistance:t>this._maxFovDistance?this._maxFovDistance:t:this._minFovDistance},a.prototype.clampHeading=function(t){return t?t<this._minHeading?this._minHeading:t>this._maxHeading?this._maxHeading:t:0},a.prototype.clampPitch=function(t){return t?t<this._minPitch?this._minPitch:t>this._maxPitch?this._maxPitch:t:0},a.prototype.clampRoll=function(t){return t?t<this._minRoll?this._minRoll:t>this._maxRoll?this._maxRoll:t:0};function g(t,e,i){this._scene=t,this._position=e?e.clone():null,this._videoProjection=i,this._videoProjectionCamera=null,this._fovX=120,this._fovY=60,this._fovDistance=20,this._heading=0,this._pitch=0,this._roll=0,this._color=x.Color.BLUE.clone(),this._lineWidth=2,this._mixFactor=.8,this._vs=null,this._fs=null,this._boundingVolume=null,this._renderState=null,this._segmentCount=10,this._drawCommand=null,this._isNeedRecreate=!0,this._id=x.createGuid(),this._errorEvent=new x.Event,this._actived=!1,this._visibly=!0}g.prototype.destroy=function(){this._scene=null,this._videoProjection=null,this._id=null,this._errorEvent=null,this._boundingVolume=null,this._videoProjectionCamera=null,this._renderState=null,this._actived=!1,this._visibly=!1,this._drawCommand&&(this._drawCommand._shaderProgram&&(this._drawCommand._shaderProgram.destroy(),this._drawCommand._shaderProgram=null),this._drawCommand._vertexArray&&(this._drawCommand._vertexArray.destroy(),this._drawCommand._vertexArray=null),this._drawCommand=null)},x.defineProperties(g.prototype,{id:{get:function(){return this._id},set:function(t){this._id=t}},actived:{get:function(){return this._actived},set:function(t){this._actived=t}},visibly:{get:function(){return this._visibly},set:function(t){this._visibly=t}},DeveloperErrorEvent:{get:function(){return this._errorEvent}},minFovX:{get:function(){return this._videoProjection.config.minFovX}},maxFovX:{get:function(){return this._videoProjection.config.maxFovX}},minFovY:{get:function(){return this._videoProjection.config.minFovY}},maxFovY:{get:function(){return this._videoProjection.config.maxFovY}},minFovDistance:{get:function(){return this._videoProjection.config.minFovDistance}},maxFovDistance:{get:function(){return this._videoProjection.config.maxFovDistance}},minHeading:{get:function(){return this._videoProjection.config.minHeading}},maxHeading:{get:function(){return this._videoProjection.config.maxHeading}},minPitch:{get:function(){return this._videoProjection.config.minPitch}},maxPitch:{get:function(){return this._videoProjection.config.maxPitch}},minRoll:{get:function(){return this._videoProjection.config.minRoll}},maxRoll:{get:function(){return this._videoProjection.config.maxRoll}},minSegmentCount:{get:function(){return this._videoProjection.config.minSegmentCount}},maxSegmentCount:{get:function(){return this._videoProjection.config.maxSegmentCount}},isSphereType:{get:function(){return this._videoProjection.config.isSphereType}},isInvSphere:{get:function(){return this._videoProjection.config.isInvSphere}},position:{get:function(){return this._position}},fovX:{get:function(){return this._fovX},set:function(t){t<this.minFovX||t>this.maxFovX?this._errorEvent.raiseEvent("fovX!"):this._fovX!==t&&(this._fovX=t,this._isNeedRecreate=!0)}},fovY:{get:function(){return this._fovY},set:function(t){t<this.minFovY||t>this.maxFovY?this._errorEvent.raiseEvent("fovY!"):this._fovY!==t&&(this._fovY=t,this._isNeedRecreate=!0)}},fovDistance:{get:function(){return this._fovDistance},set:function(t){t<this.minFovDistance||t>this.maxFovDistance?this._errorEvent.raiseEvent("fovDistance!"):this._fovDistance!==t&&(this._fovDistance=t,this._isNeedRecreate=!0)}},heading:{get:function(){return this._heading},set:function(t){t<this.minHeading||t>this.maxHeading?this._errorEvent.raiseEvent("heading!"):this._heading!==t&&(this._heading=t,this._isNeedRecreate=!0)}},roll:{get:function(){return this._roll},set:function(t){t<this.minRoll||t>this.maxRoll?this._errorEvent.raiseEvent("roll!"):this._roll!==t&&(this._roll=t,this._isNeedRecreate=!0)}},pitch:{get:function(){return this._pitch},set:function(t){t<this.minPitch||t>this.maxPitch?this._errorEvent.raiseEvent("pitch!"):this._pitch!==t&&(this._pitch=t,this._isNeedRecreate=!0)}},color:{get:function(){return this._color},set:function(t){this._color=t.clone()}},lineWidth:{get:function(){return this._lineWidth},set:function(t){t<1?this._errorEvent.raiseEvent("lineWidth!"):this._lineWidth=t}},mixFactor:{get:function(){return this._mixFactor},set:function(t){t<0||1<t?this._errorEvent.raiseEvent("mixFactor!"):this._mixFactor=t}},drawCommand:{get:function(){return this._drawCommand}}}),g.prototype._render=function(t,e){this._actived&&this._visibly&&(e&&this._videoProjection===e?(e._getProjectionCamera&&(this._videoProjectionCamera=e._getProjectionCamera()),this.update(t),this._videoProjectionCamera=null):this._errorEvent.raiseEvent("render!"))},g.prototype.update=function(t){this._drawCommand&&t?t.commandList.push(this._drawCommand):this._errorEvent.raiseEvent("update!")},g.prototype._updatePosition=function(t){t&&(this._position=t.clone(),this._isNeedRecreate=!0,this._tryCreate())},g.prototype._updateFovX=function(t){t&&(this.fovX=t,this._tryCreate())},g.prototype._updateFovY=function(t){t&&(this.fovY=t,this._tryCreate())},g.prototype._updateFovDistance=function(t){t&&(this.fovDistance=t,this._tryCreate())},g.prototype._updateHeading=function(t){t&&(this.heading=t,this._tryCreate())},g.prototype._updatePitch=function(t){t&&(this.pitch=t,this._tryCreate())},g.prototype._updateRoll=function(t){t&&(this.roll=t,this._tryCreate())},g.prototype._updateParams=function(t,e,i,r,n,o){t&&(this.fovX=t),e&&(this.fovY=e),i&&(this.fovDistance=i),r&&(this.heading=r),n&&(this.pitch=n),o&&(this.roll=o),this._tryCreate()},g.prototype._createUniforms=function(){var t=this;return{uDiffuseColor:function(){return t.color}}};g.prototype._computeTransform=function(){if(!this.position)return this._errorEvent.raiseEvent("_computeTransform!"),null;var t=null;(t=this._videoProjectionCamera?x.Camera.clone(this._videoProjectionCamera,null):x.Camera.clone(this._scene.camera,null)).frustum.aspectRatio=this.fovX/this.fovY,t.frustum.fov=this.fovX*x.Math.RADIANS_PER_DEGREE,t.frustum.near=.1,t.frustum.far=this.fovDistance,t.setView({destination:this.position,orientation:{heading:this.heading*x.Math.RADIANS_PER_DEGREE,pitch:this.pitch*x.Math.RADIANS_PER_DEGREE,roll:this.roll*x.Math.RADIANS_PER_DEGREE}});var e=new x.Matrix4;return e[0]=t.right.x,e[1]=t.right.y,e[2]=t.right.z,e[3]=0,e[4]=t.direction.x,e[5]=t.direction.y,e[6]=t.direction.z,e[7]=0,e[8]=t.up.x,e[9]=t.up.y,e[10]=t.up.z,e[11]=0,e[12]=t.position.x,e[13]=t.position.y,e[14]=t.position.z,e[15]=1,e},g.prototype._computeTransformInv=function(){if(!this.position)return this._errorEvent.raiseEvent("_computeTransform!"),null;var t=null;return(t=this._videoProjectionCamera?x.Camera.clone(this._videoProjectionCamera,null):x.Camera.clone(this._scene.camera,null)).frustum.aspectRatio=this.fovX/this.fovY,t.frustum.fov=this.fovX*x.Math.RADIANS_PER_DEGREE,t.frustum.near=1,t.frustum.far=this.fovDistance,t.setView({destination:this.position,orientation:{heading:this.heading*x.Math.RADIANS_PER_DEGREE,pitch:this.pitch*x.Math.RADIANS_PER_DEGREE,roll:this.roll*x.Math.RADIANS_PER_DEGREE}}),t.inverseViewMatrix.clone()},g.prototype._createVS=function(){return"attribute vec4 aPosition;\nuniform vec4 uDiffuseColor;\nvarying vec4 vColor;\nvarying vec4 clip_vertex;\nvarying float fWindowZ;\nvarying vec3 normal_vertex;\nvec4 depthClampFarPlane(vec4 clipPos)\n{\n    fWindowZ = (0.5 * (clipPos.z / clipPos.w) + 0.5) * clipPos.w;\n    clipPos.z = min(clipPos.z, clipPos.w);\n    return clipPos;\n}\nvoid main()\n{\n    vec4 pos = czm_modelViewProjection * vec4(aPosition.xyz, 1.0);\n    gl_Position = depthClampFarPlane(pos);\n    clip_vertex = czm_modelView * vec4(aPosition.xyz, 1.0);\n    vColor = uDiffuseColor;\n    normal_vertex = aPosition.xyz;\n}"},g.prototype._createFS=function(){return"#extension GL_EXT_frag_depth : enable\n#extension GL_OES_standard_derivatives : enable\nvarying vec4 vColor;\nvarying float fWindowZ;\nvarying vec3 normal_vertex;\nconst vec4 LIGHT_COLOR = vec4(0.8, 0.8, 0.8, 1.0);\nvoid main()\n{\n    gl_FragDepthEXT = min(fWindowZ * gl_FragCoord.w, 1.0);\n    vec3 normal = cross(vec3(dFdx(normal_vertex.x), dFdx(normal_vertex.y), dFdx(normal_vertex.z)), vec3(dFdy(normal_vertex.x), dFdy(normal_vertex.y), dFdy(normal_vertex.z)));\n    normal = normalize(normal);\n    vec4 eyePosition = czm_modelView * vec4(normal_vertex.xyz, 1.0);\n    vec3 lightDirection = normalize(czm_sunPositionWC - vec3(eyePosition));\n    float nDotL = max(dot(lightDirection, normal), 0.0);\n    vec4 diffuse = vColor * LIGHT_COLOR * nDotL;\n    vec4 ambient = vColor * LIGHT_COLOR;\n    gl_FragColor = clamp(diffuse + ambient, vec4(0.0), vec4(1.0));\n}"},g.prototype._createVACone=function(){var t=this._scene.context;if(!t)return this._errorEvent.raiseEvent("_createVA!"),null;var e=this._fovDistance,i=x.ComponentDatatype.createTypedArray(x.ComponentDatatype.FLOAT,15),r=3,n=this._fovX*x.Math.RADIANS_PER_DEGREE,o=this._fovY*x.Math.RADIANS_PER_DEGREE;if(Math.pow(Math.cos(.5*n),2)<.001)return null;var a=e/Math.cos(.5*n),s=e*Math.tan(.5*o);e=Math.sqrt(a*a+s*s);for(var l=x.Math.PI_OVER_TWO+.5*n,h=.5*o,c=0,g=0,u=n/1,d=o/1,p=0;p<2;p++){c=l-p*u;for(var C=0;C<2;C++)g=h-C*d,i[r++]=e*Math.cos(g)*Math.cos(c),i[r++]=e*Math.cos(g)*Math.sin(c),i[r++]=e*Math.sin(g)}var m=x.ComponentDatatype.createTypedArray(x.ComponentDatatype.UNSIGNED_SHORT,16),f=0;m[f++]=0,m[f++]=1,m[f++]=0,m[f++]=2,m[f++]=0,m[f++]=3,m[f++]=0,m[f++]=4;for(p=0;p<2;p++)for(C=0;C<1;C++)m[f++]=1+C+2*p,m[f++]=1+(C+1)+2*p;for(p=0;p<2;p++)for(C=0;C<1;C++)m[f++]=1+2*C+p,m[f++]=1+2*(C+1)+p;var v=x.Buffer.createVertexBuffer({context:t,typedArray:i,usage:x.BufferUsage.STATIC_DRAW}),A=x.Buffer.createIndexBuffer({context:t,typedArray:m,usage:x.BufferUsage.STATIC_DRAW,indexDatatype:x.IndexDatatype.UNSIGNED_SHORT}),I=[];return I.push({index:0,vertexBuffer:v,componentsPerAttribute:3,componentDatatype:x.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:12,normalize:!1}),this._createBoundingVolume(i),new x.VertexArray({context:t,attributes:I,indexBuffer:A})},g.prototype._createVASphere=function(){var t=this._scene.context;if(!t)return this._errorEvent.raiseEvent("_createVA!"),null;var e=Math.max(this._segmentCount,this.minSegmentCount);e=Math.min(e,this.maxSegmentCount);for(var i=this._fovDistance,r=(e+1)*(e+1)+1,n=x.ComponentDatatype.createTypedArray(x.ComponentDatatype.FLOAT,3*r),o=3,a=this._fovX*x.Math.RADIANS_PER_DEGREE,s=this._fovY*x.Math.RADIANS_PER_DEGREE,l=x.Math.PI_OVER_TWO+.5*a,h=.5*s,c=0,g=0,u=a/e,d=s/e,p=0;p<e+1;p++){c=l-p*u;for(var C=0;C<e+1;C++)g=h-C*d,n[o++]=i*Math.cos(g)*Math.cos(c),n[o++]=i*Math.cos(g)*Math.sin(c),n[o++]=i*Math.sin(g)}var m=4*(2+(e+1)*e),f=x.ComponentDatatype.createTypedArray(x.ComponentDatatype.UNSIGNED_SHORT,m),v=0;f[v++]=0,f[v++]=1,f[v++]=0,f[v++]=e+1,f[v++]=0,f[v++]=e*(e+1)+1,f[v++]=0,f[v++]=(e+1)*(e+1);for(p=0;p<e+1;p++)for(C=0;C<e;C++)f[v++]=1+C+(e+1)*p,f[v++]=1+(C+1)+(e+1)*p;for(p=0;p<e+1;p++)for(C=0;C<e;C++)f[v++]=1+(e+1)*C+p,f[v++]=1+(e+1)*(C+1)+p;var A=x.Buffer.createVertexBuffer({context:t,typedArray:n,usage:x.BufferUsage.STATIC_DRAW}),I=x.Buffer.createIndexBuffer({context:t,typedArray:f,usage:x.BufferUsage.STATIC_DRAW,indexDatatype:x.IndexDatatype.UNSIGNED_SHORT}),_=[];return _.push({index:0,vertexBuffer:A,componentsPerAttribute:3,componentDatatype:x.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:12,normalize:!1}),this._createBoundingVolume(n),new x.VertexArray({context:t,attributes:_,indexBuffer:I})},g.prototype._createVASphereInv=function(){var t=this._scene.context;if(!t)return this._errorEvent.raiseEvent("_createVA!"),null;var e=Math.max(this._segmentCount,this.minSegmentCount);e=Math.min(e,this.maxSegmentCount);for(var i=this._fovDistance,r=(e+1)*(e+1)+1,n=x.ComponentDatatype.createTypedArray(x.ComponentDatatype.FLOAT,3*r),o=3,a=this._fovX*x.Math.RADIANS_PER_DEGREE,s=this._fovY*x.Math.RADIANS_PER_DEGREE,l=i*Math.tan(.5*s),h=Math.PI-.5*a,c=0,g=0,u=a/e,d=0;d<e+1;d++){c=h+d*u;for(var p=l/(i/Math.cos(c)),C=Math.atan(p),m=-C,f=2*C/e,v=0;v<e+1;v++)g=m+v*f,n[o++]=i*Math.cos(g)*Math.sin(c),n[o++]=i*Math.sin(g),n[o++]=i*Math.cos(g)*Math.cos(c)}var A=4*(2+(e+1)*e),I=x.ComponentDatatype.createTypedArray(x.ComponentDatatype.UNSIGNED_SHORT,A),_=0;I[_++]=0,I[_++]=1,I[_++]=0,I[_++]=e+1,I[_++]=0,I[_++]=e*(e+1)+1,I[_++]=0,I[_++]=(e+1)*(e+1);for(d=0;d<e+1;d++)for(v=0;v<e;v++)I[_++]=1+v+(e+1)*d,I[_++]=1+(v+1)+(e+1)*d;for(d=0;d<e+1;d++)for(v=0;v<e;v++)I[_++]=1+(e+1)*v+d,I[_++]=1+(e+1)*(v+1)+d;var y=x.Buffer.createVertexBuffer({context:t,typedArray:n,usage:x.BufferUsage.STATIC_DRAW}),w=x.Buffer.createIndexBuffer({context:t,typedArray:I,usage:x.BufferUsage.STATIC_DRAW,indexDatatype:x.IndexDatatype.UNSIGNED_SHORT}),P=[];return P.push({index:0,vertexBuffer:y,componentsPerAttribute:3,componentDatatype:x.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:12,normalize:!1}),this._createBoundingVolume(n),new x.VertexArray({context:t,attributes:P,indexBuffer:w})},g.prototype._createRenderState=function(){return x.RenderState.fromCache({cull:{enabled:!1},depthTest:{enabled:!0}})},g.prototype._createAttributes=function(){var t={aPosition:0};return t},g.prototype._createShadeProgram=function(){var t=this._scene.context;if(!t)return this._errorEvent.raiseEvent("_createShadeProgram!"),null;var e=this._createVS(),i=this._createFS(),r=this._createAttributes();return r?x.ShaderProgram.fromCache({context:t,vertexShaderSource:e,fragmentShaderSource:i,attributeLocations:r}):(this._errorEvent.raiseEvent("_createShadeProgram!"),null)};var u=new x.Cartesian3,d=new x.Cartesian3;g.prototype._createBoundingVolume=function(t){if(t&&t.length&&6<=t.length){for(var e=3,i=t[0],r=t[1],n=t[2],o=t[0],a=t[1],s=t[2],l=0;e<t.length;e+=3)l=t[e],i=Math.min(l,i),o=Math.max(l,o),l=t[e+1],r=Math.min(l,r),a=Math.max(l,a),l=t[e+2],n=Math.min(l,n),s=Math.max(l,s);u.x=i,u.y=r,u.z=n,d.x=o,d.y=a,d.z=s,this._boundingVolume=x.BoundingSphere.fromCornerPoints(u,d)}else this._boundingVolume=new x.BoundingSphere(x.Cartesian3.ZERO,this.fovDistance)};var i=new x.BoundingSphere(x.Cartesian3.ZERO,1);g.prototype._updateBoundingVolume=function(t){var e=this._boundingVolume;return e?(x.BoundingSphere.transform(e,t,i),i):(this._errorEvent.raiseEvent("_updateBoundingVolume!"),null)},g.prototype._tryCreate=function(){try{this._recreate()}catch(t){this._drawCommand=null}},g.prototype._recreate=function(){if(this._isNeedRecreate){this._isNeedRecreate=!1,this._drawCommand&&(this._drawCommand._shaderProgram&&(this._drawCommand._shaderProgram.destroy(),this._drawCommand._shaderProgram=null),this._drawCommand._vertexArray&&(this._drawCommand._vertexArray.destroy(),this._drawCommand._vertexArray=null),this._drawCommand=null);var t=null;if(t=this.isInvSphere&&this.isSphereType?this._computeTransformInv():this._computeTransform()){var e=null;if(e=this.isSphereType?this.isInvSphere?this._createVASphereInv():this._createVASphere():this._createVACone()){var i=this._createRenderState();if(i){var r=this._createShadeProgram();if(r){var n=this._createUniforms(),o=this._updateBoundingVolume(t);o?this._drawCommand=new x.DrawCommand({vertexArray:e,primitiveType:x.PrimitiveType.LINES,renderState:i,shaderProgram:r,modelMatrix:t,boundingVolume:o,uniformMap:n,owner:this._videoProjection,pass:x.Pass.OPAQUE}):this._errorEvent.raiseEvent("_recreate!")}else this._errorEvent.raiseEvent("_recreate!")}else this._errorEvent.raiseEvent("_recreate!")}else this._errorEvent.raiseEvent("_recreate!")}else this._errorEvent.raiseEvent("_recreate!")}};function p(t,e){this._shadowMap=null,this._scene=t,this._owner=e,this._actived=!1,this._updateMatrixEvent=new x.Event,this._updateEvent=new x.Event}x.defineProperties(p.prototype,{UpdateMatrixEvent:{get:function(){return this._updateMatrixEvent}},UpdateEvent:{get:function(){return this._updateEvent}}}),p.prototype._createSampler=function(){return new x.Sampler({wrapS:x.TextureWrap.CLAMP_TO_EDGE,wrapT:x.TextureWrap.CLAMP_TO_EDGE,minificationFilter:x.TextureMinificationFilter.NEAREST,magnificationFilter:x.TextureMagnificationFilter.NEAREST})},p.prototype._createFramebufferDepth=function(t,e){for(var i=new x.Texture({context:e,width:t._textureSize.x,height:t._textureSize.y,pixelFormat:x.PixelFormat.DEPTH_STENCIL,pixelDatatype:x.PixelDatatype.UNSIGNED_INT_24_8,sampler:this._createSampler()}),r=new x.Framebuffer({context:e,depthStencilTexture:i,destroyAttachments:!1}),n=t._passes.length,o=0;o<n;++o){var a=t._passes[o];a.framebuffer=r,a.passState.framebuffer=r}t._shadowMapTexture=i,t._depthAttachment=i},p.prototype._clearFramebuffer=function(t,e){t._clearCommand.framebuffer=t._passes[0].framebuffer,t._clearCommand.execute(e,t._clearPassState)},p.prototype._destroyShadowFramebuffer=function(){var t=this._shadowMap;if(t){for(var e=t._passes.length,i=0;i<e;++i){var r=t._passes[i],n=r.framebuffer;x.defined(n)&&!n.isDestroyed()&&n.destroy(),r.framebuffer=void 0}t._depthAttachment=t._depthAttachment&&t._depthAttachment.destroy(),t._colorAttachment=t._colorAttachment&&t._colorAttachment.destroy();var o=this._scene.frameState.context;this._createFramebufferDepth(t,o),this._clearFramebuffer(t,o)}},p.prototype.build=function(t,e,i,r,n,o,a){if(!this._shadowMap){var s=this._scene;if(s){var l=this,h=new x.Camera(s);h.frustum=new x.PerspectiveFrustum,h.frustum.aspectRatio=e/i,h.frustum.fov=e*x.Math.RADIANS_PER_DEGREE,h.frustum.near=1,h.frustum.far=r,h.setView({destination:t,orientation:{heading:n*x.Math.RADIANS_PER_DEGREE,pitch:o*x.Math.RADIANS_PER_DEGREE,roll:a*x.Math.RADIANS_PER_DEGREE}});var c=this._shadowMap=new x.ShadowMap({lightCamera:h,enable:!1,isPointLight:!1,isSpotLight:!0,cascadesEnabled:!1,context:s.context,pointLightRadius:r});c._updateOri=c.update,c.update=function(t){c._updateOri(t);var e=c._sceneCamera._invViewMatrix;l._updateMatrixEvent.raiseEvent(e),l._updateEvent.raiseEvent()}}}},p.prototype.update=function(t,e,i,r,n,o){if(this._shadowMap){var a=this._shadowMap._lightCamera;a.frustum.aspectRatio=t/e,a.frustum.fov=t*x.Math.RADIANS_PER_DEGREE,a.frustum.near=1,a.frustum.far=i,a.setView({destination:a.position,orientation:{heading:r*x.Math.RADIANS_PER_DEGREE,pitch:n*x.Math.RADIANS_PER_DEGREE,roll:o*x.Math.RADIANS_PER_DEGREE}})}},p.prototype.destroy=function(){this.deactive(),this._shadowMap&&(this._shadowMap.destroy(),this._shadowMap=null),this._scene=null,this._owner=null,this._updateMatrixEvent=null,this._updateEvent=null},p.prototype.active=function(){if(this._shadowMap){var t=this._scene.primitives;this._actived=!0;var e=this._shadowMap,i=e._proxy;i||(i={update:function(t){t.videoProjectionMaps||(t.videoProjectionMaps=[]),e.update(t),t.videoProjectionMaps.indexOf(e)<0&&t.videoProjectionMaps.push(e)},owner:e,destroy:function(){this.owner&&(this.owner._proxy=null,this.owner=null)}},e._proxy=i),t.contains(i)||t.add(i)}},p.prototype.deactive=function(){if(this._actived&&this._shadowMap){var t=this._scene&&this._scene.primitives;this._actived=!1;var e=this._shadowMap,i=e._proxy;i&&(t.contains(i)&&t.remove(i),e._proxy=null);var r=this._scene;if(r){var n=r.frameState.videoProjectionMaps;if(n){var o=n.indexOf(this._shadowMap);0<=o&&n.splice(o,1)}}}},p.prototype.updatePosition=function(t,e,i,r){if(t){var n=this._shadowMap;if(n){e||0===e||(e=o.heading),i||0===i||(i=o.pitch),r||0===r||(r=o.roll);var o=n._lightCamera;o.setView({destination:t,orientation:{heading:e*x.Math.RADIANS_PER_DEGREE,pitch:i*x.Math.RADIANS_PER_DEGREE,roll:r*x.Math.RADIANS_PER_DEGREE}})}}},p.prototype.updateFovX=function(t){if(t){var e=this._shadowMap;if(e){var i=e._lightCamera,r=i.frustum.fov/i.frustum.aspectRatio;i.frustum.fov=t*x.Math.RADIANS_PER_DEGREE,i.frustum.aspectRatio=i.frustum.fov/r}}},p.prototype.updateFovY=function(t){if(t){var e=this._shadowMap;if(e){var i=e._lightCamera;i.frustum.aspectRatio=i.frustum.fov/(t*x.Math.RADIANS_PER_DEGREE)}}},p.prototype.updateFovDistance=function(t){if(t){var e=this._shadowMap;if(e)e._lightCamera.frustum.far=t}},p.prototype.updateHeadingPitchRoll=function(t,e,i){var r=this._shadowMap;if(r){t||0===t||(t=n.heading),e||0===e||(e=n.pitch),i||0===i||(i=n.roll);var n=r._lightCamera;n.setView({destination:n.position,orientation:{heading:t*x.Math.RADIANS_PER_DEGREE,pitch:e*x.Math.RADIANS_PER_DEGREE,roll:i*x.Math.RADIANS_PER_DEGREE}})}},p.prototype._getShadowMapTexture=function(){return this._shadowMap?this._shadowMap._shadowMapTexture:null},p.prototype._getShadowMapMatrix=function(){return this._shadowMap?this._shadowMap._shadowMapMatrix:null},p.prototype._getProjectionCamera=function(){return this._shadowMap?this._shadowMap._lightCamera:null};function s(){this._base=0}s.prototype._nextName=function(t){return t?t="VideoProjection"+t:(t="VideoProjection"+this._base.toString(),this._base+=1),t},s._instance=new s,s.nextName=function(){return s._instance._nextName()};var t=x.GeoVideoProjection=function(t,e,i,r,n){if(!t||!t.scene)throw x.DeveloperError("viewer or viewer.scene is invalid!");var o=t.scene;this._viewer=t,this._scene=o,this._videoProjectionConfig=new a,this._videoProjectionFrustumPrimitive=null,this._videoTextureSource=null,this._videoProjectionPostRender=null,this._videoShadowMap=null,this._invViewMatrix=null,this._fillVideo=!0,this._name=s.nextName(),this._actived=!1,this._owner=null,this._initialize(e,i,r,n)};t.prototype._initialize=function(t,e,i,r){var n=this,o=n._scene;if(t&&!(!t instanceof HTMLVideoElement)){r&&(r.minFovX&&(this._videoProjectionConfig.minFovX=r.minFovX),r.maxFovX&&(this._videoProjectionConfig.maxFovX=r.maxFovX),r.minFovY&&(this._videoProjectionConfig.minFovY=r.minFovY),r.maxFovY&&(this._videoProjectionConfig.maxFovY=r.maxFovY),r.minFovDistance&&(this._videoProjectionConfig.minFovDistance=r.minFovDistance),r.maxFovDistance&&(this._videoProjectionConfig.maxFovDistance=r.maxFovDistance),r.minHeading&&(this._videoProjectionConfig.minHeading=r.minHeading),r.maxHeading&&(this._videoProjectionConfig.maxHeading=r.maxHeading),r.minPitch&&(this._videoProjectionConfig.minPitch=r.minPitch),r.maxPitch&&(this._videoProjectionConfig.maxPitch=r.maxPitch),r.minRoll&&(this._videoProjectionConfig.minRoll=r.minRoll),r.maxRoll&&(this._videoProjectionConfig.maxRoll=r.maxRoll),r.isSphereType&&(this._videoProjectionConfig.isSphereType=r.isSphereType),r.isInvSphere&&(this._videoProjectionConfig.isInvSphere=r.isInvSphere)),(n._videoTextureSource=new h(t,o.context,this._viewer,this)).ErrorEvent.addEventListener(function(t){});var a=n._videoProjectionFrustumPrimitive=new g(o,e,this);i&&i instanceof x.Color&&(a.color=i),a.DeveloperErrorEvent.addEventListener(function(t){});var s=n._videoProjectionPostRender=new c(o,this);s.CreationEvent.addEventListener(function(t){}),s.AddToSceneEvent.addEventListener(function(t){}),s.RemoveFromSceneEvent.addEventListener(function(t){});var l=this._videoShadowMap=new p(o,this);l.UpdateMatrixEvent.addEventListener(function(t){n._invViewMatrix=t}),l.UpdateEvent.addEventListener(function(t){n._videoProjectionPostRender&&n._videoProjectionPostRender._updateState()})}},t.prototype._rebuildPostRender=function(){if(this._videoProjectionPostRender){this._videoProjectionPostRender.destroy();var t=this._videoProjectionPostRender=new c(this._scene,this);t.CreationEvent.addEventListener(function(t){}),t.AddToSceneEvent.addEventListener(function(t){}),t.RemoveFromSceneEvent.addEventListener(function(t){})}},t.prototype._render=function(t){var e=this._videoTextureSource;e&&e._render(t);var i=this._videoProjectionFrustumPrimitive;i&&i._render(t,this);var r=this._videoProjectionPostRender;r&&r._updatePost(t)},t.prototype._destroyShadowFramebuffer=function(){this._videoShadowMap&&this._videoShadowMap._destroyShadowFramebuffer()},t.prototype._getShadowMapTexture=function(){return this._videoShadowMap?this._videoShadowMap._getShadowMapTexture():null},t.prototype._getShadowMapMatrix=function(){return this._videoShadowMap?this._videoShadowMap._getShadowMapMatrix():null},t.prototype._getProjectionCamera=function(){return this._videoShadowMap?this._videoShadowMap._getProjectionCamera():null},t.prototype.update=function(t,e,i,r,n,o){var a=this._videoProjectionConfig;t=a.clampFovX(t),e=a.clampFovY(e),i=a.clampFovDistance(i),r=a.clampHeading(r),n=a.clampPitch(n),o=a.clampRoll(o);var s=this._videoProjectionFrustumPrimitive;s&&s._updateParams(t,e,i,r,n,o);var l=this._videoShadowMap;l&&l.update(t,e,i,r,n,o)},t.prototype.active=function(){this._actived=!0;var t=this._videoProjectionFrustumPrimitive;t&&(t.actived=!0);var e=this._createShadowMap();e&&e.active()},t.prototype.deactive=function(){var t=this._videoProjectionFrustumPrimitive;t&&(t.actived=!1);var e=this._videoProjectionPostRender;e&&e._destroyPostStage();var i=this._videoShadowMap;i&&i.deactive(),this._actived=!1},t.prototype.updatePosition=function(t){if(t){var e=this._videoProjectionFrustumPrimitive;e&&e._updatePosition(t);var i=this._videoShadowMap;i&&i.updatePosition(t,e.heading,e.pitch,e.roll)}},t.prototype.updateFovX=function(t){t=this._videoProjectionConfig.clampFovX(t);var e=this._videoProjectionFrustumPrimitive;e&&e._updateFovX(t);var i=this._videoShadowMap;i&&i.update(e.fovX,e.fovY,e.fovDistance,e.heading,e.pitch,e.roll)},t.prototype.updateFovY=function(t){t=this._videoProjectionConfig.clampFovY(t);var e=this._videoProjectionFrustumPrimitive;e&&e._updateFovY(t);var i=this._videoShadowMap;i&&i.update(e.fovX,e.fovY,e.fovDistance,e.heading,e.pitch,e.roll)},t.prototype.updateFovDistance=function(t){t=this._videoProjectionConfig.clampFovDistance(t);var e=this._videoProjectionFrustumPrimitive;e&&e._updateFovDistance(t);var i=this._videoShadowMap;i&&i.updateFovDistance(t)},t.prototype.updateHeading=function(t){t=this._videoProjectionConfig.clampHeading(t);var e=this._videoProjectionFrustumPrimitive;e&&e._updateHeading(t);var i=this._videoShadowMap;i&&i.updateHeadingPitchRoll(e.heading,e.pitch,e.roll)},t.prototype.updatePitch=function(t){t=this._videoProjectionConfig.clampPitch(t);var e=this._videoProjectionFrustumPrimitive;e&&e._updatePitch(t);var i=this._videoShadowMap;i&&i.updateHeadingPitchRoll(e.heading,e.pitch,e.roll)},t.prototype.updateRoll=function(t){t=this._videoProjectionConfig.clampRoll(t);var e=this._videoProjectionFrustumPrimitive;e&&e._updateRoll(t);var i=this._videoShadowMap;i&&i.updateHeadingPitchRoll(e.heading,e.pitch,e.roll)},t.prototype.updateHitLineColor=function(t){if(t){var e=this._videoProjectionFrustumPrimitive;e&&(e.color=t)}},t.prototype.updateMixFactor=function(t){if(t){var e=this._videoProjectionFrustumPrimitive;e&&(e.mixFactor=t)}},t.prototype.updateLineWidth=function(t){if(t){var e=this._videoProjectionFrustumPrimitive;e&&(e.lineWidth=t)}},t.prototype.isSamedName=function(t){if(t)return this._name==t._name},t.prototype.isSelf=function(t){return this._name==t},t.prototype._createShadowMap=function(){if(!this._videoShadowMap)return null;var t=this._videoProjectionFrustumPrimitive;if(!t)return null;var e=t.position,i=t.fovX,r=t.fovY,n=t.fovDistance,o=t.heading,a=t.pitch,s=t.roll;return this._videoShadowMap.build(e,i,r,n,o,a,s),this._videoShadowMap},t.prototype._getCurrentVideoTexture=function(){return this._videoTextureSource?this._videoTextureSource._getCurrentTexture():null},t.prototype._getViewMatrix=function(){return this._videoShadowMap?this._invViewMatrix:x.Matrix4.IDENTITY},t.prototype.destroy=function(){this.deactive(),this._videoProjectionFrustumPrimitive&&(this._videoProjectionFrustumPrimitive.destroy(),this._videoProjectionFrustumPrimitive=null),this._videoShadowMap&&(this._videoShadowMap.destroy(),this._videoShadowMap=null),this._videoProjectionPostRender&&(this._videoProjectionPostRender.destroy(),this._videoProjectionPostRender=null),this._videoTextureSource&&(this._videoTextureSource.destroy(),this._videoTextureSource=null),this._invViewMatrix=null,this._viewer=null,this._scene=null,this._owner=null},x.defineProperties(t.prototype,{name:{get:function(){return this._name}},fillVideo:{get:function(){return this._fillVideo},set:function(t){this._fillVideo!=t&&(this._fillVideo=t,this._rebuildPostRender())}},position:{get:function(){return this._videoProjectionFrustumPrimitive.position}},fovX:{get:function(){return this._videoProjectionFrustumPrimitive.fovX},set:function(t){this.updateFovX(t)}},fovY:{get:function(){return this._videoProjectionFrustumPrimitive.fovY},set:function(t){this.updateFovY(t)}},fovDistance:{get:function(){return this._videoProjectionFrustumPrimitive.fovDistance},set:function(t){this.updateFovDistance(t)}},heading:{get:function(){return this._videoProjectionFrustumPrimitive.heading},set:function(t){this.updateHeading(t)}},pitch:{get:function(){return this._videoProjectionFrustumPrimitive.pitch},set:function(t){this.updatePitch(t)}},roll:{get:function(){return this._videoProjectionFrustumPrimitive.roll},set:function(t){this.updateRoll(t)}},hitlineColor:{get:function(){return this._videoProjectionFrustumPrimitive.color},set:function(t){this.updateHitLineColor(t)}},mixFactor:{get:function(){return this._videoProjectionFrustumPrimitive.mixFactor},set:function(t){this.updateMixFactor(t)}},lineWidth:{get:function(){return this._videoProjectionFrustumPrimitive.lineWidth},set:function(t){this.updateLineWidth(t)}},hitlineType:{get:function(){return this._videoProjectionFrustumPrimitive._type}},hitlineVisibly:{get:function(){return this._videoProjectionFrustumPrimitive.visibly},set:function(t){this._videoProjectionFrustumPrimitive.visibly=t}},config:{get:function(){return this._videoProjectionConfig}},isActived:{get:function(){return this._actived}}});function e(){this._array=[],this._addEvent=new x.Event,this._removeEvent=new x.Event,this._removeAllEvent=new x.Event,this._projectBackFaces=!1}x.defineProperties(e.prototype,{length:{get:function(){return this._array.length}},AddEvent:{get:function(){return this._addEvent}},RemoveEvent:{get:function(){return this._removeEvent}},RemoveAllEvent:{get:function(){return this._removeAllEvent}},projectBackFaces:{get:function(){return this._projectBackFaces},set:function(t){if(this._projectBackFaces!=t){for(var e=this._array,i=e.length,r=0;r<i;r++){e[r]._destroyShadowFramebuffer()}this._projectBackFaces=t}}}}),e.prototype.add=function(t){if(t){var e=t.name;if(!e)throw"noname!";if(this._findByName(e))throw"exist!";this._array.push(t),this._addEvent.raiseEvent(t)}},e.prototype.destoryObject=function(t){if(t){var e=t.name;if(!e)throw"noname!";this._findByName(e)&&this.removeByName(e),t.destroy()}},e.prototype.destroy=function(){this.clear()},e.prototype.getCount=function(){return this._array.length},e.prototype.clear=function(){for(var t=this._array.length,e=0;e<t;e++){this._array[e].destroy(),this._array[e]=null}this.removeAll()},e.prototype._render=function(t){for(var e=this._array,i=e.length,r=0;r<i;r++){e[r]._render(t)}},e.prototype.getByIndex=function(t){var e=this._array.length;return t<0||e<=t?null:this._array[t]},e.prototype.getByName=function(t){return this._findByName(t)},e.prototype.removeByIndex=function(t){var e=this._array.length;t<0||e<=t||(this._array.splice(t,1),this._removeEvent.raiseEvent())},e.prototype.removeByName=function(t){for(var e=this._array.length,i=0;i<e;i++){if(this._array[i].isSelf(t))return this._array.splice(i,1),void this._removeEvent.raiseEvent()}},e.prototype.removeAll=function(){this._array.length=0,this._removeAllEvent.raiseEvent()},e.prototype._findByName=function(t){if(!t)return null;for(var e=this._array.length,i=0;i<e;i++){var r=this._array[i];if(r.isSelf(t))return r}return null},e.prototype.getNames=function(){for(var t=[],e=this._array.length,i=0;i<e;i++){var r=this._array[i];t.push(r.name)}return t},x.Scene.prototype.getVideoProjectionCollection=function(){return this._videoProjectionCollection||(this._videoProjectionCollection=new e),this._videoProjectionCollection},x.Scene.prototype._renderVideoProjectionCollection=function(t){this._videoProjectionCollection||(this._videoProjectionCollection=new e),this._videoProjectionCollection._render(t)},x.Scene.prototype.destroyAllVideoProjections=function(){this._videoProjectionCollection&&this._videoProjectionCollection.clear()},x.Scene.prototype.destroyVideoProjection=function(t){t&&this._videoProjectionCollection&&this._videoProjectionCollection.destoryObject(t)},x.Scene.prototype.createVideoProjection=function(t,e,i,r){try{var n=new x.GeoVideoProjection(t,e,i,r);if(n){var o=this.getVideoProjectionCollection();o&&o.add(n)}return n}catch(t){return null}},x.Scene.prototype._clearPassesVideoProjectionCommands=function(t){if(t)for(var e=t.passes,i=e.length,r=0;r<i;++r)e[r].commandList.length=0},x.Scene.prototype._executePassesVideoProjectionCommands=function(t,e,i,r,n){for(var o=0;o<e;++o){var a=t.passes[o];i.updateCamera(a.camera),t.updatePass(r,o);for(var s=a.commandList.length,l=0;l<s;++l){var h=a.commandList[l];i.updatePass(h.pass),this._executeVideoProjectionCommand(h.derivedCommands.shadows.castCommands[n],r,a.passState)}}},x.Scene.prototype._executeVideoProjectionCastCommands=function(){var t=this.frameState,e=t.videoProjectionMaps;if(e){var i=this._videoProjectionCollection;if(i&&!i.projectBackFaces)for(var r=e.length,n=this.context,o=n.uniformState,a=0;a<r;++a){var s=e[a];if(!s.outOfView){var l=s.passes.length;this._clearPassesVideoProjectionCommands(s);var h=t.commandList;this._insertVideoProjectionCastCommands(h,s),this._executePassesVideoProjectionCommands(s,l,o,n,a)}}}},x.Scene.prototype._insertVideoProjectionCastCommands=function(t,e){for(var i=e.shadowMapCullingVolume,r=e.passes,n=t.length,o=0;o<n;++o){var a=t[o];this._updateVideoProjectionCommand(a),!a.castShadows||a.pass!==x.Pass.GLOBE&&a.pass!==x.Pass.CESIUM_3D_TILE&&a.pass!==x.Pass.OPAQUE&&a.pass!==x.Pass.TRANSLUCENT||this.isVisible(a,i)&&r[0].commandList.push(a)}},x.Scene.prototype._updateVideoProjectionCommand=function(t){if(x.defined(t.derivedCommands)){var e=this._frameState,i=this._context,r=e.useLogDepth,n=this._hdr,o=t.derivedCommands,a=x.defined(o.originalCommand),s=!(r&&n||a);if(t.dirty=!0,t.dirty){t.dirty=!1;var l=e.videoProjectionMaps;t.castShadows&&(o.shadows=x.ShadowMap.createCastDerivedCommand(l,t,!0,i,o.shadows)),(a||s)&&this._updateVideoProjectionCommands(t)}}},x.Scene.prototype._executeVideoProjectionCommand=function(t,e,i){var r=this._frameState;if(!x.defined(this.debugCommandFilter)||this.debugCommandFilter(t))if(t instanceof x.ClearCommand)t.execute(e,i);else if(!t.debugShowBoundingVolume||!x.defined(t.boundingVolume)){r.useLogDepth&&x.defined(t.derivedCommands.logDepth)&&(t=t.derivedCommands.logDepth.command);var n=r.passes;if(!n.pick&&this._hdr&&x.defined(t.derivedCommands)&&x.defined(t.derivedCommands.hdr)&&(t=t.derivedCommands.hdr.command),n.pick||n.depth){if(n.pick&&!n.depth&&x.defined(t.derivedCommands.picking))return void(t=t.derivedCommands.picking.pickCommand).execute(e,i);if(x.defined(t.derivedCommands.depth))return void(t=t.derivedCommands.depth.depthOnlyCommand).execute(e,i)}this.debugShowCommands||this.debugShowFrustums||(r.shadowState.lightShadowsEnabled&&t.receiveShadows&&x.defined(t.derivedCommands.shadows)?t.derivedCommands.shadows.receiveCommand.execute(e,i):t.execute(e,i))}},x.Scene.prototype._updateVideoProjectionCommands=function(t){var e=this._frameState,i=this._context,r=this._view.oit,n=e.shadowState.lightShadowMaps,o=e.shadowState.lightShadowsEnabled,a=t.derivedCommands;x.defined(t.pickId)&&(a.picking=x.DerivedCommand.createPickDerivedCommand(this,t,i,a.picking)),t.pickOnly||(a.depth=x.DerivedCommand.createDepthOnlyDerivedCommand(this,t,i,a.depth)),a.originalCommand=t,this._hdr&&(a.hdr=x.DerivedCommand.createHdrCommand(t,i,a.hdr),a=(t=a.hdr.command).derivedCommands),o&&t.receiveShadows&&(a.shadows=x.ShadowMap.createReceiveDerivedCommand(n,t,!0,i,a.shadows)),t.pass===x.Pass.TRANSLUCENT&&x.defined(r)&&r.isSupported()&&(o&&t.receiveShadows?(a.oit=x.defined(a.oit)?a.oit:{},a.oit.shadows=r.createDerivedCommands(a.shadows.receiveCommand,i,a.oit.shadows)):a.oit=r.createDerivedCommands(t,i,a.oit))}}(window.Cesium),function(e){var t=e.GeoViewAnalyse=function(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),this._stage=null,this.filterFar=1e6,this.scene=t.scene,this.initStage()};e.defineProperties(t.prototype,{name:{get:function(){return this._stage.name}},inputPreviousStageTexture:{get:function(){return this._stage.inputPreviousStageTexture}},enabled:{set:function(t){this._stage.enabled=t},get:function(){return this._stage.enabled}},_textureCache:{set:function(t){this._stage._textureCache=t},get:function(){return this._stage._textureCache}},outputTexture:{get:function(){return this._stage.outputTexture}},ready:{get:function(){return this._stage.ready}},_index:{set:function(t){this._stage._index=t},get:function(){return this._stage._index}},uniforms:{get:function(){return this._stage.uniforms}},_textureScale:{get:function(){return this._stage.textureScale}},_pixelFormat:{get:function(){return this._stage.pixelFormat}},_forcePowerOfTwo:{get:function(){return this._stage.forcePowerOfTwo}},_pixelDatatype:{get:function(){return this._stage.pixelDatatype}},_clearColor:{get:function(){return this._stage.clearColor}}}),t.prototype.initStage=function(){var r=this,t=new e.PostProcessStage({fragmentShader:"uniform sampler2D colorTexture;\nuniform sampler2D depthTexture;\nvarying vec2 v_textureCoordinates;\nuniform float u_filterFar;\nvec4 clipToEye(vec2 uv, float depth)\n{\n   vec2 xy = vec2((uv.x * 2.0 - 1.0), ((1.0 - uv.y) * 2.0 - 1.0));\n   vec4 posEC = czm_inverseProjection * vec4(xy, depth, 1.0);\n   posEC = posEC / posEC.w;\n   return posEC;\n}\nvoid main() {\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\n    vec3 hsb = czm_RGBToHSB(color.rgb);\n    hsb.g = clamp(hsb.g + 0.03, 0.0, 1.0);\n    if (hsb.b > 0.5)\n    {\n        hsb.b = clamp(hsb.b + 0.01, 0.0, 1.0);\n    }\n    else\n    {\n        hsb.b = clamp(hsb.b - 0.02, 0.0, 1.0);\n    }\n    color.rgb = czm_HSBToRGB(hsb);\n    float depth = czm_readDepth(depthTexture, v_textureCoordinates);\n    vec4 posInCamera = clipToEye(v_textureCoordinates, depth);\n    float d = length(posInCamera.xyz);\n    if (d > u_filterFar)\n    {\n       gl_FragColor = vec4(mix(color.rgb, vec3(0.8, 0.85, 0.85), 1.0 - u_filterFar / d), 1.0);\n    }\n    else \n    {\n       gl_FragColor = vec4(color.rgb, 1.0);\n    }\n}\n",name:e.createGuid(),inputPreviousStageTexture:!0,uniforms:{u_filterFar:function(){var t=r.scene;if(t){var e=t.camera;if(e.filterFar&&e.enableFilter){var i=e.filterFar;return i*=.6}}return r.filterFar}}});(this._stage=t)._ready=!0},t.prototype.update=function(t,e){this._stage.update(t,e)},t.prototype._isSupported=function(t){return this._stage._isSupported(t)},t.prototype.execute=function(t,e,i,r){this._stage.execute(t,e,i,r)},t.prototype.destroy=function(){return this._stage.destroy(),destroyObject(this)}}(window.Cesium),function(g){var t=g.GeoWalkerAnimationCamera=function(t){this.viewer=t.viewer,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.ellipsoid=this.scene.globe.ellipsoid,this.path=g.defaultValue(t.path,null),this.moveStep=g.defaultValue(t.moveStep,2),this.rotateStep=g.defaultValue(t.rotateStep,10),this.frameChange=g.defaultValue(t.frameChange,function(){}),this._lockCamera=!1,this.walkFrame=new u(this),this.walkFrame.addChangeEventListener(this.frameChange)};t.prototype.activate=function(){(this.camera._hooker=this).scene.logarithmicDepthBuffer=!1,g.Camera.prototype._hookUpdate=g.Camera.prototype.update,g.Camera.prototype.update=function(t){this._hookUpdate(t),this._hooker&&this._hooker.raiseUpdate(this)}},t.prototype.raiseUpdate=function(t){var e={};if(!this._lockCamera){var i=this.walkFrame.next();if(void 0!==i){e.position=g.Cartesian3.clone(i.position),e.geoposition=g.Cartographic.fromCartesian(i.position,this.ellipsoid);var r=g.Transforms.eastNorthUpToFixedFrame(i.position,this.ellipsoid,s),n=i.direction,o=new g.Cartesian3(r[8],r[9],r[10]),a=g.Cartesian3.cross(n,o,l);g.Cartesian3.normalize(a,a),o=g.Cartesian3.cross(a,n,h),g.Cartesian3.normalize(o,o),e.direction=g.Cartesian3.clone(n),e.up=g.Cartesian3.clone(o),e.right=g.Cartesian3.clone(a),this._lockCamera=!0,t.setView({destination:e.position,orientation:{direction:e.direction,up:e.up}}),this._lockCamera=!1}else this._lockCamera=!1}},t.prototype.unactivate=function(){g.Camera.prototype._hookUpdate&&(g.Camera.prototype.update=g.Camera.prototype._hookUpdate),delete this.camera._hooker&&delete this.camera.__proto__._hookUpdate},t.prototype.destroy=function(){g.Camera.prototype.update=g.Camera.prototype._hookUpdate,delete this.camera._hooker&&delete this.camera.__proto__._hookUpdate,this.scene.logarithmicDepthBuffer=!0};var u=function(t){this._walkAnimation=t,this._begin=0,this._isDone=!1,this._isPause=!1,this.changeEvent=new g.Event};function d(t,e,i){return void 0===t||void 0===t.x||(void 0===e||void 0===e.x||!!r(t.x,e.x,i)&&(!!r(t.y,e.y,i)&&!!r(t.z,e.z,i)))}function r(t,e,i){return void 0===i&&(i=1e-7),Math.abs(t-e)<i}u.prototype.addChangeEventListener=function(t){this.changeEvent.addEventListener(t)},u.prototype.raiseChangeEvent=function(t){this.changeEvent.raiseEvent(t)},u.prototype.isDone=function(){return this._isDone},u.prototype.isPause=function(){return this._isPause},u.prototype.start=function(t){this._begin=null==t?0:t,this._isDone=!1,this._isPause=!1},u.prototype.stop=function(){this._toStop()},u.prototype._toStop=function(){this._isDone=!0,this._isPause=!1,this._begin=0,this.state=void 0,this._loadGeoposition=void 0,this._loadDirection=void 0},u.prototype.pause=function(){this._isPause=!0},u.prototype.run=function(){this._isPause=!1},u.ComputeTimeDelta=function(t,e){var i=e,r=i.getMilliseconds()-t.getMilliseconds();return r+=1e3*(i.getSeconds()-t.getSeconds()),r+=60*(i.getMinutes()-t.getMinutes())*1e3,r+=60*(i.getHours()-t.getHours())*60*1e3},u.prototype.next=function(){if(!this._isDone){if(void 0===this.state)return this.state=this._createState(),void 0===this.state||(this.state.date=new Date),this.state;if(this._isPause)return this.state.date=new Date,this.state;var t=this.state;if(d(t.position,t.endPosition)&&d(t.direction,t.endDirection))return void 0!==t.next?(this.state=t.next,this.state.date=new Date,this.state):(this._begin++,this._begin>=this._walkAnimation.path.length?(this.raiseChangeEvent(this._begin),void this._toStop()):(this.state=this._createState(),void 0===this.state||(this.state.date=new Date),this.state));if(d(t.direction,t.endDirection)){var e=g.Cartesian3.distance(t.endPosition,t.position),i=this._walkAnimation.moveStep+t.moveSpeed;o=new Date,a=u.ComputeTimeDelta(t.date,o);if(t.date=o,e<=(i*=a/1e3))return t.position=g.Cartesian3.clone(t.endPosition,new g.Cartesian3),t;r=g.Cartesian3.subtract(t.endPosition,t.position,new g.Cartesian3);return g.Cartesian3.normalize(r,r),g.Cartesian3.multiplyByScalar(r,i,r),t.position=g.Cartesian3.add(t.position,r,new g.Cartesian3),t}var r=g.Cartesian3.cross(t.direction,t.endDirection,new g.Cartesian3);g.Cartesian3.normalize(r,r);var n=g.Math.toRadians(this._walkAnimation.rotateStep+t.rotateSpeed),o=new Date,a=u.ComputeTimeDelta(t.date,o);if(t.date=o,(n*=a/1e3)<g.Cartesian3.angleBetween(t.direction,t.endDirection)){var s=g.Quaternion.fromAxisAngle(r,n,new g.Quaternion),l=g.Matrix3.fromQuaternion(s,new g.Matrix3),h=g.Matrix4.fromRotationTranslation(l,new g.Cartesian3(0,0,0),new g.Matrix4),c=g.Matrix4.multiplyByPointAsVector(h,t.direction,new g.Cartesian3);return t.direction=g.Cartesian3.normalize(c,new g.Cartesian3),t}return t.direction=g.Cartesian3.clone(t.endDirection,new g.Cartesian3),t}},u.prototype._createState=function(){this.raiseChangeEvent(this._begin);var t=this._begin,e=t+1,i=this._walkAnimation.path;if(e>=i.length)return this.raiseChangeEvent(e),void this._toStop();var r={},n=i[t],o=i[e];return r.position=g.Cartesian3.fromDegrees(n.geoposition.longitude,n.geoposition.latitude,n.geoposition.height,this._walkAnimation.ellipsoid,new g.Cartesian3),r.direction=g.Cartesian3.clone(n.direction,new g.Cartesian3),r.moveSpeed=n.moveSpeed,r.rotateSpeed=n.rotateSpeed,r.endPosition=g.Cartesian3.fromDegrees(o.geoposition.longitude,o.geoposition.latitude,o.geoposition.height,this._walkAnimation.ellipsoid,new g.Cartesian3),r.endDirection=g.Cartesian3.clone(o.direction,new g.Cartesian3),r};var s=new g.Matrix4,l=(new g.Cartesian3,new g.Cartesian3),h=new g.Cartesian3}(window.Cesium),function(p){var e=p.GeoWalkerCamera=function(t){this.viewer=t.viewer,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.stepSize=p.defaultValue(t.stepSize,1),this.rotateSize=p.defaultValue(t.rotateSize,5),this.manHeight=p.defaultValue(t.manHeight,1.6),this.manRange=p.defaultValue(t.manRange,.8),this.state=e.stateType.UNKNOWN,this._lockCamera=!1,this._readyCamera=!1,this._ellipsoid=this.scene.globe.ellipsoid,this._walkQueue=new n,this.canLog=!1,this.filterFar=p.defaultValue(t.filterFar,null),t.filterFog&&this.viewer&&viewer.scene.postProcessStages.add(new p.GeoViewAnalyse({scene:viewer.scene}))};e.prototype.setState=function(e){0<Object.keys(p.GeoWalkerCamera.stateType).filter(function(t){return p.GeoWalkerCamera.stateType[t]===e}).length&&(this.state=e)},e.prototype.activate=function(){this.filterFar&&(this.camera.filterFar=this.filterFar),(this.camera._hooker=this).scene.logarithmicDepthBuffer=!1,p.Camera.prototype._hookUpdate=p.Camera.prototype.update,p.Camera.prototype.update=function(t){this._hookUpdate(t),this._hooker&&this._hooker.raiseUpdate(this)}},e.prototype.unactivate=function(){this.camera&&this.camera.filterFar&&delete this.camera.filterFar,p.Camera.prototype._hookUpdate&&(p.Camera.prototype.update=p.Camera.prototype._hookUpdate),delete this.camera._hooker&&delete this.camera.__proto__._hookUpdate},e.prototype.raiseUpdate=function(t){if(!(!this._readyCamera||this._lockCamera||this.state<1))switch(this.state){case e.stateType.FORWARD:this.computeForeward(t);break;case e.stateType.BACKWARD:this.computeBackward(t);break;case e.stateType.LEFTWARD:case e.stateType.RIGHTWARD:break;case e.stateType.UPWARD:this.computeTrunUp(t);break;case e.stateType.DOWNWARD:this.computeTrunDown(t);break;case e.stateType.LEFT:this.computeTrunLeft(t);break;case e.stateType.RIGHT:this.computeTrunRight(t);break;case e.stateType.UNKNOWN:return}},e.prototype.setView=function(t){this._lockCamera=!0,this.camera.setView(t),this._lockCamera=!1,this._readyCamera=!0},e.prototype.jumpUp=function(t){this._lockCamera=!0,this.camera.moveUp(t||100),this._lockCamera=!1},e.prototype.computeInitialPosition=function(t){this.scene.pick(t);var e=this.scene.pickPosition(t),i=p.Cartographic.fromCartesian(e,this._ellipsoid);if(0<i.height)i.height+=this.manHeight;else{var r=this.scene.globe.getHeight(i);i.height=0<r?r+this.manHeight:1e3}var n=p.Cartesian3.fromRadians(i.longitude,i.latitude,i.height,this._ellipsoid);this._lockCamera=!0,this.camera.setView({destination:n,orientation:{heading:this.camera.heading,pitch:0,up:0}}),this._lockCamera=!1,this._readyCamera=!0,this.camera&&this.filterFar&&(this.enableFilter(!0),this.camera.enableFilter=!0)},e.prototype.computeForeward=function(t){var e=new p.Cartesian3,i=t.position,r=(t.positionWC,t.directionWC.clone()),n=this.getTangentNormal(),o=p.Cartesian3.cross(r,n,f);p.Cartesian3.normalize(o,o),r=p.Cartesian3.cross(n,o,m),p.Cartesian3.normalize(r,r);var a=this._computeCollideDistance(i,r,n,1/C*this.stepSize);p.Cartesian3.multiplyByScalar(r,a,e),p.Cartesian3.add(i,e,i);var s=A;s.origin=i,s.direction=p.Cartesian3.negate(n,v);var l=p.Cartographic.fromCartesian(s.origin,this._ellipsoid),h=p.GeoRayPick.pick(this.scene,s,r,!0);if(h&&h.position&&h.object){(g=p.Cartographic.fromCartesian(h.position,this._ellipsoid)).height+=this.manHeight,(c=l.height-g.height)<3&&-1<c?(this.log("Forward : height = "+c),i=p.Cartesian3.fromRadians(g.longitude,g.latitude,g.height,this._ellipsoid)):this.log("Forward : height = 0")}else{var c,g=p.Cartographic.fromCartesian(i,this._ellipsoid),u=this.scene.globe.getHeight(g);g.height=0<u?u+this.manHeight:g.height,(c=l.height-g.height)<3&&-1<c?(this.log("Forward Node : height = "+c),i=p.Cartesian3.fromRadians(g.longitude,g.latitude,g.height,this._ellipsoid)):this.log("Forward Node : height = 0")}this._lockCamera=!0,t.setView({destination:i,orientation:{heading:t.heading,pitch:t.pitch,up:t.up}}),this._lockCamera=!1},e.prototype.computeBackward=function(t){var e=new p.Cartesian3,i=t.position,r=(t.positionWC,t.directionWC.clone()),n=this.getTangentNormal(),o=p.Cartesian3.cross(r,n,f);p.Cartesian3.normalize(o,o),r=p.Cartesian3.cross(n,o,m),p.Cartesian3.normalize(r,r),r=p.Cartesian3.negate(r,m);var a=this._computeCollideDistance(i,r,n,1/C*this.stepSize);p.Cartesian3.multiplyByScalar(r,a,e),p.Cartesian3.add(i,e,i);var s=A;s.origin=i,s.direction=p.Cartesian3.negate(n,v);var l=p.Cartographic.fromCartesian(s.origin,this._ellipsoid),h=p.Cartesian3.negate(r,new p.Cartesian3),c=p.GeoRayPick.pick(this.scene,s,h,!0);if(c&&c.position&&c.object){(u=p.Cartographic.fromCartesian(c.position,this._ellipsoid)).height+=this.manHeight,(g=l.height-u.height)<3&&-1<g?(this.log("Backward : height = "+g),i=p.Cartesian3.fromRadians(u.longitude,u.latitude,u.height,this._ellipsoid)):this.log("Backward : height = 0")}else{var g,u=p.Cartographic.fromCartesian(i,this._ellipsoid),d=this.scene.globe.getHeight(u);u.height=0<d?d+this.manHeight:u.height,(g=l.height-u.height)<3&&-1<g?(this.log("Backward Node : height = "+g),i=p.Cartesian3.fromRadians(u.longitude,u.latitude,u.height,this._ellipsoid)):this.log("Backward Node : height = 0")}this._lockCamera=!0,t.setView({destination:i,orientation:{heading:t.heading,pitch:t.pitch,up:t.up}}),this._lockCamera=!1},e.prototype._computeCollideDistance=function(t,e,i,r){var n=A;n.origin=t,n.direction=e;var o=p.GeoRayPick.pick(this.scene,n,i,!1);if(o&&o.position){var a=p.Cartesian3.distance(t,o.position);return a<=this.manRange?a=0:a-=this.manRange,this.log("collide :"+a+" max: "+r),Math.min(a,r)}return this.log("Not collide"),r},e.prototype.log=function(t){this.canLog&&console.log(t)},e.prototype.computeLeftward=function(t){},e.prototype.computeRightward=function(t){},e.prototype.computeTrunLeft=function(t){t.look(this.getTangentNormal(),-p.Math.toRadians(p.defaultValue(this.rotateSize,5))/C)},e.prototype.computeTrunRight=function(t){t.look(this.getTangentNormal(),p.Math.toRadians(p.defaultValue(this.rotateSize,5))/C)},e.prototype.computeTrunUp=function(t){t.look(p.Cartesian3.cross(t.directionWC.clone(),this.getTangentNormal(),f),-p.Math.toRadians(p.defaultValue(this.rotateSize,5))/C)},e.prototype.computeTrunDown=function(t){t.look(p.Cartesian3.cross(t.directionWC.clone(),this.getTangentNormal(),f),p.Math.toRadians(p.defaultValue(this.rotateSize,5))/C)},e.prototype.getTangentNormal=function(){var t=p.Transforms.eastNorthUpToFixedFrame(this.camera.positionWC,this._ellipsoid,i);return new p.Cartesian3(t[8],t[9],t[10])},e.prototype.destroy=function(){p.Camera.prototype.update=p.Camera.prototype._hookUpdate,delete this.camera._hooker&&delete this.camera.__proto__._hookUpdate,this.scene.logarithmicDepthBuffer=!0};var r=new p.Cartesian2;e.prototype.raiseMouseMove=function(t){if(t.startPosition&&t.endPosition){var e=p.Cartesian2.subtract(t.endPosition,t.startPosition,r);if(0!=e.x){var i=p.defaultValue(this.rotateSize,5)*e.x/5;this.camera.look(this.getTangentNormal(),p.Math.toRadians(i)/C)}if(0!=e.y){i=p.defaultValue(this.rotateSize,5)*e.y/5;this.camera.look(p.Cartesian3.cross(this.camera.directionWC.clone(),this.getTangentNormal(),f),p.Math.toRadians(i)/C)}}},e.prototype.enableFilter=function(t){t=t||!1,this.camera&&this.filterFar&&1.58<=p.VERSION&&((this.camera.enableFilter=t)?p.Cesium3DTileset.prototype.filterWithCamera=function(t,e){var i=e.camera;if(i.filterFar&&i.enableFilter){var r=i.filterFar,n=t.boundingSphere.radius,o=p.Cartesian3.distance(t.boundingSphere.center,i._positionWC);if(r<(o-=n))return!0}return!1}:p.Cesium3DTileset.prototype.filterWithCamera&&delete p.Cesium3DTileset.__proto__.filterWithCamera)},e.stateType={UNKNOWN:0,FORWARD:1,BACKWARD:2,LEFTWARD:3,RIGHTWARD:4,UPWARD:5,DOWNWARD:6,LEFT:7,RIGHT:8};var C=40,i=new p.Matrix4,m=new p.Cartesian3,f=new p.Cartesian3,v=new p.Cartesian3,A=new p.Ray;function n(){var r=[],e=0;this.push=function(t){return 10<=this.size()&&this.pop(),r.push(t),!0},this.pop=function(){return r.shift()},this.getFront=function(){return r[0]},this.getRear=function(){return r[r.length-1]},this.clear=function(){r=[]},this.size=function(){return r.length},this.getAvgHeight=function(){for(var t=0,e=r.length,i=0;i<e;i++)t+=r[i].height;return t/e},this.getLatelyHeight=function(){return 0<r.length?r[r.length-1].height:null},this.getDropThreshold=function(t){return 0<r.length&&4.5<Math.abs(this.getLatelyHeight()-t.height)},this.preventFalling=function(t){this.getDropThreshold(t)&&(20<e?e=0:(t.height=3<e?this.getAvgHeight():this.getLatelyHeight(),e++),t.height=this.getLatelyHeight()),this.push(t)}}}(window.Cesium),function(F){var n=F.defaultValue,t=F.GeoWater=function(t){var e=(t=n(t,n.EMPTY_OBJECT)).url;this._viewer=t.viewer,this._scene=this._viewer.scene,this._pointsToCartographic=[],this._waterColor=new F.Color(.439,.564,.788,0),this._refractColor=new F.Color(0,0,0,0),this._reflectColor=new F.Color(.439,.564,.788,0),this._waveWidth=.2,this._flowDirection=90,this._flowSpeed=.7,this._normalTexture=void 0,this._m_startTime=0,this._reflectCamera=void 0,this._reflectPassState=void 0,this._initialized=!1,this._drawCommand=void 0,this._isVisible=!0;this._scene._context;var i=this,r=new Image;r.src=e,r.onload=function(){i._normalTexture=new F.Texture({context:i._scene.context,width:r.width,height:r.height,source:r,sampler:new F.Sampler({wrapS:F.TextureWrap.REPEAT,wrapT:F.TextureWrap.REPEAT})}),i._scene.primitives.add(i)}};F.defineProperties(t.prototype,{waterPolygon:{get:function(){return this._waterPolygon},set:function(t){null!=t&&null!=this._waterPolygon&&this.release(),this._waterPolygon=t}},waterColor:{get:function(){return this._waterColor},set:function(t){this._waterColor=t}},flowSpeed:{get:function(){return this._flowSpeed},set:function(t){this._flowSpeed=t}},flowDirection:{get:function(){return this._flowDirection},set:function(t){this._flowDirection=t}},waveWidth:{get:function(){return this._waveWidth},set:function(t){this._waveWidth=t}},isVisible:{get:function(){return this._isVisible},set:function(t){this._isVisible=t}}}),t.prototype._computeBoundingRectangle=function(){this._pointsToCartographic=[];var t=this._waterPolygon._polygonHierarchy.positions,e=F.Cartographic.fromCartesian(t[0]),i=F.Math.toDegrees(e.longitude),r=F.Math.toDegrees(e.latitude),n=F.Math.toDegrees(e.longitude),o=F.Math.toDegrees(e.latitude);this._zFactor=e.height;for(var a=0;a<t.length;a++){var s=F.Cartographic.fromCartesian(t[a]),l=F.Math.toDegrees(s.longitude),h=F.Math.toDegrees(s.latitude),c=new F.Cartesian2(l,h);this._pointsToCartographic.push(c),n<l&&(n=l),l<i&&(i=l),o<h&&(o=h),h<r&&(r=h)}this._lonMin=i,this._latMin=r,this._waterCenterPos=new F.Cartesian3.fromDegrees((i+n)/2,(r+o)/2,this._zFactor)},t.prototype.initialize=function(){var t=this._scene,e=t._context;if(F.defined(this._reflectCamera)||(this._reflectCamera=new F.Camera(t)),!F.defined(this._reflectPassState)){var i=new F.Framebuffer({context:e,colorTextures:[new F.Texture({context:e,width:512,height:512,pixelFormat:F.PixelFormat.RGBA})],depthRenderbuffer:new F.Renderbuffer({context:e,format:F.RenderbufferFormat.DEPTH_COMPONENT16,width:512,height:512})});this._reflectPassState=new F.PassState(e),this._reflectPassState.viewport=new F.BoundingRectangle(0,0,512,512),this._reflectPassState.framebuffer=i}this._initialized=!0,this._computeBoundingRectangle()},t.prototype.update=function(t){if(F.defined(this.waterPolygon)){var e=this._scene;if(0!==e.camera.workingFrustums.length){this._initialized||this.initialize();var i=e._context;this._fScale=1/(.001*this._waveWidth);var r=new F.Cartesian3(this._waterCenterPos.x,this._waterCenterPos.y,this._waterCenterPos.z),n=F.Cartographic.fromCartesian(this._waterCenterPos),o=F.Math.toDegrees(n.longitude),a=F.Math.toDegrees(n.latitude),s=F.Cartesian3.fromDegrees(o,a,0);F.Cartesian3.normalize(s,s);var l=new F.Cartesian3(0,1,0),h=new F.Cartesian3(0,1,0);h=F.Cartesian3.cross(l,s,h),F.Cartesian3.normalize(h,h),l=F.Cartesian3.cross(s,h,l);var c=new F.Matrix3;F.Matrix3.setRow(c,0,h,c),F.Matrix3.setRow(c,1,l,c),F.Matrix3.setRow(c,2,s,c);var g=new F.Cartesian3,u=new F.Cartesian3(-r.x,-r.y,-r.z);F.Matrix3.multiplyByVector(c,u,g);var d=new F.Matrix4(c[0],c[3],c[6],g.x,c[1],c[4],c[7],g.y,c[2],c[5],c[8],g.z,0,0,0,1);this.invWorldViewMatrix=new F.Matrix4,F.Matrix4.multiply(d,t.camera.inverseViewMatrix,this.invWorldViewMatrix),this.modelMatrix=new F.Matrix4(1,0,0,r.x,0,1,0,r.y,0,0,1,r.z,0,0,0,1),this.modelViewMatrix=new F.Matrix4,this.modeiViewProjection=new F.Matrix4,this.modelViewMatrix=F.Matrix4.multiply(t.camera.viewMatrix,this.modelMatrix,this.modelViewMatrix),this.modeiViewProjection=F.Matrix4.multiply(t.camera.workingFrustums[0].projectionMatrix,this.modelViewMatrix,this.modeiViewProjection);var p=F.JulianDate.now();0==this._m_startTime&&(this._m_startTime=p.secondsOfDay);var C=p.secondsOfDay;if(this._fElapse=(C-this._m_startTime)/1,this._frameTime=this._fElapse*this._flowSpeed,this._flowAngle=this._flowDirection*Math.PI/180,null==this._drawCommand){var m=F.ShaderProgram.fromCache({context:i,vertexShaderSource:"attribute vec3 position;\n\t\t\t\t\t\t\t\t\t\t\tattribute vec2 st;\n\t\t\t\t\t\t\t\t\t\t\tuniform mat4 u_modelViewProjectionMatrix;\n\t\t\t\t\t\t\t\t\t\t\tuniform mat4 u_modelViewMatrix;\n\t\t\t\t\t\t\t\t\t\t\tuniform mat4 u_invWorldViewMatrix;\n\t\t\t\t\t\t\t\t\t\t\tuniform vec2 u_texCoordOffset;\n\t\t\t\t\t\t\t\t\t\t\tuniform vec2 u_texCoordScale;\n\t\t\t\t\t\t\t\t\t\t\tuniform float u_frameTime;\n\t\t\t\t\t\t\t\t\t\t\tuniform int u_clampToGroud;\n\t\t\t\t\t\t\t\t\t\t\tuniform vec3 u_camPos;\n\t\t\t\t\t\t\t\t\t\t\tuniform vec3 u_scale;\n\t\t\t\t\t\t\t\t\t\t\tvarying vec3 eyeDir;\n\t\t\t\t\t\t\t\t\t\t\tvarying vec2 texCoord;\n\t\t\t\t\t\t\t\t\t\t\tvarying float myTime;\n\t\t\t\t\t\t\t\t\t\t\tvarying vec4 projectionCoord;\n\t\t\t\t\t\t\t\t\t\t\tvoid main(void)\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t//gl_Position = ftransform();\n\t\t\t\t\t\t\t\t\t\t\t\tgl_Position = u_modelViewProjectionMatrix * vec4(position.xyz,1.0);\n\t\t\t\t\t\t\t\t\t\t\t\tif (u_clampToGroud == 1)\n\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\teyeDir = (u_camPos - position.xyz) * u_scale;\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\tvec4 pos = u_modelViewMatrix * vec4(position.xyz,1.0);\n\t\t\t\t\t\t\t\t\t\t\t\t\teyeDir = vec3(u_invWorldViewMatrix*vec4(pos.xyz,0.0));\n\t\t\t\t\t\t\t\t\t\t\t\t\tprojectionCoord = gl_Position;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\ttexCoord = (st+u_texCoordOffset)*u_texCoordScale;\n\t\t\t\t\t\t\t\t\t\t\t\tmyTime = 0.01 * u_frameTime;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t",fragmentShaderSource:"uniform sampler2D u_normalMap;\n\t\t\t\t\t\t\t\t\t\t\t\tuniform sampler2D u_refractMap;\n\t\t\t\t\t\t\t\t\t\t\t\t//uniform samplerCube u_cubeMap;\n\t\t\t\t\t\t\t\t\t\t\t\tuniform sampler2D u_reflectMap;\n\t\t\t\t\t\t\t\t\t\t\t\t//uniform sampler2D u_flowMap;\n\t\t\t\t\t\t\t\t\t\t\t\tuniform vec4 u_waterColor;\n\t\t\t\t\t\t\t\t\t\t\t\tuniform vec4 u_refractColor;\n\t\t\t\t\t\t\t\t\t\t\t\tuniform int u_useRefractTex;\n\t\t\t\t\t\t\t\t\t\t\t\tuniform vec4 u_reflectColor;\n\t\t\t\t\t\t\t\t\t\t\t\tuniform int u_reflection;\n\t\t\t\t\t\t\t\t\t\t\t\tuniform vec2 u_flowDir;\n\t\t\t\t\t\t\t\t\t\t\t\tvarying vec3 eyeDir;\n\t\t\t\t\t\t\t\t\t\t\t\tvarying vec2 texCoord;\n\t\t\t\t\t\t\t\t\t\t\t\tvarying float myTime;\n\t\t\t\t\t\t\t\t\t\t\t\tvarying vec4 projectionCoord;\n\t\t\t\t\t\t\t\t\t\t\t\tvoid main (void)\n\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t// texScale determines the amount of tiles generated.\n\t\t\t\t\t\t\t\t\t\t\t\t\tfloat texScale = 35.0;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// texScale2 determines the repeat of the water texture (the normalmap) itself\n\t\t\t\t\t\t\t\t\t\t\t\t\tfloat texScale2 = 10.0;\n\t\t\t\t\t\t\t\t\t\t\t\t\tfloat myangle;\n\t\t\t\t\t\t\t\t\t\t\t\t\tfloat transp;\n\t\t\t\t\t\t\t\t\t\t\t\t\tvec3 myNormal;\n\t\t\t\t\t\t\t\t\t\t\t\t\tvec2 mytexFlowCoord = texCoord * texScale;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// ff is the factor that blends the tiles.\n\t\t\t\t\t\t\t\t\t\t\t\t\tvec2 ff = abs(2.0*(fract(mytexFlowCoord)) - 1.0) -0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// take a third power, to make the area with more or less equal contribution\n\t\t\t\t\t\t\t\t\t\t\t\t\t// of more tile bigger\n\t\t\t\t\t\t\t\t\t\t\t\t\tff = 0.5-4.0*ff*ff*ff;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// ffscale is a scaling factor that compensates for the effect that\n\t\t\t\t\t\t\t\t\t\t\t\t\t// adding normal vectors together tends to get them closer to the average normal\n\t\t\t\t\t\t\t\t\t\t\t\t\t// which is a visible effect. For more or less random waves, this factor\n\t\t\t\t\t\t\t\t\t\t\t\t\t// compensates for it\n\t\t\t\t\t\t\t\t\t\t\t\t\tvec2 ffscale = sqrt(ff*ff + (1.0-ff)*(1.0-ff));\n\t\t\t\t\t\t\t\t\t\t\t\t\tvec2 Tcoord = texCoord  * texScale2;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// offset makes the water move\n\t\t\t\t\t\t\t\t\t\t\t\t\tvec2 offset = vec2(myTime,0.0);\n\t\t\t\t\t\t\t\t\t\t\t\t\t// I scale the texFlowCoord and floor the value to create the tiling\n\t\t\t\t\t\t\t\t\t\t\t\t\t// This could have be replace by an extremely lo-res texture lookup\n\t\t\t\t\t\t\t\t\t\t\t\t\t// using NEAREST pixel.\n\t\t\t\t\t\t\t\t\t\t\t\t\tvec3 sample = vec3(u_flowDir, 1.0);//texture2D( u_flowMap, floor(mytexFlowCoord)/ texScale).rgb;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// flowdir is supposed to go from -1 to 1 and the line below\n\t\t\t\t\t\t\t\t\t\t\t\t\t// used to be sample.xy * 2.0 - 1.0, but saves a multiply by\n\t\t\t\t\t\t\t\t\t\t\t\t\t// moving this factor two to the sample.b\n\t\t\t\t\t\t\t\t\t\t\t\t\tvec2 flowdir = sample.xy -0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// sample.b is used for the inverse length of the wave\n\t\t\t\t\t\t\t\t\t\t\t\t\t// could be premultiplied in sample.xy, but this is easier for editing flowtexture\n\t\t\t\t\t\t\t\t\t\t\t\t\tflowdir *= sample.b;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// build the rotation matrix that scales and rotates the complete tile\n\t\t\t\t\t\t\t\t\t\t\t\t\tmat2 rotmat = mat2(flowdir.x, -flowdir.y, flowdir.y ,flowdir.x);\n\t\t\t\t\t\t\t\t\t\t\t\t\t// this is the normal for tile A\n\t\t\t\t\t\t\t\t\t\t\t\t\tvec2 NormalT0 = texture2D(u_normalMap, rotmat * Tcoord - offset).rg;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// for the next tile (B) I shift by half the tile size in the x-direction\n\t\t\t\t\t\t\t\t\t\t\t\t\tsample = vec3(u_flowDir, 1.0);//texture2D( u_flowMap, floor((mytexFlowCoord + vec2(0.5,0)))/ texScale ).rgb;\n\t\t\t\t\t\t\t\t\t\t\t\t\tflowdir = sample.b * (sample.xy - 0.5);\n\t\t\t\t\t\t\t\t\t\t\t\t\trotmat = mat2(flowdir.x, -flowdir.y, flowdir.y ,flowdir.x);\n\t\t\t\t\t\t\t\t\t\t\t\t\t// and the normal for tile B...\n\t\t\t\t\t\t\t\t\t\t\t\t\t// multiply the offset by some number close to 1 to give it a different speed\n\t\t\t\t\t\t\t\t\t\t\t\t\t// The result is that after blending the water starts to animate and look\n\t\t\t\t\t\t\t\t\t\t\t\t\t// realistic, instead of just sliding in some direction.\n\t\t\t\t\t\t\t\t\t\t\t\t\t// This is also why I took the third power of ff above, so the area where the\n\t\t\t\t\t\t\t\t\t\t\t\t\t// water animates is as big as possible\n\t\t\t\t\t\t\t\t\t\t\t\t\t// adding a small arbitrary constant isn't really needed, but helps to show\n\t\t\t\t\t\t\t\t\t\t\t\t\t// a bit less tiling in the beginning of the program. After a few seconds, the\n\t\t\t\t\t\t\t\t\t\t\t\t\t// tiling cannot be seen anymore so this constant could be removed.\n\t\t\t\t\t\t\t\t\t\t\t\t\t// For the quick demo I leave them in. In a simulation that keeps running for\n\t\t\t\t\t\t\t\t\t\t\t\t\t// some time, you could just as well remove these small constant offsets\n\t\t\t\t\t\t\t\t\t\t\t\t\tvec2 NormalT1 = texture2D(u_normalMap, rotmat * Tcoord - offset*1.06+0.62).rg;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// blend them together using the ff factor\n\t\t\t\t\t\t\t\t\t\t\t\t\t// use ff.x because this tile is shifted in the x-direction\n\t\t\t\t\t\t\t\t\t\t\t\t\tvec2 NormalTAB = ff.x * NormalT0 + (1.0-ff.x) * NormalT1;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// the scaling of NormalTab and NormalTCD is moved to a single scale of\n\t\t\t\t\t\t\t\t\t\t\t\t\t// NormalT later in the program, which is mathematically identical to\n\t\t\t\t\t\t\t\t\t\t\t\t\t// NormalTAB = (NormalTAB - 0.5) / ffscale.x + 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// tile C is shifted in the y-direction\n\t\t\t\t\t\t\t\t\t\t\t\t\tsample = vec3(u_flowDir, 1.0);//texture2D( u_flowMap, floor((mytexFlowCoord + vec2(0.0,0.5)))/ texScale ).rgb;\n\t\t\t\t\t\t\t\t\t\t\t\t\tflowdir = sample.b * (sample.xy - 0.5);\n\t\t\t\t\t\t\t\t\t\t\t\t\trotmat = mat2(flowdir.x, -flowdir.y, flowdir.y ,flowdir.x);\n\t\t\t\t\t\t\t\t\t\t\t\t\tNormalT0 = texture2D(u_normalMap, rotmat * Tcoord - offset*1.33+0.27).rg;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// tile D is shifted in both x- and y-direction\n\t\t\t\t\t\t\t\t\t\t\t\t\tsample = vec3(u_flowDir, 1.0);//texture2D( u_flowMap, floor((mytexFlowCoord + vec2(0.5,0.5)))/ texScale ).rgb;\n\t\t\t\t\t\t\t\t\t\t\t\t\tflowdir = sample.b * (sample.xy - 0.5);\n\t\t\t\t\t\t\t\t\t\t\t\t\trotmat = mat2(flowdir.x, -flowdir.y, flowdir.y ,flowdir.x);\n\t\t\t\t\t\t\t\t\t\t\t\t\tNormalT1 = texture2D(u_normalMap, rotmat * Tcoord - offset*1.24).rg ;\n\t\t\t\t\t\t\t\t\t\t\t\t\tvec2 NormalTCD = ff.x * NormalT0 + (1.0-ff.x) * NormalT1;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// NormalTCD = (NormalTCD - 0.5) / ffscale.x + 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// now blend the two values togetherv\n\t\t\t\t\t\t\t\t\t\t\t\t\tvec2 NormalT = ff.y * NormalTAB + (1.0-ff.y) * NormalTCD;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// this line below used to be here for scaling the result\n\t\t\t\t\t\t\t\t\t\t\t\t\t//NormalT = (NormalT - 0.5) / ffscale.y + 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// below the new, direct scaling of NormalT\n\t\t\t\t\t\t\t\t\t\t\t\t\tNormalT = (NormalT - 0.5) / (ffscale.y * ffscale.x);\n\t\t\t\t\t\t\t\t\t\t\t\t\t// scaling by 0.3 is arbritrary, and could be done by just\n\t\t\t\t\t\t\t\t\t\t\t\t\t// changing the values in the normal map\n\t\t\t\t\t\t\t\t\t\t\t\t\t// without this factor, the waves look very strong\n\t\t\t\t\t\t\t\t\t\t\t\t\tNormalT *= 0.3;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// to make the water more transparent\n\t\t\t\t\t\t\t\t\t\t\t\t\ttransp = 1.0;//texture2D( u_flowMap, texFlowCoord ).a;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// and scale the normals with the transparency\n\t\t\t\t\t\t\t\t\t\t\t\t\tNormalT *= transp*transp;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// assume normal of plane is 0,0,1 and produce the normalized sum of adding NormalT to it\n\t\t\t\t\t\t\t\t\t\t\t\t\tmyNormal = vec3(NormalT,sqrt(1.0-NormalT.x*NormalT.x - NormalT.y*NormalT.y));\n\t\t\t\t\t\t\t\t\t\t\t\t\t// 获取反射颜色。\n\t\t\t\t\t\t\t\t\t\t\t\t\tvec3 envColor = u_reflectColor.rgb;//vec3(0.5647, 0.6941, 0.8235);\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (u_reflection == 1)\n\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t//vec3 reflectDir = reflect(eyeDir, myNormal);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t//vec3 envColor = vec3(textureCube(u_cubeMap, -reflectDir));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// 如果要实现反射真实场景，需要把场景渲染5遍构建一个无底的立方体纹理。\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// 目前使用一张反射纹理近似模拟。\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvec2 final = projectionCoord.xy / projectionCoord.w;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfinal = final * 0.5 + 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfinal.y = 1.0 - final.y;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tenvColor = texture2D(u_reflectMap, final + myNormal.xy/texScale2*transp).rgb;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t// very ugly version of fresnel effect\n\t\t\t\t\t\t\t\t\t\t\t\t\t// but it gives a nice transparent water, but not too transparent\n\t\t\t\t\t\t\t\t\t\t\t\t\tmyangle = dot(myNormal,normalize(eyeDir));\n\t\t\t\t\t\t\t\t\t\t\t\t\tmyangle = 0.95-0.6*myangle*myangle;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// blend in the color of the plane below the water\n\t\t\t\t\t\t\t\t\t\t\t\t\t// add in a little distortion of the colormap for the effect of a refracted\n\t\t\t\t\t\t\t\t\t\t\t\t\t// view of the image below the surface.\n\t\t\t\t\t\t\t\t\t\t\t\t\t// (this isn't really tested, just a last minute addition\n\t\t\t\t\t\t\t\t\t\t\t\t\t// and perhaps should be coded differently\n\t\t\t\t\t\t\t\t\t\t\t\t\t// the correct way, would be to use the refract routine, use the alpha channel for depth of\n\t\t\t\t\t\t\t\t\t\t\t\t\t// the water (and make the water disappear when depth = 0), add some watercolor to the colormap\n\t\t\t\t\t\t\t\t\t\t\t\t\t// depending on the depth, and use the calculated refractdir and the depth to find the right\n\t\t\t\t\t\t\t\t\t\t\t\t\t// pixel in the colormap.... who knows, something for the next version\n\t\t\t\t\t\t\t\t\t\t\t\t\tvec3 base = u_refractColor.rgb;//vec3(0.3, 0.4, 0.5);\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (u_useRefractTex == 1)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tbase = texture2D(u_refractMap,(texCoord + myNormal.xy/texScale2*0.03*transp)*32.0).rgb;\n\t\t\t\t\t\t\t\t\t\t\t\t\tbase = mix(base, u_waterColor.rgb, u_waterColor.a);\n\t\t\t\t\t\t\t\t\t\t\t\t\t// 光照计算\n\t\t\t\t\t\t\t\t\t\t\t\t\tvec3 lightDir = czm_sunDirectionEC;//normalize(vec3(0.0, 0.0, 1.0)); // 光照方向需要从外面传入\n\t\t\t\t\t\t\t\t\t\t\t\t\tvec3 reflectVec = reflect(-lightDir, myNormal);\n\t\t\t\t\t\t\t\t\t\t\t\t\tfloat diffuse = max(0.0, dot(myNormal, lightDir));\n\t\t\t\t\t\t\t\t\t\t\t\t\tfloat spec = max(dot(reflectVec, normalize(-eyeDir)), 0.0);\n\t\t\t\t\t\t\t\t\t\t\t\t\tspec = pow(spec, 128.0);\n\t\t\t\t\t\t\t\t\t\t\t\t\t//float lightIntensity = 0.7 * diffuse + 0.3 * spec;\n\t\t\t\t\t\t\t\t\t\t\t\t\tfloat lightIntensity = 0.3 * spec;\n\t\t\t\t\t\t\t\t\t\t\t\t\tgl_FragColor = vec4(mix(base, envColor, myangle*transp), 1.0);\n\t\t\t\t\t\t\t\t\t\t\t\t\tgl_FragColor += vec4(0.8)*lightIntensity;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// note that smaller waves appear to move slower than bigger waves\n\t\t\t\t\t\t\t\t\t\t\t\t\t// one could use the tiles and give each tile a different speed if that\n\t\t\t\t\t\t\t\t\t\t\t\t\t// is what you want\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t"}),f=F.RenderState.fromCache({depthTest:{enabled:!0}}),v=this;this._uniformMap={u_bgColor:function(){return v._waterColor},u_texCoordOffset:function(){return new F.Cartesian2(-v._lonMin,-v._latMin)},u_texCoordScale:function(){return new F.Cartesian2(v._fScale,v._fScale)},u_scale:function(){return new F.Cartesian3(3,3,3)},u_camPos:function(){return new F.Cartesian3(3,3,3)},u_modelViewProjectionMatrix:function(){return v.modeiViewProjection},u_modelViewMatrix:function(){return v.modelViewMatrix},u_clampToGroud:function(){return 0},u_invWorldViewMatrix:function(){return v.invWorldViewMatrix},u_frameTime:function(){return v._frameTime},u_normalMap:function(){return v._normalTexture},u_refractMap:function(){return v._normalTexture},u_useRefractTex:function(){return 0},u_reflectMap:function(){return v._reflectPassState.framebuffer.getColorTexture(0)},u_reflection:function(){return 1},u_waterColor:function(){return v._waterColor},u_refractColor:function(){return v._refractColor},u_reflectColor:function(){return v._reflectColor},u_flowDir:function(){return new F.Cartesian2(.5*Math.sin(v._flowAngle)+.5,.5*Math.cos(v._flowAngle)+.5)}},this._waterGeometry=F.PolygonGeometry.createGeometry(this._waterPolygon);for(var A=this._waterGeometry.indices,I=this._waterGeometry.attributes.position.values,_=0;_<I.length;_++)_%3==0&&(I[_]=I[_]-r.x),_%3==1&&(I[_]=I[_]-r.y),_%3==2&&(I[_]=I[_]-r.z);for(var y=[],w=0;w<this._pointsToCartographic.length;w++)y.push(this._pointsToCartographic[w].x,this._pointsToCartographic[w].y);var P=new Float64Array(y),x=F.Buffer.createIndexBuffer({context:i,typedArray:new Uint32Array(A),usage:F.BufferUsage.STATIC_DRAW,indexDatatype:F.IndexDatatype.UNSIGNED_INT}),b=F.Buffer.createVertexBuffer({context:i,typedArray:F.ComponentDatatype.createTypedArray(F.ComponentDatatype.FLOAT,I),usage:F.BufferUsage.STATIC_DRAW}),E=F.Buffer.createVertexBuffer({context:i,typedArray:F.ComponentDatatype.createTypedArray(F.ComponentDatatype.FLOAT,P),usage:F.BufferUsage.STATIC_DRAW}),T=[];T.push({index:0,vertexBuffer:b,componentDatatype:F.ComponentDatatype.FLOAT,componentsPerAttribute:3,normalize:!1}),T.push({index:1,vertexBuffer:E,componentDatatype:F.ComponentDatatype.FLOAT,componentsPerAttribute:2,normalize:!1});var S=new F.VertexArray({context:i,attributes:T,indexBuffer:x});this._drawCommand=new F.DrawCommand({boundingVolume:this._waterGeometry.boundingSphere,primitiveType:F.PrimitiveType.TRIANGLES,vertexArray:S,shaderProgram:m,castShadows:!1,receiveShadows:!1,uniformMap:this._uniformMap,renderState:f,pass:F.Pass.OPAQUE}),this._drawCommand.water="water"}null!==this._normalTexture&&1==this._isVisible&&t.commandList.push(this._drawCommand)}}},t.prototype._updateReflectTexture=function(t){if(this._initialized){this.modelViewMatrix=F.Matrix4.multiply(t.camera.viewMatrix,this.modelMatrix,this.modelViewMatrix),this.modeiViewProjection=F.Matrix4.multiply(t.camera.workingFrustums[0].projectionMatrix,this.modelViewMatrix,this.modeiViewProjection);var e=new F.Cartesian3(this._waterCenterPos.x,this._waterCenterPos.y,this._waterCenterPos.z),i=new F.Cartesian3(e.x,e.y,e.z);F.Cartesian3.normalize(i,i);var r=F.Plane.fromPointNormal(e,i),n=new F.Cartesian3(i.x,i.y,i.z),o=-F.Cartesian3.dot(i,e),a=new F.Matrix4(-2*n.x*n.x+1,-2*n.x*n.y,-2*n.x*n.z,-2*n.x*o,-2*n.y*n.x,-2*n.y*n.y+1,-2*n.y*n.z,-2*n.y*o,-2*n.z*n.x,-2*n.z*n.y,-2*n.z*n.z+1,-2*n.z*o,0,0,0,1),s=new F.Cartesian3;F.Cartesian3.clone(t.camera.direction,s);var l=new F.Cartesian3,h=new F.Cartesian3;F.Cartesian3.multiplyByScalar(n,2*F.Cartesian3.dot(s,n),h),F.Cartesian3.subtract(s,h,l),F.Cartesian3.normalize(l,l);var c=new F.Cartesian3;F.Cartesian3.clone(t.camera.up,c);var g=new F.Cartesian3,u=new F.Cartesian3,d=F.Cartesian3.dot(c,n);F.Cartesian3.multiplyByScalar(n,2*d,u),F.Cartesian3.add(c,u,g),F.Cartesian3.normalize(g,g);var p=new F.Cartesian3(-g.x,-g.y,-g.z),C=new F.Cartesian3,m=(F.Cartesian3.clone(t.camera.position,C),new F.Cartesian3(a[0]*C.x+a[4]*C.y+a[8]*C.z+a[12],a[1]*C.x+a[5]*C.y+a[9]*C.z+a[13],a[2]*C.x+a[6]*C.y+a[10]*C.z+a[14])),f=new F.Matrix4;t.camera.frustum.far=1e8,F.Matrix4.clone(t.camera.frustum.projectionMatrix,f),this._reflectCamera.direction=l,d<.5&&(this._reflectCamera.up=p),.5<=d&&(this._reflectCamera.up=g),this._reflectCamera.position=m;var v=new F.Matrix4;F.Matrix4.inverse(this._reflectCamera.viewMatrix,v),F.Matrix4.transpose(v,v);var A=new F.Cartesian4(r.normal.x,r.normal.y,r.normal.z,-F.Cartesian3.dot(i,e));F.Matrix4.multiplyByVector(v,A,A);var I=A.w/Math.sqrt(A.x*A.x+A.y*A.y+A.z*A.z),_=new F.Cartesian3(A.x,A.y,A.z);F.Cartesian3.normalize(_,_);var y=new F.Cartesian3(_.x,_.y,_.z),w=new F.Cartesian4;w.x=(Math.asin(y.x)+f[8])/f[0],w.y=(Math.asin(y.y)+f[9])/f[5],w.z=-1,w.w=(1+f[10])/f[14];var P=new F.Cartesian4(y.x,y.y,y.z,I),x=new F.Cartesian4;F.Cartesian4.multiplyByScalar(P,2/F.Cartesian4.dot(P,w),x),f[2]=x.x,f[6]=x.y,f[10]=x.z+1,f[14]=x.w,F.Matrix4.clone(f,this._reflectCamera.frustum.projectionMatrix);var b=this._scene.frameState,E=this._scene.context,T=E.uniformState;new F.ClearCommand({color:F.Color.fromBytes(14,33,60,255),depth:1,framebuffer:this._reflectPassState.framebuffer}).execute(E,this._reflectPassState);var S=this._reflectCamera;T.updateCamera(S);for(var M=S.frustum.computeCullingVolume(S.positionWC,S.directionWC,S.upWC),D=b.commandList,R=0;R<D.length;R++){var L=D[R];L instanceof F.ComputeCommand||"water"!=L.water&&L.pass!==F.Pass.GLOBE&&t.isVisible(L,M)&&(T.updatePass(L.pass),L.execute(E,this._reflectPassState))}T.updateCamera(t.camera),T.updateFrustum(t.camera.workingFrustums[0])}},t.prototype.release=function(){this._initialized=!1,this._waterPolygon=void 0,this._drawCommand=void 0},t.prototype.destroy=function(){this._scene.primitives.remove(this),F.destroyObject(this)}}(window.Cesium),function(g){var i=g.defaultValue;g.defined;function t(t){t=i(t,i.EMPTY_OBJECT),this.proxy=t.proxy,this.viewer=t.viewer,this.url=t.url,this.metadata=t.metadata,this.roadMetadata=t.roadMetadata,this.roadUrl=t.roadUrl,this.labelGraphics=t.labelGraphics?t.labelGraphics:{},this.billboardGraphics=t.billboardGraphics?t.billboardGraphics:{},this.aotuCollide=!!t.aotuCollide,this.collisionPadding=t.collisionPadding?t.collisionPadding:[3,5,3,5],this.serverFirstStyle=!!t.serverFirstStyle,this.subdomains=t.subdomains,g.isArray(this.subdomains)?this.subdomains=this.subdomains.slice():g.defined(this.subdomains)&&0<this.subdomains.length?this.subdomains=this.subdomains.split(""):this.subdomains=["a","b","c"],this.tileCache=[],this.labelCache=[],this._isInitial=!1,this._latelyGrid=[],this._latelyRefreshStamp=0,this._latelyCollisionStamp=0;var e=g.createGuid();this._UUID="GEO_WTFS_LABEL_"+e,this._UUIDRoad="GEO_WTFS_LABEL_ROAD_"+e,this.viewer.camera.percentageChanged=.18,this.bindEvent()}function h(t,e){return e.minX>=t.minX&&e.minX<=t.maxX&&e.minY>=t.minY&&e.minY<=t.maxY||(e.maxX>=t.minX&&e.maxX<=t.maxX&&e.maxY>=t.minY&&e.maxY<=t.maxY||(e.minX>=t.minX&&e.minX<=t.maxX&&e.maxY>=t.minY&&e.maxY<=t.maxY||e.maxX>=t.minX&&e.maxX<=t.maxX&&e.minY>=t.minY&&e.minY<=t.maxY))}function u(t,e){var i=t.x,r=t.y,n=t.width,o=t.height,a=e.x,s=e.y,l=e.width,h=e.height;return!(a<=i&&a+l<=i)&&(!(i<=a&&i+n<=a)&&(!(s<=r&&s+h<=r)&&!(r<=s&&r+o<=s)))}g.defineProperties(t.prototype,{}),t.prototype.getCacheTile=function(t,e,i,r){for(var n=0;n<this.tileCache.length;n++)if(this.tileCache[n].x===t&&this.tileCache[n].y===e&&this.tileCache[n].z===i&&this.tileCache[n].t===r)return this.tileCache[n];return null},t.prototype.addCacheTile=function(t){999<this.tileCache.length&&this.tileCache.splice(0,500),this.removeCacheTile(t.x,t.y,t.z,t.t),this.tileCache.push(t)},t.prototype.removeCacheTile=function(t,e,i,r){for(var n=0;n<this.tileCache.length;n++)if(this.tileCache[n].x===t&&this.tileCache[n].y===e&&this.tileCache[n].z===i&&this.tileCache[n].t===r){this.tileCache.splice(n,1);break}},t.prototype.getCacheLabel=function(t){for(var e=0;e<this.labelCache.length;e++)if(this.labelCache[e].name===this._UUID&&this.labelCache[e].oid===t)return this.labelCache[e];return null},t.prototype.addCacheLabel=function(t){999<this.labelCache.length&&this.labelCache.splice(0,250),this.removeCacheLabel(t.oid),t.timestamp=(new Date).getTime(),this.labelCache.push(t)},t.prototype.removeCacheLabel=function(t){for(var e=0;e<this.labelCache.length;e++)if(this.labelCache[e].name===this._UUID&&this.labelCache[e].oid===t){this.labelCache.splice(e,1);break}},t.prototype.getTileUrl=function(){return(this.proxy?this.proxy.proxy:"")+this.url+"/GetTiles?lxys={z},{x},{y}"},t.prototype.getIcoUrl=function(){return(this.proxy?this.proxy.proxy:"")+this.url+"/GetIcon?id={id}"},t.prototype.getRoadTileUrl=function(){return(this.proxy?this.proxy.proxy:"")+this.roadUrl},t.prototype._moveEnd=function(){var t=this;clearTimeout(this._timer);var e=this.viewer.scene.globe._surface;if(e._tilesToRender.length<2||0<e._tileLoadQueueHigh.length)this._timer=setTimeout(function(){t._moveEnd()},100);else{var i=this.getTilesToRender();if(this.compareArray(i,this._latelyGrid))return;this._queueCall(i),t.delaySynchronous()}},t.prototype._changed=function(){var t=(new Date).getTime(),e=t-this._latelyRefreshStamp,i=t-this._latelyCollisionStamp;300<e&&this._moveEnd(),150<i&&this.collisionDetection()},t.prototype._queueCall=function(t){var l=this;l._latelyGrid=t,l._latelyRefreshStamp=(new Date).getTime(),t.forEach(function(t,e,i){if(l.metadata&&h(l.metadata.boundBox,t.boundBox)){if(l.metadata.minLevel>t.level+1||l.metadata.maxLevel<t.level+1)return;var r=l.getCacheTile(t.x,t.y,t.level+1,0);if(r)l.addLabelAndIco(r);else{var n=l.getTileUrl().replace("{z}",t.level+1).replace("{y}",t.y).replace("{x}",t.x).replace("{s}",l.subdomains[(t.x+t.y+t.level)%l.subdomains.length]),o=new XMLHttpRequest;o.open("GET",n,!0),o.responseType="arraybuffer",o.onload=function(){if(!(o.status<200||300<=o.status)){var t=l.CutString(o.response);if(t){(e=d(t)).x=this.tile.x,e.y=this.tile.y,e.z=this.tile.z,e.t=0,l.addCacheTile(e),l.addLabelAndIco(e)}else{var e={x:this.tile.x,y:this.tile.y,z:this.tile.z,t:0};l.addCacheTile(e),l.delaySynchronous()}}},o.onerror=function(t){console.error(t)},o.send(),o.tile={x:t.x,y:t.y,z:t.level+1}}}if(l.roadMetadata&&h(l.roadMetadata.boundBox,t.boundBox)){if(l.roadMetadata.minLevel>t.level+1||l.roadMetadata.maxLevel<t.level+1)return;if(r=l.getCacheTile(t.x,t.y,t.level+1,1))l.addLabelAndIco(r);else{var a=l.getRoadTileUrl().replace("{z}",t.level+1).replace("{y}",t.y).replace("{x}",t.x),s=new XMLHttpRequest;s.open("GET",a,!0),s.responseType="json",s.onload=function(){if(!(s.status<200||300<=s.status)){var t=s.response;if(t){var e={pois:t.map(function(t,e,i){return{oid:t.LabelPoint.X+"_"+t.LabelPoint.Y,name:t.Feature.properties.Name,coordinate:[t.LabelPoint.X,t.LabelPoint.Y,t.LabelPoint.Z?t.LabelPoint.Z:0]}}),x:this.tile.x,y:this.tile.y,z:this.tile.z,t:1};l.addCacheTile(e),l.addLabelAndIco(e)}else{e={x:this.tile.x,y:this.tile.y,z:this.tile.z,t:1};l.addCacheTile(e),l.delaySynchronous()}}},s.onerror=function(t){console.error(t)},s.send(),s.tile={x:t.x,y:t.y,z:t.level+1}}}})},t.prototype.initTDT=function(t){var e=0,i=this;i._isInitial=!0,i._queueCall(t);var r=setInterval(function(){3<e&&(i._isInitial=!1,clearInterval(r)),e%2==0&&i.aotuCollide&&i.collisionDetection(),e++},600);return i},t.prototype.getTilesToRender=function(){for(var t=this.viewer.scene.globe._surface._tilesToRender.map(function(t,e,i){return{x:t.x,y:t.y,level:t.level,boundBox:{minX:g.Math.toDegrees(t.rectangle.west),minY:g.Math.toDegrees(t.rectangle.south),maxX:g.Math.toDegrees(t.rectangle.east),maxY:g.Math.toDegrees(t.rectangle.north)}}}).sort(function(t,e){return e.level-t.level}),e=[t[0].level],i=0;i<t.length;i++)t[i].level!=e[e.length-1]&&e.push(t[i].level),4<e.length&&(t.splice(i),i--);return t},t.prototype.addLabelAndIco=function(t){if(t.pois)for(var e=0;e<t.pois.length;e++){var i=this.getCacheLabel(t.pois[e].oid);i=i||this.createLabel(t.pois[e],t),this.addCacheLabel(i)}this.delaySynchronous()},t.prototype.delaySynchronous=function(){var t=this;clearTimeout(t._timer2),t._timer2=setTimeout(function(){t.synchronousLabel()},100)},t.prototype.synchronousLabel=function(){for(var t=0;t<this.labelCache.length;t++)this.labelCache[t].timestamp>=this._latelyRefreshStamp&&!this.viewer.entities.contains(this.labelCache[t])&&(this._isInitial&&this.aotuCollide&&(this.labelCache[t].show=!1),this.viewer.entities.add(this.labelCache[t]));if(!this._isInitial){for(t=0;t<this.viewer.entities.values.length;t++)!this.viewer.entities.values[t].name||this.viewer.entities.values[t].name!==this._UUID&&this.viewer.entities.values[t].name!==this._UUIDRoad||this.viewer.entities.values[t].timestamp<this._latelyRefreshStamp&&(this.viewer.entities.remove(this.viewer.entities.values[t]),t--);this.aotuCollide&&this.collisionDetection()}},t.prototype.createLabel=function(t,e){if(t){var i,r,n={show:!0,position:g.Cartesian3.fromDegrees(t.coordinate[0],t.coordinate[1],t.coordinate[2]),label:{text:t.name}};if(this.serverFirstStyle&&void 0!==t.fontSize)n.label.font=t.fontSize+"px ",void 0!==t.fontNameIndex&&e.stringTable&&e.stringTable[t.fontNameIndex]?n.label.font+=e.stringTable[t.fontNameIndex]:n.label.font+="sans-serif",!this.labelGraphics.bold&&1!==t.fontStyle&&3!==t.fontStyle||(i=!0),2!==t.fontStyle&&3!==t.fontStyle||(r=!0),i&&(n.label.font="bold "+n.label.font),r&&(n.label.font="italic "+n.label.font);else this.labelGraphics.font&&(n.label.font=this.labelGraphics.font);this.serverFirstStyle&&void 0!==t.fontColor?n.label.fillColor=g.Color.fromCssColorString(this.HexadecimalConversion(t.fontColor)):this.labelGraphics.fillColor&&(n.label.fillColor=this.labelGraphics.fillColor),this.serverFirstStyle&&void 0!==t.shiningColor?n.label.outlineColor=g.Color.fromCssColorString(this.HexadecimalConversion(t.shiningColor)):this.labelGraphics.outlineColor&&(n.label.outlineColor=this.labelGraphics.outlineColor),this.serverFirstStyle&&"number"==typeof t.shiningSize?n.label.outlineWidth=t.shiningSize:void 0!==this.labelGraphics.outlineWidth&&(n.label.outlineWidth=this.labelGraphics.outlineWidth),this.serverFirstStyle&&void 0!==t.showBackground?n.label.showBackground=t.showBackground:void 0!==this.labelGraphics.showBackground&&(n.label.showBackground=this.labelGraphics.showBackground),this.serverFirstStyle&&void 0!==t.backgroundColor?n.label.backgroundColor=t.backgroundColor:void 0!==this.labelGraphics.backgroundColor&&(n.label.backgroundColor=this.labelGraphics.backgroundColor),this.serverFirstStyle&&void 0!==t.backgroundPadding?n.label.backgroundPadding=t.backgroundPadding:void 0!==this.labelGraphics.backgroundPadding&&(n.label.backgroundPadding=this.labelGraphics.backgroundPadding),e.t?(n.label.verticalOrigin=g.VerticalOrigin.CENTER,n.label.horizontalOrigin=g.HorizontalOrigin.CENTER):(this.serverFirstStyle&&void 0!==t.verticalOrigin?n.label.verticalOrigin=t.verticalOrigin:void 0!==this.labelGraphics.verticalOrigin&&(n.label.verticalOrigin=this.labelGraphics.verticalOrigin),this.serverFirstStyle&&void 0!==t.horizontalOrigin?n.label.horizontalOrigin=t.horizontalOrigin:void 0!==this.labelGraphics.horizontalOrigin&&(n.label.horizontalOrigin=this.labelGraphics.horizontalOrigin)),this.serverFirstStyle&&void 0!==t.eyeOffset?n.label.eyeOffset=t.eyeOffset:void 0!==this.labelGraphics.eyeOffset&&(n.label.eyeOffset=this.labelGraphics.eyeOffset),this.serverFirstStyle&&void 0!==t.pixelOffset?n.label.pixelOffset=t.pixelOffset:void 0!==this.labelGraphics.pixelOffset&&(n.label.pixelOffset=this.labelGraphics.pixelOffset),this.serverFirstStyle&&void 0!==t.style?n.label.style=t.style:void 0!==this.labelGraphics.style&&(n.label.style=this.labelGraphics.style),this.serverFirstStyle&&void 0!==t.scale?n.label.scale=t.scale:void 0!==this.labelGraphics.scale&&(n.label.scale=this.labelGraphics.scale),n.label.disableDepthTestDistance=this.labelGraphics.disableDepthTestDistance,void 0!==t.symbolID&&-1<t.symbolID&&(n.billboard={image:this.getIcoUrl().replace("{id}",t.symbolID).replace("{s}",this.subdomains[(e.x+e.y+e.z)%this.subdomains.length])},this.serverFirstStyle&&void 0!==t.displayHeight?(n.billboard.width=t.displayHeight,n.billboard.height=t.displayHeight):void 0===this.billboardGraphics.width&&void 0===this.billboardGraphics.height||(n.billboard.width=this.billboardGraphics.width,n.billboard.height=this.billboardGraphics.height),e.t?(n.label.verticalOrigin=g.VerticalOrigin.BOTTOM,n.label.horizontalOrigin=g.HorizontalOrigin.CENTER):(this.serverFirstStyle&&void 0!==t.verticalOrigin?n.billboard.verticalOrigin=t.verticalOrigin:void 0!==this.billboardGraphics.verticalOrigin&&(n.billboard.verticalOrigin=this.billboardGraphics.verticalOrigin),this.serverFirstStyle&&void 0!==t.horizontalOrigin?n.billboard.horizontalOrigin=t.horizontalOrigin:void 0!==this.billboardGraphics.horizontalOrigin&&(n.billboard.horizontalOrigin=this.billboardGraphics.horizontalOrigin)),this.serverFirstStyle&&void 0!==t.eyeOffset?n.billboard.eyeOffset=t.eyeOffset:void 0!==this.billboardGraphics.eyeOffset&&(n.billboard.eyeOffset=this.billboardGraphics.eyeOffset),this.serverFirstStyle&&void 0!==t.pixelOffset?n.billboard.pixelOffset=t.pixelOffset:void 0!==this.billboardGraphics.pixelOffset&&(n.billboard.pixelOffset=this.billboardGraphics.pixelOffset),this.serverFirstStyle&&void 0!==t.rotation?n.billboard.rotation=t.rotation:void 0!==this.billboardGraphics.rotation&&(n.billboard.rotation=this.billboardGraphics.rotation),this.serverFirstStyle&&void 0!==t.alignedAxis?n.billboard.alignedAxis=t.alignedAxis:void 0!==this.billboardGraphics.alignedAxis&&(n.billboard.alignedAxis=this.billboardGraphics.alignedAxis),this.serverFirstStyle&&void 0!==t.color?n.billboard.color=t.color:void 0!==this.billboardGraphics.color&&(n.billboard.color=this.billboardGraphics.color),this.serverFirstStyle&&void 0!==t.scale?n.billboard.scale=t.scale:void 0!==this.billboardGraphics.scale&&(n.billboard.scale=this.billboardGraphics.scale),n.billboard.disableDepthTestDistance=this.billboardGraphics.disableDepthTestDistance);var o=new g.Entity(n);return o.name=e.t?this._UUIDRoad:this._UUID,o.oid=t.oid,o.priority=t.priority?t.priority:0,o.xyz=e.x+"_"+e.y+"_"+(e.z-1),o}},t.prototype.getPropertyValue=function(t,e,i,r){return void 0!==e[t]?e[t]:void 0!==i[t]?i[t]:r},t.prototype.collisionDetection=function(){if(this.debug)for(var t=document.getElementsByClassName("debug"),e=0;e<t.length;e++)this.viewer.container.removeChild(t[e]),e--;var i=[],r=this.viewer.entities.values;for(e=0;e<r.length;e++)if(r[e].name&&(r[e].name===this._UUID||r[e].name===this._UUIDRoad)){var n,o;n=g.SceneTransforms.wgs84ToDrawingBufferCoordinates(this.viewer.scene,r[e].position.getValue(0)),!0,r[e].show=!0,o=this.getLabelReact({point:n,entity:r[e]}),r[e].collisionBox=o;for(var a=null,s=0;s<i.length;s++)if(i[s].xyz===r[e].xyz){a=i[s];break}if(a||(a={xyz:r[e].xyz,entities:[]},i.push(a)),a.entities.push(r[e]),this.debug){var l=document.createElement("div");l.setAttribute("class","debug"),l.style.cssText="position:absolute; top:"+o.y+"px; left:"+o.x+"px; width:"+o.width+"px; height:"+o.height+"px; border: solid 1px red; color: rgba(0,0,0,0);",l.innerHTML=r[e].label.text.getValue(0),this.viewer.container.appendChild(l)}}for(var h=0;h<i.length;h++){i[h].entities.sort(function(t,e){return t.priority-e.priority});for(e=0;e<i[h].entities.length;e++)if(i[h].entities[e].show)for(s=e+1;s<i[h].entities.length;s++)i[h].entities[s].show&&u(i[h].entities[e].collisionBox,i[h].entities[s].collisionBox)&&(i[h].entities[s].show=!1)}var c=[];for(h=0;h<i.length;h++)for(e=0;e<i[h].entities.length;e++)i[h].entities[e].show&&c.push(i[h].entities[e]);for(e=0;e<c.length;e++)if(c[e].show){c.sort(function(t,e){return t.priority-e.priority});for(s=e+1;s<c.length;s++)c[s].show&&u(c[e].collisionBox,c[s].collisionBox)&&(c[s].show=!1)}},t.prototype.bindEvent=function(){this.viewer.scene.camera.moveEnd.addEventListener(this._moveEnd,this),this.viewer.scene.camera.changed.addEventListener(this._changed,this)},t.prototype.unbindEvent=function(){this.viewer.scene.camera.moveEnd.removeEventListener(this._moveEnd,this),this.viewer.scene.camera.changed.removeEventListener(this._changed,this)},t.prototype.activate=function(){this._latelyGrid=[],this._moveEnd()},t.prototype.destroy=function(){for(var t=0;t<this.viewer.entities.values.length;t++)!this.viewer.entities.values[t].name||this.viewer.entities.values[t].name!==this._UUID&&this.viewer.entities.values[t].name!==this._UUIDRoad||(this.viewer.entities.remove(this.viewer.entities.values[t]),t--);this.viewer.camera.percentageChanged=.5,this.unbindEvent(),this.handler=this.handler&&this.handler.destroy(),this.proxy=void 0,this.viewer=void 0,this.url=void 0,this.labelGraphics=void 0,this.billboardGraphics=void 0,this.aotuCollide=void 0,this.collisionPadding=void 0,this.tileCache=void 0,this.labelCache=void 0,this._latelyGrid=void 0,this._latelyRefreshStamp=void 0,this._roadTileset=void 0},t.prototype.compareArray=function(t,e){for(var i=!1,r=0;r<t.length;r++){for(var n=!1,o=0;o<e.length;o++)if(t[r].x===e[o].x&&t[r].y===e[o].y&&t[r].level===e[o].level){n=!0;break}if(!n){i=!0;break}}return!i},t.prototype.getLabelReact=function(t){var e=parseInt(t.entity.label.font);e=0<e?e:15;for(var i=t.entity.label.text.getValue(0).split("\n"),r=0,n=i.length,o=0;o<i.length;o++){var a=c(i[o])/2;r<a&&(r=a)}var s=t.entity.billboard?t.entity.billboard.width.getValue(0)*t.entity.billboard.scale.getValue(0):1,l=t.entity.billboard?t.entity.billboard.height.getValue(0)*t.entity.billboard.scale.getValue(0):1;return{x:(t.point?t.point.x:-999)-s/2-this.collisionPadding[3],y:(t.point?t.point.y:-999)-l/2-this.collisionPadding[0],width:e*t.entity.label.scale.getValue(0)*r+t.entity.label.pixelOffset.getValue(0).x+s+this.collisionPadding[1],height:e*t.entity.label.scale.getValue(0)*(n+.5*(n-1))+t.entity.label.pixelOffset.getValue(0).y+l/2+this.collisionPadding[2]}},t.prototype.CutString=function(t){if(!t)return"";var e=t.byteLength;return e<=28?"":t.slice(19,e-9)},t.prototype.HexadecimalConversion=function(t){if(4278190080===t)return"#000000";var e=4278190080|parseInt(-Number(t));t="";if((e=e.toString(16).substring(1)).length<6)for(var i=6-e.length,r=0;r<i;r++)t+="0";return"#"+t+e},t.prototype.getLabelVisibility=function(t){if(!t)return!1;var e=this.viewer.canvas.getBoundingClientRect();return!(t.x<-10||t.x>e.right+10)&&!(t.y<-10||t.y>e.bottom+10)};var c=function(t){for(var e=0,i=0;i<t.length;i++){null!=t.charAt(i).match(/[^\x00-\xff]/gi)?e+=2:e+=1}return e},d=function(t){var i={stringTable:[],pois:[],enumGeometryType:[{ePoint:0},{eMultiLineString:1},{ePolygon:2}],enumZCoordType:[{eCloseGround:0},{eCloseSeaSurface:1},{eRelativelyGround:2},{eAbsolute:3}]},e=function(){if("undefined"==typeof dcodeIO||!dcodeIO.ProtoBuf)throw new Error("ProtoBuf.js is not present. Please see www/index.html for manual setup instructions.");return dcodeIO.ProtoBuf.loadProto("option optimize_for = LITE_RUNTIME;package GEOPOI;enum enumGeometryType {ePoint = 0;eMultiLineString = 1;ePolygon = 2;} ;message PBPOI{required uint64 OID = 1;required string Name =2;repeated double Coordinates =3 [packed=true];required enumGeometryType GeometryType = 4;optional int32 Interate = 5;optional int32 SymbolID = 10  [default = 0];optional double DisplayHeight = 11 [default = 32];optional uint32 ShiningColor=12 [default =0];optional uint32\tFontNameIndex=13 [default =0];optional int32\tFontSize=14 [default =18];optional uint32\tFontColor=15 [default =0];};message StringTable {repeated string s = 1;}message PBPOITile{required int64 Version = 1;required int64 TileKey = 2;required StringTable StringTable = 3;repeated PBPOI POIS = 4;};","GEOPOI","GeoPOI.proto").build("GEOPOI").PBPOITile}(),r=function(){if("undefined"==typeof dcodeIO||!dcodeIO.ProtoBuf)throw new Error("ProtoBuf.js is not present. Please see www/index.html for manual setup instructions.");return dcodeIO.ProtoBuf.loadProto("option optimize_for = LITE_RUNTIME;package GEOPOI;enum enumGeometryType {ePoint = 0;eMultiLineString = 1;ePolygon = 2;};enum enumZCoordType {eCloseGround = 0;eCloseSeaSurface = 1;eRelativelyGround = 2;eAbsolute = 3;};message PBPOI{required uint64 OID = 1;required string Name =2;repeated double Coordinates =3 [packed=true];required enumGeometryType GeometryType = 4;optional int32 Interate = 5;optional int32 SymbolID = 10  [default = 0];optional double DisplayHeight = 11 [default = 32];optional uint32 ShiningColor=12 [default =0];optional uint32\tFontNameIndex=13 [default =0];optional int32\tFontSize=14 [default =18];optional uint32\tFontColor=15 [default =0];optional enumZCoordType ZCoordType = 16 [default = eAbsolute];};message StringTable {repeated string s = 1;}message PBPOITile{required int64 Version = 1;required int64 TileKey = 2;required StringTable StringTable = 3;repeated PBPOI POIS = 4;};","GEOPOI","GeoPOI2.proto").build("GEOPOI").PBPOITile}(),n=function(){if("undefined"==typeof dcodeIO||!dcodeIO.ProtoBuf)throw new Error("ProtoBuf.js is not present. Please see www/index.html for manual setup instructions.");return dcodeIO.ProtoBuf.loadProto("option optimize_for = LITE_RUNTIME;package GEOPOI;enum enumGeometryType {ePoint = 0;eMultiLineString = 1;ePolygon = 2;};enum enumZCoordType {eCloseGround = 0;eCloseSeaSurface = 1;eRelativelyGround = 2;eAbsolute = 3;};message PBPOI{required uint64 OID = 1;required string Name =2;repeated double Coordinates =3 [packed=true];required enumGeometryType GeometryType = 4;optional int32 Priority = 5;repeated int32 Interates =6 [packed=true];optional int32 SymbolID = 10  [default = 0];optional double DisplayHeight = 11 [default = 32];optional uint32 ShiningColor=12 [default =0];optional uint32\tFontNameIndex=13 [default =0];optional int32\tFontSize=14 [default =18];optional uint32\tFontColor=15 [default =0];optional enumZCoordType ZCoordType = 16 [default = eAbsolute];optional int32 FontStyle=17;optional int32 ShiningSize=18;};message StringTable {repeated string s = 1;}message PBPOITile{required int64 Version = 1;required int64 TileKey = 2;required StringTable StringTable = 3;repeated PBPOI POIS = 4;};","GEOPOI","GeoPOI3.proto").build("GEOPOI").PBPOITile}();i.pois.length=0;var o,a=t;try{o=n.decode(a)}catch(t){console.log(t.message)}if(!o)try{o=r.decode(a)}catch(t){console.log(t.message),o=e.decode(a)}i.version=parseInt(o.Version.toString()),i.titleKey=parseInt(o.TileKey.toString()),i.stringTable=[];for(var s=o.StringTable.s.length,l=0;l<s;l++)i.stringTable.push(o.StringTable.s[l].toString());return o.POIS.forEach(function(t){var e={};e.oid=parseInt(t.OID.toString())+"_"+i.titleKey,e.name=t.Name.toString(),e.symbolID=parseInt(t.SymbolID.toString()),e.displayHeight=t.DisplayHeight,e.shiningColor=t.ShiningColor,e.fontNameIndex=t.FontNameIndex,e.fontSize=t.FontSize,e.fontColor=t.FontColor,t.ZCoordType&&(e.zCoordType=t.ZCoordType),e.geometryType=t.GeometryType,e.coordinate=t.Coordinates,e.priority=void 0===t.Priority?null:t.Priority,e.interates=void 0===t.Interates?null:t.Interates,e.fontStyle=void 0===t.FontStyle?null:t.FontStyle,e.shiningSize=void 0===t.ShiningSize?null:t.ShiningSize,i.pois.push(e)}),i};g.GeoWTFS=t}(window.Cesium),function(e){var t=e.LayerManager=function(t){this.map=t,this.serviceLayerGroup=new e.ServiceLayerGroup(t),this.modelLayerGroup=new e.ModelLayerGroup(t),this.vectorLayerGroup=new e.VectorLayerGroup(t),this.terrainLayerGroup=new e.TerrainLayerGroup(t),this.basicLayerGroup=new e.BasicLayerGroup(t)};t.prototype.getMap=function(){return this.map},t.prototype.getServiceLayerGroup=function(){return this.serviceLayerGroup},t.prototype.getModelLayerGroup=function(){return this.modelLayerGroup},t.prototype.getVectorLayerGroup=function(){return this.vectorLayerGroup},t.prototype.getTerrainLayerGroup=function(){return this.terrainLayerGroup},t.prototype.getBasicLayerGroup=function(){return this.basicLayerGroup},t.prototype.remove=function(t){e.defined(t)?t.removeAll():(this.serviceLayerGroup.removeAll(),this.modelLayerGroup.removeAll(),this.vectorLayerGroup.removeAll(),this.terrainLayerGroup.removeAll(),this.basicLayerGroup.removeAll())}}(window.Cesium),function(r){var n=r.ServiceLayerGroup=function(){};n.prototype=new r.CompositeEntityCollection,n.prototype.addLayer=function(t,e){var i="";return n.add(e)&&(e.name=t,i=r.createGuid(),e.id=i),i},n.prototype.removeLayer=function(t){var e=n.getLayer(t);return n.remove(e)},n.prototype.queryLayerByName=function(t){for(var e=null,i=0;i<n.length;i++){var r=n.get(i);if(t==r.name){e=r;break}}return e},n.prototype.getLayer=function(t){for(var e=null,i=0;i<n.length;i++){var r=n.get(i);if(t==r.id){e=r;break}}return e},n.prototype.showLayer=function(t){n.getLayer(t).show=!0},n.prototype.hideLayer=function(t){n.getLayer(t).show=!1},n.prototype.addChildLayerGroup=function(t){}}(window.Cesium),function(t){var n=t.ModelLayerGroup=function(t){this.map=t};n.prototype=new t.PrimitiveCollection,n.prototype.addLayer=function(t,e){var i=this.map.scene.primitives.add(e),r="";return i&&(e.name=t,null!=$("#model-branch-container .layer-item-title").last()[0]&&(r=$("#model-branch-container .layer-item-title").last()[0].id),e.id=r),i},n.prototype.removeLayer=function(t){for(var e=0;e<this.map.scene.primitives.length;e++){var i=this.map.scene.primitives.get(e);if(t==i.id)break}return this.map.scene.primitives.remove(i)},n.prototype.queryLayerByName=function(t){for(var e=null,i=0;i<n.length;i++){var r=n.get(i);if(t==r.name){e=r;break}}return e},n.prototype.getLayer=function(t){var e=null;if(t)for(var i=1;i<this.map.scene.primitives.length;i++){var r=this.map.scene.primitives.get(i);if(t==r.id){e=r;break}}else e=this.map.scene.primitives._primitives;return e},n.prototype.showLayer=function(t){for(var e=null,i=0;i<this.map.scene.primitives.length;i++){var r=this.map.scene.primitives.get(i);if(t==r.id){e=r;break}}e&&(e.show=!0)},n.prototype.hideLayer=function(t){for(var e=null,i=0;i<this.map.scene.primitives.length;i++){var r=this.map.scene.primitives.get(i);if(t==r.id){e=r;break}}e&&(e.show=!1)}}(window.Cesium),function(i){var t=i.VectorLayerGroup=function(t){this.map=t};t.prototype=new i.DataSourceCollection,t.prototype.addLayer=function(t,e){return e&&(e.id||(e.id=i.createGuid())),this.map.dataSources.add(e),this.map.dataSources.get(this.map.dataSources.length-1).name=t,e.id},t.prototype.removeLayer=function(t){for(var e=null,i=0;i<this.map.dataSources.length;i++)if(t==this.map.dataSources.get(i).id){e=this.map.dataSources.get(i);break}try{this.map.dataSources.remove(e)}catch(t){return void console.log("DeveloperError")}},t.prototype.queryLayerByName=function(t){for(var e=null,i=0;i<this.map.dataSources.length;i++){var r=this.map.dataSources.get(i);if(t==r._name){e=r;break}}return e},t.prototype.getLayer=function(t){for(var e=null,i=0;i<this.map.dataSources.length;i++){var r=this.map.dataSources.get(i);if(t==r.id){e=r;break}}return e},t.prototype.showLayer=function(t){for(var e=null,i=0;i<this.map.dataSources.length;i++){var r=this.map.dataSources.get(i);if(t==r.id){e=r;break}}e&&(e.show=!0)},t.prototype.hideLayer=function(t){for(var e=null,i=0;i<this.map.dataSources.length;i++){var r=this.map.dataSources.get(i);if(t==r.id){e=r;break}}e&&(e.show=!1)}}(window.Cesium),function(e){var t=e.TerrainLayerCollection=function(t){this._layers=[],this.length=this._layers.length,this.map=t};t.prototype.addTerrainProvider=function(t){if(!defined(t))throw new e.DeveloperError("terrainProvider is required.");return this.map.terrainProvider=t,this._layers=[],this._layers.push(t),this.map.terrainProvider},t.prototype.remove=function(){var t=new e.CesiumTerrainProvider({url:""});return this.map.terrainProvider=t,this._layers=[],0==this.map.terrainProvider._url_size},t.prototype.get=function(t){if(!defined(terrainProvider))throw new e.DeveloperError("id is required.");if(t==this._layers[0].id)return this._layers[0]}}(window.Cesium),function(n){var t=n.TerrainLayerGroup=function(t){this.map=t};t.prototype.addLayer=function(t,e){if(e._credit)e.id=e._credit._text;else{var i=n.createGuid();e.id=i}return e.name=t,(this.map.terrainProvider=e).id},t.prototype.removeLayer=function(t){if(t==this.map.terrainProvider.id){var e=new n.GeoTerrainProvider({proxy:new n.DefaultProxy("/proxyHandler?url="),dataType:n.GeoTerrainProvider.FLOAT,urls:[""]});this.map.terrainProvider=e}return!this.map.terrainProvider.id},t.prototype.getLayer=function(t){var e=null;if(n.defined(t))t==this.map.terrainProvider.id&&(e=this.map.terrainProvider);else e=this.map.terrainProvider;return e},t.prototype.showLayer=function(t){if(t==this.map.terrainProvider.options.credit){var e=new n.GeoTerrainProvider({proxy:new n.DefaultProxy("/proxyHandler?url="),dataType:n.GeoTerrainProvider.FLOAT,urls:this.map.terrainProvider.options._urls,credit:this.map.terrainProvider.options.credit,name:this.map.terrainProvider.options.name,maxExtent:this.map.terrainProvider.options.maxExtent,opacity:this.map.terrainProvider.options.opacity,topLevel:this.map.terrainProvider.options.topLevel,bottomLevel:this.map.terrainProvider.options.bottomLevel});e.id=t,e.name=this.map.terrainProvider.options.name,this.map.terrainProvider=e}},t.prototype.hideLayer=function(t){var e=null;if(t==this.map.terrainProvider.id){var i={_urls:(e=this.map.terrainProvider)._urls,credit:e._credit.text,name:e.name,maxExtent:e._maxExtent,opacity:e._opacity,topLevel:e._topLevel,bottomLevel:e._bottomLevel},r=new n.GeoTerrainProvider({proxy:new n.DefaultProxy("/proxyHandler?url="),dataType:n.GeoTerrainProvider.FLOAT,urls:[""]});this.map.terrainProvider=r,this.map.terrainProvider.options=i}}}(window.Cesium),function(r){var t=r.BasicLayerGroup=function(t){this.map=t};t.prototype=new r.ImageryLayerCollection,t.prototype.addLayer=function(t,e){var i=this.map.imageryLayers.addImageryProvider(e),r="";if(i){i.name=t;for(var n=0;n<$("#imagery-branch-container .layer-item-content div").length;n++){if(t==$("#imagery-branch-container .layer-item-content span")[n].innerText){r=$($("#imagery-branch-container .layer-item-content div")[n]).attr("id");break}}i.id=r}return r},t.prototype.removeLayer=function(t){for(var e=null,i=0;i<this.map.imageryLayers.length;i++)if(t==this.map.imageryLayers._layers[i].id){e=this.map.imageryLayers._layers[i];break}try{this.map.imageryLayers.remove(e)}catch(t){return void console.log("DeveloperError")}},t.prototype.queryLayerByName=function(t){if(!r.defined(t))return!1;for(var e=null,i=0;i<this.map.imageryLayers.length;i++)if(t==this.map.imageryLayers._layers[i].name){e=this.map.imageryLayers._layers[i];break}return e},t.prototype.getLayer=function(t){var e=null;if(t){for(var i=0;i<this.map.imageryLayers.length;i++)if(t==this.map.imageryLayers._layers[i].id){e=this.map.imageryLayers._layers[i];break}}else e=this.map.imageryLayers._layers;return e},t.prototype.showLayer=function(t){for(var e=null,i=0;i<this.map.imageryLayers.length;i++)if(t==this.map.imageryLayers._layers[i].id){e=this.map.imageryLayers._layers[i];break}e.show=!0},t.prototype.hideLayer=function(t){for(var e=null,i=0;i<this.map.imageryLayers.length;i++)if(t==this.map.imageryLayers._layers[i].id){e=this.map.imageryLayers._layers[i];break}e.show=!1},t.prototype.moveLayer=function(t,e){for(var i=null,r=null,n=0;n<this.map.imageryLayers.length;n++)if(t==this.map.imageryLayers._layers[n].id){i=this.map.imageryLayers._layers[n];break}for(n=0;n<this.map.imageryLayers.length;n++)if(e==this.map.imageryLayers._layers[n].id){r=this.map.imageryLayers._layers[n];break}var o=this.map.imageryLayers.indexOf(i)-this.map.imageryLayers.indexOf(r);if(0<o)for(n=0;n<o;n++)try{this.map.imageryLayers.raise(i)}catch(t){return void console.log(t)}else console.log("layer located top")},t.prototype.raiseLayer=function(t){for(var e=null,i=0;i<this.map.imageryLayers.length;i++)if(t==this.map.imageryLayers._layers[i].id){e=this.map.imageryLayers._layers[i];break}try{this.map.imageryLayers.raise(e)}catch(t){return void console.log("DeveloperError")}},t.prototype.lowerLayer=function(t){for(var e=null,i=0;i<this.map.imageryLayers.length;i++)if(t==this.map.imageryLayers._layers[i].id){e=this.map.imageryLayers._layers[i];break}try{this.map.imageryLayers.lower(e)}catch(t){return void console.log("DeveloperError")}}}(window.Cesium),function(v){var t=v.Measure=function(t){this.viewer=t.viewer,this.primitives=this.viewer.scene.primitives};t.prototype.distance=function(t,e){if(t.polyline){var i=t.polyline.positions.getValue();if(!(i.length<=1)){for(var r,n=0,o=0,a=new v.EllipsoidGeodesic,s=1;s<i.length;s++){var l=v.Cartographic.fromCartesian(i[s-1]),h=v.Cartographic.fromCartesian(i[s]);a.setEndPoints(l,h),n+=Math.round(a.surfaceDistance);var c=v.Cartographic.fromCartesian(i[s-1]),g=v.Math.toDegrees(c.longitude),u=v.Math.toDegrees(c.latitude),d=v.Cartographic.fromCartesian(i[s]),p=v.Math.toDegrees(d.longitude),C=v.Math.toDegrees(d.latitude),m=turf.point([g,u]),f=turf.point([p,C]);o+=turf.distance(m,f)}return 2==e?r=n<1e3?n.toFixed(2)+"m":(n/1e3).toFixed(2)+"km":1==e&&(r=o<1?(1e3*o).toFixed(2)+"m":o.toFixed(2)+"km"),r}}},t.prototype.area=function(t){if(t.polygon){var e=t.polygon.hierarchy.getValue().positions;if(!(e.length<=2)){for(var i=[],r=0;r<e.length;r++){var n=v.Cartographic.fromCartesian(e[r]),o=v.Math.toDegrees(n.longitude),a=v.Math.toDegrees(n.latitude);i.push([o,a])}i.push(i[0]);var s=turf.polygon([i]),l=turf.area(s);return l<1e6?l.toFixed(2)+"m²":(l/1e6).toFixed(2)+"km²"}}},t.prototype.height=function(t){if(t.polyline){var e=t.polyline.positions.getValue();if(2==(e=[e[0],e[1]]).length){for(var i=[],r=0;r<e.length;r++){var n=v.Cartographic.fromCartesian(e[r]),o=v.Math.toDegrees(n.longitude),a=v.Math.toDegrees(n.latitude),s=n.height;i.push(o),i.push(a),i.push(s)}i[2]>=i[5]?(i.push(i[0]),i.push(i[1]),i.push(i[5])):(i.push(i[3]),i.push(i[4]),i.push(i[2]));var l={horizontalDistance:null,verticalHeight:null,spaceDistance:null},h=1e3*turf.distance(turf.point([i[0],i[1]]),turf.point([i[3],i[4]]));(g=[]).push((i[0]+i[3])/2),g.push((i[1]+i[4])/2),i[2]>=i[5]?g.push(i[5]):g.push(i[2]),l.horizontalDistance=h<1e3?"水平距离："+h.toFixed(2)+"m":"水平距离："+(h/1e3).toFixed(2)+"km";var c=Math.abs(i[2]-i[5]),g=[];i[2]>=i[5]?(g.push(i[0]),g.push(i[1])):(g.push(i[3]),g.push(i[4])),g.push((i[2]+i[5])/2),l.verticalHeight=c<1e3?"垂直高度："+c.toFixed(2)+"m":"垂直高度："+(c/1e3).toFixed(2)+"km";var u=Math.sqrt(Math.pow(h,2)+Math.pow(c,2));return(g=[]).push((i[0]+i[3])/2),g.push((i[1]+i[4])/2),g.push((i[2]+i[5])/2),l.spaceDistance=u<1e3?"空间距离："+u.toFixed(2)+"m":"空间距离："+(u/1e3).toFixed(2)+"km",l}}},t.prototype.elevation=function(t){if(t.point){var e=[t.position._value];if(1==e.length){v.Cartographic.fromCartesian(e[0]).height.toFixed(2);createResultLabel2(this.options,this.primitives,e)}}}}(window.Cesium);_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(R){var t=R.MVTProvider=function(r){r=R.defaultValue(r,R.defaultValue.EMPTY_OBJECT),this._viewer=r.viewer,this._tilingScheme=R.defined(r.tilingScheme)?r.tilingScheme:new R.WebMercatorTilingScheme({ellipsoid:r.ellipsoid}),this._tileWidth=R.defaultValue(r.tileWidth,512),this._tileHeight=R.defaultValue(r.tileHeight,512),this._readyPromise=R.when.resolve(!0),this._mvtParser=new ol.format.MVT,this._proxy=r.proxy,this._layer=r.layer,this._styleName=r.styleName,this._tileMatrixSetID=r.tileMatrixSetID,this._tileMatrixLabels=r.tileMatrixLabels,this._format="protobuf",this._minimumLevel=R.defaultValue(r.minimumLevel,0),this._maximumLevel=r.maximumLevel,this._sourceMaxzoom=R.defaultValue(r.sourceMaxzoom,22),this._spriteUrl=void 0,this.enablePickFeatures=R.defaultValue(r.enablePickFeatures,!0),this._pickedEvent=new R.Event,this._key=R.defaultValue(r.key,""),this._url=R.defaultValue(r.url,"https://a.tiles.mapbox.com/v4/mapbox.mapbox-streets-v6/{z}/{x}/{y}.vector.pbf?access_token={k}");var t=this._tilingScheme._rectangleSouthwestInMeters,e=(this._tilingScheme._rectangleNortheastInMeters,null);if(!t)this._tilingScheme.rectangle;this._tilingScheme instanceof R.WebMercatorTilingScheme?e=[-20037508.342789244,-20037508.342789244,20037508.342789244,20037508.342789244]:this._tilingScheme instanceof R.GeographicTilingScheme&&(e=[-180,-270,180,90]),this._resolutions=ol.tilegrid.resolutionsFromExtent(e,22,this._tileWidth),this._pixelRatio=1,this._transform=[.125,0,0,.125,0,0],this._replays=["Default","Image","Polygon","LineString","Text"],this._tileQueue=new R.TileReplacementQueue,this._cacheSize=1e3,this._featuresCache={},this._styles=void 0,this.styleFunc=function(){return[]};var n=this,i=this.getStyleUrl();i=this._proxy.getURL(i);(Number(R.VERSION)<1.42?R.loadJson(i):R.Resource.fetchJson(i)).then(function(e){if(!e.sources){for(var t="mysourceid",i=0;i<e.layers.length;i++)e.layers[i].source=t;e.sources={},e.sources[t]={type:"vector",url:r.url}}if((n._styles=e).sprite&&(n._spriteUrl=n._proxy.getURL(e.sprite)),e.glyphs)n._proxy.getURL(e.glyphs);if(n._spriteUrl){(Number(R.VERSION)<1.42?R.loadJson(n._spriteUrl+".json"):R.Resource.fetchJson(n._spriteUrl+".json")).then(function(t){n.spriteData=t,n.styleFunc=GeOLMS.stylefunction(e,Object.keys(e.sources),n._resolutions,t,n._spriteUrl+".png")})}else n.spriteData=void 0,n.styleFunc=GeOLMS.stylefunction(e,Object.keys(e.sources),n._resolutions)})};function a(t){t._viewer.scene.globe._surface.forEachLoadedTile(function(t){for(var e=t.data.imagery,i=0;i<e.length;i++){var r=e[i];(R.defined(r.loadingImagery)?r.loadingImagery:r.readyImagery).imageryLayer._imageryProvider instanceof R.MVTProvider&&(t.state=R.QuadtreeTileLoadState.LOADING,R.defined(r.loadingImagery)||(r.loadingImagery=r.readyImagery,r.loadingImagery.addReference()),r.loadingImagery.state=R.ImageryState.UNLOADED)}})}function L(t,e,i){for(var r=!1,n=2;n<i.length;n+=2){var o=i[n-2],a=i[n-1],s=i[n],l=i[n+1];e<a!=e<l&&t<(s-o)*(e-a)/(l-a)+o&&(r=!r)}return r}function F(t,e,i,r){for(var n=0,o=0,a=0,s=2,l=i.length;s<l;s+=2){var h=i[s-2],c=i[s-1],g=i[s],u=i[s+1];if(d(t,e,h,c,g,u)&&(a=g-h,0==(o=c-u)&&0===a?n=(t-h)*(t-h)+(e-c)*(e-c):(n=o*t+a*e-(o*h+a*c),n*=n,n/=o*o+a*a),n<=r))return!0}return!1}function d(t,e,i,r,n,o){if(i===n&&r===o)return!0;var a=(t-i)*(t-i)+(e-r)*(e-r),s=(t-n)*(t-n)+(e-o)*(e-o),l=(n-i)*(n-i)+(o-r)*(o-r);return!(s+l<a||a+l<s)}R.defineProperties(t.prototype,{url:{get:function(){return this._url}},proxy:{get:function(){return this._proxy}},tileWidth:{get:function(){return this._tileWidth}},tileHeight:{get:function(){return this._tileHeight}},maximumLevel:{get:function(){return this._maximumLevel}},minimumLevel:{get:function(){return this._minimumLevel}},sourceMaxzoom:{get:function(){return this._sourceMaxzoom}},tilingScheme:{get:function(){return this._tilingScheme}},rectangle:{get:function(){return this._tilingScheme.rectangle}},tileDiscardPolicy:{get:function(){}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return!0}},readyPromise:{get:function(){return this._readyPromise}},credit:{get:function(){}},hasAlphaChannel:{get:function(){return!0}},styles:{get:function(){return this._styles}},pickedEvent:{get:function(){return this._pickedEvent}}}),t.prototype.getTileCredits=function(t,e,i){},t.prototype.requestImage=function(m,f,t,e){var v=this,i=this._tileMatrixLabels,A=R.defined(i)?parseInt(i[t]):t,I=R.when.defer(),r=JSON.stringify([m,f,A]),n=this._featuresCache[r];if(R.defined(n)){var o=this.renderCanvas(n,m,f,A);return I.resolve(o),o}for(var a=[],_=m,y=f,w=A;w>v._sourceMaxzoom;){_=_/2|0,y=y/2|0,w-=1;var s=JSON.stringify([_,y,w]),l=v._featuresCache[s];if(R.defined(l)){var h=R.defined(l.rect)?l.rect:[0,0,4096,4096],c=A-w,g=m-(_<<c),u=f-(y<<c),d=1+g,p=1+u,C=(h[2]-h[0])/(1<<c),P=[h[0]+g*C,h[1]+u*C,h[0]+d*C,h[1]+p*C];a.rect=P;for(var x=0;x<l.length;x++){var b=l[x];if(R.defined(P)){var E=b.getExtent();if(Math.max(P[0],E[0])>Math.min(P[2],E[2]))continue;if(Math.max(P[1],E[1])>Math.min(P[3],E[3]))continue}a.push(b)}break}}if(0<a.length){var T=JSON.stringify([m,f,A]);v._featuresCache[T]=a;o=v.renderCanvas(a,m,f,A);return I.resolve(o),o}var S=this.getUrlTmpl();S=S.replace("{x}",_).replace("{y}",y).replace("{z}",w).replace("{k}",this._key),S=this._proxy.getURL(S);return(Number(R.VERSION)<1.42?R.loadArrayBuffer(S):R.Resource.fetchArrayBuffer(S)).then(function(t){var e=v._mvtParser.readFeatures(t),i=R.defined(e.rect)?e.rect:[0,0,4096,4096],r=A-w,n=m-(_<<r),o=f-(y<<r),a=1+n,s=1+o,l=(i[2]-i[0])/(1<<r),h=[i[0]+n*l,i[1]+o*l,i[0]+a*l,i[1]+s*l],c=[];c.rect=h;for(var g=0;g<e.length;g++){var u=e[g];if(R.defined(h)){var d=u.getExtent();if(Math.max(h[0],d[0])>Math.min(h[2],d[2]))continue;if(Math.max(h[1],d[1])>Math.min(h[3],d[3]))continue}c.push(u)}var p=JSON.stringify([m,f,A]);v._featuresCache[p]=c;var C=v.renderCanvas(c,m,f,A);return I.resolve(C),C}).otherwise(function(t){console.error(t)}),I.promise},t.prototype.renderCanvas=function(t,e,i,r){var n=document.createElement("canvas");n.width=512,n.height=512;for(var o=n.getContext("2d"),a=this.styleFunc,s=R.defined(t.rect)?t.rect:[0,0,4096,4096],l=new ol.render.canvas.ReplayGroup(0,s,8,!0,100),h=0;h<t.length;h++)for(var c=t[h],g=a(t[h],r)||[],u=0;u<g.length;u++)ol.renderer.vector.renderFeature_(l,c,g[u],16);l.finish();var d=[this._tileWidth/(s[2]-s[0]),0,0,this._tileHeight/(s[3]-s[1]),-512*s[0]/(s[2]-s[0]),-512*s[1]/(s[3]-s[1])];return l.replay(o,this._pixelRatio,d,0,{},this._replays,!0),l=null,n},t.prototype.setPaintProperty=function(t,e,i){for(var r=this._styles,n=0;n<r.layers.length;n++)if(r.layers[n].id===t){r.layers[n].paint[e]=i;break}this.styleFunc=GeOLMS.stylefunction(r,Object.keys(r.sources),this._resolutions,this.spriteData,this._spriteUrl?this._spriteUrl+".png":this._spriteUrl),a(this)},t.prototype.setLayoutProperty=function(t,e,i){for(var r=this._styles,n=0;n<r.layers.length;n++)if(r.layers[n].id===t){r.layers[n].layout[e]=i;break}this.styleFunc=GeOLMS.stylefunction(r,Object.keys(r.sources),this._resolutions,this.spriteData,this._spriteUrl?this._spriteUrl+".png":this._spriteUrl),a(this)},t.prototype.setStyle=function(n){var o=this;if("string"==typeof n){var t=this._proxy.getURL(n);(Number(R.VERSION)<1.42?R.loadJson(t):R.Resource.fetchJson(t)).then(function(e){if(!e.sources){for(var t="mysourceid",i=0;i<e.layers.length;i++)e.layers[i].source=t;e.sources={};var r=n.split("?");e.sources[t]={type:"vector",url:r[0]}}if((o._styles=e).sprite&&(o._spriteUrl=o._proxy.getURL(e.sprite)),e.glyphs)o._proxy.getURL(e.glyphs);if(o._spriteUrl){(Number(R.VERSION)<1.42?R.loadJson(spriteUrl+".json"):R.Resource.fetchJson(spriteUrl+".json")).then(function(t){o.spriteData=t,o.styleFunc=GeOLMS.stylefunction(e,Object.keys(e.sources),o._resolutions,t,o._spriteUrl+".png"),a(o)})}else o.spriteData=void 0,o.styleFunc=GeOLMS.stylefunction(e,Object.keys(e.sources),o._resolutions),a(o)})}else{if(8!=(this._styles=n).version)return void console.error("style version 8 required.");if(!n.sources)return void console.error("sources does not exist");n.sprite&&(this._spriteUrl=this._proxy.getURL(n.sprite));this._proxy.getURL(n.glyphs);if(this._spriteUrl){(Number(R.VERSION)<1.42?R.loadJson(spriteUrl+".json"):R.Resource.fetchJson(spriteUrl+".json")).then(function(t){o.spriteData=t,o.styleFunc=GeOLMS.stylefunction(n,Object.keys(n.sources),o._resolutions,t,o._spriteUrl+".png"),a(o)})}else o.spriteData=void 0,o.styleFunc=GeOLMS.stylefunction(n,Object.keys(n.sources),o._resolutions),a(o)}},t.prototype.pickFeatures=function(t,e,i,r,n){if(this.enablePickFeatures){var o=null,a=this._tileMatrixLabels,s=R.defined(a)?parseInt(a[i]):i,l=null,h=null;if(this._tilingScheme instanceof R.WebMercatorTilingScheme){o=[-20037508.342789244,-20037508.342789244,20037508.342789244,20037508.342789244];var c=this._tilingScheme.projection.project(new R.Cartographic(r,n,0));l=c.x,h=c.y}else this._tilingScheme instanceof R.GeographicTilingScheme&&(o=[-180,-270,180,90],l=R.Math.toDegrees(r),h=R.Math.toDegrees(n));var g=JSON.stringify([t,e,s]),u=this._featuresCache[g],d=[],p=[];if(R.defined(u)){for(var C=R.defined(u.rect)?u.rect:[0,0,4096,4096],m=s-Math.log(4096/(C[2]-C[0]))/Math.log(2),f=(l-o[0])/(o[2]-o[0])*Math.pow(2,m),v=(o[3]-h)/(o[3]-o[1])*Math.pow(2,m),A=4096*(f-Math.floor(f)),I=4096*(v-Math.floor(v)),_=0;_<u.length;_++)for(var y=(S=u[_]).type_,w=S.ends_,P=0,x=0;x<w.length;P=w[x],x++)if("Polygon"===y||"MultiPolygon"===y){if(L(A,I,S.flatCoordinates_.slice(P,w[x]))){d.push(S);break}}else if("LineString"===y||"MultiLineString"===y){var b=4096;R.defined(u.rect)&&(b=u.rect[2]-u.rect[0]);var E=4*b/512;if(F(A,I,S.flatCoordinates_.slice(P,w[x]),E*E)){d.push(S);break}}d.reverse();for(var T=0;T<d.length;T++){var S=d[T],M=this.featureToGeoJSON(S,Math.floor(f),Math.floor(v),m),D={type:"Feature",id:S.id_,properties:S.properties_,geometry:M.geometry,sourceLayer:S.properties_.layer};p.push(D)}}this._pickedEvent.raiseEvent(p)}},t.prototype.featureToGeoJSON=function(t,e,i,r){for(var n=this,o=4096*Math.pow(2,r),a=4096*e,s=4096*i,l=t.type_,h=t.ends_,c=0,g=[],u=0;u<h.length;c=h[u],u++){for(var d=t.flatCoordinates_.slice(c,h[u]),p=[],C=0;C<d.length;C+=2)p.push({x:d[C],y:d[C+1]});g.push(p)}function m(t){for(var e=0;e<t.length;e++)if(n._tilingScheme instanceof R.GeographicTilingScheme){var i=t[e];t[e]=[360*(i.x+a)/o-180,90-360*(i.y+s)/o]}else{var r=180-360*((i=t[e]).y+s)/o;t[e]=[360*(i.x+a)/o-180,360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90]}}if("Polygon"===l||"MultiPolygon"===l){for(var f=[],v=0;v<g.length;v++){var A=[];A.push(g[v]),f.push(A)}g=f;for(u=0;u<g.length;u++)for(C=0;C<g[u].length;C++)m(g[u][C]);1<g.length&&(l="MultiPolygon")}else if("LineString"===l||"MultiLineString"===l)for(u=0;u<g.length;u++)m(g[u]);return 1===g.length&&(g=g[0]),{type:"Feature",geometry:{type:l,coordinates:g},properties:t.properties_}},R.Imagery.prototype.releaseReference=function(){if(--this.referenceCount,0!==this.referenceCount)return this.referenceCount;var t=this.imageryLayer._imageryProvider;if(t instanceof R.MVTProvider){var e=this.level;t._tilingScheme instanceof R.GeographicTilingScheme&&(e+=1);var i=JSON.stringify([this.x,this.y,e]);R.defined(t._featuresCache[i])&&delete t._featuresCache[i]}return this.imageryLayer.removeImageryFromCache(this),R.defined(this.parent)&&this.parent.releaseReference(),R.defined(this.image)&&R.defined(this.image.destroy)&&this.image.destroy(),R.defined(this.texture)&&this.texture.destroy(),R.defined(this.textureWebMercator)&&this.texture!==this.textureWebMercator&&this.textureWebMercator.destroy(),R.destroyObject(this),0},t.prototype.getUrlTmpl=function(){var t={LAYER:this._layer,TILEMATRIXSET:this._tileMatrixSetID,FORMAT:this._format,TILEMATRIX:"{z}",TILEROW:"{y}",TILECOL:"{x}"},e=this.getParameterString(R.combine({SERVICE:"WMTS",VERSION:"1.0.0",REQUEST:"GetTile"},t));return this._url+"?"+e},t.prototype.getStyleUrl=function(){var t={STYLENAME:this._styleName},e=this.getParameterString(R.combine({SERVICE:"WMTS",VERSION:"1.0.0",REQUEST:"GetStyle"},t));return this._url+"?"+e},t.prototype.getParameterString=function(t){var e=[];for(var i in t){var r=t[i];if(null!=r&&"function"!=typeof r){var n;if("object"==(void 0===r?"undefined":_typeof(r))&&r.constructor==Array){for(var o,a=[],s=0,l=r.length;s<l;s++)o=r[s],a.push(null==o?"":o);n=a.join(",")}else n=r;e.push(i+"="+n)}}return e.join("&")}}(window.Cesium),function(){function nt(t){throw t}var ot=void 0,at=!0,o=this;function a(t,e){var i,r=t.split("."),n=o;r[0]in n||!n.execScript||n.execScript("var "+r[0]);for(;r.length&&(i=r.shift());)r.length||e===ot?n=n[i]?n[i]:n[i]={}:n[i]=e}var st="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;function lt(t,e){this.index="number"==typeof e?e:0,this.i=0,this.buffer=t instanceof(st?Uint8Array:Array)?t:new(st?Uint8Array:Array)(32768),2*this.buffer.length<=this.index&&nt(Error("invalid index")),this.buffer.length<=this.index&&this.f()}lt.prototype.f=function(){var t,e=this.buffer,i=e.length,r=new(st?Uint8Array:Array)(i<<1);if(st)r.set(e);else for(t=0;t<i;++t)r[t]=e[t];return this.buffer=r},lt.prototype.d=function(t,e,i){var r,n=this.buffer,o=this.index,a=this.i,s=n[o];if(i&&1<e&&(t=8<e?(l[255&t]<<24|l[t>>>8&255]<<16|l[t>>>16&255]<<8|l[t>>>24&255])>>32-e:l[t]>>8-e),e+a<8)s=s<<e|t,a+=e;else for(r=0;r<e;++r)s=s<<1|t>>e-r-1&1,8==++a&&(a=0,n[o++]=l[s],s=0,o===n.length&&(n=this.f()));n[o]=s,this.buffer=n,this.i=a,this.index=o},lt.prototype.finish=function(){var t=this.buffer,e=this.index;return 0<this.i&&(t[e]<<=8-this.i,t[e]=l[t[e]],e++),st?t.subarray(0,e):(t.length=e,t)};var t,e=new(st?Uint8Array:Array)(256);for(t=0;t<256;++t){for(var i=n=t,r=7,n=n>>>1;n;n>>>=1)i<<=1,i|=1&n,--r;e[t]=(i<<r&255)>>>0}var l=e;function c(t){this.buffer=new(st?Uint16Array:Array)(2*t),this.length=0}function g(t){var e,i,r,n,o,a,s,l,h,c,g=t.length,u=0,d=Number.POSITIVE_INFINITY;for(l=0;l<g;++l)t[l]>u&&(u=t[l]),t[l]<d&&(d=t[l]);for(e=1<<u,i=new(st?Uint32Array:Array)(e),r=1,n=0,o=2;r<=u;){for(l=0;l<g;++l)if(t[l]===r){for(s=n,h=a=0;h<r;++h)a=a<<1|1&s,s>>=1;for(c=r<<16|l,h=a;h<e;h+=o)i[h]=c;++n}++r,n<<=1,o<<=1}return[i,u,d]}function s(t,e){this.h=ht,this.w=0,this.input=st&&t instanceof Array?new Uint8Array(t):t,this.b=0,e&&(e.lazy&&(this.w=e.lazy),"number"==typeof e.compressionType&&(this.h=e.compressionType),e.outputBuffer&&(this.a=st&&e.outputBuffer instanceof Array?new Uint8Array(e.outputBuffer):e.outputBuffer),"number"==typeof e.outputIndex&&(this.b=e.outputIndex)),this.a||(this.a=new(st?Uint8Array:Array)(32768))}c.prototype.getParent=function(t){return 2*((t-2)/4|0)},c.prototype.push=function(t,e){var i,r,n,o=this.buffer;for(i=this.length,o[this.length++]=e,o[this.length++]=t;0<i&&(r=this.getParent(i),o[i]>o[r]);)n=o[i],o[i]=o[r],o[r]=n,n=o[i+1],o[i+1]=o[r+1],o[r+1]=n,i=r;return this.length},c.prototype.pop=function(){var t,e,i,r,n,o=this.buffer;for(e=o[0],t=o[1],this.length-=2,o[0]=o[this.length],o[1]=o[this.length+1],n=0;!((r=2*n+2)>=this.length)&&(r+2<this.length&&o[r+2]>o[r]&&(r+=2),o[r]>o[n]);)i=o[n],o[n]=o[r],o[r]=i,i=o[n+1],o[n+1]=o[r+1],o[r+1]=i,n=r;return{index:t,value:e,length:this.length}};var h,ht=2,u={NONE:0,r:1,k:ht,O:3},ct=[];for(h=0;h<288;h++)switch(at){case h<=143:ct.push([h+48,8]);break;case h<=255:ct.push([h-144+400,9]);break;case h<=279:ct.push([h-256+0,7]);break;case h<=287:ct.push([h-280+192,8]);break;default:nt("invalid literal: "+h)}function d(t,e){this.length=t,this.H=e}s.prototype.j=function(){var t,e,i,r,n=this.input;switch(this.h){case 0:for(i=0,r=n.length;i<r;){var o,a,s,l=e=st?n.subarray(i,i+65535):n.slice(i,i+65535),h=(i+=e.length)===r,c=ot,g=ot,u=this.a,d=this.b;if(st){for(u=new Uint8Array(this.a.buffer);u.length<=d+l.length+5;)u=new Uint8Array(u.length<<1);u.set(this.a)}if(o=h?1:0,u[d++]=0|o,s=65536+~(a=l.length)&65535,u[d++]=255&a,u[d++]=a>>>8&255,u[d++]=255&s,u[d++]=s>>>8&255,st)u.set(l,d),d+=l.length,u=u.subarray(0,d);else{for(c=0,g=l.length;c<g;++c)u[d++]=l[c];u.length=d}this.b=d,this.a=u}break;case 1:var p=new lt(st?new Uint8Array(this.a.buffer):this.a,this.b);p.d(1,1,at),p.d(1,2,at);var C,m,f,v=gt(this,n);for(C=0,m=v.length;C<m;C++)if(f=v[C],lt.prototype.d.apply(p,ct[f]),256<f)p.d(v[++C],v[++C],at),p.d(v[++C],5),p.d(v[++C],v[++C],at);else if(256===f)break;this.a=p.finish(),this.b=this.a.length;break;case ht:var A,I,_,y,w,P,x,b,E,T,S,M,D,R,L,F=new lt(st?new Uint8Array(this.a.buffer):this.a,this.b),O=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],k=Array(19);for(A=ht,F.d(1,1,at),F.d(A,2,at),I=gt(this,n),x=dt(P=ut(this.M,15)),E=dt(b=ut(this.L,7)),_=286;257<_&&0===P[_-1];_--);for(y=30;1<y&&0===b[y-1];y--);var B,N,V,z,G,U,H=_,W=y,j=new(st?Uint32Array:Array)(H+W),Y=new(st?Uint32Array:Array)(316),q=new(st?Uint8Array:Array)(19);for(B=N=0;B<H;B++)j[N++]=P[B];for(B=0;B<W;B++)j[N++]=b[B];if(!st)for(B=0,z=q.length;B<z;++B)q[B]=0;for(B=G=0,z=j.length;B<z;B+=N){for(N=1;B+N<z&&j[B+N]===j[B];++N);if(V=N,0===j[B])if(V<3)for(;0<V--;)q[Y[G++]=0]++;else for(;0<V;)V-3<(U=V<138?V:138)&&U<V&&(U=V-3),U<=10?(Y[G++]=17,Y[G++]=U-3,q[17]++):(Y[G++]=18,Y[G++]=U-11,q[18]++),V-=U;else if(Y[G++]=j[B],q[j[B]]++,--V<3)for(;0<V--;)Y[G++]=j[B],q[j[B]]++;else for(;0<V;)V-3<(U=V<6?V:6)&&U<V&&(U=V-3),Y[G++]=16,Y[G++]=U-3,q[16]++,V-=U}for(t=st?Y.subarray(0,G):Y.slice(0,G),T=ut(q,7),R=0;R<19;R++)k[R]=T[O[R]];for(w=19;4<w&&0===k[w-1];w--);for(S=dt(T),F.d(_-257,5,at),F.d(y-1,5,at),F.d(w-4,4,at),R=0;R<w;R++)F.d(k[R],3,at);for(R=0,L=t.length;R<L;R++)if(M=t[R],F.d(S[M],T[M],at),16<=M){switch(R++,M){case 16:D=2;break;case 17:D=3;break;case 18:D=7;break;default:nt("invalid code: "+M)}F.d(t[R],D,at)}var Z,X,K,Q,J,$,tt,et,it=[x,P],rt=[E,b];for(J=it[0],$=it[1],tt=rt[0],et=rt[1],Z=0,X=I.length;Z<X;++Z)if(K=I[Z],F.d(J[K],$[K],at),256<K)F.d(I[++Z],I[++Z],at),Q=I[++Z],F.d(tt[Q],et[Q],at),F.d(I[++Z],I[++Z],at);else if(256===K)break;this.a=F.finish(),this.b=this.a.length;break;default:nt("invalid compression type")}return this.a};var p=function(){function t(t){switch(at){case 3===t:return[257,t-3,0];case 4===t:return[258,t-4,0];case 5===t:return[259,t-5,0];case 6===t:return[260,t-6,0];case 7===t:return[261,t-7,0];case 8===t:return[262,t-8,0];case 9===t:return[263,t-9,0];case 10===t:return[264,t-10,0];case t<=12:return[265,t-11,1];case t<=14:return[266,t-13,1];case t<=16:return[267,t-15,1];case t<=18:return[268,t-17,1];case t<=22:return[269,t-19,2];case t<=26:return[270,t-23,2];case t<=30:return[271,t-27,2];case t<=34:return[272,t-31,2];case t<=42:return[273,t-35,3];case t<=50:return[274,t-43,3];case t<=58:return[275,t-51,3];case t<=66:return[276,t-59,3];case t<=82:return[277,t-67,4];case t<=98:return[278,t-83,4];case t<=114:return[279,t-99,4];case t<=130:return[280,t-115,4];case t<=162:return[281,t-131,5];case t<=194:return[282,t-163,5];case t<=226:return[283,t-195,5];case t<=257:return[284,t-227,5];case 258===t:return[285,t-258,0];default:nt("invalid length: "+t)}}var e,i,r=[];for(e=3;e<=258;e++)i=t(e),r[e]=i[2]<<24|i[1]<<16|i[0];return r}(),A=st?new Uint32Array(p):p;function gt(t,e){function i(t,e){var i,r,n,o,a=t.H,s=[],l=0;switch(i=A[t.length],s[l++]=65535&i,s[l++]=i>>16&255,s[l++]=i>>24,at){case 1===a:r=[0,a-1,0];break;case 2===a:r=[1,a-2,0];break;case 3===a:r=[2,a-3,0];break;case 4===a:r=[3,a-4,0];break;case a<=6:r=[4,a-5,1];break;case a<=8:r=[5,a-7,1];break;case a<=12:r=[6,a-9,2];break;case a<=16:r=[7,a-13,2];break;case a<=24:r=[8,a-17,3];break;case a<=32:r=[9,a-25,3];break;case a<=48:r=[10,a-33,4];break;case a<=64:r=[11,a-49,4];break;case a<=96:r=[12,a-65,5];break;case a<=128:r=[13,a-97,5];break;case a<=192:r=[14,a-129,6];break;case a<=256:r=[15,a-193,6];break;case a<=384:r=[16,a-257,7];break;case a<=512:r=[17,a-385,7];break;case a<=768:r=[18,a-513,8];break;case a<=1024:r=[19,a-769,8];break;case a<=1536:r=[20,a-1025,9];break;case a<=2048:r=[21,a-1537,9];break;case a<=3072:r=[22,a-2049,10];break;case a<=4096:r=[23,a-3073,10];break;case a<=6144:r=[24,a-4097,11];break;case a<=8192:r=[25,a-6145,11];break;case a<=12288:r=[26,a-8193,12];break;case a<=16384:r=[27,a-12289,12];break;case a<=24576:r=[28,a-16385,13];break;case a<=32768:r=[29,a-24577,13];break;default:nt("invalid distance")}for(i=r,s[l++]=i[0],s[l++]=i[1],s[l++]=i[2],n=0,o=s.length;n<o;++n)d[p++]=s[n];m[s[0]]++,f[s[3]]++,C=t.length+e-1,c=null}var r,n,o,a,s,l,h,c,g,u={},d=st?new Uint16Array(2*e.length):[],p=0,C=0,m=new(st?Uint32Array:Array)(286),f=new(st?Uint32Array:Array)(30),v=t.w;if(!st){for(o=0;o<=285;)m[o++]=0;for(o=0;o<=29;)f[o++]=0}for(m[256]=1,r=0,n=e.length;r<n;++r){for(o=s=0,a=3;o<a&&r+o!==n;++o)s=s<<8|e[r+o];if(u[s]===ot&&(u[s]=[]),l=u[s],!(0<C--)){for(;0<l.length&&32768<r-l[0];)l.shift();if(n<=r+3){for(c&&i(c,-1),o=0,a=n-r;o<a;++o)g=e[r+o],d[p++]=g,++m[g];break}0<l.length?(h=I(e,r,l),c?c.length<h.length?(g=e[r-1],d[p++]=g,++m[g],i(h,0)):i(c,-1):h.length<v?c=h:i(h,0)):c?i(c,-1):(g=e[r],d[p++]=g,++m[g])}l.push(r)}return d[p++]=256,m[256]++,t.M=m,t.L=f,st?d.subarray(0,p):d}function I(t,e,i){var r,n,o,a,s,l,h=0,c=t.length;a=0,l=i.length;t:for(;a<l;a++){if(r=i[l-a-1],(o=3)<h){for(s=h;3<s;s--)if(t[r+s-1]!==t[e+s-1])continue t;o=h}for(;o<258&&e+o<c&&t[r+o]===t[e+o];)++o;if(h<o&&(n=r,h=o),258===o)break}return new d(h,e-n)}function ut(t,e){var i,r,n,o,a,s=t.length,l=new c(572),h=new(st?Uint8Array:Array)(s);if(!st)for(o=0;o<s;o++)h[o]=0;for(o=0;o<s;++o)0<t[o]&&l.push(o,t[o]);if(i=Array(l.length/2),r=new(st?Uint32Array:Array)(l.length/2),1===i.length)return h[l.pop().index]=1,h;for(o=0,a=l.length/2;o<a;++o)i[o]=l.pop(),r[o]=i[o].value;for(n=function(t,i,e){function r(t){var e=d[t][p[t]];e===i?(r(t+1),r(t+1)):--g[e],++p[t]}var n,o,a,s,l,h=new(st?Uint16Array:Array)(e),c=new(st?Uint8Array:Array)(e),g=new(st?Uint8Array:Array)(i),u=Array(e),d=Array(e),p=Array(e),C=(1<<e)-i,m=1<<e-1;for(h[e-1]=i,o=0;o<e;++o)C<m?c[o]=0:(c[o]=1,C-=m),C<<=1,h[e-2-o]=(h[e-1-o]/2|0)+i;for(h[0]=c[0],u[0]=Array(h[0]),d[0]=Array(h[0]),o=1;o<e;++o)h[o]>2*h[o-1]+c[o]&&(h[o]=2*h[o-1]+c[o]),u[o]=Array(h[o]),d[o]=Array(h[o]);for(n=0;n<i;++n)g[n]=e;for(a=0;a<h[e-1];++a)u[e-1][a]=t[a],d[e-1][a]=a;for(n=0;n<e;++n)p[n]=0;for(1===c[e-1]&&(--g[0],++p[e-1]),o=e-2;0<=o;--o){for(s=n=0,l=p[o+1],a=0;a<h[o];a++)(s=u[o+1][l]+u[o+1][l+1])>t[n]?(u[o][a]=s,d[o][a]=i,l+=2):(u[o][a]=t[n],d[o][a]=n,++n);p[o]=0,1===c[o]&&r(o)}return g}(r,r.length,e),o=0,a=i.length;o<a;++o)h[i[o].index]=n[o];return h}function dt(t){var e,i,r,n,o=new(st?Uint16Array:Array)(t.length),a=[],s=[],l=0;for(e=0,i=t.length;e<i;e++)a[t[e]]=1+(0|a[t[e]]);for(e=1,i=16;e<=i;e++)s[e]=l,l+=0|a[e],l<<=1;for(e=0,i=t.length;e<i;e++)for(l=s[t[e]],s[t[e]]+=1,r=o[e]=0,n=t[e];r<n;r++)o[e]=o[e]<<1|1&l,l>>>=1;return o}function C(t,e){switch(this.l=[],this.m=32768,this.e=this.g=this.c=this.q=0,this.input=st?new Uint8Array(t):t,this.s=!1,this.n=f,this.C=!1,(e||(e={},0))&&(e.index&&(this.c=e.index),e.bufferSize&&(this.m=e.bufferSize),e.bufferType&&(this.n=e.bufferType),e.resize&&(this.C=e.resize)),this.n){case m:this.b=32768,this.a=new(st?Uint8Array:Array)(32768+this.m+258);break;case f:this.b=0,this.a=new(st?Uint8Array:Array)(this.m),this.f=this.K,this.t=this.I,this.o=this.J;break;default:nt(Error("invalid inflate mode"))}}var m=0,f=1,v=m,_=f;C.prototype.p=function(){for(;!this.s;){var t=z(this,3);switch(1&t&&(this.s=at),t>>>=1){case 0:var e=this.input,i=this.c,r=this.a,n=this.b,o=e.length,a=ot,s=r.length,l=ot;switch(this.e=this.g=0,o<=i+1&&nt(Error("invalid uncompressed block header: LEN")),a=e[i++]|e[i++]<<8,o<=i+1&&nt(Error("invalid uncompressed block header: NLEN")),a===~(e[i++]|e[i++]<<8)&&nt(Error("invalid uncompressed block header: length verify")),i+a>e.length&&nt(Error("input buffer is broken")),this.n){case m:for(;n+a>r.length;){if(a-=l=s-n,st)r.set(e.subarray(i,i+l),n),n+=l,i+=l;else for(;l--;)r[n++]=e[i++];this.b=n,r=this.f(),n=this.b}break;case f:for(;n+a>r.length;)r=this.f({v:2});break;default:nt(Error("invalid inflate mode"))}if(st)r.set(e.subarray(i,i+a),n),n+=a,i+=a;else for(;a--;)r[n++]=e[i++];this.c=i,this.b=n,this.a=r;break;case 1:this.o(B,V);break;case 2:U(this);break;default:nt(Error("unknown BTYPE: "+t))}}return this.t()};var y,w,P=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],x=st?new Uint16Array(P):P,b=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],E=st?new Uint16Array(b):b,T=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],S=st?new Uint8Array(T):T,M=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],D=st?new Uint16Array(M):M,R=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],L=st?new Uint8Array(R):R,F=new(st?Uint8Array:Array)(288);for(y=0,w=F.length;y<w;++y)F[y]=y<=143?8:y<=255?9:y<=279?7:8;var O,k,B=g(F),N=new(st?Uint8Array:Array)(30);for(O=0,k=N.length;O<k;++O)N[O]=5;var V=g(N);function z(t,e){for(var i,r=t.g,n=t.e,o=t.input,a=t.c,s=o.length;n<e;)s<=a&&nt(Error("input buffer is broken")),r|=o[a++]<<n,n+=8;return i=r&(1<<e)-1,t.g=r>>>e,t.e=n-e,t.c=a,i}function G(t,e){for(var i,r,n=t.g,o=t.e,a=t.input,s=t.c,l=a.length,h=e[0],c=e[1];o<c&&!(l<=s);)n|=a[s++]<<o,o+=8;return r=(i=h[n&(1<<c)-1])>>>16,t.g=n>>r,t.e=o-r,t.c=s,65535&i}function U(t){function e(t,e,i){var r,n,o,a=this.z;for(o=0;o<t;)switch(r=G(this,e)){case 16:for(n=3+z(this,2);n--;)i[o++]=a;break;case 17:for(n=3+z(this,3);n--;)i[o++]=0;a=0;break;case 18:for(n=11+z(this,7);n--;)i[o++]=0;a=0;break;default:a=i[o++]=r}return this.z=a,i}var i,r,n,o,a=z(t,5)+257,s=z(t,5)+1,l=z(t,4)+4,h=new(st?Uint8Array:Array)(x.length);for(o=0;o<l;++o)h[x[o]]=z(t,3);if(!st)for(o=l,l=h.length;o<l;++o)h[x[o]]=0;i=g(h),r=new(st?Uint8Array:Array)(a),n=new(st?Uint8Array:Array)(s),t.z=0,t.o(g(e.call(t,a,i,r)),g(e.call(t,s,i,n)))}function H(t){if("string"==typeof t){var e,i,r=t.split("");for(e=0,i=r.length;e<i;e++)r[e]=(255&r[e].charCodeAt(0))>>>0;t=r}for(var n,o=1,a=0,s=t.length,l=0;0<s;){for(s-=n=1024<s?1024:s;a+=o+=t[l++],--n;);o%=65521,a%=65521}return(a<<16|o)>>>0}function W(t,e){var i,r;switch(this.input=t,this.c=0,(e||(e={},0))&&(e.index&&(this.c=e.index),e.verify&&(this.N=e.verify)),i=t[this.c++],r=t[this.c++],15&i){case j:this.method=j;break;default:nt(Error("unsupported compression method"))}0!=((i<<8)+r)%31&&nt(Error("invalid fcheck flag:"+((i<<8)+r)%31)),32&r&&nt(Error("fdict flag is not supported")),this.B=new C(t,{index:this.c,bufferSize:e.bufferSize,bufferType:e.bufferType,resize:e.resize})}C.prototype.o=function(t,e){var i=this.a,r=this.b;this.u=t;for(var n,o,a,s,l=i.length-258;256!==(n=G(this,t));)if(n<256)l<=r&&(this.b=r,i=this.f(),r=this.b),i[r++]=n;else for(s=E[o=n-257],0<S[o]&&(s+=z(this,S[o])),n=G(this,e),a=D[n],0<L[n]&&(a+=z(this,L[n])),l<=r&&(this.b=r,i=this.f(),r=this.b);s--;)i[r]=i[r++-a];for(;8<=this.e;)this.e-=8,this.c--;this.b=r},C.prototype.J=function(t,e){var i=this.a,r=this.b;this.u=t;for(var n,o,a,s,l=i.length;256!==(n=G(this,t));)if(n<256)l<=r&&(l=(i=this.f()).length),i[r++]=n;else for(s=E[o=n-257],0<S[o]&&(s+=z(this,S[o])),n=G(this,e),a=D[n],0<L[n]&&(a+=z(this,L[n])),l<r+s&&(l=(i=this.f()).length);s--;)i[r]=i[r++-a];for(;8<=this.e;)this.e-=8,this.c--;this.b=r},C.prototype.f=function(){var t,e,i=new(st?Uint8Array:Array)(this.b-32768),r=this.b-32768,n=this.a;if(st)i.set(n.subarray(32768,i.length));else for(t=0,e=i.length;t<e;++t)i[t]=n[t+32768];if(this.l.push(i),this.q+=i.length,st)n.set(n.subarray(r,32768+r));else for(t=0;t<32768;++t)n[t]=n[r+t];return this.b=32768,n},C.prototype.K=function(t){var e,i,r,n=this.input.length/this.c+1|0,o=this.input,a=this.a;return t&&("number"==typeof t.v&&(n=t.v),"number"==typeof t.G&&(n+=t.G)),i=n<2?(r=(o.length-this.c)/this.u[2]/2*258|0)<a.length?a.length+r:a.length<<1:a.length*n,st?(e=new Uint8Array(i)).set(a):e=a,this.a=e},C.prototype.t=function(){var t,e,i,r,n,o=0,a=this.a,s=this.l,l=new(st?Uint8Array:Array)(this.q+(this.b-32768));if(0===s.length)return st?this.a.subarray(32768,this.b):this.a.slice(32768,this.b);for(e=0,i=s.length;e<i;++e)for(r=0,n=(t=s[e]).length;r<n;++r)l[o++]=t[r];for(e=32768,i=this.b;e<i;++e)l[o++]=a[e];return this.l=[],this.buffer=l},C.prototype.I=function(){var t,e=this.b;return st?this.C?(t=new Uint8Array(e)).set(this.a.subarray(0,e)):t=this.a.subarray(0,e):(this.a.length>e&&(this.a.length=e),t=this.a),this.buffer=t},W.prototype.p=function(){var t,e=this.input;return t=this.B.p(),this.c=this.B.c,this.N&&((e[this.c++]<<24|e[this.c++]<<16|e[this.c++]<<8|e[this.c++])>>>0!==H(t)&&nt(Error("invalid adler-32 checksum"))),t};var j=8;function Y(t,e){this.input=t,this.a=new(st?Uint8Array:Array)(32768),this.h=q.k;var i,r={};for(i in(e||(e={},0))&&"number"==typeof e.compressionType&&(this.h=e.compressionType),e)r[i]=e[i];r.outputBuffer=this.a,this.A=new s(this.input,r)}var q=u;function Z(t,e){var i,r,n,o;if(Object.keys)i=Object.keys(e);else for(r in i=[],n=0,e)i[n++]=r;for(n=0,o=i.length;n<o;++n)a(t+"."+(r=i[n]),e[r])}Y.prototype.j=function(){var t,e,i,r,n,o,a,s=0;switch(a=this.a,t=j){case j:e=Math.LOG2E*Math.log(32768)-8;break;default:nt(Error("invalid compression method"))}switch(i=e<<4|t,a[s++]=i,t){case j:switch(this.h){case q.NONE:n=0;break;case q.r:n=1;break;case q.k:n=2;break;default:nt(Error("unsupported compression type"))}break;default:nt(Error("invalid compression method"))}return r=n<<6|0,a[s++]=r|31-(256*i+r)%31,o=H(this.input),this.A.b=s,s=(a=this.A.j()).length,st&&((a=new Uint8Array(a.buffer)).length<=s+4&&(this.a=new Uint8Array(a.length+4),this.a.set(a),a=this.a),a=a.subarray(0,s+4)),a[s++]=o>>24&255,a[s++]=o>>16&255,a[s++]=o>>8&255,a[s++]=255&o,a},a("Zlib.Inflate",W),a("Zlib.Inflate.prototype.decompress",W.prototype.p),Z("Zlib.Inflate.BufferType",{ADAPTIVE:_,BLOCK:v}),a("Zlib.Deflate",Y),a("Zlib.Deflate.compress",function(t,e){return new Y(t,e).j()}),a("Zlib.Deflate.prototype.compress",Y.prototype.j),Z("Zlib.Deflate.CompressionType",{NONE:q.NONE,FIXED:q.r,DYNAMIC:q.k})}.call(window);