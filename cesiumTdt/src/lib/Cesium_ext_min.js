!function(t){t&&(t.GeoOption={GeoCamera:!0,GeoCameraEventAggregator:!0,GeoScreenSpaceCameraController:!0},t.GEO_VERSION_NUMBER="$ Cesium Version: 1.40 build-20190301 $")}(window.Cesium),function(t){"use strict";var e=t.DrawCircleWidget=function(e,i){this.viewer=e.viewer,this.color=e.color?e.color:t.Color.RED.withAlpha(.3),this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.ellipsoid=this.scene.globe.ellipsoid,this.mode=e.mode?e.mode:1,this.appearance=new t.PerInstanceColorAppearance,this.callback=i||null};function i(t,e){for(var i=0;i<e.length;i++)e.get(i).name==t&&(e.remove(e.get(i)),i--)}e.prototype.activate=function(){if(!this.handler){this.handler=new t.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var e,i,r=this,o=[];this._array_=o,this._circles_=e=[],this._labels_=i,this.handler.setInputAction(function(i){r.lastP=i;var n=r.scene.pickPosition(i.position);if(!n){var a=r.camera.getPickRay(i.position);n=r.scene.globe.pick(a,r.scene)}if(n){if(t.Cartographic.fromCartesian(n).height<0){a=r.camera.getPickRay(i.position);n=r.scene.globe.pick(a,r.scene)}if(o[0]=n,o.length>0){var s=new t.CircleGeometry({center:n,radius:0,height:0});s.name="draw_circle";var l=new t.GroundPrimitive({geometryInstances:new t.GeometryInstance({geometry:s,attributes:{color:t.ColorGeometryInstanceAttribute.fromColor(r.color)}}),appearance:r.appearance,classificationType:t.ClassificationType.BOTH,interleave:!0});l.name="draw_circle",e.push({geometry:{center:n,radius:0,height:0},primitive:l}),r.primitives.add(l)}}},t.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(n){var a=r.scene.pickPosition(n.endPosition);if(!a){var s=r.camera.getPickRay(n.endPosition);a=r.scene.globe.pick(s,r.scene)}if(!a)return i&&(r.primitives.remove(i),i=null),void(r._labels_=i);if((c=t.Cartographic.fromCartesian(a).height)<0){s=r.camera.getPickRay(n.endPosition);a=r.scene.globe.pick(s,r.scene)}var l=t.Cartographic.fromCartesian(a),g=t.Math.toDegrees(l.longitude),h=t.Math.toDegrees(l.latitude),c=l.height;if(o.length>0){e[0];r.primitives.remove(e[0].primitive),e[0].geometry.radius=t.Cartesian3.distance(e[0].geometry.center,a),e[0].geometry.radius>3189100&&(e[0].geometry.radius=3189100),e[0].primitive=new t.GroundPrimitive({geometryInstances:new t.GeometryInstance({geometry:new t.CircleGeometry({center:e[0].geometry.center.clone(),radius:e[0].geometry.radius,height:e[0].geometry.height}),attributes:{color:t.ColorGeometryInstanceAttribute.fromColor(r.color)}}),appearance:r.appearance,classificationType:t.ClassificationType.BOTH,interleave:!0}),e[0].primitive.name="draw_circle",r.primitives.add(e[0].primitive)}i?i.get(i.length-1).position=t.Cartesian3.fromDegrees(g,h,c):((i=r.primitives.add(new t.LabelCollection)).name="draw_label",i.add({text:"左键单击开始绘制，右键单击结束绘制",font:"15px Microsoft YaHei",showBackground:!0,disableDepthTestDistance:Number.POSITIVE_INFINITY}),i.get(i.length-1).position=t.Cartesian3.fromDegrees(g,h,c)),r._labels_=i},t.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(t){r.drawEnd(t)},t.ScreenSpaceEventType.RIGHT_CLICK)}},e.prototype.drawEnd=function(e){var i=this._array_,r=this._circles_,o=this._labels_;e||(e=this.lastP),this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",o&&(this.primitives.remove(o),o=null);var n=this.scene.pickPosition(e.position);if(!n){var a=this.camera.getPickRay(e.position);n=this.scene.globe.pick(a,this.scene)}if(n){if(t.Cartographic.fromCartesian(n).height<0){a=this.camera.getPickRay(e.position);n=this.scene.globe.pick(a,this.scene)}var s=t.Cartographic.fromCartesian(n);t.Math.toDegrees(s.longitude),t.Math.toDegrees(s.latitude),s.height,this.mode;if(i.length>0&&(this.primitives.remove(r[0].primitive),r[0].geometry.radius=t.Cartesian3.distance(r[0].geometry.center,n),r[0].geometry.radius>3189100&&(r[0].geometry.radius=3189100),r[0].primitive=new t.GroundPrimitive({geometryInstances:new t.GeometryInstance({geometry:new t.CircleGeometry({center:r[0].geometry.center.clone(),radius:r[0].geometry.radius,height:r[0].geometry.height}),attributes:{color:t.ColorGeometryInstanceAttribute.fromColor(this.color)}}),appearance:this.appearance,classificationType:t.ClassificationType.BOTH,interleave:!0}),r[0].primitive.name="draw_circle",this.primitives.add(r[0].primitive),this.callback)){var l=t.CircleGeometry.createGeometry(new t.CircleGeometry({center:r[0].geometry.center.clone(),radius:r[0].geometry.radius,height:r[0].geometry.height})),g=new t.Entity({polygon:{hierarchy:{positions:function(){for(var e=[],i=l.attributes.position.values,r=0;r<i.length;r+=3)e.push(new t.Cartesian3(i[r],i[r+1],i[r+2]));return e}()}}});this.callback(g)}i=[],r=[]}},e.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",i("draw_label",this.primitives),i("draw_circle",this.primitives),function(t,e){for(var i=e.values,r=0;r<i.length;r++)i[r].name==t&&(e.remove(i[r]),r--)}("draw_circle",this.viewer.entities)}}(window.Cesium),function(t){"use strict";var e=t.DrawHeightWidget=function(e,i){this.viewer=e.viewer,this.color=e.color?e.color:t.Color.CHARTREUSE.withAlpha(.5),this.lineWidth=e.lineWidth?e.lineWidth:2,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.ellipsoid=this.scene.globe.ellipsoid,this.callback=i||null};function i(t,e){for(var i=0;i<e.length;i++)e.get(i).name==t&&(e.remove(e.get(i)),i--)}e.prototype.activate=function(){if(!this.handler){this.handler=new t.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var e,i,r=this,o=[];this.handler.setInputAction(function(i){if(!(o.length>0)){var n=r.camera.getPickRay(i.position),a=r.scene.globe.pick(n,r.scene);if(a){var s=t.Cartographic.fromCartesian(a),l=t.Math.toDegrees(s.longitude),g=t.Math.toDegrees(s.latitude),h=s.height;0==o.length&&(o.push(l),o.push(g),o.push(h),o.push(l),o.push(g),o.push(h),o.push(l),o.push(g),o.push(h),(e=r.primitives.add(new t.PolylineCollection)).name="draw_polyline",e.add({polyline:{}}),e.get(e.length-1).width=r.lineWidth,e.get(e.length-1).loop=!0,e.get(e.length-1).material.uniforms.color=r.color,e.get(e.length-1).positions=t.Cartesian3.fromDegreesArrayHeights(o))}}},t.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(n){var a=r.camera.getPickRay(n.endPosition),s=r.scene.globe.pick(a,r.scene);if(s){var l=t.Cartographic.fromCartesian(s),g=t.Math.toDegrees(l.longitude),h=t.Math.toDegrees(l.latitude),c=l.height;9==o.length&&(o[3]=g,o[4]=h,o[5]=c,o[2]>=o[5]?(o[6]=o[0],o[7]=o[1],o[8]=o[5]):(o[6]=o[3],o[7]=o[4],o[8]=o[2]),e.get(e.length-1).positions=t.Cartesian3.fromDegreesArrayHeights(o)),i?i.get(i.length-1).position=t.Cartesian3.fromDegrees(g,h,c):((i=r.primitives.add(new t.LabelCollection)).name="draw_label",i.add({text:"左键单击开始绘制，右键单击结束绘制",font:"16px sans-serif",showBackground:!0,disableDepthTestDistance:Number.POSITIVE_INFINITY}),i.get(i.length-1).position=t.Cartesian3.fromDegrees(g,h,c))}else i&&(r.primitives.remove(i),i=null)},t.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(e){if(r.handler=r.handler&&r.handler.destroy(),r.viewer.canvas.style.cursor="default",i&&(r.primitives.remove(i),i=null),r.callback){var n=new t.Entity({polyline:{positions:t.Cartesian3.fromDegreesArrayHeights(o)}});r.callback(n)}},t.ScreenSpaceEventType.RIGHT_CLICK)}},e.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",i("draw_label",this.primitives),i("draw_polyline",this.primitives)}}(window.Cesium),function(t){"use strict";var e=t.DrawPointWidget=function(e,i){this.viewer=e.viewer,this.color=e.color?e.color:t.Color.RED,this.pixelSize=e.pixelSize?e.pixelSize:10,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.ellipsoid=this.scene.globe.ellipsoid,this.callback=i||null};function i(t,e){for(var i=0;i<e.length;i++)e.get(i).name==t&&(e.remove(e.get(i)),i--)}e.prototype.activate=function(){if(!this.handler){this.handler=new t.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var e,i,r=this,o=[];this.handler.setInputAction(function(n){var a=r.scene.pickPosition(n.position);if(!a){var s=r.camera.getPickRay(n.position);a=r.scene.globe.pick(s,r.scene)}if(a){if(t.Cartographic.fromCartesian(a).height<0){s=r.camera.getPickRay(n.position);a=r.scene.globe.pick(s,r.scene)}if(o[0]=a,e?e.removeAll():(e=r.primitives.add(new t.PointPrimitiveCollection)).name="draw_point",e.add({position:a,color:r.color,pixelSize:r.pixelSize,disableDepthTestDistance:30}),r.handler=r.handler&&r.handler.destroy(),r.viewer.canvas.style.cursor="default",i&&(r.primitives.remove(i),i=null),r.callback){var l=new t.Entity({position:o[0],point:{}});r.callback(l)}}},t.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(e){var o=r.scene.pickPosition(e.endPosition);if(!o){var n=r.camera.getPickRay(e.endPosition);o=r.scene.globe.pick(n,r.scene)}if(o){if(t.Cartographic.fromCartesian(o).height<0){n=r.camera.getPickRay(e.endPosition);o=r.scene.globe.pick(n,r.scene)}i?i.get(i.length-1).position=o:((i=r.primitives.add(new t.LabelCollection)).name="draw_label",i.add({text:"左键单击进行绘制",font:"15px Microsoft YaHei",showBackground:!0,disableDepthTestDistance:Number.POSITIVE_INFINITY}),i.get(i.length-1).position=o)}else i&&(r.primitives.remove(i),i=null)},t.ScreenSpaceEventType.MOUSE_MOVE)}},e.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",i("draw_label",this.primitives),i("draw_point",this.primitives)}}(window.Cesium),function(t){"use strict";var e=t.DrawPolygonWidget=function(e,i){this.viewer=e.viewer,this.color=e.color?e.color:t.Color.CHARTREUSE.withAlpha(.5),this.lineWidth=e.lineWidth?e.lineWidth:2,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.ellipsoid=this.scene.globe.ellipsoid,this.callback=i||null,this.count=0};function i(t,e){for(var i=0;i<e.length;i++)e.get(i).name==t&&(e.remove(e.get(i)),i--)}e.prototype.activate=function(){if(!this.handler){this.handler=new t.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var e,i,r=this,o=[],n=[],a=[];this._array_=n,this._array2_=a,this._polylines_=e,this._labels_=i,this.handler.setInputAction(function(i){r.lastP=i;var s=r.scene.pickPosition(i.position);if(!s){var l=r.camera.getPickRay(i.position);s=r.scene.globe.pick(l,r.scene)}if(s){if((C=t.Cartographic.fromCartesian(s).height)<0){l=r.camera.getPickRay(i.position);s=r.scene.globe.pick(l,r.scene)}var g=t.Cartographic.fromCartesian(s);n.push(s);var h=t.Math.toDegrees(g.longitude),c=t.Math.toDegrees(g.latitude),C=g.height;a.push([h,c]),o.push(h),o.push(c),o.push(C),3==o.length&&((e=r.primitives.add(new t.PolylineCollection)).name="draw_polyline",e.add({polyline:{}}),e.get(e.length-1).width=r.lineWidth,e.get(e.length-1).loop=!0,e.get(e.length-1).material.uniforms.color=r.color,e.get(e.length-1).positions=t.Cartesian3.fromDegreesArrayHeights(o)),o.length>3&&(e.get(e.length-1).positions=t.Cartesian3.fromDegreesArrayHeights(o)),r._polylines_=e}},t.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(n){var a=r.scene.pickPosition(n.endPosition);if(!a){var s=r.camera.getPickRay(n.endPosition);a=r.scene.globe.pick(s,r.scene)}if(a){if((c=t.Cartographic.fromCartesian(a).height)<0){s=r.camera.getPickRay(n.endPosition);a=r.scene.globe.pick(s,r.scene)}var l=t.Cartographic.fromCartesian(a),g=t.Math.toDegrees(l.longitude),h=t.Math.toDegrees(l.latitude),c=l.height;if(o.length>=3){var C=o.concat();C.push(g),C.push(h),C.push(c),e.get(e.length-1).positions=t.Cartesian3.fromDegreesArrayHeights(C)}i?i.get(i.length-1).position=t.Cartesian3.fromDegrees(g,h,c):((i=r.primitives.add(new t.LabelCollection)).name="draw_label",i.add({text:"左键单击开始绘制，右键单击结束绘制",font:"15px Microsoft YaHei",showBackground:!0,disableDepthTestDistance:Number.POSITIVE_INFINITY}),i.get(i.length-1).position=t.Cartesian3.fromDegrees(g,h,c)),r._labels_=i}},t.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(t){r.drawEnd(t)},t.ScreenSpaceEventType.RIGHT_CLICK),this.count++}},e.prototype.drawEnd=function(e){if(0!=this._array_.length){var i=this._array_,r=this._array2_,o=this._polylines_,n=this._labels_;e||(console.log("点击按钮结束绘制"),e=this.lastP),this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",n&&(this.primitives.remove(n),n=null);var a=this.scene.pickPosition(e.position);if(!a){var s=this.camera.getPickRay(e.position);a=this.scene.globe.pick(s,this.scene)}if(a){if(t.Cartographic.fromCartesian(a).height<0){s=this.camera.getPickRay(e.position);a=this.scene.globe.pick(s,this.scene)}i.push(a);var l=t.Cartographic.fromCartesian(a),g=t.Math.toDegrees(l.longitude),h=t.Math.toDegrees(l.latitude);r.push([g,h]),o.get(o.length-1).material.uniforms.color=t.Color.DODGERBLUE.withAlpha(0);var c=new t.GroundPrimitive({geometryInstances:[],appearance:new t.PerInstanceColorAppearance,show:!0,classificationType:t.ClassificationType.BOTH}),C=new t.GeometryInstance({geometry:t.PolygonGeometry.fromPositions({positions:i,vertexFormat:t.EllipsoidSurfaceAppearance.VERTEX_FORMAT}),attributes:{color:t.ColorGeometryInstanceAttribute.fromColor(t.Color.GREEN.withAlpha(.3))}});if(c.geometryInstances.push(C),this.primitives.add(c).name="draw_polygon",this.callback){var d=new t.Entity({polygon:{hierarchy:{positions:i}}});this.callback(d)}this._array_=[],this._polylines_=null}}},e.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",i("draw_label",this.primitives),i("draw_polyline",this.primitives),i("draw_polygon",this.primitives)}}(window.Cesium),function(t){"use strict";var e=t.DrawPolylineWidget=function(e,i){this.viewer=e.viewer,this.lineColor=t.defaultValue(e.lineColor,t.Color.CHARTREUSE.withAlpha(.5)),this.lineWidth=t.defaultValue(e.lineWidth,1),this.lineLoop=t.defaultValue(e.lineLoop,!0),this.lineClampGround=t.defaultValue(e.lineClampGround,!0),this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.primitives=this.scene.primitives,this.callback=i||null};function i(t,e){for(var i=0;i<e.length;i++)e.get(i).name==t&&(e.remove(e.get(i)),i--)}function r(e){return[t.Math.toDegrees(t.Cartographic.fromCartesian(e).longitude),t.Math.toDegrees(t.Cartographic.fromCartesian(e).latitude),t.Cartographic.fromCartesian(e).height]}e.prototype.screenToCartesian=function(e){if(this.lineClampGround){if(!(r=this.scene.pickPosition(e))){var i=this.camera.getPickRay(e);r=this.scene.globe.pick(i,this.scene)}if(!r)return;if(t.Cartographic.fromCartesian(r).height<0){i=this.camera.getPickRay(e);r=this.scene.globe.pick(i,this.scene)}}else{i=this.camera.getPickRay(e);var r=this.scene.globe.pick(i,this.scene)}return r},e.prototype.createGroundPrimitive=function(e){if(this.lineWidth&&this.lineColor&&this.primitives){var i=new t.GroundPrimitive({geometryInstances:new t.GeometryInstance({geometry:new t.CorridorGeometry({vertexFormat:t.VertexFormat.POSITION_ONLY,positions:e,width:this.lineWidth}),attributes:{color:t.ColorGeometryInstanceAttribute.fromColor(this.lineColor)}}),classificationType:t.ClassificationType.BOTH});return this.primitives.add(i)}return!1},e.prototype.createPrimitive=function(e){if(this.lineWidth&&this.lineColor&&this.primitives){var i=this.primitives.add(new t.PolylineCollection);return i.add({polyline:{}}),i.get(i.length-1).width=this.lineWidth,i.get(i.length-1).material.uniforms.color=this.lineColor,i.get(i.length-1).positions=e,i}return!1},e.prototype.activate=function(){if(!this.handler){this.handler=new t.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var e=[];this.degreesArrayHeights=[],this._labels=null;var i=this;this.handler.setInputAction(function(t){var o=i.screenToCartesian(t.position);e.push(o),i.degreesArrayHeights=i.degreesArrayHeights.concat(r(o));var n=e.length,a=[],s=[];1==n?a=[e[n-1]]:i.lineLoop?(a=[e[n-2],e[n-1]],s=[e[0],e[n-1]]):(a=[e[n-2],e[n-1]],s=[]),i.lineClampGround?(i.primitives.remove(i.temporaryGroundPrimitive),i.primitives.remove(i.concatGroundPrimitive),i.fixedGroundPrimitive=i.createGroundPrimitive(a),i.fixedGroundPrimitive.name="draw_polyline",i.concatGroundPrimitive=i.createGroundPrimitive(s),i.concatGroundPrimitive.name="draw_polylineConcat"):(i.primitives.remove(i.concatPrimitive),i.primitives.remove(i.temporaryPrimitive),i.fixedPrimitive=i.createPrimitive(a),i.fixedPrimitive.name="draw_polyline",i.concatPrimitive=i.createPrimitive(s),i.concatPrimitive.name="draw_polylineConcat")},t.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(r){var o=i.screenToCartesian(r.endPosition);if(o){var n=e.length;if(n)if(i.lineClampGround){i.primitives.remove(i.temporaryGroundPrimitive),i.primitives.remove(i.concatGroundPrimitive);var a=i.lineLoop&&n>=2?[e[n-1],o.clone(),e[0]]:[e[n-1],o.clone()];i.temporaryGroundPrimitive=i.createGroundPrimitive(a),i.temporaryGroundPrimitive.name="draw_polylineTemple"}else{i.primitives.remove(i.temporaryPrimitive),i.primitives.remove(i.concatPrimitive);var s=i.lineLoop&&n>=2?[e[n-1],o.clone(),e[0]]:[e[n-1],o.clone()];i.temporaryPrimitive=i.createPrimitive(s),i.temporaryPrimitive.name="draw_polylineTemple"}i._labels?i._labels.get(i._labels.length-1).position=o:(i._labels=i.primitives.add(new t.LabelCollection),i._labels.name="draw_label",i._labels.add({text:"左键单击开始绘制，右键单击结束绘制",font:"15px Microsoft YaHei",showBackground:!0,disableDepthTestDistance:Number.POSITIVE_INFINITY}),i._labels.get(i._labels.length-1).position=o)}else i._labels&&(i.primitives.remove(i._labels),i._labels=null)},t.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(t){i.drawEnd(e,t)},t.ScreenSpaceEventType.RIGHT_CLICK)}},e.prototype.drawEnd=function(e,i){var o=this._labels;this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",o&&(this.primitives.remove(o),o=null);var n=this.screenToCartesian(i.position);e.push(n),this.degreesArrayHeights=this.degreesArrayHeights.concat(r(n));var a=e.length;if(this.lineClampGround){this.primitives.remove(this.temporaryGroundPrimitive),this.primitives.remove(this.concatGroundPrimitive);var s=this.lineLoop&&a>2?[e[a-2],e[a-1],e[0]]:[e[a-2],e[a-1]];this.finalGroundPrimitive=this.createGroundPrimitive(s),this.finalGroundPrimitive.name="draw_polyline"}else{this.primitives.remove(this.temporaryPrimitive),this.primitives.remove(this.concatPrimitive);var l=this.lineLoop&&a>2?[e[a-2],e[a-1],e[0]]:[e[a-2],e[a-1]];this.finalPrimitive=this.createPrimitive(l),this.finalPrimitive.name="draw_polyline"}if(this.callback){var g=new t.Entity({polyline:{positions:t.Cartesian3.fromDegreesArrayHeights(this.degreesArrayHeights)}});this.callback(g)}},e.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",i("draw_label",this.primitives),i("draw_polyline",this.primitives)}}(window.Cesium);var xp={version:"1.0.0",createTime:"2018.6.19",author:"xupinhui"},doubleArrowDefualParam={type:"doublearrow",headHeightFactor:.25,headWidthFactor:.3,neckHeightFactor:.85,fixPointCount:4,neckWidthFactor:.15},tailedAttackArrowDefualParam={headHeightFactor:.18,headWidthFactor:.3,neckHeightFactor:.85,neckWidthFactor:.15,tailWidthFactor:.1,headTailFactor:.8,swallowTailFactor:1};xp.algorithm={},xp.algorithm.doubleArrow=function(t){this.connPoint=null,this.tempPoint4=null,this.points=t;var e={controlPoint:null,polygonalPoint:null};if(!(2>(s=t.length))){if(2==s)return t;var i,r,o=this.points[0],n=this.points[1],a=this.points[2],s=t.length;this.tempPoint4=3==s?xp.algorithm.getTempPoint4(o,n,a):this.points[3],this.connPoint=3==s||4==s?P.PlotUtils.mid(o,n):this.points[4],P.PlotUtils.isClockWise(o,n,a)?(i=xp.algorithm.getArrowPoints(o,this.connPoint,this.tempPoint4,!1),r=xp.algorithm.getArrowPoints(this.connPoint,n,a,!0)):(i=xp.algorithm.getArrowPoints(n,this.connPoint,a,!1),r=xp.algorithm.getArrowPoints(this.connPoint,o,this.tempPoint4,!0));var l=i.length,g=(l-5)/2,h=i.slice(0,g),c=i.slice(g,g+5),C=i.slice(g+5,l),d=r.slice(0,g),u=r.slice(g,g+5),p=r.slice(g+5,l);d=P.PlotUtils.getBezierPoints(d);var A=P.PlotUtils.getBezierPoints(p.concat(h.slice(1)));C=P.PlotUtils.getBezierPoints(C);var I=d.concat(u,A,c,C),m=xp.algorithm.array2Dto1D(I);e.controlPoint=[o,n,a,this.tempPoint4,this.connPoint],e.polygonalPoint=Cesium.Cartesian3.fromDegreesArray(m)}return e},xp.algorithm.getTempPoint4=function(t,e,i,r){this.type=doubleArrowDefualParam.type,this.headHeightFactor=doubleArrowDefualParam.headHeightFactor,this.headWidthFactor=doubleArrowDefualParam.headWidthFactor,this.neckHeightFactor=doubleArrowDefualParam.neckHeightFactor,this.neckWidthFactor=doubleArrowDefualParam.neckWidthFactor;var o=P.PlotUtils.mid(t,e),n=P.PlotUtils.distance(o,i),a=P.PlotUtils.getThirdPoint(i,o,0,.3*n,!0),s=P.PlotUtils.getThirdPoint(i,o,0,.5*n,!0),l=[o,a=P.PlotUtils.getThirdPoint(o,a,P.Constants.HALF_PI,n/5,r),s=P.PlotUtils.getThirdPoint(o,s,P.Constants.HALF_PI,n/4,r),i],g=xp.algorithm.getArrowHeadPoints(l,this.headHeightFactor,this.headWidthFactor,this.neckHeightFactor,this.neckWidthFactor),h=g[0],c=g[4],C=P.PlotUtils.distance(t,e)/P.PlotUtils.getBaseLength(l)/2,d=xp.algorithm.getArrowBodyPoints(l,h,c,C),u=d.length,p=d.slice(0,u/2),A=d.slice(u/2,u);return p.push(h),A.push(c),(p=p.reverse()).push(e),(A=A.reverse()).push(t),p.reverse().concat(g,A)},xp.algorithm.array2Dto1D=function(t){var e=[];return t.forEach(function(t){e.push(t[0]),e.push(t[1])}),e},xp.algorithm.getArrowPoints=function(t,e,i,r){this.type=doubleArrowDefualParam.type,this.headHeightFactor=doubleArrowDefualParam.headHeightFactor,this.headWidthFactor=doubleArrowDefualParam.headWidthFactor,this.neckHeightFactor=doubleArrowDefualParam.neckHeightFactor,this.neckWidthFactor=doubleArrowDefualParam.neckWidthFactor;var o=P.PlotUtils.mid(t,e),n=P.PlotUtils.distance(o,i),a=P.PlotUtils.getThirdPoint(i,o,0,.3*n,!0),s=P.PlotUtils.getThirdPoint(i,o,0,.5*n,!0),l=[o,a=P.PlotUtils.getThirdPoint(o,a,P.Constants.HALF_PI,n/5,r),s=P.PlotUtils.getThirdPoint(o,s,P.Constants.HALF_PI,n/4,r),i],g=xp.algorithm.getArrowHeadPoints(l,this.headHeightFactor,this.headWidthFactor,this.neckHeightFactor,this.neckWidthFactor),h=g[0],c=g[4],C=P.PlotUtils.distance(t,e)/P.PlotUtils.getBaseLength(l)/2,d=xp.algorithm.getArrowBodyPoints(l,h,c,C),u=d.length,p=d.slice(0,u/2),A=d.slice(u/2,u);return p.push(h),A.push(c),(p=p.reverse()).push(e),(A=A.reverse()).push(t),p.reverse().concat(g,A)},xp.algorithm.getArrowHeadPoints=function(t,e,i){this.type=doubleArrowDefualParam.type,this.headHeightFactor=doubleArrowDefualParam.headHeightFactor,this.headWidthFactor=doubleArrowDefualParam.headWidthFactor,this.neckHeightFactor=doubleArrowDefualParam.neckHeightFactor,this.neckWidthFactor=doubleArrowDefualParam.neckWidthFactor;var r=P.PlotUtils.getBaseLength(t)*this.headHeightFactor,o=t[t.length-1],n=(P.PlotUtils.distance(e,i),r*this.headWidthFactor),a=r*this.neckWidthFactor,s=r*this.neckHeightFactor,l=P.PlotUtils.getThirdPoint(t[t.length-2],o,0,r,!0),g=P.PlotUtils.getThirdPoint(t[t.length-2],o,0,s,!0),h=P.PlotUtils.getThirdPoint(o,l,P.Constants.HALF_PI,n,!1),c=P.PlotUtils.getThirdPoint(o,l,P.Constants.HALF_PI,n,!0);return[P.PlotUtils.getThirdPoint(o,g,P.Constants.HALF_PI,a,!1),h,o,c,P.PlotUtils.getThirdPoint(o,g,P.Constants.HALF_PI,a,!0)]},xp.algorithm.getArrowBodyPoints=function(t,e,i,r){for(var o=P.PlotUtils.wholeDistance(t),n=P.PlotUtils.getBaseLength(t)*r,a=(n-P.PlotUtils.distance(e,i))/2,s=0,l=[],g=[],h=1;h<t.length-1;h++){var c=P.PlotUtils.getAngleOfThreePoints(t[h-1],t[h],t[h+1])/2,C=(n/2-(s+=P.PlotUtils.distance(t[h-1],t[h]))/o*a)/Math.sin(c),d=P.PlotUtils.getThirdPoint(t[h-1],t[h],Math.PI-c,C,!0),u=P.PlotUtils.getThirdPoint(t[h-1],t[h],c,C,!1);l.push(d),g.push(u)}return l.concat(g)},xp.algorithm.getTempPoint4=function(t,e,i){var r,o,n,a,s=P.PlotUtils.mid(t,e),l=P.PlotUtils.distance(s,i),g=P.PlotUtils.getAngleOfThreePoints(t,s,i);return g<P.Constants.HALF_PI?(o=l*Math.sin(g),n=l*Math.cos(g),a=P.PlotUtils.getThirdPoint(t,s,P.Constants.HALF_PI,o,!1),r=P.PlotUtils.getThirdPoint(s,a,P.Constants.HALF_PI,n,!0)):g>=P.Constants.HALF_PI&&g<Math.PI?(o=l*Math.sin(Math.PI-g),n=l*Math.cos(Math.PI-g),a=P.PlotUtils.getThirdPoint(t,s,P.Constants.HALF_PI,o,!1),r=P.PlotUtils.getThirdPoint(s,a,P.Constants.HALF_PI,n,!1)):g>=Math.PI&&g<1.5*Math.PI?(o=l*Math.sin(g-Math.PI),n=l*Math.cos(g-Math.PI),a=P.PlotUtils.getThirdPoint(t,s,P.Constants.HALF_PI,o,!0),r=P.PlotUtils.getThirdPoint(s,a,P.Constants.HALF_PI,n,!0)):(o=l*Math.sin(2*Math.PI-g),n=l*Math.cos(2*Math.PI-g),a=P.PlotUtils.getThirdPoint(t,s,P.Constants.HALF_PI,o,!0),r=P.PlotUtils.getThirdPoint(s,a,P.Constants.HALF_PI,n,!1)),r},xp.algorithm.tailedAttackArrow=function(t){t=xp.algorithm.dereplication(t),this.tailWidthFactor=tailedAttackArrowDefualParam.tailWidthFactor,this.swallowTailFactor=tailedAttackArrowDefualParam.swallowTailFactor,this.swallowTailPnt=tailedAttackArrowDefualParam.swallowTailPnt;var e={controlPoint:null,polygonalPoint:null};if(e.controlPoint=t,!(2>(u=t.length))){if(2==t.length)return e.polygonalPoint=t,e;var i=t,r=i[0],o=i[1];P.PlotUtils.isClockWise(i[0],i[1],i[2])&&(r=i[1],o=i[0]);var n=[P.PlotUtils.mid(r,o)].concat(i.slice(2)),a=xp.algorithm.getAttackArrowHeadPoints(n,r,o,tailedAttackArrowDefualParam),s=a[0],l=a[4],g=P.PlotUtils.distance(r,o),h=P.PlotUtils.getBaseLength(n),c=h*this.tailWidthFactor*this.swallowTailFactor;this.swallowTailPnt=P.PlotUtils.getThirdPoint(n[1],n[0],0,c,!0);var C=g/h,d=xp.algorithm.getAttackArrowBodyPoints(n,s,l,C),u=d.length,p=[r].concat(d.slice(0,u/2));p.push(s);var A,I=[o].concat(d.slice(u/2,u));I.push(l),p=P.PlotUtils.getQBSplinePoints(p),I=P.PlotUtils.getQBSplinePoints(I),A=xp.algorithm.array2Dto1D(p.concat(a,I.reverse(),[this.swallowTailPnt,p[0]])),e.polygonalPoint=Cesium.Cartesian3.fromDegreesArray(A)}return e},xp.algorithm.getAttackArrowHeadPoints=function(t,e,i,r){this.headHeightFactor=r.headHeightFactor,this.headTailFactor=r.headTailFactor,this.headWidthFactor=r.headWidthFactor,this.neckWidthFactor=r.neckWidthFactor,this.neckHeightFactor=r.neckHeightFactor;var o=P.PlotUtils.getBaseLength(t),n=o*this.headHeightFactor,a=t[t.length-1];o=P.PlotUtils.distance(a,t[t.length-2]);var s=P.PlotUtils.distance(e,i);n>s*this.headTailFactor&&(n=s*this.headTailFactor);var l=n*this.headWidthFactor,g=n*this.neckWidthFactor,h=(n=n>o?o:n)*this.neckHeightFactor,c=P.PlotUtils.getThirdPoint(t[t.length-2],a,0,n,!0),C=P.PlotUtils.getThirdPoint(t[t.length-2],a,0,h,!0),d=P.PlotUtils.getThirdPoint(a,c,P.Constants.HALF_PI,l,!1),u=P.PlotUtils.getThirdPoint(a,c,P.Constants.HALF_PI,l,!0);return[P.PlotUtils.getThirdPoint(a,C,P.Constants.HALF_PI,g,!1),d,a,u,P.PlotUtils.getThirdPoint(a,C,P.Constants.HALF_PI,g,!0)]},xp.algorithm.getAttackArrowBodyPoints=function(t,e,i,r){for(var o=P.PlotUtils.wholeDistance(t),n=P.PlotUtils.getBaseLength(t)*r,a=(n-P.PlotUtils.distance(e,i))/2,s=0,l=[],g=[],h=1;h<t.length-1;h++){var c=P.PlotUtils.getAngleOfThreePoints(t[h-1],t[h],t[h+1])/2,C=(n/2-(s+=P.PlotUtils.distance(t[h-1],t[h]))/o*a)/Math.sin(c),d=P.PlotUtils.getThirdPoint(t[h-1],t[h],Math.PI-c,C,!0),u=P.PlotUtils.getThirdPoint(t[h-1],t[h],c,C,!1);l.push(d),g.push(u)}return l.concat(g)},xp.algorithm.dereplication=function(t){var e=t[t.length-1],i=!1,r=[];return r=t.filter(function(t){if(t[0]!=e[0]&&t[1]!=e[1])return t;i=!0}),i&&r.push(e),r},function(t){var e=t.DrawHelper=function(){var i=t.Ellipsoid.WGS84,r={billBoard:[],primitives:[]};function o(t){var e,i;this._scene=t.scene,this._tooltip=(e=t.container,(i=function(t){var e=document.createElement("DIV");e.className="twipsy right";var i=document.createElement("DIV");i.className="twipsy-arrow",e.appendChild(i);var r=document.createElement("DIV");r.className="twipsy-inner",e.appendChild(r),this._div=e,this._title=r,t.appendChild(e)}).prototype.setVisible=function(t){this._div.style.display=t?"block":"none"},i.prototype.showAt=function(t,e){t&&e&&(this.setVisible(!0),this._title.innerHTML=e,this._div.style.left=t.x+10+"px",this._div.style.top=t.y-this._div.clientHeight/2+"px")},new i(e)),this._surfaces=[],this.initialiseHandlers(),this.enhancePrimitives()}o.prototype.initialiseHandlers=function(){var e,i=this._scene,r=this,o=new t.ScreenSpaceEventHandler(i.canvas);function n(t,e){if(1!=r._handlersMuted){var o=i.pick(e);o&&o.primitive&&o.primitive[t]&&o.primitive[t](e)}}o.setInputAction(function(t){n("leftClick",t.position)},t.ScreenSpaceEventType.LEFT_CLICK),o.setInputAction(function(t){n("leftDoubleClick",t.position)},t.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),o.setInputAction(function(t){if(1!=r._handlersMuted){var o=i.pick(t.endPosition);!e||o&&e==o.primitive||((!e.isDestroyed||!e.isDestroyed())&&e.mouseOut(t.endPosition),e=null),o&&o.primitive&&((o=o.primitive).mouseOut&&(e=o),o.mouseMove&&o.mouseMove(t.endPosition))}},t.ScreenSpaceEventType.MOUSE_MOVE),o.setInputAction(function(t){n("leftUp",t.position)},t.ScreenSpaceEventType.LEFT_UP),o.setInputAction(function(t){n("leftDown",t.position)},t.ScreenSpaceEventType.LEFT_DOWN)},o.prototype.setListener=function(t,e,i){t[e]=i},o.prototype.muteHandlers=function(t){this._handlersMuted=t},o.prototype.registerEditableShape=function(t){var e=this;w(t,"mouseMove",function(i){t.setHighlighted(!0),t._editMode||e._tooltip.showAt(i,"点击以编辑图形")}),w(t,"mouseOut",function(i){t.setHighlighted(!1),e._tooltip.setVisible(!1)}),w(t,"leftClick",function(e){t.setEditMode(!0),r.primitives.push(t)}),w(t,"leftDoubleClick",function(e){r.primitives.push(t)})},o.prototype.startDrawing=function(t){this.disableAllEditMode(),this.editCleanUp&&this.editCleanUp(),this.editCleanUp=t,this.muteHandlers(!0)},o.prototype.stopDrawing=function(){this.editCleanUp&&(this.editCleanUp(),this.editCleanUp=null),this.muteHandlers(!1)},o.prototype.disableAllHighlights=function(){this.setHighlighted(void 0)},o.prototype.setHighlighted=function(t){this._highlightedSurface&&!this._highlightedSurface.isDestroyed()&&this._highlightedSurface!=t&&this._highlightedSurface.setHighlighted(!1),this._highlightedSurface=t},o.prototype.disableAllEditMode=function(){this.setEdited(void 0)},o.prototype.setEdited=function(t){this._editedSurface&&!this._editedSurface.isDestroyed()&&this._editedSurface.setEditMode(!1),this._editedSurface=t};var n=t.Material.fromType(t.Material.ColorType);n.uniforms.color=new t.Color(1,1,0,.5);var a={ellipsoid:t.Ellipsoid.WGS84,textureRotationAngle:0,height:0,asynchronous:!0,show:!0,debugShowBoundingVolume:!1},s=_(a,{appearance:new t.EllipsoidSurfaceAppearance({aboveGround:!1}),material:n,granularity:Math.PI/180}),l=_(a,{}),g=_(a,{}),h=_(a,{}),c=(_(s,{rotation:0}),_(a,{width:5,geodesic:!0,granularity:1e4,appearance:new t.PolylineMaterialAppearance({aboveGround:!1}),material:n})),C=function(){function e(){}return e.prototype.initialiseOptions=function(t){y(this,t),this._ellipsoid=void 0,this._granularity=void 0,this._height=void 0,this._textureRotationAngle=void 0,this._id=void 0,this._createPrimitive=!0,this._primitive=void 0,this._outlinePolygon=void 0},e.prototype.setAttribute=function(t,e){this[t]=e,this._createPrimitive=!0},e.prototype.getAttribute=function(t){return this[t]},e.prototype.update=function(e,i,r){if(!t.defined(this.ellipsoid))throw new t.DeveloperError("this.ellipsoid must be defined.");if(!t.defined(this.appearance))throw new t.DeveloperError("this.material must be defined.");if(this.granularity<0)throw new t.DeveloperError("this.granularity and scene2D/scene3D overrides must be greater than zero.");if(this.show&&(this._createPrimitive||t.defined(this._primitive))){if(this._createPrimitive||this._ellipsoid!==this.ellipsoid||this._granularity!==this.granularity||this._height!==this.height||this._textureRotationAngle!==this.textureRotationAngle||this._id!==this.id){var o=this.getGeometry();if(!o)return;this._createPrimitive=!1,this._ellipsoid=this.ellipsoid,this._granularity=this.granularity,this._height=this.height,this._textureRotationAngle=this.textureRotationAngle,this._id=this.id,this._primitive=this._primitive&&this._primitive.destroy(),this._primitive=new t.Primitive({geometryInstances:new t.GeometryInstance({geometry:o,id:this.id,pickPrimitive:this}),appearance:this.appearance,asynchronous:this.asynchronous}),this._outlinePolygon=this._outlinePolygon&&this._outlinePolygon.destroy(),this.strokeColor&&this.getOutlineGeometry&&(this._outlinePolygon=new t.Primitive({geometryInstances:new t.GeometryInstance({geometry:this.getOutlineGeometry(),attributes:{color:t.ColorGeometryInstanceAttribute.fromColor(this.strokeColor)}}),appearance:new t.PerInstanceColorAppearance({flat:!0,renderState:{depthTest:{enabled:!0},lineWidth:1}})}))}var n=this._primitive;n.appearance.material=this.material,n.debugShowBoundingVolume=this.debugShowBoundingVolume,n.update(e,i,r),this._outlinePolygon&&this._outlinePolygon.update(e,i,r)}},e.prototype.isDestroyed=function(){return!1},e.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),t.destroyObject(this)},e.prototype.setStrokeStyle=function(t,e){this.strokeColor&&this.strokeColor.equals(t)&&this.strokeWidth==e||(this._createPrimitive=!0,this.strokeColor=t,this.strokeWidth=e)},e}();o.ExtentPrimitive=function(){function e(e){if(!t.defined(e.extent))throw new t.DeveloperError("Extent is required");e=_(e,s),this.initialiseOptions(e),this.setExtent(e.extent)}return e.prototype=new C,e.prototype.setExtent=function(t){this.setAttribute("extent",t)},e.prototype.getExtent=function(){return this.getAttribute("extent")},e.prototype.getGeometry=function(){if(t.defined(this.extent))return t.PolygonGeometry.fromPositions({positions:this.extent,height:this.height,vertexFormat:t.EllipsoidSurfaceAppearance.VERTEX_FORMAT,stRotation:this.textureRotationAngle,ellipsoid:this.ellipsoid,granularity:this.granularity})},e.prototype.getOutlineGeometry=function(){return t.PolygonOutlineGeometry.fromPositions({positions:this.extent})},e}(),o.PolygonPrimitive=function(){function e(t){t=_(t,s),this.initialiseOptions(t),this.isPolygon=!0}return e.prototype=new C,e.prototype.setPositions=function(t){this.setAttribute("positions",t)},e.prototype.getPositions=function(){return this.getAttribute("positions")},e.prototype.setCustom=function(t){this.setAttribute("custom")},e.prototype.getCustom=function(t){return this.getAttribute("custom")},e.prototype.getGeometry=function(){if(t.defined(this.positions)&&!(this.positions.length<3))return t.PolygonGeometry.fromPositions({positions:this.positions,height:this.height,vertexFormat:t.EllipsoidSurfaceAppearance.VERTEX_FORMAT,stRotation:this.textureRotationAngle,ellipsoid:this.ellipsoid,granularity:this.granularity})},e.prototype.getOutlineGeometry=function(){return t.PolygonOutlineGeometry.fromPositions({positions:this.getPositions()})},e}(),o.TailedAttackPrimitive=function(){function e(t){t=_(t,s),this.initialiseOptions(t),this.isPolygon=!0}return e.prototype=new C,e.prototype.setPositions=function(t){this.setAttribute("positions",t)},e.prototype.getPositions=function(){return this.getAttribute("positions")},e.prototype.setCustom=function(t){this.setAttribute("custom")},e.prototype.getCustom=function(t){return this.getAttribute("custom")},e.prototype.getGeometry=function(){if(t.defined(this.positions)&&!(this.positions.length<3))return t.PolygonGeometry.fromPositions({positions:this.positions,height:this.height,vertexFormat:t.EllipsoidSurfaceAppearance.VERTEX_FORMAT,stRotation:this.textureRotationAngle,ellipsoid:this.ellipsoid,granularity:this.granularity})},e.prototype.getOutlineGeometry=function(){return t.PolygonOutlineGeometry.fromPositions({positions:this.getPositions()})},e}(),o.PolylinePrimitive=function(){function e(t){t=_(t,c),this.initialiseOptions(t)}return e.prototype=new C,e.prototype.setPositions=function(t){this.setAttribute("positions",t)},e.prototype.setWidth=function(t){this.setAttribute("width",t)},e.prototype.setGeodesic=function(t){this.setAttribute("geodesic",t)},e.prototype.getPositions=function(){return this.getAttribute("positions")},e.prototype.getWidth=function(){return this.getAttribute("width")},e.prototype.getGeodesic=function(t){return this.getAttribute("geodesic")},e.prototype.getGeometry=function(){if(t.defined(this.positions)&&!(this.positions.length<2))return new t.PolylineGeometry({positions:this.positions,height:this.height,width:this.width<1?1:this.width,vertexFormat:t.EllipsoidSurfaceAppearance.VERTEX_FORMAT,ellipsoid:this.ellipsoid})},e}();var d={iconUrl:"/geomap-api/JsCesuimDemo/resource/images/img_plot/dragIcon.png",shiftX:0,shiftY:0},u={iconUrl:"/geomap-api/JsCesuimDemo/resource/images/img_plot/dragIcon.png",shiftX:0,shiftY:0},p={iconUrl:"/geomap-api/JsCesuimDemo/resource/images/img_plot/dragIconLight.png",shiftX:0,shiftY:0};function A(t){return[t[7],t[3]]}function I(e){var i=t.Cartographic.fromCartesian(e);return[t.Math.toDegrees(i.longitude),t.Math.toDegrees(i.latitude)]}function m(e,i){if(!(e.length<2||i.length<2)){var r=Math.PI/8.5,o=Math.PI/13,n=[];n[0]=e,n[1]=i;var a=n[0],s=n[1],l=P.PlotUtils.getBaseLength(n),g=.15*l,h=.2*l,c=.25*l,C=P.PlotUtils.getThirdPoint(s,a,P.Constants.HALF_PI,g,!0),d=P.PlotUtils.getThirdPoint(s,a,P.Constants.HALF_PI,g,!1),u=P.PlotUtils.getThirdPoint(a,s,r,c,!1),p=P.PlotUtils.getThirdPoint(a,s,r,c,!0),A=P.PlotUtils.getThirdPoint(a,s,o,h,!1),I=P.PlotUtils.getThirdPoint(a,s,o,h,!0),m=[];return m.push(C[0],C[1],A[0],A[1],u[0],u[1],s[0],s[1],p[0],p[1],I[0],I[1],d[0],d[1],a[0],a[1]),t.Cartesian3.fromDegreesArray(m)}}function f(e){for(var i=[],r=0;r<e.length;r++){var o=t.Cartesian3.fromDegrees(e[r][0],e[r][1],0);i.push(o)}return i}o.prototype.createBillboardGroup=function(t,e,i){var r=new o.BillboardGroup(this,e);return r.addBillboards(t,i),r},o.BillboardGroup=function(e,i){this._drawHelper=e,this._scene=e._scene,this._options=_(i,d);var r=new t.BillboardCollection;this._scene.primitives.add(r),this._billboards=r,this._orderedBillboards=[]},o.BillboardGroup.prototype.createBillboard=function(e,r){var o=this._billboards.add({show:!0,position:e,pixelOffset:new t.Cartesian2(this._options.shiftX,this._options.shiftY),eyeOffset:new t.Cartesian3(0,0,0),horizontalOrigin:t.HorizontalOrigin.CENTER,verticalOrigin:t.VerticalOrigin.CENTER,scale:1,image:this._options.iconUrl,color:new t.Color(1,1,1,1)});if(r){var n=this,a=this._scene.screenSpaceCameraController;function s(t){a.enableRotate=t}function l(){for(var t=0,e=n._orderedBillboards.length;t<e&&n._orderedBillboards[t]!=o;++t);return t}if(r.dragHandlers){n=this;w(o,"leftDown",function(e){function a(t){g.destroy(),s(!0),r.dragHandlers.onDragEnd&&r.dragHandlers.onDragEnd(l(),t)}var g=new t.ScreenSpaceEventHandler(n._scene.canvas);g.setInputAction(function(t){var e=n._scene.camera.pickEllipsoid(t.endPosition,i);e?function(t){o.position=t;for(var e=0,i=n._orderedBillboards.length;e<i&&n._orderedBillboards[e]!=o;++e);r.dragHandlers.onDrag&&r.dragHandlers.onDrag(l(),t)}(e):a(e)},t.ScreenSpaceEventType.MOUSE_MOVE),g.setInputAction(function(t){a(n._scene.camera.pickEllipsoid(t.position,i))},t.ScreenSpaceEventType.LEFT_UP),s(!1),r.dragHandlers.onDragStart&&r.dragHandlers.onDragStart(l(),n._scene.camera.pickEllipsoid(e,i))})}r.onDoubleClick&&w(o,"leftDoubleClick",function(t){r.onDoubleClick(l())}),r.onClick&&w(o,"leftClick",function(t){r.onClick(l())}),r.tooltip&&(w(o,"mouseMove",function(t){n._drawHelper._tooltip.showAt(t,r.tooltip())}),w(o,"mouseOut",function(t){n._drawHelper._tooltip.setVisible(!1)}))}return o},o.BillboardGroup.prototype.insertBillboard=function(t,e,i){this._orderedBillboards.splice(t,0,this.createBillboard(e,i))},o.BillboardGroup.prototype.addBillboard=function(t,e){this._orderedBillboards.push(this.createBillboard(t,e))},o.BillboardGroup.prototype.removeLastBillboard=function(){this._billboards.remove(this._orderedBillboards.pop())},o.BillboardGroup.prototype.addBillboards=function(t,e){for(var i=0;i<t.length;i++)this.addBillboard(t[i],e)},o.BillboardGroup.prototype.updateBillboardsPositions=function(t){for(var e=0;e<t.length;e++)this.getBillboard(e).position=t[e]},o.BillboardGroup.prototype.countBillboards=function(){return this._orderedBillboards.length},o.BillboardGroup.prototype.getBillboard=function(t){return this._orderedBillboards[t]},o.BillboardGroup.prototype.removeBillboard=function(t){this._billboards.remove(this.getBillboard(t)),this._orderedBillboards.splice(t,1)},o.BillboardGroup.prototype.remove=function(){this._billboards=this._billboards&&this._billboards.removeAll()&&this._billboards.destroy()},o.BillboardGroup.prototype.setOnTop=function(){this._scene.primitives.raiseToTop(this._billboards)},o.prototype.startDrawingPolygon=function(t){t=_(t,s);this.startDrawingPolyshape(!0,t)},o.prototype.startDrawingPolyline=function(r){r=_(r,c);this.startDrawing(function(){l.remove(n),C.remove(),u.destroy(),g.setVisible(!1)});var n,a=this,s=this._scene,l=s.primitives,g=this._tooltip;(n=new e.PolylinePrimitive(r)).asynchronous=!1,l.add(n);var h=[],C=new o.BillboardGroup(this,d),u=new t.ScreenSpaceEventHandler(s.canvas);u.setInputAction(function(t){if(null!=t.position){var e=s.camera.pickEllipsoid(t.position,i);e&&(0==h.length&&(h.push(e.clone()),C.addBillboard(h[0])),h.length>=2&&(n.positions=h,n._createPrimitive=!0),h.push(e),C.addBillboard(e))}},t.ScreenSpaceEventType.LEFT_CLICK),u.setInputAction(function(t){var e=t.endPosition;if(null!=e)if(0==h.length)g.showAt(e,"<p>Click to add first point</p>");else{var r=s.camera.pickEllipsoid(e,i);r&&(h.pop(),r.y+=1+Math.random(),h.push(r),h.length>=2&&(n.positions=h,n._createPrimitive=!0),C.getBillboard(h.length-1).position=r,g.showAt(e,"<p>Click to add new point ("+h.length+")</p>"+(h.length>2?"<p>Double click to finish drawing</p>":"")))}},t.ScreenSpaceEventType.MOUSE_MOVE),u.setInputAction(function(t){var e=t.position;if(null!=e){if(h.length<4)return;if(s.camera.pickEllipsoid(e,i)&&(a.stopDrawing(),"function"==typeof r.callback)){h.length;r.callback(h)}}},t.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)},o.prototype.startDrawingTailedAttack=function(r){this.startDrawing(function(){s.remove(g),C.remove(),u.destroy(),l.setVisible(!1)}),this.firstTime=!0,this.options=r;var n=this,a=this._scene,s=a.primitives,l=this._tooltip,g=new e.TailedAttackPrimitive(r);/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent)?g.asynchronous=!0:g.asynchronous=!1,s.add(g);var h=[],c=[],C=new o.BillboardGroup(this,d),u=new t.ScreenSpaceEventHandler(a.canvas);this.positions=h,this.minPoints=2,this.poly=g,u.setInputAction(function(e){if(null!=e.position){var r=a.camera.pickEllipsoid(e.position,i),o=t.Cartographic.fromCartesian(r),n=[t.Math.toDegrees(o.longitude),t.Math.toDegrees(o.latitude)];if(r){if(0==c.length&&(h.push(r.clone()),C.addBillboard(h[0])),c.length<3&&c.push(n),c.length>=2){c.push(n);var s=xp.algorithm.tailedAttackArrow(c);g.positions=s.polygonalPoint,g.custom=s.controlPoint,g._createPrimitive=!0}h.push(r),h.length>=5&&C.removeLastBillboard(),C.addBillboard(r)}}},t.ScreenSpaceEventType.LEFT_CLICK),u.setInputAction(function(e){var r=e.endPosition;if(null!=r)if(0==h.length)l.showAt(r,"<p>点击以增加第一个控制点</p>");else{var o=a.camera.pickEllipsoid(r,i),n=t.Cartographic.fromCartesian(o),s=[t.Math.toDegrees(n.longitude),t.Math.toDegrees(n.latitude)];if(o){if(h.pop(),o.y+=1+Math.random(),h.push(o),c.length>=3&&(c.pop(),c.push(s)),2==c.length&&c.push(s),h.length>2){var C=xp.algorithm.tailedAttackArrow(c);g.positions=C?C.polygonalPoint:null,g.custom=C?C.controlPoint:null,g._createPrimitive=!0}var d=3==h.length?"<p>双击可结束绘制</p>":"单击以增加一个新的控制点";l.showAt(r,d)}}},t.ScreenSpaceEventType.MOUSE_MOVE),u.setInputAction(function(t){n.drawEnd(t,r)},t.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)},o.prototype.drawEnd=function(t,e){var r,o=this.positions,n=this.minPoints,a=this.poly;e=this.options;if(void 0==t){if(this.firstTime){if(this.stopDrawing(),"function"!=typeof e.callback)return;o.length;e.callback(a.positions,a.custom),this.firstTime=!1}}else if(null!=(r=t.position)){if(o.length<n+2)return;if(scene.camera.pickEllipsoid(r,i)&&(this.stopDrawing(),"function"==typeof e.callback)){o.length;e.callback(a.positions,a.custom)}}},o.prototype.startDrawingPolyshape=function(r,n){this.startDrawing(function(){g.remove(a),u.remove(),p.destroy(),h.setVisible(!1)}),this.firstTime=!0,this.options=n;var a,s=this,l=this._scene,g=l.primitives,h=this._tooltip;this.minPoints=2,a=r?new e.PolygonPrimitive(n):new e.PolylinePrimitive(n),/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent)?a.asynchronous=!0:a.asynchronous=!1,g.add(a);var c=[],C=[],u=new o.BillboardGroup(this,d),p=new t.ScreenSpaceEventHandler(l.canvas);this.poly=a,this.positions=c,p.setInputAction(function(e){if(null!=e.position){var r=l.camera.pickEllipsoid(e.position,i),o=t.Cartographic.fromCartesian(r),n=[t.Math.toDegrees(o.longitude),t.Math.toDegrees(o.latitude)];if(r){if(0==C.length&&(c.push(r.clone()),u.addBillboard(c[0])),C.length<3&&C.push(n),C.length>=2){var s=xp.algorithm.doubleArrow(C);a.positions=s.polygonalPoint,a.custom=s.controlPoint,a._createPrimitive=!0}c.push(r),c.length>=5&&u.removeLastBillboard(),u.addBillboard(r)}}},t.ScreenSpaceEventType.LEFT_CLICK),p.setInputAction(function(e){var r=e.endPosition;if(null!=r)if(0==c.length)h.showAt(r,"<p>点击以增加第一个控制点</p>");else{var o=l.camera.pickEllipsoid(r,i),n=t.Cartographic.fromCartesian(o),s=[t.Math.toDegrees(n.longitude),t.Math.toDegrees(n.latitude)];if(o){if(c.pop(),o.y+=1+Math.random(),c.push(o),3==C.length&&(C.pop(),C.push(s)),2==C.length&&C.push(s),c.length>=2){var g=xp.algorithm.doubleArrow(C);a.positions=g?g.polygonalPoint:null,a.custom=g?g.controlPoint:null,a._createPrimitive=!0}var d=3==c.length?"<p>双击可结束绘制</p>":"单击以增加一个新的控制点";h.showAt(r,d)}}},t.ScreenSpaceEventType.MOUSE_MOVE),p.setInputAction(function(t){s.drawEnd(t,n)},t.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)},o.prototype.startDrawingExtent=function(e){e=_(e,s);this.startDrawing(function(){null!=h&&a.remove(h),c.remove(),C.destroy(),l.setVisible(!1)});var r=this,n=this._scene,a=this._scene.primitives,l=this._tooltip,g=[],h=null,c=null,C=new t.ScreenSpaceEventHandler(n.canvas);C.setInputAction(function(s){if(null!=s.position){var l=n.camera.pickEllipsoid(s.position,i);if(l)if(null==h){var C=t.Cartographic.fromCartesian(l),u=t.Math.toDegrees(C.longitude),p=t.Math.toDegrees(C.latitude);g.push(u,p);var A=m(g,g);h=new o.ExtentPrimitive({extent:A,asynchronous:!1,material:e.material}),a.add(h),c=new o.BillboardGroup(r,d);var I=f([g,g]);c.addBillboards(I)}else if(r.stopDrawing(),"function"==typeof e.callback){C=t.Cartographic.fromCartesian(l),u=t.Math.toDegrees(C.longitude),p=t.Math.toDegrees(C.latitude);e.callback(m(g,[u,p]))}}},t.ScreenSpaceEventType.LEFT_DOWN),C.setInputAction(function(e){var r=e.endPosition;if(null!=r)if(null==h)l.showAt(r,"<p>点击开始绘制</p>");else{var o=n.camera.pickEllipsoid(r,i);if(o){var a=t.Cartographic.fromCartesian(o),s=t.Math.toDegrees(a.longitude),C=t.Math.toDegrees(a.latitude),d=m(g,[s,C]);h.setExtent(d);var u=f([g,[s,C]]);c.updateBillboardsPositions(u),l.showAt(r,"<p>拖动改变箭头</p><p>再次点击结束绘制</p>")}}},t.ScreenSpaceEventType.MOUSE_MOVE)},o.prototype.enhancePrimitives=function(){var n=this;function a(e){n._scene;this._highlighted&&this._highlighted==e||!0!==this._editMode&&(this._highlighted=e,e?(n.setHighlighted(this),this._strokeColor=this.strokeColor,this.setStrokeStyle(t.Color.fromCssColorString("white"),this.strokeWidth)):this._strokeColor?this.setStrokeStyle(this._strokeColor,this.strokeWidth):this.setStrokeStyle(void 0,void 0))}function s(e){if(this._editMode!=e)if(n.disableAllHighlights(),e){n.setEdited(this);var a=n._scene,s=this;if(null==this._markers){var l=new o.BillboardGroup(n,u);r.billBoard.push(l);var g=new o.BillboardGroup(n,p);function h(t,e){var i=t-1<0?e.length-1:t-1;i<g.countBillboards()&&(g.getBillboard(i).position=d(i)),(i=t)<g.countBillboards()&&(g.getBillboard(i).position=d(i))}function c(){s.executeListeners({name:"onEdited",positions:s.positions})}r.billBoard.push(g);var C={dragHandlers:{onDrag:function(t,e){s.positions[t]=e,h(t,s.positions),s._createPrimitive=!0},onDragEnd:function(t,e){s._createPrimitive=!0,c()}},onDoubleClick:function(t){s.positions.length<4||(s.positions.splice(t,1),s._createPrimitive=!0,l.removeBillboard(t),g.removeBillboard(t),h(t,s.positions),c())},tooltip:function(){if(s.positions.length>3)return"Double click to remove this point"}};function d(e){var r=s.positions;return i.cartographicToCartesian(new t.EllipsoidGeodesic(i.cartesianToCartographic(r[e]),i.cartesianToCartographic(r[e<r.length-1?e+1:0])).interpolateUsingFraction(.5))}l.addBillboards(s.positions,C),this._markers=l;for(var A=[],I=0,m=s.positions.length+(this.isPolygon?0:-1);I<m;I++)A.push(d(I));var f={dragHandlers:{onDragStart:function(t,e){this.index=t+1,s.positions.splice(this.index,0,e),s._createPrimitive=!0},onDrag:function(t,e){s.positions[this.index]=e,s._createPrimitive=!0},onDragEnd:function(t,e){l.insertBillboard(this.index,e,C),g.getBillboard(this.index-1).position=d(this.index-1),g.insertBillboard(this.index,d(this.index),f),s._createPrimitive=!0,c()}},tooltip:function(){return"Drag to create a new point"}};g.addBillboards(A,f),this._editMarkers=g,this._globeClickhandler=new t.ScreenSpaceEventHandler(a.canvas),this._globeClickhandler.setInputAction(function(t){var e=a.pick(t.position);e&&e.primitive||s.setEditMode(!1)},t.ScreenSpaceEventType.LEFT_CLICK),l.setOnTop(),g.setOnTop()}this._editMode=!0}else null!=this._markers&&(this._markers.remove(),this._editMarkers.remove(),this._markers=null,this._editMarkers=null,this._globeClickhandler.destroy()),this._editMode=!1}t.Billboard.prototype.setEditable=function(){if(!this._editable){this._editable=!0;var e=this,r=this;w(e,"leftDown",function(a){function s(t){l.destroy(),o(!0),r.executeListeners({name:"dragEnd",positions:t})}var l=new t.ScreenSpaceEventHandler(n._scene.canvas);l.setInputAction(function(t){var o,a=n._scene.camera.pickEllipsoid(t.endPosition,i);a?(o=a,e.position=o,r.executeListeners({name:"drag",positions:o})):s(a)},t.ScreenSpaceEventType.MOUSE_MOVE),l.setInputAction(function(t){s(n._scene.camera.pickEllipsoid(t.position,i))},t.ScreenSpaceEventType.LEFT_UP),o(!1)}),b(e)}function o(t){n._scene.screenSpaceCameraController.enableRotate=t}},e.PolylinePrimitive.prototype.setEditable=function(){if(!this.setEditMode){this.isPolygon=!1,this.asynchronous=!1,n.registerEditableShape(this),this.setEditMode=s;var e=this.width;this.setHighlighted=function(t){!0!==this._editMode&&(t?(n.setHighlighted(this),this.setWidth(2*e)):this.setWidth(e))},this.getExtent=function(){return t.Extent.fromCartographicArray(i.cartesianArrayToCartographicArray(this.positions))},b(this),this.setEditMode(!1)}},e.PolygonPrimitive.prototype.setEditable=function(){var e=this;e.asynchronous=!1;var i=n._scene;n.registerEditableShape(e),e.setEditMode=function(a){if(this._editMode!=a)if(n.disableAllHighlights(),a){if(n.setEdited(this),null==this._markers){var s=new o.BillboardGroup(n,u);r.billBoard.push(s);var l={dragHandlers:{onDrag:function(t,i){var r=e.custom;r[t]=I(i);var o=xp.algorithm.doubleArrow(r);e.positions=o.polygonalPoint,e.custom=o.controlPoint,e._createPrimitive=!0,s.updateBillboardsPositions(f(e.custom))},onDragEnd:function(t,i){e.executeListeners({name:"onEdited",positions:e.positions})}},tooltip:function(){return"拖动以钳击形状"}},g=e.custom;s.addBillboards(f(g),l),this._markers=s,this._globeClickhandler=new t.ScreenSpaceEventHandler(i.canvas),this._globeClickhandler.setInputAction(function(t){var r=i.pick(t.position);console.log("PolygonPrimitive单击"),r&&r.primitive||e.setEditMode(!1)},t.ScreenSpaceEventType.LEFT_CLICK),s.setOnTop()}this._editMode=!0}else null!=this._markers&&(this._markers.remove(),this._markers=null,this._globeClickhandler.destroy()),this._editMode=!1},e.setHighlighted=a,b(e),e.setEditMode(!1)},e.TailedAttackPrimitive.prototype.setEditable=function(){var e=this;e.asynchronous=!1;var i=n._scene;n.registerEditableShape(e),e.setEditMode=function(a){if(this._editMode!=a)if(n.disableAllHighlights(),a){if(n.setEdited(this),null==this._markers){var s=new o.BillboardGroup(n,u);r.billBoard.push(s);var l={dragHandlers:{onDrag:function(t,i){var r=e.custom;r[t]=I(i);var o=xp.algorithm.tailedAttackArrow(r);e.positions=o.polygonalPoint,e.custom=o.controlPoint,e._createPrimitive=!0,s.updateBillboardsPositions(f(e.custom))},onDragEnd:function(t,i){e.executeListeners({name:"onEdited",positions:e.positions})}},tooltip:function(){return"拖动以改变形状"}},g=e.custom;s.addBillboards(f(g),l),this._markers=s,this._globeClickhandler=new t.ScreenSpaceEventHandler(i.canvas),this._globeClickhandler.setInputAction(function(t){var r=i.pick(t.position);console.log("TailedAttackPrimitive单击"),r&&r.primitive||e.setEditMode(!1)},t.ScreenSpaceEventType.LEFT_CLICK),s.setOnTop()}this._editMode=!0}else null!=this._markers&&(this._markers.remove(),this._markers=null,this._globeClickhandler.destroy()),this._editMode=!1},e.setHighlighted=a,b(e),e.setEditMode(!1)},e.ExtentPrimitive.prototype.setEditable=function(){if(!this.setEditMode){var e=this,i=n._scene;n.registerEditableShape(e),e.asynchronous=!1,e.setEditMode=function(a){if(this._editMode!=a)if(n.disableAllHighlights(),a){if(n.setEdited(this),null==this._markers){var s=new o.BillboardGroup(n,u);r.billBoard.push(s);var l={dragHandlers:{onDrag:function(t,i){var r=I(i),o=I(s.getBillboard((t+1)%2).position),n=0==t?m(r,o):m(o,r);e.setExtent(n),s.updateBillboardsPositions(A(e.extent))},onDragEnd:function(t,i){e.executeListeners({name:"onEdited",extent:e.extent})}},tooltip:function(){return"拖动以改变此箭头形状"}};s.addBillboards(A(e.extent),l),this._markers=s,this._globeClickhandler=new t.ScreenSpaceEventHandler(i.canvas),this._globeClickhandler.setInputAction(function(t){var r=i.pick(t.position);console.log("ExtentPrimitive单击"),r&&r.primitive||e.setEditMode(!1)},t.ScreenSpaceEventType.LEFT_CLICK),s.setOnTop()}this._editMode=!0}else null!=this._markers&&(this._markers.remove(),this._markers=null,this._globeClickhandler.destroy()),this._editMode=!1},e.setHighlighted=a,b(e),e.setEditMode(!1)}}},o.DrawHelperWidget=function(){return function(e,i){if(!t.defined(i.container))throw new t.DeveloperError("Container is required");y(i,{markerIcon:"./img/glyphicons_242_google_maps.png",polylineIcon:"./img/glyphicons_097_vector_path_line.png",polygonIcon:"./img/qianjijiantou.png",circleIcon:"./img/glyphicons_095_vector_path_circle.png",tailedAttackArrowIcon:"./img/gongjijiantou.png",extentIcon:"./img/zhijiaojiantou.png",clearIcon:"./img/glyphicons_067_cleaning.png",polylineDrawingOptions:c,polygonDrawingOptions:l,extentDrawingOptions:g,circleDrawingOptions:h});var o=this,n=document.createElement("DIV");function a(t,e,i,r){var o=document.createElement("DIV");o.className="button",o.title=i,n.appendChild(o),o.onclick=r;var a=document.createElement("SPAN");o.appendChild(a);var s=document.createElement("IMG");return s.src=e,a.appendChild(s),o}n.className="toolbar",i.container.appendChild(n);var s=e._scene;a(0,i.extentIcon,"点击以绘制直箭头",function(){e.startDrawingExtent({callback:function(t){o.executeListeners({name:"extentCreated",extent:t})}})}),a(0,i.polygonIcon,"点击以绘制钳击箭头",function(){e.startDrawingPolygon({callback:function(t,e){o.executeListeners({name:"polygonCreated",positions:t,custom:e})}})}),a(0,i.tailedAttackArrowIcon,"点击以绘制攻击箭头",function(){e.startDrawingTailedAttack({callback:function(t,e){o.executeListeners({name:"tailedAttackCreated",positions:t,custom:e})}})});var C=document.createElement("DIV");C.className="divider",n.appendChild(C),a(0,i.clearIcon,"Remove all primitives",function(){for(var t=r.primitives.length,e=r.billBoard.length,i=0;i<t;i++){var o=r.primitives.pop();o._globeClickhandler.destroy(),s.primitives.remove(o)}for(i=0;i<e;i++)r.billBoard.pop().remove()}),b(this)}}(),o.prototype.addToolbar=function(t,e){return e=_(e,{container:t}),new o.DrawHelperWidget(this,e)},o.DrawWidget=function(t){return function(t,e){var i=this;"extentCreated"==e&&t.startDrawingExtent({callback:function(t){i.executeListeners({name:"extentCreated",extent:t})}}),"polygonCreated"==e&&t.startDrawingPolygon({callback:function(t,e){i.executeListeners({name:"polygonCreated",positions:t,custom:e})}}),"tailedAttackCreated"==e&&t.startDrawingTailedAttack({callback:function(t,e){i.executeListeners({name:"tailedAttackCreated",positions:t,custom:e})}}),b(this)}}(),o.ClearWidget=function(){return function(){var t=drawHelper._scene,e=r.primitives.length,i=r.billBoard.length;if(0!=e&&r.primitives[e-1]._editMode){for(var o=0;o<1;o++){var n=r.primitives[e-1];n._globeClickhandler.destroy(),t.primitives.remove(n)}for(o=0;o<1;o++)r.billBoard[i-1].remove();r={billBoard:[],primitives:[]},b(this)}}}(),o.prototype.active=function(t){return new o.DrawWidget(this,t)},o.prototype.clear=function(){return new o.ClearWidget(this)};function v(t,e){if(null==t||"object"!=typeof t)return t;if(t.constructor!=Object&&t.constructor!=Array)return t;if(t.constructor==Date||t.constructor==RegExp||t.constructor==Function||t.constructor==String||t.constructor==Number||t.constructor==Boolean)return new t.constructor(t);e=e||new t.constructor;for(var i in t)e[i]=void 0===e[i]?v(t[i],null):e[i];return e}function y(t,e){var i;t=t||{};for(i in e)void 0===t[i]&&(t[i]=v(e[i]))}function _(t,e){var i,r=v(t);for(i in e)void 0===r[i]&&(r[i]=v(e[i]));return r}function w(t,e,i){t[e]=i}function b(t){t._listeners={},t.addListener=function(t,e){return this._listeners[t]=this._listeners[t]||[],this._listeners[t].push(e),this._listeners[t].length},t.executeListeners=function(t,e){if(this._listeners[t.name]&&this._listeners[t.name].length>0)for(var i=0;i<this._listeners[t.name].length;i++)this._listeners[t.name][i](t);else e&&e(t)}}return o}()}(window.Cesium);var P={version:"1.0.0"};if(P.PlotUtils={},P.PlotUtils.distance=function(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))},P.PlotUtils.wholeDistance=function(t){for(var e=0,i=0;i<t.length-1;i++)e+=P.PlotUtils.distance(t[i],t[i+1]);return e},P.PlotUtils.getBaseLength=function(t){return Math.pow(P.PlotUtils.wholeDistance(t),.99)},P.PlotUtils.mid=function(t,e){return[(t[0]+e[0])/2,(t[1]+e[1])/2]},P.PlotUtils.getCircleCenterOfThreePoints=function(t,e,i){var r=[(t[0]+e[0])/2,(t[1]+e[1])/2],o=[r[0]-t[1]+e[1],r[1]+t[0]-e[0]],n=[(t[0]+i[0])/2,(t[1]+i[1])/2],a=[n[0]-t[1]+i[1],n[1]+t[0]-i[0]];return P.PlotUtils.getIntersectPoint(r,o,n,a)},P.PlotUtils.getIntersectPoint=function(t,e,i,r){if(t[1]==e[1]){var o=(r[0]-i[0])/(r[1]-i[1]),n=o*(t[1]-i[1])+i[0],a=t[1];return[n,a]}if(i[1]==r[1]){var s=(e[0]-t[0])/(e[1]-t[1]);return[n=s*(i[1]-t[1])+t[0],a=i[1]]}return s=(e[0]-t[0])/(e[1]-t[1]),o=(r[0]-i[0])/(r[1]-i[1]),[n=s*(a=(s*t[1]-t[0]-o*i[1]+i[0])/(s-o))-s*t[1]+t[0],a]},P.PlotUtils.getAzimuth=function(t,e){var i,r=Math.asin(Math.abs(e[1]-t[1])/P.PlotUtils.distance(t,e));return e[1]>=t[1]&&e[0]>=t[0]?i=r+Math.PI:e[1]>=t[1]&&e[0]<t[0]?i=P.Constants.TWO_PI-r:e[1]<t[1]&&e[0]<t[0]?i=r:e[1]<t[1]&&e[0]>=t[0]&&(i=Math.PI-r),i},P.PlotUtils.getAngleOfThreePoints=function(t,e,i){var r=P.PlotUtils.getAzimuth(e,t)-P.PlotUtils.getAzimuth(e,i);return 0>r?r+P.Constants.TWO_PI:r},P.PlotUtils.isClockWise=function(t,e,i){return(i[1]-t[1])*(e[0]-t[0])>(e[1]-t[1])*(i[0]-t[0])},P.PlotUtils.getPointOnLine=function(t,e,i){return[e[0]+t*(i[0]-e[0]),e[1]+t*(i[1]-e[1])]},P.PlotUtils.getCubicValue=function(t,e,i,r,o){var n=1-(t=Math.max(Math.min(t,1),0)),a=t*t,s=a*t,l=n*n,g=l*n;return[g*e[0]+3*l*t*i[0]+3*n*a*r[0]+s*o[0],g*e[1]+3*l*t*i[1]+3*n*a*r[1]+s*o[1]]},P.PlotUtils.getThirdPoint=function(t,e,i,r,o){var n=P.PlotUtils.getAzimuth(t,e),a=o?n+i:n-i,s=r*Math.cos(a),l=r*Math.sin(a);return[e[0]+s,e[1]+l]},P.PlotUtils.getArcPoints=function(t,e,i,r){var o,n,a=[],s=r-i;s=0>s?s+P.Constants.TWO_PI:s;for(var l=0;l<=P.Constants.FITTING_COUNT;l++){var g=i+s*l/P.Constants.FITTING_COUNT;o=t[0]+e*Math.cos(g),n=t[1]+e*Math.sin(g),a.push([o,n])}return a},P.PlotUtils.getBisectorNormals=function(t,e,i,r){var o=P.PlotUtils.getNormal(e,i,r),n=Math.sqrt(o[0]*o[0]+o[1]*o[1]),a=o[0]/n,s=o[1]/n,l=P.PlotUtils.distance(e,i),g=P.PlotUtils.distance(i,r);if(n>P.Constants.ZERO_TOLERANCE)if(P.PlotUtils.isClockWise(e,i,r)){var h=t*l,c=i[0]-h*s,C=i[1]+h*a,d=[c,C];h=t*g;var u=[c=i[0]+h*s,C=i[1]-h*a]}else h=t*l,c=i[0]+h*s,C=i[1]-h*a,d=[c,C],h=t*g,c=i[0]-h*s,C=i[1]+h*a,u=[c,C];else c=i[0]+t*(e[0]-i[0]),C=i[1]+t*(e[1]-i[1]),d=[c,C],c=i[0]+t*(r[0]-i[0]),C=i[1]+t*(r[1]-i[1]),u=[c,C];return[d,u]},P.PlotUtils.getNormal=function(t,e,i){var r=t[0]-e[0],o=t[1]-e[1],n=Math.sqrt(r*r+o*o);r/=n,o/=n;var a=i[0]-e[0],s=i[1]-e[1],l=Math.sqrt(a*a+s*s);return[r+(a/=l),o+(s/=l)]},P.PlotUtils.getCurvePoints=function(t,e){for(var i=[P.PlotUtils.getLeftMostControlPoint(e)],r=0;r<e.length-2;r++){var o=e[r],n=e[r+1],a=e[r+2],s=P.PlotUtils.getBisectorNormals(t,o,n,a);i=i.concat(s)}var l=P.PlotUtils.getRightMostControlPoint(e);i.push(l);var g=[];for(r=0;r<e.length-1;r++){o=e[r],n=e[r+1],g.push(o);for(t=0;t<P.Constants.FITTING_COUNT;t++){var h=P.PlotUtils.getCubicValue(t/P.Constants.FITTING_COUNT,o,i[2*r],i[2*r+1],n);g.push(h)}g.push(n)}return g},P.PlotUtils.getLeftMostControlPoint=function(e){var i=e[0],r=e[1],o=e[2],n=P.PlotUtils.getBisectorNormals(0,i,r,o)[0],a=P.PlotUtils.getNormal(i,r,o);if(Math.sqrt(a[0]*a[0]+a[1]*a[1])>P.Constants.ZERO_TOLERANCE)var s=P.PlotUtils.mid(i,r),l=i[0]-s[0],g=i[1]-s[1],h=P.PlotUtils.distance(i,r),c=2/h,C=-c*g,d=c*l,u=C*C-d*d,p=2*C*d,A=d*d-C*C,I=n[0]-s[0],m=n[1]-s[1],f=s[0]+u*I+p*m,v=s[1]+p*I+A*m;else f=i[0]+t*(r[0]-i[0]),v=i[1]+t*(r[1]-i[1]);return[f,v]},P.PlotUtils.getRightMostControlPoint=function(e){var i=e.length,r=e[i-3],o=e[i-2],n=e[i-1],a=P.PlotUtils.getBisectorNormals(0,r,o,n)[1],s=P.PlotUtils.getNormal(r,o,n);if(Math.sqrt(s[0]*s[0]+s[1]*s[1])>P.Constants.ZERO_TOLERANCE)var l=P.PlotUtils.mid(o,n),g=n[0]-l[0],h=n[1]-l[1],c=P.PlotUtils.distance(o,n),C=2/c,d=-C*h,u=C*g,p=d*d-u*u,A=2*d*u,I=u*u-d*d,m=a[0]-l[0],f=a[1]-l[1],v=l[0]+p*m+A*f,y=l[1]+A*m+I*f;else v=n[0]+t*(o[0]-n[0]),y=n[1]+t*(o[1]-n[1]);return[v,y]},P.PlotUtils.getBezierPoints=function(t){if(t.length<=2)return t;for(var e=[],i=t.length-1,r=0;1>=r;r+=.01){for(var o=y=0,n=0;i>=n;n++){var a=P.PlotUtils.getBinomialFactor(i,n),s=Math.pow(r,n),l=Math.pow(1-r,i-n);o+=a*s*l*t[n][0],y+=a*s*l*t[n][1]}e.push([o,y])}return e.push(t[i]),e},P.PlotUtils.getBinomialFactor=function(t,e){return P.PlotUtils.getFactorial(t)/(P.PlotUtils.getFactorial(e)*P.PlotUtils.getFactorial(t-e))},P.PlotUtils.getFactorial=function(t){if(1>=t)return 1;if(2==t)return 2;if(3==t)return 6;if(4==t)return 24;if(5==t)return 120;for(var e=1,i=1;t>=i;i++)e*=i;return e},P.PlotUtils.getQBSplinePoints=function(t){if(t.length<=2)return t;var e=[],i=t.length-2-1;e.push(t[0]);for(var r=0;i>=r;r++)for(var o=0;1>=o;o+=.05){for(var n=y=0,a=0;2>=a;a++){var s=P.PlotUtils.getQuadricBSplineFactor(a,o);n+=s*t[r+a][0],y+=s*t[r+a][1]}e.push([n,y])}return e.push(t[t.length-1]),e},P.PlotUtils.getQuadricBSplineFactor=function(t,e){return 0==t?Math.pow(e-1,2)/2:1==t?(-2*Math.pow(e,2)+2*e+1)/2:2==t?Math.pow(e,2)/2:0},P.Constants={TWO_PI:2*Math.PI,HALF_PI:Math.PI/2,FITTING_COUNT:100,ZERO_TOLERANCE:1e-4},function(t){"use strict";var e=t.MeasureAreaWidget=function(e,i){this.viewer=e.viewer,this.color=e.color?e.color:t.Color.CHARTREUSE.withAlpha(.5),this.lineWidth=e.lineWidth?e.lineWidth:2,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.ellipsoid=this.scene.globe.ellipsoid,this.count=0,this.entityNames=[],this.labelNames=[]};function i(e,i,r,o){var n=e.add(new t.LabelCollection);n.name="result_labelArea"+o,n.add({text:i,font:"16px sans-serif",showBackground:!0,disableDepthTestDistance:Number.POSITIVE_INFINITY}),n.get(n.length-1).position=r[r.length-1]}function r(t,e){for(var i=0;i<e.length;i++)void 0!==e.get(i).name&&e.get(i).name.indexOf(t)>-1&&(e.remove(e.get(i)),i--)}function o(t,e){for(var i=e.values,r=0;r<i.length;r++)i[r].name.indexOf(t)>-1&&(e.remove(i[r]),r--)}e.prototype.activate=function(){if(this.handler=this.handler&&this.handler.destroy(),!this.handler){this.handler=new t.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var e,i,r,o=this,n=[];this._array_=n,this._polylines_=e,this._labels_=i,this.handler.setInputAction(function(i){o.lastP=i;var a=o.camera.getPickRay(i.position),s=o.scene.globe.pick(a,o.scene);s&&(n.push(s),1==n.length&&((e=o.primitives.add(new t.PolylineCollection)).name="draw_polyline",e.add({polyline:{}}),e.get(e.length-1).width=o.lineWidth,e.get(e.length-1).loop=!0,e.get(e.length-1).material.uniforms.color=o.color,e.get(e.length-1).positions=n),n.length>=3&&(e.get(e.length-1).positions=n,/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent)&&o.measureEnd()),o._polylines_=e,/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent)&&((r=o.primitives.add(new t.PointPrimitiveCollection)).name="draw_point",r.add({position:s,color:t.Color.WHITE,outlineColor:t.Color.RED,outlineWidth:1,pixelSize:5})))},t.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(r){if(!/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent)){var a=o.camera.getPickRay(r.endPosition),s=o.scene.globe.pick(a,o.scene);if(!s)return void(i&&(o.primitives.remove(i),i=null));if(n.length>=1){var l=n.concat();l.push(s),e.get(e.length-1).positions=l}i?i.get(i.length-1).position=s:((i=o.primitives.add(new t.LabelCollection)).name="draw_label",i.add({text:"左键单击开始绘制，右键单击结束绘制",font:"16px sans-serif",showBackground:!0,disableDepthTestDistance:Number.POSITIVE_INFINITY}),i.get(i.length-1).position=s),o._labels_=i}},t.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(t){o.measureEnd(),o.handler=o.handler&&o.handler.destroy(),o.viewer.canvas.style.cursor="default"},t.ScreenSpaceEventType.RIGHT_CLICK)}},e.prototype.selectFeatures=function(e){this.handler=this.handler&&this.handler.destroy(),this.handler=new t.ScreenSpaceEventHandler(this.canvas);var i=this;this.handler.setInputAction(function(e){var r=i.viewer.scene.pick(new t.Cartesian2(e.position.x,e.position.y));if(void 0!=r&&void 0!=r.id&&void 0!=r.id.polygon){r.id.polygon.material.color=t.Color.CHARTREUSE;var o=r.id.name,n=o.replace(/draw_polygon/,"result_labelArea");i.entityNames.push(o),i.labelNames.push(n)}},t.ScreenSpaceEventType.LEFT_CLICK)},e.prototype.delete=function(){this.handler=this.handler&&this.handler.destroy();for(var t=0;t<this.entityNames.length;t++)o(this.entityNames[t],this.viewer.entities);for(var e=0;e<this.labelNames.length;e++)r(this.labelNames[e],this.primitives);this.count=0,this.entityNames=[],this.labelNames=[]},e.prototype.measureEnd=function(e){if(void 0!=this._array_&&0!=this._array_.length){this._labels_&&(this.primitives.remove(this._labels_),this._labels_=null),e||(e=this.lastP);var r=this.camera.getPickRay(e.position),o=this.scene.globe.pick(r,this.scene);if(o){this._array_.push(o),this._polylines_.get(this._polylines_.length-1).material.uniforms.color=t.Color.CHARTREUSE.withAlpha(0),this.viewer.entities.add({name:"draw_polygon"+this.count,polygon:{hierarchy:{positions:this._array_},material:this.color}});for(var n=[],a=0;a<this._array_.length;a++){var s=t.Cartographic.fromCartesian(this._array_[a]),l=t.Math.toDegrees(s.longitude),g=t.Math.toDegrees(s.latitude);n.push([l,g])}n.push(n[0]);var h,c=turf.polygon([n]),C=turf.area(c);h=C<1e6?"总面积："+C.toFixed(2)+"m²":"总面积："+(C/1e6).toFixed(2)+"km²",/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent)?this.primitives.length>4?(this.primitives.remove(this.primitives.get(this.primitives.length-2)),i(this.primitives,h,this._array_)):i(this.primitives,h,this._array_):(i(this.primitives,h,this._array_,this.count),this.count++)}}},e.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",r("result_labelArea",this.primitives),r("draw_label",this.primitives),r("draw_polyline",this.primitives),o("draw_polygon",this.viewer.entities)}}(window.Cesium),function(t){"use strict";var e=t.MeasureDistanceWidget=function(e,i){this.viewer=e.viewer,this.color=e.color?e.color:t.Color.CHARTREUSE.withAlpha(.5),this.lineWidth=e.lineWidth?e.lineWidth:2,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.entities=this.viewer.entities,this.ellipsoid=this.scene.globe.ellipsoid,this.mode=e.mode?e.mode:1,this.count=0,this.tags=[]};function i(t,e){for(var i=0;i<e.length;i++)e.get(i).name==t&&(e.remove(e.get(i)),i--)}function r(t,e){for(var i=0;i<e.length;i++)e.get(i).tag==t&&(e.remove(e.get(i)),i--)}function o(t,e){for(var i=e.values,r=0;r<i.length;r++)i[r].tag==t&&(e.remove(i[r]),r--)}e.prototype.activate=function(){var e=this;e.count++,this.handler=new t.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var i,r,o,n=[];this._array_=n,this._polylines_=i,this._labels_=r,this.handler.setInputAction(function(r){e.lastP=r;var a=e.camera.getPickRay(r.position),s=e.scene.globe.pick(a,e.scene);if(s){var l=t.Cartographic.fromCartesian(s),g=t.Math.toDegrees(l.longitude),h=t.Math.toDegrees(l.latitude),c=l.height;n.push(g),n.push(h),n.push(c),3==n.length&&((i=e.primitives.add(new t.PolylineCollection)).tag=e.mode+"_"+e.count,i.name="draw_polyline",i.add({polyline:{}}),i.get(i.length-1).width=e.lineWidth,i.get(i.length-1).material.uniforms.color=e.color,i.get(i.length-1).positions=t.Cartesian3.fromDegreesArrayHeights(n)),n.length>3&&(i.get(i.length-1).positions=t.Cartesian3.fromDegreesArrayHeights(n)),e._polylines_=i,(o=e.primitives.add(new t.PointPrimitiveCollection)).tag=e.mode+"_"+e.count,o.name="draw_point",o.add({position:s,color:t.Color.WHITE,outlineColor:t.Color.RED,outlineWidth:1,pixelSize:e.pixelSize}),e.flag=!1,e.measureEnd(r)}},t.ScreenSpaceEventType.LEFT_DOWN),this.handler.setInputAction(function(o){var a=e.camera.getPickRay(o.endPosition),s=e.scene.globe.pick(a,e.scene);if(s){var l=t.Cartographic.fromCartesian(s),g=t.Math.toDegrees(l.longitude),h=t.Math.toDegrees(l.latitude),c=l.height;if(/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent))r=null;else{if(n.length>=3){var C=n.concat();C.push(g),C.push(h),C.push(c),i.get(i.length-1).positions=t.Cartesian3.fromDegreesArrayHeights(C)}r?r.get(r.length-1).position=t.Cartesian3.fromDegrees(g,h,c):((r=e.primitives.add(new t.LabelCollection)).name="draw_label",r.tag=e.mode+"_"+e.count,r.add({text:"左键单击开始绘制，右键单击结束绘制",font:"16px sans-serif",showBackground:!0,disableDepthTestDistance:Number.POSITIVE_INFINITY}),r.get(r.length-1).position=t.Cartesian3.fromDegrees(g,h,c))}e._labels_=r}else r&&(e.primitives.remove(r),r=null)},t.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(i){e.flag=!0,i=e.lastP;var r=e.camera.getPickRay(i.position),n=e.scene.globe.pick(r,e.scene);if(n){var a=t.Cartographic.fromCartesian(n),s=t.Math.toDegrees(a.longitude),l=t.Math.toDegrees(a.latitude),g=a.height;(o=e.primitives.add(new t.PointPrimitiveCollection)).tag=e.mode+"_"+e.count,o.name="draw_point",o.add({position:n,color:t.Color.WHITE,outlineColor:t.Color.RED,outlineWidth:1,pixelSize:e.pixelSize}),e._array_.push(s),e._array_.push(l),e._array_.push(g),e.measureEnd(i),e.handler=e.handler&&e.handler.destroy(),e.viewer.canvas.style.cursor="default",e._array_=[],e._polylines_=null}},t.ScreenSpaceEventType.RIGHT_CLICK)},e.prototype.measureEnd=function(e){if(void 0!=this._array_&&0!=this._array_.length){if(/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent))this._array_=this._array_;else if(!e){e=this.lastP;var i=this.camera.getPickRay(e.position),r=this.scene.globe.pick(i,this.scene);if(!r)return;var o=t.Cartographic.fromCartesian(r),n=t.Math.toDegrees(o.longitude),a=t.Math.toDegrees(o.latitude),s=o.height;this._array_[this._array_.length-1]==s&&this._array_[this._array_.length-2]==a&&this._array_[this._array_.length-3]==n?this._array_=this._array_:(this._array_.push(n),this._array_.push(a),this._array_.push(s))}this._labels_&&(this.primitives.remove(this._labels_),this._labels_=null);var l=this.mode;if(2==this.mode){var g=function(e,i){for(var r=[],o=0;o<e.length/3-1;o++){var n=3*o,a=e[n],s=e[n+1],l=e[n+2],g=e[n+3],h=e[n+4],c=e[n+5];r.push(a),r.push(s),r.push(l);for(var C=0;C<100;C++){var d={longitude:t.Math.toRadians(a),latitude:t.Math.toRadians(s),height:l},u={longitude:t.Math.toRadians(g),latitude:t.Math.toRadians(h),height:c},p=t.Math.lerp(d.longitude,u.longitude,.01*(C+1)),A=t.Math.lerp(d.latitude,u.latitude,.01*(C+1)),I={longitude:p,latitude:A},m=i.globe.getHeight(I);r.push(t.Math.toDegrees(p)),r.push(t.Math.toDegrees(A)),r.push(m)}r.push(g),r.push(h),r.push(c)}return r}(this._array_,this.scene);this._polylines_.get(this._polylines_.length-1).material.uniforms.color=t.Color.CHARTREUSE.withAlpha(0),this.viewer.entities.add({tag:this.mode+"_"+this.count,name:"draw_polyline",polyline:{positions:t.Cartesian3.fromDegreesArrayHeights(g),width:this.lineWidth,material:this.color}})}var h,c,C,d,u,p,A,I=t.Cartesian3.fromDegreesArrayHeights(this._array_),m=0,f=new t.EllipsoidGeodesic;if(1==l){for(var v=1;v<I.length;v++){var y=t.Cartographic.fromCartesian(I[v-1]),_=t.Math.toDegrees(y.longitude),w=t.Math.toDegrees(y.latitude),P=t.Cartographic.fromCartesian(I[v]),b=t.Math.toDegrees(P.longitude),E=t.Math.toDegrees(P.latitude),T=turf.point([_,w]),M=turf.point([b,E]);m+=turf.distance(T,M)}h=0==m?"起点":m>0&&m<1?this.flag?"总长："+(1e3*m).toFixed(2)+"m":(1e3*m).toFixed(2)+"m":this.flag?"总长："+m.toFixed(2)+"km":m.toFixed(2)+"km"}else if(2==l){for(v=1;v<I.length;v++){var x=t.Cartographic.fromCartesian(I[v-1]),S=t.Cartographic.fromCartesian(I[v]);f.setEndPoints(x,S),m+=Math.round(f.surfaceDistance),m=Number(m)}h=0==m?"起点":m>0&&m<1e3?this.flag?"总长："+m.toFixed(2)+"m":m.toFixed(2)+"m":this.flag?"总长："+(m/1e3).toFixed(2)+"km":(m/1e3).toFixed(2)+"km"}c=l,C=this.count,d=this.primitives,u=h,p=I,(A=d.add(new t.LabelCollection)).name="result_label",A.tag=c+"_"+C,A.add({text:u,font:"16px sans-serif",showBackground:!0,backgroundColor:new t.Color(1,0,0,.3),pixelOffset:new t.Cartesian2(10,10),disableDepthTestDistance:Number.POSITIVE_INFINITY}),A.get(A.length-1).position=p[p.length-1],d.length>3&&"result_label"==d._primitives[d.length-3].name&&(d._primitives[d.length-3]._labels[0].backgroundColor=new t.Color(0,1,0,.3))}},e.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",i("draw_point",this.primitives),i("result_label",this.primitives),i("draw_label",this.primitives),i("draw_polyline",this.primitives),function(t,e){for(var i=e.values,r=0;r<i.length;r++)i[r].name==t&&(e.remove(i[r]),r--)}("draw_polyline",this.viewer.entities)},e.prototype.selectFeatures=function(){var e=this;this.handler||(this.handler=new t.ScreenSpaceEventHandler(this.canvas),this.handler.setInputAction(function(i){var r=viewer.scene.pick(i.position);r&&(r.primitive._polylineCollection&&(e.tags.push(r.primitive._polylineCollection.tag),r.primitive.material.uniforms.color=t.Color.YELLOW.withAlpha(.5)),r.id&&r.id._polyline&&(e.tags.push(r.id.tag),r.id._polyline.material.color=t.Color.YELLOW.withAlpha(.5)))},t.ScreenSpaceEventType.LEFT_CLICK))},e.prototype.delete=function(t){if(this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",this.tags&&this.tags.length>0)for(var e=0;e<this.tags.length;e++)r(this.tags[e],this.primitives),o(this.tags[e],this.viewer.entities)}}(window.Cesium),function(t){"use strict";var e=t.MeasureElevationWidget=function(e,i){this.viewer=e.viewer,this.color=e.color?e.color:t.Color.YELLOW,this.pixelSize=e.pixelSize?e.pixelSize:10,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.ellipsoid=this.scene.globe.ellipsoid,this.count=0,this.tags=[]};function i(t,e){for(var i=0;i<e.length;i++)e.get(i).name==t&&(e.remove(e.get(i)),i--)}function r(t,e){for(var i=0;i<e.length;i++)e.get(i).tag==t&&(e.remove(e.get(i)),i--)}e.prototype.activate=function(){this.count++,this.handler&&(this.handler=this.handler&&this.handler.destroy()),this.handler=new t.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var e,i,r=this,o=[];this.handler.setInputAction(function(n){var a=r.camera.getPickRay(n.position),s=r.scene.globe.pick(a,r.scene);if(s){o[0]=s,e?e.removeAll():((e=r.primitives.add(new t.PointPrimitiveCollection)).tag=r.count,e.name="draw_point"),e.add({position:s,color:r.color,pixelSize:r.pixelSize}),r.handler=r.handler&&r.handler.destroy(),r.viewer.canvas.style.cursor="default",i&&(r.primitives.remove(i),i=null);var l,g,h,c,C,d="高程值："+t.Cartographic.fromCartesian(o[0]).height.toFixed(2)+"m";l=r.primitives,g=d,h=o,c=r.count,(C=l.add(new t.LabelCollection)).name="result_label",C.tag=c,C.add({text:g,font:"16px sans-serif",showBackground:!0,pixelOffset:new t.Cartesian2(6,2),disableDepthTestDistance:Number.POSITIVE_INFINITY}),C.get(C.length-1).position=h[h.length-1]}},t.ScreenSpaceEventType.LEFT_DOWN)},e.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",i("result_label",this.primitives),i("draw_point",this.primitives)},e.prototype.selectFeatures=function(){var e=this;this.handler||(this.handler=new t.ScreenSpaceEventHandler(this.canvas),this.handler.setInputAction(function(i){var r=viewer.scene.pick(i.position);"draw_point"===r.collection.name?r.primitive&&(e.tags.push(r.collection.tag),r.primitive.color=t.Color.YELLOW.withAlpha(.5)):alert("您选择的不是高程点！")},t.ScreenSpaceEventType.LEFT_CLICK))},e.prototype.delete=function(t){if(this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",this.tags&&this.tags.length>0)for(var e=0;e<this.tags.length;e++)r(this.tags[e],this.primitives)}}(window.Cesium),function(t){"use strict";var e=t.MeasureHeightWidget=function(e,i){this.viewer=e.viewer,this.color=e.color?e.color:t.Color.CHARTREUSE.withAlpha(.5),this.lineWidth=e.lineWidth?e.lineWidth:2,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.ellipsoid=this.scene.globe.ellipsoid,this.callback=i||function(){},this.count=0,this.entityNames=[],this.labelNames=[],this.pointNames=[]};function i(e,i,r,o){var n=e.add(new t.LabelCollection);n.name="result_labelHeight"+o,n.add({text:i,font:"16px sans-serif",showBackground:!0,disableDepthTestDistance:Number.POSITIVE_INFINITY}),n.get(n.length-1).position=t.Cartesian3.fromDegrees(r[r.length-3],r[r.length-2],r[r.length-1])}function r(t,e){for(var i=0;i<e.length;i++)void 0!==e.get(i).name&&e.get(i).name.indexOf(t)>-1&&(e.remove(e.get(i)),i--)}function o(t,e){for(var i=0;i<e.length;i++)e.get(i).name==t&&(e.remove(e.get(i)),i--)}e.prototype.activate=function(){if(this.handler=this.handler&&this.handler.destroy(),!this.handler){this.handler=new t.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var e,i,r=this,o=[];this._array_=o,this._polylines_=e,this._labels_=void 0,this.handler.setInputAction(function(n){var a=r.camera.getPickRay(n.position),s=r.scene.globe.pick(a,r.scene);if(s){var l=t.Cartographic.fromCartesian(s),g=t.Math.toDegrees(l.longitude),h=t.Math.toDegrees(l.latitude),c=l.height;o.length>0&&(9==o.length&&(o[3]=g,o[4]=h,o[5]=c,o[2]>=o[5]?(o[6]=o[0],o[7]=o[1],o[8]=o[5]):(o[6]=o[3],o[7]=o[4],o[8]=o[2]),e.get(e.length-1).positions=t.Cartesian3.fromDegreesArrayHeights(o)),(i=r.primitives.add(new t.PointPrimitiveCollection)).name="draw_point"+r.count,i.add({position:s,color:r.color,pixelSize:r.pixelSize}),r._array_=o,r.measureEnd()),0==o.length&&(o.push(g),o.push(h),o.push(c),o.push(g),o.push(h),o.push(c),o.push(g),o.push(h),o.push(c),(e=r.primitives.add(new t.PolylineCollection)).name="draw_polyline"+r.count,e.add({polyline:{}}),e.get(e.length-1).width=r.lineWidth,e.get(e.length-1).loop=!0,e.get(e.length-1).material.uniforms.color=r.color,e.get(e.length-1).positions=t.Cartesian3.fromDegreesArrayHeights(o),(i=r.primitives.add(new t.PointPrimitiveCollection)).name="draw_point"+r.count,i.add({position:s,color:r.color,pixelSize:r.pixelSize}))}},t.ScreenSpaceEventType.LEFT_CLICK)}},e.prototype.selectFeatures=function(e){this.handler=this.handler&&this.handler.destroy(),this.handler=new t.ScreenSpaceEventHandler(this.canvas);var i=this;this.handler.setInputAction(function(e){var r=i.viewer.scene.pick(e.position);if(void 0!=r){if(void 0!=r.collection&&void 0!=r.collection.name&&void 0!=r.primitive&&void 0!=r.primitive.material){r.primitive.material.uniforms.color=t.Color.CHARTREUSE;var o=r.collection.name,n=o.replace(/draw_polyline/,"result_labelHeight"),a=o.replace(/draw_polyline/,"draw_point");i.entityNames.push(o),i.labelNames.push(n),i.pointNames.push(a)}}else alert("没有选中目标")},t.ScreenSpaceEventType.LEFT_CLICK)},e.prototype.delete=function(t){this.handler=this.handler&&this.handler.destroy();for(var e=0;e<this.entityNames.length;e++)o(this.entityNames[e],this.primitives);for(var i=0;i<this.labelNames.length;i++)o(this.labelNames[i],this.primitives);for(i=0;i<this.pointNames.length;i++)o(this.pointNames[i],this.primitives);this.count=0,this.entityNames=[],this.labelNames=[],this.pointNames=[]},e.prototype.measureEnd=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",this._labels_&&(this.primitives.remove(this._labels_),this._labels_=null);var t=1e3*turf.distance(turf.point([this._array_[0],this._array_[1]]),turf.point([this._array_[3],this._array_[4]]));(o=[]).push((this._array_[0]+this._array_[3])/2),o.push((this._array_[1]+this._array_[4])/2),this._array_[2]>=this._array_[5]?o.push(this._array_[5]):o.push(this._array_[2]),e=t<1e3?"水平距离："+t.toFixed(2)+"m":"水平距离："+(t/1e3).toFixed(2)+"km",i(this.primitives,e,o,this.count);var e,r=Math.abs(this._array_[2]-this._array_[5]),o=[];this._array_[2]>=this._array_[5]?(o.push(this._array_[0]),o.push(this._array_[1])):(o.push(this._array_[3]),o.push(this._array_[4])),o.push((this._array_[2]+this._array_[5])/2),e=r<1e3?"垂直高度："+r.toFixed(2)+"m":"垂直高度："+(r/1e3).toFixed(2)+"km",i(this.primitives,e,o,this.count),(o=[]).push((this._array_[0]+this._array_[3])/2),o.push((this._array_[1]+this._array_[4])/2),o.push((this._array_[2]+this._array_[5])/2);var n=Math.sqrt(Math.pow(t,2)+Math.pow(r,2));e=n<1e3?"空间距离："+n.toFixed(2)+"m":"空间距离："+(n/1e3).toFixed(2)+"km",i(this.primitives,e,o,this.count),this.count++,this.callback(t,r,n,this._array_)},e.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",r("result_labelHeight",this.primitives),r("draw_label",this.primitives),r("draw_polyline",this.primitives),r("draw_point",this.primitives)}}(window.Cesium),function(t){"use strict";t.Map=function(e,i){if((i=i||{}).baseLayerPicker=t.defaultValue(i.baseLayerPicker,!1),i.timeline=t.defaultValue(i.timeline,!1),i.animation=t.defaultValue(i.animation,!1),i.homeButton=t.defaultValue(i.homeButton,!1),i.navigationHelpButton=t.defaultValue(i.navigationHelpButton,!1),i.orderIndependentTranslucency=t.defaultValue(i.orderIndependentTranslucency,!0),i.sceneMode=t.defaultValue(i.sceneMode,t.SceneMode.SCENE3D),i.scene3DOnly=t.defaultValue(i.scene3DOnly,!0),i.maxLevel=t.defaultValue(i.maxLevel,25),i.geocoder=t.defaultValue(i.geocoder,!1),i.fullscreenButton=t.defaultValue(i.fullscreenButton,!1),!t.defined(i.imageryProvider)){var r=function(){for(var t="",e=new RegExp("(^|(.*?\\/))(Cesium.js)(\\?|$)"),i=document.getElementsByTagName("script"),r=0,o=i.length;r<o;r++){var n=i[r].getAttribute("src");if(n){var a=n.match(e);if(a){t=a[1];break}}}return t}(),o=new t.SingleTileImageryProvider({url:r+"Assets/Images/Earth.jpg",rectangle:t.Rectangle.fromDegrees(-180,-90,180,90)});i.imageryProvider=o}return new t.Viewer(e,i)}}(window.Cesium),function(t){"use strict";var e=t.defaultValue,i=t.GeoClipping=function(i,r){i=e(i,t.defaultValue.EMPTY_OBJECT),this.steps=e(i.steps,64),this.edgeWidth=e(i.edgeWidth,2),this.edgeColor=e(i.edgeColor,t.Color.WHITE),this.cylinderRadius=e(i.cylinderRadius,50),this.clippingModeUnion=e(i.clippingModeUnion,!0),this.enabled=e(i.enabled,!0),this.clippingPlanes=void 0,this.modelEntityClippingPlanes=void 0};i.prototype.computePlanes=function(e){e=t.defined(e)?e:this.steps;for(var i=t.Math.TWO_PI/e,r=[],o=0;o<e;o++){var n=o*i,a=new t.Cartesian3;a.x=1,a.y=Math.tan(n),n>t.Math.PI_OVER_TWO&&(a.x=-1,a.y*=-1),n>t.Math.PI&&(a.x=-1),n>3*t.Math.PI_OVER_TWO&&(a.x=1,a.y=-a.y),t.Cartesian3.normalize(a,a);var s=new t.ClippingPlane(a,this.cylinderRadius);r.push(s)}return this.clippingPlanes=r,r},i.prototype.createClippingPlanes=function(e,i){for(var r=new t.ClippingPlaneCollection({modelMatrix:t.defined(e)?e:t.Matrix4.IDENTITY,edgeWidth:this.edgeWidth,edgeColor:this.edgeColor,unionClippingRegions:this.clippingModeUnion,enabled:this.enabled}),o=this.computePlanes(i),n=0;n<o.length;n++)r.add(o[n]);return this.modelEntityClippingPlanes=r,r}}(window.Cesium),function(t){"use strict";var e=t.GeoFlood=function(t,e){this.viewer=t.viewer,this.scene=this.viewer.scene,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.cartesianArrayHeights=null,this.fragmentShader=null,this.normalMapUrl=null,this.geometry=null,this.appearance=null,this.callback=e||null};e.prototype.createWaterFace=function(t,e,i){return this.primitive?(this.clear(),this.primitive=this.creatPrimitive(t,e,i)):this.primitive=this.creatPrimitive(t,e,i),this.primitive},e.prototype.creatPrimitive=function(e,i,r){var o,n,a,s;if(e&&i&&!(i&&i.length<3))return this.fragmentShader="varying vec3 v_positionMC;\n\t\t\t\t\tvarying vec3 v_positionEC;\n\t\t\t\t\tvarying vec2 v_st;\n\t\t\t\t\t\n\t\t\t\t\tvoid main()\n\t\t\t\t\t{\n\t\t\t\t\t\tczm_materialInput materialInput;\n\t\t\t\t\t\tvec3 normalEC = normalize(czm_normal3D * czm_geodeticSurfaceNormal(v_positionMC, vec3(0.0), vec3(1.0)));\n\t\t\t\t\t#ifdef FACE_FORWARD\n\t\t\t\t\t\tnormalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n\t\t\t\t\t#endif\n\t\t\t\t\t\tmaterialInput.s = v_st.s;\n\t\t\t\t\t\tmaterialInput.st = v_st;\n\t\t\t\t\t\tmaterialInput.str = vec3(v_st, 0.0);\n\t\t\t\t\t\tmaterialInput.normalEC = normalEC;\n\t\t\t\t\t\tmaterialInput.tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(v_positionMC, materialInput.normalEC);\n\t\t\t\t\t\tvec3 positionToEyeEC = -v_positionEC;\n\t\t\t\t\t\tmaterialInput.positionToEyeEC = positionToEyeEC;\n\t\t\t\t\t\tczm_material material = czm_getMaterial(materialInput);\n\t\t\t\t\t#ifdef FLAT\n\t\t\t\t\t\tgl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n\t\t\t\t\t#else\n\t\t\t\t\t\tgl_FragColor = czm_phong(normalize(positionToEyeEC), material);\n\t\t\t\t\t\tgl_FragColor.a = 1.0;\n\t\t\t\t\t#endif\n\t\t\t\t\t}\n\t\t\t\t\t",this.normalMapUrl=e,this.geometry=(o=i,n=r,new t.PolygonGeometry({polygonHierarchy:new t.PolygonHierarchy(t.Cartesian3.fromDegreesArrayHeights(o)),extrudedHeight:n||0,perPositionHeight:!1,closeTop:!0,closeBottom:!0,vertexFormat:t.EllipsoidSurfaceAppearance.VERTEXT_FORMAT})),this.appearance||(this.appearance=(a=this.fragmentShader,s=this.normalMapUrl,new t.EllipsoidSurfaceAppearance({material:new t.Material({translucent:!1,fabric:{type:"Water",uniforms:{normalMap:s,frequency:90,animationSpeed:.03,amplitude:90,specularIntensity:5}}}),fragmentShaderSource:a}))),this.primitives.add(new t.Primitive({allowPicking:!0,geometryInstances:new t.GeometryInstance({geometry:this.geometry,id:"GEOFlood_ID"}),vertexCacheOptimize:!0,appearance:this.appearance,interleave:!0,asynchronous:!1,cull:!1,releaseGeometryInstances:!0,show:!0}))},e.prototype.clear=function(){this.canvas.style.cursor="default",this.primitive&&this.primitives.remove(this.primitive)},e.prototype.clearPrimitive=function(t){t&&this.primitives.remove(t)},e.prototype.destroy=function(){this.clear(),this.viewer=void 0,this.scene=void 0,this.canvas=void 0,this.primitives=void 0,this.callback=void 0}}(window.Cesium),function(t){"use strict";var e=t.defaultValue,i=t.GeoLimitHeight=function(i,r){i=e(i,t.defaultValue.EMPTY_OBJECT),this.viewer=i.viewer,this.scene=this.viewer.scene,this.entities=this.viewer.entities};i.prototype.analysis=function(i){i=e(i,t.defaultValue.EMPTY_OBJECT),this.targetHeight=e(i.targetHeight,0);var r=i.labelOption,o=i.polygonPlaneOption,n=i.polygonFitOption;r&&this.drawLabel(r),o&&this.drawPolygonPlane(o),n&&this.drawPolygonFit(n)},i.prototype.drawLabel=function(i){return this.clearLabelEntity(),i=e(i,t.defaultValue.EMPTY_OBJECT),this.labelEntity=this.entities.add({position:e(i.labelPosition,new t.Cartesian2(0,0,0)),label:{text:e(i.labelText,""),pixelOffset:e(i.labelPixelOffset,new t.Cartesian2(0,-60)),fillColor:e(i.labelFillColor,new t.Color(0,0,1,1)),font:e(i.labelFont,"18px 楷体"),outlineColor:e(i.labelOutlineColor,new t.Color(0,0,1,1)),outlineWidth:e(i.labelOutlineWidth,1.8),style:t.defaultValue(i.labelStyle,t.LabelStyle.FILL_AND_OUTLINE),show:e(i.labelShow,!0),disableDepthTestDistance:Number.POSITIVE_INFINITY}}),!0},i.prototype.drawPolygonPlane=function(i){return this.clearPolygonPlaneEntity(),i=e(i,t.defaultValue.EMPTY_OBJECT),this.polygonPlaneEntity=this.entities.add({polygon:{hierarchy:e(i.polygonPlaneHierarchy,new t.Cartesian3(0,0,0)),perPositionHeight:e(i.polygonPlanePerPositionHeight,!1),height:e(i.polygonPlaneHeight,this.targetHeight),material:e(i.polygonPlaneMaterial,t.Color.YELLOW.withAlpha(.3)),outline:e(i.polygonPlaneOutline,!0),outlineColor:e(i.polygonPlaneOutlineColor,t.Color.WHITE),show:e(i.polygonPlaneShow,!0)}}),!0},i.prototype.drawPolygonFit=function(i){this.clearPolygonFitPrimitive();var r=(i=e(i,t.defaultValue.EMPTY_OBJECT)).polygonFitPositions;if(!r||0==r.length)return console.error("请输入有效的坐标数组！"),!1;var o,n,a,s,l=e(i.polygonFitHeight,this.targetHeight),g=e(i.polygonFitExtrudedHeight,1e4),h=e(i.polygonFitColor,new t.Color(1,0,0,.5)),c=(o=r,n=l,a=g,s=h,new t.GeometryInstance({geometry:new t.PolygonGeometry({polygonHierarchy:new t.PolygonHierarchy(t.Cartesian3.fromDegreesArray(o)),height:n,extrudedHeight:a}),attributes:{color:t.ColorGeometryInstanceAttribute.fromColor(s)}})),C=new t.PerInstanceColorAppearance({flat:!0}),d=new t.ClassificationPrimitive({geometryInstances:[c],appearance:C,classificationType:t.ClassificationType.CESIUM_3D_TILE});return this.polygonFitPrimitive=this.scene.primitives.add(d),!0},i.prototype.clearLabelEntity=function(){this.labelEntity&&this.entities.contains(this.labelEntity)&&(this.entities.remove(this.labelEntity),this.labelEntity=void 0)},i.prototype.clearPolygonPlaneEntity=function(){this.polygonPlaneEntity&&this.entities.contains(this.polygonPlaneEntity)&&(this.entities.remove(this.polygonPlaneEntity),this.polygonPlaneEntity=void 0)},i.prototype.clearPolygonFitPrimitive=function(){this.polygonFitPrimitive&&this.scene.primitives.contains(this.polygonFitPrimitive)&&(this.scene.primitives.remove(this.polygonFitPrimitive),this.polygonFitPrimitive=void 0)},i.prototype.clearAll=function(){this.clearLabelEntity(),this.clearPolygonPlaneEntity(),this.clearPolygonFitPrimitive()}}(window.Cesium),function(t){"use strict";var e="GeoPLSViewShed3D_TIP",i="GeoPLSViewShed3D_LIGHTPOINT",r="GeoPLSViewShed3D_BOUNDARY",o="GeoPLSViewShed3D_DASHLINE",n="GeoPLSViewShed3D_DSP",a="GeoPLSViewShed3D_ORIENTLINE",s=t.GeoPLSViewShed3D=function(e,i){this.viewer=e.viewer,this.scene=this.viewer.scene,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.groundPrimitives=this.scene.groundPrimitives,this.callback=i||null,this._pointLightHeight=t.defaultValue(e.pointLightHeight,.2),this._pointLightPixelSize=t.defaultValue(e.pointLightPixelSize,5),this._pointLightColor=t.defaultValue(e.pointLightColor,t.Color.YELLOW),this._boundaryWidth=t.defaultValue(e.boundaryWidth,4),this._boundaryColor=t.defaultValue(e.boundaryColor,t.Color.YELLOW),this._orientLineWidth=t.defaultValue(e.orientLineWidth,8),this._orientLineColor=t.defaultValue(e.orientLineColor,new t.Color(1,1,0,.5)),this._baseDEMLerpCfg=t.defaultValue(e.baseDEMLerpCfg,{}),this._intervalAnalysis=t.defaultValue(e.intervalAnalysis,!0),parseFloat(t.VERSION)<1.5&&console.error("当前Cesium版本："+t.VERSION+",点光源可视域分析暂不支持该版本，请更换至1.50以上的版本!")};function l(e,i,r,o,n,a){for(var s=[],l=[],g=parseInt(e.realTimeRadius/r),h=0;h<g;h++){var C={longitude:i[0],latitude:i[1],height:i[2]},d={longitude:i[3],latitude:i[4],height:i[5]},u=t.Math.lerp(C.longitude,d.longitude,1/g*(h+1)),p=t.Math.lerp(C.latitude,d.latitude,1/g*(h+1)),A={longitude:u,latitude:p},I=e.scene.globe.getHeight(A),m=t.Cartesian3.fromRadians(u,p,I);s.push(m);var f={longitude:i[0],latitude:i[1],height:I},v=t.Cartographic.toCartesian(f),y=t.Cartesian3.distance(v,m),_=(I-i[2])/y;l.push(_)}for(var w=[],P=[],b=[],E=[0],T=0;T<l.length-1;T++)w.length||l[T+1]<l[T]&&(w.push(l[T]),P.push(T)),w.length&&(l[T]>w[w.length-1]&&l[T+1]<l[T]&&(w.push(l[T]),P.push(T)),l[T]>w[w.length-1]&&l[T-1]<w[w.length-1]&&(b.push(l[T]),E.push(T)));P.push(l.length-1);var M=P.concat(E);M.sort(function(t,e){return t-e});for(var x=[],S=0;S<M.length-1;S++){var L=[s[M[S]],s[M[S+1]]];x=S%2==0?x.concat(c(L,a,o,!0)):x.concat(c(L,a,n,!0))}return x}function g(e,i,r){var o=e.scene.pickPosition(i);if(o){var n=t.Cartographic.fromCartesian(o);if(n.height<0){e.scene.globe.depthTestAgainstTerrain=!0,e.viewer.terrainShadows=t.ShadowMode.ENABLED;var a=e.scene.camera.getPickRay(i),s=e.scene.globe.pick(a,e.scene);n=t.Cartographic.fromCartesian(s)}r=r||0;var l=t.Cartesian3.fromRadians(n.longitude,n.latitude,n.height+r),g=t.Cartographic.fromCartesian(l);return[t.Math.toDegrees(g.longitude),t.Math.toDegrees(g.latitude),g.height]}}function h(e,i,r,o){var n=e.add(new t.LabelCollection);return n.add({text:i,font:"16px sans-serif",showBackground:!0,position:r,pixelOffset:new t.Cartesian2(10,-30),style:t.LabelStyle.FILL_AND_OUTLINE}),n.name=o,n}function c(e,i,r,o){var n=[],a=o?e:t.Cartesian3.fromDegreesArray(e),s=new t.GeometryInstance({geometry:new t.GroundPolylineGeometry({positions:a,width:i}),attributes:{color:t.ColorGeometryInstanceAttribute.fromColor(r)}});return n.push(s),n}function C(e,i,r){var o=e.add(new t.GroundPolylinePrimitive({geometryInstances:i,appearance:new t.PolylineColorAppearance({translucent:!0})}));return o.name=r,o}function d(t,e,i){for(var r=0;r<t.length;r++)t.name==i&&(e.position&&(t.get(r).position=e.position),e.text&&(t.get(r).text=e.text),void 0!==e.showBackground&&(t.get(r).showBackground=e.showBackground),e.backgroundColor&&(t.get(r).backgroundColor=e.backgroundColor),void 0!==e.horizontalOrigin&&(t.get(r).horizontalOrigin=e.horizontalOrigin),void 0!==e.verticalOrigin&&(t.get(r).verticalOrigin=e.verticalOrigin),e.pixelOffset&&(t.get(r).pixelOffset=e.pixelOffset),e.fillColor&&(t.get(r).fillColor=e.fillColor),e.outlineWidth&&(t.get(r).outlineWidth=e.outlineWidth),e.outlineColor&&(t.get(r).outlineColor=e.outlineColor))}function u(t,e){for(var i=0;i<e.length;i++)e.get(i).name==t&&(e.remove(e.get(i)),i--)}s.prototype.activate=function(){this.clear(),this.canvas.style.cursor="crosshair";var s=null,p=null,A=null,I=null,m=!0,f=null,v=null,y=this;this.handler=new t.ScreenSpaceEventHandler(this.canvas),this.handler.setInputAction(function(o){if(m){f=g(y,o.position,y._pointLightHeight),v=t.Cartesian3.fromDegrees(f[0],f[1],f[2]),u(e,y.primitives),m=!1,y.firstLeftClick=m,s=null,u(i,y.primitives);var n=y.primitives.add(new t.PointPrimitiveCollection);n.name=i,n.add({position:v,color:y._pointLightColor,pixelSize:y._pointLightPixelSize})}else if(y.scene.globe.depthTestAgainstTerrain=!1,y.scene.shadowMap.enableGeoPLSViewShed3D=!0,y.canvas.style.cursor="default",y.handler&&!y.handler.isDestroyed()&&y.handler.destroy(),u(e,y.primitives),m=!0,y.firstLeftClick=m,s=null,y._baseDEMLerpCfg.enable)if(y._intervalAnalysis)y.angleInterval=t.defaultValue(y._baseDEMLerpCfg.angleInterval,1),y.timeInterval=t.defaultValue(y._baseDEMLerpCfg.timeInterval,100),y.num=0,setTimeout(function(){!function e(i){if(i.num%(2*i.angleInterval)==0){var o={longitude:i.boundaryPositionArr[i.num],latitude:i.boundaryPositionArr[i.num+1]},n=i.scene.globe.getHeight(o),a=[i.startPointLng,i.startPointLat,i.startPointHgt,o.longitude,o.latitude,n],s=t.defaultValue(i._baseDEMLerpCfg.interpolationBase,10),g=t.defaultValue(i._baseDEMLerpCfg.visibleColor,new t.Color(0,1,0,.8)),h=t.defaultValue(i._baseDEMLerpCfg.invisibleColor,new t.Color(1,0,0,.8)),c=t.defaultValue(i._baseDEMLerpCfg.lineWidth,5),d=l(i,a,s,g,h,c);C(i.scene.groundPrimitives,d,r)}i.num+=2*i.angleInterval;i.num<720&&setTimeout(function(){e(i)},i.timeInterval)}(y)},y.timeInterval);else{for(var a=[],h=0;h<y.boundaryPositionArr.length;h++)if(h%2==0){var c={longitude:y.boundaryPositionArr[h],latitude:y.boundaryPositionArr[h+1]},d=y.scene.globe.getHeight(c),p=[y.startPointLng,y.startPointLat,y.startPointHgt,c.longitude,c.latitude,d],A=t.defaultValue(y._baseDEMLerpCfg.interpolationBase,10),I=t.defaultValue(y._baseDEMLerpCfg.visibleColor,new t.Color(0,1,0,.8)),_=t.defaultValue(y._baseDEMLerpCfg.invisibleColor,new t.Color(1,0,0,.8)),w=t.defaultValue(y._baseDEMLerpCfg.lineWidth,5);l(y,p,A,I,_,w),a=a.concat(radiusLineInstance)}C(y.scene.groundPrimitives,a,r)}},t.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(i){var l,f,_,w,P,b,E,T,M,x,S,L;if((y.tipPosition=y.scene.pickPosition(i.endPosition),y.tipPosition)&&(m&&(s?d(s,{position:y.tipPosition},e):s=h(y.primitives,"单击左键确定可视域位置",y.tipPosition,e)),!m)){s?d(s,{position:y.tipPosition},e):s=h(y.primitives,"单击左键固定可视域半径",y.tipPosition,e);var R=g(y,i.endPosition),D=t.Cartesian3.fromDegrees(R[0],R[1],R[2]);if(I=t.Cartesian3.distance(v,D),u(r,y.groundPrimitives),u(a,y.groundPrimitives),I){var k=t.Math.toDegrees(t.Cartographic.fromCartesian(v).longitude),O=t.Math.toDegrees(t.Cartographic.fromCartesian(v).latitude),F=t.Cartographic.fromCartesian(v).height,H=function(t,e,i){for(var r=[],o=0;o<=360;o++){var n=i*Math.sin(o*Math.PI/180),a=i*Math.cos(o*Math.PI/180),s=6356725+21412*(90-e)/90,l=s*Math.cos(e*Math.PI/180),g=t+n/l*180/Math.PI,h=e+a/s*180/Math.PI;r.push(g),r.push(h)}return r}(k,O,I),B=c(H,y._boundaryWidth,y._boundaryColor),N=(C(y.groundPrimitives,B,r),[k,O,H[0],H[1]]),G=(b=y.groundPrimitives,E=N,T=y._orientLineWidth,M=y._orientLineColor,x=a,S=new t.GeometryInstance({geometry:new t.GroundPolylineGeometry({positions:t.Cartesian3.fromDegreesArray(E),width:T})}),(L=b.add(new t.GroundPolylinePrimitive({geometryInstances:S,appearance:new t.PolylineMaterialAppearance({material:new t.Material({fabric:{type:"PolylineArrow",uniforms:{color:M}}})})}))).name=x,[k,O,F,k,O,F+I/3]),W=t.Color.fromAlpha(t.Color.YELLOW,.7);A?A.polyline.positions=t.Cartesian3.fromDegreesArrayHeights(G):(l=y.viewer.entities,f=G,_=2,w=W,P=o,A=l.add({name:P,polyline:{positions:t.Cartesian3.fromDegreesArrayHeights(f),width:_,material:new t.PolylineDashMaterialProperty({color:w,dashLength:5})}}));var U=t.Cartesian3.fromDegrees(k,O,F+I/3),V="视高："+y._pointLightHeight.toFixed(2)+"米\n半径："+I.toFixed(4)+"米\n经度："+k.toFixed(6)+"度\n纬度："+O.toFixed(6)+"度",z={position:U,text:V,showBackground:!0,backgroundColor:t.Color.fromAlpha(t.Color.WHITE,.8),horizontalOrigin:t.HorizontalOrigin.CENTER,verticalOrigin:t.VerticalOrigin.BOTTOM,pixelOffset:new t.Cartesian2(0,0),fillColor:t.Color.BLACK};if(d(p||(p=h(y.primitives,V,U,n)),z,n),y._baseDEMLerpCfg.enable||y.dynamicAnalysis(v,I),y.pointLightPosition=v,y.realTimeRadius=I,y.firstLeftClick=m,y._baseDEMLerpCfg.enable){y.startPointLng=t.Math.toRadians(k),y.startPointLat=t.Math.toRadians(O),y.startPointHgt=F,y.boundaryPositionArr=[];for(var Z=0;Z<H.length;Z++)y.boundaryPositionArr.push(t.Math.toRadians(H[Z]));y.realTimeRadius=I}}}},t.ScreenSpaceEventType.MOUSE_MOVE)},s.prototype.dynamicAnalysis=function(e,i){if(e&&i){var r,o=new t.Camera(this.scene);o.position=e,r={context:this.scene.context,lightCamera:o,isPointLight:!0},this.scene.shadowMap.destroy(),this.scene.shadowMap=new t.ShadowMap(r);var n=this.scene.shadowMap;n.size=1024,n._pointLightRadius=i,n._terrainBias.depthBias=0,n.enabled=!0,n.enableGeoPLSViewShed3D=!0}},s.prototype.clear=function(){this._baseDEMLerpCfg.enable&&(this.num=721),this.scene.globe.depthTestAgainstTerrain=!1,this.scene.shadowMap.enabled=!1,this.scene.shadowMap.enableGeoPLSViewShed3D=void 0,this.canvas.style.cursor="default",this.handler&&!this.handler.isDestroyed()&&this.handler.destroy(),u(e,this.primitives),u(n,this.primitives),u(i,this.primitives),u(r,this.groundPrimitives),u(a,this.groundPrimitives),function(t,e){for(var i=0;i<e.values.length;i++)e.values[i].name==t&&(e.remove(e.values[i]),i--)}(o,this.viewer.entities)},s.prototype.destroy=function(){this.clear(),this.viewer=void 0,this._pointLightHeight=void 0,this.scene=void 0,this.canvas=void 0,this.primitives=void 0,this.callback=void 0}}(window.Cesium),function(t){"use strict";var e=t.GeoProfile=function(t,e){this.viewer=t.viewer,this.scene=this.viewer.scene};e.prototype.getLerpValue=function(e,i){this.lng_origin=e[0],this.lat_origin=e[1],this.hgt_origin=e[2],this.lng_destination=e[e.length-3],this.lat_destination=e[e.length-2],this.hgt_destination=e[e.length-1];for(var r=[],o=0;o<e.length-3;o+=3){var n=t.Cartesian3.fromDegrees(e[o],e[o+1]),a=t.Cartesian3.fromDegrees(e[o+3],e[o+4]),s=t.Cartesian3.distance(n,a);r.push(s),t.Cartesian3.distance(n,a)}for(var l=0,g=[],h=0;h<r.length;h++){var c=Math.floor(r[h]/i);g.push(c),l+=c}this.samplingNum=l;var C=[],d=[];for(o=0;o<g.length;o++){for(var u=0;u<=g[o];u++){var p=u*i;if(r[o]-p<=i)C.push(1);else{var A=p/r[o];C.push(A)}}d.push(C),C=[]}for(var I=[],m=[],f=[],v=[],y=(o=0,0);y<d.length;y++){for(u=0;u<d[y].length;u++){var _=t.Math.lerp(e[o],e[o+3],d[y][u]),w=t.Math.lerp(e[o+1],e[o+4],d[y][u]),P={longitude:t.Math.toRadians(_),latitude:t.Math.toRadians(w)},b=Number(this.scene.globe.getHeight(P).toFixed(2));f.push(b),I.push(t.Cartesian3.fromDegrees(_,w,b)),m.push(t.Cartesian3.fromDegrees(_,w,0))}o+=3}var E=Math.min.apply(null,f);this.minHeight=E;var T=Math.max.apply(null,f);this.maxHeight=T;var M=0;for(o=0;o<I.length-1;o++)M+=t.Cartesian3.distance(I[o],I[o+1]);this.surfaceLen=M;var x=t.Cartesian3.distance(I[0],I[I.length-1]);this.straightLen=x;var S=0;for(y=0;y<m.length-1;y++)S+=t.Cartesian3.distance(m[y],m[y+1]),v.push(S.toFixed(2));v.unshift(0);var L={};return L.YValueArray=f,L.addLenArray=v,L.lerpCoordnatesArray=I,L},e.prototype.drawChart=function(t,e){var i=document.getElementById(e);i.onmousedown=function(t){var e=t||event,r=e.clientX-i.offsetLeft,o=e.clientY-i.offsetTop;document.onmousemove=function(t){var e=t||event;i.style.left=e.clientX-r+"px",i.style.top=e.clientY-o+"px"},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null}};var r=echarts.init(i),o={title:{x:"center",padding:15,text:"剖面示意图",textStyle:{color:"#ccc",fontStyle:"normal",fontWeight:"bold",fontFamily:"sans-serif",fontSize:18}},tooltip:{trigger:"axis",confine:!0,formatter:function(t){return"长度: "+t[0].name+"<br />高程: "+t[0].value}},grid:{left:"2%",right:"12%",bottom:"3%",containLabel:!0},xAxis:{splitArea:{show:!1},splitLine:{show:!1,lineStyle:{color:["#aaa"],width:1,type:"solid"}},type:"category",boundaryGap:!1,data:t.addLenArray,name:"长度(米)",nameTextStyle:{color:"#ccc",fontWeight:"bolder"},axisLine:{lineStyle:{color:"rgba(0.0, 128, 255, 0.6)",width:4}},axisLabel:{color:"#ccc",fontWeight:"bolder"}},yAxis:{splitArea:{show:!1},splitLine:{show:!0,lineStyle:{color:["#aaa"],width:1,type:"dashed"}},type:"value",name:"高程(米)",nameTextStyle:{color:"#ccc",fontWeight:"bolder"},axisLine:{lineStyle:{color:"rgba(0.0, 128, 255, 0.6)",width:4}},axisLabel:{color:"#ccc",fontWeight:"bolder"}},series:[{type:"line",data:t.YValueArray,areaStyle:{color:"rgba(0.0,255.0,255.0,0.8)"}}]};r.setOption(o);var n=document.createElement("table"),a=document.createElement("tbody"),s=document.createElement("tr"),l=document.createElement("td");l.innerHTML="起点经度："+this.lng_origin.toFixed(6),s.appendChild(l);var g=document.createElement("td");g.innerHTML="起点高程："+t.YValueArray[0].toFixed(2),s.appendChild(g);var h=document.createElement("td");h.innerHTML="投影距离："+Number(t.addLenArray[t.addLenArray.length-1]).toFixed(2),s.appendChild(h),a.appendChild(s);var c=document.createElement("tr"),C=document.createElement("td");C.innerHTML="起点纬度："+this.lat_origin.toFixed(6),c.appendChild(C);var d=document.createElement("td");d.innerHTML="终点高程："+t.YValueArray[t.YValueArray.length-1].toFixed(2),c.appendChild(d);var u=document.createElement("td");u.innerHTML="地表距离："+this.surfaceLen.toFixed(2),c.appendChild(u),a.appendChild(c);var p=document.createElement("tr"),A=document.createElement("td");A.innerHTML="终点经度："+this.lng_destination.toFixed(6),p.appendChild(A);var I=document.createElement("td");I.innerHTML="最高高程："+this.maxHeight,p.appendChild(I);var m=document.createElement("td");m.innerHTML="直线距离："+this.straightLen.toFixed(2),p.appendChild(m),a.appendChild(p);var f=document.createElement("tr"),v=document.createElement("td");v.innerHTML="终点纬度："+this.lat_destination.toFixed(6),f.appendChild(v);var y=document.createElement("td");y.innerHTML="最低高程："+this.minHeight,f.appendChild(y);var _=document.createElement("td");return _.innerHTML="采样点数："+this.samplingNum,f.appendChild(_),a.appendChild(f),n.appendChild(a),i.appendChild(n),this.oTable=n,this.chartContainer=i,this.myChart=r,r},e.prototype.drawMark=function(e){e=t.defaultValue(e,{});var i=this.scene.primitives.add(new t.BillboardCollection);i.add({position:e.originCoordanate,image:e.originImage,verticalOrigin:t.VerticalOrigin.BOTTOM,scale:.2}),i.add({position:e.destinationCoordanate,image:e.destinationImage,verticalOrigin:t.VerticalOrigin.BOTTOM,scale:.2}),i.name="GeoProfile"},e.prototype.clearMark=function(){for(var t=0;t<this.scene.primitives.length;t++)"GeoProfile"==this.scene.primitives.get(t).name&&(this.scene.primitives.remove(this.scene.primitives.get(t)),t--)},e.prototype.clearChart=function(){this.myChart&&(this.myChart.clear(),this.myChart=null),this.oTable&&this.chartContainer&&this.chartContainer.removeChild(this.oTable)},e.prototype.clear=function(){this.clearChart(),this.clearMark()}}(window.Cesium),function(t){"use strict";var e="GEOSIGHTLINE_TIP",i="GEOSIGHTLINEBILLBOARD",r=t.GeoSightline=function(e,i){this.viewer=e.viewer,this.observeRelativeHeight=e.observeRelativeHeight,this.targetRelativeHeight=e.targetRelativeHeight,this.observeImage=e.observeImage,this.targetImage=e.targetImage,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.entities=this.viewer.entities,this.callback=i||null,this.objectsToExclude=[],this.observeActualPosition=null,this.targetActualPosition=null,this.observeEntity=null,this.targetEntity=null,parseFloat(t.VERSION)<1.5&&console.error("当前Cesium版本："+t.VERSION+",通视分析暂不支持该版本，请更换至1.50以上的版本!")};function o(e,i,r){if(e.scene){var o=e.scene.pickPosition(i);if(parseFloat(t.VERSION)>=1.58){var n=viewer.scene.clampToHeight(o);n&&(o=n)}var a,s=t.Cartographic.fromCartesian(o);if(s.height<0){var l=e.camera.getPickRay(i),g=e.scene.globe.pick(l,e.scene);s=t.Cartographic.fromCartesian(g),e.scene.globe.depthTestAgainstTerrain=!0}return r=r||1,a=s.height+r,t.Cartesian3.fromRadians(s.longitude,s.latitude,a)}}function n(e,i,r,o){var n=e.add(new t.LabelCollection);return n.add({text:i,font:"16px sans-serif",showBackground:!0,position:r,pixelOffset:new t.Cartesian2(10,-10)}),n.name=o,n}function a(t,e,i){for(var r=0;r<t.length;r++)t.name==i&&(t.get(r).position=e)}function s(t,e){g(t,e)}function l(e,r,o){var n=e.add(new t.BillboardCollection);return n.add({position:r,image:o,scale:.4,verticalOrigin:t.VerticalOrigin.MIDDLE}),n.name=i,n}function g(t,e){for(var i=0;i<e.length;i++)e.get(i).name==t&&(e.remove(e.get(i)),i--)}function h(t,e){for(var i=0;i<e._entities._array.length;i++)e._entities._array[i].name==t&&(e.remove(e._entities._array[i]),i--)}r.prototype.activate=function(){this.scene.globe.depthTestAgainstTerrain=!1,this.destroyHandler(),this.clear(),1.52==parseFloat(t.VERSION)&&(this.scene.enableGeoSightline=!0),parseFloat(t.VERSION)>=1.58&&(this.scene.enableGeoSightline=!1),this.canvas.style.cursor="crosshair";var i=null,r=!0,g=this;this.handler=new t.ScreenSpaceEventHandler(this.canvas),this.handler.setInputAction(function(t){r?(g.clear(),g.observeActualPosition=o(g,t.position,g.observeRelativeHeight),l(g.primitives,g.observeActualPosition,g.observeImage),s(e,g.primitives),i=null,r=!1):(g.targetActualPosition=o(g,t.position,g.targetRelativeHeight),l(g.primitives,g.targetActualPosition,g.targetImage),g.pickFromRays(),s(e,g.primitives),i=null,r=!0,g.scene.enableGeoSightline=!1,g.destroyHandler())},t.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(t){g.tipPosition=g.scene.pickPosition(t.endPosition),g.tipPosition&&(r&&(i?a(i,g.tipPosition,e):i=n(g.primitives,"单击左键确定观察点",g.tipPosition,e)),r||(i?a(i,g.tipPosition,e):i=n(g.primitives,"单击左键确定目标点",g.tipPosition,e)))},t.ScreenSpaceEventType.MOUSE_MOVE)},r.prototype.pickFromRays=function(){var e=new t.Cartesian3(0,0,0);this.objectsToExclude=[this.observeEntity,this.targetEntity];var i=t.Cartesian3.normalize(t.Cartesian3.subtract(this.targetActualPosition,this.observeActualPosition,new t.Cartesian3),new t.Cartesian3),r=new t.Ray(this.observeActualPosition,i),o=[],n=[];o=this.scene.drillPickFromRay(r,1e3,this.objectsToExclude);var a=t.Cartesian3.distance(this.observeActualPosition,this.targetActualPosition);if(0!==o.length&&!o[0].position)for(var s=1;s<Math.floor(a)+1;s++)if(t.Cartesian3.lerp(this.observeActualPosition,this.targetActualPosition,s*(1/Math.floor(a)),e),i=t.Cartesian3.normalize(t.Cartesian3.subtract(this.targetActualPosition,this.observeActualPosition,new t.Cartesian3),new t.Cartesian3),r=new t.Ray(e,i),o=[],n=[],[],null,(o=this.scene.drillPickFromRay(r,1,this.objectsToExclude)).length>0){o[0].position||(t.Cartesian3.lerp(this.observeActualPosition,this.targetActualPosition,s*(1/Math.floor(a)),e),o[0].position=e);break}if(0==o.length)n=[this.observeActualPosition,this.targetActualPosition];else{var l=t.Cartesian3.normalize(t.Cartesian3.subtract(o[0].position,this.observeActualPosition,new t.Cartesian3),new t.Cartesian3),g=t.Cartesian3.normalize(t.Cartesian3.subtract(o[0].position,this.targetActualPosition,new t.Cartesian3),new t.Cartesian3);if(l.x.toFixed(8)==g.x.toFixed(8)&&l.y.toFixed(8)==g.y.toFixed(8)&&l.z.toFixed(8)==g.z.toFixed(8))n=[this.targetActualPosition,this.observeActualPosition];else{n=[this.observeActualPosition,o[0].position];var h={name:"REDLINE",polyline:{positions:[o[0].position,this.targetActualPosition],width:7,followSurface:!1,material:new t.PolylineArrowMaterialProperty(t.Color.RED)}};this.entities.add(h)}}var c={name:"GREENLINE",polyline:{positions:n,width:2,followSurface:!1,material:t.Color.GREEN}};this.entities.add(c)},r.prototype.clear=function(){this.primitives&&(g(e,this.primitives),g(i,this.primitives)),this.entities&&(h("REDLINE",this.entities),h("GREENLINE",this.entities))},r.prototype.destroyHandler=function(){this.handler=this.handler&&this.handler.destroy(),this.canvas.style.cursor="default"},r.prototype.destroy=function(){this.scene.enableGeoSightline=!1,this.scene.globe.depthTestAgainstTerrain=!1,this.destroyHandler(),this.clear(),this.viewer=void 0,this.observeRelativeHeight=void 0,this.targetRelativeHeight=void 0,this.scene=void 0,this.camera=void 0,this.canvas=void 0,this.primitives=void 0,this.entities=void 0,this.ellipsoid=void 0,this.callback=void 0,this.objectsToExclude=void 0,this.observeEntity=null,this.targetEntity=null}}(window.Cesium),function(t){"use strict";var e=t.defaultValue,i=t.GeoSkyLine=function(i,r){this.viewer=i.viewer,this.scene=this.viewer.scene,this.canvas=this.viewer.canvas,this.entities=this.viewer.entities,this.skyLineShow=e(i.skylineShow,!0),this.skyLineWidth=e(i.skyLineWidth,2),this.skyLineMaterial=e(i.skyLineMaterial,t.Color.RED.clone()),this.skyLineDepthFailMaterial=e(i.skyLineDepthFailMaterial,void 0),this.skyLineVolumeMaterial=e(i.skyLineVolumeMaterial,t.Color.ORANGE.clone()),this.skyLineVolumeOutLine=e(i.skyLineVolumeOutLine,!1),this.skyLineVolumeOutLineColor=e(i.skyLineVolumeOutLineColor,t.Color.BLACK.clone()),this.extrudeRatio=e(i.extrudeRatio,1.2)};i.prototype.calculateSkyLinePositions=function(){if(!this.skyLine){var e=[],i={};i.addLenArray=[],i.YValueArray=[];for(var r=this.canvas.width,o=this.canvas.height,n=50,a=[],s=0;s<r;s+=parseInt(r/3))for(var l=0;l<o;l++){var g=new t.Cartesian2(s,l);if(this.scene.pickPosition(g)){a.push(l);break}}Math.max.apply(null,a)<10&&(n=1);for(var h=0;h<r;h+=3)for(var c=0;c<o;c+=n){var C=new t.Cartesian2(h,c);if(this.scene.pickPosition(C))for(s=c-1;s>=c-n;s-=1){var d=new t.Cartesian2(h,s);if(!this.scene.pickPosition(d)){var u=new t.Cartesian2(h,s+1),p=this.scene.pickPosition(u);e.push(p),i.YValueArray.push(o-s),i.addLenArray.push(h),c=o;break}}}this.data=i,this.skyLinePositions=e,this.cameraPosition=this.viewer.camera.position.clone(),this.cameraHeight=t.Cartographic.fromCartesian(this.cameraPosition).height}},i.prototype.drawSkyLine=function(){this.skyLine||(this.skyLinePositions||this.calculateSkyLinePositions(),this.skyLine=this.entities.add({name:"GeoSkyLine",polyline:{positions:this.skyLinePositions,width:this.skyLineWidth,show:this.skyLineShow,material:this.skyLineMaterial,depthFailMaterial:this.skyLineDepthFailMaterial}}))},i.prototype.drawSkyLineVolume=function(){this.skyLineVolume||(this.skyLinePositions||this.calculateSkyLinePositions(),this.skyLinePositions=this.skyLinePositions.concat([this.cameraPosition]),this.skyLinePositions.push(this.skyLinePositions[0]),this.skyLineVolume=this.entities.add({name:"GeoSkyLineVolume",polygon:{hierarchy:this.skyLinePositions,extrudedHeight:this.cameraHeight/this.extrudeRatio,perPositionHeight:!0,material:this.skyLineVolumeMaterial,outline:this.skyLineVolumeOutLine,outlineColor:this.skyLineVolumeOutLineColor}}))},i.prototype.drawChart=function(t){if(!this.myChart&&(this.skyLinePositions||this.calculateSkyLinePositions(),this.data)){var e=document.getElementById(t);e.onmousedown=function(t){var i=t||event,r=i.clientX-e.offsetLeft,o=i.clientY-e.offsetTop;document.onmousemove=function(t){var i=t||event;e.style.left=i.clientX-r+"px",e.style.top=i.clientY-o+"px"},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null}};var i=echarts.init(e),r={title:{x:"center",padding:15,text:"天际线示意图",textStyle:{color:"#ccc",fontStyle:"normal",fontWeight:"bold",fontFamily:"sans-serif",fontSize:18}},tooltip:{trigger:"axis",confine:!0,formatter:function(t){return"宽度: "+t[0].name+"<br />高度: "+t[0].value}},grid:{left:"2%",right:"12%",bottom:"3%",containLabel:!0},xAxis:{splitArea:{show:!1},splitLine:{show:!1,lineStyle:{color:["#aaa"],width:1,type:"solid"}},type:"category",boundaryGap:!1,data:this.data.addLenArray,name:"宽度(PX)",nameTextStyle:{color:"#ccc",fontWeight:"bolder"},axisLine:{lineStyle:{color:"rgba(0.0, 128, 255, 0.6)",width:4}},axisLabel:{color:"#ccc",fontWeight:"bolder"}},yAxis:{splitArea:{show:!1},splitLine:{show:!0,lineStyle:{color:["#aaa"],width:1,type:"dashed"}},type:"value",name:"高度(PX)",nameTextStyle:{color:"#ccc",fontWeight:"bolder"},axisLine:{lineStyle:{color:"rgba(0.0, 128, 255, 0.6)",width:4}},axisLabel:{color:"#ccc",fontWeight:"bolder"}},series:[{type:"line",data:this.data.YValueArray,areaStyle:{color:"rgba(0.0,255.0,255.0,0.8)"}}]};return i.setOption(r),this.chartContainer=e,this.myChart=i,i}},i.prototype.clearChart=function(){this.myChart&&(this.myChart.clear(),this.myChart=null)},i.prototype.clear=function(){this.clearChart(),this.skyLine&&(this.entities.remove(this.skyLine),this.skyLine=void 0),this.skyLineVolume&&(this.entities.remove(this.skyLineVolume),this.skyLineVolume=void 0),this.data=void 0,this.skyLinePositions=void 0,this.cameraPosition=void 0,this.cameraHeight=void 0,this.skyLinePositions=void 0}}(window.Cesium),function(t){"use strict";var e=t.defaultValue;(t.GeoTerrainSlope=function(t,i){t=e(t,e.EMPTY_OBJECT),this.viewer=t.viewer,this.scene=this.viewer.scene,this.canvas=this.scene.canvas,this.camera=this.scene.camera,this.primitives=this.scene.primitives,this.callback=i||null,this.contourUniforms={},this.shadingUniforms={}}).prototype.updateMaterial=function(n){var a=!1;if(n&&n.contour){a=e(n.contour.enable,!1);var s=e(n.contour.width,2),l=e(n.contour.spacing,150),g=e(n.contour.color,t.Color.RED.clone())}var h="none";if(n&&n.selectedShading&&(h=n.selectedShading,-1==["elevation","slope","aspect","none"].indexOf(h)))return alert("输入值可选elevation,slope,aspect,none中的一个！"),!1;var c,C=-414,d=8777;return n&&n.minHeight&&(C=n.minHeight),n&&n.maxHeight&&(d=n.maxHeight),a?("elevation"===h?(c=new t.Material({fabric:{type:"ElevationColorContour",materials:{contourMaterial:{type:"ElevationContour"},elevationRampMaterial:{type:"ElevationRamp"}},components:{diffuse:"contourMaterial.alpha == 0.0 ? elevationRampMaterial.diffuse : contourMaterial.diffuse",alpha:"max(contourMaterial.alpha, elevationRampMaterial.alpha)"}},translucent:!1}),this.shadingUniforms=c.materials.elevationRampMaterial.uniforms,this.shadingUniforms.minimumHeight=C,this.shadingUniforms.maximumHeight=d,this.contourUniforms=c.materials.contourMaterial.uniforms):"slope"===h?(c=new t.Material({fabric:{type:"SlopeColorContour",materials:{contourMaterial:{type:"ElevationContour"},slopeRampMaterial:{type:"SlopeRamp"}},components:{diffuse:"contourMaterial.alpha == 0.0 ? slopeRampMaterial.diffuse : contourMaterial.diffuse",alpha:"max(contourMaterial.alpha, slopeRampMaterial.alpha)"}},translucent:!0}),this.shadingUniforms=c.materials.slopeRampMaterial.uniforms,this.contourUniforms=c.materials.contourMaterial.uniforms):"aspect"===h?(c=new t.Material({fabric:{type:"AspectColorContour",materials:{contourMaterial:{type:"ElevationContour"},aspectRampMaterial:{type:"AspectRamp"}},components:{diffuse:"contourMaterial.alpha == 0.0 ? aspectRampMaterial.diffuse : contourMaterial.diffuse",alpha:"max(contourMaterial.alpha, aspectRampMaterial.alpha)"}},translucent:!1}),this.shadingUniforms=c.materials.aspectRampMaterial.uniforms,this.contourUniforms=c.materials.contourMaterial.uniforms):(c=t.Material.fromType("ElevationContour"),this.contourUniforms=c.uniforms),this.contourUniforms.width=s,this.contourUniforms.spacing=l,this.contourUniforms.color=g):"elevation"===h?(c=t.Material.fromType("ElevationRamp"),this.shadingUniforms=c.uniforms,this.shadingUniforms.minimumHeight=C,this.shadingUniforms.maximumHeight=d):"slope"===h?(c=t.Material.fromType("SlopeRamp"),this.shadingUniforms=c.uniforms):"aspect"===h&&(c=t.Material.fromType("AspectRamp"),this.shadingUniforms=c.uniforms),"none"!==h&&(this.shadingUniforms.image=function(t){var e=document.createElement("canvas");e.width=100,e.height=1;var n,a=e.getContext("2d");"elevation"===t?n=i:"slope"===t?n=r:"aspect"===t&&(n=o);var s=a.createLinearGradient(0,0,100,0);7==n.length?(s.addColorStop(n[0],"#000000"),s.addColorStop(n[1],"#2747E0"),s.addColorStop(n[2],"#D33B7D"),s.addColorStop(n[3],"#D33038"),s.addColorStop(n[4],"#FF9742"),s.addColorStop(n[5],"#ffd700"),s.addColorStop(n[6],"#ffffff")):(s.addColorStop(n[0],"#0a8d33"),s.addColorStop(n[1],"#599668"),s.addColorStop(n[2],"#afdd76"),s.addColorStop(n[3],"#fafcb4"),s.addColorStop(n[4],"#f2b602"),s.addColorStop(n[5],"#eea706"),s.addColorStop(n[6],"#df7702"),s.addColorStop(n[7],"#a52100"),s.addColorStop(n[8],"#682b06"),s.addColorStop(n[9],"#6a2402"),s.addColorStop(n[10],"#420202"));return a.fillStyle=s,a.fillRect(0,0,100,1),e}(h)),this.scene.globe.material=c,!0};var i=[0,.045,.1,.15,.37,.54,1],r=[0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1],o=[0,.2,.4,.6,.8,.9,1]}(window.Cesium),function(t){"use strict";var e=t.GeoTilesetFlatten=function(e){e=t.defaultValue(e,t.defaultValue.EMPTY_OBJECT),this._ready=!1,this.dirty=!1,this.polys=[],this.isCartesian3Point=t.defaultValue(e.isCartesian3Point,!0),this.show=t.defaultValue(e.show,!0),this.ellipsoid=t.defaultValue(e.ellipsoid,t.Ellipsoid.WGS84)};function i(e){var i=e.content._model;t.defined(i)&&t.defined(i.platSlot)&&delete i.platSlot}function r(e){var i=e.content._model;if(t.defined(i)){var r=i.platSlot;if(!t.defined(r))throw new t.DeveloperError("storing of model vertex buffers is fail.")}}e.prototype.bindTileset=function(e){if(!t.defined(e))throw new t.DeveloperError("parameter tileset is required.");if(t.defined(this._tileset))throw new t.DeveloperError("There is a tileset already, Only One Bind");this._tileset=e,this._tileset.platBodyDebug=this,this.dirty=!0,this._tileset.tileUnload.addEventListener(i),this._tileset.tileLoad.addEventListener(r)},e.prototype.showPlat=function(t){this.show!=t&&(that.dirty=!0),this.show=t},e.prototype.isPlatShow=function(t){return this.show},e.prototype.isPlatDirty=function(){return this.dirty},e.prototype.clearPlatDirty=function(){this.dirty=!1},e.prototype.addPlatArea=function(e){if(void 0!==e&&e instanceof Array){var i=e.length;if(!(i<3)){for(var r=[],o=this.isCartesian3Point,n=0;n<i;n++){var a=e[n];o?void 0!==a.height?r.push(t.Cartesian3.fromRadians(a.longitude,a.latitude,a.height,this.ellipsoid)):r.push(t.Cartesian3.clone(a,new t.Cartesian3)):void 0!==a.height?r.push(t.Cartographic.clone(a,new t.Cartographic)):r.push(t.Cartographic.fromCartesian(a,this.ellipsoid,new t.Cartographic))}if(this.isCartesian3Point){if(!r[0].equals(r[i-1])){var s=t.Cartesian3.clone(r[0],new t.Cartesian3);r.push(s)}}else if(!t.Cartographic.equals(r[0],r[i-1])){s=t.Cartographic.clone(r[0],new t.Cartographic);r.push(s)}var l={};l.platPickPoints=r,l._show=!0,this.polys.push(l);var g=this.polys.length-1;return this.dirty=!0,this.initPlatBodyDebug(),this._ready=!0,g}}},e.prototype.getPlatArea=function(e){if(void 0!==e&&"number"==typeof e&&e<this.polys.length){var i=this.polys[e];if(void 0===i)return;var r=i.platPickPoints;if(void 0===r)return;for(var o=[],n=0;n<r.length;n++){var a=t.Cartesian3.clone(r[n],new t.Cartesian3);o.push(a)}return o}},e.prototype.removePlatArea=function(t){void 0!==t&&"number"==typeof t&&t<this.polys.length&&(delete this.polys[t],this.dirty=!0)},e.prototype.showPlatArea=function(t,e){void 0!==t&&"number"==typeof t&&t<this.polys.length&&(this.polys[t]._show=e,this.dirty=!0)},e.prototype.initRegionMatrixes=function(e){var i=e,r=i._pickObject.content._tile;if(t.defined(i._runtime.rootNodes)&&!(i._runtime.rootNodes.length<1)){var o=r._boundingVolume._orientedBoundingBox.halfAxes,n=r._boundingVolume._orientedBoundingBox.center,a={};if(a.matOrg=this.createHalfMatrix(o),a.matOrgI=this.invertMatrix(a.matOrg),t.defined(a.matOrgI)&&(a.matPrj=t.Transforms.eastNorthUpToFixedFrame(n,this.ellipsoid,new t.Matrix4),a.matPrjI=this.invertMatrix(a.matPrj),t.defined(a.matPrjI)))return a.modelMatrix=t.Matrix4.clone(i._runtime.rootNodes[0].computedMatrix,new t.Matrix4),a}},e.prototype.initBoxMatrixes=function(e){var i=e,r=i._pickObject.content._tile;if(t.defined(i._runtime.rootNodes)&&!(i._runtime.rootNodes.length<1)){var o=r._boundingVolume._orientedBoundingBox.center,n={};if(n.matPrj=t.Transforms.eastNorthUpToFixedFrame(o,this.ellipsoid,new t.Matrix4),n.matPrjI=this.invertMatrix(n.matPrj),t.defined(n.matPrjI)&&(n.modelMatrix=t.Matrix4.clone(i._runtime.rootNodes[0].computedMatrix,new t.Matrix4),n.modelMatrixI=this.invertMatrix(n.modelMatrix),t.defined(n.modelMatrixI)))return n}},e.prototype.toPlatRegionModel=function(e,i){var r=i,o=r.platSlot.buffers,n=o.length,a=this.initRegionMatrixes(r);if(t.defined(a)){this.initializePlatPoly(r);for(var s=0;s<n;s++){var l=o[s];if(void 0!==l)if(1!=l.showPlat){l.showPlat=!0;for(var g=l.buffer.slice(0),h=new Float32Array(g.buffer,g.byteOffset,g.length/Float32Array.BYTES_PER_ELEMENT),c=0,C=[],d=[],u=0;u<h.length;u+=3){var p=new t.Cartesian3(h[u],h[u+1],h[u+2]);d.push(p),(A=t.Matrix4.multiplyByPoint(a.matOrgI,p,new t.Cartesian3)).z<c&&(c=A.z),C.push(A)}for(u=0;u<C.length;u++){var A=C[u];p=d[u];p=t.Matrix4.multiplyByPoint(a.modelMatrix,p,new t.Cartesian3),p=t.Matrix4.multiplyByPoint(a.matPrjI,p,new t.Cartesian3),this.isPlatPoint(r,p)&&(A.z=c),A=t.Matrix4.multiplyByPoint(a.matOrg,A,new t.Cartesian3),h[3*u]=A.x,h[3*u+1]=A.y,h[3*u+2]=A.z}this.replaceCommandVertexBuffer(r,g,s,e)}}r.platSlot.platPolys=void 0}},e.prototype.toPlatBoxModel=function(e,i){var r=i,o=r.platSlot.buffers,n=o.length,a=this.initBoxMatrixes(r);if(t.defined(a)){var s={};this.initializePlatPoly(r);for(var l=0;l<n;l++){var g=o[l];if(!g.showPlat||this.isPlatDirty()){g.showPlat=!0;for(var h=g.buffer.slice(0),c=new Float32Array(h.buffer,h.byteOffset,h.length/Float32Array.BYTES_PER_ELEMENT),C=0;C<c.length;C+=3){var d=new t.Cartesian3(c[C],c[C+1],c[C+2]);d=t.Cartesian3.clone(d);var u=t.Matrix4.multiplyByPoint(a.modelMatrix,d,new t.Cartesian3);s.pt=u,d=t.Matrix4.multiplyByPoint(a.matPrjI,u,new t.Cartesian3),this.isPlatPoint(r,d,s)&&(u=t.Matrix4.multiplyByPoint(a.modelMatrixI,s.pt,new t.Cartesian3),c[C]=u.x,c[C+1]=u.y,c[C+2]=u.z)}this.replaceCommandVertexBuffer(r,h,l,e)}}r.platSlot.platPolys=void 0}},e.prototype.toPlatModel=function(e,i){var r=i._pickObject.content._tile._header.boundingVolume.region;t.defined(r)?this.toPlatRegionModel(e,i):this.toPlatBoxModel(e,i)},e.prototype.toUnplatModel=function(t,e){for(var i=e,r=i.platSlot.buffers,o=r.length,n=0;n<o;n++){var a=r[n];if(void 0!==a)if(0!=a.showPlat){a.showPlat=!1;var s=a.buffer.slice(0);this.replaceCommandVertexBuffer(i,s,n,t)}}i.platSlot.platPolys=void 0},e.prototype.platModel=function(t,e){var i=e;if(this._ready&&void 0!==i.platSlot&&void 0!==i.platSlot.buffers&&!(i.platSlot.buffers.length<1)){var r=this.hitPlatTest(i);(r||i.platSlot.isUsed)&&(i.platSlot.isUsed=!0,r?this.toPlatModel(t,e):this.toUnplatModel(t,e))}},e.prototype.hitPlatTest=function(t){var e=t,i=this.polys,r=i.length;if(r<1)return!1;for(var o=0;o<r;o++){var n=i[o];if(void 0!==n&&(void 0!==n.platPickRegion&&this.hitPlatTestByRegion(e,n.platPickRegion)))return!0}return!1},e.prototype.initPlatBodyDebug=function(){var e=this.ellipsoid;if(this.isCartesian3Point){if(void 0===(a=this.polys))return;if(void 0===(s=a.length)||s<1)return;if(!this.dirty)return;for(var i=0;i<s;i++){if(void 0!==(l=a[i])&&!t.defined(l.platPickRegion)){if(void 0===(d=l.platPickPoints))return;if(void 0===(u=d.length)||u<1)return;for(var r=0;r<u;r++){var o=t.Cartesian3.clone(d[r],new t.Cartesian3),n=t.Cartographic.fromCartesian(o,e);0!=r?(h>n.longitude?h=n.longitude:g<n.longitude&&(g=n.longitude),c>n.latitude?c=n.latitude:C<n.latitude&&(C=n.latitude)):(g=h=n.longitude,c=C=n.latitude)}l.platPickRegion={west:h,south:c,east:g,north:C}}}}else{var a,s;if(void 0===(a=this.polys))return;if(void 0===(s=a.length)||s<1)return;if(!this.dirty)return;for(i=0;i<s;i++){var l;if(void 0!==(l=a[i])&&!t.defined(l.platPickRegion)){var g,h,c,C,d,u;if(void 0===(d=l.platPickPoints))return;if(void 0===(u=d.length)||u<1)return;g=h=d[0].longitude,c=C=d[0].latitude;for(r=1;r<u;r++){h>(o=t.Cartographic.clone(d[r],new t.Cartographic)).longitude?h=o.longitude:g<o.longitude&&(g=o.longitude),c>o.latitude?c=o.latitude:C<o.latitude&&(C=o.latitude)}l.platPickRegion={west:h,south:c,east:g,north:C}}}}},e.prototype.createTileRegion=function(e){var i=e._header.boundingVolume;if(t.defined(i)){if(void 0!==i.region){var r=i.region;if(!t.defined(r))return;return{west:r[0],south:r[1],east:r[2],north:r[3]}}if(i.box){if(!t.defined(e._boundingVolume))return;var o=e._boundingVolume._orientedBoundingBox;if(!t.defined(o))return;var n,a=t.Cartesian3.add,s=t.Cartesian3.subtract,l=[];for(n=0;n<3;n++){var g=new t.Cartesian3(o.halfAxes[3*n],o.halfAxes[3*n+1],o.halfAxes[3*n+2]),h=[];h.push({f:a,a:g}),h.push({f:s,a:g}),l.push(h)}var c,C,d,u,p,A,I=this.ellipsoid,m=o.center,f=[],v=l[0],y=l[1],_=l[2];for(n=0;n<v.length;n++)for(var w=v[n],P=t.Cartesian3.clone(m,new t.Cartesian3),b=w.f(P,w.a,new t.Cartesian3),E=0;E<y.length;E++)for(var T=y[E],M=T.f(b,T.a,new t.Cartesian3),x=0;x<_.length;x++){var S=_[x],L=S.f(M,S.a,new t.Cartesian3);f.push(L)}for(c=C=f[0].x,d=u=f[0].y,p=A=f[0].z,n=1;n<f.length;n++){var R=f[n];c>R.x?c=R.x:C<R.x&&(C=R.x),d>R.y?d=R.y:u<R.y&&(u=R.y),p>R.z?p=R.z:A<R.z&&(A=R.z)}var D,k,O,F,H=[];for(H.push(t.Cartographic.fromCartesian(new t.Cartesian3(c,d,p),I,new t.Cartographic)),H.push(t.Cartographic.fromCartesian(new t.Cartesian3(C,u,A),I,new t.Cartographic)),n=0;n<H.length;n++){var B=H[n];0!=n?(D>B.longitude?D=B.longitude:k<B.longitude&&(k=B.longitude),F>B.latitude?F=B.latitude:O<B.latitude&&(O=B.latitude)):(D=k=B.longitude,O=F=B.latitude)}return{west:D,south:F,east:k,north:O}}}},e.prototype.hitPlatTestByRegion=function(e,i){return!!t.defined(i)},e.prototype.initializePlatPoly=function(t){this.isCartesian3Point?this.initializeCartesianPlatPoly(t):this.initializeCartographicPlatPoly(t)},e.prototype.initializeCartesianPlatPoly=function(e){var i=e,r=i.platSlot;if(t.defined(r.platPolys)){if(!this.isPlatDirty())return;delete r.platPolys}var o,n=this.ellipsoid,a=this.polys;if(t.defined(i._runtime.rootNodes)&&(o=i._runtime.rootNodes[0].computedMatrix),t.defined(o)){var s=this.invertMatrix(o);if(t.defined(s)){r.platPolys=[];var l,g,h=r.platPolys;for(g=0;g<a.length;g++){var c=a[g];if(t.defined(c)){var C,d,u,p,A=c.platPickPoints,I=new t.Cartesian3,m=[];for(l=1;l<A.length;l++){var f=A[l];I=t.Cartesian3.add(I,f,new t.Cartesian3);var v=t.Matrix4.multiplyByPoint(s,f,new t.Cartesian3);m.push(v),t.defined(C)?(C>v.x?C=v.x:u<v.x&&(u=v.x),d>v.y?d=v.y:p<v.y&&(p=v.y)):(C=u=v.x,d=p=v.y)}I=t.Cartesian3.divideByScalar(I,m.length,new t.Cartesian3);var y={pts:m,minX:C,minY:d,maxX:u,maxY:p,compressPlane:this.initCompressPlane(n,I),show:c._show};h.push(y)}}}}},e.prototype.initializeCartographicPlatPoly=function(e){var i=e,r=i._pickObject.content._tile,o=i.platSlot;if(t.defined(o.platPolys)){if(!this.isPlatDirty())return;o.platPolys=void 0}var n,a=this.ellipsoid,s=this.polys;if(t.defined(r._boundingVolume)&&t.defined(r._boundingVolume._orientedBoundingBox)&&(n=r._boundingVolume._orientedBoundingBox.center),t.defined(n)){var l,g=t.Transforms.eastNorthUpToFixedFrame(n,a,new t.Matrix4),h=this.invertMatrix(g);if(t.defined(h))if(t.defined(i._runtime)&&t.defined(i._runtime.rootNodes)&&i._runtime.rootNodes.length>0&&t.defined(i._runtime.rootNodes[0])&&(l=i._runtime.rootNodes[0].computedMatrix),t.defined(l)){var c=this.invertMatrix(l);if(t.defined(c)){o.platPolys=[];var C,d,u=o.platPolys;for(d=0;d<s.length;d++){var p=s[d];if(t.defined(p)){var A=p.platPickPoints;if(t.defined(A)&&!(A.length<1)){var I,m,f,v,y=new t.Cartesian3,_=[];for(C=0;C<A.length;C++){var w,P=A[C];if(this.isCartesian3Point)w=t.Cartesian3.clone(P,new t.Cartesian3),y=t.Cartesian3.add(y,w,new t.Cartesian3),w=t.Matrix4.multiplyByPoint(c,w,new t.Cartesian3);else{w=t.Cartographic.clone(P,new t.Cartographic);var b=t.Cartesian3.fromRadians(w.longitude,w.latitude,0,a);y=t.Cartesian3.add(y,b,new t.Cartesian3),w=t.Matrix4.multiplyByPoint(h,b,new t.Cartesian3)}_.push(w),t.defined(I)?(I>w.x?I=w.x:f<w.x&&(f=w.x),m>w.y?m=w.y:v<w.y&&(v=w.y)):(I=f=w.x,m=v=w.y)}y=t.Cartesian3.divideByScalar(y,_.length,new t.Cartesian3);var E={pts:_,minX:I,minY:m,maxX:f,maxY:v,compressPlane:this.initCompressPlane(a,y)};u.push(E)}}}}}}},e.prototype.initCompressPlane=function(e,i){var r=t.Cartesian3.clone(i,new t.Cartesian3),o=t.Cartographic.fromCartesian(r,e,new t.Cartographic),n=t.Cartesian3.fromRadians(o.longitude,o.latitude,0,e);if(!r.equals(n))return t.Plane.fromPointNormal(r,t.Cartesian3.normalize(t.Cartesian3.subtract(r,n,new t.Cartesian3),new t.Cartesian3))},e.prototype.isPlatPointNoResult=function(e,i){for(var r=e.platSlot.platPolys,o=t.Cartesian3.clone(i,new t.Cartesian3),n=0;n<r.length;n++){var a=r[n];if(t.defined(a)&&this.isInsidedPoint(a,o))return!0}return!1},e.prototype.isPlatPointResult=function(e,i,r){for(var o=e.platSlot.platPolys,n=t.Cartesian3.clone(i,new t.Cartesian3),a=t.Cartesian3.clone(r.pt,new t.Cartesian3),s=!1,l=0;l<o.length;l++){var g=o[l];if(t.defined(g))if(this.isInsidedPoint(g,n)){0;var h=this.mapPosition(g.compressPlane,a);t.defined(h)&&(a=h),s=!0}else;}return s&&(r.pt=a),s},e.prototype.isPlatPoint=function(e,i,r){return t.defined(r)?this.isPlatPointResult(e,i,r):this.isPlatPointNoResult(e,i)},e.prototype.mapPosition=function(e,i){if(t.defined(e)&&t.defined(i)&&t.defined(e.normal)){var r=t.Cartesian3.clone(e.normal,new t.Cartesian3),o=t.Cartesian3.clone(i,new t.Cartesian3),n=new t.Ray(o,r),a=t.IntersectionTests.rayPlane(n,e);if(t.defined(a))return o;var s=t.Cartesian3.negate(r,new t.Cartesian3),l=new t.Ray(o,s),g=t.IntersectionTests.rayPlane(l,e);if(!t.defined(g))return o;var h=t.Cartesian3.distance(g,o);return t.Cartesian3.add(o,t.Cartesian3.multiplyByScalar(s,h,new t.Cartesian3),new t.Cartesian3)}},e.prototype.isInsidedPoint=function(e,i){if(!t.defined(e))return!1;if(!t.defined(e.show)||!e.show)return!1;if(!t.defined(i))return!1;var r,o,n=i.x,a=i.y;if(n<e.minX||n>e.maxX||a<e.minY||a>e.maxY)return!1;var s={};s.z=!1,s.b=!1,s.t=!1;var l,g,h,c,C,d,u=e.pts,p=u.length;for(r=0,o=p-1;r<p;o=r++){if(l=u[r],g=u[o],h=l.x,c=l.y,C=g.x,d=g.y,this.isEqualFloat(d,c)){if(this.isEqualFloat(a,c)){if(this.isEqualFloat(n,h))return!0;if(this.isEqualFloat(n,C))return!0;if(h>n==C<n)return!0}}else if(this.isEqualFloat(a,c)){if(this.isEqualFloat(n,h))return!0;h<n&&(d<a?s.b=!s.b:s.t=!s.t)}else if(this.isEqualFloat(a,d)){if(this.isEqualFloat(n,C))return!0;C<n&&(c<a?s.b=!s.b:s.t=!s.t)}if(c>a!=d>a){var A=(C-h)/(d-c);if(A*=a-c,A+=h,this.isEqualFloat(n,A))return!0;n<A&&(s.z=!s.z)}}return s.t==s.b?s.t?!s.z:s.z:void 0},e.prototype.isEqualFloat=function(e,i,r){if(t.defined(r)||(r=1e-8),!t.defined(e))return!1;if(!t.defined(i))return!1;var o=e-i;return(o=Math.abs(o))<r},e.prototype.replaceCommandVertexBuffer=function(e,i,r,o){var n=e;if(t.defined(i)&&t.defined(r)&&"number"==typeof r&&t.defined(o)&&t.defined(o.context)){var a=n._nodeCommands;if(t.defined(a))if(!(a.length<=r)){var s=t.Buffer.createVertexBuffer({context:o.context,typedArray:i,usage:t.BufferUsage.STATIC_DRAW});if(t.defined(s)){var l=a[r];if(t.defined(l)){var g=l.command;if(t.defined(g)){var h=g._vertexArray;if(t.defined(h)){var c=h._attributes;if(t.defined(c)&&c.length>0){var C=c[0];if(!t.defined(C))return;var d=C.vertexBuffer;t.defined(d)&&!d.isDestroyed()&&d.vertexArrayDestroyable&&d.destroy(),C.vertexBuffer=s;var u=h._vao;t.defined(u)&&(o.context.glDeleteVertexArray(h._vao),h._vao=void 0)}}}}}}}},e.prototype.storeVertexBuffer=function(e){if(t.defined(e)){var i=e;if(!t.defined(i.platSlot)){var r=i._pickObject;if(t.defined(r)){var o=r.content;if(t.defined(o)){var n=o._tileset;if(t.defined(n)&&t.defined(n.platBodyDebug)){var a=i._loadResources;if(t.defined(a)){var s=i._cachedGltf._gltf;if(t.defined(s)){var l=s.accessors;if(t.defined(l)){var g=s.bufferViews;if(t.defined(g)){var h=s.meshes;if(t.defined(h)){i.platSlot={},i.platSlot.buffers=[],i.platSlot.isUsed=!1;for(var c=0;c<h.length;c++){var C=h[c];if(t.defined(C)){var d=C.primitives;if(t.defined(d))for(var u=0;u<d.length;u++){var p=d[u];if(t.defined(p)){var A=p.attributes;if(t.defined(A))for(var I in A)if("POSITION"===I){var m=g[l[A[I]].bufferView],f=a.getBuffer(m),v=f.slice(0,f.length);i.platSlot.buffers.push({buffer:v,showPlat:!1})}}}}}}}}}}}}}}}},e.prototype.invertMatrix=function(e){var i=void 0;try{i=t.Matrix4.inverse(e,new t.Matrix4)}catch(t){}return i},e.prototype.createMatrix=function(e){if(t.defined(e)){var i=new t.Matrix4;return t.Matrix4.setColumn(i,0,new t.Cartesian4(e[0].x,e[0].y,e[0].z,0),i),t.Matrix4.setColumn(i,1,new t.Cartesian4(e[1].x,e[1].y,e[1].z,0),i),t.Matrix4.setColumn(i,2,new t.Cartesian4(e[2].x,e[2].y,e[2].z,0),i),t.Matrix4.setColumn(i,3,new t.Cartesian4(0,0,0,1),i),i}},e.prototype.createHalfMatrix=function(e){if(t.defined(e)){for(var i=[],r=0;r<3;r++)i.push(this.createNormal(e[3*r],e[3*r+1],e[3*r+2]));return this.createMatrix(i)}},e.prototype.createNormal=function(e,i,r){return t.Cartesian3.normalize(new t.Cartesian3(e,i,r),new t.Cartesian3)}}(window.Cesium),function(t){"use strict";var e="GEOVIEWRADAR_TIP",i="GEOVIEWRADAR_LIGHTPOINT",r=t.GeoViewRadar=function(e,i){this.viewer=e.viewer,this.pointLightHeight=t.defaultValue(e.pointLightHeight,.2),this.boundingSphereStackPartitions=t.defaultValue(e.boundingSphereStackPartitions,100),this.boundingSphereSlicePartitions=t.defaultValue(e.boundingSphereSlicePartitions,80),this.boundingSphereSubdivisions=t.defaultValue(e.boundingSphereSubdivisions,100),this.scene=this.viewer.scene,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.callback=i||null,parseFloat(t.VERSION)<1.5&&console.error("当前Cesium版本："+t.VERSION+",雷达分析暂不支持该版本，请更换至1.50以上的版本!")};function o(e,i,r){var o=e.scene.pickPosition(i);if(o){var n=t.Cartographic.fromCartesian(o);if(n.height<0){e.scene.globe.depthTestAgainstTerrain=!0,e.viewer.terrainShadows=t.ShadowMode.CAST_ONLY;var a=e.scene.camera.getPickRay(i),s=e.scene.globe.pick(a,e.scene);n=t.Cartographic.fromCartesian(s)}r=r||0;var l=t.Cartesian3.fromRadians(n.longitude,n.latitude,n.height+r),g=t.Cartographic.fromCartesian(l);return[t.Math.toDegrees(g.longitude),t.Math.toDegrees(g.latitude),g.height]}}function n(e,i,r,o){var n=e.add(new t.LabelCollection);return n.add({text:i,font:"16px sans-serif",showBackground:!0,position:r,pixelOffset:new t.Cartesian2(10,-30)}),n.name=o,n}function a(t,e,i){for(var r=0;r<t.length;r++)t.name==i&&(t.get(r).position=e)}function s(t,e){l(t,e)}function l(t,e){for(var i=0;i<e.length;i++)e.get(i).name==t&&(e.remove(e.get(i)),i--)}r.prototype.activate=function(){this.clear(),this.canvas.style.cursor="crosshair";var i=null,r=null,l=!0,g=null,h=null,c=this;this.handler=new t.ScreenSpaceEventHandler(this.canvas),this.handler.setInputAction(function(r){l?(g=o(c,r.position,c.pointLightHeight),h=t.Cartesian3.fromDegrees(g[0],g[1],g[2]),s(e,c.primitives),l=!1,c.firstLeftClick=l,i=null):(c.scene.shadowMap.enableGeoViewRadar=!0,c.canvas.style.cursor="default",c.handler&&!c.handler.isDestroyed()&&c.handler.destroy(),s(e,c.primitives),l=!0,c.firstLeftClick=l,i=null)},t.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(s){if(c.tipPosition=c.scene.pickPosition(s.endPosition),c.tipPosition&&(l&&(i?a(i,c.tipPosition,e):i=n(c.primitives,"单击左键确定雷达位置",c.tipPosition,e)),!l)){i?a(i,c.tipPosition,e):i=n(c.primitives,"单击左键固定雷达半径",c.tipPosition,e);var g=o(c,s.endPosition),C=t.Cartesian3.fromDegrees(g[0],g[1],g[2]);r=t.Cartesian3.distance(h,C),c.dynamicAnalysis(h,r),c.pointLightPosition=h,c.realTimeRadius=r,c.firstLeftClick=l}},t.ScreenSpaceEventType.MOUSE_MOVE)},r.prototype.dynamicAnalysis=function(e,r){if(e&&r){var o=new t.Camera(this.scene);o.position=e,l(i,this.primitives);var n,a=this.primitives.add(new t.PointPrimitiveCollection);a.name=i,a.add({position:e,color:t.Color.YELLOW,pixelSize:5}),n={context:this.scene.context,lightCamera:o,isPointLight:!0},this.scene.shadowMap.destroy(),this.scene.shadowMap=new t.ShadowMap(n);var s=this.scene.shadowMap;s.enabled=!0,s.debugShow=!0,s.enableGeoViewRadar=!0,s.size=1024,s._pointLightRadius=r,s._boundingSphere.stackPartitions=this.boundingSphereStackPartitions,s._boundingSphere.slicePartitions=this.boundingSphereSlicePartitions,s._boundingSphere.subdivisions=this.boundingSphereSubdivisions}},r.prototype.clear=function(){this.scene.shadowMap.enabled=!1,this.scene.shadowMap.enableGeoViewRadar=void 0,this.canvas.style.cursor="default",this.handler&&!this.handler.isDestroyed()&&this.handler.destroy(),s(e,this.primitives),l(i,this.primitives)},r.prototype.destroy=function(){this.clear(),this.viewer=void 0,this.pointLightHeight=void 0,this.scene=void 0,this.canvas=void 0,this.primitives=void 0,this.callback=void 0}}(window.Cesium),function(t){"use strict";var e="GEOVIEWSHED3D_TIP",i="GEOVIEWSHED3D_SPOTID",r=t.GeoViewShed3D=function(e,i){this.viewer=e.viewer,this.spotLightHeight=t.defaultValue(e.spotLightHeight,1),this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.callback=i||null,parseFloat(t.VERSION)<1.5&&console.error("当前Cesium版本："+t.VERSION+",可视域分析暂不支持该版本，请更换至1.50以上的版本!")};function o(e,i,r){var o=e.scene.pickPosition(i);if(o){var n=t.Cartographic.fromCartesian(o);if(n.height<0){e.scene.globe.depthTestAgainstTerrain=!0,e.viewer.terrainShadows=t.ShadowMode.ENABLED;var a=e.camera.getPickRay(i),s=e.scene.globe.pick(a,e.scene);n=t.Cartographic.fromCartesian(s)}r=r||0;var l=t.Cartesian3.fromRadians(n.longitude,n.latitude,n.height+r),g=t.Cartographic.fromCartesian(l);return[t.Math.toDegrees(g.longitude),t.Math.toDegrees(g.latitude),g.height]}}function n(e,i,r,o){var n=e.add(new t.LabelCollection);return n.add({text:i,font:"16px sans-serif",showBackground:!0,position:r,pixelOffset:new t.Cartesian2(10,-10)}),n.name=o,n}function a(t,e,i){for(var r=0;r<t.length;r++)t.name==i&&(t.get(r).position=e)}function s(t,e){!function(t,e){for(var i=0;i<e.length;i++)e.get(i).name==t&&(e.remove(e.get(i)),i--)}(t,e)}function l(t,e){for(var i=0;i<e.length;i++)e.get(i).id==t&&(e.remove(e.get(i)),i--)}r.prototype.activate=function(){var r=null;l(i,this.primitives),this.scene.shadowMap.enabled=!1,this.scene.shadowMap.enableGeoViewShed3D=void 0;var g=null,h=null,c=null;this.handler&&!this.handler.isDestroyed()&&this.handler.destroy(),this.canvas.style.cursor="crosshair";var C=this,d=!0,u=null,p=null;this.handler=new t.ScreenSpaceEventHandler(this.canvas),this.handler.setInputAction(function(t){d?(u=o(C,t.position,C.spotLightHeight),d=!1,C.firstLeftClick=d,s(e,C.primitives),r=null):(C.handler&&!C.handler.isDestroyed()&&C.handler.destroy(),d=!0,C.firstLeftClick=d,C.canvas.style.cursor="default",s(e,C.primitives),r=null)},t.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(i){if(C.tipPosition=C.scene.pickPosition(i.endPosition),C.tipPosition&&(d&&(r?a(r,C.tipPosition,e):r=n(C.primitives,"单击左键确定观察位置",C.tipPosition,e)),!d)){r?a(r,C.tipPosition,e):r=n(C.primitives,"单击左键固定视域范围",C.tipPosition,e),p=o(C,i.endPosition),g=turf.bearing(turf.point([u[0],u[1]]),turf.point([p[0],p[1]]));var s=turf.distance(turf.point([u[0],u[1]]),turf.point([p[0],p[1]])),l=p[2]-u[2];h=t.Math.toDegrees(Math.atan(l/(1e3*s)));var A=t.Cartesian3.fromDegrees(u[0],u[1],u[2]),I=t.Cartesian3.fromDegrees(p[0],p[1],p[2]);c=t.Cartesian3.distance(A,I),C.analysis({observePtCoordinate:u,frustumLength:c,frustumHead:g,frustumPitch:h,frustumField:30}),C.spotLightPosition=u,C.realTimeHeading=g,C.realTimePitching=h,C.realTimeDistance=c,C.realTimeFieldAngle=30,C.firstLeftClick=d}},t.ScreenSpaceEventType.MOUSE_MOVE)},r.prototype.analysis=function(e){var r=e.observePtCoordinate,o=e.frustumLength,n=e.frustumHead,a=e.frustumPitch,s=e.frustumField;if(void 0!=r&&void 0!=o&&void 0!=n&&void 0!=a&&void 0!=s){var g=t.Cartesian3.fromDegrees(r[0],r[1],r[2]),h=new t.Camera(this.scene),c=t.Math.toRadians(n),C=t.Math.toRadians(a);h.frustum=new t.PerspectiveFrustum({fov:t.Math.toRadians(s),aspectRatio:1.6,near:1,far:o});var d;h.lookAt(g,new t.HeadingPitchRange(c,C,1e-21)),l(i,this.primitives),this.primitives.add(new t.DebugCameraPrimitive({camera:h,color:t.Color.fromHsl(1,1,1,1),id:i})),d={context:this.scene.context,lightCamera:h,cascadesEnabled:!1,darkness:.5,isPointLight:!1},this.scene.shadowMap.destroy(),this.scene.shadowMap=new t.ShadowMap(d);var u=this.scene.shadowMap;u._terrainBias.depthBias=0,u.enabled=!0,u.size=2048,u.enableGeoViewShed3D=!0}},r.prototype.clear=function(){this.scene.shadowMap.enabled=!1,l(i,this.primitives),s(e,this.primitives),viewer.scene.shadowMap.enableGeoViewShed3D=void 0},r.prototype.destroy=function(){this.scene.shadowMap.enableGeoViewShed3D=void 0,this.handler&&!this.handler.isDestroyed()&&this.handler.destroy(),this.scene.shadowMap.enabled=!1,this.canvas.style.cursor="default",this.clear(),this.viewer=void 0,this.spotLightHeight=void 0,this.scene=void 0,this.camera=void 0,this.canvas=void 0,this.primitives=void 0,this.ellipsoid=void 0,this.callback=void 0}}(window.Cesium),function(t){"use strict";var e="GeoVolumeCalculate_LINE",i="GeoVolumeCalculate_TIP",r="GeoVolumeCalculate_GON",o="GeoVolumeCalculate_DEGON",n="GeoVolumeCalculate_CORAL",a=t.GeoVolumeCalculate=function(t,e){this.viewer=t.viewer,this.scene=this.viewer.scene,this.canvas=this.scene.canvas,this.camera=this.scene.camera,this.primitives=this.scene.primitives,this.designElevation=t.designElevation?t.designElevation:4e3,this.samplingPointsNumber=t.samplingPointsNumber?t.samplingPointsNumber:500,this.callback=e||null};function s(t,e){for(var i=0,r=0;r<e.length;r++)if(e[r]==t&&i++,2==i)return!0}function l(t,e,i,r,o,n,a){var s={},l=turf.polygon([[t.geometry.coordinates[0][i[0]],e[0],e[1],t.geometry.coordinates[0][i[0]]]]),g=turf.area(l),h=a-r,c=1/3*g*h,C=turf.polygon([[t.geometry.coordinates[0][i[1]],e[0],e[1],t.geometry.coordinates[0][i[1]]]]),d=turf.area(C),u=a-o,p=turf.polygon([[t.geometry.coordinates[0][i[1]],t.geometry.coordinates[0][i[2]],e[0],e[1],t.geometry.coordinates[0][i[1]]]]),A=turf.area(p),I=turf.polygon([[t.geometry.coordinates[0][i[1]],t.geometry.coordinates[0][i[2]],e[1],e[0],t.geometry.coordinates[0][i[1]]]]),m=turf.area(I),f=A>m?A:m,v=1/3*d*u+1/3*(f-d)*(u+(a-n));return h>=0?(s.fillVolume=c,s.fillArea=g,s.excavationVolume=v,s.excavationArea=f,s):(s.fillVolume=v,s.fillArea=f,s.excavationVolume=c,s.excavationArea=g,s)}function g(e,i,r,o,n,a,s,l,g){var h={},c=Math.abs(e/(e-i)),C=new t.Cartesian3(0,0,0),d=t.Cartesian3.fromRadians(r.geometry.coordinates[0][o][0],r.geometry.coordinates[0][n][1],l),u=t.Cartesian3.fromRadians(r.geometry.coordinates[0][n][0],r.geometry.coordinates[0][n][1],g),p=t.Cartographic.fromCartesian(t.Cartesian3.lerp(d,u,c,C));return h.intersection=[p.longitude,p.latitude],h.vertexSerial=[a,s],h}function h(e,r){return e.add({name:i,position:r,label:{text:"左键点击绘制，右键点击结束",font:"15px sans-serif",showBackground:!0,pixeloffset:new t.Cartesian2(0,20)}})}function c(t,e){for(var i=0;i<e.values.length;i++)e.values[i].name==t&&(e.remove(e.values[i]),i--)}a.prototype.activate=function(){this.canvas.style.cursor="crosshair";var a=0,s=this,l=[],g=[],C=[],d=[],u=[];this.handler=new t.ScreenSpaceEventHandler(this.canvas),this.handler.setInputAction(function(i){var r=s.camera.getPickRay(i.position),o=s.scene.globe.pick(r,s.scene);g.push(o);var n=t.Cartographic.fromCartesian(o),h=t.Math.toDegrees(n.longitude),c=t.Math.toDegrees(n.latitude),p=n.height;C.push(h,c,p),d.push(h,c,s.designElevation),a?(u[a-1].polyline.positions.getValue().shift(),l=[u[0].polyline.positions.getValue()[1],o,u[a-1].polyline.positions.getValue()[0]]):l=[o,o,o],s.polylineEntity=s.viewer.entities.add({name:e,polyline:{positions:l,clampToGround:!0,width:5,material:new t.PolylineOutlineMaterialProperty({color:t.Color.ORANGE,outlineWidth:2,outlineColor:t.Color.BLACK})}}),u.push(s.polylineEntity),a++},t.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction(function(t){if(l.length){var e=s.camera.getPickRay(t.endPosition),i=s.scene.globe.pick(e,s.scene);l.splice(l.length-2,1,i),u[a-1].polyline.positions=l,s.labelEntity?s.labelEntity.position=i:s.labelEntity=h(s.viewer.entities,i)}else s.labelEntity?s.labelEntity.position=i:s.labelEntity=h(s.viewer.entities,i)},t.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction(function(a){var l=s.camera.getPickRay(a.position),h=s.scene.globe.pick(l,s.scene);g.push(h);var u=t.Cartographic.fromCartesian(h),p=t.Math.toDegrees(u.longitude),A=t.Math.toDegrees(u.latitude),I=u.height;C.push(p,A,I),d.push(p,A,s.designElevation),s.handler.destroy(),s.canvas.style.cursor="default",s.labelEntity&&c(i,s.viewer.entities),s.polylineEntity&&c(e,s.viewer.entities),s.VOLUME=s.volumeAnalysis(s.scene,C,s.designElevation,s.samplingPointsNumber),s.callback(s.VOLUME),s.designPolygonEntity=s.viewer.entities.add({name:o,polygon:{hierarchy:{positions:t.Cartesian3.fromDegreesArrayHeights(d)},material:t.Color.BLUE.withAlpha(.8),perPositionHeight:!0}}),s.polygonEntity=s.viewer.entities.add({name:r,polygon:{hierarchy:{positions:g},material:t.Color.GREEN.withAlpha(.5)}}),s.designPolygonEntity_coral=s.viewer.entities.add({name:n,polygon:{hierarchy:{positions:t.Cartesian3.fromDegreesArrayHeights(d)},material:t.Color.CORAL.withAlpha(.5),perPositionHeight:!0,outline:!0,outlineColor:t.Color.YELLOW.withAlpha(1),extrudedHeight:0,closeTop:!0,closeBottom:!1}})},t.ScreenSpaceEventType.RIGHT_CLICK)},a.prototype.volumeAnalysis=function(e,i,r,o){var n,a={};a.features=[];for(var h=e.globe.ellipsoid,c=[],C=t.Cartesian3.fromDegreesArrayHeights(i),d=0;d<C.length;d++){var u=t.Math.toDegrees(h.cartesianToCartographic(C[d]).longitude),p=t.Math.toDegrees(h.cartesianToCartographic(C[d]).latitude);c.push([u,p])}c.push([t.Math.toDegrees(h.cartesianToCartographic(C[0]).longitude),t.Math.toDegrees(h.cartesianToCartographic(C[0]).latitude)]);var A=turf.lineString(c),I=turf.bbox(A),m=turf.randomPoint(2*o,{bbox:I}),f=turf.polygon([c]);for(d=0;d<m.features.length;d++){var v=turf.point(m.features[d].geometry.coordinates);turf.booleanPointInPolygon(v,f)||(m.features.splice(d,1),d--)}var y=[],_=C.concat(C[0]);for(d=0;d<_.length-1;d++)for(var w=1;w<Math.ceil(o/10);w++){var P=new t.Cartesian3(0,0,0);P=t.Cartesian3.lerp(_[d],_[d+1],w*(1/Math.ceil(o/10)),P),y.push(P)}C=C.concat(y);var b=[],E=[];for(d=0;d<C.length;d++){var T=h.cartesianToCartographic(C[d]).longitude,M=h.cartesianToCartographic(C[d]).latitude;b.push(new t.Cartographic(T,M)),E.push([T,M])}for(d=0;d<m.features.length;d++){var x=t.Math.toRadians(m.features[d].geometry.coordinates[0]),S=t.Math.toRadians(m.features[d].geometry.coordinates[1]);b.push(new t.Cartographic(x,S))}return e.sampleHeightMostDetailed(b).then(function(t){a.type="FeatureCollection";for(var e=0;e<t.length;e++)a.features.push({type:"Feature",geometry:{coordinates:[t[e].longitude,t[e].latitude],type:"Point"},properties:{z:t[e].height}});n=turf.tin(a,"z");var i=0,o=0,h=0,c=0,C=r;for(e=0;e<n.features.length;e++){var d=n.features[e].properties.a-C,u=n.features[e].properties.b-C,p=n.features[e].properties.c-C,A=[],I=[];if(d*u<0||d*p<0||u*p<0){if(d*u<0){var m=g(d,u,n.features[e],0,1,"a","b",n.features[e].properties.a,n.features[e].properties.b);A.push(m.intersection),I.push(m.vertexSerial[0],m.vertexSerial[1])}if(d*p<0){m=g(d,p,n.features[e],0,2,"a","c",n.features[e].properties.a,n.features[e].properties.c);A.push(m.intersection),I.push(m.vertexSerial[0],m.vertexSerial[1])}if(u*p<0){m=g(u,p,n.features[e],1,2,"b","c",n.features[e].properties.b,n.features[e].properties.c);A.push(m.intersection),I.push(m.vertexSerial[0],m.vertexSerial[1])}var f;if(s("a",I))o+=(f=l(n.features[e],A,[0,1,2],n.features[e].properties.a,n.features[e].properties.b,n.features[e].properties.c,C)).fillVolume,c+=f.fillArea,i+=f.excavationVolume,h+=f.excavationArea;if(s("b",I))o+=(f=l(n.features[e],A,[1,0,2],n.features[e].properties.b,n.features[e].properties.a,n.features[e].properties.c,C)).fillVolume,c+=f.fillArea,i+=f.excavationVolume,h+=f.excavationArea;if(s("c",I))o+=(f=l(n.features[e],A,[2,0,1],n.features[e].properties.c,n.features[e].properties.a,n.features[e].properties.b,C)).fillVolume,c+=f.fillArea,i+=f.excavationVolume,h+=f.excavationArea}else{var v=turf.polygon([n.features[e].geometry.coordinates[0]]),y=turf.area(v),_=1/3*[C-n.features[e].properties.a+(C-n.features[e].properties.b)+(C-n.features[e].properties.c)];_>=0?(o+=y*_,c+=y):(i+=y*_,h+=y)}}var w={fillVolume:Number(o.toFixed(3)),excavationVolume:Number(Math.abs(i).toFixed(3)),totalVolume:Number(o.toFixed(3))+Number(Math.abs(i).toFixed(3)),fillArea:Number(c.toFixed(3)),excavationArea:Number(h.toFixed(3)),totalArea:Number(c.toFixed(3))+Number(h.toFixed(3))};return new Promise(function(t){t(w)})})},a.prototype.clear=function(){this.canvas.style.cursor="default",this.handler&&!this.handler.isDestroyed()&&this.handler.destroy(),this.polylineEntity&&c(e,this.viewer.entities),this.labelEntity&&c(i,this.viewer.entities),this.polygonEntity&&c(r,this.viewer.entities),this.designPolygonEntity&&c(o,this.viewer.entities),this.designPolygonEntity_coral&&c(n,this.viewer.entities),this.polylineEntity=void 0,this.labelEntity=void 0},a.prototype.destroy=function(){this.clear(),this.viewer=void 0,this.scene=void 0,this.canvas=void 0,this.camera=void 0,this.primitives=void 0,this.designElevation=void 0,this.samplingPointsNumber=void 0,this.callback=void 0}}(window.Cesium),function(t){"use strict";var e=t.SingleBuildingWidget=function(e,i,r){this.viewer=e.viewer,this.scene=this.viewer.scene,this.globe=this.viewer.scene.globe,this.data=e.data?e.data:{},this.entities=this.viewer.entities,this.callback_click=i||function(){},this.callback_move=r||function(){},this.show=void 0===e.show||e.show,this.fillColor=e.fillColor?e.fillColor:t.Color.CORNFLOWERBLUE.withAlpha(.3),this.outline=void 0!==e.outline&&e.outline,this.outlineColor=e.outlineColor?e.outlineColor:t.Color.WHITE,this.highlightColor_click=e.highlightColor_click?e.highlightColor_click:t.Color.YELLOW.withAlpha(.3),this.highlightColor_move=e.highlightColor_move?e.highlightColor_move:t.Color.WHITE.withAlpha(.2),this._INTERSECTED_FLOOR=null,this._INTERSECTED_FLOOR2=null,this._INTERSECTED_FLOOR3=null,this.handler=new t.ScreenSpaceEventHandler(this.viewer.canvas)};function i(t,e){var i=null,r=t.drillPick(e);if(r&&r.length>0){for(var o=[],n=0;n<r.length;n++)r[n].id&&"GEO_EXTRUDE_POLYGON"==r[n].id.name&&o.push(r[n].id);if(o&&o.length>0){i=o[0];for(var a=0;a<o.length-1;a++)i=i.id<o[a+1].id?o[a+1]:i}}return i}t.defineProperties(e.prototype,{show:{set:function(t){this._show=t;for(var e=this.entities.values,i=0;i<e.length;i++)"GEO_EXTRUDE_POLYGON"==e[i].name&&(e[i].show=t)},get:function(){return this._show}}}),e.prototype.extrudeToBuilding=function(){if(this.clear(),this.data&&this.data.geometry){var e=0;this.data.properties.baseHeight?e=this.data.properties.baseHeight:(e=this.globe.getHeight({longitude:t.Math.toRadians(this.data.geometry.coordinates[0][0][0]),latitude:t.Math.toRadians(this.data.geometry.coordinates[0][0][1])}))||console.error("地形还未准备好！");for(var i=this.data.properties.levels,r=[],o=0;o<this.data.geometry.coordinates[0].length;o++)r.push(this.data.geometry.coordinates[0][o][0]),r.push(this.data.geometry.coordinates[0][o][1]);for(var n=0,a=0;a<i.length;a++){var s=e+n,l=s+i[a],g=new t.Entity({id:a+1,name:"GEO_EXTRUDE_POLYGON",description:{data:this.data,level:a+1},polygon:{hierarchy:t.Cartesian3.fromDegreesArray(r),fill:!0,material:this.fillColor,outline:this.outline,outlineColor:this.outlineColor,outlineWidth:1,height:s,extrudedHeight:l,show:this.show,closeTop:!0,closeBottom:!0}});n+=i[a],this.entities.add(g)}}},e.prototype.activate=function(){var e=this;e.handler.setInputAction(function(t){var r=i(e.scene,t.position);if(r){if(e.callback_click(r),e._INTERSECTED_FLOOR&&e._INTERSECTED_FLOOR!=r&&(e._INTERSECTED_FLOOR.polygon.material=e.fillColor),e._INTERSECTED_FLOOR=r,e._INTERSECTED_FLOOR3&&e._INTERSECTED_FLOOR3.polygon.material._color._value.equals(e.highlightColor_click)&&(e._INTERSECTED_FLOOR3.polygon.material=e.fillColor),e._INTERSECTED_FLOOR.polygon.material._color._value.equals(e.highlightColor_click))return;e._INTERSECTED_FLOOR.polygon.material=e.highlightColor_click}},t.ScreenSpaceEventType.LEFT_CLICK),e.handler.setInputAction(function(t){var r=i(e.scene,t.endPosition);if(r){if(e.callback_move(r),e._INTERSECTED_FLOOR2&&e._INTERSECTED_FLOOR2!=r&&(e._INTERSECTED_FLOOR2.polygon.material=e.fillColor),e._INTERSECTED_FLOOR2=r,e._INTERSECTED_FLOOR&&e._INTERSECTED_FLOOR.polygon.material._color._value.equals(e.fillColor)&&(e._INTERSECTED_FLOOR.polygon.material=e.highlightColor_click),e._INTERSECTED_FLOOR2.polygon.material._color._value.equals(e.highlightColor_move))return;e._INTERSECTED_FLOOR2.polygon.material=e.highlightColor_move}},t.ScreenSpaceEventType.MOUSE_MOVE)},e.prototype.highlightFloor=function(t){if(this.data&&this.data.geometry&&this._show){var e=this.entities.getById(t);this._INTERSECTED_FLOOR3&&this._INTERSECTED_FLOOR3!=e&&(this._INTERSECTED_FLOOR3.polygon.material=this.fillColor),this._INTERSECTED_FLOOR3=e,this._INTERSECTED_FLOOR3.polygon.material=this.highlightColor_click}},e.prototype.clear=function(){for(var t=this.entities.values,e=0;e<t.length;e++)"GEO_EXTRUDE_POLYGON"==t[e].name&&(this.entities.remove(t[e]),e--)},e.prototype.deActivate=function(){this.handler.removeInputAction(t.ScreenSpaceEventType.MOUSE_MOVE),this.handler.removeInputAction(t.ScreenSpaceEventType.LEFT_CLICK)},e.prototype.destroy=function(){this.clear(),this.handler=this.handler&&this.handler.destroy(),this.viewer=void 0,this.data=void 0,this.fillColor=void 0,this.outlineColor=void 0,this.highlightColor_click=void 0,this.highlightColor_move=void 0,this._INTERSECTED_FLOOR=void 0,this._INTERSECTED_FLOOR2=void 0}}(window.Cesium),function(t){"use strict";t.FlyAround=function(e){this.viewer=e.viewer,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.heading=t.Math.toDegrees(this.camera.heading),this.pitch=t.Math.toDegrees(this.camera.pitch),this.dip_angle=t.Math.toRadians(-30),this.speed=e.speed,this.height=0,this.distance=0,this.isFlying=e.isFlying,this.deltaHeight=0,this.deltaRadians=t.Math.toRadians(1),this.deltaDistance=0,this.roll=0,this.keyEvent()},t.FlyAround.prototype.play=function(e,i){var r=this,o=this.camera.heading;this.scene.preRender.addEventListener(function(n,a){if(r.isFlying){r.heading=t.Math.toDegrees(n.camera.heading),r.pitch=t.Math.toDegrees(n.camera.pitch);var s=o+=t.Math.toRadians(r.speed);r.height=(i[2]+r.deltaHeight).toFixed(1),r.distance=(e+r.deltaDistance).toFixed(1),r.camera.setView({destination:t.Cartesian3.fromDegrees(i[0],i[1],i[2]+r.deltaHeight),orientation:{heading:s,pitch:r.dip_angle,roll:r.roll}}),r.camera.moveBackward(e+r.deltaDistance)}})},t.FlyAround.prototype.pause=function(){this.viewer.scene.postRender.removeEventListener(this.play,this)},t.FlyAround.prototype.continue=function(){0!=this.viewer.entities._entities.length?(this.viewer.scene.postRender.removeEventListener(this.play,this),this.viewer.scene.postRender.addEventListener(this.play,this)):this.viewer.scene.postRender.removeEventListener(this.play,this)},t.FlyAround.prototype.stop=function(){this.viewer.scene.postRender.removeEventListener(this.play,this),this.viewer.entities.removeAll(),document.removeEventListener("keydown",this.keydownOption)},t.FlyAround.prototype.keyEvent=function(){var e=this;document.addEventListener("keydown",function(i){switch(i.keyCode){case 40:i.shiftKey?e.deltaHeight-=10:(e.dip_angle-=e.deltaRadians,e.dip_angle<-t.Math.TWO_PI&&(e.dip_angle+=t.Math.TWO_PI));break;case 38:i.shiftKey?e.deltaHeight+=10:(e.dip_angle+=e.deltaRadians,e.dip_angle>-t.Math.TWO_PI&&(e.dip_angle-=t.Math.TWO_PI));break;case 39:i.shiftKey?(e.roll+=e.deltaRadians,e.roll>t.Math.TWO_PI&&(e.roll-=t.Math.TWO_PI)):e.deltaDistance-=50;break;case 37:i.shiftKey?(e.roll-=e.deltaRadians,e.roll<t.Math.TWO_PI&&(e.roll+=t.Math.TWO_PI)):e.deltaDistance+=50}})}}(window.Cesium),function(t){"use strict";t.FreeFlight=function(e){this.viewer=e.viewer,this.direct=e.direct,this.pitch=e.pitch,this.roll=e.roll,this.height=e.height,this.speed=e.speed,this.lon=e.lon,this.lat=e.lat,this.planePrimitive=e.planePrimitive,this.hpRoll=e.hpRoll,this.fromBehind=e.fromBehind,this.isFlying=e.isFlying,this.position=e.position,this.fixedFrameTransform=e.fixedFrameTransform,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.pathPosition=new t.SampledPositionProperty,this.speedVector=new t.Cartesian3,this.center=new t.Cartesian3,this.hpRange=new t.HeadingPitchRange,this.deltaRadians=t.Math.toRadians(3),this.init(),this.keyEvent()},t.FreeFlight.prototype.init=function(){var e=this,i=this.scene.screenSpaceCameraController,r=0;this.planePrimitive.readyPromise.then(function(o){o.activeAnimations.addAll({speedup:.5,loop:t.ModelAnimationLoop.REPEAT}),r=2*Math.max(o.boundingSphere.radius,e.camera.frustum.near),i.minimumZoomDistance=.5*r,t.Matrix4.multiplyByPoint(o.modelMatrix,o.boundingSphere.center,e.center);var n=t.Math.toRadians(230),a=t.Math.toRadians(-20);e.hpRange.heading=n,e.hpRange.pitch=a,e.hpRange.range=50*r,e.camera.lookAt(e.center,e.hpRange)}),viewer.entities.add({position:this.pathPosition,name:"path",path:{show:!0,leadTime:0,trailTime:60,width:2,resolution:1,material:new t.PolylineGlowMaterialProperty({glowPower:.3,color:t.Color.PALEGOLDENROD})}})},t.FreeFlight.prototype.animation=function(){if(this.isFlying){this.direct=t.Math.toDegrees(this.hpRoll.heading).toFixed(1),this.pitch=t.Math.toDegrees(this.hpRoll.pitch).toFixed(1),this.roll=t.Math.toDegrees(this.hpRoll.roll).toFixed(1),this.speed=this.speed,this.speedVector=t.Cartesian3.multiplyByScalar(t.Cartesian3.UNIT_X,this.speed/10,this.speedVector);var e=t.Matrix4.multiplyByPoint(this.planePrimitive.modelMatrix,this.speedVector,this.position);this.pathPosition.addSample(t.JulianDate.now(),e),t.Transforms.headingPitchRollToFixedFrame(e,this.hpRoll,t.Ellipsoid.WGS84,this.fixedFrameTransform,this.planePrimitive.modelMatrix);var i=t.Cartographic.fromCartesian(e);this.lon=t.Math.toDegrees(i.longitude),this.lat=t.Math.toDegrees(i.latitude),this.height=i.height,this.fromBehind&&(t.Matrix4.multiplyByPoint(this.planePrimitive.modelMatrix,this.planePrimitive.boundingSphere.center,this.center),this.hpRange.heading=this.hpRoll.heading,this.hpRange.pitch=this.hpRoll.pitch,this.camera.lookAt(this.center,this.hpRange))}},t.FreeFlight.prototype.play=function(){this.viewer.scene.postRender.addEventListener(this.animation,this)},t.FreeFlight.prototype.pause=function(){this.viewer.scene.postRender.removeEventListener(this.animation,this)},t.FreeFlight.prototype.continue=function(){0!=this.viewer.entities._entities.length?(this.viewer.scene.postRender.removeEventListener(this.animation,this),this.viewer.scene.postRender.addEventListener(this.animation,this)):this.viewer.scene.postRender.removeEventListener(this.animation,this)},t.FreeFlight.prototype.stop=function(){this.viewer.scene.postRender.removeEventListener(this.animation,this),this.viewer.entities.removeAll(),this.scene.primitives.removeAll(),document.removeEventListener("keydown",this.keydownOption)},t.FreeFlight.prototype.keyEvent=function(){var e=this;document.addEventListener("keydown",function(i){switch(i.keyCode){case 40:i.shiftKey?e.speed=Math.max(--e.speed,1):(e.hpRoll.pitch-=e.deltaRadians,e.hpRoll.pitch<-t.Math.TWO_PI&&(e.hpRoll.pitch+=t.Math.TWO_PI));break;case 38:i.shiftKey?e.speed=Math.min(++e.speed,100):(e.hpRoll.pitch+=e.deltaRadians,e.hpRoll.pitch>t.Math.TWO_PI&&(e.hpRoll.pitch-=t.Math.TWO_PI));break;case 39:i.shiftKey?(e.hpRoll.roll+=e.deltaRadians,e.hpRoll.roll>t.Math.TWO_PI&&(e.hpRoll.roll-=t.Math.TWO_PI)):(e.hpRoll.heading+=e.deltaRadians,e.hpRoll.heading>t.Math.TWO_PI&&(e.hpRoll.heading-=t.Math.TWO_PI));break;case 37:i.shiftKey?(e.hpRoll.roll-=e.deltaRadians,e.hpRoll.roll<0&&(e.hpRoll.roll+=t.Math.TWO_PI)):(e.hpRoll.heading-=e.deltaRadians,e.hpRoll.heading<0&&(e.hpRoll.heading+=t.Math.TWO_PI))}})}}(window.Cesium),function(t){"use strict";t.RouteFly=function(e){this.viewer=e.viewer,this.cartographicArray=e.cartographicArray,this.pointArray=e.pointArray,this.start=e.start,this.stop=e.stop,this.speed=e.speed,this.deltaHeight=t.defaultValue(e.deltaHeight,10),this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.cartesian3=new t.Cartesian3(0,0,0),this.initialHeading=[],this.keydownOption=null,this.point=[],this.bearing=[],this.differentBearing=[],this.reduceBearing=[],this.HorizontalRadian=0,this.VerticalRadians=0,this.i=0,this.keyEvent()},t.RouteFly.prototype.init=function(){for(var e=0;e<this.pointArray.length;e++)this.point.push(turf.point(this.pointArray[e]));for(var i=0;i<this.point.length-1;i++)this.bearing.push(turf.bearing(this.point[i],this.point[i+1]));for(e=0;e<this.bearing.length;e++)this.initialHeading.push(t.Math.toRadians(this.bearing[e]));for(var r=0;r<this.bearing.length-1;r++)this.bearing[r+1]-this.bearing[r]<-180?(this.differentBearing.push(t.Math.toRadians(this.bearing[r+1]-this.bearing[r]+360)),this.reduceBearing.push(t.Math.toRadians(this.bearing[r+1]-this.bearing[r]+360))):this.bearing[r+1]-this.bearing[r]>180?(this.differentBearing.push(t.Math.toRadians(this.bearing[r+1]-this.bearing[r]-360)),this.reduceBearing.push(t.Math.toRadians(Math.abs(this.bearing[r+1]-this.bearing[r]-360)))):(this.differentBearing.push(t.Math.toRadians(this.bearing[r+1]-this.bearing[r])),this.reduceBearing.push(t.Math.toRadians(Math.abs(this.bearing[r+1]-this.bearing[r]))))},t.RouteFly.prototype.initializationFly=function(){this.viewer.clock.startTime=this.start.clone(),this.viewer.clock.stopTime=this.stop.clone(),this.viewer.clock.currentTime=this.start.clone(),this.viewer.clock.clockRange=t.ClockRange.CLAMPED},t.RouteFly.prototype.computeCirclularFlight=function(e){for(var i=new t.SampledPositionProperty,r=0;r<e.length;r++){var o=t.JulianDate.addSeconds(this.start,r,new t.JulianDate),n=t.Cartesian3.fromRadians(Number(e[r][0]),Number(e[r][1]),Number(e[r][2]));i.addSample(o,n),this.viewer.entities.add({position:n,point:{pixelSize:2,color:t.Color.TRANSPARENT,outlineColor:t.Color.YELLOW,outlineWidth:2}})}return i},t.RouteFly.prototype.animation=function(){if(this.cartographicArray){var e=this.computeCirclularFlight(this.cartographicArray),i=this.viewer.entities.add({availability:new t.TimeIntervalCollection([new t.TimeInterval({start:this.start,stop:this.stop})]),position:e});this.cartesian3=i.position.getValue(this.viewer.clock.currentTime);var r=this.scene.globe.ellipsoid;if(void 0==this.cartesian3)this.viewer.clock.multiplier=0,document.removeEventListener("keydown",this.keydownOption),this.viewer.scene.postRender.removeEventListener(this.animation);else{var o=r.cartesianToCartographic(this.cartesian3),n=Math.floor(1e5*t.Math.toDegrees(o.latitude))/1e5,a=Math.floor(1e5*t.Math.toDegrees(o.longitude))/1e5,s=(Math.floor(1e5*o.height),1e3*turf.distance(turf.point(this.pointArray[this.i+1]),turf.point([a,n,0]))),l=turf.distance(turf.point(this.pointArray[this.i]),turf.point(this.pointArray[this.i+1]));s<=1*(50+this.deltaHeight)/10?(this.camera.setView({destination:t.Cartesian3.fromDegrees(t.Math.toDegrees(this.cartographicArray[this.i+1][0]),t.Math.toDegrees(this.cartographicArray[this.i+1][1]),50+this.deltaHeight),orientation:{heading:this.initialHeading[this.i]+this.HorizontalRadian,pitch:t.Math.toRadians(0)+this.VerticalRadians,roll:0}}),this.viewer.clock.multiplier=0,this.i<this.reduceBearing.length?this.reduceBearing[this.i]<1e-5?(this.HorizontalRadian=0,this.i+=1,this.viewer.clock.multiplier=this.speed):(this.HorizontalRadian+=this.differentBearing[this.i]/200,this.reduceBearing[this.i]-=Math.abs(this.differentBearing[this.i]/200)):(this.viewer.clock.multiplier=0,document.removeEventListener("keydown",this.keydownOption),this.viewer.scene.postRender.removeEventListener(this.animation,this))):(this.camera.setView({destination:t.Cartesian3.fromDegrees(t.Math.toDegrees(o.longitude),t.Math.toDegrees(o.latitude),50+this.deltaHeight),orientation:{heading:this.initialHeading[this.i],pitch:t.Math.toRadians(0)+this.VerticalRadians,roll:0}}),this.viewer.clock.multiplier=l>1?this.speed*(1/l):this.speed*(1-l))}}},t.RouteFly.prototype.play=function(){this.initializationFly(),this.init(),this.scene.postRender.addEventListener(this.animation,this)},t.RouteFly.prototype.pause=function(){this.scene.postRender.removeEventListener(this.animation,this)},t.RouteFly.prototype.continue=function(){this.scene.postRender.removeEventListener(this.animation,this),this.scene.postRender.addEventListener(this.animation,this)},t.RouteFly.prototype.STOP=function(){this.scene.postRender.removeEventListener(this.animation,this),this.viewer.entities.removeAll(),document.removeEventListener("keydown",this.keydownOption),this.viewer=null,this.cartographicArray=null,this.pointArray=null,this.start=null,this.stop=null,this.speed=null,this.scene=null,this.camera=null,this.cartesian3=new t.Cartesian3(0,0,0),this.initialHeading=[],this.keydownOption=null,this.point=[],this.bearing=[],this.differentBearing=[],this.reduceBearing=[],this.deltaHeight=t.defaultValue(this.deltaHeight,10),this.HorizontalRadian=0,this.VerticalRadians=0,this.i=0},t.RouteFly.prototype.reset=function(e){this.viewer&&(this.scene.postRender.removeEventListener(this.animation,this),this.cartesian3=new t.Cartesian3(0,0,0),this.initialHeading=[],this.keydownOption=null,this.point=[],this.bearing=[],this.differentBearing=[],this.reduceBearing=[],this.deltaHeight=t.defaultValue(this.deltaHeight,10),this.HorizontalRadian=0,this.VerticalRadians=0,this.i=0,this.play())},t.RouteFly.prototype.keyEvent=function(){var t=this;this.keydownOption=function(e){switch(e.keyCode){case 40:e.shiftKey?t.deltaHeight-=1:t.VerticalRadians-=.01;break;case 38:e.shiftKey?t.deltaHeight+=1:t.VerticalRadians+=.01}},document.addEventListener("keydown",this.keydownOption)}}(window.Cesium),function(t){"use strict";t.WalkBrowse=function(t){this.viewer=t.viewer,this.pointArray=t.pointArray,this.orientationAngle=[],this.point1=turf.point(this.pointArray[0]),this.point2=turf.point(this.pointArray[1]),this.point3=turf.point(this.pointArray[2]),this.bearing1=turf.bearing(this.point1,this.point2),this.bearing2=turf.bearing(this.point2,this.point3),this.drawMarker(),this.init()},t.WalkBrowse.prototype.animation=function(){var e=this.viewer.scene.globe.ellipsoid,i=this.viewer.camera.position,r=e.cartesianToCartographic(i),o=Math.floor(1e5*t.Math.toDegrees(r.latitude))/1e5,n=Math.floor(1e5*t.Math.toDegrees(r.longitude))/1e5;n==this.pointArray[1][0]&&o==this.pointArray[1][1]?(this.orientationAngle.push(t.Math.toDegrees(this.viewer.camera.heading)),this.bearing2-t.Math.toDegrees(this.viewer.camera.heading)>=1e-12?(this.viewer.camera.moveForward(0),this.viewer.camera.lookRight(t.Math.toRadians((this.bearing2-this.orientationAngle[0])/200))):(this.orientationAngle=[],this.viewer.camera.setView({destination:t.Cartesian3.fromDegrees(this.pointArray[1][0],this.pointArray[1][1],this.pointArray[1][2]),orientation:{heading:t.Math.toRadians(this.bearing2),pitch:t.Math.toRadians(0)}}),this.viewer.camera.moveForward(this.viewer.clock.multiplier))):n-this.pointArray[2][0]>-1e-5&&o-this.pointArray[2][1]>-1e-5?this.viewer.camera.moveForward(0):this.viewer.camera.moveForward(this.viewer.clock.multiplier)},t.WalkBrowse.prototype.init=function(){this.viewer.camera.setView({destination:t.Cartesian3.fromDegrees(this.pointArray[0][0],this.pointArray[0][1],this.pointArray[0][2]),orientation:{heading:t.Math.toRadians(this.bearing1),pitch:t.Math.toRadians(0)}})},t.WalkBrowse.prototype.drawMarker=function(){this.viewer.entities.add({position:t.Cartesian3.fromDegrees(this.pointArray[1][0],this.pointArray[1][1]),point:{pixelSize:2,color:t.Color.TRANSPARENT,outlineColor:t.Color.YELLOW,outlineWidth:2}}),this.viewer.entities.add({position:t.Cartesian3.fromDegrees(this.pointArray[2][0],this.pointArray[2][1]),point:{pixelSize:2,color:t.Color.TRANSPARENT,outlineColor:t.Color.RED,outlineWidth:2}})},t.WalkBrowse.prototype.play=function(){0==this.viewer.entities._entities.length&&this.drawMarker(),this.viewer.scene.postRender.removeEventListener(this.animation,this),this.viewer.camera.setView({destination:t.Cartesian3.fromDegrees(this.pointArray[0][0],this.pointArray[0][1],this.pointArray[0][2]),orientation:{heading:t.Math.toRadians(this.bearing1),pitch:t.Math.toRadians(0)}}),this.viewer.scene.postRender.addEventListener(this.animation,this)},t.WalkBrowse.prototype.pause=function(){this.viewer.scene.postRender.removeEventListener(this.animation,this)},t.WalkBrowse.prototype.continue=function(){0!=this.viewer.entities._entities.length?(this.viewer.scene.postRender.removeEventListener(this.animation,this),this.viewer.scene.postRender.addEventListener(this.animation,this)):this.viewer.scene.postRender.removeEventListener(this.animation,this)},t.WalkBrowse.prototype.stop=function(){this.viewer.scene.postRender.removeEventListener(this.animation,this),this.viewer.entities.removeAll(),this.init()}}(window.Cesium),function(t){"use strict";var e=t.GeoHeatMap=function(e,i){return this.viewer=e.viewer,this.heatmapOptions=e.heatmapOptions,this.dataOptions=e.dataOptions,this.defaults={minCanvasSize:700,maxCanvasSize:2e3,useEntities:!0,radiusFactor:60,spacingFactor:1.5,maxOpacity:.8,minOpacity:.1,blur:.85,gradient:{.3:"blue",.65:"yellow",.8:"orange",.95:"red"}},this.heatmapOptions.useEntities=t.defaultValue(this.heatmapOptions.useEntities,this.defaults.useEntities),this.heatmapOptions.gradient=t.defaultValue(this.heatmapOptions.gradient,this.defaults.gradient),this.heatmapOptions.maxOpacity=t.defaultValue(this.heatmapOptions.maxOpacity,this.defaults.maxOpacity),this.heatmapOptions.minOpacity=t.defaultValue(this.heatmapOptions.minOpacity,this.defaults.minOpacity),this.heatmapOptions.blur=t.defaultValue(this.heatmapOptions.blur,this.defaults.blur),this};e.prototype._computeBounds=function(t){if(t&&t.features&&t.features.length>0&&t.features[0].geometry&&t.features[0].geometry.coordinates){for(var e={west:t.features[0].geometry.coordinates[0],south:t.features[0].geometry.coordinates[1],east:t.features[0].geometry.coordinates[0],north:t.features[0].geometry.coordinates[1]},i=0;i<t.features.length;i++){var r=t.features[i].geometry.coordinates[0],o=t.features[i].geometry.coordinates[1];e.west=r>e.west?e.west:r,e.east=r>e.east?r:e.east,e.south=o>e.south?e.south:o,e.north=o>e.north?o:e.north}return e}return!1},e.prototype._getContainer=function(t,e,i){var r=document.createElement("div");return i&&r.setAttribute("id",i),r.setAttribute("style","width: "+t+"px; height: "+e+"px; margin: 0px; display: none;"),document.body.appendChild(r),r},e.prototype._getImageryProvider=function(e){var i=e._heatmap.getDataURL(),r=new t.SingleTileImageryProvider({url:i,rectangle:e._rectangle});return r._tilingScheme=new t.WebMercatorTilingScheme({rectangleSouthwestInMeters:new t.Cartesian2(e._mbounds.west,e._mbounds.south),rectangleNortheastInMeters:new t.Cartesian2(e._mbounds.east,e._mbounds.north)}),r},e.prototype._getID=function(t){for(var e="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<(t||8);r++)e+=i.charAt(Math.floor(Math.random()*i.length));return e};var i=new t.WebMercatorProjection;e.prototype.wgs84ToMercator=function(e){var r=i.project(t.Cartographic.fromDegrees(e.x,e.y));return{x:r.x,y:r.y}},e.prototype.wgs84ToMercatorBB=function(e){var r=i.project(t.Cartographic.fromDegrees(e.west,e.south)),o=i.project(t.Cartographic.fromDegrees(e.east,e.north));return{north:o.y,east:o.x,south:r.y,west:r.x}},e.prototype.mercatorToWgs84=function(e){var r=i.unproject(new t.Cartesian3(e.x,e.y));return{x:r.longitude,y:r.latitude}},e.prototype.mercatorToWgs84BB=function(e){var r=i.unproject(new t.Cartesian3(e.west,e.south)),o=i.unproject(new t.Cartesian3(e.east,e.north));return{north:this.rad2deg(o.latitude),east:this.rad2deg(o.longitude),south:this.rad2deg(r.latitude),west:this.rad2deg(r.longitude)}},e.prototype.deg2rad=function(t){return t*(Math.PI/180)},e.prototype.rad2deg=function(t){return t/(Math.PI/180)},e.prototype.wgs84PointToHeatmapPoint=function(t){return this.mercatorPointToHeatmapPoint(this.wgs84ToMercator(t))},e.prototype.mercatorPointToHeatmapPoint=function(t){var e={};return e.x=Math.round((t.x-this._xoffset)/this._factor+this._spacing),e.y=Math.round((t.y-this._yoffset)/this._factor+this._spacing),e.y=this.height-e.y,e},e.prototype._setWidthAndHeight=function(t){this.width=t.east>0&&t.west<0?t.east+Math.abs(t.west):Math.abs(t.east-t.west),this.height=t.north>0&&t.south<0?t.north+Math.abs(t.south):Math.abs(t.north-t.south),this._factor=1,this.width>this.height&&this.width>this.defaults.maxCanvasSize?(this._factor=this.width/this.defaults.maxCanvasSize,this.height/this._factor<this.defaults.minCanvasSize&&(this._factor=this.height/this.defaults.minCanvasSize)):this.height>this.width&&this.height>this.defaults.maxCanvasSize?(this._factor=this.height/this.defaults.maxCanvasSize,this.width/this._factor<this.defaults.minCanvasSize&&(this._factor=this.width/this.defaults.minCanvasSize)):this.width<this.height&&this.width<this.defaults.minCanvasSize?(this._factor=this.width/this.defaults.minCanvasSize,this.height/this._factor>this.defaults.maxCanvasSize&&(this._factor=this.height/this.defaults.maxCanvasSize)):this.height<this.width&&this.height<this.defaults.minCanvasSize&&(this._factor=this.height/this.defaults.minCanvasSize,this.width/this._factor>this.defaults.maxCanvasSize&&(this._factor=this.width/this.defaults.maxCanvasSize)),this.width=this.width/this._factor,this.height=this.height/this._factor},e.prototype.setData=function(e,i,r){if(this._id=this._getID(),this._initBounds=this._computeBounds(r),this._mbounds=this.wgs84ToMercatorBB(this._initBounds),this._setWidthAndHeight(this._mbounds),this.heatmapOptions.radius=Math.round(this.heatmapOptions.radius?this.heatmapOptions.radius:this.width>this.height?this.width/this.defaults.radiusFactor:this.height/this.defaults.radiusFactor),this._spacing=this.heatmapOptions.radius*this.defaults.spacingFactor,this._xoffset=this._mbounds.west,this._yoffset=this._mbounds.south,this.width=Math.round(this.width+2*this._spacing),this.height=Math.round(this.height+2*this._spacing),this._mbounds.west-=this._spacing*this._factor,this._mbounds.east+=this._spacing*this._factor,this._mbounds.south-=this._spacing*this._factor,this._mbounds.north+=this._spacing*this._factor,this.bounds=this.mercatorToWgs84BB(this._mbounds),this._rectangle=t.Rectangle.fromDegrees(this.bounds.west,this.bounds.south,this.bounds.east,this.bounds.north),this._container?(this._id&&this._container.setAttribute("id",this._id),this._container.setAttribute("style","width: "+this.width+"px; height: "+this.height+"px; margin: 0px; display: none;")):this._container=this._getContainer(this.width,this.height,this._id),this.heatmapOptions.container=this._container,this._heatmap?this._heatmap.repaint():this._heatmap=h337.create(this.heatmapOptions),this._container.children[0].setAttribute("id",this._id+"-hm"),r&&r.features.length>0&&null!==e&&!1!==e&&null!==i&&!1!==i){for(var o=[],n=0;n<r.features.length;n++){var a={};a.x=r.features[n].geometry.coordinates[0],a.y=r.features[n].geometry.coordinates[1],a.value=r.features[n].properties.z,o.push(a)}for(var s=[],l=0;l<o.length;l++){var g=o[l],h=this.wgs84PointToHeatmapPoint(g);(g.value||0===g.value)&&(h.value=g.value),s.push(h)}return this._heatmap.setData({min:e,max:i,data:s}),this.updateLayer(),!0}return!1},e.prototype.show=function(t){this._layer&&(this._layer.show=t)},e.prototype.remove=function(){this._layer&&(this.viewer.scene.imageryLayers.remove(this._layer),this.viewer.entities.remove(this._layer))},e.prototype.updateLayer=function(){if(this.heatmapOptions.useEntities&&this.viewer.entities){this._layer&&this.viewer.entities.remove(this._layer);var e=new t.ImageMaterialProperty({image:this._heatmap._renderer.canvas});t.VERSION>="1.21"?e.transparent=!0:t.VERSION>="1.16"&&(e.alpha=.99),this._layer=this.viewer.entities.add({show:!0,rectangle:{coordinates:this._rectangle,material:e}})}else this._layer&&this.viewer.scene.imageryLayers.remove(this._layer),this._layer=this.viewer.scene.imageryLayers.addImageryProvider(this._getImageryProvider(this))}}(window.Cesium),function(t){"use strict";var e=t.GeoWind=function(e,i){return this.viewer=e.viewer,this.data=e.data,this.level=e.level,this.rectangle=e.rectangle,this.options=e.options,this.options.velocityScale=t.defaultValue(this.options.velocityScale,.11),this.options.particleMultiplier=t.defaultValue(this.options.particleMultiplier,.002),this.options.maxWindIntensity=t.defaultValue(this.options.maxWindIntensity,30),this.options.lineWidth=t.defaultValue(this.options.lineWidth,2),this.options.opacity=t.defaultValue(this.options.opacity,.6),this.options.colors=t.defaultValue(this.options.colors,["#00ffff","#64f0ff","#87e1ff","#a0d0ff","#b5c0ff","#c6adff","#d49bff","#e185ff","#ec6dff","#ff1edb"]),this.canvas=document.createElement("canvas"),this.canvasContext=this.canvas.getContext("2d"),this._initWindy(),this.setData(this.data),this};e.prototype._initWindy=function(){var t=this;this.Windy=function(){var e=t.options.velocityScale,i=t.options.maxWindIntensity,r=100,o=t.options.lineWidth,n=t.options.particleMultiplier,a=t.options.opacity,s=t.options.colors,l=[NaN,NaN,null],g=2*Math.PI,h=Math.pow(10,-5.2),c=function(t,e,i,r,o,n){var a=1-t,s=1-e,l=a*s,g=t*s,h=a*e,c=t*e,C=i[0]*l+r[0]*g+o[0]*h+n[0]*c,d=i[1]*l+r[1]*g+o[1]*h+n[1]*c;return[C,d,Math.sqrt(C*C+d*d)]},C=function(t){var e,i,r,o,n=null,a=null;return t.forEach(function(t){switch(t.header.parameterCategory+","+t.header.parameterNumber){case"2,2":n=t;break;case"2,3":a=t;break;default:t}}),i=a,r=(e=n).data,o=i.data,{header:e.header,data:function(t){return[r[t],o[t]]},interpolate:c}},d=function(t){return null!==t&&void 0!==t},u=function(t,e){return t-e*Math.floor(t/e)},p=function(t,e,i,r,o,n,a,s){var l=a[0]*n,g=a[1]*n,h=A(t,e,i,r,o,s);return a[0]=h[0]*l+h[2]*g,a[1]=h[1]*l+h[3]*g,a},A=function(t,e,i,r,o,n){var a=e<0?h:-h,s=i<0?h:-h,l=y(i,e+a,n),c=y(i+s,e,n),C=Math.cos(i/360*g);return[(l[0]-r)/a/C,(l[1]-o)/a/C,(c[0]-r)/s,(c[1]-o)/s]},I=function(t){return t/180*Math.PI},m=function(t){return t/(Math.PI/180)},f=function(t,e,i){var r=i.east-i.west,o=i.width/m(r)*360/(2*Math.PI),n=o/2*Math.log((1+Math.sin(i.south))/(1-Math.sin(i.south))),a=(i.height+n-e)/o,s=180/Math.PI*(2*Math.atan(Math.exp(a))-Math.PI/2);return[m(i.west)+t/i.width*m(r),s]},v=function(t){return Math.log(Math.tan(t/2+Math.PI/4))},y=function(t,e,i){var r=v(i.south),o=v(i.north),n=i.width/(i.east-i.west),a=i.height/(o-r),s=v(I(t));return[(I(e)-i.west)*n,s=(o-s)*a]},_=function(t,i,r){var o={},n=e,a=[],s=t.x;function g(e){for(var r=[],s=t.y;s<=t.yMax;s+=2){var l=f(e,s,i);if(l){var g=l[0],h=l[1];if(isFinite(g)){var c=b(g,h);c&&(c=p(o,g,h,e,s,n,c,i),r[s+1]=r[s]=c)}}}a[e+1]=a[e]=r}!function e(){for(var i=Date.now();s<t.width;)if(g(s),s+=2,Date.now()-i>1e3)return void setTimeout(e,25);!function(t,e,i){function r(e,i){var r=t[Math.round(e)];return r&&r[Math.round(i)]||l}r.release=function(){t=[]},r.randomize=function(t){var i,o,n=0;do{i=Math.round(Math.floor(Math.random()*e.width)+e.x),o=Math.round(Math.floor(Math.random()*e.height)+e.y)}while(null===r(i,o)[2]&&n++<30);return t.x=i,t.y=o,t},i(e,r)}(a,t,r)}()},w=function(e,l){function g(t){return"#"==t.charAt(0)?t.substring(1,7):t}var h,c,C=(h=i,c=[],s.forEach(function(t){c.push("rgba("+parseInt(g(t).substring(0,2),16)+", "+parseInt(g(t).substring(2,4),16)+", "+parseInt(g(t).substring(4,6),16)+", "+a+")")}),c.indexFor=function(t){return Math.floor(Math.min(t,h)/h*(c.length-1))},c),d=C.map(function(){return[]}),u=Math.round(e.width*e.height*n);/android|blackberry|iemobile|ipad|iphone|ipod|opera mini|webos/i.test(navigator.userAgent)&&(u*=.075);for(var p=[],A=0;A<u;A++)p.push(l.randomize({age:Math.floor(Math.random()*r)+0}));var I=t.canvasContext;I.lineWidth=o,I.fillStyle="rgba(0, 0, 0, 0.97)",function t(){try{E.timer=setTimeout(function(){var i;requestAnimationFrame(t),d.forEach(function(t){t.length=0}),p.forEach(function(t){t.age>r&&(l.randomize(t).age=0);var e=t.x,i=t.y,o=l(e,i),n=o[2];if(null===n)t.age=r;else{var a=e+o[0],s=i+o[1];null!==l(a,s)[2]?(t.xt=a,t.yt=s,d[C.indexFor(n)].push(t)):(t.x=a,t.y=s)}t.age+=1}),i=I.globalCompositeOperation,I.globalCompositeOperation="destination-in",I.fillRect(e.x,e.y,e.width,e.height),I.globalCompositeOperation=i,d.forEach(function(t,e){t.length>0&&(I.beginPath(),I.strokeStyle=C[e],t.forEach(function(t){I.moveTo(t.x,t.y),I.lineTo(t.xt,t.yt),t.x=t.xt,t.y=t.yt}),I.stroke())})},50)}catch(t){console.error(t)}}()},P=function(){E.field&&E.field.release(),E.timer&&clearTimeout(E.timer)},b=function(t){var e=C(t),i=e.header,r=i.lo1,o=i.la1,n=i.dx,a=i.dy,s=i.nx,l=i.ny,g=new Date(i.refTime);g.setHours(g.getHours()+i.forecastTime);for(var h=[],c=0,p=Math.floor(s*n)>=360,A=0;A<l;A++){for(var I=[],m=0;m<s;m++,c++)I[m]=e.data(c);p&&I.push(I[0]),h[A]=I}return function(t,i){var s,l=u(t-r,360)/n,g=(o-i)/a,c=Math.floor(l),C=c+1,p=Math.floor(g),A=p+1;if(s=h[p]){var I=s[c],m=s[C];if(d(I)&&d(m)&&(s=h[A])){var f=s[c],v=s[C];if(d(f)&&d(v))return e.interpolate(l-c,g-p,I,m,f,v)}}return null}}(t.data),E={start:function(t,e,i,r){var o={south:I(r[0][1]),north:I(r[1][1]),east:I(r[1][0]),west:I(r[0][0]),width:e,height:i};P(),_((n=t,a=e,s=i,l=n[0],g=n[1],h=Math.round(l[0]),c=Math.max(Math.floor(l[1],0),0),Math.min(Math.ceil(g[0],a),a-1),{x:h,y:c,xMax:a,yMax:Math.min(Math.ceil(g[1],s),s-1),width:a,height:s}),o,function(t,e){E.field=e,w(t,e)});var n,a,s,l,g,h,c},stop:P};return E}},e.prototype._calculateBounds=function(){var e=this.rectangle[0][0],i=this.rectangle[1][1],r=this.rectangle[1][0],o=this.rectangle[0][1],n=this.level,a=this._locationCoordinate(e,o,n),s=this._locationCoordinate(r,i,n);this._size=[512*Math.abs(a[0]-s[0]),512*Math.abs(a[1]-s[1])],this._bounds=[[e,o],[r,i]],this._rectangle=t.Rectangle.fromDegrees(e,o,r,i)},e.prototype._locationCoordinate=function(t,e,i){return[(180+t)*Math.pow(2,i)/360,(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))*Math.pow(2,i)/360]},e.prototype._getCenterPoint=function(){var e=this.viewer.canvas,i=new t.Cartesian2(e.clientWidth/2,e.clientHeight/2),r=this.viewer.camera.getPickRay(i);return this.viewer.scene.globe.pick(r,this.viewer.scene)||this.viewer.camera.pickEllipsoid(i)},e.prototype._getLevel=function(){var e=t.Ellipsoid.WGS84,i=this._getCenterPoint();if(!i){var r=this.viewer.scene.globe,o=this.viewer.camera.positionCartographic.clone(),n=r.getHeight(o);o.height=n||0,i=e.cartographicToCartesian(o)}var a=t.Cartesian3.distance(i,this.viewer.camera.position)/1405.5;return Math.log2(78271.51696402031/a)-1.2},e.prototype.show=function(t){this._layer&&(this._layer.show=t)},e.prototype.remove=function(){this._layer&&this.viewer.entities.remove(this._layer)},e.prototype.updateLayer=function(){var e=this;this._calculateBounds(),this.canvas.width=Math.round(this._size[0]),this.canvas.height=Math.round(this._size[1]),setTimeout(function(){e.windy.start([[0,0],e._size],e._size[0],e._size[1],e._bounds)},1),this._layer&&this.viewer.entities.remove(this._layer);var i=new t.ImageMaterialProperty({image:new t.CallbackProperty(function(){return e.canvas.toDataURL()},!1)});t.VERSION>="1.21"?i.transparent=!0:t.VERSION>="1.16"&&(i.alpha=.99),this._layer=this.viewer.entities.add({rectangle:{coordinates:this._rectangle,material:i}})},e.prototype.setData=function(t){this.data=t,this.windy=new this.Windy,this.updateLayer()}}(window.Cesium),function(t){"use strict";var e=t.GeoGeographicTilingScheme=function(e){e=t.defaultValue(e,{}),this._numberOfLevelZeroTilesX=t.defaultValue(e.numberOfLevelZeroTilesX,1),this._numberOfLevelZeroTilesY=t.defaultValue(e.numberOfLevelZeroTilesY,.5),this._ellipsoid=t.defaultValue(e.ellipsoid,t.Ellipsoid.WGS84),this._rectangle=t.defaultValue(e.rectangle,t.Rectangle.MAX_VALUE),this._projection=new t.GeographicProjection(this._ellipsoid)};e.prototype=new t.GeographicTilingScheme,delete e.prototype._numberOfLevelZeroTilesX,delete e.prototype._numberOfLevelZeroTilesY,delete e.prototype._ellipsoid,delete e.prototype._rectangle,delete e.prototype._projection,e.prototype.getNumberOfYTilesAtLevel=function(t){return this._numberOfLevelZeroTilesY*Math.pow(2,t)}}(window.Cesium),function(t){"use strict";var e=t.GeoTerrainProvider=function(e){if(e=t.defaultValue(e,t.defaultValue.EMPTY_OBJECT),!t.defined(e.urls))throw new t.DeveloperError("options.urls is required.");this._dataType=t.defaultValue(e.dataType,t.GeoTerrainProvider.INT),this._urls=e.urls,this._urls_length=this._urls.length,this._url_i=0,this._url_step=0,this._maxTerrainLevel=t.defaultValue(e.dataType,t.GeoTerrainProvider.INT),this._errorEvent=new t.Event,this._ready=!1,this._readyPromise=t.when.defer(),this._proxy=e.proxy,this._terrainDataStructure={heightScale:.001,heightOffset:-1e3,elementsPerHeight:3,stride:4,elementMultiplier:256,isBigEndian:!0};var i=e.credit;"string"==typeof i&&(i=new t.Credit(i)),this._credit=i,this._tilingScheme=void 0,this._rectangles=[];var r=t.defaultValue(e.ellipsoid,t.Ellipsoid.WGS84);this._tilingScheme=new t.GeographicTilingScheme({ellipsoid:r}),this._heightmapWidth=64,this._heightmapHeight=64,this._levelZeroMaximumGeometricError=t.TerrainProvider.getEstimatedLevelZeroGeometricErrorForAHeightmap(r,Math.min(this._heightmapWidth,this._heightmapHeight),this._tilingScheme.getNumberOfXTilesAtLevel(0)),this._ready=!0,this._readyPromise.resolve(!0),this._name=e.name,this._opacity=e.opacity,this._maxExtent=e.maxExtent,this._topLevel=t.defaultValue(e.topLevel,5),this._bottomLevel=t.defaultValue(e.bottomLevel,25)};function i(e,i){return(i=t.defined(i)?i:new t.Request).url=e,i.requestFunction=function(){var i,r,o=new XMLHttpRequest;return o.open("GET",e,!0),o.responseType="arraybuffer",o.async=!1,o.send(null),i=o,r=t.when.defer(),i.onreadystatechange=function(){if(4===i.readyState&&200===i.status&&t.defined(i.response)){for(var e=new DataView(i.response),o=new Uint8Array(e.byteLength),n=0;n<e.byteLength;)o[n]=e.getUint8(n,!0),n++;var a=function(e){if(!(e.length<1e3)){var i=new Zlib.Inflate(e);return t.defined(i)?i.decompress():void 0}}(o);t.defined(a)?r.resolve(a):r.reject(void 0)}},r.promise},t.RequestScheduler.request(i)}t.defineProperties(e.prototype,{errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){return this._credit}},tilingScheme:{get:function(){if(!this.ready)throw new t.DeveloperError("requestTileGeometry must not be called before ready returns true.");return this._tilingScheme}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},hasWaterMask:{get:function(){return!1}},hasVertexNormals:{get:function(){return!1}}}),e.prototype.requestTileGeometry=function(e,r,n,a){if(!this.ready)throw new t.DeveloperError("requestTileGeometry must not be called before ready returns true.");this._urls_length>1&&(this._url_step<8?this._url_step++:(this._url_step=0,this._url_i++,this._url_i>=this._urls_length&&(this._url_i=0)));var s=this._urls[this._url_i];this._tilingScheme.getNumberOfYTilesAtLevel(n);if(n<this._bottomLevel&&n>=this._topLevel){var l,g=s+(-1===s.indexOf("?")?"?":"&")+"x="+e+"&y="+r+"&l="+(n+1),h=this._proxy;if(t.defined(h)&&(g=h.getURL(g)),a=t.defaultValue(a,!0)){if(l=i(g,a),!t.defined(l))return}else l=i(g);var c=this;return t.when(l,function(i){var a=c.transformBuffer(i);if(t.defined(a)){var s=new t.HeightmapTerrainData({buffer:a,width:c._heightmapWidth,height:c._heightmapHeight,childTileMask:o(c,e,r,n),structure:c._terrainDataStructure});return s._skirtHeight=6e3,s}})}if(n<this._topLevel){var C=this._heightmapWidth,d=this._heightmapHeight,u=o(this,e,r,n),p=this._terrainDataStructure;return new t.HeightmapTerrainData({buffer:this.getvHeightBuffer(),width:C,height:d,childTileMask:u,structure:p})}},e.prototype.getLevelMaximumGeometricError=function(e){if(!this.ready)throw new t.DeveloperError("requestTileGeometry must not be called before ready returns true.");return this._levelZeroMaximumGeometricError/(1<<e)},e.prototype.getTileDataAvailable=function(t,e,i){if(i<25)return!0},e.prototype.getvHeightBuffer=function(){var e=this._vHeightBuffer;if(!t.defined(e)){e=new Uint8ClampedArray(this._heightmapWidth*this._heightmapHeight*4);for(var i=0;i<this._heightmapWidth*this._heightmapHeight*4;)e[i++]=15,e[i++]=66,e[i++]=64,e[i++]=255;this._vHeightBuffer=e}return e},e.prototype.transformBuffer=function(e){var i=2;this._dataType===t.GeoTerrainProvider.INT?i=2:this._dataType===t.GeoTerrainProvider.FLOAT&&(i=4);var r=e;if(r.length===22500*i){for(var o,n,a,s,l,g=new ArrayBuffer(i),h=new DataView(g),c=this._heightmapWidth,C=this._heightmapHeight,d=new Uint8Array(c*C*4),u=0;u<C;u++)for(var p=0;p<c;p++){s=parseInt(149*u/(C-1)),l=parseInt(149*p/(c-1)),149*u/(C-1),149*p/(c-1),4===i?(n=i*(150*s+l),h.setInt8(0,r[n]),h.setInt8(1,r[n+1]),h.setInt8(2,r[n+2]),h.setInt8(3,r[n+3]),o=h.getFloat32(0,!0)):o=r[n=i*(150*s+l)]+256*r[n+1],(o>1e4||o<-2e3)&&(o=0);var A=(o+1e3)/.001;d[a=4*(u*c+p)]=A/65536,d[a+1]=(A-256*d[a]*256)/256,d[a+2]=A-256*d[a]*256-256*d[a+1],d[a+3]=255}return d}return null};var r=new t.Rectangle;function o(e,i,o,a){for(var s=e._tilingScheme,l=e._rectangles,g=s.tileXYToRectangle(i,o,a),h=0,c=0;c<l.length&&15!==h;++c){var C=l[c];if(!(C.maxLevel<=a)){var d=C.rectangle,u=t.Rectangle.intersection(d,g,r);t.defined(u)&&(n(s,d,2*i,2*o,a+1)&&(h|=4),n(s,d,2*i+1,2*o,a+1)&&(h|=8),n(s,d,2*i,2*o+1,a+1)&&(h|=1),n(s,d,2*i+1,2*o+1,a+1)&&(h|=2))}}return h}function n(e,i,o,n,a){var s=e.tileXYToRectangle(o,n,a);return t.defined(t.Rectangle.intersection(s,i,r))}e.INT="int",e.FLOAT="float"}(window.Cesium),Cesium.VERSION>=1.5){var fixGltf=function(t){if(t.extensionsUsed&&(!t.extensionsUsed||-1!=t.extensionsUsed.indexOf("KHR_technique_webgl"))){var e=t.extensionsUsed.indexOf("KHR_technique_webgl"),i=t.extensionsRequired.indexOf("KHR_technique_webgl");if(-1!==e){t.extensionsRequired.splice(i,1,"KHR_techniques_webgl"),t.extensionsUsed.splice(e,1,"KHR_techniques_webgl"),t.extensions=t.extensions||{},t.extensions.KHR_techniques_webgl={},t.extensions.KHR_techniques_webgl.programs=t.programs,t.extensions.KHR_techniques_webgl.shaders=t.shaders,t.extensions.KHR_techniques_webgl.techniques=t.techniques;var r=t.extensions.KHR_techniques_webgl.techniques;t.materials.forEach(function(e,i){t.materials[i]&&t.materials[i].name&&(t.materials[i].extensions={KHR_technique_webgl:{technique:t.materials[i].technique,values:{diffuse:0}}}),void 0===t.materials[i].extensions&&(t.materials[i].extensions={},t.materials[i].extensions.KHR_technique_webgl={}),t.materials[i].extensions.KHR_technique_webgl.values=t.materials[i].values,t.materials[i].extensions.KHR_techniques_webgl=t.materials[i].extensions.KHR_technique_webgl;var o=t.materials[i].extensions.KHR_techniques_webgl;for(var n in o.values){void 0===o.technique&&(o.technique=t.materials[i].technique);var a=r[o.technique].uniforms;for(var s in a)if(a[s]===n){o.values[s]=o.values[n],delete o.values[n];break}}}),r.forEach(function(t){for(var e in t.attributes){var i=t.attributes[e];t.attributes[e]=t.parameters[i]}for(var r in t.uniforms){i=t.uniforms[r];t.uniforms[r]=t.parameters[i]}})}}};Object.defineProperties(Cesium.Model.prototype,{_cachedGltf:{set:function(t){this._vtxf_cachedGltf=t,this._vtxf_cachedGltf&&this._vtxf_cachedGltf._gltf&&fixGltf(this._vtxf_cachedGltf._gltf)},get:function(){return this._vtxf_cachedGltf}}})}!function(t){"use strict";var e=t.defaultValue;t.defined;function i(i){i=e(i,e.EMPTY_OBJECT),this.viewer=i.viewer,this.tileset=i.tileset,this.source=i.source,this.autoActivate=e(i.autoActivate,!0),this.active=e(i.active,null),this.showDefaultSelectedEntity=e(i.showDefaultSelectedEntity,!0),this.originalColor=e(i.originalColor,t.Color.fromBytes(255,50,50,1)),this.moveColor=e(i.moveColor,t.Color.fromBytes(255,50,50,122)),this.selectedColor=e(i.selectedColor,t.Color.fromBytes(50,255,50,122)),this.selectedFeature=void 0,this.dataSource=void 0,this.selectedEntity=new t.Entity,this.wrappedBoxDataSource=void 0,this.source&&"geojson"===this.source.type&&this._loadGeoJSON(this.source.data),this.handler=new t.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.autoActivate&&this.activateAction(),this._seletedEvent=new t.Event}t.defineProperties(i.prototype,{seletedEvent:{get:function(){return this._seletedEvent}}}),i.prototype._loadGeoJSON=function(e){var i=this;t.GeoJsonDataSource.load(e).then(function(t){i.dataSource=t,i.viewer.dataSources.add(t);for(var e=t.entities.values,r=0;r<e.length;r++){var o=e[r],n=i.originalColor;o.polygon.material=n,o.polygon.outline=!1,o.polygon.height=o.properties.minheight,o.polygon.extrudedHeight=o.properties.maxheight}})},i.prototype.reloadGeoJSON=function(t){this.dataSource=this.viewer.dataSources.remove(this.dataSource)?null:this.dataSource,this._loadGeoJSON(t)},i.prototype.showSelectedEntity=function(t){if(t&&t.id){this.selectedEntity.name=t.id.name,this.viewer.selectedEntity=this.selectedEntity;for(var e=t.id.properties.propertyNames,i='<table class="cesium-infoBox-defaultTable"><tbody>',r=0;r<e.length;r++)i+="<tr><th>"+e[r]+"</th><td>"+t.id.properties[e[r]].getValue()+"</td></tr>";i+="</tbody></table>",this.selectedEntity.description=i}},i.prototype.isContaintFeature=function(t){for(var e=this.dataSource.entities.values,i=0;i<e.length;i++)if(e[i]===t.id)return!0;return!1},i.prototype.showWrappedBox=function(e){var i=this;i.hideWrappedBox(),t.GeoJsonDataSource.load(e).then(function(t){i.viewer.dataSources.add(t);for(var e=t.entities.values,r=0;r<e.length;r++){var o=e[r],n=i.selectedColor;o.polygon.material=n,o.polygon.outline=!1,o.polygon.height=o.properties.minheight,o.polygon.extrudedHeight=o.properties.maxheight}i.wrappedBoxDataSource=t})},i.prototype.hideWrappedBox=function(){this.wrappedBoxDataSource&&(this.viewer.dataSources.remove(this.wrappedBoxDataSource),this.wrappedBoxDataSource=void 0)},i.prototype.activateAction=function(){if(!0!==this.active){this.active=!0;var e=this,i=null,r=null;e.handler.setInputAction(function(o){if(i&&i.id){if(r&&r.id&&i&&i.id&&i.id.id===r.id.id)return;i.id.polygon.material=e.originalColor,i=void 0}for(var n=void 0,a=e.viewer.scene.drillPick(o.endPosition,10),s=0;s<a.length;s++)if(a[s].id&&a[s].id instanceof t.Entity){n=a[s];break}if(t.defined(n)&&(!r&&n&&n.id||n&&n.id&&r&&r.id&&n.id.id!==r.id.id)){if(!e.isContaintFeature(n))return;i=n,n.id.polygon.material=e.moveColor}},t.ScreenSpaceEventType.MOUSE_MOVE),e.handler.setInputAction(function(o){r&&(r.id.polygon.material=e.originalColor,r=void 0,e.selectedFeature=r);for(var n=void 0,a=e.viewer.scene.drillPick(o.position,10),s=0;s<a.length;s++)if(a[s].id&&a[s].id instanceof t.Entity){n=a[s];break}if(t.defined(n)){if(r!==n){if(n&&n.id&&r!==n){if(!e.isContaintFeature(n))return;r=n,n.id.polygon.material=e.selectedColor,e.selectedFeature=r}n&&r&&i&&n.id===i.id&&(i=void 0),n&&n.id?(e.showDefaultSelectedEntity?e.showSelectedEntity(n):e.viewer.selectedEntity=null,e._seletedEvent.raiseEvent(n)):e.viewer.selectedEntity=null}}else e.viewer.selectedEntity=null},t.ScreenSpaceEventType.LEFT_CLICK)}},i.prototype.deactivateAction=function(){if(!0===this.active){this.active=!1;this.selectedFeature&&this.selectedFeature.id&&(this.selectedFeature.id.polygon.material=this.originalColor,this.selectedFeature=null,this.viewer.selectedEntity=null),this.handler.removeInputAction(t.ScreenSpaceEventType.MOUSE_MOVE),this.handler.removeInputAction(t.ScreenSpaceEventType.LEFT_CLICK)}},i.prototype.destroy=function(){this.deactivateAction(),this.handler=this.handler&&this.handler.destroy(),this.dataSource=this.viewer.dataSources.remove(this.dataSource)?null:this.dataSource,this.viewer=void 0,this.tileset=void 0,this.source=void 0,this.originalColor=void 0,this.moveColor=void 0,this.selectedColor=void 0,this.selectedFeature=void 0,this.selectedEntity=void 0},t.Cesium3DTilesetMonomer=i}(window.Cesium),function(t){"use strict";var e=t.BoundingSphere,i=t.Cartesian2,r=t.Cartesian3,o=t.Cartesian4,n=t.Cartographic,a=t.defaultValue,s=t.defined,l=t.defineProperties,g=t.DeveloperError,h=t.EasingFunction,c=t.Ellipsoid,C=t.EllipsoidGeodesic,d=t.Event,u=t.HeadingPitchRange,p=t.HeadingPitchRoll,A=t.Intersect,I=t.IntersectionTests,m=t.Math,f=t.Matrix3,v=t.Matrix4,y=t.OrthographicFrustum,_=t.OrthographicOffCenterFrustum,w=t.PerspectiveFrustum,P=t.Quaternion,b=t.Ray,E=t.Rectangle,T=t.Transforms,M=t.CameraFlightPath,x=t.MapMode2D,S=t.SceneMode;function L(t){if(!s(t))throw new g("scene is required.");this._scene=t,this._transform=v.clone(v.IDENTITY),this._invTransform=v.clone(v.IDENTITY),this._actualTransform=v.clone(v.IDENTITY),this._actualInvTransform=v.clone(v.IDENTITY),this._transformChanged=!1,this.position=new r,this._position=new r,this._positionWC=new r,this._positionCartographic=new n,this.direction=new r,this._direction=new r,this._directionWC=new r,this.up=new r,this._up=new r,this._upWC=new r,this.right=new r,this._right=new r,this._rightWC=new r,this.frustum=new w,this.frustum.aspectRatio=t.drawingBufferWidth/t.drawingBufferHeight,this.frustum.fov=m.toRadians(60),this.defaultMoveAmount=1e5,this.defaultLookAmount=Math.PI/60,this.defaultRotateAmount=Math.PI/3600,this.defaultZoomAmount=1e5,this.constrainedAxis=void 0,this.maximumZoomFactor=1.5,this._moveStart=new d,this._moveEnd=new d,this._changed=new d,this._changedPosition=void 0,this._changedDirection=void 0,this._changedFrustum=void 0,this.percentageChanged=.5,this._viewMatrix=new v,this._invViewMatrix=new v,R(this),this._mode=S.SCENE3D,this._modeChanged=!0;var e=t.mapProjection;this._projection=e,this._maxCoord=e.project(new n(Math.PI,m.PI_OVER_TWO)),this._max2Dfrustum=void 0,this._suspendTerrainAdjustment=!1,Kt(this,L.DEFAULT_VIEW_RECTANGLE,this.position,!0);var i=r.magnitude(this.position);i+=i*L.DEFAULT_VIEW_FACTOR,r.normalize(this.position,this.position),r.multiplyByScalar(this.position,i,this.position)}function R(t){v.computeView(t._position,t._direction,t._up,t._right,t._viewMatrix),v.multiply(t._viewMatrix,t._actualInvTransform,t._viewMatrix),v.inverseTransformation(t._viewMatrix,t._invViewMatrix)}L.TRANSFORM_2D=new v(0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1),L.TRANSFORM_2D_INVERSE=v.inverseTransformation(L.TRANSFORM_2D,new v),L.DEFAULT_VIEW_RECTANGLE=E.fromDegrees(-95,-20,-70,90),L.DEFAULT_VIEW_FACTOR=.5,L.DEFAULT_OFFSET=new u(0,-m.PI_OVER_FOUR,0),L.prototype._updateCameraChanged=function(){if(0!==this._changed.numberOfListeners){var t=this.percentageChanged;if(this._mode!==S.SCENE2D){if(!s(this._changedDirection))return this._changedPosition=r.clone(this.positionWC,this._changedPosition),void(this._changedDirection=r.clone(this.directionWC,this._changedDirection));var e,i=m.acosClamped(r.dot(this.directionWC,this._changedDirection));e=s(this.frustum.fovy)?i/(.5*this.frustum.fovy):i;var o=r.distance(this.positionWC,this._changedPosition)/this.positionCartographic.height;(e>t||o>t)&&(this._changed.raiseEvent(Math.max(e,o)),this._changedPosition=r.clone(this.positionWC,this._changedPosition),this._changedDirection=r.clone(this.directionWC,this._changedDirection))}else{if(!s(this._changedFrustum))return this._changedPosition=r.clone(this.position,this._changedPosition),void(this._changedFrustum=this.frustum.clone());var n,a=this.position,l=this._changedPosition,g=this.frustum,h=this._changedFrustum,c=a.x+g.left,C=a.x+g.right,d=l.x+h.left,u=l.x+h.right,p=a.y+g.bottom,A=a.y+g.top,I=l.y+h.bottom,f=l.y+h.top,v=Math.max(c,d),y=Math.min(C,u),_=Math.max(p,I),w=Math.min(A,f);if(v>=y||_>=A)n=1;else{var P=h;c<d&&C>u&&p<I&&A>f&&(P=g),n=1-(y-v)*(w-_)/((P.right-P.left)*(P.top-P.bottom))}n>t&&(this._changed.raiseEvent(n),this._changedPosition=r.clone(this.position,this._changedPosition),this._changedFrustum=this.frustum.clone(this._changedFrustum))}}};var D=new v,k=new n;L.prototype._adjustHeightForTerrain=function(){var t=this._scene,e=t.screenSpaceCameraController,i=e.enableCollisionDetection,o=e.minimumCollisionTerrainHeight,n=e.minimumZoomDistance;if(!this._suspendTerrainAdjustment&&i){var a=this._mode,l=t.globe;if(s(l)&&a!==S.SCENE2D&&a!==S.MORPHING){var g,h,c=l.ellipsoid,C=t.mapProjection;v.equals(this.transform,v.IDENTITY)||(g=v.clone(this.transform,D),h=r.magnitude(this.position),this._setTransform(v.IDENTITY));var d=k;a===S.SCENE3D?c.cartesianToCartographic(this.position,d):C.unproject(this.position,d);var u=!1;if(d.height<o){var p=l.getHeight(d);s(p)&&(p+=n,d.height<p&&(d.height=p,a===S.SCENE3D?c.cartographicToCartesian(d,this.position):C.project(d,this.position),u=!0))}s(g)&&(this._setTransform(g),u&&(r.normalize(this.position,this.position),r.negate(this.position,this.direction),r.multiplyByScalar(this.position,Math.max(h,n),this.position),r.normalize(this.direction,this.direction),r.cross(this.direction,this.up,this.right),r.cross(this.right,this.direction,this.up)))}}};var O=new n,F=new r,H=new r,B=new o,N=new o,G=new o,W=new o,U=new o;var V=new r;function z(t){var e=t._mode,i=!1,n=0;e===S.SCENE2D&&(i=(n=t.frustum.right-t.frustum.left)!==t._positionCartographic.height);var a=t._position,s=!r.equals(a,t.position)||i;s&&(a=r.clone(t.position,t._position));var l=t._direction,g=!r.equals(l,t.direction);g&&(r.normalize(t.direction,t.direction),l=r.clone(t.direction,t._direction));var h=t._up,c=!r.equals(h,t.up);c&&(r.normalize(t.up,t.up),h=r.clone(t.up,t._up));var C=t._right,d=!r.equals(C,t.right);d&&(r.normalize(t.right,t.right),C=r.clone(t.right,t._right));var u,p=t._transformChanged||t._modeChanged;t._transformChanged=!1,p&&(v.inverseTransformation(t._transform,t._invTransform),t._mode===S.COLUMBUS_VIEW||t._mode===S.SCENE2D?v.equals(v.IDENTITY,t._transform)?v.clone(L.TRANSFORM_2D,t._actualTransform):t._mode===S.COLUMBUS_VIEW?(u=t,T.basisTo2D(u._projection,u._transform,u._actualTransform)):function(t){var e=t._projection,i=e.ellipsoid,n=v.getColumn(t._transform,3,B),a=i.cartesianToCartographic(n,O),s=e.project(a,F),l=N;l.x=s.z,l.y=s.x,l.z=s.y,l.w=1;var g=o.clone(o.UNIT_X,U),h=o.add(v.getColumn(t._transform,0,H),n,H);i.cartesianToCartographic(h,a),e.project(a,s);var c=G;c.x=s.z,c.y=s.x,c.z=s.y,c.w=0,r.subtract(c,l,c),c.x=0;var C=W;if(r.magnitudeSquared(c)>m.EPSILON10)r.cross(g,c,C);else{var d=o.add(v.getColumn(t._transform,1,H),n,H);i.cartesianToCartographic(d,a),e.project(a,s),C.x=s.z,C.y=s.x,C.z=s.y,C.w=0,r.subtract(C,l,C),C.x=0,r.magnitudeSquared(C)<m.EPSILON10&&(o.clone(o.UNIT_Y,c),o.clone(o.UNIT_Z,C))}r.cross(C,g,c),r.normalize(c,c),r.cross(g,c,C),r.normalize(C,C),v.setColumn(t._actualTransform,0,c,t._actualTransform),v.setColumn(t._actualTransform,1,C,t._actualTransform),v.setColumn(t._actualTransform,2,g,t._actualTransform),v.setColumn(t._actualTransform,3,l,t._actualTransform)}(t):v.clone(t._transform,t._actualTransform),v.inverseTransformation(t._actualTransform,t._actualInvTransform),t._modeChanged=!1);var A=t._actualTransform;if(s||p)if(t._positionWC=v.multiplyByPoint(A,a,t._positionWC),e===S.SCENE3D||e===S.MORPHING)t._positionCartographic=t._projection.ellipsoid.cartesianToCartographic(t._positionWC,t._positionCartographic);else{var I=V;I.x=t._positionWC.y,I.y=t._positionWC.z,I.z=t._positionWC.x,e===S.SCENE2D&&(I.z=n),t._projection.unproject(I,t._positionCartographic)}if(g||c||d){var f=r.dot(l,r.cross(h,C,V));if(Math.abs(1-f)>m.EPSILON2){var y=1/r.magnitudeSquared(h),_=r.dot(h,l)*y,w=r.multiplyByScalar(l,_,V);h=r.normalize(r.subtract(h,w,t._up),t._up),r.clone(h,t.up),C=r.cross(l,h,t._right),r.clone(C,t.right)}}(g||p)&&(t._directionWC=v.multiplyByPointAsVector(A,l,t._directionWC),r.normalize(t._directionWC,t._directionWC)),(c||p)&&(t._upWC=v.multiplyByPointAsVector(A,h,t._upWC),r.normalize(t._upWC,t._upWC)),(d||p)&&(t._rightWC=v.multiplyByPointAsVector(A,C,t._rightWC),r.normalize(t._rightWC,t._rightWC)),(s||g||c||d||p)&&R(t)}function Z(t,e){var i;return i=m.equalsEpsilon(Math.abs(t.z),1,m.EPSILON3)?Math.atan2(e.y,e.x)-m.PI_OVER_TWO:Math.atan2(t.y,t.x)-m.PI_OVER_TWO,m.TWO_PI-m.zeroToTwoPi(i)}function q(t){return m.PI_OVER_TWO-m.acosClamped(t.z)}function j(t,e,i){var r=0;return m.equalsEpsilon(Math.abs(t.z),1,m.EPSILON3)||(r=Math.atan2(-i.z,e.z),r=m.zeroToTwoPi(r+m.TWO_PI)),r}var Y=new v,K=new v;l(L.prototype,{transform:{get:function(){return this._transform}},inverseTransform:{get:function(){return z(this),this._invTransform}},viewMatrix:{get:function(){return z(this),this._viewMatrix}},inverseViewMatrix:{get:function(){return z(this),this._invViewMatrix}},positionCartographic:{get:function(){return z(this),this._positionCartographic}},positionWC:{get:function(){return z(this),this._positionWC}},directionWC:{get:function(){return z(this),this._directionWC}},upWC:{get:function(){return z(this),this._upWC}},rightWC:{get:function(){return z(this),this._rightWC}},heading:{get:function(){if(this._mode!==S.MORPHING){var t=this._projection.ellipsoid,e=v.clone(this._transform,Y),i=T.eastNorthUpToFixedFrame(this.positionWC,t,K);this._setTransform(i);var r=Z(this.direction,this.up);return this._setTransform(e),r}}},pitch:{get:function(){if(this._mode!==S.MORPHING){var t=this._projection.ellipsoid,e=v.clone(this._transform,Y),i=T.eastNorthUpToFixedFrame(this.positionWC,t,K);this._setTransform(i);var r=q(this.direction);return this._setTransform(e),r}}},roll:{get:function(){if(this._mode!==S.MORPHING){var t=this._projection.ellipsoid,e=v.clone(this._transform,Y),i=T.eastNorthUpToFixedFrame(this.positionWC,t,K);this._setTransform(i);var r=j(this.direction,this.up,this.right);return this._setTransform(e),r}}},moveStart:{get:function(){return this._moveStart}},moveEnd:{get:function(){return this._moveEnd}},changed:{get:function(){return this._changed}}}),L.prototype.update=function(t){if(!s(t))throw new g("mode is required.");if(t===S.SCENE2D&&!(this.frustum instanceof _))throw new g("An OrthographicOffCenterFrustum is required in 2D.");if(!(t!==S.SCENE3D&&t!==S.COLUMBUS_VIEW||this.frustum instanceof w||this.frustum instanceof y))throw new g("A PerspectiveFrustum or OrthographicFrustum is required in 3D and Columbus view");var e=!1;if(t!==this._mode&&(this._mode=t,this._modeChanged=t!==S.MORPHING,e=this._mode===S.SCENE2D),e){var i=this._max2Dfrustum=this.frustum.clone();if(!(i instanceof _))throw new g("The camera frustum is expected to be orthographic for 2D camera control.");var r=i.top/i.right;i.right=2*this._maxCoord.x,i.left=-i.right,i.top=r*i.right,i.bottom=-i.top}this._mode===S.SCENE2D&&At(this,this.position);var o=this._scene.globe,n=!s(o)||o._surface.tileProvider.ready&&0===o._surface._tileLoadQueueHigh.length&&0===o._surface._tileLoadQueueMedium.length&&0===o._surface._tileLoadQueueLow.length&&0===o._surface._debug.tilesWaitingForChildren;this._suspendTerrainAdjustment&&(this._suspendTerrainAdjustment=!n),this._adjustHeightForTerrain()};var X=new r,Q=new r,J=new r;L.prototype._setTransform=function(t){var e=r.clone(this.positionWC,X),i=r.clone(this.upWC,Q),o=r.clone(this.directionWC,J);v.clone(t,this._transform),this._transformChanged=!0,z(this);var n=this._actualInvTransform;v.multiplyByPoint(n,e,this.position),v.multiplyByPointAsVector(n,o,this.direction),v.multiplyByPointAsVector(n,i,this.up),r.cross(this.direction,this.up,this.right),z(this)};var $=new i,tt=new b,et=new r,it=new r;L.prototype._adjustOrthographicFrustum=function(t){if(this.frustum instanceof y&&(t||!(this._positionCartographic.height<15e4)))if(v.equals(v.IDENTITY,this.transform)){var e,i,o=this._scene,n=o._globe;if(s(n)){var a=$;a.x=o.drawingBufferWidth/2,a.y=o.drawingBufferHeight/2;var l=this.getPickRay(a,tt);if(e=n.pick(l,o,et),o.pickPositionSupported&&(i=o.pickPositionWorldCoordinates(a,it)),s(e)&&s(i)){var g=s(i)?r.distance(i,this.positionWC):Number.POSITIVE_INFINITY,h=s(e)?r.distance(e,this.positionWC):Number.POSITIVE_INFINITY;this.frustum.width=Math.min(g,h)}else s(i)?this.frustum.width=r.distance(i,this.positionWC):s(e)&&(this.frustum.width=r.distance(e,this.positionWC))}if(!s(n)||!s(e)&&!s(i)){var c=Math.max(this.positionCartographic.height,0);this.frustum.width=c}}else this.frustum.width=r.magnitude(this.position)};var rt=new r,ot=new v,nt=new v,at=new P,st=new f,lt=new n;var gt=new r,ht=new r,ct=new r;function Ct(t,e,i,o){var n=r.clone(i.direction,gt),a=r.clone(i.up,ht);if(t._scene.mode===S.SCENE3D){var s=t._projection.ellipsoid,l=T.eastNorthUpToFixedFrame(e,s,Y),g=v.inverseTransformation(l,K);v.multiplyByPointAsVector(g,n,n),v.multiplyByPointAsVector(g,a,a)}var h=r.cross(n,a,ct);return o.heading=Z(n,a),o.pitch=q(n),o.roll=j(n,a,h),o}var dt={destination:void 0,orientation:{direction:void 0,up:void 0,heading:void 0,pitch:void 0,roll:void 0},convert:void 0,endTransform:void 0},ut=new p;L.prototype.setView=function(t){t=a(t,a.EMPTY_OBJECT);var e=a(t.orientation,a.EMPTY_OBJECT),o=this._mode;if(o!==S.MORPHING){s(t.endTransform)&&this._setTransform(t.endTransform);var n=a(t.convert,!0),l=a(t.destination,r.clone(this.positionWC,rt));s(l)&&s(l.west)&&(l=this.getRectangleCameraCoordinates(l,rt),n=!1),s(e.direction)&&(e=Ct(this,l,e,dt.orientation)),ut.heading=a(e.heading,0),ut.pitch=a(e.pitch,-m.PI_OVER_TWO),ut.roll=a(e.roll,0),this._suspendTerrainAdjustment=!1,o===S.SCENE3D?function(t,e,i){var o=v.clone(t.transform,ot),n=T.eastNorthUpToFixedFrame(e,t._projection.ellipsoid,nt);t._setTransform(n),r.clone(r.ZERO,t.position),i.heading=i.heading-m.PI_OVER_TWO;var a=P.fromHeadingPitchRoll(i,at),s=f.fromQuaternion(a,st);f.getColumn(s,0,t.direction),f.getColumn(s,2,t.up),r.cross(t.direction,t.up,t.right),t._setTransform(o),t._adjustOrthographicFrustum(!0)}(this,l,ut):o===S.SCENE2D?function(t,e,o,n){var a=v.clone(t.transform,ot);if(t._setTransform(v.IDENTITY),!r.equals(e,t.positionWC)){if(n){var s=t._projection,l=s.ellipsoid.cartesianToCartographic(e,lt);e=s.project(l,rt)}i.clone(e,t.position);var g=.5*-e.z,h=-g,c=t.frustum;if(h>g){var C=c.top/c.right;c.right=h,c.left=g,c.top=c.right*C,c.bottom=-c.top}}if(t._scene.mapMode2D===x.ROTATE){o.heading=o.heading-m.PI_OVER_TWO,o.pitch=-m.PI_OVER_TWO,o.roll=0;var d=P.fromHeadingPitchRoll(o,at),u=f.fromQuaternion(d,st);f.getColumn(u,2,t.up),r.cross(t.direction,t.up,t.right)}t._setTransform(a)}(this,l,ut,n):function(t,e,i,o){var n=v.clone(t.transform,ot);if(t._setTransform(v.IDENTITY),!r.equals(e,t.positionWC)){if(o){var a=t._projection,s=a.ellipsoid.cartesianToCartographic(e,lt);e=a.project(s,rt)}r.clone(e,t.position)}i.heading=i.heading-m.PI_OVER_TWO;var l=P.fromHeadingPitchRoll(i,at),g=f.fromQuaternion(l,st);f.getColumn(g,0,t.direction),f.getColumn(g,2,t.up),r.cross(t.direction,t.up,t.right),t._setTransform(n),t._adjustOrthographicFrustum(!0)}(this,l,ut,n)}};var pt=new r;function At(t,e){var i,r,o=t._scene.mapMode2D===x.ROTATE,n=t._maxCoord.x,a=t._maxCoord.y;o?i=-(r=n):(r=e.x-2*n,i=e.x+2*n),e.x>n&&(e.x=r),e.x<-n&&(e.x=i),e.y>a&&(e.y=a),e.y<-a&&(e.y=-a)}L.prototype.flyHome=function(t){var e=this._mode;if(e===S.MORPHING&&this._scene.completeMorph(),e===S.SCENE2D)this.flyTo({destination:L.DEFAULT_VIEW_RECTANGLE,duration:t,endTransform:v.IDENTITY});else if(e===S.SCENE3D){var i=this.getRectangleCameraCoordinates(L.DEFAULT_VIEW_RECTANGLE),o=r.magnitude(i);o+=o*L.DEFAULT_VIEW_FACTOR,r.normalize(i,i),r.multiplyByScalar(i,o,i),this.flyTo({destination:i,duration:t,endTransform:v.IDENTITY})}else if(e===S.COLUMBUS_VIEW){var n=this._projection.ellipsoid.maximumRadius,a=new r(0,-1,1);a=r.multiplyByScalar(r.normalize(a,a),5*n,a),this.flyTo({destination:a,duration:t,orientation:{heading:0,pitch:-Math.acos(r.normalize(a,pt).z),roll:0},endTransform:v.IDENTITY,convert:!1})}},L.prototype.worldToCameraCoordinates=function(t,e){if(!s(t))throw new g("cartesian is required.");return s(e)||(e=new o),z(this),v.multiplyByVector(this._actualInvTransform,t,e)},L.prototype.worldToCameraCoordinatesPoint=function(t,e){if(!s(t))throw new g("cartesian is required.");return s(e)||(e=new r),z(this),v.multiplyByPoint(this._actualInvTransform,t,e)},L.prototype.worldToCameraCoordinatesVector=function(t,e){if(!s(t))throw new g("cartesian is required.");return s(e)||(e=new r),z(this),v.multiplyByPointAsVector(this._actualInvTransform,t,e)},L.prototype.cameraToWorldCoordinates=function(t,e){if(!s(t))throw new g("cartesian is required.");return s(e)||(e=new o),z(this),v.multiplyByVector(this._actualTransform,t,e)},L.prototype.cameraToWorldCoordinatesPoint=function(t,e){if(!s(t))throw new g("cartesian is required.");return s(e)||(e=new r),z(this),v.multiplyByPoint(this._actualTransform,t,e)},L.prototype.cameraToWorldCoordinatesVector=function(t,e){if(!s(t))throw new g("cartesian is required.");return s(e)||(e=new r),z(this),v.multiplyByPointAsVector(this._actualTransform,t,e)};var It=new r;L.prototype.move=function(t,e){if(!s(t))throw new g("direction is required.");var i=this.position;r.multiplyByScalar(t,e,It),r.add(i,It,i),this._mode===S.SCENE2D&&At(this,i),this._adjustOrthographicFrustum(!0)},L.prototype.moveForward=function(t){t=a(t,this.defaultMoveAmount),this.move(this.direction,t)},L.prototype.moveBackward=function(t){t=a(t,this.defaultMoveAmount),this.move(this.direction,-t)},L.prototype.moveUp=function(t){t=a(t,this.defaultMoveAmount),this.move(this.up,t)},L.prototype.moveDown=function(t){t=a(t,this.defaultMoveAmount),this.move(this.up,-t)},L.prototype.moveRight=function(t){t=a(t,this.defaultMoveAmount),this.move(this.right,t)},L.prototype.moveLeft=function(t){t=a(t,this.defaultMoveAmount),this.move(this.right,-t)},L.prototype.lookLeft=function(t){t=a(t,this.defaultLookAmount),this.look(this.up,-t)},L.prototype.lookRight=function(t){t=a(t,this.defaultLookAmount),this.look(this.up,t)},L.prototype.lookUp=function(t){t=a(t,this.defaultLookAmount),this.look(this.right,-t)},L.prototype.lookDown=function(t){t=a(t,this.defaultLookAmount),this.look(this.right,t)};var mt=new P,ft=new f;L.prototype.look=function(t,e){if(!s(t))throw new g("axis is required.");var i=a(e,this.defaultLookAmount),r=P.fromAxisAngle(t,-i,mt),o=f.fromQuaternion(r,ft),n=this.direction,l=this.up,h=this.right;f.multiplyByVector(o,n,n),f.multiplyByVector(o,l,l),f.multiplyByVector(o,h,h)},L.prototype.twistLeft=function(t){t=a(t,this.defaultLookAmount),this.look(this.direction,t)},L.prototype.twistRight=function(t){t=a(t,this.defaultLookAmount),this.look(this.direction,-t)};var vt=new P,yt=new f;L.prototype.rotate=function(t,e){if(!s(t))throw new g("axis is required.");var i=a(e,this.defaultRotateAmount),o=P.fromAxisAngle(t,-i,vt),n=f.fromQuaternion(o,yt);f.multiplyByVector(n,this.position,this.position),f.multiplyByVector(n,this.direction,this.direction),f.multiplyByVector(n,this.up,this.up),r.cross(this.direction,this.up,this.right),r.cross(this.right,this.direction,this.up),this._adjustOrthographicFrustum(!1)},L.prototype.rotateDown=function(t){Et(this,t=a(t,this.defaultRotateAmount))},L.prototype.rotateUp=function(t){Et(this,-(t=a(t,this.defaultRotateAmount)))};var _t=new r,wt=new r,Pt=new r,bt=new r;function Et(t,e){var i=t.position,o=r.normalize(i,_t);if(s(t.constrainedAxis)){var n=r.equalsEpsilon(o,t.constrainedAxis,m.EPSILON2),a=r.equalsEpsilon(o,r.negate(t.constrainedAxis,bt),m.EPSILON2);if(n||a)(n&&e<0||a&&e>0)&&t.rotate(t.right,e);else{var l=r.normalize(t.constrainedAxis,wt),g=r.dot(o,l),h=m.acosClamped(g);e>0&&e>h&&(e=h-m.EPSILON4),g=r.dot(o,r.negate(l,bt)),h=m.acosClamped(g),e<0&&-e>h&&(e=-h+m.EPSILON4);var c=r.cross(l,o,Pt);t.rotate(c,e)}}else t.rotate(t.right,e)}function Tt(t,e){s(t.constrainedAxis)?t.rotate(t.constrainedAxis,e):t.rotate(t.up,e)}function Mt(t,e){var i,r=t.frustum;if(!(r instanceof _&&s(r.left)&&s(r.right)&&s(r.bottom)&&s(r.top)))throw new g("The camera frustum is expected to be orthographic for 2D camera control.");if(e*=.5,Math.abs(r.top)+Math.abs(r.bottom)>Math.abs(r.left)+Math.abs(r.right)){var o=r.top-e,n=r.bottom+e,a=t._maxCoord.y;t._scene.mapMode2D===x.ROTATE&&(a*=t.maximumZoomFactor),n>a&&(n=a,o=-a),o<=n&&(o=1,n=-1),i=r.right/r.top,r.top=o,r.bottom=n,r.right=r.top*i,r.left=-r.right}else{var l=r.right-e,h=r.left+e,c=t._maxCoord.x;t._scene.mapMode2D===x.ROTATE&&(c*=t.maximumZoomFactor),l>c&&(l=c,h=-c),l<=h&&(l=1,h=-1),i=r.top/r.right,r.right=l,r.left=h,r.top=r.right*i,r.bottom=-r.top}}function xt(t,e){t.move(t.direction,e)}L.prototype.rotateRight=function(t){Tt(this,-(t=a(t,this.defaultRotateAmount)))},L.prototype.rotateLeft=function(t){Tt(this,t=a(t,this.defaultRotateAmount))},L.prototype.zoomIn=function(t){t=a(t,this.defaultZoomAmount),this._mode===S.SCENE2D?Mt(this,t):xt(this,t)},L.prototype.zoomOut=function(t){t=a(t,this.defaultZoomAmount),this._mode===S.SCENE2D?Mt(this,-t):xt(this,-t)},L.prototype.getMagnitude=function(){return this._mode===S.SCENE3D?r.magnitude(this.position):this._mode===S.COLUMBUS_VIEW?Math.abs(this.position.z):this._mode===S.SCENE2D?Math.max(this.frustum.right-this.frustum.left,this.frustum.top-this.frustum.bottom):void 0};var St=new v;L.prototype.lookAt=function(t,e){if(!s(t))throw new g("target is required");if(!s(e))throw new g("offset is required");if(this._mode===S.MORPHING)throw new g("lookAt is not supported while morphing.");var i=T.eastNorthUpToFixedFrame(t,c.WGS84,St);this.lookAtTransform(i,e)};var Lt=new r,Rt=new P,Dt=new P,kt=new f;function Ot(t,e,i){e=m.clamp(e,-m.PI_OVER_TWO,m.PI_OVER_TWO),t=m.zeroToTwoPi(t)-m.PI_OVER_TWO;var o=P.fromAxisAngle(r.UNIT_Y,-e,Rt),n=P.fromAxisAngle(r.UNIT_Z,-t,Dt),a=P.multiply(n,o,n),s=f.fromQuaternion(a,kt),l=r.clone(r.UNIT_X,Lt);return f.multiplyByVector(s,l,l),r.negate(l,l),r.multiplyByScalar(l,i,l),l}L.prototype.lookAtTransform=function(t,e){if(!s(t))throw new g("transform is required");if(this._mode===S.MORPHING)throw new g("lookAtTransform is not supported while morphing.");if(this._setTransform(t),s(e)){var o;if(o=s(e.heading)?Ot(e.heading,e.pitch,e.range):e,this._mode===S.SCENE2D){i.clone(i.ZERO,this.position),r.negate(o,this.up),this.up.z=0,r.magnitudeSquared(this.up)<m.EPSILON10&&r.clone(r.UNIT_Y,this.up),r.normalize(this.up,this.up),this._setTransform(v.IDENTITY),r.negate(r.UNIT_Z,this.direction),r.cross(this.direction,this.up,this.right),r.normalize(this.right,this.right);var n=this.frustum,a=n.top/n.right;return n.right=.5*r.magnitude(o),n.left=-n.right,n.top=a*n.right,n.bottom=-n.top,void this._setTransform(t)}r.clone(o,this.position),r.negate(this.position,this.direction),r.normalize(this.direction,this.direction),r.cross(this.direction,r.UNIT_Z,this.right),r.magnitudeSquared(this.right)<m.EPSILON10&&r.clone(r.UNIT_X,this.right),r.normalize(this.right,this.right),r.cross(this.right,this.direction,this.up),r.normalize(this.up,this.up),this._adjustOrthographicFrustum(!0)}};var Ft,Ht=new n,Bt=new n,Nt=new r,Gt=new r,Wt=new r,Ut=new r,Vt=new r,zt=new r,Zt=new r,qt=new r,jt={direction:new r,right:new r,up:new r};function Yt(t,e,i,o){return Math.abs(r.dot(e,i))/o-r.dot(t,i)}function Kt(t,e,i,o){var n=t._projection.ellipsoid,a=o?t:jt,l=e.north,g=e.south,h=e.east,c=e.west;c>h&&(h+=m.TWO_PI);var d,u=.5*(c+h);if(g<-m.PI_OVER_TWO+m.RADIANS_PER_DEGREE&&l>m.PI_OVER_TWO-m.RADIANS_PER_DEGREE)d=0;else{var p=Ht;p.longitude=u,p.latitude=l,p.height=0;var A=Bt;A.longitude=u,A.latitude=g,A.height=0;var I=Ft;s(I)&&I.ellipsoid===n||(Ft=I=new C(void 0,void 0,n)),I.setEndPoints(p,A),d=I.interpolateUsingFraction(.5,Ht).latitude}var f=Ht;f.longitude=u,f.latitude=d,f.height=0;var v=n.cartographicToCartesian(f,Zt),_=Ht;_.longitude=h,_.latitude=l;var w=n.cartographicToCartesian(_,Nt);_.longitude=c;var P=n.cartographicToCartesian(_,Wt);_.longitude=u;var b=n.cartographicToCartesian(_,Vt);_.latitude=g;var E=n.cartographicToCartesian(_,zt);_.longitude=h;var T=n.cartographicToCartesian(_,Ut);_.longitude=c;var M=n.cartographicToCartesian(_,Gt);r.subtract(P,v,P),r.subtract(T,v,T),r.subtract(w,v,w),r.subtract(M,v,M),r.subtract(b,v,b),r.subtract(E,v,E);var x=n.geodeticSurfaceNormal(v,a.direction);r.negate(x,x);var S=r.cross(x,r.UNIT_Z,a.right);r.normalize(S,S);var L,R=r.cross(S,x,a.up);if(t.frustum instanceof y){var D,k,O=Math.max(r.distance(w,P),r.distance(T,M)),F=Math.max(r.distance(w,T),r.distance(P,M)),H=t.frustum._offCenterFrustum.right/t.frustum._offCenterFrustum.top,B=F*H;O>B?k=(D=O)/H:(k=F,D=B),L=Math.max(D,k)}else{var N=Math.tan(.5*t.frustum.fovy),G=t.frustum.aspectRatio*N;if(L=Math.max(Yt(x,R,P,N),Yt(x,R,T,N),Yt(x,R,w,N),Yt(x,R,M,N),Yt(x,R,b,N),Yt(x,R,E,N),Yt(x,S,P,G),Yt(x,S,T,G),Yt(x,S,w,G),Yt(x,S,M,G),Yt(x,S,b,G),Yt(x,S,E,G)),g<0&&l>0){var W=Ht;W.longitude=c,W.latitude=0,W.height=0;var U=n.cartographicToCartesian(W,qt);r.subtract(U,v,U),L=Math.max(L,Yt(x,R,U,N),Yt(x,S,U,G)),W.longitude=h,U=n.cartographicToCartesian(W,qt),r.subtract(U,v,U),L=Math.max(L,Yt(x,R,U,N),Yt(x,S,U,G))}}return r.add(v,r.multiplyByScalar(x,-L,qt),i)}var Xt=new n,Qt=new r,Jt=new r;var $t=new n,te=new r,ee=new r;L.prototype.getRectangleCameraCoordinates=function(t,e){if(!s(t))throw new g("rectangle is required");var i=this._mode;return s(e)||(e=new r),i===S.SCENE3D?Kt(this,t,e):i===S.COLUMBUS_VIEW?function(t,e,i){var r=t._projection;e.west>e.east&&(e=E.MAX_VALUE);var o=t._actualTransform,n=t._actualInvTransform,a=Xt;a.longitude=e.east,a.latitude=e.north;var l=r.project(a,Qt);v.multiplyByPoint(o,l,l),v.multiplyByPoint(n,l,l),a.longitude=e.west,a.latitude=e.south;var g=r.project(a,Jt);if(v.multiplyByPoint(o,g,g),v.multiplyByPoint(n,g,g),i.x=.5*(l.x-g.x)+g.x,i.y=.5*(l.y-g.y)+g.y,s(t.frustum.fovy)){var h=Math.tan(.5*t.frustum.fovy),c=t.frustum.aspectRatio*h;i.z=.5*Math.max((l.x-g.x)/c,(l.y-g.y)/h)}else{var C=l.x-g.x,d=l.y-g.y;i.z=Math.max(C,d)}return i}(this,t,e):i===S.SCENE2D?function(t,e,i){var r=t._projection;e.west>e.east&&(e=E.MAX_VALUE);var o=$t;o.longitude=e.east,o.latitude=e.north;var n=r.project(o,te);o.longitude=e.west,o.latitude=e.south;var a,s,l=r.project(o,ee),g=.5*Math.abs(n.x-l.x),h=.5*Math.abs(n.y-l.y),c=t.frustum.right/t.frustum.top,C=h*c;return g>C?s=(a=g)/c:(s=h,a=C),h=Math.max(2*a,2*s),i.x=.5*(n.x-l.x)+l.x,i.y=.5*(n.y-l.y)+l.y,(o=r.unproject(i,o)).height=h,i=r.project(o,i)}(this,t,e):void 0};var ie=new b;var re=new b;var oe=new b;L.prototype.pickEllipsoid=function(t,e,i){if(!s(t))throw new g("windowPosition is required.");var o=this._scene.canvas;if(0!==o.clientWidth&&0!==o.clientHeight){if(s(i)||(i=new r),e=a(e,c.WGS84),this._mode===S.SCENE3D)i=function(t,e,i,r){i=a(i,c.WGS84);var o=t.getPickRay(e,ie),n=I.rayEllipsoid(o,i);if(n){var s=n.start>0?n.start:n.stop;return b.getPoint(o,s,r)}}(this,t,e,i);else if(this._mode===S.SCENE2D)i=function(t,e,i,r){var o=t.getPickRay(e,re).origin;o.z=0;var n=i.unproject(o);if(!(n.latitude<-m.PI_OVER_TWO||n.latitude>m.PI_OVER_TWO))return i.ellipsoid.cartographicToCartesian(n,r)}(this,t,this._projection,i);else{if(this._mode!==S.COLUMBUS_VIEW)return;i=function(t,e,i,o){var n=t.getPickRay(e,oe),a=-n.origin.x/n.direction.x;b.getPoint(n,a,o);var s=i.unproject(new r(o.y,o.z,0));if(!(s.latitude<-m.PI_OVER_TWO||s.latitude>m.PI_OVER_TWO||s.longitude<-Math.PI||s.longitude>Math.PI))return i.ellipsoid.cartographicToCartesian(s,o)}(this,t,this._projection,i)}return i}};var ne=new r,ae=new r,se=new r;var le=new r;L.prototype.getPickRay=function(t,e){if(!s(t))throw new g("windowPosition is required.");s(e)||(e=new b);var i=this.frustum;return s(i.aspectRatio)&&s(i.fov)&&s(i.near)?function(t,e,i){var o=t._scene.canvas,n=o.clientWidth,a=o.clientHeight,s=Math.tan(.5*t.frustum.fovy),l=t.frustum.aspectRatio*s,g=t.frustum.near,h=2/n*e.x-1,c=2/a*(a-e.y)-1,C=t.positionWC;r.clone(C,i.origin);var d=r.multiplyByScalar(t.directionWC,g,ne);r.add(C,d,d);var u=r.multiplyByScalar(t.rightWC,h*g*l,ae),p=r.multiplyByScalar(t.upWC,c*g*s,se),A=r.add(d,u,i.direction);return r.add(A,p,A),r.subtract(A,C,A),r.normalize(A,A),i}(this,t,e):function(t,e,i){var o=t._scene.canvas,n=o.clientWidth,a=o.clientHeight,l=t.frustum;s(l._offCenterFrustum)&&(l=l._offCenterFrustum);var g=2/n*e.x-1;g*=.5*(l.right-l.left);var h=2/a*(a-e.y)-1;h*=.5*(l.top-l.bottom);var c=i.origin;return r.clone(t.position,c),r.multiplyByScalar(t.right,g,le),r.add(le,c,c),r.multiplyByScalar(t.up,h,le),r.add(le,c,c),r.clone(t.directionWC,i.direction),t._mode===S.COLUMBUS_VIEW&&r.fromElements(i.origin.z,i.origin.x,i.origin.y,i.origin),i}(this,t,e)};var ge=new r,he=new r;L.prototype.distanceToBoundingSphere=function(t){if(!s(t))throw new g("boundingSphere is required.");var e=r.subtract(this.positionWC,t.center,ge),i=r.multiplyByScalar(this.directionWC,r.dot(e,this.directionWC),he);return Math.max(0,r.magnitude(i)-t.radius)};var ce=new i;L.prototype.getPixelSize=function(t,e,i){if(!s(t))throw new g("boundingSphere is required.");if(!s(e))throw new g("drawingBufferWidth is required.");if(!s(i))throw new g("drawingBufferHeight is required.");var r=this.distanceToBoundingSphere(t),o=this.frustum.getPixelDimensions(e,i,r,ce);return Math.max(o.x,o.y)};var Ce=new r,de=new r,ue=new r,pe=new r;function Ae(t,e){var i=t.position,o=t.direction,n=t.worldToCameraCoordinatesVector(r.UNIT_X,Ce),a=-r.dot(n,i)/r.dot(n,o),s=r.add(i,r.multiplyByScalar(o,a,de),de);t.cameraToWorldCoordinatesPoint(s,s),i=t.cameraToWorldCoordinatesPoint(t.position,ue);var l,g,c,C,d,u,p,A=Math.tan(.5*t.frustum.fovy),I=t.frustum.aspectRatio*A,m=r.magnitude(r.subtract(i,s,pe)),f=I*m,v=A*m,y=t._maxCoord.x,_=t._maxCoord.y,w=Math.max(f-y,y),P=Math.max(v-_,_);if(i.z<-w||i.z>w||i.y<-P||i.y>P){var b=s.y<-w||s.y>w,E=s.z<-P||s.z>P;if(b||E)return l=t,g=i,c=s,C=w,d=P,u=e,p=r.clone(g),c.y>C?p.y-=c.y-C:c.y<-C&&(p.y+=-C-c.y),c.z>d?p.z-=c.z-d:c.z<-d&&(p.z+=-d-c.z),{easingFunction:h.EXPONENTIAL_OUT,startObject:{time:0},stopObject:{time:1},duration:u,update:function(t){var e=r.lerp(g,p,t.time,new r);l.worldToCameraCoordinatesPoint(e,l.position)}}}}L.prototype.createCorrectPositionTween=function(t){if(!s(t))throw new g("duration is required.");if(this._mode===S.COLUMBUS_VIEW)return Ae(this,t)};var Ie=new r,me={destination:void 0,heading:void 0,pitch:void 0,roll:void 0,duration:void 0,complete:void 0,cancel:void 0,endTransform:void 0,maximumHeight:void 0,easingFunction:void 0};L.prototype.cancelFlight=function(){s(this._currentFlight)&&(this._currentFlight.cancelTween(),this._currentFlight=void 0)},L.prototype.flyTo=function(t){var e=(t=a(t,a.EMPTY_OBJECT)).destination;if(!s(e))throw new g("destination is required.");if(this._mode!==S.MORPHING){this.cancelFlight();var i=a(t.orientation,a.EMPTY_OBJECT);if(s(i.direction)&&(i=Ct(this,e,i,dt.orientation)),s(t.duration)&&t.duration<=0){var r=dt;return r.destination=t.destination,r.orientation.heading=i.heading,r.orientation.pitch=i.pitch,r.orientation.roll=i.roll,r.convert=t.convert,r.endTransform=t.endTransform,this.setView(r),void("function"==typeof t.complete&&t.complete())}var o=s(e.west);o&&(e=this.getRectangleCameraCoordinates(e,Ie));var n,l=this;me.destination=e,me.heading=i.heading,me.pitch=i.pitch,me.roll=i.roll,me.duration=t.duration,me.complete=function(){n===l._currentFlight&&(l._currentFlight=void 0),s(t.complete)&&t.complete()},me.cancel=t.cancel,me.endTransform=t.endTransform,me.convert=!o&&t.convert,me.maximumHeight=t.maximumHeight,me.pitchAdjustHeight=t.pitchAdjustHeight,me.flyOverLongitude=t.flyOverLongitude,me.flyOverLongitudeWeight=t.flyOverLongitudeWeight,me.easingFunction=t.easingFunction;var h=this._scene;n=h.tweens.add(M.createTween(h,me)),this._currentFlight=n}};var fe=100;function ve(t,e,i){s(i)||(i=u.clone(L.DEFAULT_OFFSET));var r,o,n,a,l=t._scene.screenSpaceCameraController.minimumZoomDistance,g=t._scene.screenSpaceCameraController.maximumZoomDistance,h=i.range;if(!s(h)||0===h){var c=e.radius;0===c?i.range=fe:t.frustum instanceof y||t._mode===S.SCENE2D?i.range=function(t,e){var i,r,o=t.frustum;s(o._offCenterFrustum)&&(o=o._offCenterFrustum);var n=o.right/o.top,a=e*n;return e>a?r=(i=e)/n:(r=e,i=a),1.5*Math.max(i,r)}(t,c):i.range=(r=c,o=t.frustum,n=Math.tan(.5*o.fovy),a=o.aspectRatio*n,Math.max(r/a,r/n)),i.range=m.clamp(i.range,l,g)}return i}L.prototype.viewBoundingSphere=function(t,e){if(!s(t))throw new g("boundingSphere is required.");if(this._mode===S.MORPHING)throw new g("viewBoundingSphere is not supported while morphing.");e=ve(this,t,e),this.lookAt(t.center,e)};var ye=new v,_e=new r,we=new r,Pe=new r,be=new r,Ee=new o,Te=new P,Me=new f;L.prototype.flyToBoundingSphere=function(t,e){if(!s(t))throw new g("boundingSphere is required.");e=a(e,a.EMPTY_OBJECT);var i=this._mode===S.SCENE2D||this._mode===S.COLUMBUS_VIEW;this._setTransform(v.IDENTITY);var o,n=ve(this,t,e.offset);o=i?r.multiplyByScalar(r.UNIT_Z,n.range,_e):Ot(n.heading,n.pitch,n.range);var l,h,C=T.eastNorthUpToFixedFrame(t.center,c.WGS84,ye);if(v.multiplyByPoint(C,o,o),!i){if(l=r.subtract(t.center,o,we),r.normalize(l,l),h=v.multiplyByPointAsVector(C,r.UNIT_Z,Pe),1-Math.abs(r.dot(l,h))<m.EPSILON6){var d=P.fromAxisAngle(l,n.heading,Te),u=f.fromQuaternion(d,Me);r.fromCartesian4(v.getColumn(C,1,Ee),h),f.multiplyByVector(u,h,h)}var p=r.cross(l,h,be);r.cross(p,l,h),r.normalize(h,h)}this.flyTo({destination:o,orientation:{direction:l,up:h},duration:e.duration,complete:e.complete,cancel:e.cancel,endTransform:e.endTransform,maximumHeight:e.maximumHeight,easingFunction:e.easingFunction,flyOverLongitude:e.flyOverLongitude,flyOverLongitudeWeight:e.flyOverLongitudeWeight,pitchAdjustHeight:e.pitchAdjustHeight})};var xe=new r,Se=new r,Le=new r,Re=new r,De=[new r,new r,new r,new r];var ke=new i,Oe=new r,Fe=[new n,new n,new n,new n];function He(t,e,i,r,o,n){ke.x=t,ke.y=e;var a=r.pickEllipsoid(ke,o,Oe);return s(a)?(Fe[i]=o.cartesianToCartographic(a,Fe[i]),1):(Fe[i]=o.cartesianToCartographic(n[i],Fe[i]),0)}L.prototype.computeViewRectangle=function(t,i){t=a(t,c.WGS84);var o=this.frustum.computeCullingVolume(this.positionWC,this.directionWC,this.upWC),n=new e(r.ZERO,t.maximumRadius);if(o.computeVisibility(n)!==A.OUTSIDE){var s=this._scene.canvas,l=s.clientWidth,g=s.clientHeight,h=0,C=function(t,e){var i,o,n=e.radii,a=t.positionWC,s=r.multiplyComponents(e.oneOverRadii,a,xe),l=r.magnitude(s),g=r.normalize(s,Se);r.equalsEpsilon(g,r.UNIT_Z,m.EPSILON10)?(i=new r(0,1,0),o=new r(0,0,1)):(i=r.normalize(r.cross(r.UNIT_Z,g,Le),Le),o=r.normalize(r.cross(g,i,Re),Re));var h=Math.sqrt(r.magnitudeSquared(s)-1),c=r.multiplyByScalar(g,1/l,xe),C=h/l,d=r.multiplyByScalar(i,C,Se),u=r.multiplyByScalar(o,C,Le),p=r.add(c,u,De[0]);r.subtract(p,d,p),r.multiplyComponents(n,p,p);var A=r.subtract(c,u,De[1]);r.subtract(A,d,A),r.multiplyComponents(n,A,A);var I=r.subtract(c,u,De[2]);r.add(I,d,I),r.multiplyComponents(n,I,I);var f=r.add(c,u,De[3]);return r.add(f,d,f),r.multiplyComponents(n,f,f),De}(this,t);if(h+=He(0,0,0,this,t,C),h+=He(0,g,1,this,t,C),h+=He(l,g,2,this,t,C),(h+=He(l,0,3,this,t,C))<2)return E.MAX_VALUE;i=E.fromCartographicArray(Fe,i);for(var d=0,u=Fe[3].longitude,p=0;p<4;++p){var I=Fe[p].longitude,f=Math.abs(I-u);f>m.PI?d+=m.TWO_PI-f:d+=f,u=I}return m.equalsEpsilon(Math.abs(d),m.TWO_PI,m.EPSILON9)&&(i.west=-m.PI,i.east=m.PI,Fe[0].latitude>=0?i.north=m.PI_OVER_TWO:i.south=-m.PI_OVER_TWO),i}},L.prototype.switchToPerspectiveFrustum=function(){if(!(this._mode===S.SCENE2D||this.frustum instanceof w)){var t=this._scene;this.frustum=new w,this.frustum.aspectRatio=t.drawingBufferWidth/t.drawingBufferHeight,this.frustum.fov=m.toRadians(60)}},L.prototype.switchToOrthographicFrustum=function(){if(!(this._mode===S.SCENE2D||this.frustum instanceof y)){var t=this._scene;this.frustum=new y,this.frustum.aspectRatio=t.drawingBufferWidth/t.drawingBufferHeight,this.frustum.width=r.magnitude(this.position);var e=this.frustum.projectionMatrix;s(e)&&this._adjustOrthographicFrustum(!0)}},L.clone=function(t,e){return s(e)||(e=new L(t._scene)),r.clone(t.position,e.position),r.clone(t.direction,e.direction),r.clone(t.up,e.up),r.clone(t.right,e.right),v.clone(t._transform,e.transform),e._transformChanged=!0,e},t.GeoCamera=L}(window.Cesium),function(t){"use strict";var e=t.Cartesian2,i=t.defined,r=t.defineProperties,o=t.destroyObject,n=t.DeveloperError,a=t.KeyboardEventModifier,s=t.Math,l=t.ScreenSpaceEventHandler,g=t.ScreenSpaceEventType,h=t.CameraEventType;function c(t,e){var r=t;return i(e)&&(r+="+"+e),r}function C(t,r,o){var n=c(h.PINCH,r),a=t._update,s=t._isDown,l=t._eventStartPosition,C=t._pressTime,d=t._releaseTime;a[n]=!0,s[n]=!1,l[n]=new e;var u=t._movement[n];i(u)||(u=t._movement[n]={}),u.distance={startPosition:new e,endPosition:new e},u.angleAndHeight={startPosition:new e,endPosition:new e},u.prevAngle=0,t._eventHandler.setInputAction(function(i){t._buttonsDown++,s[n]=!0,C[n]=new Date,e.lerp(i.position1,i.position2,.5,l[n])},g.PINCH_START,r),t._eventHandler.setInputAction(function(){t._buttonsDown=Math.max(t._buttonsDown-1,0),s[n]=!1,d[n]=new Date},g.PINCH_END,r),t._eventHandler.setInputAction(function(t){if(s[n]){a[n]?(g=t,h=u,e.clone(g.distance.startPosition,h.distance.startPosition),e.clone(g.distance.endPosition,h.distance.endPosition),e.clone(g.angleAndHeight.startPosition,h.angleAndHeight.startPosition),e.clone(g.angleAndHeight.endPosition,h.angleAndHeight.endPosition),a[n]=!1,u.prevAngle=u.angleAndHeight.startPosition.x):(e.clone(t.distance.endPosition,u.distance.endPosition),e.clone(t.angleAndHeight.endPosition,u.angleAndHeight.endPosition));for(var i=u.angleAndHeight.endPosition.x,r=u.prevAngle,l=2*Math.PI;i>=r+Math.PI;)i-=l;for(;i<r-Math.PI;)i+=l;u.angleAndHeight.endPosition.x=-i*o.clientWidth/12,u.angleAndHeight.startPosition.x=-r*o.clientWidth/12}var g,h},g.PINCH_MOVE,r)}function d(t,r){var o=c(h.WHEEL,r),n=t._update;n[o]=!0;var a=t._movement[o];i(a)||(a=t._movement[o]={}),a.startPosition=new e,a.endPosition=new e,t._eventHandler.setInputAction(function(t){var i=10*s.toRadians(t);n[o]?(e.clone(e.ZERO,a.startPosition),a.endPosition.x=0,a.endPosition.y=i,n[o]=!1):a.endPosition.y=a.endPosition.y+i},g.WHEEL,r)}function u(t,r,o){var n=c(o,r),a=t._isDown,s=t._eventStartPosition,l=t._pressTime,C=t._releaseTime;a[n]=!1,s[n]=new e;var d,u,p=t._lastMovement[n];i(p)||(p=t._lastMovement[n]={startPosition:new e,endPosition:new e,valid:!1}),o===h.LEFT_DRAG?(d=g.LEFT_DOWN,u=g.LEFT_UP):o===h.RIGHT_DRAG?(d=g.RIGHT_DOWN,u=g.RIGHT_UP):o===h.MIDDLE_DRAG&&(d=g.MIDDLE_DOWN,u=g.MIDDLE_UP),t._eventHandler.setInputAction(function(i){t._buttonsDown++,p.valid=!1,a[n]=!0,l[n]=new Date,e.clone(i.position,s[n])},d,r),t._eventHandler.setInputAction(function(){t._buttonsDown=Math.max(t._buttonsDown-1,0),a[n]=!1,C[n]=new Date},u,r)}function p(t,i){e.clone(t.startPosition,i.startPosition),e.clone(t.endPosition,i.endPosition)}function A(t,r){var o=t._update,n=t._movement,a=t._lastMovement,s=t._isDown;for(var l in h)if(h.hasOwnProperty(l)){var C=h[l];if(i(C)){var d=c(C,r);o[d]=!0,i(t._lastMovement[d])||(t._lastMovement[d]={startPosition:new e,endPosition:new e,valid:!1}),i(t._movement[d])||(t._movement[d]={startPosition:new e,endPosition:new e})}}t._eventHandler.setInputAction(function(l){for(var g in h)if(h.hasOwnProperty(g)){var C=h[g];if(i(C)){var d=c(C,r);s[d]&&(o[d]?(p(n[d],a[d]),a[d].valid=!0,p(l,n[d]),o[d]=!1):e.clone(l.endPosition,n[d].endPosition))}}e.clone(l.endPosition,t._currentMousePosition)},g.MOUSE_MOVE,r)}function I(t){if(!i(t))throw new n("canvas is required.");this._eventHandler=new l(t,!0),this._update={},this._movement={},this._lastMovement={},this._isDown={},this._eventStartPosition={},this._pressTime={},this._releaseTime={},this._buttonsDown=0,this._currentMousePosition=new e,d(this,void 0),C(this,void 0,t),u(this,void 0,h.LEFT_DRAG),u(this,void 0,h.RIGHT_DRAG),u(this,void 0,h.MIDDLE_DRAG),A(this,void 0);for(var r in a)if(a.hasOwnProperty(r)){var o=a[r];i(o)&&(d(this,o),C(this,o,t),u(this,o,h.LEFT_DRAG),u(this,o,h.RIGHT_DRAG),u(this,o,h.MIDDLE_DRAG),A(this,o))}}r(I.prototype,{currentMousePosition:{get:function(){return this._currentMousePosition}},anyButtonDown:{get:function(){var t=!(this._update[c(h.WHEEL)]&&this._update[c(h.WHEEL,a.SHIFT)]&&this._update[c(h.WHEEL,a.CTRL)]&&this._update[c(h.WHEEL,a.ALT)]);return this._buttonsDown>0||t}}}),I.prototype.isMoving=function(t,e){if(!i(t))throw new n("type is required.");var r=c(t,e);return!this._update[r]},I.prototype.getMovement=function(t,e){if(!i(t))throw new n("type is required.");var r=c(t,e);return this._movement[r]},I.prototype.getLastMovement=function(t,e){if(!i(t))throw new n("type is required.");var r=c(t,e),o=this._lastMovement[r];if(o.valid)return o},I.prototype.isButtonDown=function(t,e){if(!i(t))throw new n("type is required.");var r=c(t,e);return this._isDown[r]},I.prototype.getStartMousePosition=function(t,e){if(!i(t))throw new n("type is required.");if(t===h.WHEEL)return this._currentMousePosition;var r=c(t,e);return this._eventStartPosition[r]},I.prototype.getButtonPressTime=function(t,e){if(!i(t))throw new n("type is required.");var r=c(t,e);return this._pressTime[r]},I.prototype.getButtonReleaseTime=function(t,e){if(!i(t))throw new n("type is required.");var r=c(t,e);return this._releaseTime[r]},I.prototype.reset=function(){for(var t in this._update)this._update.hasOwnProperty(t)&&(this._update[t]=!0)},I.prototype.isDestroyed=function(){return!1},I.prototype.destroy=function(){return this._eventHandler=this._eventHandler&&this._eventHandler.destroy(),o(this)},t.GeoCameraEventAggregator=I}(window.Cesium),function(t){"use strict";var e=t.defaultValue;function i(i){i=e(i,e.EMPTY_OBJECT),this.viewer=i.viewer,this.scene=this.viewer.scene,this.primitives=this.scene.primitives,this.topCylinderColor=e(i.topCylinderColor,new t.Color(1,0,0,.5)),this.bottomCylinderColor=e(i.bottomCylinderColor,new t.Color(0,1,0,.5)),this.createPrestrainPrimitive(),this.active()}function r(e,i,r,o){return new t.GeometryInstance({geometry:new t.EllipseGeometry({center:e,semiMajorAxis:i,semiMinorAxis:r,height:o,vertexFormat:t.EllipsoidSurfaceAppearance.VERTEXT_FORMAT})})}function o(e,i,r,o,n,a,s,l,g,h){return new t.GeometryInstance({geometry:new t.CylinderGeometry({length:e,topRadius:i,bottomRadius:r,vertexFormat:t.VertexFormat.POSITION_AND_NORMAL}),attributes:{color:new t.ColorGeometryInstanceAttribute(o,n,a,s)},modelMatrix:t.Matrix4.multiplyByTranslation(t.Transforms.eastNorthUpToFixedFrame(t.Cartesian3.fromDegrees(l,g,h)),new t.Cartesian3(0,0,0),new t.Matrix4)})}function n(e,i){return new t.Primitive({allowPicking:!0,geometryInstances:e,vertexCacheOptimize:!0,appearance:i,interleave:!0,asynchronous:!1,cull:!1,releaseGeometryInstances:!0,show:!0})}t.defineProperties(i.prototype,{}),i.prototype.createPrestrainPrimitive=function(){var e,i=r(t.Cartesian3.UNIT_X,1e-4,1e-4,1e-4);this.ellipseAppearance=(e="varying vec3 v_positionMC;\n\t\t\t\t\tvarying vec3 v_positionEC;\n\t\t\t\t\tvarying vec2 v_st;\n\t\t\t\t\t\n\t\t\t\t\tvoid main()\n\t\t\t\t\t{\n\t\t\t\t\t\tczm_materialInput materialInput;\n\t\t\t\t\t\tvec3 normalEC = normalize(czm_normal3D * czm_geodeticSurfaceNormal(v_positionMC, vec3(0.0), vec3(1.0)));\n\t\t\t\t\t#ifdef FACE_FORWARD\n\t\t\t\t\t\tnormalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n\t\t\t\t\t#endif\n\t\t\t\t\t\tmaterialInput.s = v_st.s;\n\t\t\t\t\t\tmaterialInput.st = v_st;\n\t\t\t\t\t\tmaterialInput.str = vec3(v_st, 0.0);\n\t\t\t\t\t\tmaterialInput.normalEC = normalEC;\n\t\t\t\t\t\tmaterialInput.tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(v_positionMC, materialInput.normalEC);\n\t\t\t\t\t\tvec3 positionToEyeEC = -v_positionEC;\n\t\t\t\t\t\tmaterialInput.positionToEyeEC = positionToEyeEC;\n\t\t\t\t\t\tczm_material material = czm_getMaterial(materialInput);\n\t\t\t\t\t#ifdef FLAT\n\t\t\t\t\t\tgl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n\t\t\t\t\t#else\n\t\t\t\t\t\tgl_FragColor = czm_phong(normalize(positionToEyeEC), material);\n\t\t\t\t\t\tif(gl_FragColor.r==1.0&&gl_FragColor.g==1.0&&gl_FragColor.b==1.0&&gl_FragColor.a==1.0){\n\t\t\t\t\t\t\tgl_FragColor.a = 0.0;\n\t\t\t\t\t\t}\n\t\t\t\t\t#endif\n\t\t\t\t\t}\n\t\t\t\t\t",new t.EllipsoidSurfaceAppearance({translucent:!0,material:new t.Material({fabric:{type:"Image",uniforms:{image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAA6E2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS41LWMwMTQgNzkuMTUxNDgxLCAyMDEzLzAzLzEzLTEyOjA5OjE1ICAgICAgICAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgICAgICAgICAgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIgogICAgICAgICAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgICAgICAgICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIj4KICAgICAgICAgPHhtcDpDcmVhdG9yVG9vbD5BZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpPC94bXA6Q3JlYXRvclRvb2w+CiAgICAgICAgIDx4bXA6Q3JlYXRlRGF0ZT4yMDE5LTA2LTExVDA5OjQ2OjU3KzA4OjAwPC94bXA6Q3JlYXRlRGF0ZT4KICAgICAgICAgPHhtcDpNb2RpZnlEYXRlPjIwMTktMDYtMTFUMTA6MTY6NTMrMDg6MDA8L3htcDpNb2RpZnlEYXRlPgogICAgICAgICA8eG1wOk1ldGFkYXRhRGF0ZT4yMDE5LTA2LTExVDEwOjE2OjUzKzA4OjAwPC94bXA6TWV0YWRhdGFEYXRlPgogICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3BuZzwvZGM6Zm9ybWF0PgogICAgICAgICA8cGhvdG9zaG9wOkNvbG9yTW9kZT4zPC9waG90b3Nob3A6Q29sb3JNb2RlPgogICAgICAgICA8cGhvdG9zaG9wOklDQ1Byb2ZpbGU+c1JHQiBJRUM2MTk2Ni0yLjE8L3Bob3Rvc2hvcDpJQ0NQcm9maWxlPgogICAgICAgICA8eG1wTU06SW5zdGFuY2VJRD54bXAuaWlkOjNkNWU2OTU5LTZiOTMtZTQ0Mi1hNmFkLWVhMmExOWQxZGI0MTwveG1wTU06SW5zdGFuY2VJRD4KICAgICAgICAgPHhtcE1NOkRvY3VtZW50SUQ+eG1wLmRpZDo5ODQ4MzQ2Ny03Mjg5LTUzNGQtOTUyOC05MGY3MWU0MTEwMmU8L3htcE1NOkRvY3VtZW50SUQ+CiAgICAgICAgIDx4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ+eG1wLmRpZDo5ODQ4MzQ2Ny03Mjg5LTUzNGQtOTUyOC05MGY3MWU0MTEwMmU8L3htcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD4KICAgICAgICAgPHhtcE1NOkhpc3Rvcnk+CiAgICAgICAgICAgIDxyZGY6U2VxPgogICAgICAgICAgICAgICA8cmRmOmxpIHJkZjpwYXJzZVR5cGU9IlJlc291cmNlIj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmFjdGlvbj5jcmVhdGVkPC9zdEV2dDphY3Rpb24+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDppbnN0YW5jZUlEPnhtcC5paWQ6OTg0ODM0NjctNzI4OS01MzRkLTk1MjgtOTBmNzFlNDExMDJlPC9zdEV2dDppbnN0YW5jZUlEPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6d2hlbj4yMDE5LTA2LTExVDA5OjQ2OjU3KzA4OjAwPC9zdEV2dDp3aGVuPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6c29mdHdhcmVBZ2VudD5BZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpPC9zdEV2dDpzb2Z0d2FyZUFnZW50PgogICAgICAgICAgICAgICA8L3JkZjpsaT4KICAgICAgICAgICAgICAgPHJkZjpsaSByZGY6cGFyc2VUeXBlPSJSZXNvdXJjZSI+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDphY3Rpb24+c2F2ZWQ8L3N0RXZ0OmFjdGlvbj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0Omluc3RhbmNlSUQ+eG1wLmlpZDozZDVlNjk1OS02YjkzLWU0NDItYTZhZC1lYTJhMTlkMWRiNDE8L3N0RXZ0Omluc3RhbmNlSUQ+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDp3aGVuPjIwMTktMDYtMTFUMTA6MTY6NTMrMDg6MDA8L3N0RXZ0OndoZW4+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDpzb2Z0d2FyZUFnZW50PkFkb2JlIFBob3Rvc2hvcCBDQyAoV2luZG93cyk8L3N0RXZ0OnNvZnR3YXJlQWdlbnQ+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDpjaGFuZ2VkPi88L3N0RXZ0OmNoYW5nZWQ+CiAgICAgICAgICAgICAgIDwvcmRmOmxpPgogICAgICAgICAgICA8L3JkZjpTZXE+CiAgICAgICAgIDwveG1wTU06SGlzdG9yeT4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgICAgPHRpZmY6WFJlc29sdXRpb24+NzIwMDAwLzEwMDAwPC90aWZmOlhSZXNvbHV0aW9uPgogICAgICAgICA8dGlmZjpZUmVzb2x1dGlvbj43MjAwMDAvMTAwMDA8L3RpZmY6WVJlc29sdXRpb24+CiAgICAgICAgIDx0aWZmOlJlc29sdXRpb25Vbml0PjI8L3RpZmY6UmVzb2x1dGlvblVuaXQ+CiAgICAgICAgIDxleGlmOkNvbG9yU3BhY2U+MTwvZXhpZjpDb2xvclNwYWNlPgogICAgICAgICA8ZXhpZjpQaXhlbFhEaW1lbnNpb24+NjQ8L2V4aWY6UGl4ZWxYRGltZW5zaW9uPgogICAgICAgICA8ZXhpZjpQaXhlbFlEaW1lbnNpb24+NjQ8L2V4aWY6UGl4ZWxZRGltZW5zaW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKPD94cGFja2V0IGVuZD0idyI/Pu16zW8AAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAEbhJREFUeNrsW3t0VPWd//x+9955ZDKTyeRNnrxCXEGEgAqyQXqEWmtdtbj0gVsaaVfWB6tSjh5r67J2j0qhPrrWcnqaLisKVK0bLdsKIiBGBOVhSYiERwghk5AQ8pqZ3Dv3/r77x/yGjrOZyUSC7jnu95zfyeP+Ht/f5/5+3/dlRIQvM3F8yenzACAPwDIAc0cwZhyABwBUXGrm1Es4dz6AbwGYB+BvAPzrCMZ6AHwfwE0A3gewGcChS8EkuwQy4DYA1QBKAZwDsA/AWwB2AwiN4GRWArgRwLUACgB0A3gNwDP/VwH4HoD7ANgB/BnAbwHUj9Lc2QDuBPB3AHwAXgHw41GZmYguts0mov1EdISIVozCfMO1hUT0ARE1EdGdFzvfxTKzjoi6ieipz2Hj8W0JEZ0moneJKOPzBiCfiE4Q0SEiKv0CNh/bXiaiEBF97bOM/ywyYB6APwFYB+DeEYzzAZgG4DKp5nwAFPlMABgA0AzgKIADAFpGMPcdAH4H4LERapsRn4BvUoS+l2J/HxEtJaI3iaiXUieLiN4jooeJaGKKa11GRANE9ItLdQVulszNSaFvERE9TUQ9iXZomqZlGIZpGIZlGIY5DCCvSWE73LppRNRBRGtG+wrMBLBXWnO7hun7UwAPAXDE/M+sq6s7vmfPnuaGhgZ/a2tr/7lz53TTNIkxxgCQ1+vVxowZk15eXp47c+bM0qqqqvEulys9bu71cm5/kvVdADoB/ATAz0fDDvDKCX8IoCZJvyskg1Oj//D7/Z01NTUf1NbW1h88eNCv67oBQOGca3a7XeGcI7q+YRjCNE0TQBgAr6ioyLnhhhsmLV68eEZlZeWEmHX6APwjgI1JeJkAoAnAfADbLhaAj+XbX5qkz3cAbLjwuk1z8LHHHvvjunXr9nZ2dp5XFMWTm5vrstvtXModBoDFiyPGGMnx1N3dPRgMBns1TbMtWrRoyqpVq24cO3bsmJj+qwGsTMLTrdJy9ADo/6wAPCIdmaIkfR4AsCb6x7Zt2w7de++9f2hsbDzjdruzc3JynEIIQUQqgHR5Naxij9s2PsOT7rQM5VjfQH/TQCgktYIpGTYUReEDAwPm2bNnz2ZkZLgef/zxr95zzz0LYtZ+CcB3k/D2nwBKkjliyQAoAnAawBQAhxP0uRvAL6N/rFmzZsuKFStqATjHjRvnE0KYROQAkCn9gBYAJwG0PVKcWzY1M+M6h6JkHusPvPPAsdP7pANVJptXAtGvqqra3t4eCAQCnXfcccc169ev/36MI/eyPIGJKCCv74aRAvA2gDapY4eimwC8Ef3jwQcffHnt2rVbMzMzC3w+n900TZKucEA6RB/W3TTvOBgD0zToRw7foR9peJQrWqlWNvZRraT0KTJNgAhzdh/IkzbDLOkIdXLOjXA4zFpbW1vnzp07cevWrcs1TbPL5X8O4EcJ+LwdwAsAskYSD7haSv4fJnheAKA2+sfDDz+8ee3atdvy8/OLvV6vZpqmDcAYadA8DWDT/oeWH3dMvgKOK66E88pKqJneYqurZ6Le3GkTg4ZHzc6C4s2A4s3A+zdd1yGNrdXSk8wQQnhVVbXKyspKdu7ceXzBggXPArAkCysA3JKA199LrbFqJAD8Qh6tRO5rbVSI1dTU7HziiSf+nJeXV+h0OiGEcEvBs1lai60AYLafiTR/K8JtLTarv6+YGCAEQIKXkBAVZFo2CpugsBldZ0B6fr8CoBNRLoBwWVlZ4Y4dO45WV1f/R9xGvQn4/RGAf0oVgHEAxkp9OxQtATADAI4cOXKqurp6o8fjyXW5XFxu3gHg1/HqJ7h/T7R5Qvveuz58+uQk6FL8G+HJYlCvIgE7MQX0v9mql8e8h4jyAFiFhYVFNTU1u2tqanbGBHfWJeD5vwG0A7gnFQAeAvAhgPNDPNPkkQYAWrp06UYAak5OjtOyLLt88+uk6vwUmaeaI635pMc4eaLK6usdz5yAogFWZ+v4cMuxK3m6Q1NzfFAyPUNtokuezBARZdpsNkpPT8+97777Xvf7/V0x9/2KBCDUyCjTsADMTWLwLAOQAQDr169/t66urqm0tDTHNE0BIEfq3Y+HNM+uW4D0r94Mx7SrMkiIKhEIljAVUDIBq/+8xzjdMoMBecxmA1OURIK5W54uuxDClpeX5xoYGAg98sgjb8T0eTLB2BekAzYpGQDXyp+vJdH5ICJz9erVOzVN83LOhYzYHJGRoKGDj3kF0AqLoXgyJtLAwAQYAszOwNI0kA5YXQFP+GzHlHDrKY/RcjKZbXJMCsZc0zTNnJyc3BdffPFAU1NTq3x+QwK7JSBVcHUyAL4rOw1F18g4H2praw8cPnz4TEFBgVsIoch5XkvGdejghwgd+rBcP940R/QEXOAAc6gAY4AJUMDyit7+vwVDCfdmDGedbpF3Ot3tdqvhcNhYt25dXVx4bijaCaBKmspDAjA9ibOzKPrLpk2bDgLQOOdRP/+g9OUTkggFYDQfqzSaPqkSuqlBYQDngACYBpAYzDLbz8xnmlZqGzt2OAAMuRmvZVkiLS3N++abbzbouh7VWt9Mor2yASxMBMDSJFHXrwBAT09Pb11d3SmPx+ORRpQqDZ2k5Jw5C6rbPZkCfdOgQAVnkTAIAJ6pgKm6qh87Osns6ipNMV2xTwpqm8/nczY2Nnbt2rWrST6bJu2QeDog7YXfJwLgsLwr8ZQDYDIA7N27t7mlpaXX4/FoUuV1yChOUhLBwBirp28K6brKnWBMkwAQwO0M4IDoBUSQplJYTEoBgF4AxwG4VVUFALFnz57mOGNuKKqX40aUGKmIgtXQ0NBORJaqqoyI0qTbGRxugv4d7/xDuKmtQnQDzEkAWZHGAMYBywBMAejNLTcyTi0AfpYCX80ApsmTqDU2Np6NeZYKiCkDcEGqnjlzpj/Gh1BlrGBYKszUzgyUF+4z9IIuxcHPCzDBAHAOUlRuWSHdEQ7odueEMW32orxPcOCTVKbtkN4jUxRF8/v9AzHPikcTgAuWSXd3dzhOiwRTmcCVQVudqnoQYZ7GbUwnzgVxBs4AaAohCIX6LZVl2wLwOc6myFcwCoDdbmc9PT1hy7KEoig8ludRzQ3KYManrncq4zb1TW4Ph1m7SRwAg2AcBEABQVEYzNAgwrqBzEAx0vuyU2XnwtqRyBqYEAJKYkPqMwPAYgD4TLm05T3XFrmddpdiU7lOsAQxBgEwEuCWgG6EedgSfFzIo2f3Oc8lMMWHezk0FM+jAYB1wRnQtNiJKSa2n5SKHcZSZuqzLJNl2zjvFWAMBMaIiDOCzdBdImxxj6WccAu8BOD1FPlnACCEgKqqTFEUFs/zaADQfUEf5uTYZfwORCQAuFOZYHJ5vvr2lg8mnT7dWcrcOZZ8ZRH+VQUUDCjcHDQ1jHOEzZzcFPlyyz2QrusiKyvLxjln8TyPBgCnLrzJ4uKMaEJFRnDzU5lg2pVFGz/6+NRXTncZpU63TdEUDi7lAFc4Bp0KINyC2R1vChJvpchXAQCFMUZCCKOwsNATpyJTysOnQo1RaT916tQxmqZp4XCYpNFUImN+yWPr3rQTmT5PPZwOy7QIXFVgd2rQbAoM04RmV5Gd6+lLc9q2M8aaU+RrHIBBeQ3MKVOmFMQZPCMG4FsyGBJPAwA+AoDp06eXlZeXZ/X09AzKE+ADcPmwCDb6RV5W2geluZ5DRm8IpmGBAFiWQDBggCwaTE/TPjQtq30goKfC+xjJ64Cu65bNZrPPmTNnXIyvsHeIMQqAbwO4LhEAj0Zd3iHoLQCw2+2OefPmjQ8Gg33yvgWTmJ0X6Fx3wCwfn7N74rjsAzAFhBDSCmTgjEFV+HFF4X8yDPNsMJgSALMBOBljZmdnZ2D69OkFM2bMGC+f7ZIJlKH8meejEa2hANgcm9mJo5ejvyxevHgGAKbrugDQI83OymTcTqrIM0vLshp9eZ5GxeOEKYDBUBhEBM2mwONxnPT5XNuyfK7urCzXcJvPkrGLLsaYYppm38KFC6+I2c/GJJHsvQB+kwiADQAKE0j24wA+AICrr7560vXXXz+xra2tWxod/TITk1CoGoaFYCgMu11pzc11tUEIMdCvQ9dNKJyhpNh7bOb04voZ04qMyiuLhgNgIQAHY0w/d+5cMDs721tdXT07Gn0DsCnBuFnyJPckAuCYvO9LEkxwwUF59NFH5wPQQ6GQYIz1So8xUSAC7+05ibd3HEVPz2Dz2OLs3RrnvVb3AMIDRrhoTObxMQXew5wzcIUjYskmpCp5hDsYY2pfX1/n/fffPyczMzMaRVkn9xBPpQBy48N9Q630qhQUQ9EbMvSFqqqqy5csWXKV3+9vVxRFlbH3WQC+MdTAvBw3crPTMbY06+SEcdm7HC6tHyAwjetOp7anr09vqD/SjobGDjQeTegKTJa8damqyk6ePNk9adKkwpUrV94Q0+enCcbeD+BEvH0wFABrAYyXKbGh6M7oL88888zf5+fnZ5w4ceK8qqpMhqlulu3TCrvAg4ICD/Lz3B2Zmc73XS77ABw2OF2OQE62e2uG23FIVRRoaqQNQdMRyQoHOOeD3d3dOoBATU3Nt1VVtcVsvisB37dhiHQ5T6Dy3olNeMbR+9Fj5PF43LW1tT8goqDf7w+oqmpKF/UbEqi06KCGI+1oONKOQ385g2PHu7o0RTnPnXZwzvQsb9rHBXme4Ji8DERbHH0dwA8ADHLO+0KhEJ0/f97/3HPPLZw1a1ZFjIxalcgVkY7TllQtwX+WE06UAY94qpa6dOzMmTMnvvLKK0sWLlz4W7/fj4KCApdpmm0ArpJG0lsA3ms44o86LFAUbnrcjsbCPPdVlhBdgaDe390dgG6Y8etcJqO8lwHoUhRFDwQC1NHRcWbFihUL4jLFX0siNx6WexpRcvTf5SZmJnheBuATADYA2Lx58/uLFi1aD8A5fvz4TMuyTCLyylNwTBpSDZVzftwBwMs5+3pPT+iq3t7Qac5ZDSJVpWg/+csMAOUyrjdFWnmdqqryzs7Owb6+vo6VK1cuePLJJxfFGXCJJP8qmTC5bKQAMHkdqpNMfo28EgCA3bt3NyxatGh9W1vb+YKCgnyn08kty4JMpjili9sqZUW/VFlRjzINkWxykdQoFoDznHOLiHhzc3MXAOv555+/ddmyZdfHCbenE/CXK69kJYD9IwUAiNTq/lFuoC9BnznymDsB4Ny5c+eXL1/+yoYNGz4CYCssLPTZbDYuhBDytKTJnzzOZxfStA7Juw4hBFpbW/sty+qdPXv2hGefffbWysrK8pgx9wF4Lgn/hxFJ8y9P+JZTiG/8Th7HqUn6lAP4AyJV4ZHMxZYtH61Zs2bX9u3bjwMQaWlpHq/Xa9c0jUtXeujAg2VRf3+/0dvb2w/AnDx5csFdd901++6774596zoiRRHJkjFPyqtRmjTSk2KApx7AnlgVmODKvIC4moLt27cffvXVVw/u3LnzRFNTU7dhGEaSaA0xxpSSkpKMWbNmldxyyy1Tbr/99umcc3tcdufO2NB2giTORumqd4wGAC5EqkWeSiFcPR/Av0ij6K/Ry2AwsH///pb6+np/S0tLb2dn56BpmtFYHnw+n1ZYWOiuqKjInzZtWnFeXp4vbt4ziFSB/nqY9a9FpDS/CsC7qcTRUm1FRNRPRD9Jsf/tRLSNLp4+JqIHiciRwprziEgQ0W2Xqli6SJa8bhjBmMtlyevbsrJ8OBokon1EtJqI5o5gnbvl+FsudbG0S+blwogUTnePYGyGzMyWIVLOosZogAFEqshOIHkl6FC0AZGPKRYAqBtpKPliytR7R+OjhYto1xDRUSL6CxF5vogPJhYS0Rki2k1E0z7HjfuIaD0RdRHRz77IL0ZivxxpJqLXiejqS7jxQiL6lVxry2h8rDGaH00VSRV5jTR3axEpZe28yHlV6cp+RxpcLQD+DcNXraeW8roEn81lIvIlyXyZoOxApHDqNzK8nuocy6ROL5GW3x5E6gXrR5NZdom/HZ6MSEXGfGnAvJTiuKnSwTkI4L8A7LhUDLL//3j6S05fegD+ZwD3gk1Njxe3yQAAAABJRU5ErkJggg=="}}}),fragmentShaderSource:e}));var a=n(i,this.ellipseAppearance);this.primitives.add(a),this.prestrainEllipsePrimitive=a;var s=n([o(1e-4,1e-4,0,1,0,0,0,0,0,0),o(1e-4,0,1e-4,1,0,0,0,0,0,0)],new t.PerInstanceColorAppearance);this.primitives.add(s),this.prestrainCylinderPrimitive=s},i.prototype.active=function(){var e=null,i=this,a=new t.ScreenSpaceEventHandler(this.scene.canvas);a.setInputAction(function(a){if(!i.viewer.trackedEntity){i.scene.screenSpaceCameraController.enableInputs=!1;var s=void 0;if(s=void 0==i.scene.pick(a.position)?i.scene.globe.pick(i.viewer.camera.getPickRay(a.position),i.scene):i.scene.pickPosition(a.position)){var l=t.Cartographic.fromCartesian(s),g=t.Math.toDegrees(l.longitude),h=t.Math.toDegrees(l.latitude),c=l.height+.5,C=t.Cartesian3.distance(i.viewer.camera.position,s)/80,d=i.viewer.entities.add({id:"pointEntity",position:s,point:{color:new t.Color(1,1,1,0)}});d.enableGeoLocateRatate=!0,i.viewer.trackedEntity=d;var u=n(r(s,C,C,c),i.ellipseAppearance);i.primitives.add(u),i.ellipsePrimitive=u;var p=n([o(.3*C,.1*C,0,i.topCylinderColor.red,i.topCylinderColor.green,i.topCylinderColor.blue,i.topCylinderColor.alpha,g,h,c+.2*C),o(.3*C,0,.1*C,i.bottomCylinderColor.red,i.bottomCylinderColor.green,i.bottomCylinderColor.blue,i.bottomCylinderColor.alpha,g,h,c-.2*C)],new t.PerInstanceColorAppearance);i.primitives.add(p),i.cylinderPrimitive=p,i.scene.screenSpaceCameraController.rotateEventTypes=t.CameraEventType.MIDDLE_DRAG,e=setTimeout(function(){i.scene.screenSpaceCameraController.enableInputs=!0},10),i.scene.globe.depthTestAgainstTerrain=!1}}},t.ScreenSpaceEventType.MIDDLE_DOWN),a.setInputAction(function(r){i.viewer.trackedEntity.enableGeoLocateRatate&&(clearTimeout(e),i.prestrainEllipsePrimitive&&i.primitives.remove(i.prestrainEllipsePrimitive),i.prestrainCylinderPrimitive&&i.primitives.remove(i.prestrainCylinderPrimitive),i.ellipsePrimitive&&i.primitives.remove(i.ellipsePrimitive),i.cylinderPrimitive&&i.primitives.remove(i.cylinderPrimitive),i.viewer.entities.removeById("pointEntity"),e=null,i.prestrainEllipsePrimitive=null,i.prestrainCylinderPrimitive=null,i.ellipsePrimitive=null,i.cylinderPrimitive=null,i.viewer.trackedEntity=void 0,i.scene.screenSpaceCameraController.rotateEventTypes=t.CameraEventType.LEFT_DRAG,i.scene.screenSpaceCameraController.enableInputs=!0)},t.ScreenSpaceEventType.MIDDLE_UP)},t.GeoLocateRatate=i}(window.Cesium),function(t){"use strict";var e=t.Cartesian2,i=t.Cartesian3,r=t.Cartesian4,o=t.Cartographic,n=t.defaultValue,a=t.defined,s=t.destroyObject,l=t.DeveloperError,g=t.Ellipsoid,h=t.HeadingPitchRoll,c=t.IntersectionTests,C=t.isArray,d=t.KeyboardEventModifier,u=t.Math,p=t.Matrix3,A=t.Matrix4,I=t.OrthographicFrustum,m=t.Plane,f=t.Quaternion,v=t.Ray,y=t.Transforms,_=t.CameraEventAggregator,w=t.CameraEventType,P=t.MapMode2D,b=t.SceneMode,E=t.SceneTransforms,T=t.TweenCollection;function M(r){if(!a(r))throw new l("scene is required.");this.constrainedPitch=-u.PI_OVER_SIX,this.enableInputs=!0,this.enableTranslate=!0,this.enableZoom=!0,this.enableRotate=!0,this.enableTilt=!0,this.enableLook=!0,this.inertiaSpin=.9,this.inertiaTranslate=.9,this.inertiaZoom=.8,this.maximumMovementRatio=.1,this.bounceAnimationTime=3,this.minimumZoomDistance=1,this.maximumZoomDistance=Number.POSITIVE_INFINITY,this.translateEventTypes=w.LEFT_DRAG,this.zoomEventTypes=[w.WHEEL,w.PINCH],this.rotateEventTypes=w.LEFT_DRAG,this.tiltEventTypes=[w.RIGHT_DRAG,w.MIDDLE_DRAG,w.PINCH,{eventType:w.LEFT_DRAG,modifier:d.CTRL},{eventType:w.RIGHT_DRAG,modifier:d.CTRL}],this.lookEventTypes={eventType:w.LEFT_DRAG,modifier:d.SHIFT},this.minimumPickingTerrainHeight=15e4,this._minimumPickingTerrainHeight=this.minimumPickingTerrainHeight,this.minimumCollisionTerrainHeight=15e3,this._minimumCollisionTerrainHeight=this.minimumCollisionTerrainHeight,this.minimumTrackBallHeight=-75e5,this._minimumTrackBallHeight=this.minimumTrackBallHeight,this.enableCollisionDetection=!0,this._scene=r,this._globe=void 0,this._ellipsoid=void 0,t.GeoOption&&t.GeoOption.GeoCameraEventAggregator?this._aggregator=new t.GeoCameraEventAggregator(r.canvas):this._aggregator=new _(r.canvas),this._lastInertiaSpinMovement=void 0,this._lastInertiaZoomMovement=void 0,this._lastInertiaTranslateMovement=void 0,this._lastInertiaTiltMovement=void 0,this._tweens=new T,this._tween=void 0,this._horizontalRotationAxis=void 0,this._tiltCenterMousePosition=new e(-1,-1),this._tiltCenter=new i,this._rotateMousePosition=new e(-1,-1),this._rotateStartPosition=new i,this._strafeStartPosition=new i,this._zoomMouseStart=new e(-1,-1),this._zoomWorldPosition=new i,this._useZoomWorldPosition=!1,this._tiltCVOffMap=!1,this._looking=!1,this._rotating=!1,this._strafing=!1,this._zoomingOnVector=!1,this._rotatingZoom=!1;var n=r.mapProjection;this._maxCoord=n.project(new o(Math.PI,u.PI_OVER_TWO)),this._zoomFactor=5,this._rotateFactor=void 0,this._rotateRateRangeAdjustment=void 0,this._maximumRotateRate=1.77,this._minimumRotateRate=2e-4,this._minimumZoomRate=20,this._maximumZoomRate=5906376272e3}var x=.4;function S(t,i,r,o,n,s,l){var g=s[l];a(g)||(g=s[l]={startPosition:new e,endPosition:new e,motion:new e,active:!1});var h,c=t.getButtonPressTime(i,r),C=t.getButtonReleaseTime(i,r),d=c&&C&&(C.getTime()-c.getTime())/1e3,p=new Date,A=C&&(p.getTime()-C.getTime())/1e3;if(c&&C&&d<x){var I=function(t,e){if(t<0)return 0;var i=25*(1-e);return Math.exp(-i*t)}(A,o);if(g.active)g.startPosition=e.clone(g.endPosition,g.startPosition),g.endPosition=e.multiplyByScalar(g.motion,I,g.endPosition),g.endPosition=e.add(g.startPosition,g.endPosition,g.endPosition),g.motion=e.clone(e.ZERO,g.motion);else{var m=t.getLastMovement(i,r);if(!a(m)||(h=m,e.equalsEpsilon(h.startPosition,h.endPosition,u.EPSILON14)))return;g.motion.x=.5*(m.endPosition.x-m.startPosition.x),g.motion.y=.5*(m.endPosition.y-m.startPosition.y),g.startPosition=e.clone(m.startPosition,g.startPosition),g.endPosition=e.multiplyByScalar(g.motion,I,g.endPosition),g.endPosition=e.add(g.startPosition,g.endPosition,g.endPosition),g.active=!0}if(isNaN(g.endPosition.x)||isNaN(g.endPosition.y)||e.distance(g.startPosition,g.endPosition)<.5)return void(g.active=!1);if(!t.isButtonDown(i,r))n(s,t.getStartMousePosition(i,r),g)}else g.active=!1}var L=[];function R(t,e,i,r,o,n){if(a(i)){var s=t._aggregator;C(i)||(L[0]=i,i=L);for(var l=i.length,g=0;g<l;++g){var h=i[g],c=a(h.eventType)?h.eventType:h,d=h.modifier,u=s.isMoving(c,d)&&s.getMovement(c,d),p=s.getStartMousePosition(c,d);t.enableInputs&&e&&(u?r(t,p,u):o<1&&S(s,c,d,o,r,t,n))}}}var D=new v,k=new i,O=new e,F=new i,H=new e,B=new i,N=new i,G=new i,W=new i,U=new i,V=new i,z=new i,Z=new i,q=new i,j=new i,Y=new i,K=new i,X=new i,Q=new i,J=new i,$=new i,tt=new i,et=new i,it={orientation:new h};function rt(o,n,s,l,g,h){var c=1;a(h)&&(c=u.clamp(Math.abs(h),.25,1));var C=o.minimumZoomDistance*c,d=o.maximumZoomDistance,p=l*(g-C);p=u.clamp(p,o._minimumZoomRate,o._maximumZoomRate);var A=s.endPosition.y-s.startPosition.y;if(!(o.autoResetHeadingPitch&&A<0&&function(e,i){var o=r.clone(r.UNIT_W),n=r.clone(r.UNIT_W),a=e._scene,s=a.globe.ellipsoid,l=a.camera,g=a.canvas;if(Math.abs(l.pitch)>=1.5&&(l.heading<=.25||l.heading>=6.03))return!1;var h=l.pickEllipsoid(new t.Cartesian2(0,g.clientHeight),s,o),c=l.pickEllipsoid(new t.Cartesian2(g.clientWidth,g.clientHeight),s,n);if(h&&c&&Math.abs(h.x-c.x)<8e4&&Math.abs(h.y-c.y)<8e4)return!1;var C=new t.Ray;C=l.getPickRay(i,C);var d=a.globe.pick(C,a);d||(C.origin=l.positionWC,C.direction=l.directionWC,d=a.globe.pick(C,a));var u=s.cartographicToCartesian(viewer.camera.positionCartographic,new t.Cartesian3),p=(s.geodeticSurfaceNormal(d),new t.BoundingSphere(d,0));return l.flyToBoundingSphere(p,{offset:new t.HeadingPitchRange(0,t.Math.toRadians(-90),t.Cartesian3.distance(u,d)),duration:0}),!0}(o,n))){var m=A/o._scene.canvas.clientHeight,f=p*(m=Math.min(m,o.maximumMovementRatio));if(!(f>0&&Math.abs(g-C)<1||f<0&&Math.abs(g-d)<1)){g-f<C?f=g-C-1:g-f>d&&(f=g-d);var v=o._scene,y=v.camera,_=v.mode,w=it.orientation;if(w.heading=y.heading,w.pitch=y.pitch,w.roll=y.roll,y.frustum instanceof I)Math.abs(f)>0&&(y.zoomIn(f),y._adjustOrthographicFrustum());else{var P,T=e.equals(n,o._zoomMouseStart),M=o._zoomingOnVector,x=o._rotatingZoom;if(T||(o._zoomMouseStart=e.clone(n,o._zoomMouseStart),a(o._globe)&&(P=_!==b.SCENE2D?pt(o,n,k):y.getPickRay(n,D).origin),a(P)?(o._useZoomWorldPosition=!0,o._zoomWorldPosition=i.clone(P,o._zoomWorldPosition)):o._useZoomWorldPosition=!1,M=o._zoomingOnVector=!1,x=o._rotatingZoom=!1),o._useZoomWorldPosition){var S=_===b.COLUMBUS_VIEW;if(y.positionCartographic.height<2e6&&(x=!0),!T||x){if(_===b.SCENE2D){var L=o._zoomWorldPosition,R=y.position;if(!i.equals(L,R)&&y.positionCartographic.height<2*o._maxCoord.x){var rt=y.position.x,ot=i.subtract(L,R,F);i.normalize(ot,ot);var nt=i.distance(L,R)*f/(.5*y.getMagnitude());y.move(ot,.5*nt),(y.position.x<0&&rt>0||y.position.x>0&&rt<0)&&(P=y.getPickRay(n,D).origin,o._zoomWorldPosition=i.clone(P,o._zoomWorldPosition))}}else if(_===b.SCENE3D){var at=i.normalize(y.position,U);if(y.positionCartographic.height<3e3&&Math.abs(i.dot(y.direction,at))<.6)S=!0;else{var st=v.canvas,lt=H;lt.x=st.clientWidth/2,lt.y=st.clientHeight/2;var gt=pt(o,lt,B);if(a(gt)&&y.positionCartographic.height<1e6){var ht=z;i.clone(y.position,ht);var ct=o._zoomWorldPosition,Ct=V;if(Ct=i.normalize(ct,Ct),i.dot(Ct,at)<0)return;var dt=J,ut=j;i.clone(y.direction,ut),i.add(ht,i.multiplyByScalar(ut,1e3,$),dt);var At=Y,It=K;i.subtract(ct,ht,At),i.normalize(At,It);var mt=i.dot(at,It);if(mt>=0)return void(o._zoomMouseStart.x=-1);var ft=Math.acos(-mt),vt=i.magnitude(ht),yt=i.magnitude(ct),_t=vt-f,wt=i.magnitude(At),Pt=Math.asin(u.clamp(wt/yt*Math.sin(ft),-1,1))-Math.asin(u.clamp(_t/yt*Math.sin(ft),-1,1))+ft,bt=Z;i.normalize(ht,bt);var Et=q;Et=i.cross(It,bt,Et),Et=i.normalize(Et,Et),i.normalize(i.cross(bt,Et,$),ut),i.multiplyByScalar(i.normalize(dt,$),i.magnitude(dt)-f,dt),i.normalize(ht,ht),i.multiplyByScalar(ht,_t,ht);var Tt=X;i.multiplyByScalar(i.add(i.multiplyByScalar(bt,Math.cos(Pt)-1,tt),i.multiplyByScalar(ut,Math.sin(Pt),et),$),_t,Tt),i.add(ht,Tt,ht),i.normalize(dt,bt),i.normalize(i.cross(bt,Et,$),ut);var Mt=Q;return i.multiplyByScalar(i.add(i.multiplyByScalar(bt,Math.cos(Pt)-1,tt),i.multiplyByScalar(ut,Math.sin(Pt),et),$),i.magnitude(dt),Mt),i.add(dt,Mt,dt),i.clone(ht,y.position),i.normalize(i.subtract(dt,ht,$),y.direction),i.clone(y.direction,y.direction),i.cross(y.direction,y.up,y.right),i.cross(y.right,y.direction,y.up),void y.setView(it)}if(a(gt)){var xt=i.normalize(gt,N),St=i.normalize(o._zoomWorldPosition,G),Lt=i.dot(St,xt);if(Lt>0&&Lt<1){var Rt=u.acosClamped(Lt),Dt=i.cross(St,xt,W),kt=f/(Math.abs(Rt)>u.toRadians(20)?.75*y.positionCartographic.height:y.positionCartographic.height-f);y.rotate(Dt,Rt*kt)}}else S=!0}}o._rotatingZoom=!S}if(!T&&S||M){var Ot=E.wgs84ToWindowCoordinates(v,o._zoomWorldPosition,O),Ft=(_!==b.COLUMBUS_VIEW&&e.equals(n,o._zoomMouseStart)&&a(Ot)?y.getPickRay(Ot,D):y.getPickRay(n,D)).direction;_===b.COLUMBUS_VIEW&&i.fromElements(Ft.y,Ft.z,Ft.x,Ft),y.move(Ft,f),o._zoomingOnVector=!0}else y.zoomIn(f);y.setView(it)}else y.zoomIn(f)}}}}var ot=new v,nt=new v,at=new i;function st(t,e,r){var o=t._scene.camera,n=o.getPickRay(r.startPosition,ot).origin,a=o.getPickRay(r.endPosition,nt).origin,s=i.subtract(n,a,at),l=i.magnitude(s);l>0&&(i.normalize(s,s),o.move(s,l))}function lt(t,e,i){a(i.distance)&&(i=i.distance);var r=t._scene.camera;rt(t,e,i,t._zoomFactor,r.getMagnitude())}var gt=new e,ht=new e;function ct(t,i,r){if(a(r.angleAndHeight))!function(t,e,i){var r=t._rotateFactor*t._rotateRateRangeAdjustment;r>t._maximumRotateRate&&(r=t._maximumRotateRate);r<t._minimumRotateRate&&(r=t._minimumRotateRate);var o=t._scene,n=o.camera,a=o.canvas,s=(i.endPosition.x-i.startPosition.x)/a.clientWidth;s=Math.min(s,t.maximumMovementRatio);var l=r*s*Math.PI*4;n.twistRight(l)}(t,0,r.angleAndHeight);else{var o=t._scene,n=o.camera,s=o.canvas,l=s.clientWidth,g=s.clientHeight,h=gt;h.x=2/l*r.startPosition.x-1,h.y=2/g*(g-r.startPosition.y)-1,h=e.normalize(h,h);var c=ht;c.x=2/l*r.endPosition.x-1,c.y=2/g*(g-r.endPosition.y)-1,c=e.normalize(c,c);var C=u.acosClamped(h.x);h.y<0&&(C=u.TWO_PI-C);var d=u.acosClamped(c.x);c.y<0&&(d=u.TWO_PI-d);var p=d-C;n.twistRight(p)}}var Ct=new v,dt=new i,ut=new i;function pt(t,e,r){var o=t._scene,n=t._globe,s=o.camera;if(a(n)){var l;o.pickPositionSupported&&(l=o.pickPositionWorldCoordinates(e,dt));var g=s.getPickRay(e,Ct),h=n.pick(g,o,ut);return(a(l)?i.distance(l,s.positionWC):Number.POSITIVE_INFINITY)<(a(h)?i.distance(h,s.positionWC):Number.POSITIVE_INFINITY)?i.clone(l,r):i.clone(h,r)}}var At=new v,It=new v,mt=new i,ft=new i,vt=new i,yt=new i,_t=new m(i.UNIT_X,0),wt=new e,Pt=new e;function bt(t,r,o){if(i.equals(r,t._translateMousePosition)||(t._looking=!1),i.equals(r,t._strafeMousePosition)||(t._strafing=!1),t._looking)Oe(t,r,o);else if(t._strafing)Xt(t,r,o);else{var n,s=t._scene.camera,l=e.clone(o.startPosition,wt),g=e.clone(o.endPosition,Pt),h=s.getPickRay(l,At),C=i.clone(i.ZERO,yt),d=i.UNIT_X;if(s.position.z<t._minimumPickingTerrainHeight&&(n=pt(t,l,mt),a(n)&&(C.x=n.x)),C.x>s.position.z&&a(n))return i.clone(n,t._strafeStartPosition),t._strafing=!0,Xt(t,r,o),void(t._strafeMousePosition=e.clone(r,t._strafeMousePosition));var p=m.fromPointNormal(C,d,_t);h=s.getPickRay(l,At);var A=c.rayPlane(h,p,mt),I=s.getPickRay(g,It),f=c.rayPlane(I,p,ft);if(!a(A)||!a(f))return t._looking=!0,Oe(t,r,o),void e.clone(r,t._translateMousePosition);var v=i.subtract(A,f,vt),y=v.x;v.x=v.y,v.y=v.z,v.z=y;var _=i.magnitude(v);_>u.EPSILON6&&(i.normalize(v,v),s.move(v,_))}}var Et=new e,Tt=new v,Mt=new i,xt=new i,St=new A,Lt=new A,Rt=new i,Dt=new m(i.UNIT_X,0),kt=new i,Ot=new o,Ft=new A,Ht=new f,Bt=new p,Nt=new i;function Gt(t,r,o){if(a(o.angleAndHeight)&&(o=o.angleAndHeight),e.equals(r,t._tiltCenterMousePosition)||(t._tiltCVOffMap=!1,t._looking=!1),t._looking)Oe(t,r,o);else{var n=t._scene.camera,s=t._maxCoord,l=Math.abs(n.position.x)-s.x<0&&Math.abs(n.position.y)-s.y<0;t._tiltCVOffMap||!l||n.position.z>t._minimumPickingTerrainHeight?(t._tiltCVOffMap=!0,function(t,r,o){var n=t._scene,s=n.camera,l=n.canvas,h=Et;h.x=l.clientWidth/2,h.y=l.clientHeight/2;var c,C=s.getPickRay(h,Tt),d=i.UNIT_X,p=C.origin,I=C.direction,m=i.dot(d,I);Math.abs(m)>u.EPSILON6&&(c=-i.dot(d,p)/m);if(!a(c)||c<=0)return t._looking=!0,Oe(t,r,o),void e.clone(r,t._tiltCenterMousePosition);var f=i.multiplyByScalar(I,c,Mt);i.add(p,f,f);var v=n.mapProjection,_=v.ellipsoid;i.fromElements(f.y,f.z,f.x,f);var w=v.unproject(f,Ot);_.cartographicToCartesian(w,f);var P=y.eastNorthUpToFixedFrame(f,_,St),b=t._globe,E=t._ellipsoid;t._globe=void 0,t._ellipsoid=g.UNIT_SPHERE,t._rotateFactor=1,t._rotateRateRangeAdjustment=1;var T=A.clone(s.transform,Ft);s._setTransform(P),re(t,r,o,i.UNIT_Z),s._setTransform(T),t._globe=b,t._ellipsoid=E;var M=E.maximumRadius;t._rotateFactor=1/M,t._rotateRateRangeAdjustment=M}(t,r,o)):function(t,r,o){var n,s,l=t._scene,h=l.camera,C=i.UNIT_X;if(e.equals(r,t._tiltCenterMousePosition))n=i.clone(t._tiltCenter,Mt);else{if(h.position.z<t._minimumPickingTerrainHeight&&(n=pt(t,r,Mt)),!a(n)){var d,I=(s=h.getPickRay(r,Tt)).origin,v=s.direction,_=i.dot(C,v);if(Math.abs(_)>u.EPSILON6&&(d=-i.dot(C,I)/_),!a(d)||d<=0)return t._looking=!0,Oe(t,r,o),void e.clone(r,t._tiltCenterMousePosition);n=i.multiplyByScalar(v,d,Mt),i.add(I,n,n)}e.clone(r,t._tiltCenterMousePosition),i.clone(n,t._tiltCenter)}var w=l.canvas,P=Et;P.x=w.clientWidth/2,P.y=t._tiltCenterMousePosition.y,s=h.getPickRay(P,Tt);var b=i.clone(i.ZERO,Rt);b.x=n.x;var E=m.fromPointNormal(b,C,Dt),T=c.rayPlane(s,E,xt),M=h._projection,x=M.ellipsoid;i.fromElements(n.y,n.z,n.x,n);var S=M.unproject(n,Ot);x.cartographicToCartesian(S,n);var L,R=y.eastNorthUpToFixedFrame(n,x,St);a(T)?(i.fromElements(T.y,T.z,T.x,T),S=M.unproject(T,Ot),x.cartographicToCartesian(S,T),L=y.eastNorthUpToFixedFrame(T,x,Lt)):L=R;var D=t._globe,k=t._ellipsoid;t._globe=void 0,t._ellipsoid=g.UNIT_SPHERE,t._rotateFactor=1,t._rotateRateRangeAdjustment=1;var O=i.UNIT_Z,F=A.clone(h.transform,Ft);h._setTransform(R);var H=i.cross(i.UNIT_Z,i.normalize(h.position,kt),kt),B=i.dot(h.right,H);if(re(t,r,o,O,!1,!0),h._setTransform(L),B<0){o.startPosition.y>o.endPosition.y&&(O=void 0);var N=h.constrainedAxis;h.constrainedAxis=void 0,re(t,r,o,O,!0,!1),h.constrainedAxis=N}else re(t,r,o,O,!0,!1);if(a(h.constrainedAxis)){var G=i.cross(h.direction,h.constrainedAxis,Nt);i.equalsEpsilon(G,i.ZERO,u.EPSILON6)||(i.dot(G,h.right)<0&&i.negate(G,G),i.cross(G,h.direction,h.up),i.cross(h.direction,h.up,h.right),i.normalize(h.up,h.up),i.normalize(h.right,h.right))}h._setTransform(F),t._globe=D,t._ellipsoid=k;var W=k.maximumRadius;t._rotateFactor=1/W,t._rotateRateRangeAdjustment=W;var U=i.clone(h.positionWC,kt);if(h._adjustHeightForTerrain(),!i.equals(h.positionWC,U)){h._setTransform(L),h.worldToCameraCoordinatesPoint(U,U);var V=i.magnitudeSquared(U);i.magnitudeSquared(h.position)>V&&(i.normalize(h.position,h.position),i.multiplyByScalar(h.position,Math.sqrt(V),h.position));var z=i.angleBetween(U,h.position),Z=i.cross(U,h.position,U);i.normalize(Z,Z);var q=f.fromAxisAngle(Z,z,Ht),j=p.fromQuaternion(q,Bt);p.multiplyByVector(j,h.direction,h.direction),p.multiplyByVector(j,h.up,h.up),i.cross(h.direction,h.up,h.right),i.cross(h.right,h.direction,h.up),h._setTransform(F)}}(t,r,o)}}var Wt=new e,Ut=new v,Vt=new i;function zt(t,e,r){a(r.distance)&&(r=r.distance);var o=t._scene,n=o.camera,s=o.canvas,l=Wt;l.x=s.clientWidth/2,l.y=s.clientHeight/2;var g,h,c=n.getPickRay(l,Ut);if(n.position.z<t._minimumPickingTerrainHeight&&(g=pt(t,l,Vt)),a(g))h=i.distance(c.origin,g);else{var C=i.UNIT_X,d=c.origin,u=c.direction;h=-i.dot(C,d)/i.dot(C,u)}rt(t,e,r,t._zoomFactor,h)}var Zt=new v,qt=new m(i.UNIT_X,0),jt=new i,Yt=new i,Kt=new i;function Xt(t,e,r){var o=t._scene,n=o.camera,s=pt(t,r.startPosition,Kt);if(a(s)){var l=r.endPosition,g=n.getPickRay(l,Zt),h=i.clone(n.direction,Yt);o.mode===b.COLUMBUS_VIEW&&i.fromElements(h.z,h.x,h.y,h);var C=m.fromPointNormal(s,h,qt),d=c.rayPlane(g,C,jt);a(d)&&(h=i.subtract(s,d,h),o.mode===b.COLUMBUS_VIEW&&i.fromElements(h.y,h.z,h.x,h),i.add(n.position,h,n.position))}}var Qt=new i,Jt=new o,$t=new i,te=new g,ee=new i;function ie(t,r,o){var n=t._scene.camera;if(A.equals(n.transform,A.IDENTITY)){var s,l,h,c=t._ellipsoid.geodeticSurfaceNormal(n.position,ee),C=t._ellipsoid.cartesianToCartographic(n.positionWC,Jt).height,d=t._globe;if(a(d)&&C<t._minimumPickingTerrainHeight&&(h=pt(t,o.startPosition,Kt),a(h))){var p=n.getPickRay(o.startPosition,Ct),I=t._ellipsoid.geodeticSurfaceNormal(h);Math.abs(i.dot(p.direction,I))<.05&&!t._looking&&(t._rotating=!1,t._strafing=!0)}e.equals(r,t._rotateMousePosition)?t._looking?Oe(t,r,o,c):t._rotating?re(t,r,o):t._strafing?(i.clone(h,t._strafeStartPosition),Xt(t,0,o)):(s=i.magnitude(t._rotateStartPosition),(l=$t).x=l.y=l.z=s,Ce(t,r,o,g.fromCartesian3(l,te))):(t._looking=!1,t._rotating=!1,t._strafing=!1,a(d)&&C<t._minimumPickingTerrainHeight?a(h)?i.magnitude(n.position)<i.magnitude(h)?(i.clone(h,t._strafeStartPosition),t._strafing=!0,Xt(t,0,o)):(s=i.magnitude(h),(l=$t).x=l.y=l.z=s,Ce(t,r,o,g.fromCartesian3(l,te)),i.clone(h,t._rotateStartPosition)):(t._looking=!0,Oe(t,r,o,c)):a(n.pickEllipsoid(o.startPosition,t._ellipsoid,Qt))?(Ce(t,r,o,t._ellipsoid),i.clone(Qt,t._rotateStartPosition)):C>t._minimumTrackBallHeight?(t._rotating=!0,re(t,r,o)):(t._looking=!0,Oe(t,r,o,c)),e.clone(r,t._rotateMousePosition))}else{o&&o.startPosition&&o.endPosition&&(r=o.endPosition,o.endPosition=o.startPosition,o.startPosition=r,o.endPosition.x=(o.startPosition.x+o.endPosition.x)/2,o.endPosition.y=(o.startPosition.y+o.endPosition.y)/2),n.pitch>u.clamp(t.constrainedPitch,-u.PI,0)&&o.startPosition.y-o.endPosition.y>=0?re(t,r,o,i.UNIT_Z,!1,!0):re(t,r,o)}}function re(t,e,r,o,s,l){s=n(s,!1),l=n(l,!1);var g=t._scene,h=g.camera,c=g.canvas,C=h.constrainedAxis;a(o)&&(h.constrainedAxis=o);var d=i.magnitude(h.position),u=t._rotateFactor*(d-t._rotateRateRangeAdjustment);u>t._maximumRotateRate&&(u=t._maximumRotateRate),u<t._minimumRotateRate&&(u=t._minimumRotateRate);var p=(r.startPosition.x-r.endPosition.x)/c.clientWidth,A=(r.startPosition.y-r.endPosition.y)/c.clientHeight;p=Math.min(p,t.maximumMovementRatio),A=Math.min(A,t.maximumMovementRatio);var I=u*p*Math.PI*2,m=u*A*Math.PI;s||h.rotateRight(-I),l||h.rotateUp(m),h.constrainedAxis=C}var oe=r.clone(r.UNIT_W),ne=r.clone(r.UNIT_W),ae=new i,se=new i,le=new i,ge=new i,he=new e,ce=new e;function Ce(t,r,o,n){var s=t._scene.camera,l=e.clone(o.startPosition,he),g=e.clone(o.endPosition,ce),h=s.pickEllipsoid(l,n,oe),c=s.pickEllipsoid(g,n,ne);if(!a(h)||!a(c))return t._rotating=!0,void re(t,0,o);if(h=s.worldToCameraCoordinates(h,h),c=s.worldToCameraCoordinates(c,c),a(s.constrainedAxis)){var C=s.constrainedAxis,d=i.mostOrthogonalAxis(C,ae);i.cross(d,C,d),i.normalize(d,d);var p=i.cross(C,d,se),A=i.magnitude(h),I=i.dot(C,h),m=Math.acos(I/A),f=i.multiplyByScalar(C,I,le);i.subtract(h,f,f),i.normalize(f,f);var v=i.magnitude(c),y=i.dot(C,c),_=Math.acos(y/v),w=i.multiplyByScalar(C,y,ge);i.subtract(c,w,w),i.normalize(w,w);var P=Math.acos(i.dot(f,d));i.dot(f,p)<0&&(P=u.TWO_PI-P);var b=Math.acos(i.dot(w,d));i.dot(w,p)<0&&(b=u.TWO_PI-b);var E,T=P-b;E=i.equalsEpsilon(C,s.position,u.EPSILON2)?s.right:i.cross(C,s.position,ae);var M,x=i.cross(C,E,ae),S=i.dot(x,i.subtract(h,C,se)),L=i.dot(x,i.subtract(c,C,se));M=S>0&&L>0?_-m:S>0&&L<=0?i.dot(s.position,C)>0?-m-_:m+_:m-_,s.rotateRight(T),s.rotateUp(M)}else{i.normalize(h,h),i.normalize(c,c);var R=i.dot(h,c),D=i.cross(h,c,ae);if(R<1&&!i.equalsEpsilon(D,i.ZERO,u.EPSILON14)){var k=Math.acos(R);s.rotate(D,k)}}}var de=new i,ue=new o;function pe(t,e,r){a(r.distance)&&(r=r.distance);var o=t._ellipsoid,n=t._scene,s=n.camera,l=n.canvas,g=Wt;g.x=l.clientWidth/2,g.y=l.clientHeight/2;var h,c,C=s.getPickRay(g,Ut),d=o.cartesianToCartographic(s.position,ue).height;d<t._minimumPickingTerrainHeight&&(h=pt(t,g,Vt)),c=a(h)?i.distance(C.origin,h):d;var u=i.normalize(s.position,de);rt(t,e,r,t._zoomFactor,c,i.dot(u,s.direction))}var Ae=new e,Ie=new v,me=new i,fe=new i,ve=new A,ye=new A,_e=new A,we=new f,Pe=new p,be=new o,Ee=new i;function Te(t,r,o){var n=t._scene.camera;if(o&&o.startPosition&&o.endPosition&&(r=o.endPosition,o.endPosition=o.startPosition,o.startPosition=r,o.endPosition.x=(o.startPosition.x+o.endPosition.x)/2,o.endPosition.y=(o.startPosition.y+o.endPosition.y)/2),A.equals(n.transform,A.IDENTITY))if(a(o.angleAndHeight)&&(o=o.angleAndHeight),e.equals(r,t._tiltCenterMousePosition)||(t._tiltOnEllipsoid=!1,t._looking=!1),t._looking){Oe(t,r,o,t._ellipsoid.geodeticSurfaceNormal(n.position,Ee))}else{var s=t._ellipsoid.cartesianToCartographic(n.position,be);t._tiltOnEllipsoid||s.height>t._minimumCollisionTerrainHeight?(t._tiltOnEllipsoid=!0,function(t,r,o){var n=t._ellipsoid,s=t._scene,l=s.camera,h=.25*t.minimumZoomDistance,C=n.cartesianToCartographic(l.positionWC,Me).height;if(C-h-1<u.EPSILON3&&o.endPosition.y-o.startPosition.y<0)return;var d=s.canvas,p=Ae;p.x=d.clientWidth/2,p.y=d.clientHeight/2;var I,m=l.getPickRay(p,Ie),f=c.rayEllipsoid(m,n);if(a(f))I=v.getPoint(m,f.start,me);else{if(!(C>t._minimumTrackBallHeight)){t._looking=!0;var _=t._ellipsoid.geodeticSurfaceNormal(l.position,Ee);return Oe(t,r,o,_),void e.clone(r,t._tiltCenterMousePosition)}var w=c.grazingAltitudeLocation(m,n);if(!a(w))return;var P=n.cartesianToCartographic(w,be);P.height=0,I=n.cartographicToCartesian(P,me)}var b=y.eastNorthUpToFixedFrame(I,n,ve),E=t._globe,T=t._ellipsoid;t._globe=void 0,t._ellipsoid=g.UNIT_SPHERE,t._rotateFactor=1,t._rotateRateRangeAdjustment=1;var M=A.clone(l.transform,_e);l._setTransform(b),re(t,0,o,i.UNIT_Z),l._setTransform(M),t._globe=E,t._ellipsoid=T;var x=T.maximumRadius;t._rotateFactor=1/x,t._rotateRateRangeAdjustment=x}(t,r,o)):function(t,r,o){var n,s,l,h=t._ellipsoid,C=t._scene,d=C.camera;if(e.equals(r,t._tiltCenterMousePosition))n=i.clone(t._tiltCenter,me);else{if(n=pt(t,r,me),!a(n)){if(s=d.getPickRay(r,Ie),l=c.rayEllipsoid(s,h),!a(l)){var I=h.cartesianToCartographic(d.position,be);if(I.height<=t._minimumTrackBallHeight){t._looking=!0;var m=t._ellipsoid.geodeticSurfaceNormal(d.position,Ee);Oe(t,r,o,m),e.clone(r,t._tiltCenterMousePosition)}return}n=v.getPoint(s,l.start,me)}e.clone(r,t._tiltCenterMousePosition),i.clone(n,t._tiltCenter)}var _=C.canvas,w=Ae;w.x=_.clientWidth/2,w.y=t._tiltCenterMousePosition.y,s=d.getPickRay(w,Ie);var P=i.magnitude(n),b=i.fromElements(P,P,P,$t),E=g.fromCartesian3(b,te);if(l=c.rayEllipsoid(s,E),!a(l))return;var T=i.magnitude(s.origin)>P?l.start:l.stop,M=v.getPoint(s,T,fe),x=y.eastNorthUpToFixedFrame(n,h,ve),S=y.eastNorthUpToFixedFrame(M,E,ye),L=t._globe,R=t._ellipsoid;t._globe=void 0,t._ellipsoid=g.UNIT_SPHERE,t._rotateFactor=1,t._rotateRateRangeAdjustment=1;var D=i.UNIT_Z,k=A.clone(d.transform,_e);d._setTransform(x);var O=i.cross(M,d.positionWC,Nt),F=i.dot(d.rightWC,O);if(re(t,0,o,D,!1,!0),d._setTransform(S),F<0){o.startPosition.y>o.endPosition.y&&(D=void 0);var H=d.constrainedAxis;d.constrainedAxis=void 0,re(t,0,o,D,!0,!1),d.constrainedAxis=H}else(d.pitch<u.clamp(t.constrainedPitch,-u.PI,0)||o.startPosition.y-o.endPosition.y<=0)&&re(t,0,o,D,!0,!1);if(a(d.constrainedAxis)){var B=i.cross(d.direction,d.constrainedAxis,Nt);i.equalsEpsilon(B,i.ZERO,u.EPSILON6)||(i.dot(B,d.right)<0&&i.negate(B,B),i.cross(B,d.direction,d.up),i.cross(d.direction,d.up,d.right),i.normalize(d.up,d.up),i.normalize(d.right,d.right))}d._setTransform(k),t._globe=L,t._ellipsoid=R;var N=R.maximumRadius;t._rotateFactor=1/N,t._rotateRateRangeAdjustment=N;var G=i.clone(d.positionWC,Nt);if(d._adjustHeightForTerrain(),!i.equals(d.positionWC,G)){d._setTransform(S),d.worldToCameraCoordinatesPoint(G,G);var W=i.magnitudeSquared(G);i.magnitudeSquared(d.position)>W&&(i.normalize(d.position,d.position),i.multiplyByScalar(d.position,Math.sqrt(W),d.position));var U=i.angleBetween(G,d.position),V=i.cross(G,d.position,G);i.normalize(V,V);var z=f.fromAxisAngle(V,U,we),Z=p.fromQuaternion(z,Pe);p.multiplyByVector(Z,d.direction,d.direction),p.multiplyByVector(Z,d.up,d.up),i.cross(d.direction,d.up,d.right),i.cross(d.right,d.direction,d.up),d._setTransform(k)}}(t,r,o)}}var Me=new o;var xe=new e,Se=new e,Le=new v,Re=new v,De=new i,ke=new i;function Oe(t,e,r,o){var s=t._scene.camera,l=xe;l.x=r.startPosition.x,l.y=0;var g=Se;g.x=r.endPosition.x,g.y=0;var h,c,C=s.getPickRay(l,Le),d=s.getPickRay(g,Re),p=0;s.frustum instanceof I?(h=C.origin,c=d.origin,i.add(s.direction,h,h),i.add(s.direction,c,c),i.subtract(h,s.position,h),i.subtract(c,s.position,c),i.normalize(h,h),i.normalize(c,c)):(h=C.direction,c=d.direction);var A=i.dot(h,c);A<1&&(p=Math.acos(A)),p=r.startPosition.x>r.endPosition.x?-p:p;var m=t._horizontalRotationAxis;if(a(o)?s.look(o,-p):a(m)?s.look(m,-p):s.lookLeft(p),l.x=0,l.y=r.startPosition.y,g.x=0,g.y=r.endPosition.y,C=s.getPickRay(l,Le),d=s.getPickRay(g,Re),p=0,s.frustum instanceof I?(h=C.origin,c=d.origin,i.add(s.direction,h,h),i.add(s.direction,c,c),i.subtract(h,s.position,h),i.subtract(c,s.position,c),i.normalize(h,h),i.normalize(c,c)):(h=C.direction,c=d.direction),(A=i.dot(h,c))<1&&(p=Math.acos(A)),p=r.startPosition.y>r.endPosition.y?-p:p,o=n(o,m),a(o)){var f=s.direction,v=i.negate(o,De),y=i.equalsEpsilon(f,o,u.EPSILON2),_=i.equalsEpsilon(f,v,u.EPSILON2);if(y||_)(y&&p<0||_&&p>0)&&s.look(s.right,-p);else{A=i.dot(f,o);var w=u.acosClamped(A);p>0&&p>w&&(p=w-u.EPSILON4),A=i.dot(f,v),w=u.acosClamped(A),p<0&&-p>w&&(p=-w+u.EPSILON4);var P=i.cross(o,f,ke);s.look(P,p)}}else s.lookUp(p)}M.prototype.update=function(){A.equals(this._scene.camera.transform,A.IDENTITY)?(this._globe=this._scene.globe,this._ellipsoid=a(this._globe)?this._globe.ellipsoid:this._scene.mapProjection.ellipsoid):(this._globe=void 0,this._ellipsoid=g.UNIT_SPHERE),this._minimumCollisionTerrainHeight=this.minimumCollisionTerrainHeight*this._scene.terrainExaggeration,this._minimumPickingTerrainHeight=this.minimumPickingTerrainHeight*this._scene.terrainExaggeration,this._minimumTrackBallHeight=this.minimumTrackBallHeight*this._scene.terrainExaggeration;var t=this._ellipsoid.maximumRadius;this._rotateFactor=1/t,this._rotateRateRangeAdjustment=t;var e,r,o,n=this._scene.mode;n===b.SCENE2D?(o=(r=this)._scene.mapMode2D===P.ROTATE,A.equals(A.IDENTITY,r._scene.camera.transform)?(R(r,r.enableTranslate,r.translateEventTypes,st,r.inertiaTranslate,"_lastInertiaTranslateMovement"),R(r,r.enableZoom,r.zoomEventTypes,lt,r.inertiaZoom,"_lastInertiaZoomMovement"),o&&R(r,r.enableRotate,r.tiltEventTypes,ct,r.inertiaSpin,"_lastInertiaTiltMovement")):(R(r,r.enableZoom,r.zoomEventTypes,lt,r.inertiaZoom,"_lastInertiaZoomMovement"),o&&R(r,r.enableRotate,r.translateEventTypes,ct,r.inertiaSpin,"_lastInertiaSpinMovement"))):n===b.COLUMBUS_VIEW?(this._horizontalRotationAxis=i.UNIT_Z,function(t){var e=t._scene.camera;if(A.equals(A.IDENTITY,e.transform)){var i=t._tweens;if(t._aggregator.anyButtonDown&&i.removeAll(),R(t,t.enableTilt,t.tiltEventTypes,Gt,t.inertiaSpin,"_lastInertiaTiltMovement"),R(t,t.enableTranslate,t.translateEventTypes,bt,t.inertiaTranslate,"_lastInertiaTranslateMovement"),R(t,t.enableZoom,t.zoomEventTypes,zt,t.inertiaZoom,"_lastInertiaZoomMovement"),R(t,t.enableLook,t.lookEventTypes,Oe),!(t._aggregator.anyButtonDown||a(t._lastInertiaZoomMovement)&&t._lastInertiaZoomMovement.active||a(t._lastInertiaTranslateMovement)&&t._lastInertiaTranslateMovement.active||i.contains(t._tween))){var r=e.createCorrectPositionTween(t.bounceAnimationTime);a(r)&&(t._tween=i.add(r))}i.update()}else R(t,t.enableRotate,t.rotateEventTypes,re,t.inertiaSpin,"_lastInertiaSpinMovement"),R(t,t.enableZoom,t.zoomEventTypes,pe,t.inertiaZoom,"_lastInertiaZoomMovement")}(this)):n===b.SCENE3D&&(this._horizontalRotationAxis=void 0,R(e=this,e.enableRotate,e.rotateEventTypes,ie,e.inertiaSpin,"_lastInertiaSpinMovement"),R(e,e.enableZoom,e.zoomEventTypes,pe,e.inertiaZoom,"_lastInertiaZoomMovement"),R(e,e.enableTilt,e.tiltEventTypes,Te,2,"_lastInertiaTiltMovement"),R(e,e.enableLook,e.lookEventTypes,Oe)),this._aggregator.reset()},M.prototype.isDestroyed=function(){return!1},M.prototype.destroy=function(){return this._tweens.removeAll(),this._aggregator=this._aggregator&&this._aggregator.destroy(),s(this)},t.GeoScreenSpaceCameraController=M}(window.Cesium),function(t){"use strict";var e=t.GeoWalkerCamera=function(i){this.viewer=i.viewer,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.stepSize=t.defaultValue(i.stepSize,1),this.rotateSize=t.defaultValue(i.rotateSize,5),this.manHeight=t.defaultValue(i.manHeight,1.6),this.state=e.stateType.UNKNOWN,this._lockCamera=!1,this._readyCamera=!1,this._ellipsoid=this.scene.globe.ellipsoid,this._walkQueue=new function(){var t=[],e=0;this.push=function(e){return this.size()>=10&&this.pop(),t.push(e),!0},this.pop=function(){return t.shift()},this.getFront=function(){return t[0]},this.getRear=function(){return t[t.length-1]},this.clear=function(){t=[]},this.size=function(){return t.length},this.getAvgHeight=function(){for(var e=0,i=t.length,r=0;r<i;r++)e+=t[r].height;return e/i},this.getLatelyHeight=function(){return t.length>0?t[t.length-1].height:null},this.getDropThreshold=function(e){return t.length>0&&Math.abs(this.getLatelyHeight()-e.height)>4.5},this.preventFalling=function(t){this.getDropThreshold(t)&&(e>20?e=0:e>3?(t.height=this.getAvgHeight(),e++):(t.height=this.getLatelyHeight(),e++)),this.push(t)}}};e.prototype.setState=function(e){Object.keys(t.GeoWalkerCamera.stateType).filter(function(i){return t.GeoWalkerCamera.stateType[i]===e}).length>0&&(this.state=e)},e.prototype.activate=function(){this.camera._hooker=this,this.scene.logarithmicDepthBuffer=!1,t.Camera.prototype._hookUpdate=t.Camera.prototype.update,t.Camera.prototype.update=function(t){this._hookUpdate(t),this._hooker&&this._hooker.raiseUpdate(this)}},e.prototype.unactivate=function(){t.Camera.prototype._hookUpdate&&(t.Camera.prototype.update=t.Camera.prototype._hookUpdate),delete this.camera._hooker&&delete this.camera.__proto__._hookUpdate},e.prototype.raiseUpdate=function(t){if(!(!this._readyCamera||this._lockCamera||this.state<1))switch(this.state){case e.stateType.FORWARD:this.computeForeward(t);break;case e.stateType.BACKWARD:this.computeBackward(t);break;case e.stateType.LEFTWARD:case e.stateType.RIGHTWARD:break;case e.stateType.UPWARD:this.computeTrunUp(t);break;case e.stateType.DOWNWARD:this.computeTrunDown(t);break;case e.stateType.LEFT:this.computeTrunLeft(t);break;case e.stateType.RIGHT:this.computeTrunRight(t);break;case e.stateType.UNKNOWN:return}},e.prototype.setView=function(t){this._lockCamera=!0,this.camera.setView(t),this._lockCamera=!1,this._readyCamera=!0},e.prototype.jumpUp=function(t){this._lockCamera=!0,this.camera.moveUp(t||100),this._lockCamera=!1},e.prototype.computeInitialPosition=function(e){this.scene.pick(e);var i=this.scene.pickPosition(e),r=t.Cartographic.fromCartesian(i,this._ellipsoid);if(r.height>0)r.height+=this.manHeight;else{var o=this.scene.globe.getHeight(r);r.height=o>0?o+this.manHeight:1e3}this._walkQueue.preventFalling(r);var n=t.Cartesian3.fromRadians(r.longitude,r.latitude,r.height,this._ellipsoid);this._lockCamera=!0,this.camera.setView({destination:n,orientation:{heading:this.camera.heading,pitch:0,up:0}}),this._lockCamera=!1,this._readyCamera=!0},e.prototype.computeForeward=function(e){var r=new t.Cartesian3,l=e.position,g=(e.positionWC,e.directionWC.clone()),h=this.getTangentNormal(),c=t.Cartesian3.cross(g,h,n);t.Cartesian3.normalize(c,c),g=t.Cartesian3.cross(h,c,o),t.Cartesian3.normalize(g,g),t.Cartesian3.multiplyByScalar(g,1/i*this.stepSize,r),t.Cartesian3.add(l,r,l);var C=s;C.origin=l,C.direction=t.Cartesian3.negate(h,a);var d=this.scene.pickFromRay(C);if(d&&d.position&&d.object){l=t.Cartesian3.clone(d.position,l),(u=t.Cartographic.fromCartesian(l,this._ellipsoid)).height+=this.manHeight,this._walkQueue.preventFalling(u),l=t.Cartesian3.fromRadians(u.longitude,u.latitude,u.height,this._ellipsoid)}else{var u=t.Cartographic.fromCartesian(l,this._ellipsoid),p=this.scene.globe.getHeight(u);u.height=p>0?p+this.manHeight:u.height,this._walkQueue.preventFalling(u),l=t.Cartesian3.fromRadians(u.longitude,u.latitude,u.height,this._ellipsoid)}this._lockCamera=!0,e.setView({destination:l,orientation:{heading:e.heading,pitch:e.pitch,up:e.up}}),this._lockCamera=!1},e.prototype.computeBackward=function(e){var r=new t.Cartesian3,l=e.position,g=(e.positionWC,e.directionWC.clone()),h=this.getTangentNormal(),c=t.Cartesian3.cross(g,h,n);t.Cartesian3.normalize(c,c),g=t.Cartesian3.cross(h,c,o),t.Cartesian3.normalize(g,g),g=t.Cartesian3.negate(g,o),t.Cartesian3.multiplyByScalar(g,1/i*this.stepSize,r),t.Cartesian3.add(l,r,l);var C=s;C.origin=l,C.direction=t.Cartesian3.negate(h,a);var d=this.scene.pickFromRay(C);if(d&&d.position&&d.object){l=t.Cartesian3.clone(d.position,l),(u=t.Cartographic.fromCartesian(l,this._ellipsoid)).height+=this.manHeight,this._walkQueue.preventFalling(u),l=t.Cartesian3.fromRadians(u.longitude,u.latitude,u.height,this._ellipsoid)}else{var u=t.Cartographic.fromCartesian(l,this._ellipsoid),p=this.scene.globe.getHeight(u);u.height=p>0?p+this.manHeight:u.height,this._walkQueue.preventFalling(u),l=t.Cartesian3.fromRadians(u.longitude,u.latitude,u.height,this._ellipsoid)}this._lockCamera=!0,e.setView({destination:l,orientation:{heading:e.heading,pitch:e.pitch,up:e.up}}),this._lockCamera=!1},e.prototype.computeLeftward=function(t){},e.prototype.computeRightward=function(t){},e.prototype.computeTrunLeft=function(e){e.look(this.getTangentNormal(),-t.Math.toRadians(t.defaultValue(this.rotateSize,5))/i)},e.prototype.computeTrunRight=function(e){e.look(this.getTangentNormal(),t.Math.toRadians(t.defaultValue(this.rotateSize,5))/i)},e.prototype.computeTrunUp=function(e){e.look(t.Cartesian3.cross(e.directionWC.clone(),this.getTangentNormal(),n),-t.Math.toRadians(t.defaultValue(this.rotateSize,5))/i)},e.prototype.computeTrunDown=function(e){e.look(t.Cartesian3.cross(e.directionWC.clone(),this.getTangentNormal(),n),t.Math.toRadians(t.defaultValue(this.rotateSize,5))/i)},e.prototype.getTangentNormal=function(){var e=t.Transforms.eastNorthUpToFixedFrame(this.camera.positionWC,this._ellipsoid,r);return new t.Cartesian3(e[8],e[9],e[10])},e.prototype.destroy=function(){t.Camera.prototype.update=t.Camera.prototype._hookUpdate,delete this.camera._hooker&&delete this.camera.__proto__._hookUpdate,this.scene.logarithmicDepthBuffer=!0},e.stateType={UNKNOWN:0,FORWARD:1,BACKWARD:2,LEFTWARD:3,RIGHTWARD:4,UPWARD:5,DOWNWARD:6,LEFT:7,RIGHT:8};var i=40,r=new t.Matrix4,o=new t.Cartesian3,n=new t.Cartesian3,a=new t.Cartesian3,s=new t.Ray}(window.Cesium),function(t){"use strict";var e=t.defaultValue;t.defined;function i(i){i=e(i,e.EMPTY_OBJECT),this.proxy=i.proxy,this.viewer=i.viewer,this.url=i.url,this.metadata=i.metadata,this.roadMetadata=i.roadMetadata,this.roadUrl=i.roadUrl,this.labelGraphics=i.labelGraphics?i.labelGraphics:{},this.billboardGraphics=i.billboardGraphics?i.billboardGraphics:{},this.aotuCollide=!!i.aotuCollide,this.collisionPadding=i.collisionPadding?i.collisionPadding:[3,5,3,5],this.serverFirstStyle=!!i.serverFirstStyle,this.subdomains=i.subdomains,t.isArray(this.subdomains)?this.subdomains=this.subdomains.slice():t.defined(this.subdomains)&&this.subdomains.length>0?this.subdomains=this.subdomains.split(""):this.subdomains=["a","b","c"],this.tileCache=[],this.labelCache=[],this._isInitial=!0,this._latelyGrid=[],this._latelyRefreshStamp=0,this._latelyCollisionStamp=0;var r=t.createGuid();this._UUID="GEO_WTFS_LABEL_"+r,this._UUIDRoad="GEO_WTFS_LABEL_ROAD_"+r,this.viewer.camera.percentageChanged=.1,this.bindEvent()}function r(t,e){return e.minX>=t.minX&&e.minX<=t.maxX&&e.minY>=t.minY&&e.minY<=t.maxY||(e.maxX>=t.minX&&e.maxX<=t.maxX&&e.maxY>=t.minY&&e.maxY<=t.maxY||(e.minX>=t.minX&&e.minX<=t.maxX&&e.maxY>=t.minY&&e.maxY<=t.maxY||e.maxX>=t.minX&&e.maxX<=t.maxX&&e.minY>=t.minY&&e.minY<=t.maxY))}function o(t,e){var i=t.x,r=t.y,o=t.width,n=t.height,a=e.x,s=e.y,l=e.width,g=e.height;return!(i>=a&&i>=a+l)&&(!(i<=a&&i+o<=a)&&(!(r>=s&&r>=s+g)&&!(r<=s&&r+n<=s)))}t.defineProperties(i.prototype,{}),i.prototype.getCacheTile=function(t,e,i,r){for(var o=0;o<this.tileCache.length;o++)if(this.tileCache[o].x===t&&this.tileCache[o].y===e&&this.tileCache[o].z===i&&this.tileCache[o].t===r)return this.tileCache[o];return null},i.prototype.addCacheTile=function(t){this.tileCache.length>999&&this.tileCache.splice(0,500),this.removeCacheTile(t.x,t.y,t.z,t.t),this.tileCache.push(t)},i.prototype.removeCacheTile=function(t,e,i,r){for(var o=0;o<this.tileCache.length;o++)if(this.tileCache[o].x===t&&this.tileCache[o].y===e&&this.tileCache[o].z===i&&this.tileCache[o].t===r){this.tileCache.splice(o,1);break}},i.prototype.getCacheLabel=function(t){for(var e=0;e<this.labelCache.length;e++)if(this.labelCache[e].name===this._UUID&&this.labelCache[e].oid===t)return this.labelCache[e];return null},i.prototype.addCacheLabel=function(t){this.labelCache.length>999&&this.labelCache.splice(0,250),this.removeCacheLabel(t.oid),t.timestamp=(new Date).getTime(),this.labelCache.push(t)},i.prototype.removeCacheLabel=function(t){for(var e=0;e<this.labelCache.length;e++)if(this.labelCache[e].name===this._UUID&&this.labelCache[e].oid===t){this.labelCache.splice(e,1);break}},i.prototype.getTileUrl=function(){return(this.proxy?this.proxy.proxy:"")+this.url+"/GetTiles?lxys={z},{x},{y}"},i.prototype.getIcoUrl=function(){return(this.proxy?this.proxy.proxy:"")+this.url+"/GetIcon?id={id}"},i.prototype.getRoadTileUrl=function(){return(this.proxy?this.proxy.proxy:"")+this.roadUrl},i.prototype._moveEnd=function(){var t=this;clearTimeout(this._timer);var e=this.viewer.scene.globe._surface;if(0==e._tilesToRender.length||e._tileLoadQueueHigh.length>3)this._timer=setTimeout(function(){t._moveEnd()},100);else{var i=this.getTilesToRender();if(this.compareArray(i,this._latelyGrid))return;this._queueCall(i),t.delaySynchronous()}},i.prototype._changed=function(){var t=(new Date).getTime(),e=t-this._latelyRefreshStamp,i=t-this._latelyCollisionStamp;e>300&&this._moveEnd(),i>100&&this.collisionDetection()},i.prototype._queueCall=function(t){var e=this;e._latelyGrid=t,e._latelyRefreshStamp=(new Date).getTime(),t.forEach(function(t,i,o){if(e.metadata&&r(e.metadata.boundBox,t.boundBox)){if(e.metadata.minLevel>t.level+1||e.metadata.maxLevel<t.level+1)return;var n=e.getCacheTile(t.x,t.y,t.level+1,0);if(n)e.addLabelAndIco(n);else{var s=e.getTileUrl().replace("{z}",t.level+1).replace("{y}",t.y).replace("{x}",t.x).replace("{s}",e.subdomains[(t.x+t.y+t.level)%e.subdomains.length]),l=new XMLHttpRequest;l.open("GET",s,!0),l.responseType="arraybuffer",l.onload=function(){if(!(l.status<200||l.status>=300)){var t=e.CutString(l.response);if(t){(i=a(t)).x=this.tile.x,i.y=this.tile.y,i.z=this.tile.z,i.t=0,e.addCacheTile(i),e.addLabelAndIco(i)}else{var i={x:this.tile.x,y:this.tile.y,z:this.tile.z,t:0};e.addCacheTile(i),e.delaySynchronous()}}},l.onerror=function(t){console.error(t)},l.send(),l.tile={x:t.x,y:t.y,z:t.level+1}}}if(e.roadMetadata&&r(e.roadMetadata.boundBox,t.boundBox)){if(e.roadMetadata.minLevel>t.level+1||e.roadMetadata.maxLevel<t.level+1)return;if(n=e.getCacheTile(t.x,t.y,t.level+1,1))e.addLabelAndIco(n);else{var g=e.getRoadTileUrl().replace("{z}",t.level+1).replace("{y}",t.y).replace("{x}",t.x),h=new XMLHttpRequest;h.open("GET",g,!0),h.responseType="json",h.onload=function(){if(!(h.status<200||h.status>=300)){var t=h.response;if(t){var i={pois:t.map(function(t,e,i){return{oid:t.LabelPoint.X+"_"+t.LabelPoint.Y,name:t.Feature.properties.Name,coordinate:[t.LabelPoint.X,t.LabelPoint.Y,t.LabelPoint.Z?t.LabelPoint.Z:0]}}),x:this.tile.x,y:this.tile.y,z:this.tile.z,t:1};e.addCacheTile(i),e.addLabelAndIco(i)}else{i={x:this.tile.x,y:this.tile.y,z:this.tile.z,t:1};e.addCacheTile(i),e.delaySynchronous()}}},h.onerror=function(t){console.error(t)},h.send(),h.tile={x:t.x,y:t.y,z:t.level+1}}}})},i.prototype.initTDT=function(t){var e=0,i=this;i._queueCall(t);var r=setInterval(function(){e>3&&(i._isInitial=!1,clearInterval(r)),e%2==0&&i.aotuCollide&&i.collisionDetection(),e++},600);return i},i.prototype.getTilesToRender=function(){for(var e=this.viewer.scene.globe._surface._tilesToRender.map(function(e,i,r){return{x:e.x,y:e.y,level:e.level,boundBox:{minX:t.Math.toDegrees(e.rectangle.west),minY:t.Math.toDegrees(e.rectangle.south),maxX:t.Math.toDegrees(e.rectangle.east),maxY:t.Math.toDegrees(e.rectangle.north)}}}).sort(function(t,e){return e.level-t.level}),i=[e[0].level],r=0;r<e.length;r++)e[r].level!=i[i.length-1]&&i.push(e[r].level),i.length>4&&(e.splice(r),r--);return e},i.prototype.addLabelAndIco=function(t){if(t.pois)for(var e=0;e<t.pois.length;e++){var i=this.getCacheLabel(t.pois[e].oid);i||(i=this.createLabel(t.pois[e],t)),this.addCacheLabel(i)}this.delaySynchronous()},i.prototype.delaySynchronous=function(){var t=this;clearTimeout(t._timer2),t._timer2=setTimeout(function(){t.synchronousLabel()},100)},i.prototype.synchronousLabel=function(){for(var t=0;t<this.labelCache.length;t++)this.labelCache[t].timestamp>=this._latelyRefreshStamp&&!this.viewer.entities.contains(this.labelCache[t])&&(this._isInitial&&this.aotuCollide&&(this.labelCache[t].show=!1),this.viewer.entities.add(this.labelCache[t]));if(!this._isInitial){for(t=0;t<this.viewer.entities.values.length;t++)!this.viewer.entities.values[t].name||this.viewer.entities.values[t].name!==this._UUID&&this.viewer.entities.values[t].name!==this._UUIDRoad||this.viewer.entities.values[t].timestamp<this._latelyRefreshStamp&&(this.viewer.entities.remove(this.viewer.entities.values[t]),t--);this.aotuCollide&&this.collisionDetection()}},i.prototype.createLabel=function(e,i){if(e){var r={show:!0,position:t.Cartesian3.fromDegrees(e.coordinate[0],e.coordinate[1],e.coordinate[2]),label:{text:e.name}};this.serverFirstStyle&&void 0!==e.fontSize?(r.label.font=e.fontSize+"px ",void 0!==e.fontNameIndex&&i.stringTable&&i.stringTable[e.fontNameIndex]?r.label.font+=i.stringTable[e.fontNameIndex]:r.label.font+="sans-serif",this.labelGraphics.bold&&(r.label.font="bold "+r.label.font)):this.labelGraphics.font&&(r.label.font=this.labelGraphics.font),this.serverFirstStyle&&void 0!==e.fontColor?r.label.fillColor=t.Color.fromCssColorString(this.HexadecimalConversion(e.fontColor)):this.labelGraphics.fillColor&&(r.label.fillColor=this.labelGraphics.fillColor),this.serverFirstStyle&&void 0!==e.shiningColor?r.label.outlineColor=t.Color.fromCssColorString(this.HexadecimalConversion(e.shiningColor)):this.labelGraphics.outlineColor&&(r.label.outlineColor=this.labelGraphics.outlineColor),this.serverFirstStyle&&void 0!==e.outlineWidth?r.label.outlineWidth=e.outlineWidth:void 0!==this.labelGraphics.outlineWidth&&(r.label.outlineWidth=this.labelGraphics.outlineWidth),this.serverFirstStyle&&void 0!==e.showBackground?r.label.showBackground=e.showBackground:void 0!==this.labelGraphics.showBackground&&(r.label.showBackground=this.labelGraphics.showBackground),this.serverFirstStyle&&void 0!==e.backgroundColor?r.label.backgroundColor=e.backgroundColor:void 0!==this.labelGraphics.backgroundColor&&(r.label.backgroundColor=this.labelGraphics.backgroundColor),this.serverFirstStyle&&void 0!==e.backgroundPadding?r.label.backgroundPadding=e.backgroundPadding:void 0!==this.labelGraphics.backgroundPadding&&(r.label.backgroundPadding=this.labelGraphics.backgroundPadding),i.t?(r.label.verticalOrigin=t.VerticalOrigin.CENTER,r.label.horizontalOrigin=t.HorizontalOrigin.CENTER):(this.serverFirstStyle&&void 0!==e.verticalOrigin?r.label.verticalOrigin=e.verticalOrigin:void 0!==this.labelGraphics.verticalOrigin&&(r.label.verticalOrigin=this.labelGraphics.verticalOrigin),this.serverFirstStyle&&void 0!==e.horizontalOrigin?r.label.horizontalOrigin=e.horizontalOrigin:void 0!==this.labelGraphics.horizontalOrigin&&(r.label.horizontalOrigin=this.labelGraphics.horizontalOrigin)),this.serverFirstStyle&&void 0!==e.eyeOffset?r.label.eyeOffset=e.eyeOffset:void 0!==this.labelGraphics.eyeOffset&&(r.label.eyeOffset=this.labelGraphics.eyeOffset),this.serverFirstStyle&&void 0!==e.pixelOffset?r.label.pixelOffset=e.pixelOffset:void 0!==this.labelGraphics.pixelOffset&&(r.label.pixelOffset=this.labelGraphics.pixelOffset),this.serverFirstStyle&&void 0!==e.style?r.label.style=e.style:void 0!==this.labelGraphics.style&&(r.label.style=this.labelGraphics.style),this.serverFirstStyle&&void 0!==e.scale?r.label.scale=e.scale:void 0!==this.labelGraphics.scale&&(r.label.scale=this.labelGraphics.scale),r.label.disableDepthTestDistance=this.labelGraphics.disableDepthTestDistance,void 0!==e.symbolID&&e.symbolID>-1&&(r.billboard={image:this.getIcoUrl().replace("{id}",e.symbolID).replace("{s}",this.subdomains[(i.x+i.y+i.z)%this.subdomains.length])},this.serverFirstStyle&&void 0!==e.displayHeight?(r.billboard.width=e.displayHeight,r.billboard.height=e.displayHeight):void 0===this.billboardGraphics.width&&void 0===this.billboardGraphics.height||(r.billboard.width=this.billboardGraphics.width,r.billboard.height=this.billboardGraphics.height),i.t?(r.label.verticalOrigin=t.VerticalOrigin.BOTTOM,r.label.horizontalOrigin=t.HorizontalOrigin.CENTER):(this.serverFirstStyle&&void 0!==e.verticalOrigin?r.billboard.verticalOrigin=e.verticalOrigin:void 0!==this.billboardGraphics.verticalOrigin&&(r.billboard.verticalOrigin=this.billboardGraphics.verticalOrigin),this.serverFirstStyle&&void 0!==e.horizontalOrigin?r.billboard.horizontalOrigin=e.horizontalOrigin:void 0!==this.billboardGraphics.horizontalOrigin&&(r.billboard.horizontalOrigin=this.billboardGraphics.horizontalOrigin)),this.serverFirstStyle&&void 0!==e.eyeOffset?r.billboard.eyeOffset=e.eyeOffset:void 0!==this.billboardGraphics.eyeOffset&&(r.billboard.eyeOffset=this.billboardGraphics.eyeOffset),this.serverFirstStyle&&void 0!==e.pixelOffset?r.billboard.pixelOffset=e.pixelOffset:void 0!==this.billboardGraphics.pixelOffset&&(r.billboard.pixelOffset=this.billboardGraphics.pixelOffset),this.serverFirstStyle&&void 0!==e.rotation?r.billboard.rotation=e.rotation:void 0!==this.billboardGraphics.rotation&&(r.billboard.rotation=this.billboardGraphics.rotation),this.serverFirstStyle&&void 0!==e.alignedAxis?r.billboard.alignedAxis=e.alignedAxis:void 0!==this.billboardGraphics.alignedAxis&&(r.billboard.alignedAxis=this.billboardGraphics.alignedAxis),this.serverFirstStyle&&void 0!==e.color?r.billboard.color=e.color:void 0!==this.billboardGraphics.color&&(r.billboard.color=this.billboardGraphics.color),this.serverFirstStyle&&void 0!==e.scale?r.billboard.scale=e.scale:void 0!==this.billboardGraphics.scale&&(r.billboard.scale=this.billboardGraphics.scale),r.billboard.disableDepthTestDistance=this.billboardGraphics.disableDepthTestDistance);var o=new t.Entity(r);return o.name=i.t?this._UUIDRoad:this._UUID,o.oid=e.oid,o.xyz=i.x+"_"+i.y+"_"+(i.z-1),o}},i.prototype.getPropertyValue=function(t,e,i,r){return void 0!==e[t]?e[t]:void 0!==i[t]?i[t]:r},i.prototype.collisionDetection=function(){if(this.debug)for(var e=document.getElementsByClassName("debug"),i=0;i<e.length;i++)this.viewer.container.removeChild(e[i]),i--;var r=[];for(i=0;i<this.viewer.entities.values.length;i++)if(this.viewer.entities.values[i].name&&(this.viewer.entities.values[i].name===this._UUID||this.viewer.entities.values[i].name===this._UUIDRoad)){var n=t.SceneTransforms.wgs84ToWindowCoordinates(this.viewer.scene,this.viewer.entities.values[i].position.getValue(0));this.viewer.entities.values[i].show=!!n;var a=this.getLabelReact({point:n,entity:this.viewer.entities.values[i]});this.viewer.entities.values[i].collisionBox=a;for(var s=null,l=0;l<r.length;l++)if(r[l].xyz===this.viewer.entities.values[i].xyz){s=r[l];break}if(s||(s={xyz:this.viewer.entities.values[i].xyz,entities:[]},r.push(s)),s.entities.push(this.viewer.entities.values[i]),this.debug){var g=document.createElement("div");g.setAttribute("class","debug"),g.style.cssText="position:absolute; top:"+a.y+"px; left:"+a.x+"px; width:"+a.width+"px; height:"+a.height+"px; border: solid 1px red; color: rgba(0,0,0,0);",g.innerHTML=this.viewer.entities.values[i].label.text.getValue(0),this.viewer.container.appendChild(g)}}for(var h=0;h<r.length;h++)for(i=0;i<r[h].entities.length;i++)if(r[h].entities[i].show)for(l=i+1;l<r[h].entities.length;l++)r[h].entities[l].show&&o(r[h].entities[i].collisionBox,r[h].entities[l].collisionBox)&&(r[h].entities[l].show=!1);var c=[];for(h=0;h<r.length;h++)for(i=0;i<r[h].entities.length;i++)r[h].entities[i].show&&c.push(r[h].entities[i]);for(i=0;i<c.length;i++)if(c[i].show)for(l=i+1;l<c.length;l++)c[l].show&&o(c[i].collisionBox,c[l].collisionBox)&&(c[l].show=!1)},i.prototype.bindEvent=function(){this.viewer.scene.camera.moveEnd.addEventListener(this._moveEnd,this),this.viewer.scene.camera.changed.addEventListener(this._changed,this)},i.prototype.unbindEvent=function(){this.viewer.scene.camera.moveEnd.removeEventListener(this._moveEnd,this),this.viewer.scene.camera.changed.removeEventListener(this._changed,this)},i.prototype.activate=function(){this._latelyGrid=[],this._moveEnd()},i.prototype.destroy=function(){for(var t=0;t<this.viewer.entities.values.length;t++)!this.viewer.entities.values[t].name||this.viewer.entities.values[t].name!==this._UUID&&this.viewer.entities.values[t].name!==this._UUIDRoad||(this.viewer.entities.remove(this.viewer.entities.values[t]),t--);this.viewer.camera.percentageChanged=.5,this.unbindEvent(),this.handler=this.handler&&this.handler.destroy(),this.proxy=void 0,this.viewer=void 0,this.url=void 0,this.labelGraphics=void 0,this.billboardGraphics=void 0,this.aotuCollide=void 0,this.collisionPadding=void 0,this.tileCache=void 0,this.labelCache=void 0,this._latelyGrid=void 0,this._latelyRefreshStamp=void 0,this._roadTileset=void 0},i.prototype.compareArray=function(t,e){for(var i=!1,r=0;r<t.length;r++){for(var o=!1,n=0;n<e.length;n++)if(t[r].x===e[n].x&&t[r].y===e[n].y&&t[r].level===e[n].level){o=!0;break}if(!o){i=!0;break}}return!i},i.prototype.getLabelReact=function(t){var e=parseInt(t.entity.label.font);e=e>0?e:15;for(var i=t.entity.label.text.getValue(0).split("\n"),r=0,o=i.length,a=0;a<i.length;a++){var s=n(i[a])/2;s>r&&(r=s)}var l=t.entity.billboard?t.entity.billboard.width.getValue(0)*t.entity.billboard.scale.getValue(0):1,g=t.entity.billboard?t.entity.billboard.height.getValue(0)*t.entity.billboard.scale.getValue(0):1;return{x:(t.point?t.point.x:-999)-l/2-this.collisionPadding[3],y:(t.point?t.point.y:-999)-g/2-this.collisionPadding[0],width:e*t.entity.label.scale.getValue(0)*r+t.entity.label.pixelOffset.getValue(0).x+l+this.collisionPadding[1],height:e*t.entity.label.scale.getValue(0)*(o+.5*(o-1))+t.entity.label.pixelOffset.getValue(0).y+g/2+this.collisionPadding[2]}},i.prototype.CutString=function(t){if(!t)return"";var e=t.byteLength;return e<=28?"":t.slice(19,e-9)},i.prototype.HexadecimalConversion=function(t){if(4278190080===t)return"#000000";var e=4278190080|parseInt(-Number(t));t="";if((e=e.toString(16).substring(1)).length<6)for(var i=6-e.length,r=0;r<i;r++)t+="0";return"#"+t+e};var n=function(t){for(var e=0,i=0;i<t.length;i++){null!=t.charAt(i).match(/[^\x00-\xff]/gi)?e+=2:e+=1}return e},a=function(t){var e={stringTable:[],pois:[],enumGeometryType:[{ePoint:0},{eMultiLineString:1},{ePolygon:2}],enumZCoordType:[{eCloseGround:0},{eCloseSeaSurface:1},{eRelativelyGround:2},{eAbsolute:3}]},i=function(){if("undefined"==typeof dcodeIO||!dcodeIO.ProtoBuf)throw new Error("ProtoBuf.js is not present. Please see www/index.html for manual setup instructions.");return dcodeIO.ProtoBuf.loadProto("option optimize_for = LITE_RUNTIME;package GEOPOI;enum enumGeometryType {ePoint = 0;eMultiLineString = 1;ePolygon = 2;} ;message PBPOI{required uint64 OID = 1;required string Name =2;repeated double Coordinates =3 [packed=true];required enumGeometryType GeometryType = 4;optional int32 Interate = 5;optional int32 SymbolID = 10  [default = 0];optional double DisplayHeight = 11 [default = 32];optional uint32 ShiningColor=12 [default =0];optional uint32\tFontNameIndex=13 [default =0];optional int32\tFontSize=14 [default =18];optional uint32\tFontColor=15 [default =0];};message StringTable {repeated string s = 1;}message PBPOITile{required int64 Version = 1;required int64 TileKey = 2;required StringTable StringTable = 3;repeated PBPOI POIS = 4;};","GEOPOI","GeoPOI.proto").build("GEOPOI").PBPOITile}(),r=function(){if("undefined"==typeof dcodeIO||!dcodeIO.ProtoBuf)throw new Error("ProtoBuf.js is not present. Please see www/index.html for manual setup instructions.");return dcodeIO.ProtoBuf.loadProto("option optimize_for = LITE_RUNTIME;package GEOPOI;enum enumGeometryType {ePoint = 0;eMultiLineString = 1;ePolygon = 2;};enum enumZCoordType {eCloseGround = 0;eCloseSeaSurface = 1;eRelativelyGround = 2;eAbsolute = 3;};message PBPOI{required uint64 OID = 1;required string Name =2;repeated double Coordinates =3 [packed=true];required enumGeometryType GeometryType = 4;optional int32 Interate = 5;optional int32 SymbolID = 10  [default = 0];optional double DisplayHeight = 11 [default = 32];optional uint32 ShiningColor=12 [default =0];optional uint32\tFontNameIndex=13 [default =0];optional int32\tFontSize=14 [default =18];optional uint32\tFontColor=15 [default =0];optional enumZCoordType ZCoordType = 16 [default = eAbsolute];};message StringTable {repeated string s = 1;}message PBPOITile{required int64 Version = 1;required int64 TileKey = 2;required StringTable StringTable = 3;repeated PBPOI POIS = 4;};","GEOPOI","GeoPOI2.proto").build("GEOPOI").PBPOITile}();e.pois.length=0;var o,n=t;try{o=r.decode(n)}catch(t){console.log(t.message),o=i.decode(n)}e.version=parseInt(o.Version.toString()),e.titleKey=parseInt(o.TileKey.toString()),e.stringTable=[];for(var a=o.StringTable.s.length,s=0;s<a;s++)e.stringTable.push(o.StringTable.s[s].toString());return o.POIS.forEach(function(t){var i={};i.oid=parseInt(t.OID.toString()),i.name=t.Name.toString(),i.symbolID=parseInt(t.SymbolID.toString()),i.displayHeight=t.DisplayHeight,i.shiningColor=t.ShiningColor,i.fontNameIndex=t.FontNameIndex,i.fontSize=t.FontSize,i.fontColor=t.FontColor,t.ZCoordType&&(i.zCoordType=t.ZCoordType),i.geometryType=t.GeometryType,i.interate=t.Interate,i.coordinate=t.Coordinates,e.pois.push(i)}),e};t.GeoWTFS=i}(window.Cesium),function(t){"use strict";var e=t.LayerManager=function(e){this.map=e,this.serviceLayerGroup=new t.ServiceLayerGroup(e),this.modelLayerGroup=new t.ModelLayerGroup(e),this.vectorLayerGroup=new t.VectorLayerGroup(e),this.terrainLayerGroup=new t.TerrainLayerGroup(e),this.basicLayerGroup=new t.BasicLayerGroup(e)};e.prototype.getMap=function(){return this.map},e.prototype.getServiceLayerGroup=function(){return this.serviceLayerGroup},e.prototype.getModelLayerGroup=function(){return this.modelLayerGroup},e.prototype.getVectorLayerGroup=function(){return this.vectorLayerGroup},e.prototype.getTerrainLayerGroup=function(){return this.terrainLayerGroup},e.prototype.getBasicLayerGroup=function(){return this.basicLayerGroup},e.prototype.remove=function(e){t.defined(e)?e.removeAll():(this.serviceLayerGroup.removeAll(),this.modelLayerGroup.removeAll(),this.vectorLayerGroup.removeAll(),this.terrainLayerGroup.removeAll(),this.basicLayerGroup.removeAll())}}(window.Cesium),function(t){"use strict";var e=t.ServiceLayerGroup=function(){};e.prototype=new t.CompositeEntityCollection,e.prototype.addLayer=function(i,r){var o="";return e.add(r)&&(r.name=i,o=t.createGuid(),r.id=o),o},e.prototype.removeLayer=function(t){var i=e.getLayer(t);return e.remove(i)},e.prototype.queryLayerByName=function(t){for(var i=null,r=0;r<e.length;r++){var o=e.get(r);if(t==o.name){i=o;break}}return i},e.prototype.getLayer=function(t){for(var i=null,r=0;r<e.length;r++){var o=e.get(r);if(t==o.id){i=o;break}}return i},e.prototype.showLayer=function(t){e.getLayer(t).show=!0},e.prototype.hideLayer=function(t){e.getLayer(t).show=!1},e.prototype.addChildLayerGroup=function(t){}}(window.Cesium),function(t){"use strict";var e=t.ModelLayerGroup=function(t){this.map=t};e.prototype=new t.PrimitiveCollection,e.prototype.addLayer=function(t,e){var i=this.map.scene.primitives.add(e),r="";return i&&(e.name=t,void 0!=$("#model-branch-container .layer-item-title").last()[0]&&(r=$("#model-branch-container .layer-item-title").last()[0].id),e.id=r),i},e.prototype.removeLayer=function(t){for(var e=0;e<this.map.scene.primitives.length;e++){var i=this.map.scene.primitives.get(e);if(t==i.id)break}return this.map.scene.primitives.remove(i)},e.prototype.queryLayerByName=function(t){for(var i=null,r=0;r<e.length;r++){var o=e.get(r);if(t==o.name){i=o;break}}return i},e.prototype.getLayer=function(t){var e=null;if(t)for(var i=1;i<this.map.scene.primitives.length;i++){var r=this.map.scene.primitives.get(i);if(t==r.id){e=r;break}}else e=this.map.scene.primitives._primitives;return e},e.prototype.showLayer=function(t){for(var e=null,i=0;i<this.map.scene.primitives.length;i++){var r=this.map.scene.primitives.get(i);if(t==r.id){e=r;break}}e&&(e.show=!0)},e.prototype.hideLayer=function(t){for(var e=null,i=0;i<this.map.scene.primitives.length;i++){var r=this.map.scene.primitives.get(i);if(t==r.id){e=r;break}}e&&(e.show=!1)}}(window.Cesium),function(t){"use strict";var e=t.VectorLayerGroup=function(t){this.map=t};e.prototype=new t.DataSourceCollection,e.prototype.addLayer=function(e,i){return i&&(i.id||(i.id=t.createGuid())),this.map.dataSources.add(i),this.map.dataSources.get(this.map.dataSources.length-1).name=e,i.id},e.prototype.removeLayer=function(t){for(var e=null,i=0;i<this.map.dataSources.length;i++)if(t==this.map.dataSources.get(i).id){e=this.map.dataSources.get(i);break}try{this.map.dataSources.remove(e)}catch(t){return void console.log("DeveloperError")}},e.prototype.queryLayerByName=function(t){for(var e=null,i=0;i<this.map.dataSources.length;i++){var r=this.map.dataSources.get(i);if(t==r._name){e=r;break}}return e},e.prototype.getLayer=function(t){for(var e=null,i=0;i<this.map.dataSources.length;i++){var r=this.map.dataSources.get(i);if(t==r.id){e=r;break}}return e},e.prototype.showLayer=function(t){for(var e=null,i=0;i<this.map.dataSources.length;i++){var r=this.map.dataSources.get(i);if(t==r.id){e=r;break}}e&&(e.show=!0)},e.prototype.hideLayer=function(t){for(var e=null,i=0;i<this.map.dataSources.length;i++){var r=this.map.dataSources.get(i);if(t==r.id){e=r;break}}e&&(e.show=!1)}}(window.Cesium),function(t){"use strict";var e=t.TerrainLayerCollection=function(t){this._layers=[],this.length=this._layers.length,this.map=t};e.prototype.addTerrainProvider=function(e){if(!defined(e))throw new t.DeveloperError("terrainProvider is required.");return this.map.terrainProvider=e,this._layers=[],this._layers.push(e),this.map.terrainProvider},e.prototype.remove=function(){var e=new t.CesiumTerrainProvider({url:""});return this.map.terrainProvider=e,this._layers=[],0==this.map.terrainProvider._url_size},e.prototype.get=function(e){if(!defined(terrainProvider))throw new t.DeveloperError("id is required.");if(e==this._layers[0].id)return this._layers[0]}}(window.Cesium),function(t){"use strict";var e=t.TerrainLayerGroup=function(t){this.map=t};e.prototype.addLayer=function(e,i){if(i._credit)i.id=i._credit._text;else{var r=t.createGuid();i.id=r}return i.name=e,this.map.terrainProvider=i,i.id},e.prototype.removeLayer=function(e){if(e==this.map.terrainProvider.id){var i=new t.GeoTerrainProvider({proxy:new t.DefaultProxy("/proxyHandler?url="),dataType:t.GeoTerrainProvider.FLOAT,urls:[""]});this.map.terrainProvider=i}return!this.map.terrainProvider.id},e.prototype.getLayer=function(e){var i=null;if(t.defined(e))e==this.map.terrainProvider.id&&(i=this.map.terrainProvider);else i=this.map.terrainProvider;return i},e.prototype.showLayer=function(e){if(e==this.map.terrainProvider.options.credit){var i=new t.GeoTerrainProvider({proxy:new t.DefaultProxy("/proxyHandler?url="),dataType:t.GeoTerrainProvider.FLOAT,urls:this.map.terrainProvider.options._urls,credit:this.map.terrainProvider.options.credit,name:this.map.terrainProvider.options.name,maxExtent:this.map.terrainProvider.options.maxExtent,opacity:this.map.terrainProvider.options.opacity,topLevel:this.map.terrainProvider.options.topLevel,bottomLevel:this.map.terrainProvider.options.bottomLevel});i.id=e,i.name=this.map.terrainProvider.options.name,this.map.terrainProvider=i}},e.prototype.hideLayer=function(e){var i=null;if(e==this.map.terrainProvider.id){var r={_urls:(i=this.map.terrainProvider)._urls,credit:i._credit.text,name:i.name,maxExtent:i._maxExtent,opacity:i._opacity,topLevel:i._topLevel,bottomLevel:i._bottomLevel},o=new t.GeoTerrainProvider({proxy:new t.DefaultProxy("/proxyHandler?url="),dataType:t.GeoTerrainProvider.FLOAT,urls:[""]});this.map.terrainProvider=o,this.map.terrainProvider.options=r}}}(window.Cesium),function(t){"use strict";var e=t.BasicLayerGroup=function(t){this.map=t};e.prototype=new t.ImageryLayerCollection,e.prototype.addLayer=function(t,e){var i=this.map.imageryLayers.addImageryProvider(e),r="";if(i){i.name=t;for(var o=0;o<$("#imagery-branch-container .layer-item-content div").length;o++){if(t==$("#imagery-branch-container .layer-item-content span")[o].innerText){r=$($("#imagery-branch-container .layer-item-content div")[o]).attr("id");break}}i.id=r}return r},e.prototype.removeLayer=function(t){for(var e=null,i=0;i<this.map.imageryLayers.length;i++)if(t==this.map.imageryLayers._layers[i].id){e=this.map.imageryLayers._layers[i];break}try{this.map.imageryLayers.remove(e)}catch(t){return void console.log("DeveloperError")}},e.prototype.queryLayerByName=function(e){if(!t.defined(e))return!1;for(var i=null,r=0;r<this.map.imageryLayers.length;r++)if(e==this.map.imageryLayers._layers[r].name){i=this.map.imageryLayers._layers[r];break}return i},e.prototype.getLayer=function(t){var e=null;if(t){for(var i=0;i<this.map.imageryLayers.length;i++)if(t==this.map.imageryLayers._layers[i].id){e=this.map.imageryLayers._layers[i];break}}else e=this.map.imageryLayers._layers;return e},e.prototype.showLayer=function(t){for(var e=null,i=0;i<this.map.imageryLayers.length;i++)if(t==this.map.imageryLayers._layers[i].id){e=this.map.imageryLayers._layers[i];break}e.show=!0},e.prototype.hideLayer=function(t){for(var e=null,i=0;i<this.map.imageryLayers.length;i++)if(t==this.map.imageryLayers._layers[i].id){e=this.map.imageryLayers._layers[i];break}e.show=!1},e.prototype.moveLayer=function(t,e){for(var i=null,r=null,o=0;o<this.map.imageryLayers.length;o++)if(t==this.map.imageryLayers._layers[o].id){i=this.map.imageryLayers._layers[o];break}for(o=0;o<this.map.imageryLayers.length;o++)if(e==this.map.imageryLayers._layers[o].id){r=this.map.imageryLayers._layers[o];break}var n=this.map.imageryLayers.indexOf(i)-this.map.imageryLayers.indexOf(r);if(n>0)for(o=0;o<n;o++)try{this.map.imageryLayers.raise(i)}catch(t){return void console.log(t)}else console.log("layer located top")},e.prototype.raiseLayer=function(t){for(var e=null,i=0;i<this.map.imageryLayers.length;i++)if(t==this.map.imageryLayers._layers[i].id){e=this.map.imageryLayers._layers[i];break}try{this.map.imageryLayers.raise(e)}catch(t){return void console.log("DeveloperError")}},e.prototype.lowerLayer=function(t){for(var e=null,i=0;i<this.map.imageryLayers.length;i++)if(t==this.map.imageryLayers._layers[i].id){e=this.map.imageryLayers._layers[i];break}try{this.map.imageryLayers.lower(e)}catch(t){return void console.log("DeveloperError")}}}(window.Cesium),function(t){"use strict";var e=t.Measure=function(t){this.viewer=t.viewer,this.primitives=this.viewer.scene.primitives};e.prototype.distance=function(e,i){if(e.polyline){var r=e.polyline.positions.getValue();if(!(r.length<=1)){for(var o,n=0,a=0,s=new t.EllipsoidGeodesic,l=1;l<r.length;l++){var g=t.Cartographic.fromCartesian(r[l-1]),h=t.Cartographic.fromCartesian(r[l]);s.setEndPoints(g,h),n+=Math.round(s.surfaceDistance);var c=t.Cartographic.fromCartesian(r[l-1]),C=t.Math.toDegrees(c.longitude),d=t.Math.toDegrees(c.latitude),u=t.Cartographic.fromCartesian(r[l]),p=t.Math.toDegrees(u.longitude),A=t.Math.toDegrees(u.latitude),I=turf.point([C,d]),m=turf.point([p,A]);a+=turf.distance(I,m)}return 2==i?o=n<1e3?n.toFixed(2)+"m":(n/1e3).toFixed(2)+"km":1==i&&(o=a<1?(1e3*a).toFixed(2)+"m":a.toFixed(2)+"km"),o}}},e.prototype.area=function(e){if(e.polygon){var i=e.polygon.hierarchy.getValue().positions;if(!(i.length<=2)){for(var r=[],o=0;o<i.length;o++){var n=t.Cartographic.fromCartesian(i[o]),a=t.Math.toDegrees(n.longitude),s=t.Math.toDegrees(n.latitude);r.push([a,s])}r.push(r[0]);var l=turf.polygon([r]),g=turf.area(l);return g<1e6?g.toFixed(2)+"m²":(g/1e6).toFixed(2)+"km²"}}},e.prototype.height=function(e){if(e.polyline){var i=e.polyline.positions.getValue();if(2==(i=[i[0],i[1]]).length){for(var r=[],o=0;o<i.length;o++){var n=t.Cartographic.fromCartesian(i[o]),a=t.Math.toDegrees(n.longitude),s=t.Math.toDegrees(n.latitude),l=n.height;r.push(a),r.push(s),r.push(l)}r[2]>=r[5]?(r.push(r[0]),r.push(r[1]),r.push(r[5])):(r.push(r[3]),r.push(r[4]),r.push(r[2]));var g={horizontalDistance:null,verticalHeight:null,spaceDistance:null},h=1e3*turf.distance(turf.point([r[0],r[1]]),turf.point([r[3],r[4]]));(C=[]).push((r[0]+r[3])/2),C.push((r[1]+r[4])/2),r[2]>=r[5]?C.push(r[5]):C.push(r[2]),g.horizontalDistance=h<1e3?"水平距离："+h.toFixed(2)+"m":"水平距离："+(h/1e3).toFixed(2)+"km";var c=Math.abs(r[2]-r[5]),C=[];r[2]>=r[5]?(C.push(r[0]),C.push(r[1])):(C.push(r[3]),C.push(r[4])),C.push((r[2]+r[5])/2),g.verticalHeight=c<1e3?"垂直高度："+c.toFixed(2)+"m":"垂直高度："+(c/1e3).toFixed(2)+"km";var d=Math.sqrt(Math.pow(h,2)+Math.pow(c,2));return(C=[]).push((r[0]+r[3])/2),C.push((r[1]+r[4])/2),C.push((r[2]+r[5])/2),g.spaceDistance=d<1e3?"空间距离："+d.toFixed(2)+"m":"空间距离："+(d/1e3).toFixed(2)+"km",g}}},e.prototype.elevation=function(e){if(e.point){var i=[e.position._value];if(1==i.length){t.Cartographic.fromCartesian(i[0]).height.toFixed(2);createResultLabel2(this.options,this.primitives,i)}}}}(window.Cesium),function(t){"use strict";var e=t.MVTProvider=function(e){e=t.defaultValue(e,t.defaultValue.EMPTY_OBJECT),this._tilingScheme=t.defined(e.tilingScheme)?e.tilingScheme:new t.WebMercatorTilingScheme({ellipsoid:e.ellipsoid}),this._tileWidth=t.defaultValue(e.tileWidth,512),this._tileHeight=t.defaultValue(e.tileHeight,512),this._readyPromise=t.when.resolve(!0),this._ol=t.defaultValue(e.ol,ol),this._mvtParser=new this._ol.format.MVT,this._proxy=e.proxy,this._layer=e.layer,this._styleName=e.styleName,this._tileMatrixSetID=e.tileMatrixSetID,this._tileMatrixLabels=e.tileMatrixLabels,this._format="protobuf",this._minimumLevel=t.defaultValue(e.minimumLevel,0),this._maximumLevel=e.maximumLevel,this._key=t.defaultValue(e.key,""),this._url=t.defaultValue(e.url,"https://a.tiles.mapbox.com/v4/mapbox.mapbox-streets-v6/{z}/{x}/{y}.vector.pbf?access_token={k}");var i=this._tilingScheme._rectangleSouthwestInMeters,r=(this._tilingScheme._rectangleNortheastInMeters,null);if(!i)this._tilingScheme.rectangle;this._tilingScheme instanceof t.WebMercatorTilingScheme?r=[-20037508.342789244,-20037508.342789244,20037508.342789244,20037508.342789244]:this._tilingScheme instanceof t.GeographicTilingScheme&&(r=[-180,-270,180,90]),this._resolutions=ol.tilegrid.resolutionsFromExtent(r,22,this._tileWidth),this._pixelRatio=1,this._transform=[.125,0,0,.125,0,0],this._replays=["Default","Image","Polygon","LineString","Text"],this._tileQueue=new t.TileReplacementQueue,this._cacheSize=1e3,this.styleFunc=function(){return[]};var o=this,n=this.getStyleUrl();n=this._proxy.getURL(n);(Number(t.VERSION)<1.42?t.loadJson(n):t.Resource.fetchJson(n)).then(function(t){for(var i="mysourceid",r=0;r<t.layers.length;r++)t.layers[r].source=i;t.sources=t.sources||{},t.sources[i]={type:"vector",url:e.url},t.sprite&&(t.sprite=Cfg.proxyHostUrl+t.sprite),t.glyphs&&(t.glyphs=Cfg.proxyHostUrl+t.glyphs),olms.applyStyle(null,t,i,null,o._resolutions).then(function(t){o.styleFunc=t})})};t.defineProperties(e.prototype,{url:{get:function(){return this._url}},proxy:{get:function(){return this._proxy}},tileWidth:{get:function(){return this._tileWidth}},tileHeight:{get:function(){return this._tileHeight}},maximumLevel:{get:function(){return this._maximumLevel}},minimumLevel:{get:function(){return this._minimumLevel}},tilingScheme:{get:function(){return this._tilingScheme}},rectangle:{get:function(){return this._tilingScheme.rectangle}},tileDiscardPolicy:{get:function(){}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return!0}},readyPromise:{get:function(){return this._readyPromise}},credit:{get:function(){}},hasAlphaChannel:{get:function(){return!0}}}),e.prototype.getTileCredits=function(t,e,i){},e.prototype.requestImage=function(e,i,r,o){var n=this._tileMatrixLabels,a=t.defined(n)?n[r]:r.toString(),s=function(t,e,i,r){for(var o=r.head;void 0!=o&&(o.xMvt!=t||o.yMvt!=e||o.zMvt!=i);)o=o.replacementNext;return o}(e,i,a,this._tileQueue);if(void 0!=s)return s;var l=this,g=this.getUrlTmpl();g=g.replace("{x}",e).replace("{y}",i).replace("{z}",a).replace("{k}",this._key),g=this._proxy.getURL(g);var h=t.when.defer();return(Number(t.VERSION)<1.42?t.loadArrayBuffer(g):t.Resource.fetchArrayBuffer(g)).then(function(r){var o=document.createElement("canvas");o.width=512,o.height=512;for(var n=o.getContext("2d"),s=l._mvtParser.readFeatures(r),g=l.styleFunc,c=new ol.render.canvas.ReplayGroup(0,[0,0,4096,4096],8,!0,100),C=0;C<s.length;C++)for(var d=s[C],u=g(s[C],l._resolutions[a])||[],p=0;p<u.length;p++)ol.renderer.vector.renderFeature_(c,d,u[p],16);return c.finish(),c.replay(n,l._pixelRatio,l._transform,0,{},l._replays,!0),l._tileQueue.count>l._cacheSize&&function(e,i){for(var r,o,n,a,s=e.tail;e.count>i&&t.defined(s);){var l=s.replacementPrevious;r=e,n=void 0,a=void 0,n=(o=s).replacementPrevious,a=o.replacementNext,o===r._lastBeforeStartOfFrame&&(r._lastBeforeStartOfFrame=a),o===r.head?r.head=a:n.replacementNext=a,o===r.tail?r.tail=n:a.replacementPrevious=n,o.replacementPrevious=void 0,o.replacementNext=void 0,--r.count,s=null,s=l}}(l._tileQueue,l._cacheSize/4),o.xMvt=e,o.yMvt=i,o.zMvt=a,l._tileQueue.markTileRendered(o),c=null,h.resolve(o),o}).otherwise(function(t){console.error(t)}),h.promise},e.prototype.pickFeatures=function(t,e,i,r,o){},e.prototype.getUrlTmpl=function(){var e={LAYER:this._layer,TILEMATRIXSET:this._tileMatrixSetID,FORMAT:this._format,TILEMATRIX:"{z}",TILEROW:"{y}",TILECOL:"{x}"},i=this.getParameterString(t.combine({SERVICE:"WMTS",VERSION:"1.0.0",REQUEST:"GetTile"},e));return this._url+"?"+i},e.prototype.getStyleUrl=function(){var e={STYLENAME:this._styleName},i=this.getParameterString(t.combine({SERVICE:"WMTS",VERSION:"1.0.0",REQUEST:"GetStyle"},e));return this._url+"?"+i},e.prototype.getParameterString=function(t){var e=[];for(var i in t){var r=t[i];if(null!=r&&"function"!=typeof r){var o;if("object"==typeof r&&r.constructor==Array){for(var n,a=[],s=0,l=r.length;s<l;s++)n=r[s],a.push(null===n||void 0===n?"":n);o=a.join(",")}else o=r;e.push(i+"="+o)}}return e.join("&")}}(window.Cesium),function(){"use strict";function t(t){throw t}var e=void 0,i=!0,r=this;function o(t,i){var o,n=t.split("."),a=r;!(n[0]in a)&&a.execScript&&a.execScript("var "+n[0]);for(;n.length&&(o=n.shift());)n.length||i===e?a=a[o]?a[o]:a[o]={}:a[o]=i}var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;function a(e,i){this.index="number"==typeof i?i:0,this.i=0,this.buffer=e instanceof(n?Uint8Array:Array)?e:new(n?Uint8Array:Array)(32768),2*this.buffer.length<=this.index&&t(Error("invalid index")),this.buffer.length<=this.index&&this.f()}a.prototype.f=function(){var t,e=this.buffer,i=e.length,r=new(n?Uint8Array:Array)(i<<1);if(n)r.set(e);else for(t=0;t<i;++t)r[t]=e[t];return this.buffer=r},a.prototype.d=function(t,e,i){var r,o=this.buffer,n=this.index,a=this.i,s=o[n];if(i&&1<e&&(t=8<e?(C[255&t]<<24|C[t>>>8&255]<<16|C[t>>>16&255]<<8|C[t>>>24&255])>>32-e:C[t]>>8-e),8>e+a)s=s<<e|t,a+=e;else for(r=0;r<e;++r)s=s<<1|t>>e-r-1&1,8==++a&&(a=0,o[n++]=C[s],s=0,n===o.length&&(o=this.f()));o[n]=s,this.buffer=o,this.i=a,this.index=n},a.prototype.finish=function(){var t,e=this.buffer,i=this.index;return 0<this.i&&(e[i]<<=8-this.i,e[i]=C[e[i]],i++),n?t=e.subarray(0,i):(e.length=i,t=e),t};var s,l=new(n?Uint8Array:Array)(256);for(s=0;256>s;++s){for(var g=c=s,h=7,c=c>>>1;c;c>>>=1)g<<=1,g|=1&c,--h;l[s]=(g<<h&255)>>>0}var C=l;function d(t){this.buffer=new(n?Uint16Array:Array)(2*t),this.length=0}function u(t){var e,i,r,o,a,s,l,g,h,c,C=t.length,d=0,u=Number.POSITIVE_INFINITY;for(g=0;g<C;++g)t[g]>d&&(d=t[g]),t[g]<u&&(u=t[g]);for(e=1<<d,i=new(n?Uint32Array:Array)(e),r=1,o=0,a=2;r<=d;){for(g=0;g<C;++g)if(t[g]===r){for(s=0,l=o,h=0;h<r;++h)s=s<<1|1&l,l>>=1;for(c=r<<16|g,h=s;h<e;h+=a)i[h]=c;++o}++r,o<<=1,a<<=1}return[i,d,u]}function p(t,e){this.h=I,this.w=0,this.input=n&&t instanceof Array?new Uint8Array(t):t,this.b=0,e&&(e.lazy&&(this.w=e.lazy),"number"==typeof e.compressionType&&(this.h=e.compressionType),e.outputBuffer&&(this.a=n&&e.outputBuffer instanceof Array?new Uint8Array(e.outputBuffer):e.outputBuffer),"number"==typeof e.outputIndex&&(this.b=e.outputIndex)),this.a||(this.a=new(n?Uint8Array:Array)(32768))}d.prototype.getParent=function(t){return 2*((t-2)/4|0)},d.prototype.push=function(t,e){var i,r,o,n=this.buffer;for(i=this.length,n[this.length++]=e,n[this.length++]=t;0<i&&(r=this.getParent(i),n[i]>n[r]);)o=n[i],n[i]=n[r],n[r]=o,o=n[i+1],n[i+1]=n[r+1],n[r+1]=o,i=r;return this.length},d.prototype.pop=function(){var t,e,i,r,o,n=this.buffer;for(e=n[0],t=n[1],this.length-=2,n[0]=n[this.length],n[1]=n[this.length+1],o=0;!((r=2*o+2)>=this.length)&&(r+2<this.length&&n[r+2]>n[r]&&(r+=2),n[r]>n[o]);)i=n[o],n[o]=n[r],n[r]=i,i=n[o+1],n[o+1]=n[r+1],n[r+1]=i,o=r;return{index:t,value:e,length:this.length}};var A,I=2,m={NONE:0,r:1,k:I,O:3},f=[];for(A=0;288>A;A++)switch(i){case 143>=A:f.push([A+48,8]);break;case 255>=A:f.push([A-144+400,9]);break;case 279>=A:f.push([A-256+0,7]);break;case 287>=A:f.push([A-280+192,8]);break;default:t("invalid literal: "+A)}p.prototype.j=function(){var r,o,s,l,g=this.input;switch(this.h){case 0:for(s=0,l=g.length;s<l;){var h,c,C,d=o=n?g.subarray(s,s+65535):g.slice(s,s+65535),u=(s+=o.length)===l,p=e,A=e,m=this.a,v=this.b;if(n){for(m=new Uint8Array(this.a.buffer);m.length<=v+d.length+5;)m=new Uint8Array(m.length<<1);m.set(this.a)}if(h=u?1:0,m[v++]=0|h,C=65536+~(c=d.length)&65535,m[v++]=255&c,m[v++]=c>>>8&255,m[v++]=255&C,m[v++]=C>>>8&255,n)m.set(d,v),v+=d.length,m=m.subarray(0,v);else{for(p=0,A=d.length;p<A;++p)m[v++]=d[p];m.length=v}this.b=v,this.a=m}break;case 1:var y=new a(n?new Uint8Array(this.a.buffer):this.a,this.b);y.d(1,1,i),y.d(1,2,i);var w,E,T,M=_(this,g);for(w=0,E=M.length;w<E;w++)if(T=M[w],a.prototype.d.apply(y,f[T]),256<T)y.d(M[++w],M[++w],i),y.d(M[++w],5),y.d(M[++w],M[++w],i);else if(256===T)break;this.a=y.finish(),this.b=this.a.length;break;case I:var x,S,L,R,D,k,O,F,H,B,N,G,W,U,V,z=new a(n?new Uint8Array(this.a.buffer):this.a,this.b),Z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],q=Array(19);for(x=I,z.d(1,1,i),z.d(x,2,i),S=_(this,g),O=b(k=P(this.M,15)),H=b(F=P(this.L,7)),L=286;257<L&&0===k[L-1];L--);for(R=30;1<R&&0===F[R-1];R--);var j,Y,K,X,Q,J,$=L,tt=R,et=new(n?Uint32Array:Array)($+tt),it=new(n?Uint32Array:Array)(316),rt=new(n?Uint8Array:Array)(19);for(j=Y=0;j<$;j++)et[Y++]=k[j];for(j=0;j<tt;j++)et[Y++]=F[j];if(!n)for(j=0,X=rt.length;j<X;++j)rt[j]=0;for(j=Q=0,X=et.length;j<X;j+=Y){for(Y=1;j+Y<X&&et[j+Y]===et[j];++Y);if(K=Y,0===et[j])if(3>K)for(;0<K--;)it[Q++]=0,rt[0]++;else for(;0<K;)J=138>K?K:138,J>K-3&&J<K&&(J=K-3),10>=J?(it[Q++]=17,it[Q++]=J-3,rt[17]++):(it[Q++]=18,it[Q++]=J-11,rt[18]++),K-=J;else if(it[Q++]=et[j],rt[et[j]]++,K--,3>K)for(;0<K--;)it[Q++]=et[j],rt[et[j]]++;else for(;0<K;)J=6>K?K:6,J>K-3&&J<K&&(J=K-3),it[Q++]=16,it[Q++]=J-3,rt[16]++,K-=J}for(r=n?it.subarray(0,Q):it.slice(0,Q),B=P(rt,7),U=0;19>U;U++)q[U]=B[Z[U]];for(D=19;4<D&&0===q[D-1];D--);for(N=b(B),z.d(L-257,5,i),z.d(R-1,5,i),z.d(D-4,4,i),U=0;U<D;U++)z.d(q[U],3,i);for(U=0,V=r.length;U<V;U++)if(G=r[U],z.d(N[G],B[G],i),16<=G){switch(U++,G){case 16:W=2;break;case 17:W=3;break;case 18:W=7;break;default:t("invalid code: "+G)}z.d(r[U],W,i)}var ot,nt,at,st,lt,gt,ht,ct,Ct=[O,k],dt=[H,F];for(lt=Ct[0],gt=Ct[1],ht=dt[0],ct=dt[1],ot=0,nt=S.length;ot<nt;++ot)if(at=S[ot],z.d(lt[at],gt[at],i),256<at)z.d(S[++ot],S[++ot],i),st=S[++ot],z.d(ht[st],ct[st],i),z.d(S[++ot],S[++ot],i);else if(256===at)break;this.a=z.finish(),this.b=this.a.length;break;default:t("invalid compression type")}return this.a};var v=function(){function e(e){switch(i){case 3===e:return[257,e-3,0];case 4===e:return[258,e-4,0];case 5===e:return[259,e-5,0];case 6===e:return[260,e-6,0];case 7===e:return[261,e-7,0];case 8===e:return[262,e-8,0];case 9===e:return[263,e-9,0];case 10===e:return[264,e-10,0];case 12>=e:return[265,e-11,1];case 14>=e:return[266,e-13,1];case 16>=e:return[267,e-15,1];case 18>=e:return[268,e-17,1];case 22>=e:return[269,e-19,2];case 26>=e:return[270,e-23,2];case 30>=e:return[271,e-27,2];case 34>=e:return[272,e-31,2];case 42>=e:return[273,e-35,3];case 50>=e:return[274,e-43,3];case 58>=e:return[275,e-51,3];case 66>=e:return[276,e-59,3];case 82>=e:return[277,e-67,4];case 98>=e:return[278,e-83,4];case 114>=e:return[279,e-99,4];case 130>=e:return[280,e-115,4];case 162>=e:return[281,e-131,5];case 194>=e:return[282,e-163,5];case 226>=e:return[283,e-195,5];case 257>=e:return[284,e-227,5];case 258===e:return[285,e-258,0];default:t("invalid length: "+e)}}var r,o,n=[];for(r=3;258>=r;r++)o=e(r),n[r]=o[2]<<24|o[1]<<16|o[0];return n}(),y=n?new Uint32Array(v):v;function _(r,o){function a(e,r){var o,n,a,s,l=e.H,g=[],h=0;switch(o=y[e.length],g[h++]=65535&o,g[h++]=o>>16&255,g[h++]=o>>24,i){case 1===l:n=[0,l-1,0];break;case 2===l:n=[1,l-2,0];break;case 3===l:n=[2,l-3,0];break;case 4===l:n=[3,l-4,0];break;case 6>=l:n=[4,l-5,1];break;case 8>=l:n=[5,l-7,1];break;case 12>=l:n=[6,l-9,2];break;case 16>=l:n=[7,l-13,2];break;case 24>=l:n=[8,l-17,3];break;case 32>=l:n=[9,l-25,3];break;case 48>=l:n=[10,l-33,4];break;case 64>=l:n=[11,l-49,4];break;case 96>=l:n=[12,l-65,5];break;case 128>=l:n=[13,l-97,5];break;case 192>=l:n=[14,l-129,6];break;case 256>=l:n=[15,l-193,6];break;case 384>=l:n=[16,l-257,7];break;case 512>=l:n=[17,l-385,7];break;case 768>=l:n=[18,l-513,8];break;case 1024>=l:n=[19,l-769,8];break;case 1536>=l:n=[20,l-1025,9];break;case 2048>=l:n=[21,l-1537,9];break;case 3072>=l:n=[22,l-2049,10];break;case 4096>=l:n=[23,l-3073,10];break;case 6144>=l:n=[24,l-4097,11];break;case 8192>=l:n=[25,l-6145,11];break;case 12288>=l:n=[26,l-8193,12];break;case 16384>=l:n=[27,l-12289,12];break;case 24576>=l:n=[28,l-16385,13];break;case 32768>=l:n=[29,l-24577,13];break;default:t("invalid distance")}for(o=n,g[h++]=o[0],g[h++]=o[1],g[h++]=o[2],a=0,s=g.length;a<s;++a)I[m++]=g[a];v[g[0]]++,_[g[3]]++,f=e.length+r-1,u=null}var s,l,g,h,c,C,d,u,p,A={},I=n?new Uint16Array(2*o.length):[],m=0,f=0,v=new(n?Uint32Array:Array)(286),_=new(n?Uint32Array:Array)(30),P=r.w;if(!n){for(g=0;285>=g;)v[g++]=0;for(g=0;29>=g;)_[g++]=0}for(v[256]=1,s=0,l=o.length;s<l;++s){for(g=c=0,h=3;g<h&&s+g!==l;++g)c=c<<8|o[s+g];if(A[c]===e&&(A[c]=[]),C=A[c],!(0<f--)){for(;0<C.length&&32768<s-C[0];)C.shift();if(s+3>=l){for(u&&a(u,-1),g=0,h=l-s;g<h;++g)p=o[s+g],I[m++]=p,++v[p];break}0<C.length?(d=w(o,s,C),u?u.length<d.length?(p=o[s-1],I[m++]=p,++v[p],a(d,0)):a(u,-1):d.length<P?u=d:a(d,0)):u?a(u,-1):(p=o[s],I[m++]=p,++v[p])}C.push(s)}return I[m++]=256,v[256]++,r.M=v,r.L=_,n?I.subarray(0,m):I}function w(t,e,i){var r,o,n,a,s,l,g=0,h=t.length;a=0,l=i.length;t:for(;a<l;a++){if(r=i[l-a-1],n=3,3<g){for(s=g;3<s;s--)if(t[r+s-1]!==t[e+s-1])continue t;n=g}for(;258>n&&e+n<h&&t[r+n]===t[e+n];)++n;if(n>g&&(o=r,g=n),258===n)break}return new function(t,e){this.length=t,this.H=e}(g,e-o)}function P(t,e){var i,r,o,a,s,l=t.length,g=new d(572),h=new(n?Uint8Array:Array)(l);if(!n)for(a=0;a<l;a++)h[a]=0;for(a=0;a<l;++a)0<t[a]&&g.push(a,t[a]);if(i=Array(g.length/2),r=new(n?Uint32Array:Array)(g.length/2),1===i.length)return h[g.pop().index]=1,h;for(a=0,s=g.length/2;a<s;++a)i[a]=g.pop(),r[a]=i[a].value;for(o=function(t,e,i){function r(t){var i=u[t][p[t]];i===e?(r(t+1),r(t+1)):--C[i],++p[t]}var o,a,s,l,g,h=new(n?Uint16Array:Array)(i),c=new(n?Uint8Array:Array)(i),C=new(n?Uint8Array:Array)(e),d=Array(i),u=Array(i),p=Array(i),A=(1<<i)-e,I=1<<i-1;for(h[i-1]=e,a=0;a<i;++a)A<I?c[a]=0:(c[a]=1,A-=I),A<<=1,h[i-2-a]=(h[i-1-a]/2|0)+e;for(h[0]=c[0],d[0]=Array(h[0]),u[0]=Array(h[0]),a=1;a<i;++a)h[a]>2*h[a-1]+c[a]&&(h[a]=2*h[a-1]+c[a]),d[a]=Array(h[a]),u[a]=Array(h[a]);for(o=0;o<e;++o)C[o]=i;for(s=0;s<h[i-1];++s)d[i-1][s]=t[s],u[i-1][s]=s;for(o=0;o<i;++o)p[o]=0;for(1===c[i-1]&&(--C[0],++p[i-1]),a=i-2;0<=a;--a){for(l=o=0,g=p[a+1],s=0;s<h[a];s++)l=d[a+1][g]+d[a+1][g+1],l>t[o]?(d[a][s]=l,u[a][s]=e,g+=2):(d[a][s]=t[o],u[a][s]=o,++o);p[a]=0,1===c[a]&&r(a)}return C}(r,r.length,e),a=0,s=i.length;a<s;++a)h[i[a].index]=o[a];return h}function b(t){var e,i,r,o,a=new(n?Uint16Array:Array)(t.length),s=[],l=[],g=0;for(e=0,i=t.length;e<i;e++)s[t[e]]=1+(0|s[t[e]]);for(e=1,i=16;e<=i;e++)l[e]=g,g+=0|s[e],g<<=1;for(e=0,i=t.length;e<i;e++)for(g=l[t[e]],l[t[e]]+=1,r=a[e]=0,o=t[e];r<o;r++)a[e]=a[e]<<1|1&g,g>>>=1;return a}function E(e,i){switch(this.l=[],this.m=32768,this.e=this.g=this.c=this.q=0,this.input=n?new Uint8Array(e):e,this.s=!1,this.n=M,this.C=!1,!i&&(i={})||(i.index&&(this.c=i.index),i.bufferSize&&(this.m=i.bufferSize),i.bufferType&&(this.n=i.bufferType),i.resize&&(this.C=i.resize)),this.n){case T:this.b=32768,this.a=new(n?Uint8Array:Array)(32768+this.m+258);break;case M:this.b=0,this.a=new(n?Uint8Array:Array)(this.m),this.f=this.K,this.t=this.I,this.o=this.J;break;default:t(Error("invalid inflate mode"))}}var T=0,M=1,x={F:T,D:M};E.prototype.p=function(){for(;!this.s;){var r=Y(this,3);switch(1&r&&(this.s=i),r>>>=1){case 0:var o=this.input,a=this.c,s=this.a,l=this.b,g=o.length,h=e,c=s.length,C=e;switch(this.e=this.g=0,a+1>=g&&t(Error("invalid uncompressed block header: LEN")),h=o[a++]|o[a++]<<8,a+1>=g&&t(Error("invalid uncompressed block header: NLEN")),h===~(o[a++]|o[a++]<<8)&&t(Error("invalid uncompressed block header: length verify")),a+h>o.length&&t(Error("input buffer is broken")),this.n){case T:for(;l+h>s.length;){if(h-=C=c-l,n)s.set(o.subarray(a,a+C),l),l+=C,a+=C;else for(;C--;)s[l++]=o[a++];this.b=l,s=this.f(),l=this.b}break;case M:for(;l+h>s.length;)s=this.f({v:2});break;default:t(Error("invalid inflate mode"))}if(n)s.set(o.subarray(a,a+h),l),l+=h,a+=h;else for(;h--;)s[l++]=o[a++];this.c=a,this.b=l,this.a=s;break;case 1:this.o(Z,j);break;case 2:X(this);break;default:t(Error("unknown BTYPE: "+r))}}return this.t()};var S,L,R=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],D=n?new Uint16Array(R):R,k=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],O=n?new Uint16Array(k):k,F=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],H=n?new Uint8Array(F):F,B=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],N=n?new Uint16Array(B):B,G=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],W=n?new Uint8Array(G):G,U=new(n?Uint8Array:Array)(288);for(S=0,L=U.length;S<L;++S)U[S]=143>=S?8:255>=S?9:279>=S?7:8;var V,z,Z=u(U),q=new(n?Uint8Array:Array)(30);for(V=0,z=q.length;V<z;++V)q[V]=5;var j=u(q);function Y(e,i){for(var r,o=e.g,n=e.e,a=e.input,s=e.c,l=a.length;n<i;)s>=l&&t(Error("input buffer is broken")),o|=a[s++]<<n,n+=8;return r=o&(1<<i)-1,e.g=o>>>i,e.e=n-i,e.c=s,r}function K(t,e){for(var i,r,o=t.g,n=t.e,a=t.input,s=t.c,l=a.length,g=e[0],h=e[1];n<h&&!(s>=l);)o|=a[s++]<<n,n+=8;return r=(i=g[o&(1<<h)-1])>>>16,t.g=o>>r,t.e=n-r,t.c=s,65535&i}function X(t){function e(t,e,i){var r,o,n,a=this.z;for(n=0;n<t;)switch(r=K(this,e),r){case 16:for(o=3+Y(this,2);o--;)i[n++]=a;break;case 17:for(o=3+Y(this,3);o--;)i[n++]=0;a=0;break;case 18:for(o=11+Y(this,7);o--;)i[n++]=0;a=0;break;default:a=i[n++]=r}return this.z=a,i}var i,r,o,a,s=Y(t,5)+257,l=Y(t,5)+1,g=Y(t,4)+4,h=new(n?Uint8Array:Array)(D.length);for(a=0;a<g;++a)h[D[a]]=Y(t,3);if(!n)for(a=g,g=h.length;a<g;++a)h[D[a]]=0;i=u(h),r=new(n?Uint8Array:Array)(s),o=new(n?Uint8Array:Array)(l),t.z=0,t.o(u(e.call(t,s,i,r)),u(e.call(t,l,i,o)))}function Q(t){if("string"==typeof t){var e,i,r=t.split("");for(e=0,i=r.length;e<i;e++)r[e]=(255&r[e].charCodeAt(0))>>>0;t=r}for(var o,n=1,a=0,s=t.length,l=0;0<s;){s-=o=1024<s?1024:s;do{n+=t[l++],a+=n}while(--o);n%=65521,a%=65521}return(a<<16|n)>>>0}function J(e,i){var r,o;switch(this.input=e,this.c=0,!i&&(i={})||(i.index&&(this.c=i.index),i.verify&&(this.N=i.verify)),r=e[this.c++],o=e[this.c++],15&r){case $:this.method=$;break;default:t(Error("unsupported compression method"))}0!=((r<<8)+o)%31&&t(Error("invalid fcheck flag:"+((r<<8)+o)%31)),32&o&&t(Error("fdict flag is not supported")),this.B=new E(e,{index:this.c,bufferSize:i.bufferSize,bufferType:i.bufferType,resize:i.resize})}E.prototype.o=function(t,e){var i=this.a,r=this.b;this.u=t;for(var o,n,a,s,l=i.length-258;256!==(o=K(this,t));)if(256>o)r>=l&&(this.b=r,i=this.f(),r=this.b),i[r++]=o;else for(s=O[n=o-257],0<H[n]&&(s+=Y(this,H[n])),o=K(this,e),a=N[o],0<W[o]&&(a+=Y(this,W[o])),r>=l&&(this.b=r,i=this.f(),r=this.b);s--;)i[r]=i[r++-a];for(;8<=this.e;)this.e-=8,this.c--;this.b=r},E.prototype.J=function(t,e){var i=this.a,r=this.b;this.u=t;for(var o,n,a,s,l=i.length;256!==(o=K(this,t));)if(256>o)r>=l&&(i=this.f(),l=i.length),i[r++]=o;else for(s=O[n=o-257],0<H[n]&&(s+=Y(this,H[n])),o=K(this,e),a=N[o],0<W[o]&&(a+=Y(this,W[o])),r+s>l&&(l=(i=this.f()).length);s--;)i[r]=i[r++-a];for(;8<=this.e;)this.e-=8,this.c--;this.b=r},E.prototype.f=function(){var t,e,i=new(n?Uint8Array:Array)(this.b-32768),r=this.b-32768,o=this.a;if(n)i.set(o.subarray(32768,i.length));else for(t=0,e=i.length;t<e;++t)i[t]=o[t+32768];if(this.l.push(i),this.q+=i.length,n)o.set(o.subarray(r,r+32768));else for(t=0;32768>t;++t)o[t]=o[r+t];return this.b=32768,o},E.prototype.K=function(t){var e,i,r,o=this.input.length/this.c+1|0,a=this.input,s=this.a;return t&&("number"==typeof t.v&&(o=t.v),"number"==typeof t.G&&(o+=t.G)),2>o?i=(r=(a.length-this.c)/this.u[2]/2*258|0)<s.length?s.length+r:s.length<<1:i=s.length*o,n?(e=new Uint8Array(i)).set(s):e=s,this.a=e},E.prototype.t=function(){var t,e,i,r,o,a=0,s=this.a,l=this.l,g=new(n?Uint8Array:Array)(this.q+(this.b-32768));if(0===l.length)return n?this.a.subarray(32768,this.b):this.a.slice(32768,this.b);for(e=0,i=l.length;e<i;++e)for(r=0,o=(t=l[e]).length;r<o;++r)g[a++]=t[r];for(e=32768,i=this.b;e<i;++e)g[a++]=s[e];return this.l=[],this.buffer=g},E.prototype.I=function(){var t,e=this.b;return n?this.C?(t=new Uint8Array(e)).set(this.a.subarray(0,e)):t=this.a.subarray(0,e):(this.a.length>e&&(this.a.length=e),t=this.a),this.buffer=t},J.prototype.p=function(){var e,i=this.input;return e=this.B.p(),this.c=this.B.c,this.N&&((i[this.c++]<<24|i[this.c++]<<16|i[this.c++]<<8|i[this.c++])>>>0!==Q(e)&&t(Error("invalid adler-32 checksum"))),e};var $=8;function tt(t,e){this.input=t,this.a=new(n?Uint8Array:Array)(32768),this.h=et.k;var i,r={};!e&&(e={})||"number"!=typeof e.compressionType||(this.h=e.compressionType);for(i in e)r[i]=e[i];r.outputBuffer=this.a,this.A=new p(this.input,r)}var et=m;function it(t,e){var i,r,n,a;if(Object.keys)i=Object.keys(e);else for(r in i=[],n=0,e)i[n++]=r;for(n=0,a=i.length;n<a;++n)r=i[n],o(t+"."+r,e[r])}tt.prototype.j=function(){var e,i,r,o,a,s,l,g=0;switch(l=this.a,e=$){case $:i=Math.LOG2E*Math.log(32768)-8;break;default:t(Error("invalid compression method"))}switch(r=i<<4|e,l[g++]=r,e){case $:switch(this.h){case et.NONE:a=0;break;case et.r:a=1;break;case et.k:a=2;break;default:t(Error("unsupported compression type"))}break;default:t(Error("invalid compression method"))}return o=a<<6|0,l[g++]=o|31-(256*r+o)%31,s=Q(this.input),this.A.b=g,g=(l=this.A.j()).length,n&&((l=new Uint8Array(l.buffer)).length<=g+4&&(this.a=new Uint8Array(l.length+4),this.a.set(l),l=this.a),l=l.subarray(0,g+4)),l[g++]=s>>24&255,l[g++]=s>>16&255,l[g++]=s>>8&255,l[g++]=255&s,l},o("Zlib.Inflate",J),o("Zlib.Inflate.prototype.decompress",J.prototype.p),it("Zlib.Inflate.BufferType",{ADAPTIVE:x.D,BLOCK:x.F}),o("Zlib.Deflate",tt),o("Zlib.Deflate.compress",function(t,e){return new tt(t,e).j()}),o("Zlib.Deflate.prototype.compress",tt.prototype.j),it("Zlib.Deflate.CompressionType",{NONE:et.NONE,FIXED:et.r,DYNAMIC:et.k})}.call(window);