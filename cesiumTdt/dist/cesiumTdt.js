!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.cesiumTdt=t():e.cesiumTdt=t()}(window,(function(){return function(e){var t={};function i(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(r,o,function(t){return e[t]}.bind(null,o));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=237)}([function(e,t,i){e.exports=i(169)},function(e,t,i){var r=i(9),o=i(3);function n(t){return e.exports=n="function"==typeof o&&"symbol"==typeof r?function(e){return typeof e}:function(e){return e&&"function"==typeof o&&e.constructor===o&&e!==o.prototype?"symbol":typeof e},n(t)}e.exports=n},function(e,t,i){e.exports=i(166)},function(e,t,i){e.exports=i(179)},function(e,t,i){e.exports=i(151)},function(e,t){var i=e.exports={version:"2.6.11"};"number"==typeof __e&&(__e=i)},function(e,t,i){e.exports=i(157)},function(e,t,i){var r=i(65)("wks"),o=i(40),n=i(13).Symbol,a="function"==typeof n;(e.exports=function(e){return r[e]||(r[e]=a&&n[e]||(a?n:o)("Symbol."+e))}).store=r},function(e,t){var i=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=i)},function(e,t,i){e.exports=i(172)},function(e,t,i){var r=i(8),o=i(5),n=i(55),a=i(32),s=i(31),l=function(e,t,i){var u,h,c,p=e&l.F,d=e&l.G,f=e&l.S,g=e&l.P,m=e&l.B,_=e&l.W,v=d?o:o[t]||(o[t]={}),C=v.prototype,y=d?r:f?r[t]:(r[t]||{}).prototype;for(u in d&&(i=t),i)(h=!p&&y&&void 0!==y[u])&&s(v,u)||(c=h?y[u]:i[u],v[u]=d&&"function"!=typeof y[u]?i[u]:m&&h?n(c,r):_&&y[u]==c?function(e){var t=function(t,i,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,i)}return new e(t,i,r)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(c):g&&"function"==typeof c?n(Function.call,c):c,g&&((v.virtual||(v.virtual={}))[u]=c,e&l.R&&C&&!C[u]&&a(C,u,c)))};l.F=1,l.G=2,l.S=4,l.P=8,l.B=16,l.W=32,l.U=64,l.R=128,e.exports=l},function(e,t,i){e.exports=i(144)},function(e,t,i){e.exports=i(164)},function(e,t){var i=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=i)},function(e,t,i){e.exports=!i(19)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},function(e,t,i){var r=i(73)("wks"),o=i(54),n=i(8).Symbol,a="function"==typeof n;(e.exports=function(e){return r[e]||(r[e]=a&&n[e]||(a?n:o)("Symbol."+e))}).store=r},function(e,t,i){e.exports=i(161)},function(e,t,i){var r=i(27),o=Math.min;e.exports=function(e){return e>0?o(r(e),9007199254740991):0}},function(e,t,i){var r=i(25);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,i){var r=i(21),o=i(48);e.exports=i(14)?function(e,t,i){return r.f(e,t,o(1,i))}:function(e,t,i){return e[t]=i,e}},function(e,t,i){var r=i(18),o=i(97),n=i(47),a=Object.defineProperty;t.f=i(14)?Object.defineProperty:function(e,t,i){if(r(e),t=n(t,!0),r(i),o)try{return a(e,t,i)}catch(e){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(e[t]=i.value),e}},function(e,t,i){var r=i(13),o=i(45),n=i(20),a=i(23),s=i(50),l=function(e,t,i){var u,h,c,p,d=e&l.F,f=e&l.G,g=e&l.S,m=e&l.P,_=e&l.B,v=f?r:g?r[t]||(r[t]={}):(r[t]||{}).prototype,C=f?o:o[t]||(o[t]={}),y=C.prototype||(C.prototype={});for(u in f&&(i=t),i)c=((h=!d&&v&&void 0!==v[u])?v:i)[u],p=_&&h?s(c,r):m&&"function"==typeof c?s(Function.call,c):c,v&&a(v,u,c,e&l.U),C[u]!=c&&n(C,u,p),m&&y[u]!=c&&(y[u]=c)};r.core=o,l.F=1,l.G=2,l.S=4,l.P=8,l.B=16,l.W=32,l.U=64,l.R=128,e.exports=l},function(e,t,i){var r=i(13),o=i(20),n=i(30),a=i(40)("src"),s=i(147),l=(""+s).split("toString");i(45).inspectSource=function(e){return s.call(e)},(e.exports=function(e,t,i,s){var u="function"==typeof i;u&&(n(i,"name")||o(i,"name",t)),e[t]!==i&&(u&&(n(i,a)||o(i,a,e[t]?""+e[t]:l.join(String(t)))),e===r?e[t]=i:s?e[t]?e[t]=i:o(e,t,i):(delete e[t],o(e,t,i)))})(Function.prototype,"toString",(function(){return"function"==typeof this&&this[a]||s.call(this)}))},function(e,t,i){e.exports=!i(37)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t){var i=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:i)(e)}},function(e,t,i){var r=i(29),o=i(107),n=i(76),a=Object.defineProperty;t.f=i(24)?Object.defineProperty:function(e,t,i){if(r(e),t=n(t,!0),r(i),o)try{return a(e,t,i)}catch(e){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(e[t]=i.value),e}},function(e,t,i){var r=i(33);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},function(e,t){var i={}.hasOwnProperty;e.exports=function(e,t){return i.call(e,t)}},function(e,t){var i={}.hasOwnProperty;e.exports=function(e,t){return i.call(e,t)}},function(e,t,i){var r=i(28),o=i(57);e.exports=i(24)?function(e,t,i){return r.f(e,t,o(1,i))}:function(e,t,i){return e[t]=i,e}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t){e.exports={}},function(e,t,i){var r=i(26);e.exports=function(e){return Object(r(e))}},function(e,t,i){var r=i(153),o=i(52);e.exports=function(e){return r(o(e))}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,i){"use strict";if(i(14)){var r=i(46),o=i(13),n=i(19),a=i(22),s=i(123),l=i(195),u=i(50),h=i(125),c=i(48),p=i(20),d=i(124),f=i(27),g=i(17),m=i(126),_=i(51),v=i(47),C=i(30),y=i(59),A=i(25),I=i(35),b=i(196),w=i(66),E=i(104),G=i(63).f,S=i(197),P=i(40),T=i(7),x=i(198),M=i(103),L=i(108),N=i(39),R=i(34),O=i(202),D=i(127),F=i(90),U=i(203),B=i(21),k=i(91),V=B.f,W=k.f,j=o.RangeError,z=o.TypeError,H=o.Uint8Array,q=Array.prototype,X=l.ArrayBuffer,Y=l.DataView,K=x(0),Q=x(2),Z=x(3),J=x(4),$=x(5),ee=x(6),te=M(!0),ie=M(!1),re=N.values,oe=N.keys,ne=N.entries,ae=q.lastIndexOf,se=q.reduce,le=q.reduceRight,ue=q.join,he=q.sort,ce=q.slice,pe=q.toString,de=q.toLocaleString,fe=T("iterator"),ge=T("toStringTag"),me=P("typed_constructor"),_e=P("def_constructor"),ve=s.CONSTR,Ce=s.TYPED,ye=s.VIEW,Ae=x(1,(function(e,t){return Ge(L(e,e[_e]),t)})),Ie=n((function(){return 1===new H(new Uint16Array([1]).buffer)[0]})),be=!!H&&!!H.prototype.set&&n((function(){new H(1).set({})})),we=function(e,t){var i=f(e);if(i<0||i%t)throw j("Wrong offset!");return i},Ee=function(e){if(A(e)&&Ce in e)return e;throw z(e+" is not a typed array!")},Ge=function(e,t){if(!A(e)||!(me in e))throw z("It is not a typed array constructor!");return new e(t)},Se=function(e,t){return Pe(L(e,e[_e]),t)},Pe=function(e,t){for(var i=0,r=t.length,o=Ge(e,r);r>i;)o[i]=t[i++];return o},Te=function(e,t,i){V(e,t,{get:function(){return this._d[i]}})},xe=function(e){var t,i,r,o,n,a,s=I(e),l=arguments.length,h=l>1?arguments[1]:void 0,c=void 0!==h,p=S(s);if(null!=p&&!b(p)){for(a=p.call(s),r=[],t=0;!(n=a.next()).done;t++)r.push(n.value);s=r}for(c&&l>2&&(h=u(h,arguments[2],2)),t=0,i=g(s.length),o=Ge(this,i);i>t;t++)o[t]=c?h(s[t],t):s[t];return o},Me=function(){for(var e=0,t=arguments.length,i=Ge(this,t);t>e;)i[e]=arguments[e++];return i},Le=!!H&&n((function(){de.call(new H(1))})),Ne=function(){return de.apply(Le?ce.call(Ee(this)):Ee(this),arguments)},Re={copyWithin:function(e,t){return U.call(Ee(this),e,t,arguments.length>2?arguments[2]:void 0)},every:function(e){return J(Ee(this),e,arguments.length>1?arguments[1]:void 0)},fill:function(e){return F.apply(Ee(this),arguments)},filter:function(e){return Se(this,Q(Ee(this),e,arguments.length>1?arguments[1]:void 0))},find:function(e){return $(Ee(this),e,arguments.length>1?arguments[1]:void 0)},findIndex:function(e){return ee(Ee(this),e,arguments.length>1?arguments[1]:void 0)},forEach:function(e){K(Ee(this),e,arguments.length>1?arguments[1]:void 0)},indexOf:function(e){return ie(Ee(this),e,arguments.length>1?arguments[1]:void 0)},includes:function(e){return te(Ee(this),e,arguments.length>1?arguments[1]:void 0)},join:function(e){return ue.apply(Ee(this),arguments)},lastIndexOf:function(e){return ae.apply(Ee(this),arguments)},map:function(e){return Ae(Ee(this),e,arguments.length>1?arguments[1]:void 0)},reduce:function(e){return se.apply(Ee(this),arguments)},reduceRight:function(e){return le.apply(Ee(this),arguments)},reverse:function(){for(var e,t=Ee(this).length,i=Math.floor(t/2),r=0;r<i;)e=this[r],this[r++]=this[--t],this[t]=e;return this},some:function(e){return Z(Ee(this),e,arguments.length>1?arguments[1]:void 0)},sort:function(e){return he.call(Ee(this),e)},subarray:function(e,t){var i=Ee(this),r=i.length,o=_(e,r);return new(L(i,i[_e]))(i.buffer,i.byteOffset+o*i.BYTES_PER_ELEMENT,g((void 0===t?r:_(t,r))-o))}},Oe=function(e,t){return Se(this,ce.call(Ee(this),e,t))},De=function(e){Ee(this);var t=we(arguments[1],1),i=this.length,r=I(e),o=g(r.length),n=0;if(o+t>i)throw j("Wrong length!");for(;n<o;)this[t+n]=r[n++]},Fe={entries:function(){return ne.call(Ee(this))},keys:function(){return oe.call(Ee(this))},values:function(){return re.call(Ee(this))}},Ue=function(e,t){return A(e)&&e[Ce]&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},Be=function(e,t){return Ue(e,t=v(t,!0))?c(2,e[t]):W(e,t)},ke=function(e,t,i){return!(Ue(e,t=v(t,!0))&&A(i)&&C(i,"value"))||C(i,"get")||C(i,"set")||i.configurable||C(i,"writable")&&!i.writable||C(i,"enumerable")&&!i.enumerable?V(e,t,i):(e[t]=i.value,e)};ve||(k.f=Be,B.f=ke),a(a.S+a.F*!ve,"Object",{getOwnPropertyDescriptor:Be,defineProperty:ke}),n((function(){pe.call({})}))&&(pe=de=function(){return ue.call(this)});var Ve=d({},Re);d(Ve,Fe),p(Ve,fe,Fe.values),d(Ve,{slice:Oe,set:De,constructor:function(){},toString:pe,toLocaleString:Ne}),Te(Ve,"buffer","b"),Te(Ve,"byteOffset","o"),Te(Ve,"byteLength","l"),Te(Ve,"length","e"),V(Ve,ge,{get:function(){return this[Ce]}}),e.exports=function(e,t,i,l){var u=e+((l=!!l)?"Clamped":"")+"Array",c="get"+e,d="set"+e,f=o[u],_=f||{},v=f&&E(f),C=!f||!s.ABV,I={},b=f&&f.prototype,S=function(e,i){V(e,i,{get:function(){return function(e,i){var r=e._d;return r.v[c](i*t+r.o,Ie)}(this,i)},set:function(e){return function(e,i,r){var o=e._d;l&&(r=(r=Math.round(r))<0?0:r>255?255:255&r),o.v[d](i*t+o.o,r,Ie)}(this,i,e)},enumerable:!0})};C?(f=i((function(e,i,r,o){h(e,f,u,"_d");var n,a,s,l,c=0,d=0;if(A(i)){if(!(i instanceof X||"ArrayBuffer"==(l=y(i))||"SharedArrayBuffer"==l))return Ce in i?Pe(f,i):xe.call(f,i);n=i,d=we(r,t);var _=i.byteLength;if(void 0===o){if(_%t)throw j("Wrong length!");if((a=_-d)<0)throw j("Wrong length!")}else if((a=g(o)*t)+d>_)throw j("Wrong length!");s=a/t}else s=m(i),n=new X(a=s*t);for(p(e,"_d",{b:n,o:d,l:a,e:s,v:new Y(n)});c<s;)S(e,c++)})),b=f.prototype=w(Ve),p(b,"constructor",f)):n((function(){f(1)}))&&n((function(){new f(-1)}))&&O((function(e){new f,new f(null),new f(1.5),new f(e)}),!0)||(f=i((function(e,i,r,o){var n;return h(e,f,u),A(i)?i instanceof X||"ArrayBuffer"==(n=y(i))||"SharedArrayBuffer"==n?void 0!==o?new _(i,we(r,t),o):void 0!==r?new _(i,we(r,t)):new _(i):Ce in i?Pe(f,i):xe.call(f,i):new _(m(i))})),K(v!==Function.prototype?G(_).concat(G(v)):G(_),(function(e){e in f||p(f,e,_[e])})),f.prototype=b,r||(b.constructor=f));var P=b[fe],T=!!P&&("values"==P.name||null==P.name),x=Fe.values;p(f,me,!0),p(b,Ce,u),p(b,ye,!0),p(b,_e,f),(l?new f(1)[ge]==u:ge in b)||V(b,ge,{get:function(){return u}}),I[u]=f,a(a.G+a.W+a.F*(f!=_),I),a(a.S,u,{BYTES_PER_ELEMENT:t}),a(a.S+a.F*n((function(){_.of.call(f,1)})),u,{from:xe,of:Me}),"BYTES_PER_ELEMENT"in b||p(b,"BYTES_PER_ELEMENT",t),a(a.P,u,Re),D(u),a(a.P+a.F*be,u,{set:De}),a(a.P+a.F*!T,u,Fe),r||b.toString==pe||(b.toString=pe),a(a.P+a.F*n((function(){new f(1).slice()})),u,{slice:Oe}),a(a.P+a.F*(n((function(){return[1,2].toLocaleString()!=new f([1,2]).toLocaleString()}))||!n((function(){b.toLocaleString.call([1,2])}))),u,{toLocaleString:Ne}),R[u]=T?P:x,r||T||p(b,fe,x)}}else e.exports=function(){}},function(e,t,i){"use strict";var r=i(96),o=i(145),n=i(34),a=i(49);e.exports=i(146)(Array,"Array",(function(e,t){this._t=a(e),this._i=0,this._k=t}),(function(){var e=this._t,t=this._k,i=this._i++;return!e||i>=e.length?(this._t=void 0,o(1)):o(0,"keys"==t?i:"values"==t?e[i]:[i,e[i]])}),"values"),n.Arguments=n.Array,r("keys"),r("values"),r("entries")},function(e,t){var i=0,r=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++i+r).toString(36))}},function(e,t){var i={}.toString;e.exports=function(e){return i.call(e).slice(8,-1)}},function(e,t){var i={}.toString;e.exports=function(e){return i.call(e).slice(8,-1)}},function(e,t){e.exports=!0},function(e,t){e.exports={}},function(e,t){var i=e.exports={version:"2.6.11"};"number"==typeof __e&&(__e=i)},function(e,t){e.exports=!1},function(e,t,i){var r=i(25);e.exports=function(e,t){if(!r(e))return e;var i,o;if(t&&"function"==typeof(i=e.toString)&&!r(o=i.call(e)))return o;if("function"==typeof(i=e.valueOf)&&!r(o=i.call(e)))return o;if(!t&&"function"==typeof(i=e.toString)&&!r(o=i.call(e)))return o;throw TypeError("Can't convert object to primitive value")}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,i){var r=i(99),o=i(26);e.exports=function(e){return r(o(e))}},function(e,t,i){var r=i(100);e.exports=function(e,t,i){if(r(e),void 0===t)return e;switch(i){case 1:return function(i){return e.call(t,i)};case 2:return function(i,r){return e.call(t,i,r)};case 3:return function(i,r,o){return e.call(t,i,r,o)}}return function(){return e.apply(t,arguments)}}},function(e,t,i){var r=i(27),o=Math.max,n=Math.min;e.exports=function(e,t){return(e=r(e))<0?o(e+t,0):n(e,t)}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,i){var r=i(105),o=i(74);e.exports=Object.keys||function(e){return r(e,o)}},function(e,t){var i=0,r=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++i+r).toString(36))}},function(e,t,i){var r=i(56);e.exports=function(e,t,i){if(r(e),void 0===t)return e;switch(i){case 1:return function(i){return e.call(t,i)};case 2:return function(i,r){return e.call(t,i,r)};case 3:return function(i,r,o){return e.call(t,i,r,o)}}return function(){return e.apply(t,arguments)}}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,i){"use strict";var r=i(59),o=RegExp.prototype.exec;e.exports=function(e,t){var i=e.exec;if("function"==typeof i){var n=i.call(e,t);if("object"!=typeof n)throw new TypeError("RegExp exec method returned something other than an Object or null");return n}if("RegExp"!==r(e))throw new TypeError("RegExp#exec called on incompatible receiver");return o.call(e,t)}},function(e,t,i){var r=i(41),o=i(7)("toStringTag"),n="Arguments"==r(function(){return arguments}());e.exports=function(e){var t,i,a;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(i=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),o))?i:n?r(t):"Object"==(a=r(t))&&"function"==typeof t.callee?"Arguments":a}},function(e,t,i){"use strict";var r=i(18);e.exports=function(){var e=r(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},function(e,t,i){"use strict";i(160);var r=i(23),o=i(20),n=i(19),a=i(26),s=i(7),l=i(80),u=s("species"),h=!n((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})),c=function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var i="ab".split(e);return 2===i.length&&"a"===i[0]&&"b"===i[1]}();e.exports=function(e,t,i){var p=s(e),d=!n((function(){var t={};return t[p]=function(){return 7},7!=""[e](t)})),f=d?!n((function(){var t=!1,i=/a/;return i.exec=function(){return t=!0,null},"split"===e&&(i.constructor={},i.constructor[u]=function(){return i}),i[p](""),!t})):void 0;if(!d||!f||"replace"===e&&!h||"split"===e&&!c){var g=/./[p],m=i(a,p,""[e],(function(e,t,i,r,o){return t.exec===l?d&&!o?{done:!0,value:g.call(t,i,r)}:{done:!0,value:e.call(i,t,r)}:{done:!1}})),_=m[0],v=m[1];r(String.prototype,e,_),o(RegExp.prototype,p,2==t?function(e,t){return v.call(e,this,t)}:function(e){return v.call(e,this)})}}},function(e,t,i){var r=i(28).f,o=i(31),n=i(15)("toStringTag");e.exports=function(e,t,i){e&&!o(e=i?e:e.prototype,n)&&r(e,n,{configurable:!0,value:t})}},function(e,t,i){var r=i(102),o=i(68).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,o)}},function(e,t,i){for(var r=i(39),o=i(101),n=i(23),a=i(13),s=i(20),l=i(34),u=i(7),h=u("iterator"),c=u("toStringTag"),p=l.Array,d={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},f=o(d),g=0;g<f.length;g++){var m,_=f[g],v=d[_],C=a[_],y=C&&C.prototype;if(y&&(y[h]||s(y,h,p),y[c]||s(y,c,_),l[_]=p,v))for(m in r)y[m]||n(y,m,r[m],!0)}},function(e,t,i){var r=i(45),o=i(13),n=o["__core-js_shared__"]||(o["__core-js_shared__"]={});(e.exports=function(e,t){return n[e]||(n[e]=void 0!==t?t:{})})("versions",[]).push({version:r.version,mode:i(46)?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},function(e,t,i){var r=i(18),o=i(149),n=i(68),a=i(67)("IE_PROTO"),s=function(){},l=function(){var e,t=i(98)("iframe"),r=n.length;for(t.style.display="none",i(150).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),l=e.F;r--;)delete l.prototype[n[r]];return l()};e.exports=Object.create||function(e,t){var i;return null!==e?(s.prototype=r(e),i=new s,s.prototype=null,i[a]=e):i=l(),void 0===t?i:o(i,t)}},function(e,t,i){var r=i(65)("keys"),o=i(40);e.exports=function(e){return r[e]||(r[e]=o(e))}},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,i){var r=i(21).f,o=i(30),n=i(7)("toStringTag");e.exports=function(e,t,i){e&&!o(e=i?e:e.prototype,n)&&r(e,n,{configurable:!0,value:t})}},function(e,t,i){var r=i(52);e.exports=function(e){return Object(r(e))}},function(e,t){var i=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:i)(e)}},function(e,t,i){var r=i(73)("keys"),o=i(54);e.exports=function(e){return r[e]||(r[e]=o(e))}},function(e,t,i){var r=i(5),o=i(8),n=o["__core-js_shared__"]||(o["__core-js_shared__"]={});(e.exports=function(e,t){return n[e]||(n[e]=void 0!==t?t:{})})("versions",[]).push({version:r.version,mode:i(43)?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,i){var r=i(33),o=i(8).document,n=r(o)&&r(o.createElement);e.exports=function(e){return n?o.createElement(e):{}}},function(e,t,i){var r=i(33);e.exports=function(e,t){if(!r(e))return e;var i,o;if(t&&"function"==typeof(i=e.toString)&&!r(o=i.call(e)))return o;if("function"==typeof(i=e.valueOf)&&!r(o=i.call(e)))return o;if(!t&&"function"==typeof(i=e.toString)&&!r(o=i.call(e)))return o;throw TypeError("Can't convert object to primitive value")}},function(e,t,i){"use strict";var r=i(78),o=i(18),n=i(108),a=i(79),s=i(17),l=i(58),u=i(80),h=i(19),c=Math.min,p=[].push,d="length",f=!h((function(){RegExp(4294967295,"y")}));i(61)("split",2,(function(e,t,i,h){var g;return g="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1)[d]||2!="ab".split(/(?:ab)*/)[d]||4!=".".split(/(.?)(.?)/)[d]||".".split(/()()/)[d]>1||"".split(/.?/)[d]?function(e,t){var o=String(this);if(void 0===e&&0===t)return[];if(!r(e))return i.call(o,e,t);for(var n,a,s,l=[],h=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),c=0,f=void 0===t?4294967295:t>>>0,g=new RegExp(e.source,h+"g");(n=u.call(g,o))&&!((a=g.lastIndex)>c&&(l.push(o.slice(c,n.index)),n[d]>1&&n.index<o[d]&&p.apply(l,n.slice(1)),s=n[0][d],c=a,l[d]>=f));)g.lastIndex===n.index&&g.lastIndex++;return c===o[d]?!s&&g.test("")||l.push(""):l.push(o.slice(c)),l[d]>f?l.slice(0,f):l}:"0".split(void 0,0)[d]?function(e,t){return void 0===e&&0===t?[]:i.call(this,e,t)}:i,[function(i,r){var o=e(this),n=null==i?void 0:i[t];return void 0!==n?n.call(i,o,r):g.call(String(o),i,r)},function(e,t){var r=h(g,e,this,t,g!==i);if(r.done)return r.value;var u=o(e),p=String(this),d=n(u,RegExp),m=u.unicode,_=(u.ignoreCase?"i":"")+(u.multiline?"m":"")+(u.unicode?"u":"")+(f?"y":"g"),v=new d(f?u:"^(?:"+u.source+")",_),C=void 0===t?4294967295:t>>>0;if(0===C)return[];if(0===p.length)return null===l(v,p)?[p]:[];for(var y=0,A=0,I=[];A<p.length;){v.lastIndex=f?A:0;var b,w=l(v,f?p:p.slice(A));if(null===w||(b=c(s(v.lastIndex+(f?0:A)),p.length))===y)A=a(p,A,m);else{if(I.push(p.slice(y,A)),I.length===C)return I;for(var E=1;E<=w.length-1;E++)if(I.push(w[E]),I.length===C)return I;A=y=b}}return I.push(p.slice(y)),I}]}))},function(e,t,i){var r=i(25),o=i(41),n=i(7)("match");e.exports=function(e){var t;return r(e)&&(void 0!==(t=e[n])?!!t:"RegExp"==o(e))}},function(e,t,i){"use strict";var r=i(159)(!0);e.exports=function(e,t,i){return t+(i?r(e,t).length:1)}},function(e,t,i){"use strict";var r,o,n=i(60),a=RegExp.prototype.exec,s=String.prototype.replace,l=a,u=(r=/a/,o=/b*/g,a.call(r,"a"),a.call(o,"a"),0!==r.lastIndex||0!==o.lastIndex),h=void 0!==/()??/.exec("")[1];(u||h)&&(l=function(e){var t,i,r,o,l=this;return h&&(i=new RegExp("^"+l.source+"$(?!\\s)",n.call(l))),u&&(t=l.lastIndex),r=a.call(l,e),u&&r&&(l.lastIndex=l.global?r.index+r[0].length:t),h&&r&&r.length>1&&s.call(r[0],i,(function(){for(o=1;o<arguments.length-2;o++)void 0===arguments[o]&&(r[o]=void 0)})),r}),e.exports=l},function(e,t,i){var r=i(29),o=i(109),n=i(74),a=i(72)("IE_PROTO"),s=function(){},l=function(){var e,t=i(75)("iframe"),r=n.length;for(t.style.display="none",i(110).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),l=e.F;r--;)delete l.prototype[n[r]];return l()};e.exports=Object.create||function(e,t){var i;return null!==e?(s.prototype=r(e),i=new s,s.prototype=null,i[a]=e):i=l(),void 0===t?i:o(i,t)}},function(e,t,i){var r=i(21).f,o=Function.prototype,n=/^\s*function ([^ (]*)/;"name"in o||i(14)&&r(o,"name",{configurable:!0,get:function(){try{return(""+this).match(n)[1]}catch(e){return""}}})},function(e,t,i){"use strict";i(163);var r=i(18),o=i(60),n=i(14),a=/./.toString,s=function(e){i(23)(RegExp.prototype,"toString",e,!0)};i(19)((function(){return"/a/b"!=a.call({source:"a",flags:"b"})}))?s((function(){var e=r(this);return"/".concat(e.source,"/","flags"in e?e.flags:!n&&e instanceof RegExp?o.call(e):void 0)})):"toString"!=a.name&&s((function(){return a.call(this)}))},function(e,t,i){"use strict";var r=i(59),o={};o[i(7)("toStringTag")]="z",o+""!="[object z]"&&i(23)(Object.prototype,"toString",(function(){return"[object "+r(this)+"]"}),!0)},function(e,t){e.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},function(e,t,i){"use strict";var r=i(18),o=i(35),n=i(17),a=i(27),s=i(79),l=i(58),u=Math.max,h=Math.min,c=Math.floor,p=/\$([$&`']|\d\d?|<[^>]*>)/g,d=/\$([$&`']|\d\d?)/g;i(61)("replace",2,(function(e,t,i,f){return[function(r,o){var n=e(this),a=null==r?void 0:r[t];return void 0!==a?a.call(r,n,o):i.call(String(n),r,o)},function(e,t){var o=f(i,e,this,t);if(o.done)return o.value;var c=r(e),p=String(this),d="function"==typeof t;d||(t=String(t));var m=c.global;if(m){var _=c.unicode;c.lastIndex=0}for(var v=[];;){var C=l(c,p);if(null===C)break;if(v.push(C),!m)break;""===String(C[0])&&(c.lastIndex=s(p,n(c.lastIndex),_))}for(var y,A="",I=0,b=0;b<v.length;b++){C=v[b];for(var w=String(C[0]),E=u(h(a(C.index),p.length),0),G=[],S=1;S<C.length;S++)G.push(void 0===(y=C[S])?y:String(y));var P=C.groups;if(d){var T=[w].concat(G,E,p);void 0!==P&&T.push(P);var x=String(t.apply(void 0,T))}else x=g(w,p,E,G,P,t);E>=I&&(A+=p.slice(I,E)+x,I=E+w.length)}return A+p.slice(I)}];function g(e,t,r,n,a,s){var l=r+e.length,u=n.length,h=d;return void 0!==a&&(a=o(a),h=p),i.call(s,h,(function(i,o){var s;switch(o.charAt(0)){case"$":return"$";case"&":return e;case"`":return t.slice(0,r);case"'":return t.slice(l);case"<":s=a[o.slice(1,-1)];break;default:var h=+o;if(0===h)return i;if(h>u){var p=c(h/10);return 0===p?i:p<=u?void 0===n[p-1]?o.charAt(1):n[p-1]+o.charAt(1):i}s=n[h-1]}return void 0===s?"":s}))}}))},function(e,t,i){t.f=i(15)},function(e,t,i){var r=i(8),o=i(5),n=i(43),a=i(87),s=i(28).f;e.exports=function(e){var t=o.Symbol||(o.Symbol=n?{}:r.Symbol||{});"_"==e.charAt(0)||e in t||s(t,e,{value:a.f(e)})}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,i){"use strict";var r=i(35),o=i(51),n=i(17);e.exports=function(e){for(var t=r(this),i=n(t.length),a=arguments.length,s=o(a>1?arguments[1]:void 0,i),l=a>2?arguments[2]:void 0,u=void 0===l?i:o(l,i);u>s;)t[s++]=e;return t}},function(e,t,i){var r=i(204),o=i(48),n=i(49),a=i(47),s=i(30),l=i(97),u=Object.getOwnPropertyDescriptor;t.f=i(14)?u:function(e,t){if(e=n(e),t=a(t,!0),l)try{return u(e,t)}catch(e){}if(s(e,t))return o(!r.f.call(e,t),e[t])}},function(e,t,i){"use strict";var r=i(56);function o(e){var t,i;this.promise=new e((function(e,r){if(void 0!==t||void 0!==i)throw TypeError("Bad Promise constructor");t=e,i=r})),this.resolve=r(t),this.reject=r(i)}e.exports.f=function(e){return new o(e)}},function(e,t,i){e.exports=i(209)},function(e,t){var i,r,o=e.exports={};function n(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(i===setTimeout)return setTimeout(e,0);if((i===n||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:n}catch(e){i=n}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var l,u=[],h=!1,c=-1;function p(){h&&l&&(h=!1,l.length?u=l.concat(u):c=-1,u.length&&d())}function d(){if(!h){var e=s(p);h=!0;for(var t=u.length;t;){for(l=u,u=[];++c<t;)l&&l[c].run();c=-1,t=u.length}l=null,h=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function g(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];u.push(new f(e,t)),1!==u.length||h||s(d)},f.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=g,o.addListener=g,o.once=g,o.off=g,o.removeListener=g,o.removeAllListeners=g,o.emit=g,o.prependListener=g,o.prependOnceListener=g,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(e,t){e.exports=function(e){if(!e.webpackPolyfill){var t=Object.create(e);t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,"exports",{enumerable:!0}),t.webpackPolyfill=1}return t}},function(e,t,i){var r=i(7)("unscopables"),o=Array.prototype;null==o[r]&&i(20)(o,r,{}),e.exports=function(e){o[r][e]=!0}},function(e,t,i){e.exports=!i(14)&&!i(19)((function(){return 7!=Object.defineProperty(i(98)("div"),"a",{get:function(){return 7}}).a}))},function(e,t,i){var r=i(25),o=i(13).document,n=r(o)&&r(o.createElement);e.exports=function(e){return n?o.createElement(e):{}}},function(e,t,i){var r=i(41);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,i){var r=i(102),o=i(68);e.exports=Object.keys||function(e){return r(e,o)}},function(e,t,i){var r=i(30),o=i(49),n=i(103)(!1),a=i(67)("IE_PROTO");e.exports=function(e,t){var i,s=o(e),l=0,u=[];for(i in s)i!=a&&r(s,i)&&u.push(i);for(;t.length>l;)r(s,i=t[l++])&&(~n(u,i)||u.push(i));return u}},function(e,t,i){var r=i(49),o=i(17),n=i(51);e.exports=function(e){return function(t,i,a){var s,l=r(t),u=o(l.length),h=n(a,u);if(e&&i!=i){for(;u>h;)if((s=l[h++])!=s)return!0}else for(;u>h;h++)if((e||h in l)&&l[h]===i)return e||h||0;return!e&&-1}}},function(e,t,i){var r=i(30),o=i(35),n=i(67)("IE_PROTO"),a=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=o(e),r(e,n)?e[n]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?a:null}},function(e,t,i){var r=i(31),o=i(36),n=i(154)(!1),a=i(72)("IE_PROTO");e.exports=function(e,t){var i,s=o(e),l=0,u=[];for(i in s)i!=a&&r(s,i)&&u.push(i);for(;t.length>l;)r(s,i=t[l++])&&(~n(u,i)||u.push(i));return u}},function(e,t,i){var r=i(71),o=Math.min;e.exports=function(e){return e>0?o(r(e),9007199254740991):0}},function(e,t,i){e.exports=!i(24)&&!i(37)((function(){return 7!=Object.defineProperty(i(75)("div"),"a",{get:function(){return 7}}).a}))},function(e,t,i){var r=i(18),o=i(100),n=i(7)("species");e.exports=function(e,t){var i,a=r(e).constructor;return void 0===a||null==(i=r(a)[n])?t:o(i)}},function(e,t,i){var r=i(28),o=i(29),n=i(53);e.exports=i(24)?Object.defineProperties:function(e,t){o(e);for(var i,a=n(t),s=a.length,l=0;s>l;)r.f(e,i=a[l++],t[i]);return e}},function(e,t,i){var r=i(8).document;e.exports=r&&r.documentElement},function(e,t,i){var r=i(42);e.exports=Array.isArray||function(e){return"Array"==r(e)}},function(e,t,i){var r=i(10),o=i(52),n=i(37),a=i(85),s="["+a+"]",l=RegExp("^"+s+s+"*"),u=RegExp(s+s+"*$"),h=function(e,t,i){var o={},s=n((function(){return!!a[e]()||"​"!="​"[e]()})),l=o[e]=s?t(c):a[e];i&&(o[i]=l),r(r.P+r.F*s,"String",o)},c=h.trim=function(e,t){return e=String(o(e)),1&t&&(e=e.replace(l,"")),2&t&&(e=e.replace(u,"")),e};e.exports=h},function(e,t,i){"use strict";var r=i(173)(!0);i(114)(String,"String",(function(e){this._t=String(e),this._i=0}),(function(){var e,t=this._t,i=this._i;return i>=t.length?{value:void 0,done:!0}:(e=r(t,i),this._i+=e.length,{value:e,done:!1})}))},function(e,t,i){"use strict";var r=i(43),o=i(10),n=i(115),a=i(32),s=i(44),l=i(174),u=i(62),h=i(175),c=i(15)("iterator"),p=!([].keys&&"next"in[].keys()),d=function(){return this};e.exports=function(e,t,i,f,g,m,_){l(i,t,f);var v,C,y,A=function(e){if(!p&&e in E)return E[e];switch(e){case"keys":case"values":return function(){return new i(this,e)}}return function(){return new i(this,e)}},I=t+" Iterator",b="values"==g,w=!1,E=e.prototype,G=E[c]||E["@@iterator"]||g&&E[g],S=G||A(g),P=g?b?A("entries"):S:void 0,T="Array"==t&&E.entries||G;if(T&&(y=h(T.call(new e)))!==Object.prototype&&y.next&&(u(y,I,!0),r||"function"==typeof y[c]||a(y,c,d)),b&&G&&"values"!==G.name&&(w=!0,S=function(){return G.call(this)}),r&&!_||!p&&!w&&E[c]||a(E,c,S),s[t]=S,s[I]=d,g)if(v={values:b?S:A("values"),keys:m?S:A("keys"),entries:P},_)for(C in v)C in E||n(E,C,v[C]);else o(o.P+o.F*(p||w),t,v);return v}},function(e,t,i){e.exports=i(32)},function(e,t,i){i(176);for(var r=i(8),o=i(32),n=i(44),a=i(15)("toStringTag"),s="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),l=0;l<s.length;l++){var u=s[l],h=r[u],c=h&&h.prototype;c&&!c[a]&&o(c,a,u),n[u]=n.Array}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,i){var r=i(105),o=i(74).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,o)}},function(e,t){},function(e,t,i){var r,o,n;
/**
 * @license bytebuffer.js (c) 2015 Daniel Wirtz <dcode@dcode.io>
 * Backing buffer: ArrayBuffer, Accessor: Uint8Array
 * Released under the Apache License, Version 2.0
 * see: https://github.com/dcodeIO/bytebuffer.js for details
 */o=[i(187)],void 0===(n="function"==typeof(r=function(e){"use strict";var t=function(e,i,o){if(void 0===e&&(e=t.DEFAULT_CAPACITY),void 0===i&&(i=t.DEFAULT_ENDIAN),void 0===o&&(o=t.DEFAULT_NOASSERT),!o){if((e|=0)<0)throw RangeError("Illegal capacity");i=!!i,o=!!o}this.buffer=0===e?r:new ArrayBuffer(e),this.view=0===e?null:new Uint8Array(this.buffer),this.offset=0,this.markedOffset=-1,this.limit=e,this.littleEndian=i,this.noAssert=o};t.VERSION="5.0.1",t.LITTLE_ENDIAN=!0,t.BIG_ENDIAN=!1,t.DEFAULT_CAPACITY=16,t.DEFAULT_ENDIAN=t.BIG_ENDIAN,t.DEFAULT_NOASSERT=!1,t.Long=e||null;var i=t.prototype;i.__isByteBuffer__,Object.defineProperty(i,"__isByteBuffer__",{value:!0,enumerable:!1,configurable:!1});var r=new ArrayBuffer(0),o=String.fromCharCode;function n(e){var t=0;return function(){return t<e.length?e.charCodeAt(t++):null}}function a(){var e=[],t=[];return function(){if(0===arguments.length)return t.join("")+o.apply(String,e);e.length+arguments.length>1024&&(t.push(o.apply(String,e)),e.length=0),Array.prototype.push.apply(e,arguments)}}function s(e,t,i,r,o){var n,a,s=8*o-r-1,l=(1<<s)-1,u=l>>1,h=-7,c=i?o-1:0,p=i?-1:1,d=e[t+c];for(c+=p,n=d&(1<<-h)-1,d>>=-h,h+=s;h>0;n=256*n+e[t+c],c+=p,h-=8);for(a=n&(1<<-h)-1,n>>=-h,h+=r;h>0;a=256*a+e[t+c],c+=p,h-=8);if(0===n)n=1-u;else{if(n===l)return a?NaN:1/0*(d?-1:1);a+=Math.pow(2,r),n-=u}return(d?-1:1)*a*Math.pow(2,n-r)}function l(e,t,i,r,o,n){var a,s,l,u=8*n-o-1,h=(1<<u)-1,c=h>>1,p=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:n-1,f=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=h):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),(t+=a+c>=1?p/l:p*Math.pow(2,1-c))*l>=2&&(a++,l/=2),a+c>=h?(s=0,a=h):a+c>=1?(s=(t*l-1)*Math.pow(2,o),a+=c):(s=t*Math.pow(2,c-1)*Math.pow(2,o),a=0));o>=8;e[i+d]=255&s,d+=f,s/=256,o-=8);for(a=a<<o|s,u+=o;u>0;e[i+d]=255&a,d+=f,a/=256,u-=8);e[i+d-f]|=128*g}t.accessor=function(){return Uint8Array},t.allocate=function(e,i,r){return new t(e,i,r)},t.concat=function(e,i,r,o){"boolean"!=typeof i&&"string"==typeof i||(o=r,r=i,i=void 0);for(var n,a=0,s=0,l=e.length;s<l;++s)t.isByteBuffer(e[s])||(e[s]=t.wrap(e[s],i)),(n=e[s].limit-e[s].offset)>0&&(a+=n);if(0===a)return new t(0,r,o);var u,h=new t(a,r,o);for(s=0;s<l;)(n=(u=e[s++]).limit-u.offset)<=0||(h.view.set(u.view.subarray(u.offset,u.limit),h.offset),h.offset+=n);return h.limit=h.offset,h.offset=0,h},t.isByteBuffer=function(e){return!0===(e&&e.__isByteBuffer__)},t.type=function(){return ArrayBuffer},t.wrap=function(e,r,o,n){if("string"!=typeof r&&(n=o,o=r,r=void 0),"string"==typeof e)switch(void 0===r&&(r="utf8"),r){case"base64":return t.fromBase64(e,o);case"hex":return t.fromHex(e,o);case"binary":return t.fromBinary(e,o);case"utf8":return t.fromUTF8(e,o);case"debug":return t.fromDebug(e,o);default:throw Error("Unsupported encoding: "+r)}if(null===e||"object"!=typeof e)throw TypeError("Illegal buffer");var a;if(t.isByteBuffer(e))return(a=i.clone.call(e)).markedOffset=-1,a;if(e instanceof Uint8Array)a=new t(0,o,n),e.length>0&&(a.buffer=e.buffer,a.offset=e.byteOffset,a.limit=e.byteOffset+e.byteLength,a.view=new Uint8Array(e.buffer));else if(e instanceof ArrayBuffer)a=new t(0,o,n),e.byteLength>0&&(a.buffer=e,a.offset=0,a.limit=e.byteLength,a.view=e.byteLength>0?new Uint8Array(e):null);else{if("[object Array]"!==Object.prototype.toString.call(e))throw TypeError("Illegal buffer");(a=new t(e.length,o,n)).limit=e.length;for(var s=0;s<e.length;++s)a.view[s]=e[s]}return a},i.writeBitSet=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if(!(e instanceof Array))throw TypeError("Illegal BitSet: Not an array");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var r,o=t,n=e.length,a=n>>3,s=0;for(t+=this.writeVarint32(n,t);a--;)r=1&!!e[s++]|(1&!!e[s++])<<1|(1&!!e[s++])<<2|(1&!!e[s++])<<3|(1&!!e[s++])<<4|(1&!!e[s++])<<5|(1&!!e[s++])<<6|(1&!!e[s++])<<7,this.writeByte(r,t++);if(s<n){var l=0;for(r=0;s<n;)r|=(1&!!e[s++])<<l++;this.writeByte(r,t++)}return i?(this.offset=t,this):t-o},i.readBitSet=function(e){var t=void 0===e;t&&(e=this.offset);var i,r=this.readVarint32(e),o=r.value,n=o>>3,a=0,s=[];for(e+=r.length;n--;)i=this.readByte(e++),s[a++]=!!(1&i),s[a++]=!!(2&i),s[a++]=!!(4&i),s[a++]=!!(8&i),s[a++]=!!(16&i),s[a++]=!!(32&i),s[a++]=!!(64&i),s[a++]=!!(128&i);if(a<o){var l=0;for(i=this.readByte(e++);a<o;)s[a++]=!!(i>>l++&1)}return t&&(this.offset=e),s},i.readBytes=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+e>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+"+e+") <= "+this.buffer.byteLength)}var r=this.slice(t,t+e);return i&&(this.offset+=e),r},i.writeBytes=i.append,i.writeInt8=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=1;var r=this.buffer.byteLength;return t>r&&this.resize((r*=2)>t?r:t),t-=1,this.view[t]=e,i&&(this.offset+=1),this},i.writeByte=i.writeInt8,i.readInt8=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var i=this.view[e];return 128==(128&i)&&(i=-(255-i+1)),t&&(this.offset+=1),i},i.readByte=i.readInt8,i.writeUint8=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=1;var r=this.buffer.byteLength;return t>r&&this.resize((r*=2)>t?r:t),t-=1,this.view[t]=e,i&&(this.offset+=1),this},i.writeUInt8=i.writeUint8,i.readUint8=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var i=this.view[e];return t&&(this.offset+=1),i},i.readUInt8=i.readUint8,i.writeInt16=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=2;var r=this.buffer.byteLength;return t>r&&this.resize((r*=2)>t?r:t),t-=2,this.littleEndian?(this.view[t+1]=(65280&e)>>>8,this.view[t]=255&e):(this.view[t]=(65280&e)>>>8,this.view[t+1]=255&e),i&&(this.offset+=2),this},i.writeShort=i.writeInt16,i.readInt16=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+2) <= "+this.buffer.byteLength)}var i=0;return this.littleEndian?(i=this.view[e],i|=this.view[e+1]<<8):(i=this.view[e]<<8,i|=this.view[e+1]),32768==(32768&i)&&(i=-(65535-i+1)),t&&(this.offset+=2),i},i.readShort=i.readInt16,i.writeUint16=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=2;var r=this.buffer.byteLength;return t>r&&this.resize((r*=2)>t?r:t),t-=2,this.littleEndian?(this.view[t+1]=(65280&e)>>>8,this.view[t]=255&e):(this.view[t]=(65280&e)>>>8,this.view[t+1]=255&e),i&&(this.offset+=2),this},i.writeUInt16=i.writeUint16,i.readUint16=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+2) <= "+this.buffer.byteLength)}var i=0;return this.littleEndian?(i=this.view[e],i|=this.view[e+1]<<8):(i=this.view[e]<<8,i|=this.view[e+1]),t&&(this.offset+=2),i},i.readUInt16=i.readUint16,i.writeInt32=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=4;var r=this.buffer.byteLength;return t>r&&this.resize((r*=2)>t?r:t),t-=4,this.littleEndian?(this.view[t+3]=e>>>24&255,this.view[t+2]=e>>>16&255,this.view[t+1]=e>>>8&255,this.view[t]=255&e):(this.view[t]=e>>>24&255,this.view[t+1]=e>>>16&255,this.view[t+2]=e>>>8&255,this.view[t+3]=255&e),i&&(this.offset+=4),this},i.writeInt=i.writeInt32,i.readInt32=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var i=0;return this.littleEndian?(i=this.view[e+2]<<16,i|=this.view[e+1]<<8,i|=this.view[e],i+=this.view[e+3]<<24>>>0):(i=this.view[e+1]<<16,i|=this.view[e+2]<<8,i|=this.view[e+3],i+=this.view[e]<<24>>>0),i|=0,t&&(this.offset+=4),i},i.readInt=i.readInt32,i.writeUint32=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=4;var r=this.buffer.byteLength;return t>r&&this.resize((r*=2)>t?r:t),t-=4,this.littleEndian?(this.view[t+3]=e>>>24&255,this.view[t+2]=e>>>16&255,this.view[t+1]=e>>>8&255,this.view[t]=255&e):(this.view[t]=e>>>24&255,this.view[t+1]=e>>>16&255,this.view[t+2]=e>>>8&255,this.view[t+3]=255&e),i&&(this.offset+=4),this},i.writeUInt32=i.writeUint32,i.readUint32=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var i=0;return this.littleEndian?(i=this.view[e+2]<<16,i|=this.view[e+1]<<8,i|=this.view[e],i+=this.view[e+3]<<24>>>0):(i=this.view[e+1]<<16,i|=this.view[e+2]<<8,i|=this.view[e+3],i+=this.view[e]<<24>>>0),t&&(this.offset+=4),i},i.readUInt32=i.readUint32,e&&(i.writeInt64=function(t,i){var r=void 0===i;if(r&&(i=this.offset),!this.noAssert){if("number"==typeof t)t=e.fromNumber(t);else if("string"==typeof t)t=e.fromString(t);else if(!(t&&t instanceof e))throw TypeError("Illegal value: "+t+" (not an integer or Long)");if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}"number"==typeof t?t=e.fromNumber(t):"string"==typeof t&&(t=e.fromString(t)),i+=8;var o=this.buffer.byteLength;i>o&&this.resize((o*=2)>i?o:i),i-=8;var n=t.low,a=t.high;return this.littleEndian?(this.view[i+3]=n>>>24&255,this.view[i+2]=n>>>16&255,this.view[i+1]=n>>>8&255,this.view[i]=255&n,i+=4,this.view[i+3]=a>>>24&255,this.view[i+2]=a>>>16&255,this.view[i+1]=a>>>8&255,this.view[i]=255&a):(this.view[i]=a>>>24&255,this.view[i+1]=a>>>16&255,this.view[i+2]=a>>>8&255,this.view[i+3]=255&a,i+=4,this.view[i]=n>>>24&255,this.view[i+1]=n>>>16&255,this.view[i+2]=n>>>8&255,this.view[i+3]=255&n),r&&(this.offset+=8),this},i.writeLong=i.writeInt64,i.readInt64=function(t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+8) <= "+this.buffer.byteLength)}var r=0,o=0;this.littleEndian?(r=this.view[t+2]<<16,r|=this.view[t+1]<<8,r|=this.view[t],r+=this.view[t+3]<<24>>>0,t+=4,o=this.view[t+2]<<16,o|=this.view[t+1]<<8,o|=this.view[t],o+=this.view[t+3]<<24>>>0):(o=this.view[t+1]<<16,o|=this.view[t+2]<<8,o|=this.view[t+3],o+=this.view[t]<<24>>>0,t+=4,r=this.view[t+1]<<16,r|=this.view[t+2]<<8,r|=this.view[t+3],r+=this.view[t]<<24>>>0);var n=new e(r,o,!1);return i&&(this.offset+=8),n},i.readLong=i.readInt64,i.writeUint64=function(t,i){var r=void 0===i;if(r&&(i=this.offset),!this.noAssert){if("number"==typeof t)t=e.fromNumber(t);else if("string"==typeof t)t=e.fromString(t);else if(!(t&&t instanceof e))throw TypeError("Illegal value: "+t+" (not an integer or Long)");if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}"number"==typeof t?t=e.fromNumber(t):"string"==typeof t&&(t=e.fromString(t)),i+=8;var o=this.buffer.byteLength;i>o&&this.resize((o*=2)>i?o:i),i-=8;var n=t.low,a=t.high;return this.littleEndian?(this.view[i+3]=n>>>24&255,this.view[i+2]=n>>>16&255,this.view[i+1]=n>>>8&255,this.view[i]=255&n,i+=4,this.view[i+3]=a>>>24&255,this.view[i+2]=a>>>16&255,this.view[i+1]=a>>>8&255,this.view[i]=255&a):(this.view[i]=a>>>24&255,this.view[i+1]=a>>>16&255,this.view[i+2]=a>>>8&255,this.view[i+3]=255&a,i+=4,this.view[i]=n>>>24&255,this.view[i+1]=n>>>16&255,this.view[i+2]=n>>>8&255,this.view[i+3]=255&n),r&&(this.offset+=8),this},i.writeUInt64=i.writeUint64,i.readUint64=function(t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+8) <= "+this.buffer.byteLength)}var r=0,o=0;this.littleEndian?(r=this.view[t+2]<<16,r|=this.view[t+1]<<8,r|=this.view[t],r+=this.view[t+3]<<24>>>0,t+=4,o=this.view[t+2]<<16,o|=this.view[t+1]<<8,o|=this.view[t],o+=this.view[t+3]<<24>>>0):(o=this.view[t+1]<<16,o|=this.view[t+2]<<8,o|=this.view[t+3],o+=this.view[t]<<24>>>0,t+=4,r=this.view[t+1]<<16,r|=this.view[t+2]<<8,r|=this.view[t+3],r+=this.view[t]<<24>>>0);var n=new e(r,o,!0);return i&&(this.offset+=8),n},i.readUInt64=i.readUint64),i.writeFloat32=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e)throw TypeError("Illegal value: "+e+" (not a number)");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=4;var r=this.buffer.byteLength;return t>r&&this.resize((r*=2)>t?r:t),t-=4,l(this.view,e,t,this.littleEndian,23,4),i&&(this.offset+=4),this},i.writeFloat=i.writeFloat32,i.readFloat32=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var i=s(this.view,e,this.littleEndian,23,4);return t&&(this.offset+=4),i},i.readFloat=i.readFloat32,i.writeFloat64=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof e)throw TypeError("Illegal value: "+e+" (not a number)");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=8;var r=this.buffer.byteLength;return t>r&&this.resize((r*=2)>t?r:t),t-=8,l(this.view,e,t,this.littleEndian,52,8),i&&(this.offset+=8),this},i.writeDouble=i.writeFloat64,i.readFloat64=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+8) <= "+this.buffer.byteLength)}var i=s(this.view,e,this.littleEndian,52,8);return t&&(this.offset+=8),i},i.readDouble=i.readFloat64,t.MAX_VARINT32_BYTES=5,t.calculateVarint32=function(e){return(e>>>=0)<128?1:e<16384?2:e<1<<21?3:e<1<<28?4:5},t.zigZagEncode32=function(e){return((e|=0)<<1^e>>31)>>>0},t.zigZagDecode32=function(e){return e>>>1^-(1&e)|0},i.writeVarint32=function(e,i){var r=void 0===i;if(r&&(i=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}var o,n=t.calculateVarint32(e);i+=n;var a=this.buffer.byteLength;for(i>a&&this.resize((a*=2)>i?a:i),i-=n,e>>>=0;e>=128;)o=127&e|128,this.view[i++]=o,e>>>=7;return this.view[i++]=e,r?(this.offset=i,this):n},i.writeVarint32ZigZag=function(e,i){return this.writeVarint32(t.zigZagEncode32(e),i)},i.readVarint32=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var i,r=0,o=0;do{if(!this.noAssert&&e>this.limit){var n=Error("Truncated");throw n.truncated=!0,n}i=this.view[e++],r<5&&(o|=(127&i)<<7*r),++r}while(0!=(128&i));return o|=0,t?(this.offset=e,o):{value:o,length:r}},i.readVarint32ZigZag=function(e){var i=this.readVarint32(e);return"object"==typeof i?i.value=t.zigZagDecode32(i.value):i=t.zigZagDecode32(i),i},e&&(t.MAX_VARINT64_BYTES=10,t.calculateVarint64=function(t){"number"==typeof t?t=e.fromNumber(t):"string"==typeof t&&(t=e.fromString(t));var i=t.toInt()>>>0,r=t.shiftRightUnsigned(28).toInt()>>>0,o=t.shiftRightUnsigned(56).toInt()>>>0;return 0==o?0==r?i<16384?i<128?1:2:i<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:o<128?9:10},t.zigZagEncode64=function(t){return"number"==typeof t?t=e.fromNumber(t,!1):"string"==typeof t?t=e.fromString(t,!1):!1!==t.unsigned&&(t=t.toSigned()),t.shiftLeft(1).xor(t.shiftRight(63)).toUnsigned()},t.zigZagDecode64=function(t){return"number"==typeof t?t=e.fromNumber(t,!1):"string"==typeof t?t=e.fromString(t,!1):!1!==t.unsigned&&(t=t.toSigned()),t.shiftRightUnsigned(1).xor(t.and(e.ONE).toSigned().negate()).toSigned()},i.writeVarint64=function(i,r){var o=void 0===r;if(o&&(r=this.offset),!this.noAssert){if("number"==typeof i)i=e.fromNumber(i);else if("string"==typeof i)i=e.fromString(i);else if(!(i&&i instanceof e))throw TypeError("Illegal value: "+i+" (not an integer or Long)");if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}"number"==typeof i?i=e.fromNumber(i,!1):"string"==typeof i?i=e.fromString(i,!1):!1!==i.unsigned&&(i=i.toSigned());var n=t.calculateVarint64(i),a=i.toInt()>>>0,s=i.shiftRightUnsigned(28).toInt()>>>0,l=i.shiftRightUnsigned(56).toInt()>>>0;r+=n;var u=this.buffer.byteLength;switch(r>u&&this.resize((u*=2)>r?u:r),r-=n,n){case 10:this.view[r+9]=l>>>7&1;case 9:this.view[r+8]=9!==n?128|l:127&l;case 8:this.view[r+7]=8!==n?s>>>21|128:s>>>21&127;case 7:this.view[r+6]=7!==n?s>>>14|128:s>>>14&127;case 6:this.view[r+5]=6!==n?s>>>7|128:s>>>7&127;case 5:this.view[r+4]=5!==n?128|s:127&s;case 4:this.view[r+3]=4!==n?a>>>21|128:a>>>21&127;case 3:this.view[r+2]=3!==n?a>>>14|128:a>>>14&127;case 2:this.view[r+1]=2!==n?a>>>7|128:a>>>7&127;case 1:this.view[r]=1!==n?128|a:127&a}return o?(this.offset+=n,this):n},i.writeVarint64ZigZag=function(e,i){return this.writeVarint64(t.zigZagEncode64(e),i)},i.readVarint64=function(t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var r=t,o=0,n=0,a=0,s=0;if(o=127&(s=this.view[t++]),128&s&&(o|=(127&(s=this.view[t++]))<<7,(128&s||this.noAssert&&void 0===s)&&(o|=(127&(s=this.view[t++]))<<14,(128&s||this.noAssert&&void 0===s)&&(o|=(127&(s=this.view[t++]))<<21,(128&s||this.noAssert&&void 0===s)&&(n=127&(s=this.view[t++]),(128&s||this.noAssert&&void 0===s)&&(n|=(127&(s=this.view[t++]))<<7,(128&s||this.noAssert&&void 0===s)&&(n|=(127&(s=this.view[t++]))<<14,(128&s||this.noAssert&&void 0===s)&&(n|=(127&(s=this.view[t++]))<<21,(128&s||this.noAssert&&void 0===s)&&(a=127&(s=this.view[t++]),(128&s||this.noAssert&&void 0===s)&&(a|=(127&(s=this.view[t++]))<<7,128&s||this.noAssert&&void 0===s))))))))))throw Error("Buffer overrun");var l=e.fromBits(o|n<<28,n>>>4|a<<24,!1);return i?(this.offset=t,l):{value:l,length:t-r}},i.readVarint64ZigZag=function(i){var r=this.readVarint64(i);return r&&r.value instanceof e?r.value=t.zigZagDecode64(r.value):r=t.zigZagDecode64(r),r}),i.writeCString=function(e,t){var i=void 0===t;i&&(t=this.offset);var r,o=e.length;if(!this.noAssert){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");for(r=0;r<o;++r)if(0===e.charCodeAt(r))throw RangeError("Illegal str: Contains NULL-characters");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}o=h.calculateUTF16asUTF8(n(e))[1],t+=o+1;var a=this.buffer.byteLength;return t>a&&this.resize((a*=2)>t?a:t),t-=o+1,h.encodeUTF16toUTF8(n(e),function(e){this.view[t++]=e}.bind(this)),this.view[t++]=0,i?(this.offset=t,this):o},i.readCString=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var i,r=e,o=-1;return h.decodeUTF8toUTF16(function(){if(0===o)return null;if(e>=this.limit)throw RangeError("Illegal range: Truncated data, "+e+" < "+this.limit);return 0===(o=this.view[e++])?null:o}.bind(this),i=a(),!0),t?(this.offset=e,i()):{string:i(),length:e-r}},i.writeIString=function(e,t){var i=void 0===t;if(i&&(t=this.offset),!this.noAssert){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var r,o=t;r=h.calculateUTF16asUTF8(n(e),this.noAssert)[1],t+=4+r;var a=this.buffer.byteLength;if(t>a&&this.resize((a*=2)>t?a:t),t-=4+r,this.littleEndian?(this.view[t+3]=r>>>24&255,this.view[t+2]=r>>>16&255,this.view[t+1]=r>>>8&255,this.view[t]=255&r):(this.view[t]=r>>>24&255,this.view[t+1]=r>>>16&255,this.view[t+2]=r>>>8&255,this.view[t+3]=255&r),t+=4,h.encodeUTF16toUTF8(n(e),function(e){this.view[t++]=e}.bind(this)),t!==o+4+r)throw RangeError("Illegal range: Truncated data, "+t+" == "+(t+4+r));return i?(this.offset=t,this):t-o},i.readIString=function(e){var i=void 0===e;if(i&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var r=e,o=this.readUint32(e),n=this.readUTF8String(o,t.METRICS_BYTES,e+=4);return e+=n.length,i?(this.offset=e,n.string):{string:n.string,length:e-r}},t.METRICS_CHARS="c",t.METRICS_BYTES="b",i.writeUTF8String=function(e,t){var i,r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var o=t;i=h.calculateUTF16asUTF8(n(e))[1],t+=i;var a=this.buffer.byteLength;return t>a&&this.resize((a*=2)>t?a:t),t-=i,h.encodeUTF16toUTF8(n(e),function(e){this.view[t++]=e}.bind(this)),r?(this.offset=t,this):t-o},i.writeString=i.writeUTF8String,t.calculateUTF8Chars=function(e){return h.calculateUTF16asUTF8(n(e))[0]},t.calculateUTF8Bytes=function(e){return h.calculateUTF16asUTF8(n(e))[1]},t.calculateString=t.calculateUTF8Bytes,i.readUTF8String=function(e,i,r){"number"==typeof i&&(r=i,i=void 0);var o=void 0===r;if(o&&(r=this.offset),void 0===i&&(i=t.METRICS_CHARS),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal length: "+e+" (not an integer)");if(e|=0,"number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}var n,s=0,l=r;if(i===t.METRICS_CHARS){if(n=a(),h.decodeUTF8(function(){return s<e&&r<this.limit?this.view[r++]:null}.bind(this),(function(e){++s,h.UTF8toUTF16(e,n)})),s!==e)throw RangeError("Illegal range: Truncated data, "+s+" == "+e);return o?(this.offset=r,n()):{string:n(),length:r-l}}if(i===t.METRICS_BYTES){if(!this.noAssert){if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+e>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+"+e+") <= "+this.buffer.byteLength)}var u=r+e;if(h.decodeUTF8toUTF16(function(){return r<u?this.view[r++]:null}.bind(this),n=a(),this.noAssert),r!==u)throw RangeError("Illegal range: Truncated data, "+r+" == "+u);return o?(this.offset=r,n()):{string:n(),length:r-l}}throw TypeError("Unsupported metrics: "+i)},i.readString=i.readUTF8String,i.writeVString=function(e,i){var r=void 0===i;if(r&&(i=this.offset),!this.noAssert){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}var o,a,s=i;o=h.calculateUTF16asUTF8(n(e),this.noAssert)[1],a=t.calculateVarint32(o),i+=a+o;var l=this.buffer.byteLength;if(i>l&&this.resize((l*=2)>i?l:i),i-=a+o,i+=this.writeVarint32(o,i),h.encodeUTF16toUTF8(n(e),function(e){this.view[i++]=e}.bind(this)),i!==s+o+a)throw RangeError("Illegal range: Truncated data, "+i+" == "+(i+o+a));return r?(this.offset=i,this):i-s},i.readVString=function(e){var i=void 0===e;if(i&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var r=e,o=this.readVarint32(e),n=this.readUTF8String(o.value,t.METRICS_BYTES,e+=o.length);return e+=n.length,i?(this.offset=e,n.string):{string:n.string,length:e-r}},i.append=function(e,i,r){"number"!=typeof i&&"string"==typeof i||(r=i,i=void 0);var o=void 0===r;if(o&&(r=this.offset),!this.noAssert){if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}e instanceof t||(e=t.wrap(e,i));var n=e.limit-e.offset;if(n<=0)return this;r+=n;var a=this.buffer.byteLength;return r>a&&this.resize((a*=2)>r?a:r),r-=n,this.view.set(e.view.subarray(e.offset,e.limit),r),e.offset+=n,o&&(this.offset+=n),this},i.appendTo=function(e,t){return e.append(this,t),this},i.assert=function(e){return this.noAssert=!e,this},i.capacity=function(){return this.buffer.byteLength},i.clear=function(){return this.offset=0,this.limit=this.buffer.byteLength,this.markedOffset=-1,this},i.clone=function(e){var i=new t(0,this.littleEndian,this.noAssert);return e?(i.buffer=new ArrayBuffer(this.buffer.byteLength),i.view=new Uint8Array(i.buffer)):(i.buffer=this.buffer,i.view=this.view),i.offset=this.offset,i.markedOffset=this.markedOffset,i.limit=this.limit,i},i.compact=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||e>t||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}if(0===e&&t===this.buffer.byteLength)return this;var i=t-e;if(0===i)return this.buffer=r,this.view=null,this.markedOffset>=0&&(this.markedOffset-=e),this.offset=0,this.limit=0,this;var o=new ArrayBuffer(i),n=new Uint8Array(o);return n.set(this.view.subarray(e,t)),this.buffer=o,this.view=n,this.markedOffset>=0&&(this.markedOffset-=e),this.offset=0,this.limit=i,this},i.copy=function(e,i){if(void 0===e&&(e=this.offset),void 0===i&&(i=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof i||i%1!=0)throw TypeError("Illegal end: Not an integer");if(i>>>=0,e<0||e>i||i>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+i+" <= "+this.buffer.byteLength)}if(e===i)return new t(0,this.littleEndian,this.noAssert);var r=i-e,o=new t(r,this.littleEndian,this.noAssert);return o.offset=0,o.limit=r,o.markedOffset>=0&&(o.markedOffset-=e),this.copyTo(o,0,e,i),o},i.copyTo=function(e,i,r,o){var n,a;if(!this.noAssert&&!t.isByteBuffer(e))throw TypeError("Illegal target: Not a ByteBuffer");if(i=(a=void 0===i)?e.offset:0|i,r=(n=void 0===r)?this.offset:0|r,o=void 0===o?this.limit:0|o,i<0||i>e.buffer.byteLength)throw RangeError("Illegal target range: 0 <= "+i+" <= "+e.buffer.byteLength);if(r<0||o>this.buffer.byteLength)throw RangeError("Illegal source range: 0 <= "+r+" <= "+this.buffer.byteLength);var s=o-r;return 0===s?e:(e.ensureCapacity(i+s),e.view.set(this.view.subarray(r,o),i),n&&(this.offset+=s),a&&(e.offset+=s),this)},i.ensureCapacity=function(e){var t=this.buffer.byteLength;return t<e?this.resize((t*=2)>e?t:e):this},i.fill=function(e,t,i){var r=void 0===t;if(r&&(t=this.offset),"string"==typeof e&&e.length>0&&(e=e.charCodeAt(0)),void 0===t&&(t=this.offset),void 0===i&&(i=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof i||i%1!=0)throw TypeError("Illegal end: Not an integer");if(i>>>=0,t<0||t>i||i>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+i+" <= "+this.buffer.byteLength)}if(t>=i)return this;for(;t<i;)this.view[t++]=e;return r&&(this.offset=t),this},i.flip=function(){return this.limit=this.offset,this.offset=0,this},i.mark=function(e){if(e=void 0===e?this.offset:e,!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}return this.markedOffset=e,this},i.order=function(e){if(!this.noAssert&&"boolean"!=typeof e)throw TypeError("Illegal littleEndian: Not a boolean");return this.littleEndian=!!e,this},i.LE=function(e){return this.littleEndian=void 0===e||!!e,this},i.BE=function(e){return this.littleEndian=void 0!==e&&!e,this},i.prepend=function(e,i,r){"number"!=typeof i&&"string"==typeof i||(r=i,i=void 0);var o=void 0===r;if(o&&(r=this.offset),!this.noAssert){if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}e instanceof t||(e=t.wrap(e,i));var n=e.limit-e.offset;if(n<=0)return this;var a=n-r;if(a>0){var s=new ArrayBuffer(this.buffer.byteLength+a),l=new Uint8Array(s);l.set(this.view.subarray(r,this.buffer.byteLength),n),this.buffer=s,this.view=l,this.offset+=a,this.markedOffset>=0&&(this.markedOffset+=a),this.limit+=a,r+=a}else new Uint8Array(this.buffer);return this.view.set(e.view.subarray(e.offset,e.limit),r-n),e.offset=e.limit,o&&(this.offset-=n),this},i.prependTo=function(e,t){return e.prepend(this,t),this},i.printDebug=function(e){"function"!=typeof e&&(e=console.log.bind(console)),e(this.toString()+"\n-------------------------------------------------------------------\n"+this.toDebug(!0))},i.remaining=function(){return this.limit-this.offset},i.reset=function(){return this.markedOffset>=0?(this.offset=this.markedOffset,this.markedOffset=-1):this.offset=0,this},i.resize=function(e){if(!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal capacity: "+e+" (not an integer)");if((e|=0)<0)throw RangeError("Illegal capacity: 0 <= "+e)}if(this.buffer.byteLength<e){var t=new ArrayBuffer(e),i=new Uint8Array(t);i.set(this.view),this.buffer=t,this.view=i}return this},i.reverse=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||e>t||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}return e===t||Array.prototype.reverse.call(this.view.subarray(e,t)),this},i.skip=function(e){if(!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal length: "+e+" (not an integer)");e|=0}var t=this.offset+e;if(!this.noAssert&&(t<0||t>this.buffer.byteLength))throw RangeError("Illegal length: 0 <= "+this.offset+" + "+e+" <= "+this.buffer.byteLength);return this.offset=t,this},i.slice=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||e>t||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}var i=this.clone();return i.offset=e,i.limit=t,i},i.toBuffer=function(e){var t=this.offset,i=this.limit;if(!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: Not an integer");if(t>>>=0,"number"!=typeof i||i%1!=0)throw TypeError("Illegal limit: Not an integer");if(i>>>=0,t<0||t>i||i>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+i+" <= "+this.buffer.byteLength)}if(!e&&0===t&&i===this.buffer.byteLength)return this.buffer;if(t===i)return r;var o=new ArrayBuffer(i-t);return new Uint8Array(o).set(new Uint8Array(this.buffer).subarray(t,i),0),o},i.toArrayBuffer=i.toBuffer,i.toString=function(e,t,i){if(void 0===e)return"ByteBufferAB(offset="+this.offset+",markedOffset="+this.markedOffset+",limit="+this.limit+",capacity="+this.capacity()+")";switch("number"==typeof e&&(i=t=e="utf8"),e){case"utf8":return this.toUTF8(t,i);case"base64":return this.toBase64(t,i);case"hex":return this.toHex(t,i);case"binary":return this.toBinary(t,i);case"debug":return this.toDebug();case"columns":return this.toColumns();default:throw Error("Unsupported encoding: "+e)}};var u=function(){for(var e={},t=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47],i=[],r=0,o=t.length;r<o;++r)i[t[r]]=r;return e.encode=function(e,i){for(var r,o;null!==(r=e());)i(t[r>>2&63]),o=(3&r)<<4,null!==(r=e())?(i(t[63&((o|=r>>4&15)|r>>4&15)]),o=(15&r)<<2,null!==(r=e())?(i(t[63&(o|r>>6&3)]),i(t[63&r])):(i(t[63&o]),i(61))):(i(t[63&o]),i(61),i(61))},e.decode=function(e,t){var r,o,n;function a(e){throw Error("Illegal character code: "+e)}for(;null!==(r=e());)if(void 0===(o=i[r])&&a(r),null!==(r=e())&&(void 0===(n=i[r])&&a(r),t(o<<2>>>0|(48&n)>>4),null!==(r=e()))){if(void 0===(o=i[r])){if(61===r)break;a(r)}if(t((15&n)<<4>>>0|(60&o)>>2),null!==(r=e())){if(void 0===(n=i[r])){if(61===r)break;a(r)}t((3&o)<<6>>>0|n)}}},e.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)},e}();i.toBase64=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),t|=0,(e|=0)<0||t>this.capacity||e>t)throw RangeError("begin, end");var i;return u.encode(function(){return e<t?this.view[e++]:null}.bind(this),i=a()),i()},t.fromBase64=function(e,i){if("string"!=typeof e)throw TypeError("str");var r=new t(e.length/4*3,i),o=0;return u.decode(n(e),(function(e){r.view[o++]=e})),r.limit=o,r},t.btoa=function(e){return t.fromBinary(e).toBase64()},t.atob=function(e){return t.fromBase64(e).toBinary()},i.toBinary=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),t|=0,(e|=0)<0||t>this.capacity()||e>t)throw RangeError("begin, end");if(e===t)return"";for(var i=[],r=[];e<t;)i.push(this.view[e++]),i.length>=1024&&(r.push(String.fromCharCode.apply(String,i)),i=[]);return r.join("")+String.fromCharCode.apply(String,i)},t.fromBinary=function(e,i){if("string"!=typeof e)throw TypeError("str");for(var r,o=0,n=e.length,a=new t(n,i);o<n;){if((r=e.charCodeAt(o))>255)throw RangeError("illegal char code: "+r);a.view[o++]=r}return a.limit=n,a},i.toDebug=function(e){for(var t,i=-1,r=this.buffer.byteLength,o="",n="",a="";i<r;){if(-1!==i&&(o+=(t=this.view[i])<16?"0"+t.toString(16).toUpperCase():t.toString(16).toUpperCase(),e&&(n+=t>32&&t<127?String.fromCharCode(t):".")),++i,e&&i>0&&i%16==0&&i!==r){for(;o.length<51;)o+=" ";a+=o+n+"\n",o=n=""}i===this.offset&&i===this.limit?o+=i===this.markedOffset?"!":"|":i===this.offset?o+=i===this.markedOffset?"[":"<":i===this.limit?o+=i===this.markedOffset?"]":">":o+=i===this.markedOffset?"'":e||0!==i&&i!==r?" ":""}if(e&&" "!==o){for(;o.length<51;)o+=" ";a+=o+n+"\n"}return e?a:o},t.fromDebug=function(e,i,r){for(var o,n,a=e.length,s=new t((a+1)/3|0,i,r),l=0,u=0,h=!1,c=!1,p=!1,d=!1,f=!1;l<a;){switch(o=e.charAt(l++)){case"!":if(!r){if(c||p||d){f=!0;break}c=p=d=!0}s.offset=s.markedOffset=s.limit=u,h=!1;break;case"|":if(!r){if(c||d){f=!0;break}c=d=!0}s.offset=s.limit=u,h=!1;break;case"[":if(!r){if(c||p){f=!0;break}c=p=!0}s.offset=s.markedOffset=u,h=!1;break;case"<":if(!r){if(c){f=!0;break}c=!0}s.offset=u,h=!1;break;case"]":if(!r){if(d||p){f=!0;break}d=p=!0}s.limit=s.markedOffset=u,h=!1;break;case">":if(!r){if(d){f=!0;break}d=!0}s.limit=u,h=!1;break;case"'":if(!r){if(p){f=!0;break}p=!0}s.markedOffset=u,h=!1;break;case" ":h=!1;break;default:if(!r&&h){f=!0;break}if(n=parseInt(o+e.charAt(l++),16),!r&&(isNaN(n)||n<0||n>255))throw TypeError("Illegal str: Not a debug encoded string");s.view[u++]=n,h=!0}if(f)throw TypeError("Illegal str: Invalid symbol at "+l)}if(!r){if(!c||!d)throw TypeError("Illegal str: Missing offset or limit");if(u<s.buffer.byteLength)throw TypeError("Illegal str: Not a debug encoded string (is it hex?) "+u+" < "+a)}return s},i.toHex=function(e,t){if(e=void 0===e?this.offset:e,t=void 0===t?this.limit:t,!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||e>t||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}for(var i,r=new Array(t-e);e<t;)(i=this.view[e++])<16?r.push("0",i.toString(16)):r.push(i.toString(16));return r.join("")},t.fromHex=function(e,i,r){if(!r){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");if(e.length%2!=0)throw TypeError("Illegal str: Length not a multiple of 2")}for(var o,n=e.length,a=new t(n/2|0,i),s=0,l=0;s<n;s+=2){if(o=parseInt(e.substring(s,s+2),16),!r&&(!isFinite(o)||o<0||o>255))throw TypeError("Illegal str: Contains non-hex characters");a.view[l++]=o}return a.limit=l,a};var h=function(){var e={MAX_CODEPOINT:1114111,encodeUTF8:function(e,t){var i=null;for("number"==typeof e&&(i=e,e=function(){return null});null!==i||null!==(i=e());)i<128?t(127&i):i<2048?(t(i>>6&31|192),t(63&i|128)):i<65536?(t(i>>12&15|224),t(i>>6&63|128),t(63&i|128)):(t(i>>18&7|240),t(i>>12&63|128),t(i>>6&63|128),t(63&i|128)),i=null},decodeUTF8:function(e,t){for(var i,r,o,n,a=function(e){e=e.slice(0,e.indexOf(null));var t=Error(e.toString());throw t.name="TruncatedError",t.bytes=e,t};null!==(i=e());)if(0==(128&i))t(i);else if(192==(224&i))null===(r=e())&&a([i,r]),t((31&i)<<6|63&r);else if(224==(240&i))(null===(r=e())||null===(o=e()))&&a([i,r,o]),t((15&i)<<12|(63&r)<<6|63&o);else{if(240!=(248&i))throw RangeError("Illegal starting byte: "+i);(null===(r=e())||null===(o=e())||null===(n=e()))&&a([i,r,o,n]),t((7&i)<<18|(63&r)<<12|(63&o)<<6|63&n)}},UTF16toUTF8:function(e,t){for(var i,r=null;null!==(i=null!==r?r:e());)i>=55296&&i<=57343&&null!==(r=e())&&r>=56320&&r<=57343?(t(1024*(i-55296)+r-56320+65536),r=null):t(i);null!==r&&t(r)},UTF8toUTF16:function(e,t){var i=null;for("number"==typeof e&&(i=e,e=function(){return null});null!==i||null!==(i=e());)i<=65535?t(i):(t(55296+((i-=65536)>>10)),t(i%1024+56320)),i=null},encodeUTF16toUTF8:function(t,i){e.UTF16toUTF8(t,(function(t){e.encodeUTF8(t,i)}))},decodeUTF8toUTF16:function(t,i){e.decodeUTF8(t,(function(t){e.UTF8toUTF16(t,i)}))},calculateCodePoint:function(e){return e<128?1:e<2048?2:e<65536?3:4},calculateUTF8:function(e){for(var t,i=0;null!==(t=e());)i+=t<128?1:t<2048?2:t<65536?3:4;return i},calculateUTF16asUTF8:function(t){var i=0,r=0;return e.UTF16toUTF8(t,(function(e){++i,r+=e<128?1:e<2048?2:e<65536?3:4})),[i,r]}};return e}();return i.toUTF8=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||e>t||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}var i;try{h.decodeUTF8toUTF16(function(){return e<t?this.view[e++]:null}.bind(this),i=a())}catch(i){if(e!==t)throw RangeError("Illegal range: Truncated data, "+e+" != "+t)}return i()},t.fromUTF8=function(e,i,r){if(!r&&"string"!=typeof e)throw TypeError("Illegal str: Not a string");var o=new t(h.calculateUTF16asUTF8(n(e),!0)[1],i,r),a=0;return h.encodeUTF16toUTF8(n(e),(function(e){o.view[a++]=e})),o.limit=a,o},t})?r.apply(t,o):r)||(e.exports=n)},function(e,t){(function(t){e.exports=t}).call(this,{})},function(e,t,i){(function(e){function i(e,t){for(var i=0,r=e.length-1;r>=0;r--){var o=e[r];"."===o?e.splice(r,1):".."===o?(e.splice(r,1),i++):i&&(e.splice(r,1),i--)}if(t)for(;i--;i)e.unshift("..");return e}function r(e,t){if(e.filter)return e.filter(t);for(var i=[],r=0;r<e.length;r++)t(e[r],r,e)&&i.push(e[r]);return i}t.resolve=function(){for(var t="",o=!1,n=arguments.length-1;n>=-1&&!o;n--){var a=n>=0?arguments[n]:e.cwd();if("string"!=typeof a)throw new TypeError("Arguments to path.resolve must be strings");a&&(t=a+"/"+t,o="/"===a.charAt(0))}return(o?"/":"")+(t=i(r(t.split("/"),(function(e){return!!e})),!o).join("/"))||"."},t.normalize=function(e){var n=t.isAbsolute(e),a="/"===o(e,-1);return(e=i(r(e.split("/"),(function(e){return!!e})),!n).join("/"))||n||(e="."),e&&a&&(e+="/"),(n?"/":"")+e},t.isAbsolute=function(e){return"/"===e.charAt(0)},t.join=function(){var e=Array.prototype.slice.call(arguments,0);return t.normalize(r(e,(function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e})).join("/"))},t.relative=function(e,i){function r(e){for(var t=0;t<e.length&&""===e[t];t++);for(var i=e.length-1;i>=0&&""===e[i];i--);return t>i?[]:e.slice(t,i-t+1)}e=t.resolve(e).substr(1),i=t.resolve(i).substr(1);for(var o=r(e.split("/")),n=r(i.split("/")),a=Math.min(o.length,n.length),s=a,l=0;l<a;l++)if(o[l]!==n[l]){s=l;break}var u=[];for(l=s;l<o.length;l++)u.push("..");return(u=u.concat(n.slice(s))).join("/")},t.sep="/",t.delimiter=":",t.dirname=function(e){if("string"!=typeof e&&(e+=""),0===e.length)return".";for(var t=e.charCodeAt(0),i=47===t,r=-1,o=!0,n=e.length-1;n>=1;--n)if(47===(t=e.charCodeAt(n))){if(!o){r=n;break}}else o=!1;return-1===r?i?"/":".":i&&1===r?"/":e.slice(0,r)},t.basename=function(e,t){var i=function(e){"string"!=typeof e&&(e+="");var t,i=0,r=-1,o=!0;for(t=e.length-1;t>=0;--t)if(47===e.charCodeAt(t)){if(!o){i=t+1;break}}else-1===r&&(o=!1,r=t+1);return-1===r?"":e.slice(i,r)}(e);return t&&i.substr(-1*t.length)===t&&(i=i.substr(0,i.length-t.length)),i},t.extname=function(e){"string"!=typeof e&&(e+="");for(var t=-1,i=0,r=-1,o=!0,n=0,a=e.length-1;a>=0;--a){var s=e.charCodeAt(a);if(47!==s)-1===r&&(o=!1,r=a+1),46===s?-1===t?t=a:1!==n&&(n=1):-1!==t&&(n=-1);else if(!o){i=a+1;break}}return-1===t||-1===r||0===n||1===n&&t===r-1&&t===i+1?"":e.slice(t,r)};var o="b"==="ab".substr(-1)?function(e,t,i){return e.substr(t,i)}:function(e,t,i){return t<0&&(t=e.length+t),e.substr(t,i)}}).call(this,i(94))},function(e,t,i){for(var r,o=i(13),n=i(20),a=i(40),s=a("typed_array"),l=a("view"),u=!(!o.ArrayBuffer||!o.DataView),h=u,c=0,p="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");c<9;)(r=o[p[c++]])?(n(r.prototype,s,!0),n(r.prototype,l,!0)):h=!1;e.exports={ABV:u,CONSTR:h,TYPED:s,VIEW:l}},function(e,t,i){var r=i(23);e.exports=function(e,t,i){for(var o in t)r(e,o,t[o],i);return e}},function(e,t){e.exports=function(e,t,i,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(i+": incorrect invocation!");return e}},function(e,t,i){var r=i(27),o=i(17);e.exports=function(e){if(void 0===e)return 0;var t=r(e),i=o(t);if(t!==i)throw RangeError("Wrong length!");return i}},function(e,t,i){"use strict";var r=i(13),o=i(21),n=i(14),a=i(7)("species");e.exports=function(e){var t=r[e];n&&t&&!t[a]&&o.f(t,a,{configurable:!0,get:function(){return this}})}},function(e,t,i){"use strict";var r=i(22),o=i(17),n=i(129),a="".endsWith;r(r.P+r.F*i(130)("endsWith"),"String",{endsWith:function(e){var t=n(this,e,"endsWith"),i=arguments.length>1?arguments[1]:void 0,r=o(t.length),s=void 0===i?r:Math.min(o(i),r),l=String(e);return a?a.call(t,l,s):t.slice(s-l.length,s)===l}})},function(e,t,i){var r=i(78),o=i(26);e.exports=function(e,t,i){if(r(t))throw TypeError("String#"+i+" doesn't accept regex!");return String(o(e))}},function(e,t,i){var r=i(7)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(i){try{return t[r]=!1,!"/./"[e](t)}catch(e){}}return!0}},function(e,t,i){"use strict";var r=i(22),o=i(17),n=i(129),a="".startsWith;r(r.P+r.F*i(130)("startsWith"),"String",{startsWith:function(e){var t=n(this,e,"startsWith"),i=o(Math.min(arguments.length>1?arguments[1]:void 0,t.length)),r=String(e);return a?a.call(t,r,i):t.slice(i,i+r.length)===r}})},function(e,t,i){var r=i(42),o=i(15)("toStringTag"),n="Arguments"==r(function(){return arguments}());e.exports=function(e){var t,i,a;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(i=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),o))?i:n?r(t):"Object"==(a=r(t))&&"function"==typeof t.callee?"Arguments":a}},function(e,t,i){var r=i(29),o=i(56),n=i(15)("species");e.exports=function(e,t){var i,a=r(e).constructor;return void 0===a||null==(i=r(a)[n])?t:o(i)}},function(e,t,i){var r,o,n,a=i(55),s=i(221),l=i(110),u=i(75),h=i(8),c=h.process,p=h.setImmediate,d=h.clearImmediate,f=h.MessageChannel,g=h.Dispatch,m=0,_={},v=function(){var e=+this;if(_.hasOwnProperty(e)){var t=_[e];delete _[e],t()}},C=function(e){v.call(e.data)};p&&d||(p=function(e){for(var t=[],i=1;arguments.length>i;)t.push(arguments[i++]);return _[++m]=function(){s("function"==typeof e?e:Function(e),t)},r(m),m},d=function(e){delete _[e]},"process"==i(42)(c)?r=function(e){c.nextTick(a(v,e,1))}:g&&g.now?r=function(e){g.now(a(v,e,1))}:f?(n=(o=new f).port2,o.port1.onmessage=C,r=a(n.postMessage,n,1)):h.addEventListener&&"function"==typeof postMessage&&!h.importScripts?(r=function(e){h.postMessage(e+"","*")},h.addEventListener("message",C,!1)):r="onreadystatechange"in u("script")?function(e){l.appendChild(u("script")).onreadystatechange=function(){l.removeChild(this),v.call(e)}}:function(e){setTimeout(a(v,e,1),0)}),e.exports={set:p,clear:d}},function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},function(e,t,i){var r=i(29),o=i(33),n=i(92);e.exports=function(e,t){if(r(e),o(t)&&t.constructor===e)return t;var i=n.f(e);return(0,i.resolve)(t),i.promise}},function(e,t,i){"use strict";var r=i(18),o=i(17),n=i(79),a=i(58);i(61)("match",1,(function(e,t,i,s){return[function(i){var r=e(this),o=null==i?void 0:i[t];return void 0!==o?o.call(i,r):new RegExp(i)[t](String(r))},function(e){var t=s(i,e,this);if(t.done)return t.value;var l=r(e),u=String(this);if(!l.global)return a(l,u);var h=l.unicode;l.lastIndex=0;for(var c,p=[],d=0;null!==(c=a(l,u));){var f=String(c[0]);p[d]=f,""===f&&(l.lastIndex=n(u,o(l.lastIndex),h)),d++}return 0===d?null:p}]}))},function(e,t,i){var r=i(13),o=i(139),n=i(21).f,a=i(63).f,s=i(78),l=i(60),u=r.RegExp,h=u,c=u.prototype,p=/a/g,d=/a/g,f=new u(p)!==p;if(i(14)&&(!f||i(19)((function(){return d[i(7)("match")]=!1,u(p)!=p||u(d)==d||"/a/i"!=u(p,"i")})))){u=function(e,t){var i=this instanceof u,r=s(e),n=void 0===t;return!i&&r&&e.constructor===u&&n?e:o(f?new h(r&&!n?e.source:e,t):h((r=e instanceof u)?e.source:e,r&&n?l.call(e):t),i?this:c,u)};for(var g=function(e){e in u||n(u,e,{configurable:!0,get:function(){return h[e]},set:function(t){h[e]=t}})},m=a(h),_=0;m.length>_;)g(m[_++]);c.constructor=u,u.prototype=c,i(23)(r,"RegExp",u)}i(127)("RegExp")},function(e,t,i){var r=i(25),o=i(230).set;e.exports=function(e,t,i){var n,a=t.constructor;return a!==i&&"function"==typeof a&&(n=a.prototype)!==i.prototype&&r(n)&&o&&o(e,n),e}},function(e,t,i){"use strict";var r=i(13),o=i(30),n=i(41),a=i(139),s=i(47),l=i(19),u=i(63).f,h=i(91).f,c=i(21).f,p=i(231).trim,d=r.Number,f=d,g=d.prototype,m="Number"==n(i(66)(g)),_="trim"in String.prototype,v=function(e){var t=s(e,!1);if("string"==typeof t&&t.length>2){var i,r,o,n=(t=_?t.trim():p(t,3)).charCodeAt(0);if(43===n||45===n){if(88===(i=t.charCodeAt(2))||120===i)return NaN}else if(48===n){switch(t.charCodeAt(1)){case 66:case 98:r=2,o=49;break;case 79:case 111:r=8,o=55;break;default:return+t}for(var a,l=t.slice(2),u=0,h=l.length;u<h;u++)if((a=l.charCodeAt(u))<48||a>o)return NaN;return parseInt(l,r)}}return+t};if(!d(" 0o1")||!d("0b1")||d("+0x1")){d=function(e){var t=arguments.length<1?0:e,i=this;return i instanceof d&&(m?l((function(){g.valueOf.call(i)})):"Number"!=n(i))?a(new f(v(t)),i,d):v(t)};for(var C,y=i(14)?u(f):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),A=0;y.length>A;A++)o(f,C=y[A])&&!o(d,C)&&c(d,C,h(f,C));d.prototype=g,g.constructor=d,i(23)(r,"Number",d)}},function(e,t,i){e.exports=i(192)},function(e,t,i){e.exports=i(214)},function(e,t,i){"use strict";(function(e,t){var r=i(11),o=i.n(r),n=(i(64),i(39),i(4)),a=i.n(n),s=i(6),l=i.n(s),u=(i(77),i(16)),h=i.n(u),c=(i(82),i(83),i(84),i(12)),p=i.n(c),d=i(2),f=i.n(d),g=i(0),m=i.n(g),_=(i(86),i(1)),v=i.n(_);!function(e,r){var o=i(120);window.dcodeIO=window.dcodeIO||{},window.dcodeIO.ByteBuffer=o,"function"==typeof define&&i(121)?define(["bytebuffer"],r):"object"===v()(t)&&t&&t.exports?t.exports=r(i(120),!0):(e.dcodeIO=e.dcodeIO||{}).ProtoBuf=r(e.dcodeIO.ByteBuffer)}(window,(function(t,r){var n,s={};return s.ByteBuffer=t,s.Long=t.Long||null,s.VERSION="5.0.1",s.WIRE_TYPES={},s.WIRE_TYPES.VARINT=0,s.WIRE_TYPES.BITS64=1,s.WIRE_TYPES.LDELIM=2,s.WIRE_TYPES.STARTGROUP=3,s.WIRE_TYPES.ENDGROUP=4,s.WIRE_TYPES.BITS32=5,s.PACKABLE_WIRE_TYPES=[s.WIRE_TYPES.VARINT,s.WIRE_TYPES.BITS64,s.WIRE_TYPES.BITS32],s.TYPES={int32:{name:"int32",wireType:s.WIRE_TYPES.VARINT,defaultValue:0},uint32:{name:"uint32",wireType:s.WIRE_TYPES.VARINT,defaultValue:0},sint32:{name:"sint32",wireType:s.WIRE_TYPES.VARINT,defaultValue:0},int64:{name:"int64",wireType:s.WIRE_TYPES.VARINT,defaultValue:s.Long?s.Long.ZERO:void 0},uint64:{name:"uint64",wireType:s.WIRE_TYPES.VARINT,defaultValue:s.Long?s.Long.UZERO:void 0},sint64:{name:"sint64",wireType:s.WIRE_TYPES.VARINT,defaultValue:s.Long?s.Long.ZERO:void 0},bool:{name:"bool",wireType:s.WIRE_TYPES.VARINT,defaultValue:!1},double:{name:"double",wireType:s.WIRE_TYPES.BITS64,defaultValue:0},string:{name:"string",wireType:s.WIRE_TYPES.LDELIM,defaultValue:""},bytes:{name:"bytes",wireType:s.WIRE_TYPES.LDELIM,defaultValue:null},fixed32:{name:"fixed32",wireType:s.WIRE_TYPES.BITS32,defaultValue:0},sfixed32:{name:"sfixed32",wireType:s.WIRE_TYPES.BITS32,defaultValue:0},fixed64:{name:"fixed64",wireType:s.WIRE_TYPES.BITS64,defaultValue:s.Long?s.Long.UZERO:void 0},sfixed64:{name:"sfixed64",wireType:s.WIRE_TYPES.BITS64,defaultValue:s.Long?s.Long.ZERO:void 0},float:{name:"float",wireType:s.WIRE_TYPES.BITS32,defaultValue:0},enum:{name:"enum",wireType:s.WIRE_TYPES.VARINT,defaultValue:0},message:{name:"message",wireType:s.WIRE_TYPES.LDELIM,defaultValue:null},group:{name:"group",wireType:s.WIRE_TYPES.STARTGROUP,defaultValue:null}},s.MAP_KEY_TYPES=[s.TYPES.int32,s.TYPES.sint32,s.TYPES.sfixed32,s.TYPES.uint32,s.TYPES.fixed32,s.TYPES.int64,s.TYPES.sint64,s.TYPES.sfixed64,s.TYPES.uint64,s.TYPES.fixed64,s.TYPES.bool,s.TYPES.string,s.TYPES.bytes],s.ID_MIN=1,s.ID_MAX=536870911,s.convertFieldsToCamelCase=!1,s.populateAccessors=!0,s.populateDefaults=!0,s.Util=((n={}).IS_NODE=!("object"!==(void 0===e?"undefined":v()(e))||"[object process]"!=e+""||e.browser),n.XHR=function(){for(var e=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],t=null,i=0;i<e.length;i++){try{t=e[i]()}catch(e){continue}break}if(!t)throw Error("XMLHttpRequest is not supported");return t},n.fetch=function(e,t){if(t&&"function"!=typeof t&&(t=null),n.IS_NODE){var r=i(188);if(t)r.readFile(e,(function(e,i){t(e?null:""+i)}));else try{return r.readFileSync(e)}catch(e){return null}}else{var o=n.XHR();if(o.open("GET",e,!!t),o.setRequestHeader("Accept","text/plain"),"function"==typeof o.overrideMimeType&&o.overrideMimeType("text/plain"),!t)return o.send(null),200==o.status||0==o.status&&"string"==typeof o.responseText?o.responseText:null;o.onreadystatechange=function(){4==o.readyState&&(200==o.status||0==o.status&&"string"==typeof o.responseText?t(o.responseText):t(null))},4!=o.readyState&&o.send(null)}},n.toCamelCase=function(e){return e.replace(/_([a-zA-Z])/g,(function(e,t){return t.toUpperCase()}))},n),s.Lang={DELIM:/[\s\{\}=;:\[\],'"\(\)<>]/g,RULE:/^(?:required|optional|repeated|map)$/,TYPE:/^(?:double|float|int32|uint32|sint32|int64|uint64|sint64|fixed32|sfixed32|fixed64|sfixed64|bool|string|bytes)$/,NAME:/^[a-zA-Z_][a-zA-Z_0-9]*$/,TYPEDEF:/^[a-zA-Z][a-zA-Z_0-9]*$/,TYPEREF:/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)+$/,FQTYPEREF:/^(?:\.[a-zA-Z][a-zA-Z_0-9]*)+$/,NUMBER:/^-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+|([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?)|inf|nan)$/,NUMBER_DEC:/^(?:[1-9][0-9]*|0)$/,NUMBER_HEX:/^0[xX][0-9a-fA-F]+$/,NUMBER_OCT:/^0[0-7]+$/,NUMBER_FLT:/^([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?|inf|nan)$/,BOOL:/^(?:true|false)$/i,ID:/^(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,NEGID:/^\-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,WHITESPACE:/\s/,STRING:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")|(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,STRING_DQ:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,STRING_SQ:/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g},s.DotProto=function(e,t){function i(e,i){var r=-1,o=1;if("-"==e.charAt(0)&&(o=-1,e=e.substring(1)),t.NUMBER_DEC.test(e))r=m()(e);else if(t.NUMBER_HEX.test(e))r=m()(e.substring(2),16);else{if(!t.NUMBER_OCT.test(e))throw Error("illegal id value: "+(0>o?"-":"")+e);r=m()(e.substring(1),8)}if(r=o*r|0,!i&&0>r)throw Error("illegal id value: "+(0>o?"-":"")+e);return r}function r(e){var i=1;if("-"==e.charAt(0)&&(i=-1,e=e.substring(1)),t.NUMBER_DEC.test(e))return i*m()(e,10);if(t.NUMBER_HEX.test(e))return i*m()(e.substring(2),16);if(t.NUMBER_OCT.test(e))return i*m()(e.substring(1),8);if("inf"===e)return 1/0*i;if("nan"===e)return NaN;if(t.NUMBER_FLT.test(e))return i*f()(e);throw Error("illegal number value: "+(0>i?"-":"")+e)}function o(e,t,i){void 0===e[t]?e[t]=i:(p()(e[t])||(e[t]=[e[t]]),e[t].push(i))}var n={},a=function(e){this.source=e+"",this.index=0,this.line=1,this.stack=[],this._stringOpen=null};(s=a.prototype)._readString=function(){var e='"'===this._stringOpen?t.STRING_DQ:t.STRING_SQ;e.lastIndex=this.index-1;var i=e.exec(this.source);if(!i)throw Error("unterminated string");return this.index=e.lastIndex,this.stack.push(this._stringOpen),this._stringOpen=null,i[1]},s.next=function(){if(0<this.stack.length)return this.stack.shift();if(this.index>=this.source.length)return null;if(null!==this._stringOpen)return this._readString();var e,i;do{for(e=!1;t.WHITESPACE.test(i=this.source.charAt(this.index));)if("\n"===i&&++this.line,++this.index===this.source.length)return null;if("/"===this.source.charAt(this.index))if(++this.index,"/"===this.source.charAt(this.index)){for(;"\n"!==this.source.charAt(++this.index);)if(this.index==this.source.length)return null;++this.index,++this.line,e=!0}else{if("*"!==(i=this.source.charAt(this.index)))return"/";do{if("\n"===i&&++this.line,++this.index===this.source.length)return null;e=i,i=this.source.charAt(this.index)}while("*"!==e||"/"!==i);++this.index,e=!0}}while(e);if(this.index===this.source.length)return null;if(i=this.index,t.DELIM.lastIndex=0,!t.DELIM.test(this.source.charAt(i++)))for(;i<this.source.length&&!t.DELIM.test(this.source.charAt(i));)++i;return'"'!==(i=this.source.substring(this.index,this.index=i))&&"'"!==i||(this._stringOpen=i),i},s.peek=function(){if(0===this.stack.length){var e=this.next();if(null===e)return null;this.stack.push(e)}return this.stack[0]},s.skip=function(e){var t=this.next();if(t!==e)throw Error("illegal '"+t+"', '"+e+"' expected")},s.omit=function(e){return this.peek()===e&&(this.next(),!0)},s.toString=function(){return"Tokenizer ("+this.index+"/"+this.source.length+" at line "+this.line+")"},n.Tokenizer=a;var s,l=function(e){this.tn=new a(e),this.proto3=!1};return(s=l.prototype).parse=function(){var e,i,r={name:"[ROOT]",package:null,messages:[],enums:[],imports:[],options:{},services:[]},o=!0;try{for(;e=this.tn.next();)switch(e){case"package":if(!o||null!==r.package)throw Error("unexpected 'package'");if(e=this.tn.next(),!t.TYPEREF.test(e))throw Error("illegal package name: "+e);this.tn.skip(";"),r.package=e;break;case"import":if(!o)throw Error("unexpected 'import'");("public"===(e=this.tn.peek())||(i="weak"===e))&&this.tn.next(),e=this._readString(),this.tn.skip(";"),i||r.imports.push(e);break;case"syntax":if(!o)throw Error("unexpected 'syntax'");this.tn.skip("="),"proto3"===(r.syntax=this._readString())&&(this.proto3=!0),this.tn.skip(";");break;case"message":this._parseMessage(r,null),o=!1;break;case"enum":this._parseEnum(r),o=!1;break;case"option":this._parseOption(r);break;case"service":this._parseService(r);break;case"extend":this._parseExtend(r);break;default:throw Error("unexpected '"+e+"'")}}catch(e){throw e.message="Parse error at line "+this.tn.line+": "+e.message,e}return delete r.name,r},l.parse=function(e){return new l(e).parse()},s._readString=function(){var e,t="";do{if("'"!==(e=this.tn.next())&&'"'!==e)throw Error("illegal string delimiter: "+e);t+=this.tn.next(),this.tn.skip(e),e=this.tn.peek()}while('"'===e||'"'===e);return t},s._readValue=function(e){var i=this.tn.peek();if('"'===i||"'"===i)return this._readString();if(this.tn.next(),t.NUMBER.test(i))return r(i);if(t.BOOL.test(i))return"true"===i.toLowerCase();if(e&&t.TYPEREF.test(i))return i;throw Error("illegal value: "+i)},s._parseOption=function(e,i){var r=this.tn.next(),o=!1;if("("===r&&(o=!0,r=this.tn.next()),!t.TYPEREF.test(r))throw Error("illegal option name: "+r);var n=r;o&&(this.tn.skip(")"),n="("+n+")",r=this.tn.peek(),t.FQTYPEREF.test(r)&&(n+=r,this.tn.next())),this.tn.skip("="),this._parseOptionValue(e,n),i||this.tn.skip(";")},s._parseOptionValue=function(e,i){var r=this.tn.peek();if("{"!==r)o(e.options,i,this._readValue(!0));else for(this.tn.skip("{");"}"!==(r=this.tn.next());){if(!t.NAME.test(r))throw Error("illegal option name: "+i+"."+r);this.tn.omit(":")?o(e.options,i+"."+r,this._readValue(!0)):this._parseOptionValue(e,i+"."+r)}},s._parseService=function(e){var i=this.tn.next();if(!t.NAME.test(i))throw Error("illegal service name at line "+this.tn.line+": "+i);var r={name:i,rpc:{},options:{}};for(this.tn.skip("{");"}"!==(i=this.tn.next());)if("option"===i)this._parseOption(r);else{if("rpc"!==i)throw Error("illegal service token: "+i);this._parseServiceRPC(r)}this.tn.omit(";"),e.services.push(r)},s._parseServiceRPC=function(e){var i=this.tn.next();if(!t.NAME.test(i))throw Error("illegal rpc service method name: "+i);var r=i,o={request:null,response:null,request_stream:!1,response_stream:!1,options:{}};if(this.tn.skip("("),"stream"===(i=this.tn.next()).toLowerCase()&&(o.request_stream=!0,i=this.tn.next()),!t.TYPEREF.test(i))throw Error("illegal rpc service request type: "+i);if(o.request=i,this.tn.skip(")"),"returns"!==(i=this.tn.next()).toLowerCase())throw Error("illegal rpc service request type delimiter: "+i);if(this.tn.skip("("),"stream"===(i=this.tn.next()).toLowerCase()&&(o.response_stream=!0,i=this.tn.next()),o.response=i,this.tn.skip(")"),"{"===(i=this.tn.peek())){for(this.tn.next();"}"!==(i=this.tn.next());){if("option"!==i)throw Error("illegal rpc service token: "+i);this._parseOption(o)}this.tn.omit(";")}else this.tn.skip(";");void 0===e.rpc&&(e.rpc={}),e.rpc[r]=o},s._parseMessage=function(e,r){var o=!!r,n=this.tn.next(),a={name:"",fields:[],enums:[],messages:[],options:{},services:[],oneofs:{}};if(!t.NAME.test(n))throw Error("illegal "+(o?"group":"message")+" name: "+n);for(a.name=n,o&&(this.tn.skip("="),r.id=i(this.tn.next()),a.isGroup=!0),"["===(n=this.tn.peek())&&r&&this._parseFieldOptions(r),this.tn.skip("{");"}"!==(n=this.tn.next());)if(t.RULE.test(n))this._parseMessageField(a,n);else if("oneof"===n)this._parseMessageOneOf(a);else if("enum"===n)this._parseEnum(a);else if("message"===n)this._parseMessage(a);else if("option"===n)this._parseOption(a);else if("service"===n)this._parseService(a);else if("extensions"===n)a.hasOwnProperty("extensions")?a.extensions=a.extensions.concat(this._parseExtensionRanges()):a.extensions=this._parseExtensionRanges();else if("reserved"===n)this._parseIgnored();else if("extend"===n)this._parseExtend(a);else{if(!t.TYPEREF.test(n))throw Error("illegal message token: "+n);if(!this.proto3)throw Error("illegal field rule: "+n);this._parseMessageField(a,"optional",n)}return this.tn.omit(";"),e.messages.push(a),a},s._parseIgnored=function(){for(;";"!==this.tn.peek();)this.tn.next();this.tn.skip(";")},s._parseMessageField=function(e,r,o){if(!t.RULE.test(r))throw Error("illegal message field rule: "+r);var n={rule:r,type:"",name:"",options:{},id:0};if("map"===r){if(o)throw Error("illegal type: "+o);if(this.tn.skip("<"),r=this.tn.next(),!t.TYPE.test(r)&&!t.TYPEREF.test(r))throw Error("illegal message field type: "+r);if(n.keytype=r,this.tn.skip(","),r=this.tn.next(),!t.TYPE.test(r)&&!t.TYPEREF.test(r))throw Error("illegal message field: "+r);if(n.type=r,this.tn.skip(">"),r=this.tn.next(),!t.NAME.test(r))throw Error("illegal message field name: "+r);n.name=r,this.tn.skip("="),n.id=i(this.tn.next()),"["===(r=this.tn.peek())&&this._parseFieldOptions(n),this.tn.skip(";")}else if("group"===(o=void 0!==o?o:this.tn.next())){if(r=this._parseMessage(e,n),!/^[A-Z]/.test(r.name))throw Error("illegal group name: "+r.name);n.type=r.name,n.name=r.name.toLowerCase(),this.tn.omit(";")}else{if(!t.TYPE.test(o)&&!t.TYPEREF.test(o))throw Error("illegal message field type: "+o);if(n.type=o,r=this.tn.next(),!t.NAME.test(r))throw Error("illegal message field name: "+r);n.name=r,this.tn.skip("="),n.id=i(this.tn.next()),"["===(r=this.tn.peek())&&this._parseFieldOptions(n),this.tn.skip(";")}return e.fields.push(n),n},s._parseMessageOneOf=function(e){var i=this.tn.next();if(!t.NAME.test(i))throw Error("illegal oneof name: "+i);var r=i,o=[];for(this.tn.skip("{");"}"!==(i=this.tn.next());)(i=this._parseMessageField(e,"optional",i)).oneof=r,o.push(i.id);this.tn.omit(";"),e.oneofs[r]=o},s._parseFieldOptions=function(e){this.tn.skip("[");for(var t=!0;"]"!==this.tn.peek();)t||this.tn.skip(","),this._parseOption(e,!0),t=!1;this.tn.next()},s._parseEnum=function(e){var r={name:"",values:[],options:{}},o=this.tn.next();if(!t.NAME.test(o))throw Error("illegal name: "+o);for(r.name=o,this.tn.skip("{");"}"!==(o=this.tn.next());)if("option"===o)this._parseOption(r);else{if(!t.NAME.test(o))throw Error("illegal name: "+o);this.tn.skip("=");var n={name:o,id:i(this.tn.next(),!0)};"["===(o=this.tn.peek())&&this._parseFieldOptions({options:{}}),this.tn.skip(";"),r.values.push(n)}this.tn.omit(";"),e.enums.push(r)},s._parseExtensionRanges=function(){var t,i,o=[];do{for(i=[];;){switch(t=this.tn.next()){case"min":t=e.ID_MIN;break;case"max":t=e.ID_MAX;break;default:t=r(t)}if(i.push(t),2===i.length)break;if("to"!==this.tn.peek()){i.push(t);break}this.tn.next()}o.push(i)}while(this.tn.omit(","));return this.tn.skip(";"),o},s._parseExtend=function(e){var i=this.tn.next();if(!t.TYPEREF.test(i))throw Error("illegal extend reference: "+i);var r={ref:i,fields:[]};for(this.tn.skip("{");"}"!==(i=this.tn.next());)if(t.RULE.test(i))this._parseMessageField(r,i);else{if(!t.TYPEREF.test(i))throw Error("illegal extend token: "+i);if(!this.proto3)throw Error("illegal field rule: "+i);this._parseMessageField(r,"optional",i)}return this.tn.omit(";"),e.messages.push(r),r},s.toString=function(){return"Parser at line "+this.tn.line},n.Parser=l,n}(s,s.Lang),s.Reflect=function(e){function i(t,i){if(t&&"number"==typeof t.low&&"number"==typeof t.high&&"boolean"==typeof t.unsigned&&t.low==t.low&&t.high==t.high)return new e.Long(t.low,t.high,void 0===i?t.unsigned:i);if("string"==typeof t)return e.Long.fromString(t,i||!1,10);if("number"==typeof t)return e.Long.fromNumber(t,i||!1);throw Error("not convertible to Long")}function r(t,i){var o=7&(n=i.readVarint32()),n=n>>>3;switch(o){case e.WIRE_TYPES.VARINT:do{n=i.readUint8()}while(128==(128&n));break;case e.WIRE_TYPES.BITS64:i.offset+=8;break;case e.WIRE_TYPES.LDELIM:n=i.readVarint32(),i.offset+=n;break;case e.WIRE_TYPES.STARTGROUP:r(n,i);break;case e.WIRE_TYPES.ENDGROUP:if(n===t)return!1;throw Error("Illegal GROUPEND after unknown group: "+n+" ("+t+" expected)");case e.WIRE_TYPES.BITS32:i.offset+=4;break;default:throw Error("Illegal wire type in unknown group "+t+": "+o)}return!0}var n={},s=function(e,t,i){this.builder=e,this.parent=t,this.name=i};(u=s.prototype).fqn=function(){for(var e=this.name,t=this;;){if(null==(t=t.parent))break;e=t.name+"."+e}return e},u.toString=function(e){return(e?this.className+" ":"")+this.fqn()},u.build=function(){throw Error(this.toString(!0)+" cannot be built directly")},n.T=s;var u,c=function(e,t,i,r,o){s.call(this,e,t,i),this.className="Namespace",this.children=[],this.options=r||{},this.syntax=o||"proto2"};(u=c.prototype=h()(s.prototype)).getChildren=function(e){if(null==(e=e||null))return this.children.slice();for(var t=[],i=0,r=this.children.length;i<r;++i)this.children[i]instanceof e&&t.push(this.children[i]);return t},u.addChild=function(e){var t;if(t=this.getChild(e.name))if(t instanceof g.Field&&t.name!==t.originalName&&null===this.getChild(t.originalName))t.name=t.originalName;else{if(!(e instanceof g.Field&&e.name!==e.originalName&&null===this.getChild(e.originalName)))throw Error("Duplicate name in namespace "+this.toString(!0)+": "+e.name);e.name=e.originalName}this.children.push(e)},u.getChild=function(e){for(var t="number"==typeof e?"id":"name",i=0,r=this.children.length;i<r;++i)if(this.children[i][t]===e)return this.children[i];return null},u.resolve=function(e,t){var i="string"==typeof e?e.split("."):e,r=this,o=0;if(""===i[o]){for(;null!==r.parent;)r=r.parent;o++}do{do{if(!(r instanceof n.Namespace)){r=null;break}if(!((r=r.getChild(i[o]))&&r instanceof n.T)||t&&!(r instanceof n.Namespace)){r=null;break}o++}while(o<i.length);if(null!=r)break;if(null!==this.parent)return this.parent.resolve(e,t)}while(null!=r);return r},u.qn=function(e){var t=[],i=e;do{t.unshift(i.name),i=i.parent}while(null!==i);for(i=1;i<=t.length;i++){var r=t.slice(t.length-i);if(e===this.resolve(r,e instanceof n.Namespace))return r.join(".")}return e.fqn()},u.build=function(){for(var e,t={},i=this.children,r=0,o=i.length;r<o;++r)(e=i[r])instanceof c&&(t[e.name]=e.build());return l.a&&l()(t,"$options",{value:this.buildOpt()}),t},u.buildOpt=function(){for(var e={},t=a()(this.options),i=0,r=t.length;i<r;++i)e[t[i]]=this.options[t[i]];return e},u.getOption=function(e){return void 0===e?this.options:void 0!==this.options[e]?this.options[e]:null},n.Namespace=c;var d=function(t,i,r,o,n){if(this.type=t,this.resolvedType=i,this.isMapKey=r,this.syntax=o,this.name=n,r&&0>e.MAP_KEY_TYPES.indexOf(t))throw Error("Invalid map key type: "+t.name)},f=d.prototype;d.defaultFieldValue=function(i){if("string"==typeof i&&(i=e.TYPES[i]),void 0===i.defaultValue)throw Error("default value for type "+i.name+" is not supported");return i==e.TYPES.bytes?new t(0):i.defaultValue},f.toString=function(){return(this.name||"")+(this.isMapKey?"map":"value")+" element"},f.verifyValue=function(r){function o(e,t){throw Error("Illegal value for "+n.toString(!0)+" of type "+n.type.name+": "+e+" ("+t+")")}var n=this;switch(this.type){case e.TYPES.int32:case e.TYPES.sint32:case e.TYPES.sfixed32:return("number"!=typeof r||r==r&&0!=r%1)&&o(v()(r),"not an integer"),4294967295<r?0|r:r;case e.TYPES.uint32:case e.TYPES.fixed32:return("number"!=typeof r||r==r&&0!=r%1)&&o(v()(r),"not an integer"),0>r?r>>>0:r;case e.TYPES.int64:case e.TYPES.sint64:case e.TYPES.sfixed64:if(e.Long)try{return i(r,!1)}catch(e){o(v()(r),e.message)}else o(v()(r),"requires Long.js");case e.TYPES.uint64:case e.TYPES.fixed64:if(e.Long)try{return i(r,!0)}catch(e){o(v()(r),e.message)}else o(v()(r),"requires Long.js");case e.TYPES.bool:return"boolean"!=typeof r&&o(v()(r),"not a boolean"),r;case e.TYPES.float:case e.TYPES.double:return"number"!=typeof r&&o(v()(r),"not a number"),r;case e.TYPES.string:return"string"==typeof r||r&&r instanceof String||o(v()(r),"not a string"),""+r;case e.TYPES.bytes:return t.isByteBuffer(r)?r:t.wrap(r,"base64");case e.TYPES.enum:for(var a=this.resolvedType.getChildren(e.Reflect.Enum.Value),s=0;s<a.length;s++)if(a[s].name==r||a[s].id==r)return a[s].id;if("proto3"===this.syntax)return("number"!=typeof r||r==r&&0!=r%1)&&o(v()(r),"not an integer"),(4294967295<r||0>r)&&o(v()(r),"not in range for uint32"),r;o(r,"not a valid enum value");case e.TYPES.group:case e.TYPES.message:if(r&&"object"===v()(r)||o(v()(r),"object expected"),r instanceof this.resolvedType.clazz)return r;if(r instanceof e.Builder.Message){a={};for(s in r)r.hasOwnProperty(s)&&(a[s]=r[s]);r=a}return new this.resolvedType.clazz(r)}throw Error("[INTERNAL] Illegal value for "+this.toString(!0)+": "+r+" (undefined type "+this.type+")")},f.calculateLength=function(i,r){if(null===r)return 0;var o;switch(this.type){case e.TYPES.int32:return 0>r?t.calculateVarint64(r):t.calculateVarint32(r);case e.TYPES.uint32:return t.calculateVarint32(r);case e.TYPES.sint32:return t.calculateVarint32(t.zigZagEncode32(r));case e.TYPES.fixed32:case e.TYPES.sfixed32:case e.TYPES.float:return 4;case e.TYPES.int64:case e.TYPES.uint64:return t.calculateVarint64(r);case e.TYPES.sint64:return t.calculateVarint64(t.zigZagEncode64(r));case e.TYPES.fixed64:case e.TYPES.sfixed64:return 8;case e.TYPES.bool:return 1;case e.TYPES.enum:return t.calculateVarint32(r);case e.TYPES.double:return 8;case e.TYPES.string:return o=t.calculateUTF8Bytes(r),t.calculateVarint32(o)+o;case e.TYPES.bytes:if(0>r.remaining())throw Error("Illegal value for "+this.toString(!0)+": "+r.remaining()+" bytes remaining");return t.calculateVarint32(r.remaining())+r.remaining();case e.TYPES.message:return o=this.resolvedType.calculate(r),t.calculateVarint32(o)+o;case e.TYPES.group:return(o=this.resolvedType.calculate(r))+t.calculateVarint32(i<<3|e.WIRE_TYPES.ENDGROUP)}throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+r+" (unknown type)")},f.encodeValue=function(i,r,o){if(null===r)return o;switch(this.type){case e.TYPES.int32:0>r?o.writeVarint64(r):o.writeVarint32(r);break;case e.TYPES.uint32:o.writeVarint32(r);break;case e.TYPES.sint32:o.writeVarint32ZigZag(r);break;case e.TYPES.fixed32:o.writeUint32(r);break;case e.TYPES.sfixed32:o.writeInt32(r);break;case e.TYPES.int64:case e.TYPES.uint64:o.writeVarint64(r);break;case e.TYPES.sint64:o.writeVarint64ZigZag(r);break;case e.TYPES.fixed64:o.writeUint64(r);break;case e.TYPES.sfixed64:o.writeInt64(r);break;case e.TYPES.bool:"string"==typeof r?o.writeVarint32("false"===r.toLowerCase()?0:!!r):o.writeVarint32(r?1:0);break;case e.TYPES.enum:o.writeVarint32(r);break;case e.TYPES.float:o.writeFloat32(r);break;case e.TYPES.double:o.writeFloat64(r);break;case e.TYPES.string:o.writeVString(r);break;case e.TYPES.bytes:if(0>r.remaining())throw Error("Illegal value for "+this.toString(!0)+": "+r.remaining()+" bytes remaining");i=r.offset,o.writeVarint32(r.remaining()),o.append(r),r.offset=i;break;case e.TYPES.message:i=(new t).LE(),this.resolvedType.encode(r,i),o.writeVarint32(i.offset),o.append(i.flip());break;case e.TYPES.group:this.resolvedType.encode(r,o),o.writeVarint32(i<<3|e.WIRE_TYPES.ENDGROUP);break;default:throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+r+" (unknown type)")}return o},f.decode=function(t,i,r){if(i!=this.type.wireType)throw Error("Unexpected wire type for element");switch(this.type){case e.TYPES.int32:return 0|t.readVarint32();case e.TYPES.uint32:return t.readVarint32()>>>0;case e.TYPES.sint32:return 0|t.readVarint32ZigZag();case e.TYPES.fixed32:return t.readUint32()>>>0;case e.TYPES.sfixed32:return 0|t.readInt32();case e.TYPES.int64:return t.readVarint64();case e.TYPES.uint64:return t.readVarint64().toUnsigned();case e.TYPES.sint64:return t.readVarint64ZigZag();case e.TYPES.fixed64:return t.readUint64();case e.TYPES.sfixed64:return t.readInt64();case e.TYPES.bool:return!!t.readVarint32();case e.TYPES.enum:return t.readVarint32();case e.TYPES.float:return t.readFloat();case e.TYPES.double:return t.readDouble();case e.TYPES.string:return t.readVString();case e.TYPES.bytes:if(r=t.readVarint32(),t.remaining()<r)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+r+" required but got only "+t.remaining());return(i=t.clone()).limit=i.offset+r,t.offset+=r,i;case e.TYPES.message:return r=t.readVarint32(),this.resolvedType.decode(t,r);case e.TYPES.group:return this.resolvedType.decode(t,-1,r)}throw Error("[INTERNAL] Illegal decode type")},f.valueFromString=function(i){if(!this.isMapKey)throw Error("valueFromString() called on non-map-key element");switch(this.type){case e.TYPES.int32:case e.TYPES.sint32:case e.TYPES.sfixed32:case e.TYPES.uint32:case e.TYPES.fixed32:return this.verifyValue(m()(i));case e.TYPES.int64:case e.TYPES.sint64:case e.TYPES.sfixed64:case e.TYPES.uint64:case e.TYPES.fixed64:return this.verifyValue(i);case e.TYPES.bool:return"true"===i;case e.TYPES.string:return this.verifyValue(i);case e.TYPES.bytes:return t.fromBinary(i)}},f.valueToString=function(t){if(!this.isMapKey)throw Error("valueToString() called on non-map-key element");return this.type===e.TYPES.bytes?t.toString("binary"):t.toString()},n.Element=d;var g=function(e,t,i,r,o,n){c.call(this,e,t,i,r,n),this.className="Message",this.extensions=void 0,this.clazz=null,this.isGroup=!!o,this._fieldsByName=this._fieldsById=this._fields=null};(f=g.prototype=h()(c.prototype)).build=function(i){if(this.clazz&&!i)return this.clazz;i=function(e,i){function r(i,o,n,a){if(null===i||"object"!==v()(i)){if(a&&a instanceof e.Reflect.Enum)if(null!==(h=e.Reflect.Enum.getName(a.object,i)))return h;return i}if(t.isByteBuffer(i))return o?i.toBase64():i.toBuffer();if(e.Long.isLong(i))return n?i.toString():e.Long.fromValue(i);var s;if(p()(i))return s=[],i.forEach((function(e,t){s[t]=r(e,o,n,a)})),s;if(s={},i instanceof e.Map){for(var l=(h=i.entries()).next();!l.done;l=h.next())s[i.keyElem.valueToString(l.value[0])]=r(l.value[1],o,n,i.valueElem.resolvedType);return s}var u,h=i.$type;l=void 0;for(u in i)i.hasOwnProperty(u)&&(h&&(l=h.getChild(u))?s[u]=r(i[u],o,n,l.resolvedType):s[u]=r(i[u],o,n));return s}var n=i.getChildren(e.Reflect.Message.Field),a=i.getChildren(e.Reflect.Message.OneOf),s=function r(o,s){e.Builder.Message.call(this);for(var l=0,u=a.length;l<u;++l)this[a[l].name]=null;for(l=0,u=n.length;l<u;++l){var h=n[l];this[h.name]=h.repeated?[]:h.map?new e.Map(h):null,!h.required&&"proto3"!==i.syntax||null===h.defaultValue||(this[h.name]=h.defaultValue)}if(0<arguments.length)if(1!==arguments.length||null===o||"object"!==v()(o)||!("function"!=typeof o.encode||o instanceof r)||p()(o)||o instanceof e.Map||t.isByteBuffer(o)||o instanceof ArrayBuffer||e.Long&&o instanceof e.Long)for(l=0,u=arguments.length;l<u;++l)void 0!==(h=arguments[l])&&this.$set(n[l].name,h);else this.$set(o)},u=s.prototype=h()(e.Builder.Message.prototype);u.add=function(t,r,o){var n=i._fieldsByName[t];if(!o){if(!n)throw Error(this+"#"+t+" is undefined");if(!(n instanceof e.Reflect.Message.Field))throw Error(this+"#"+t+" is not a field: "+n.toString(!0));if(!n.repeated)throw Error(this+"#"+t+" is not a repeated field");r=n.verifyValue(r,!0)}return null===this[t]&&(this[t]=[]),this[t].push(r),this},u.$add=u.add,u.set=function(t,r,o){if(t&&"object"===v()(t)){for(var n in o=r,t)t.hasOwnProperty(n)&&void 0!==(r=t[n])&&this.$set(n,r,o);return this}if(n=i._fieldsByName[t],o)this[t]=r;else{if(!n)throw Error(this+"#"+t+" is not a field: undefined");if(!(n instanceof e.Reflect.Message.Field))throw Error(this+"#"+t+" is not a field: "+n.toString(!0));this[n.name]=r=n.verifyValue(r)}return n&&n.oneof&&(o=this[n.oneof.name],null!==r?(null!==o&&o!==n.name&&(this[o]=null),this[n.oneof.name]=n.name):o===t&&(this[n.oneof.name]=null)),this},u.$set=u.set,u.get=function(t,r){if(r)return this[t];var o=i._fieldsByName[t];if(!(o&&o instanceof e.Reflect.Message.Field))throw Error(this+"#"+t+" is not a field: undefined");if(!(o instanceof e.Reflect.Message.Field))throw Error(this+"#"+t+" is not a field: "+o.toString(!0));return this[o.name]},u.$get=u.get;for(var c=0;c<n.length;c++){var d=n[c];d instanceof e.Reflect.Message.ExtensionField||i.builder.options.populateAccessors&&function(e){var t=(t=e.originalName.replace(/(_[a-zA-Z])/g,(function(e){return e.toUpperCase().replace("_","")}))).substring(0,1).toUpperCase()+t.substring(1),r=e.originalName.replace(/([A-Z])/g,(function(e){return"_"+e})),o=function(t,i){return this[e.name]=i?t:e.verifyValue(t),this},n=function(){return this[e.name]};null===i.getChild("set"+t)&&(u["set"+t]=o),null===i.getChild("set_"+r)&&(u["set_"+r]=o),null===i.getChild("get"+t)&&(u["get"+t]=n),null===i.getChild("get_"+r)&&(u["get_"+r]=n)}(d)}return u.encode=function(e,r){"boolean"==typeof e&&(r=e,e=void 0);var o=!1;e||(e=new t,o=!0);var n=e.littleEndian;try{return i.encode(this,e.LE(),r),(o?e.flip():e).LE(n)}catch(t){throw e.LE(n),t}},s.encode=function(e,t,i){return new s(e).encode(t,i)},u.calculate=function(){return i.calculate(this)},u.encodeDelimited=function(e,r){var o=!1;e||(e=new t,o=!0);var n=(new t).LE();return i.encode(this,n,r).flip(),e.writeVarint32(n.remaining()),e.append(n),o?e.flip():e},u.encodeAB=function(){try{return this.encode().toArrayBuffer()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toArrayBuffer()),e}},u.toArrayBuffer=u.encodeAB,u.encodeNB=function(){try{return this.encode().toBuffer()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toBuffer()),e}},u.toBuffer=u.encodeNB,u.encode64=function(){try{return this.encode().toBase64()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toBase64()),e}},u.toBase64=u.encode64,u.encodeHex=function(){try{return this.encode().toHex()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toHex()),e}},u.toHex=u.encodeHex,u.toRaw=function(e,t){return r(this,!!e,!!t,this.$type)},u.encodeJSON=function(){return o()(r(this,!0,!0,this.$type))},s.decode=function(e,r,o){"string"==typeof r&&(o=r,r=-1),"string"==typeof e?e=t.wrap(e,o||"base64"):t.isByteBuffer(e)||(e=t.wrap(e)),o=e.littleEndian;try{var n=i.decode(e.LE(),r);return e.LE(o),n}catch(t){throw e.LE(o),t}},s.decodeDelimited=function(e,r){if("string"==typeof e?e=t.wrap(e,r||"base64"):t.isByteBuffer(e)||(e=t.wrap(e)),1>e.remaining())return null;var o=e.offset,n=e.readVarint32();if(e.remaining()<n)return e.offset=o,null;try{var a=i.decode(e.slice(e.offset,e.offset+n).LE());return e.offset+=n,a}catch(t){throw e.offset+=n,t}},s.decode64=function(e){return s.decode(e,"base64")},s.decodeHex=function(e){return s.decode(e,"hex")},s.decodeJSON=function(e){return new s(JSON.parse(e))},u.toString=function(){return i.toString()},l.a&&(l()(s,"$options",{value:i.buildOpt()}),l()(u,"$options",{value:s.$options}),l()(s,"$type",{value:i}),l()(u,"$type",{value:i})),s}(e,this),this._fields=[],this._fieldsById={},this._fieldsByName={};for(var r,n=0,a=this.children.length;n<a;n++)if((r=this.children[n])instanceof C||r instanceof g||r instanceof A){if(i.hasOwnProperty(r.name))throw Error("Illegal reflect child of "+this.toString(!0)+": "+r.toString(!0)+" cannot override static property '"+r.name+"'");i[r.name]=r.build()}else if(r instanceof g.Field)r.build(),this._fields.push(r),this._fieldsById[r.id]=r,this._fieldsByName[r.name]=r;else if(!(r instanceof g.OneOf||r instanceof y))throw Error("Illegal reflect child of "+this.toString(!0)+": "+this.children[n].toString(!0));return this.clazz=i},f.encode=function(e,t,i){for(var r,o,n=null,a=0,s=this._fields.length;a<s;++a)o=e[(r=this._fields[a]).name],r.required&&null===o?null===n&&(n=r):r.encode(i?o:r.verifyValue(o),t,e);if(null!==n)throw(e=Error("Missing at least one required field for "+this.toString(!0)+": "+n)).encoded=t,e;return t},f.calculate=function(e){for(var t,i,r=0,o=0,n=this._fields.length;o<n;++o){if(i=e[(t=this._fields[o]).name],t.required&&null===i)throw Error("Missing at least one required field for "+this.toString(!0)+": "+t);r+=t.calculate(i,e)}return r},f.decode=function(t,i,o){"number"!=typeof i&&(i=-1);for(var n,a,s,l=t.offset,u=new this.clazz;t.offset<l+i||-1===i&&0<t.remaining();){if(s=(n=t.readVarint32())>>>3,(a=7&n)===e.WIRE_TYPES.ENDGROUP){if(s!==o)throw Error("Illegal group end indicator for "+this.toString(!0)+": "+s+" ("+(o?o+" expected":"not a group")+")");break}if(n=this._fieldsById[s])n.repeated&&!n.options.packed?u[n.name].push(n.decode(a,t)):n.map?(a=n.decode(a,t),u[n.name].set(a[0],a[1])):(u[n.name]=n.decode(a,t),n.oneof&&(null!==(a=u[n.oneof.name])&&a!==n.name&&(u[a]=null),u[n.oneof.name]=n.name));else switch(a){case e.WIRE_TYPES.VARINT:t.readVarint32();break;case e.WIRE_TYPES.BITS32:t.offset+=4;break;case e.WIRE_TYPES.BITS64:t.offset+=8;break;case e.WIRE_TYPES.LDELIM:n=t.readVarint32(),t.offset+=n;break;case e.WIRE_TYPES.STARTGROUP:for(;r(s,t););break;default:throw Error("Illegal wire type for unknown field "+s+" in "+this.toString(!0)+"#decode: "+a)}}for(t=0,i=this._fields.length;t<i;++t)if(null===u[(n=this._fields[t]).name])if("proto3"===this.syntax)u[n.name]=n.defaultValue;else{if(n.required)throw(t=Error("Missing at least one required field for "+this.toString(!0)+": "+n.name)).decoded=u,t;e.populateDefaults&&null!==n.defaultValue&&(u[n.name]=n.defaultValue)}return u},n.Message=g;var _=function(t,i,r,o,n,a,l,u,h,c){s.call(this,t,i,a),this.className="Message.Field",this.required="required"===r,this.repeated="repeated"===r,this.map="map"===r,this.keyType=o||null,this.type=n,this.resolvedType=null,this.id=l,this.options=u||{},this.defaultValue=null,this.oneof=h||null,this.syntax=c||"proto2",this.originalName=this.name,this.keyElement=this.element=null,!this.builder.options.convertFieldsToCamelCase||this instanceof g.ExtensionField||(this.name=e.Util.toCamelCase(this.name))};(f=_.prototype=h()(s.prototype)).build=function(){this.element=new d(this.type,this.resolvedType,!1,this.syntax,this.name),this.map&&(this.keyElement=new d(this.keyType,void 0,!0,this.syntax,this.name)),"proto3"!==this.syntax||this.repeated||this.map?void 0!==this.options.default&&(this.defaultValue=this.verifyValue(this.options.default)):this.defaultValue=d.defaultFieldValue(this.type)},f.verifyValue=function(t,i){function r(e,t){throw Error("Illegal value for "+n.toString(!0)+" of type "+n.type.name+": "+e+" ("+t+")")}i=i||!1;var o,n=this;if(null===t)return this.required&&r(v()(t),"required"),"proto3"===this.syntax&&this.type!==e.TYPES.message&&r(v()(t),"proto3 field without field presence cannot be null"),null;if(this.repeated&&!i){p()(t)||(t=[t]);var a=[];for(o=0;o<t.length;o++)a.push(this.element.verifyValue(t[o]));return a}return this.map&&!i?t instanceof e.Map?t:(t instanceof Object||r(v()(t),"expected ProtoBuf.Map or raw object for map field"),new e.Map(this,t)):(!this.repeated&&p()(t)&&r(v()(t),"no array expected"),this.element.verifyValue(t))},f.hasWirePresence=function(t,i){if("proto3"!==this.syntax)return null!==t;if(this.oneof&&i[this.oneof.name]===this.name)return!0;switch(this.type){case e.TYPES.int32:case e.TYPES.sint32:case e.TYPES.sfixed32:case e.TYPES.uint32:case e.TYPES.fixed32:return 0!==t;case e.TYPES.int64:case e.TYPES.sint64:case e.TYPES.sfixed64:case e.TYPES.uint64:case e.TYPES.fixed64:return 0!==t.low||0!==t.high;case e.TYPES.bool:return t;case e.TYPES.float:case e.TYPES.double:return 0!==t;case e.TYPES.string:return 0<t.length;case e.TYPES.bytes:return 0<t.remaining();case e.TYPES.enum:return 0!==t;case e.TYPES.message:return null!==t;default:return!0}},f.encode=function(i,r,o){if(null===this.type||"object"!==v()(this.type))throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===i||this.repeated&&0==i.length)return r;try{var n;if(this.repeated)if(this.options.packed&&0<=e.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)){r.writeVarint32(this.id<<3|e.WIRE_TYPES.LDELIM),r.ensureCapacity(r.offset+=1);var a=r.offset;for(n=0;n<i.length;n++)this.element.encodeValue(this.id,i[n],r);var s=r.offset-a,l=t.calculateVarint32(s);if(1<l){var u=r.slice(a,r.offset);a=a+(l-1);r.offset=a,r.append(u)}r.writeVarint32(s,a-l)}else for(n=0;n<i.length;n++)r.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,i[n],r);else this.map?i.forEach((function(i,o,n){n=t.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,o)+t.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,i),r.writeVarint32(this.id<<3|e.WIRE_TYPES.LDELIM),r.writeVarint32(n),r.writeVarint32(8|this.keyType.wireType),this.keyElement.encodeValue(1,o,r),r.writeVarint32(16|this.type.wireType),this.element.encodeValue(2,i,r)}),this):this.hasWirePresence(i,o)&&(r.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,i,r))}catch(e){throw Error("Illegal value for "+this.toString(!0)+": "+i+" ("+e+")")}return r},f.calculate=function(i,r){if(i=this.verifyValue(i),null===this.type||"object"!==v()(this.type))throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===i||this.repeated&&0==i.length)return 0;var o=0;try{var n,a;if(this.repeated)if(this.options.packed&&0<=e.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)){for(o+=t.calculateVarint32(this.id<<3|e.WIRE_TYPES.LDELIM),n=a=0;n<i.length;n++)a+=this.element.calculateLength(this.id,i[n]);o+=t.calculateVarint32(a),o+=a}else for(n=0;n<i.length;n++)o+=t.calculateVarint32(this.id<<3|this.type.wireType),o+=this.element.calculateLength(this.id,i[n]);else this.map?i.forEach((function(i,r,n){i=t.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,r)+t.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,i),o+=t.calculateVarint32(this.id<<3|e.WIRE_TYPES.LDELIM),o+=t.calculateVarint32(i),o+=i}),this):this.hasWirePresence(i,r)&&(o+=t.calculateVarint32(this.id<<3|this.type.wireType),o+=this.element.calculateLength(this.id,i))}catch(e){throw Error("Illegal value for "+this.toString(!0)+": "+i+" ("+e+")")}return o},f.decode=function(t,i,r){if(!(!this.map&&t==this.type.wireType||!r&&this.repeated&&this.options.packed&&t==e.WIRE_TYPES.LDELIM||this.map&&t==e.WIRE_TYPES.LDELIM))throw Error("Illegal wire type for field "+this.toString(!0)+": "+t+" ("+this.type.wireType+" expected)");if(t==e.WIRE_TYPES.LDELIM&&this.repeated&&this.options.packed&&0<=e.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)&&!r){for(t=i.readVarint32(),t=i.offset+t,r=[];i.offset<t;)r.push(this.decode(this.type.wireType,i,!0));return r}if(this.map){var o=d.defaultFieldValue(this.keyType);if(r=d.defaultFieldValue(this.type),t=i.readVarint32(),i.remaining()<t)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+t+" required but got only "+i.remaining());var n=i.clone();for(n.limit=n.offset+t,i.offset+=t;0<n.remaining();)if(t=7&(i=n.readVarint32()),1===(i>>>=3))o=this.keyElement.decode(n,t,i);else{if(2!==i)throw Error("Unexpected tag in map field key/value submessage");r=this.element.decode(n,t,i)}return[o,r]}return this.element.decode(i,t,this.id)},n.Message.Field=_,(f=function(e,t,i,r,o,n,a){_.call(this,e,t,i,null,r,o,n,a)}).prototype=h()(_.prototype),n.Message.ExtensionField=f,n.Message.OneOf=function(e,t,i){s.call(this,e,t,i),this.fields=[]};var C=function(e,t,i,r,o){c.call(this,e,t,i,r,o),this.className="Enum",this.object=null};C.getName=function(e,t){for(var i,r=a()(e),o=0;o<r.length;++o)if(e[i=r[o]]===t)return i;return null},(C.prototype=h()(c.prototype)).build=function(t){if(this.object&&!t)return this.object;t=new e.Builder.Enum;for(var i=this.getChildren(C.Value),r=0,o=i.length;r<o;++r)t[i[r].name]=i[r].id;return l.a&&l()(t,"$options",{value:this.buildOpt(),enumerable:!1}),this.object=t},n.Enum=C,(f=function(e,t,i,r){s.call(this,e,t,i),this.className="Enum.Value",this.id=r}).prototype=h()(s.prototype),n.Enum.Value=f;var y=function(e,t,i,r){s.call(this,e,t,i),this.field=r};y.prototype=h()(s.prototype),n.Extension=y;var A=function(e,t,i,r){c.call(this,e,t,i,r),this.className="Service",this.clazz=null};(A.prototype=h()(c.prototype)).build=function(i){return this.clazz&&!i?this.clazz:this.clazz=function(e,i){for(var r=function(t){e.Builder.Service.call(this),this.rpcImpl=t||function(e,t,i){setTimeout(i.bind(this,Error("Not implemented, see: https://github.com/dcodeIO/ProtoBuf.js/wiki/Services")),0)}},o=r.prototype=h()(e.Builder.Service.prototype),n=i.getChildren(e.Reflect.Service.RPCMethod),a=0;a<n.length;a++)!function(e){o[e.name]=function(r,o){try{try{r=e.resolvedRequestType.clazz.decode(t.wrap(r))}catch(e){if(!(e instanceof TypeError))throw e}if(null===r||"object"!==v()(r))throw Error("Illegal arguments");r instanceof e.resolvedRequestType.clazz||(r=new e.resolvedRequestType.clazz(r)),this.rpcImpl(e.fqn(),r,(function(t,r){if(t)o(t);else{null===r&&(r="");try{r=e.resolvedResponseType.clazz.decode(r)}catch(e){}r&&r instanceof e.resolvedResponseType.clazz?o(null,r):o(Error("Illegal response type received in service method "+i.name+"#"+e.name))}}))}catch(e){setTimeout(o.bind(this,e),0)}},r[e.name]=function(t,i,o){new r(t)[e.name](i,o)},l.a&&(l()(r[e.name],"$options",{value:e.buildOpt()}),l()(o[e.name],"$options",{value:r[e.name].$options}))}(n[a]);return l.a&&(l()(r,"$options",{value:i.buildOpt()}),l()(o,"$options",{value:r.$options}),l()(r,"$type",{value:i}),l()(o,"$type",{value:i})),r}(e,this)},n.Service=A;var I=function(e,t,i,r){s.call(this,e,t,i),this.className="Service.Method",this.options=r||{}};return(I.prototype=h()(s.prototype)).buildOpt=u.buildOpt,n.Service.Method=I,(u=function(e,t,i,r,o,n,a,s){I.call(this,e,t,i,s),this.className="Service.RPCMethod",this.requestName=r,this.responseName=o,this.requestStream=n,this.responseStream=a,this.resolvedResponseType=this.resolvedRequestType=null}).prototype=h()(I.prototype),n.Service.RPCMethod=u,n}(s),s.Builder=function(e,t,r){var n=function(e){this.ptr=this.ns=new r.Namespace(this,null,""),this.resolved=!1,this.result=null,this.files={},this.importRoot=null,this.options=e||{}},s=n.prototype;return n.isMessage=function(e){return"string"==typeof e.name&&void 0===e.values&&void 0===e.rpc},n.isMessageField=function(e){return"string"==typeof e.rule&&"string"==typeof e.name&&"string"==typeof e.type&&void 0!==e.id},n.isEnum=function(e){return!("string"!=typeof e.name||void 0===e.values||!p()(e.values)||0===e.values.length)},n.isService=function(e){return!("string"!=typeof e.name||"object"!==v()(e.rpc)||!e.rpc)},n.isExtend=function(e){return"string"==typeof e.ref},s.reset=function(){return this.ptr=this.ns,this},s.define=function(e){if("string"!=typeof e||!t.TYPEREF.test(e))throw Error("illegal namespace: "+e);return e.split(".").forEach((function(e){var t=this.ptr.getChild(e);null===t&&this.ptr.addChild(t=new r.Namespace(this,this.ptr,e)),this.ptr=t}),this),this},s.create=function(t){if(!t)return this;if(p()(t)){if(0===t.length)return this;t=t.slice()}else t=[t];for(var i=[t];0<i.length;){if(t=i.pop(),!p()(t))throw Error("not a valid namespace: "+o()(t));for(;0<t.length;){var s=t.shift();if(n.isMessage(s)){var l=new r.Message(this,this.ptr,s.name,s.options,s.isGroup,s.syntax),u={};s.oneofs&&a()(s.oneofs).forEach((function(e){l.addChild(u[e]=new r.Message.OneOf(this,l,e))}),this),s.fields&&s.fields.forEach((function(e){if(null!==l.getChild(0|e.id))throw Error("duplicate or invalid field id in "+l.name+": "+e.id);if(e.options&&"object"!==v()(e.options))throw Error("illegal field options in "+l.name+"#"+e.name);var t=null;if("string"==typeof e.oneof&&!(t=u[e.oneof]))throw Error("illegal oneof in "+l.name+"#"+e.name+": "+e.oneof);e=new r.Message.Field(this,l,e.rule,e.keytype,e.type,e.name,e.id,e.options,t,s.syntax),t&&t.fields.push(e),l.addChild(e)}),this);var h=[];if(s.enums&&s.enums.forEach((function(e){h.push(e)})),s.messages&&s.messages.forEach((function(e){h.push(e)})),s.services&&s.services.forEach((function(e){h.push(e)})),s.extensions&&(l.extensions="number"==typeof s.extensions[0]?[s.extensions]:s.extensions),this.ptr.addChild(l),0<h.length){i.push(t),t=h,h=null,this.ptr=l,l=null;continue}h=null}else if(n.isEnum(s))l=new r.Enum(this,this.ptr,s.name,s.options,s.syntax),s.values.forEach((function(e){l.addChild(new r.Enum.Value(this,l,e.name,e.id))}),this),this.ptr.addChild(l);else if(n.isService(s))l=new r.Service(this,this.ptr,s.name,s.options),a()(s.rpc).forEach((function(e){var t=s.rpc[e];l.addChild(new r.Service.RPCMethod(this,l,e,t.request,t.response,!!t.request_stream,!!t.response_stream,t.options))}),this),this.ptr.addChild(l);else{if(!n.isExtend(s))throw Error("not a valid definition: "+o()(s));if(l=this.ptr.resolve(s.ref,!0))s.fields.forEach((function(t){if(null!==l.getChild(0|t.id))throw Error("duplicate extended field id in "+l.name+": "+t.id);if(l.extensions){var i=!1;if(l.extensions.forEach((function(e){t.id>=e[0]&&t.id<=e[1]&&(i=!0)})),!i)throw Error("illegal extended field id in "+l.name+": "+t.id+" (not within valid ranges)")}var o=t.name;this.options.convertFieldsToCamelCase&&(o=e.Util.toCamelCase(o));o=new r.Message.ExtensionField(this,l,t.rule,t.type,this.ptr.fqn()+"."+o,t.id,t.options);var n=new r.Extension(this,this.ptr,t.name,o);o.extension=n,this.ptr.addChild(n),l.addChild(o)}),this);else if(!/\.?google\.protobuf\./.test(s.ref))throw Error("extended message "+s.ref+" is not defined")}l=s=null}t=null,this.ptr=this.ptr.parent}return this.resolved=!1,this.result=null,this},s.import=function(t,r){var o="/";if("string"==typeof r){if(e.Util.IS_NODE&&(r=i(122).resolve(r)),!0===this.files[r])return this.reset();this.files[r]=!0}else if("object"===v()(r)){var n=r.root;if(e.Util.IS_NODE&&(n=i(122).resolve(n)),(0<=n.indexOf("\\")||0<=r.file.indexOf("\\"))&&(o="\\"),n=n+o+r.file,!0===this.files[n])return this.reset();this.files[n]=!0}if(t.imports&&0<t.imports.length){var s=!1;"object"===v()(r)?(this.importRoot=r.root,s=!0,n=this.importRoot,r=r.file,(0<=n.indexOf("\\")||0<=r.indexOf("\\"))&&(o="\\")):"string"==typeof r?this.importRoot?n=this.importRoot:0<=r.indexOf("/")?""===(n=r.replace(/\/[^\/]*$/,""))&&(n="/"):0<=r.indexOf("\\")?(n=r.replace(/\\[^\\]*$/,""),o="\\"):n=".":n=null;for(var l=0;l<t.imports.length;l++)if("string"==typeof t.imports[l]){if(!n)throw Error("cannot determine import root");var u=t.imports[l];if("google/protobuf/descriptor.proto"!==u&&(u=n+o+u,!0!==this.files[u])){/\.proto$/i.test(u)&&!e.DotProto&&(u=u.replace(/\.proto$/,".json"));var h=e.Util.fetch(u);if(null===h)throw Error("failed to import '"+u+"' in '"+r+"': file not found");/\.json$/i.test(u)?this.import(JSON.parse(h+""),u):this.import(e.DotProto.Parser.parse(h),u)}}else r?/\.(\w+)$/.test(r)?this.import(t.imports[l],r.replace(/^(.+)\.(\w+)$/,(function(e,t,i){return t+"_import"+l+"."+i}))):this.import(t.imports[l],r+"_import"+l):this.import(t.imports[l]);s&&(this.importRoot=null)}t.package&&this.define(t.package),t.syntax&&function e(t){t.messages&&t.messages.forEach((function(i){i.syntax=t.syntax,e(i)})),t.enums&&t.enums.forEach((function(e){e.syntax=t.syntax}))}(t);var c=this.ptr;return t.options&&a()(t.options).forEach((function(e){c.options[e]=t.options[e]})),t.messages&&(this.create(t.messages),this.ptr=c),t.enums&&(this.create(t.enums),this.ptr=c),t.services&&(this.create(t.services),this.ptr=c),t.extends&&this.create(t.extends),this.reset()},s.resolveAll=function(){var i;if(null==this.ptr||"object"===v()(this.ptr.type))return this;if(this.ptr instanceof r.Namespace)this.ptr.children.forEach((function(e){this.ptr=e,this.resolveAll()}),this);else if(this.ptr instanceof r.Message.Field){if(t.TYPE.test(this.ptr.type))this.ptr.type=e.TYPES[this.ptr.type];else{if(!t.TYPEREF.test(this.ptr.type))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(!(i=(this.ptr instanceof r.Message.ExtensionField?this.ptr.extension.parent:this.ptr.parent).resolve(this.ptr.type,!0)))throw Error("unresolvable type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(this.ptr.resolvedType=i,i instanceof r.Enum){if(this.ptr.type=e.TYPES.enum,"proto3"===this.ptr.syntax&&"proto3"!==i.syntax)throw Error("proto3 message cannot reference proto2 enum")}else{if(!(i instanceof r.Message))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);this.ptr.type=i.isGroup?e.TYPES.group:e.TYPES.message}}if(this.ptr.map){if(!t.TYPE.test(this.ptr.keyType))throw Error("illegal key type for map field in "+this.ptr.toString(!0)+": "+this.ptr.keyType);this.ptr.keyType=e.TYPES[this.ptr.keyType]}}else if(this.ptr instanceof e.Reflect.Service.Method){if(!(this.ptr instanceof e.Reflect.Service.RPCMethod))throw Error("illegal service type in "+this.ptr.toString(!0));if(!((i=this.ptr.parent.resolve(this.ptr.requestName,!0))&&i instanceof e.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.requestName);if(this.ptr.resolvedRequestType=i,!((i=this.ptr.parent.resolve(this.ptr.responseName,!0))&&i instanceof e.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.responseName);this.ptr.resolvedResponseType=i}else if(!(this.ptr instanceof e.Reflect.Message.OneOf||this.ptr instanceof e.Reflect.Extension||this.ptr instanceof e.Reflect.Enum.Value))throw Error("illegal object in namespace: "+v()(this.ptr)+": "+this.ptr);return this.reset()},s.build=function(e){if(this.reset(),this.resolved||(this.resolveAll(),this.resolved=!0,this.result=null),null===this.result&&(this.result=this.ns.build()),!e)return this.result;e="string"==typeof e?e.split("."):e;for(var t=this.result,i=0;i<e.length;i++){if(!t[e[i]]){t=null;break}t=t[e[i]]}return t},s.lookup=function(e,t){return e?this.ns.resolve(e,t):this.ns},s.toString=function(){return"Builder"},n.Message=function(){},n.Enum=function(){},n.Service=function(){},n}(s,s.Lang,s.Reflect),s.Map=function(e,t){function i(e){var t=0;return{next:function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}}var r=function(e,i){if(!e.map)throw Error("field is not a map");if(this.field=e,this.keyElem=new t.Element(e.keyType,null,!0,e.syntax),this.valueElem=new t.Element(e.type,e.resolvedType,!1,e.syntax),this.map={},l()(this,"size",{get:function(){return a()(this.map).length}}),i)for(var r=a()(i),o=0;o<r.length;o++){var n=this.keyElem.valueFromString(r[o]),s=this.valueElem.verifyValue(i[r[o]]);this.map[this.keyElem.valueToString(n)]={key:n,value:s}}},o=r.prototype;return o.clear=function(){this.map={}},o.delete=function(e){var t=(e=this.keyElem.valueToString(this.keyElem.verifyValue(e)))in this.map;return delete this.map[e],t},o.entries=function(){for(var e,t=[],r=a()(this.map),o=0;o<r.length;o++)t.push([(e=this.map[r[o]]).key,e.value]);return i(t)},o.keys=function(){for(var e=[],t=a()(this.map),r=0;r<t.length;r++)e.push(this.map[t[r]].key);return i(e)},o.values=function(){for(var e=[],t=a()(this.map),r=0;r<t.length;r++)e.push(this.map[t[r]].value);return i(e)},o.forEach=function(e,t){for(var i,r=a()(this.map),o=0;o<r.length;o++)e.call(t,(i=this.map[r[o]]).value,i.key,this)},o.set=function(e,t){var i=this.keyElem.verifyValue(e),r=this.valueElem.verifyValue(t);return this.map[this.keyElem.valueToString(i)]={key:i,value:r},this},o.get=function(e){return(e=this.keyElem.valueToString(this.keyElem.verifyValue(e)))in this.map?this.map[e].value:void 0},o.has=function(e){return this.keyElem.valueToString(this.keyElem.verifyValue(e))in this.map},r}(0,s.Reflect),s.loadProto=function(e,t,i){return("string"==typeof t||t&&"string"==typeof t.file&&"string"==typeof t.root)&&(i=t,t=void 0),s.loadJson(s.DotProto.Parser.parse(e),t,i)},s.protoFromString=s.loadProto,s.loadProtoFile=function(e,t,i){if(t&&"object"===v()(t)?(i=t,t=null):t&&"function"==typeof t||(t=null),t)return s.Util.fetch("string"==typeof e?e:e.root+"/"+e.file,(function(r){if(null===r)t(Error("Failed to fetch file"));else try{t(null,s.loadProto(r,i,e))}catch(e){t(e)}}));var r=s.Util.fetch("object"===v()(e)?e.root+"/"+e.file:e);return null===r?null:s.loadProto(r,i,e)},s.protoFromFile=s.loadProtoFile,s.newBuilder=function(e){return void 0===(e=e||{}).convertFieldsToCamelCase&&(e.convertFieldsToCamelCase=s.convertFieldsToCamelCase),void 0===e.populateAccessors&&(e.populateAccessors=s.populateAccessors),new s.Builder(e)},s.loadJson=function(e,t,i){return("string"==typeof t||t&&"string"==typeof t.file&&"string"==typeof t.root)&&(i=t,t=null),t&&"object"===v()(t)||(t=s.newBuilder()),"string"==typeof e&&(e=JSON.parse(e)),t.import(e,i),t.resolveAll(),t},s.loadJsonFile=function(e,t,i){if(t&&"object"===v()(t)?(i=t,t=null):t&&"function"==typeof t||(t=null),t)return s.Util.fetch("string"==typeof e?e:e.root+"/"+e.file,(function(r){if(null===r)t(Error("Failed to fetch file"));else try{t(null,s.loadJson(JSON.parse(r),i,e))}catch(e){t(e)}}));var r=s.Util.fetch("object"===v()(e)?e.root+"/"+e.file:e);return null===r?null:s.loadJson(JSON.parse(r),i,e)},s}))}).call(this,i(94),i(95)(e))},function(e,t,i){var r=i(5),o=r.JSON||(r.JSON={stringify:JSON.stringify});e.exports=function(e){return o.stringify.apply(o,arguments)}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,i){"use strict";var r=i(46),o=i(22),n=i(23),a=i(20),s=i(34),l=i(148),u=i(69),h=i(104),c=i(7)("iterator"),p=!([].keys&&"next"in[].keys()),d=function(){return this};e.exports=function(e,t,i,f,g,m,_){l(i,t,f);var v,C,y,A=function(e){if(!p&&e in E)return E[e];switch(e){case"keys":case"values":return function(){return new i(this,e)}}return function(){return new i(this,e)}},I=t+" Iterator",b="values"==g,w=!1,E=e.prototype,G=E[c]||E["@@iterator"]||g&&E[g],S=G||A(g),P=g?b?A("entries"):S:void 0,T="Array"==t&&E.entries||G;if(T&&(y=h(T.call(new e)))!==Object.prototype&&y.next&&(u(y,I,!0),r||"function"==typeof y[c]||a(y,c,d)),b&&G&&"values"!==G.name&&(w=!0,S=function(){return G.call(this)}),r&&!_||!p&&!w&&E[c]||a(E,c,S),s[t]=S,s[I]=d,g)if(v={values:b?S:A("values"),keys:m?S:A("keys"),entries:P},_)for(C in v)C in E||n(E,C,v[C]);else o(o.P+o.F*(p||w),t,v);return v}},function(e,t,i){e.exports=i(65)("native-function-to-string",Function.toString)},function(e,t,i){"use strict";var r=i(66),o=i(48),n=i(69),a={};i(20)(a,i(7)("iterator"),(function(){return this})),e.exports=function(e,t,i){e.prototype=r(a,{next:o(1,i)}),n(e,t+" Iterator")}},function(e,t,i){var r=i(21),o=i(18),n=i(101);e.exports=i(14)?Object.defineProperties:function(e,t){o(e);for(var i,a=n(t),s=a.length,l=0;s>l;)r.f(e,i=a[l++],t[i]);return e}},function(e,t,i){var r=i(13).document;e.exports=r&&r.documentElement},function(e,t,i){i(152),e.exports=i(5).Object.keys},function(e,t,i){var r=i(70),o=i(53);i(156)("keys",(function(){return function(e){return o(r(e))}}))},function(e,t,i){var r=i(42);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},function(e,t,i){var r=i(36),o=i(106),n=i(155);e.exports=function(e){return function(t,i,a){var s,l=r(t),u=o(l.length),h=n(a,u);if(e&&i!=i){for(;u>h;)if((s=l[h++])!=s)return!0}else for(;u>h;h++)if((e||h in l)&&l[h]===i)return e||h||0;return!e&&-1}}},function(e,t,i){var r=i(71),o=Math.max,n=Math.min;e.exports=function(e,t){return(e=r(e))<0?o(e+t,0):n(e,t)}},function(e,t,i){var r=i(10),o=i(5),n=i(37);e.exports=function(e,t){var i=(o.Object||{})[e]||Object[e],a={};a[e]=t(i),r(r.S+r.F*n((function(){i(1)})),"Object",a)}},function(e,t,i){i(158);var r=i(5).Object;e.exports=function(e,t,i){return r.defineProperty(e,t,i)}},function(e,t,i){var r=i(10);r(r.S+r.F*!i(24),"Object",{defineProperty:i(28).f})},function(e,t,i){var r=i(27),o=i(26);e.exports=function(e){return function(t,i){var n,a,s=String(o(t)),l=r(i),u=s.length;return l<0||l>=u?e?"":void 0:(n=s.charCodeAt(l))<55296||n>56319||l+1===u||(a=s.charCodeAt(l+1))<56320||a>57343?e?s.charAt(l):n:e?s.slice(l,l+2):a-56320+(n-55296<<10)+65536}}},function(e,t,i){"use strict";var r=i(80);i(22)({target:"RegExp",proto:!0,forced:r!==/./.exec},{exec:r})},function(e,t,i){i(162);var r=i(5).Object;e.exports=function(e,t){return r.create(e,t)}},function(e,t,i){var r=i(10);r(r.S,"Object",{create:i(81)})},function(e,t,i){i(14)&&"g"!=/./g.flags&&i(21).f(RegExp.prototype,"flags",{configurable:!0,get:i(60)})},function(e,t,i){i(165),e.exports=i(5).Array.isArray},function(e,t,i){var r=i(10);r(r.S,"Array",{isArray:i(111)})},function(e,t,i){i(167),e.exports=i(5).parseFloat},function(e,t,i){var r=i(10),o=i(168);r(r.G+r.F*(parseFloat!=o),{parseFloat:o})},function(e,t,i){var r=i(8).parseFloat,o=i(112).trim;e.exports=1/r(i(85)+"-0")!=-1/0?function(e){var t=o(String(e),3),i=r(t);return 0===i&&"-"==t.charAt(0)?-0:i}:r},function(e,t,i){i(170),e.exports=i(5).parseInt},function(e,t,i){var r=i(10),o=i(171);r(r.G+r.F*(parseInt!=o),{parseInt:o})},function(e,t,i){var r=i(8).parseInt,o=i(112).trim,n=i(85),a=/^[-+]?0[xX]/;e.exports=8!==r(n+"08")||22!==r(n+"0x16")?function(e,t){var i=o(String(e),3);return r(i,t>>>0||(a.test(i)?16:10))}:r},function(e,t,i){i(113),i(116),e.exports=i(87).f("iterator")},function(e,t,i){var r=i(71),o=i(52);e.exports=function(e){return function(t,i){var n,a,s=String(o(t)),l=r(i),u=s.length;return l<0||l>=u?e?"":void 0:(n=s.charCodeAt(l))<55296||n>56319||l+1===u||(a=s.charCodeAt(l+1))<56320||a>57343?e?s.charAt(l):n:e?s.slice(l,l+2):a-56320+(n-55296<<10)+65536}}},function(e,t,i){"use strict";var r=i(81),o=i(57),n=i(62),a={};i(32)(a,i(15)("iterator"),(function(){return this})),e.exports=function(e,t,i){e.prototype=r(a,{next:o(1,i)}),n(e,t+" Iterator")}},function(e,t,i){var r=i(31),o=i(70),n=i(72)("IE_PROTO"),a=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=o(e),r(e,n)?e[n]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?a:null}},function(e,t,i){"use strict";var r=i(177),o=i(178),n=i(44),a=i(36);e.exports=i(114)(Array,"Array",(function(e,t){this._t=a(e),this._i=0,this._k=t}),(function(){var e=this._t,t=this._k,i=this._i++;return!e||i>=e.length?(this._t=void 0,o(1)):o(0,"keys"==t?i:"values"==t?e[i]:[i,e[i]])}),"values"),n.Arguments=n.Array,r("keys"),r("values"),r("entries")},function(e,t){e.exports=function(){}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,i){i(180),i(119),i(185),i(186),e.exports=i(5).Symbol},function(e,t,i){"use strict";var r=i(8),o=i(31),n=i(24),a=i(10),s=i(115),l=i(181).KEY,u=i(37),h=i(73),c=i(62),p=i(54),d=i(15),f=i(87),g=i(88),m=i(182),_=i(111),v=i(29),C=i(33),y=i(70),A=i(36),I=i(76),b=i(57),w=i(81),E=i(183),G=i(184),S=i(117),P=i(28),T=i(53),x=G.f,M=P.f,L=E.f,N=r.Symbol,R=r.JSON,O=R&&R.stringify,D=d("_hidden"),F=d("toPrimitive"),U={}.propertyIsEnumerable,B=h("symbol-registry"),k=h("symbols"),V=h("op-symbols"),W=Object.prototype,j="function"==typeof N&&!!S.f,z=r.QObject,H=!z||!z.prototype||!z.prototype.findChild,q=n&&u((function(){return 7!=w(M({},"a",{get:function(){return M(this,"a",{value:7}).a}})).a}))?function(e,t,i){var r=x(W,t);r&&delete W[t],M(e,t,i),r&&e!==W&&M(W,t,r)}:M,X=function(e){var t=k[e]=w(N.prototype);return t._k=e,t},Y=j&&"symbol"==typeof N.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof N},K=function(e,t,i){return e===W&&K(V,t,i),v(e),t=I(t,!0),v(i),o(k,t)?(i.enumerable?(o(e,D)&&e[D][t]&&(e[D][t]=!1),i=w(i,{enumerable:b(0,!1)})):(o(e,D)||M(e,D,b(1,{})),e[D][t]=!0),q(e,t,i)):M(e,t,i)},Q=function(e,t){v(e);for(var i,r=m(t=A(t)),o=0,n=r.length;n>o;)K(e,i=r[o++],t[i]);return e},Z=function(e){var t=U.call(this,e=I(e,!0));return!(this===W&&o(k,e)&&!o(V,e))&&(!(t||!o(this,e)||!o(k,e)||o(this,D)&&this[D][e])||t)},J=function(e,t){if(e=A(e),t=I(t,!0),e!==W||!o(k,t)||o(V,t)){var i=x(e,t);return!i||!o(k,t)||o(e,D)&&e[D][t]||(i.enumerable=!0),i}},$=function(e){for(var t,i=L(A(e)),r=[],n=0;i.length>n;)o(k,t=i[n++])||t==D||t==l||r.push(t);return r},ee=function(e){for(var t,i=e===W,r=L(i?V:A(e)),n=[],a=0;r.length>a;)!o(k,t=r[a++])||i&&!o(W,t)||n.push(k[t]);return n};j||(s((N=function(){if(this instanceof N)throw TypeError("Symbol is not a constructor!");var e=p(arguments.length>0?arguments[0]:void 0),t=function(i){this===W&&t.call(V,i),o(this,D)&&o(this[D],e)&&(this[D][e]=!1),q(this,e,b(1,i))};return n&&H&&q(W,e,{configurable:!0,set:t}),X(e)}).prototype,"toString",(function(){return this._k})),G.f=J,P.f=K,i(118).f=E.f=$,i(89).f=Z,S.f=ee,n&&!i(43)&&s(W,"propertyIsEnumerable",Z,!0),f.f=function(e){return X(d(e))}),a(a.G+a.W+a.F*!j,{Symbol:N});for(var te="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ie=0;te.length>ie;)d(te[ie++]);for(var re=T(d.store),oe=0;re.length>oe;)g(re[oe++]);a(a.S+a.F*!j,"Symbol",{for:function(e){return o(B,e+="")?B[e]:B[e]=N(e)},keyFor:function(e){if(!Y(e))throw TypeError(e+" is not a symbol!");for(var t in B)if(B[t]===e)return t},useSetter:function(){H=!0},useSimple:function(){H=!1}}),a(a.S+a.F*!j,"Object",{create:function(e,t){return void 0===t?w(e):Q(w(e),t)},defineProperty:K,defineProperties:Q,getOwnPropertyDescriptor:J,getOwnPropertyNames:$,getOwnPropertySymbols:ee});var ne=u((function(){S.f(1)}));a(a.S+a.F*ne,"Object",{getOwnPropertySymbols:function(e){return S.f(y(e))}}),R&&a(a.S+a.F*(!j||u((function(){var e=N();return"[null]"!=O([e])||"{}"!=O({a:e})||"{}"!=O(Object(e))}))),"JSON",{stringify:function(e){for(var t,i,r=[e],o=1;arguments.length>o;)r.push(arguments[o++]);if(i=t=r[1],(C(t)||void 0!==e)&&!Y(e))return _(t)||(t=function(e,t){if("function"==typeof i&&(t=i.call(this,e,t)),!Y(t))return t}),r[1]=t,O.apply(R,r)}}),N.prototype[F]||i(32)(N.prototype,F,N.prototype.valueOf),c(N,"Symbol"),c(Math,"Math",!0),c(r.JSON,"JSON",!0)},function(e,t,i){var r=i(54)("meta"),o=i(33),n=i(31),a=i(28).f,s=0,l=Object.isExtensible||function(){return!0},u=!i(37)((function(){return l(Object.preventExtensions({}))})),h=function(e){a(e,r,{value:{i:"O"+ ++s,w:{}}})},c=e.exports={KEY:r,NEED:!1,fastKey:function(e,t){if(!o(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!n(e,r)){if(!l(e))return"F";if(!t)return"E";h(e)}return e[r].i},getWeak:function(e,t){if(!n(e,r)){if(!l(e))return!0;if(!t)return!1;h(e)}return e[r].w},onFreeze:function(e){return u&&c.NEED&&l(e)&&!n(e,r)&&h(e),e}}},function(e,t,i){var r=i(53),o=i(117),n=i(89);e.exports=function(e){var t=r(e),i=o.f;if(i)for(var a,s=i(e),l=n.f,u=0;s.length>u;)l.call(e,a=s[u++])&&t.push(a);return t}},function(e,t,i){var r=i(36),o=i(118).f,n={}.toString,a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return a&&"[object Window]"==n.call(e)?function(e){try{return o(e)}catch(e){return a.slice()}}(e):o(r(e))}},function(e,t,i){var r=i(89),o=i(57),n=i(36),a=i(76),s=i(31),l=i(107),u=Object.getOwnPropertyDescriptor;t.f=i(24)?u:function(e,t){if(e=n(e),t=a(t,!0),l)try{return u(e,t)}catch(e){}if(s(e,t))return o(!r.f.call(e,t),e[t])}},function(e,t,i){i(88)("asyncIterator")},function(e,t,i){i(88)("observable")},function(e,t,i){var r,o,n;
/**
 * @license long.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
 * Released under the Apache License, Version 2.0
 * see: https://github.com/dcodeIO/long.js for details
 */o=[],void 0===(n="function"==typeof(r=function(){"use strict";function e(e,t,i){this.low=0|e,this.high=0|t,this.unsigned=!!i}function t(e){return!0===(e&&e.__isLong__)}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1}),e.isLong=t;var i={},r={};function o(e,t){var o,n,s;return t?(s=0<=(e>>>=0)&&e<256)&&(n=r[e])?n:(o=a(e,(0|e)<0?-1:0,!0),s&&(r[e]=o),o):(s=-128<=(e|=0)&&e<128)&&(n=i[e])?n:(o=a(e,e<0?-1:0,!1),s&&(i[e]=o),o)}function n(e,t){if(isNaN(e)||!isFinite(e))return t?g:f;if(t){if(e<0)return g;if(e>=c)return y}else{if(e<=-p)return A;if(e+1>=p)return C}return e<0?n(-e,t).neg():a(e%h|0,e/h|0,t)}function a(t,i,r){return new e(t,i,r)}e.fromInt=o,e.fromNumber=n,e.fromBits=a;var s=Math.pow;function l(e,t,i){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return f;if("number"==typeof t?(i=t,t=!1):t=!!t,(i=i||10)<2||36<i)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return l(e.substring(1),t,i).neg();for(var o=n(s(i,8)),a=f,u=0;u<e.length;u+=8){var h=Math.min(8,e.length-u),c=parseInt(e.substring(u,u+h),i);if(h<8){var p=n(s(i,h));a=a.mul(p).add(n(c))}else a=(a=a.mul(o)).add(n(c))}return a.unsigned=t,a}function u(t){return t instanceof e?t:"number"==typeof t?n(t):"string"==typeof t?l(t):a(t.low,t.high,t.unsigned)}e.fromString=l,e.fromValue=u;var h=4294967296,c=h*h,p=c/2,d=o(1<<24),f=o(0);e.ZERO=f;var g=o(0,!0);e.UZERO=g;var m=o(1);e.ONE=m;var _=o(1,!0);e.UONE=_;var v=o(-1);e.NEG_ONE=v;var C=a(-1,2147483647,!1);e.MAX_VALUE=C;var y=a(-1,-1,!0);e.MAX_UNSIGNED_VALUE=y;var A=a(0,-2147483648,!1);e.MIN_VALUE=A;var I=e.prototype;return I.toInt=function(){return this.unsigned?this.low>>>0:this.low},I.toNumber=function(){return this.unsigned?(this.high>>>0)*h+(this.low>>>0):this.high*h+(this.low>>>0)},I.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(A)){var t=n(e),i=this.div(t),r=i.mul(t).sub(this);return i.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var o=n(s(e,6),this.unsigned),a=this,l="";;){var u=a.div(o),h=(a.sub(u.mul(o)).toInt()>>>0).toString(e);if((a=u).isZero())return h+l;for(;h.length<6;)h="0"+h;l=""+h+l}},I.getHighBits=function(){return this.high},I.getHighBitsUnsigned=function(){return this.high>>>0},I.getLowBits=function(){return this.low},I.getLowBitsUnsigned=function(){return this.low>>>0},I.getNumBitsAbs=function(){if(this.isNegative())return this.eq(A)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},I.isZero=function(){return 0===this.high&&0===this.low},I.isNegative=function(){return!this.unsigned&&this.high<0},I.isPositive=function(){return this.unsigned||this.high>=0},I.isOdd=function(){return 1==(1&this.low)},I.isEven=function(){return 0==(1&this.low)},I.equals=function(e){return t(e)||(e=u(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},I.eq=I.equals,I.notEquals=function(e){return!this.eq(e)},I.neq=I.notEquals,I.lessThan=function(e){return this.comp(e)<0},I.lt=I.lessThan,I.lessThanOrEqual=function(e){return this.comp(e)<=0},I.lte=I.lessThanOrEqual,I.greaterThan=function(e){return this.comp(e)>0},I.gt=I.greaterThan,I.greaterThanOrEqual=function(e){return this.comp(e)>=0},I.gte=I.greaterThanOrEqual,I.compare=function(e){if(t(e)||(e=u(e)),this.eq(e))return 0;var i=this.isNegative(),r=e.isNegative();return i&&!r?-1:!i&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},I.comp=I.compare,I.negate=function(){return!this.unsigned&&this.eq(A)?A:this.not().add(m)},I.neg=I.negate,I.add=function(e){t(e)||(e=u(e));var i=this.high>>>16,r=65535&this.high,o=this.low>>>16,n=65535&this.low,s=e.high>>>16,l=65535&e.high,h=e.low>>>16,c=0,p=0,d=0,f=0;return d+=(f+=n+(65535&e.low))>>>16,p+=(d+=o+h)>>>16,c+=(p+=r+l)>>>16,c+=i+s,a((d&=65535)<<16|(f&=65535),(c&=65535)<<16|(p&=65535),this.unsigned)},I.subtract=function(e){return t(e)||(e=u(e)),this.add(e.neg())},I.sub=I.subtract,I.multiply=function(e){if(this.isZero())return f;if(t(e)||(e=u(e)),e.isZero())return f;if(this.eq(A))return e.isOdd()?A:f;if(e.eq(A))return this.isOdd()?A:f;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(d)&&e.lt(d))return n(this.toNumber()*e.toNumber(),this.unsigned);var i=this.high>>>16,r=65535&this.high,o=this.low>>>16,s=65535&this.low,l=e.high>>>16,h=65535&e.high,c=e.low>>>16,p=65535&e.low,g=0,m=0,_=0,v=0;return _+=(v+=s*p)>>>16,m+=(_+=o*p)>>>16,_&=65535,m+=(_+=s*c)>>>16,g+=(m+=r*p)>>>16,m&=65535,g+=(m+=o*c)>>>16,m&=65535,g+=(m+=s*h)>>>16,g+=i*p+r*c+o*h+s*l,a((_&=65535)<<16|(v&=65535),(g&=65535)<<16|(m&=65535),this.unsigned)},I.mul=I.multiply,I.divide=function(e){if(t(e)||(e=u(e)),e.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?g:f;var i,r,o;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return g;if(e.gt(this.shru(1)))return _;o=g}else{if(this.eq(A))return e.eq(m)||e.eq(v)?A:e.eq(A)?m:(i=this.shr(1).div(e).shl(1)).eq(f)?e.isNegative()?m:v:(r=this.sub(e.mul(i)),o=i.add(r.div(e)));if(e.eq(A))return this.unsigned?g:f;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();o=f}for(r=this;r.gte(e);){i=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(i)/Math.LN2),l=a<=48?1:s(2,a-48),h=n(i),c=h.mul(e);c.isNegative()||c.gt(r);)c=(h=n(i-=l,this.unsigned)).mul(e);h.isZero()&&(h=m),o=o.add(h),r=r.sub(c)}return o},I.div=I.divide,I.modulo=function(e){return t(e)||(e=u(e)),this.sub(this.div(e).mul(e))},I.mod=I.modulo,I.not=function(){return a(~this.low,~this.high,this.unsigned)},I.and=function(e){return t(e)||(e=u(e)),a(this.low&e.low,this.high&e.high,this.unsigned)},I.or=function(e){return t(e)||(e=u(e)),a(this.low|e.low,this.high|e.high,this.unsigned)},I.xor=function(e){return t(e)||(e=u(e)),a(this.low^e.low,this.high^e.high,this.unsigned)},I.shiftLeft=function(e){return t(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?a(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):a(0,this.low<<e-32,this.unsigned)},I.shl=I.shiftLeft,I.shiftRight=function(e){return t(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?a(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):a(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},I.shr=I.shiftRight,I.shiftRightUnsigned=function(e){if(t(e)&&(e=e.toInt()),0==(e&=63))return this;var i=this.high;return e<32?a(this.low>>>e|i<<32-e,i>>>e,this.unsigned):a(32===e?i:i>>>e-32,0,this.unsigned)},I.shru=I.shiftRightUnsigned,I.toSigned=function(){return this.unsigned?a(this.low,this.high,!1):this},I.toUnsigned=function(){return this.unsigned?this:a(this.low,this.high,!0)},I.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},I.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24&255,255&e,e>>>8&255,e>>>16&255,e>>>24&255]},I.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24&255,e>>>16&255,e>>>8&255,255&e,t>>>24&255,t>>>16&255,t>>>8&255,255&t]},e})?r.apply(t,o):r)||(e.exports=n)},function(e,t){},function(e,t,i){"use strict";i(190)("bold",(function(e){return function(){return e(this,"b","","")}}))},function(e,t,i){var r=i(22),o=i(19),n=i(26),a=/"/g,s=function(e,t,i,r){var o=String(n(e)),s="<"+t;return""!==i&&(s+=" "+i+'="'+String(r).replace(a,"&quot;")+'"'),s+">"+o+"</"+t+">"};e.exports=function(e,t){var i={};i[e]=t(s),r(r.P+r.F*o((function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3})),"String",i)}},function(e,t,i){var r=i(22);r(r.P,"Array",{fill:i(90)}),i(96)("fill")},function(e,t,i){i(193);var r=i(5).Object;e.exports=function(e,t){return r.defineProperties(e,t)}},function(e,t,i){var r=i(10);r(r.S+r.F*!i(24),"Object",{defineProperties:i(109)})},function(e,t,i){i(38)("Uint8",1,(function(e){return function(t,i,r){return e(this,t,i,r)}}),!0)},function(e,t,i){"use strict";var r=i(13),o=i(14),n=i(46),a=i(123),s=i(20),l=i(124),u=i(19),h=i(125),c=i(27),p=i(17),d=i(126),f=i(63).f,g=i(21).f,m=i(90),_=i(69),v=r.ArrayBuffer,C=r.DataView,y=r.Math,A=r.RangeError,I=r.Infinity,b=v,w=y.abs,E=y.pow,G=y.floor,S=y.log,P=y.LN2,T=o?"_b":"buffer",x=o?"_l":"byteLength",M=o?"_o":"byteOffset";function L(e,t,i){var r,o,n,a=new Array(i),s=8*i-t-1,l=(1<<s)-1,u=l>>1,h=23===t?E(2,-24)-E(2,-77):0,c=0,p=e<0||0===e&&1/e<0?1:0;for((e=w(e))!=e||e===I?(o=e!=e?1:0,r=l):(r=G(S(e)/P),e*(n=E(2,-r))<1&&(r--,n*=2),(e+=r+u>=1?h/n:h*E(2,1-u))*n>=2&&(r++,n/=2),r+u>=l?(o=0,r=l):r+u>=1?(o=(e*n-1)*E(2,t),r+=u):(o=e*E(2,u-1)*E(2,t),r=0));t>=8;a[c++]=255&o,o/=256,t-=8);for(r=r<<t|o,s+=t;s>0;a[c++]=255&r,r/=256,s-=8);return a[--c]|=128*p,a}function N(e,t,i){var r,o=8*i-t-1,n=(1<<o)-1,a=n>>1,s=o-7,l=i-1,u=e[l--],h=127&u;for(u>>=7;s>0;h=256*h+e[l],l--,s-=8);for(r=h&(1<<-s)-1,h>>=-s,s+=t;s>0;r=256*r+e[l],l--,s-=8);if(0===h)h=1-a;else{if(h===n)return r?NaN:u?-I:I;r+=E(2,t),h-=a}return(u?-1:1)*r*E(2,h-t)}function R(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]}function O(e){return[255&e]}function D(e){return[255&e,e>>8&255]}function F(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]}function U(e){return L(e,52,8)}function B(e){return L(e,23,4)}function k(e,t,i){g(e.prototype,t,{get:function(){return this[i]}})}function V(e,t,i,r){var o=d(+i);if(o+t>e[x])throw A("Wrong index!");var n=e[T]._b,a=o+e[M],s=n.slice(a,a+t);return r?s:s.reverse()}function W(e,t,i,r,o,n){var a=d(+i);if(a+t>e[x])throw A("Wrong index!");for(var s=e[T]._b,l=a+e[M],u=r(+o),h=0;h<t;h++)s[l+h]=u[n?h:t-h-1]}if(a.ABV){if(!u((function(){v(1)}))||!u((function(){new v(-1)}))||u((function(){return new v,new v(1.5),new v(NaN),"ArrayBuffer"!=v.name}))){for(var j,z=(v=function(e){return h(this,v),new b(d(e))}).prototype=b.prototype,H=f(b),q=0;H.length>q;)(j=H[q++])in v||s(v,j,b[j]);n||(z.constructor=v)}var X=new C(new v(2)),Y=C.prototype.setInt8;X.setInt8(0,2147483648),X.setInt8(1,2147483649),!X.getInt8(0)&&X.getInt8(1)||l(C.prototype,{setInt8:function(e,t){Y.call(this,e,t<<24>>24)},setUint8:function(e,t){Y.call(this,e,t<<24>>24)}},!0)}else v=function(e){h(this,v,"ArrayBuffer");var t=d(e);this._b=m.call(new Array(t),0),this[x]=t},C=function(e,t,i){h(this,C,"DataView"),h(e,v,"DataView");var r=e[x],o=c(t);if(o<0||o>r)throw A("Wrong offset!");if(o+(i=void 0===i?r-o:p(i))>r)throw A("Wrong length!");this[T]=e,this[M]=o,this[x]=i},o&&(k(v,"byteLength","_l"),k(C,"buffer","_b"),k(C,"byteLength","_l"),k(C,"byteOffset","_o")),l(C.prototype,{getInt8:function(e){return V(this,1,e)[0]<<24>>24},getUint8:function(e){return V(this,1,e)[0]},getInt16:function(e){var t=V(this,2,e,arguments[1]);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=V(this,2,e,arguments[1]);return t[1]<<8|t[0]},getInt32:function(e){return R(V(this,4,e,arguments[1]))},getUint32:function(e){return R(V(this,4,e,arguments[1]))>>>0},getFloat32:function(e){return N(V(this,4,e,arguments[1]),23,4)},getFloat64:function(e){return N(V(this,8,e,arguments[1]),52,8)},setInt8:function(e,t){W(this,1,e,O,t)},setUint8:function(e,t){W(this,1,e,O,t)},setInt16:function(e,t){W(this,2,e,D,t,arguments[2])},setUint16:function(e,t){W(this,2,e,D,t,arguments[2])},setInt32:function(e,t){W(this,4,e,F,t,arguments[2])},setUint32:function(e,t){W(this,4,e,F,t,arguments[2])},setFloat32:function(e,t){W(this,4,e,B,t,arguments[2])},setFloat64:function(e,t){W(this,8,e,U,t,arguments[2])}});_(v,"ArrayBuffer"),_(C,"DataView"),s(C.prototype,a.VIEW,!0),t.ArrayBuffer=v,t.DataView=C},function(e,t,i){var r=i(34),o=i(7)("iterator"),n=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||n[o]===e)}},function(e,t,i){var r=i(59),o=i(7)("iterator"),n=i(34);e.exports=i(45).getIteratorMethod=function(e){if(null!=e)return e[o]||e["@@iterator"]||n[r(e)]}},function(e,t,i){var r=i(50),o=i(99),n=i(35),a=i(17),s=i(199);e.exports=function(e,t){var i=1==e,l=2==e,u=3==e,h=4==e,c=6==e,p=5==e||c,d=t||s;return function(t,s,f){for(var g,m,_=n(t),v=o(_),C=r(s,f,3),y=a(v.length),A=0,I=i?d(t,y):l?d(t,0):void 0;y>A;A++)if((p||A in v)&&(m=C(g=v[A],A,_),e))if(i)I[A]=m;else if(m)switch(e){case 3:return!0;case 5:return g;case 6:return A;case 2:I.push(g)}else if(h)return!1;return c?-1:u||h?h:I}}},function(e,t,i){var r=i(200);e.exports=function(e,t){return new(r(e))(t)}},function(e,t,i){var r=i(25),o=i(201),n=i(7)("species");e.exports=function(e){var t;return o(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!o(t.prototype)||(t=void 0),r(t)&&null===(t=t[n])&&(t=void 0)),void 0===t?Array:t}},function(e,t,i){var r=i(41);e.exports=Array.isArray||function(e){return"Array"==r(e)}},function(e,t,i){var r=i(7)("iterator"),o=!1;try{var n=[7][r]();n.return=function(){o=!0},Array.from(n,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!o)return!1;var i=!1;try{var n=[7],a=n[r]();a.next=function(){return{done:i=!0}},n[r]=function(){return a},e(n)}catch(e){}return i}},function(e,t,i){"use strict";var r=i(35),o=i(51),n=i(17);e.exports=[].copyWithin||function(e,t){var i=r(this),a=n(i.length),s=o(e,a),l=o(t,a),u=arguments.length>2?arguments[2]:void 0,h=Math.min((void 0===u?a:o(u,a))-l,a-s),c=1;for(l<s&&s<l+h&&(c=-1,l+=h-1,s+=h-1);h-- >0;)l in i?i[s]=i[l]:delete i[s],s+=c,l+=c;return i}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,i){i(38)("Uint32",4,(function(e){return function(t,i,r){return e(this,t,i,r)}}))},function(e,t,i){i(38)("Float64",8,(function(e){return function(t,i,r){return e(this,t,i,r)}}))},function(e,t,i){i(38)("Uint8",1,(function(e){return function(t,i,r){return e(this,t,i,r)}}))},function(e,t,i){var r=i(22);r(r.S,"Math",{log2:function(e){return Math.log(e)/Math.LN2}})},function(e,t,i){i(210),e.exports=i(5).Date.now},function(e,t,i){var r=i(10);r(r.S,"Date",{now:function(){return(new Date).getTime()}})},function(e,t,i){var r=i(22);r(r.P,"String",{repeat:i(212)})},function(e,t,i){"use strict";var r=i(27),o=i(26);e.exports=function(e){var t=String(o(this)),i="",n=r(e);if(n<0||n==1/0)throw RangeError("Count can't be negative");for(;n>0;(n>>>=1)&&(t+=t))1&n&&(i+=t);return i}},function(e,t,i){i(38)("Uint16",2,(function(e){return function(t,i,r){return e(this,t,i,r)}}))},function(e,t,i){i(119),i(113),i(116),i(215),i(227),i(228),e.exports=i(5).Promise},function(e,t,i){"use strict";var r,o,n,a,s=i(43),l=i(8),u=i(55),h=i(132),c=i(10),p=i(33),d=i(56),f=i(216),g=i(217),m=i(133),_=i(134).set,v=i(222)(),C=i(92),y=i(135),A=i(223),I=i(136),b=l.TypeError,w=l.process,E=w&&w.versions,G=E&&E.v8||"",S=l.Promise,P="process"==h(w),T=function(){},x=o=C.f,M=!!function(){try{var e=S.resolve(1),t=(e.constructor={})[i(15)("species")]=function(e){e(T,T)};return(P||"function"==typeof PromiseRejectionEvent)&&e.then(T)instanceof t&&0!==G.indexOf("6.6")&&-1===A.indexOf("Chrome/66")}catch(e){}}(),L=function(e){var t;return!(!p(e)||"function"!=typeof(t=e.then))&&t},N=function(e,t){if(!e._n){e._n=!0;var i=e._c;v((function(){for(var r=e._v,o=1==e._s,n=0,a=function(t){var i,n,a,s=o?t.ok:t.fail,l=t.resolve,u=t.reject,h=t.domain;try{s?(o||(2==e._h&&D(e),e._h=1),!0===s?i=r:(h&&h.enter(),i=s(r),h&&(h.exit(),a=!0)),i===t.promise?u(b("Promise-chain cycle")):(n=L(i))?n.call(i,l,u):l(i)):u(r)}catch(e){h&&!a&&h.exit(),u(e)}};i.length>n;)a(i[n++]);e._c=[],e._n=!1,t&&!e._h&&R(e)}))}},R=function(e){_.call(l,(function(){var t,i,r,o=e._v,n=O(e);if(n&&(t=y((function(){P?w.emit("unhandledRejection",o,e):(i=l.onunhandledrejection)?i({promise:e,reason:o}):(r=l.console)&&r.error&&r.error("Unhandled promise rejection",o)})),e._h=P||O(e)?2:1),e._a=void 0,n&&t.e)throw t.v}))},O=function(e){return 1!==e._h&&0===(e._a||e._c).length},D=function(e){_.call(l,(function(){var t;P?w.emit("rejectionHandled",e):(t=l.onrejectionhandled)&&t({promise:e,reason:e._v})}))},F=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),N(t,!0))},U=function(e){var t,i=this;if(!i._d){i._d=!0,i=i._w||i;try{if(i===e)throw b("Promise can't be resolved itself");(t=L(e))?v((function(){var r={_w:i,_d:!1};try{t.call(e,u(U,r,1),u(F,r,1))}catch(e){F.call(r,e)}})):(i._v=e,i._s=1,N(i,!1))}catch(e){F.call({_w:i,_d:!1},e)}}};M||(S=function(e){f(this,S,"Promise","_h"),d(e),r.call(this);try{e(u(U,this,1),u(F,this,1))}catch(e){F.call(this,e)}},(r=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=i(224)(S.prototype,{then:function(e,t){var i=x(m(this,S));return i.ok="function"!=typeof e||e,i.fail="function"==typeof t&&t,i.domain=P?w.domain:void 0,this._c.push(i),this._a&&this._a.push(i),this._s&&N(this,!1),i.promise},catch:function(e){return this.then(void 0,e)}}),n=function(){var e=new r;this.promise=e,this.resolve=u(U,e,1),this.reject=u(F,e,1)},C.f=x=function(e){return e===S||e===a?new n(e):o(e)}),c(c.G+c.W+c.F*!M,{Promise:S}),i(62)(S,"Promise"),i(225)("Promise"),a=i(5).Promise,c(c.S+c.F*!M,"Promise",{reject:function(e){var t=x(this);return(0,t.reject)(e),t.promise}}),c(c.S+c.F*(s||!M),"Promise",{resolve:function(e){return I(s&&this===a?S:this,e)}}),c(c.S+c.F*!(M&&i(226)((function(e){S.all(e).catch(T)}))),"Promise",{all:function(e){var t=this,i=x(t),r=i.resolve,o=i.reject,n=y((function(){var i=[],n=0,a=1;g(e,!1,(function(e){var s=n++,l=!1;i.push(void 0),a++,t.resolve(e).then((function(e){l||(l=!0,i[s]=e,--a||r(i))}),o)})),--a||r(i)}));return n.e&&o(n.v),i.promise},race:function(e){var t=this,i=x(t),r=i.reject,o=y((function(){g(e,!1,(function(e){t.resolve(e).then(i.resolve,r)}))}));return o.e&&r(o.v),i.promise}})},function(e,t){e.exports=function(e,t,i,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(i+": incorrect invocation!");return e}},function(e,t,i){var r=i(55),o=i(218),n=i(219),a=i(29),s=i(106),l=i(220),u={},h={};(t=e.exports=function(e,t,i,c,p){var d,f,g,m,_=p?function(){return e}:l(e),v=r(i,c,t?2:1),C=0;if("function"!=typeof _)throw TypeError(e+" is not iterable!");if(n(_)){for(d=s(e.length);d>C;C++)if((m=t?v(a(f=e[C])[0],f[1]):v(e[C]))===u||m===h)return m}else for(g=_.call(e);!(f=g.next()).done;)if((m=o(g,v,f.value,t))===u||m===h)return m}).BREAK=u,t.RETURN=h},function(e,t,i){var r=i(29);e.exports=function(e,t,i,o){try{return o?t(r(i)[0],i[1]):t(i)}catch(t){var n=e.return;throw void 0!==n&&r(n.call(e)),t}}},function(e,t,i){var r=i(44),o=i(15)("iterator"),n=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||n[o]===e)}},function(e,t,i){var r=i(132),o=i(15)("iterator"),n=i(44);e.exports=i(5).getIteratorMethod=function(e){if(null!=e)return e[o]||e["@@iterator"]||n[r(e)]}},function(e,t){e.exports=function(e,t,i){var r=void 0===i;switch(t.length){case 0:return r?e():e.call(i);case 1:return r?e(t[0]):e.call(i,t[0]);case 2:return r?e(t[0],t[1]):e.call(i,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(i,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(i,t[0],t[1],t[2],t[3])}return e.apply(i,t)}},function(e,t,i){var r=i(8),o=i(134).set,n=r.MutationObserver||r.WebKitMutationObserver,a=r.process,s=r.Promise,l="process"==i(42)(a);e.exports=function(){var e,t,i,u=function(){var r,o;for(l&&(r=a.domain)&&r.exit();e;){o=e.fn,e=e.next;try{o()}catch(r){throw e?i():t=void 0,r}}t=void 0,r&&r.enter()};if(l)i=function(){a.nextTick(u)};else if(!n||r.navigator&&r.navigator.standalone)if(s&&s.resolve){var h=s.resolve(void 0);i=function(){h.then(u)}}else i=function(){o.call(r,u)};else{var c=!0,p=document.createTextNode("");new n(u).observe(p,{characterData:!0}),i=function(){p.data=c=!c}}return function(r){var o={fn:r,next:void 0};t&&(t.next=o),e||(e=o,i()),t=o}}},function(e,t,i){var r=i(8).navigator;e.exports=r&&r.userAgent||""},function(e,t,i){var r=i(32);e.exports=function(e,t,i){for(var o in t)i&&e[o]?e[o]=t[o]:r(e,o,t[o]);return e}},function(e,t,i){"use strict";var r=i(8),o=i(5),n=i(28),a=i(24),s=i(15)("species");e.exports=function(e){var t="function"==typeof o[e]?o[e]:r[e];a&&t&&!t[s]&&n.f(t,s,{configurable:!0,get:function(){return this}})}},function(e,t,i){var r=i(15)("iterator"),o=!1;try{var n=[7][r]();n.return=function(){o=!0},Array.from(n,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!o)return!1;var i=!1;try{var n=[7],a=n[r]();a.next=function(){return{done:i=!0}},n[r]=function(){return a},e(n)}catch(e){}return i}},function(e,t,i){"use strict";var r=i(10),o=i(5),n=i(8),a=i(133),s=i(136);r(r.P+r.R,"Promise",{finally:function(e){var t=a(this,o.Promise||n.Promise),i="function"==typeof e;return this.then(i?function(i){return s(t,e()).then((function(){return i}))}:e,i?function(i){return s(t,e()).then((function(){throw i}))}:e)}})},function(e,t,i){"use strict";var r=i(10),o=i(92),n=i(135);r(r.S,"Promise",{try:function(e){var t=o.f(this),i=n(e);return(i.e?t.reject:t.resolve)(i.v),t.promise}})},function(e,t,i){i(38)("Float32",4,(function(e){return function(t,i,r){return e(this,t,i,r)}}))},function(e,t,i){var r=i(25),o=i(18),n=function(e,t){if(o(e),!r(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,r){try{(r=i(50)(Function.call,i(91).f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,i){return n(e,i),t?e.__proto__=i:r(e,i),e}}({},!1):void 0),check:n}},function(e,t,i){var r=i(22),o=i(26),n=i(19),a=i(232),s="["+a+"]",l=RegExp("^"+s+s+"*"),u=RegExp(s+s+"*$"),h=function(e,t,i){var o={},s=n((function(){return!!a[e]()||"​"!="​"[e]()})),l=o[e]=s?t(c):a[e];i&&(o[i]=l),r(r.P+r.F*s,"String",o)},c=h.trim=function(e,t){return e=String(o(e)),1&t&&(e=e.replace(l,"")),2&t&&(e=e.replace(u,"")),e};e.exports=h},function(e,t){e.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},function(module,__webpack_exports__,__webpack_require__){"use strict";(function(module,global){var core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(64),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_0__),core_js_modules_es6_array_iterator__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(39),core_js_modules_es6_array_iterator__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es6_array_iterator__WEBPACK_IMPORTED_MODULE_1__),_babel_runtime_corejs2_core_js_json_stringify__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(11),_babel_runtime_corejs2_core_js_json_stringify__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_babel_runtime_corejs2_core_js_json_stringify__WEBPACK_IMPORTED_MODULE_2__),core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(82),core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_es6_function_name__WEBPACK_IMPORTED_MODULE_3__),_babel_runtime_corejs2_core_js_array_is_array__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(12),_babel_runtime_corejs2_core_js_array_is_array__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_babel_runtime_corejs2_core_js_array_is_array__WEBPACK_IMPORTED_MODULE_4__),core_js_modules_es6_string_ends_with__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(128),core_js_modules_es6_string_ends_with__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(core_js_modules_es6_string_ends_with__WEBPACK_IMPORTED_MODULE_5__),core_js_modules_es6_string_starts_with__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(131),core_js_modules_es6_string_starts_with__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(core_js_modules_es6_string_starts_with__WEBPACK_IMPORTED_MODULE_6__),_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(0),_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7__),core_js_modules_es6_number_constructor__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(140),core_js_modules_es6_number_constructor__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(core_js_modules_es6_number_constructor__WEBPACK_IMPORTED_MODULE_8__),core_js_modules_es6_regexp_search__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(235),core_js_modules_es6_regexp_search__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(core_js_modules_es6_regexp_search__WEBPACK_IMPORTED_MODULE_9__),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(86),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_10__),_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(2),_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11__),_babel_runtime_corejs2_core_js_symbol_iterator__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(9),_babel_runtime_corejs2_core_js_symbol_iterator__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(_babel_runtime_corejs2_core_js_symbol_iterator__WEBPACK_IMPORTED_MODULE_12__),_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(1),_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_13___default=__webpack_require__.n(_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_13__),_babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(3),_babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14___default=__webpack_require__.n(_babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14__),core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(83),core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_15___default=__webpack_require__.n(core_js_modules_es6_regexp_to_string__WEBPACK_IMPORTED_MODULE_15__),core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(84),core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_16___default=__webpack_require__.n(core_js_modules_es6_object_to_string__WEBPACK_IMPORTED_MODULE_16__),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(77),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_17___default=__webpack_require__.n(core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_17__),core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(137),core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_18___default=__webpack_require__.n(core_js_modules_es6_regexp_match__WEBPACK_IMPORTED_MODULE_18__),core_js_modules_es6_regexp_constructor__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(138),core_js_modules_es6_regexp_constructor__WEBPACK_IMPORTED_MODULE_19___default=__webpack_require__.n(core_js_modules_es6_regexp_constructor__WEBPACK_IMPORTED_MODULE_19__),require,require;window.GeoGlobe=window.GeoGlobe||{},window.GeoGlobe.Class=window.GeoGlobe.Class||{},window.GeoGlobe.LngLatBounds=window.GeoGlobe.LngLatBounds||{},window.GeoGlobe.LngLat=window.GeoGlobe.LngLat||{},window.GeoGlobe.Filter=window.GeoGlobe.Filter||{},window.GeoGlobe.Format=window.GeoGlobe.Format||{},window.GeoGlobe.Protocol=window.GeoGlobe.Protocol||{},window.GeoGlobe.Query=window.GeoGlobe.Query||{},window.GeoGlobe.Service=window.GeoGlobe.Service||{},window.GeoGlobe.Analysis=window.GeoGlobe.Analysis||{},GeoGlobe.getScriptLocation=function(e){for(var t="",i=new RegExp("(^|(.*?\\/))("+e+")(\\?|$)"),r=document.getElementsByTagName("script"),o=0,n=r.length;o<n;o++){var a=r[o].getAttribute("src");if(a){var s=a.match(i);if(s){t=s[1];break}}}return t},GeoGlobe.createNS=function(e){for(var t=e.split("."),i=window,r=0;r<t.length;r++)i[t[r]]||(i[t[r]]={}),i=i[t[r]]},GeoGlobe.Class=function(){var e=arguments.length,t=arguments[0],i=arguments[e-1],r="function"==typeof i.initialize?i.initialize:function(){t.prototype.initialize.apply(this,arguments)};return 1<e?[r,t].concat(Array.prototype.slice.call(arguments).slice(1,e-1),i):r.prototype=i,r},GeoGlobe.Class4OL=function(){var e=arguments.length,t=arguments[0],i=arguments[e-1],r="function"==typeof i.initialize?i.initialize:function(){t.prototype.initialize.apply(this,arguments)};if(1<e){var o=[r,t].concat(Array.prototype.slice.call(arguments).slice(1,e-1),i);GeoGlobe.inherit.apply(null,o)}else r.prototype=i;return r},GeoGlobe.inherit=function(e,t){function i(){}var r,o,n;for(i.prototype=t.prototype,e.prototype=new i,r=2,o=arguments.length;r<o;r++)"function"==typeof(n=arguments[r])&&(n=n.prototype),GeoGlobe.Util.extend(e.prototype,n)},GeoGlobe.Util=GeoGlobe.Util||{},GeoGlobe.Util.extend=function(e,t){if(e=e||{},t){for(var i in t){var r=t[i];void 0!==r&&(e[i]=r)}!("function"==typeof window.Event&&t instanceof window.Event)&&t.hasOwnProperty&&t.hasOwnProperty("toString")&&(e.toString=t.toString)}return e},GeoGlobe.Util.deepExtend=function(e){for(var t=1;t<arguments.length;t++)for(var i in arguments[t])if(arguments[t].hasOwnProperty(i))switch(GeoGlobe.Util.getType(arguments[t][i])){case"array":e.hasOwnProperty(i)&&"array"===GeoGlobe.Util.getType(e[i])?GeoGlobe.Util.deepExtend(e[i],arguments[t][i]):e[i]=GeoGlobe.Util.deepExtend([],arguments[t][i]);break;case"object":e.hasOwnProperty(i)&&"object"===GeoGlobe.Util.getType(e[i])?GeoGlobe.Util.deepExtend(e[i],arguments[t][i]):e[i]=GeoGlobe.Util.deepExtend({},arguments[t][i]);break;default:e[i]=arguments[t][i]}return e};var _typeof="function"==typeof _babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14___default.a&&"symbol"==_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_13___default()(_babel_runtime_corejs2_core_js_symbol_iterator__WEBPACK_IMPORTED_MODULE_12___default.a)?function(e){return _babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_13___default()(e)}:function(e){return e&&"function"==typeof _babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14___default.a&&e.constructor===_babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14___default.a&&e!==_babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14___default.a.prototype?"symbol":_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_13___default()(e)},e;GeoGlobe.Util=GeoGlobe.Util||{},GeoGlobe.Util.getElement=function(){for(var e=[],t=0,i=arguments.length;t<i;t++){var r=arguments[t];if("string"==typeof r&&(r=document.getElementById(r)),1==arguments.length)return r;e.push(r)}return e},GeoGlobe.Util.isElement=function(e){return!(!e||1!==e.nodeType)},GeoGlobe.Util.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},GeoGlobe.Util.removeItem=function(e,t){for(var i=e.length-1;0<=i;i--)e[i]==t&&e.splice(i,1);return e},GeoGlobe.Util.indexOf=function(e,t){if("function"==typeof e.indexOf)return e.indexOf(t);for(var i=0,r=e.length;i<r;i++)if(e[i]==t)return i;return-1},GeoGlobe.Util.dotless=/\./g,GeoGlobe.IMAGE_RELOAD_ATTEMPTS=0,GeoGlobe.Util.alphaHackNeeded=null,GeoGlobe.Util.alphaHack=function(){if(null==GeoGlobe.Util.alphaHackNeeded){var e=navigator.appVersion.split("MSIE"),t=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(e[1]),i=!1;try{i=!!document.body.filters}catch(e){}GeoGlobe.Util.alphaHackNeeded=i&&5.5<=t&&t<7}return GeoGlobe.Util.alphaHackNeeded},GeoGlobe.Util.upperCaseObject=function(e){var t={};for(var i in e)t[i.toUpperCase()]=e[i];return t},GeoGlobe.Util.applyDefaults=function(e,t){e=e||{};var i="function"==typeof window.Event&&t instanceof window.Event;for(var r in t)(void 0===e[r]||!i&&t.hasOwnProperty&&t.hasOwnProperty(r)&&!e.hasOwnProperty(r))&&(e[r]=t[r]);return!i&&t&&t.hasOwnProperty&&t.hasOwnProperty("toString")&&!e.hasOwnProperty("toString")&&(e.toString=t.toString),e},GeoGlobe.Util.getParameterString=function(e){var t=[];for(var i in e){var r=e[i];if(null!=r&&"function"!=typeof r){var o;if("object"==(void 0===r?"undefined":_typeof(r))&&r.constructor==Array){for(var n,a=[],s=0,l=r.length;s<l;s++)n=r[s],a.push(encodeURIComponent(null==n?"":n));o=a.join(",")}else o=encodeURIComponent(r);t.push(encodeURIComponent(i)+"="+o)}}return t.join("&")},GeoGlobe.Util.urlAppend=function(e,t){var i=e;if(t){var r=(e+" ").split(/[?&]/);i+=" "===r.pop()?t:r.length?"&"+t:"?"+t}return i},GeoGlobe.Util.getImagesLocation=function(){return GeoGlobe.ImgPath||GeoGlobe._getScriptLocation()+"img/"},GeoGlobe.Util.getImageLocation=function(e){return GeoGlobe.Util.getImagesLocation()+e},GeoGlobe.Util.Try=function(){for(var e=null,t=0,i=arguments.length;t<i;t++){var r=arguments[t];try{e=r();break}catch(e){}}return e},GeoGlobe.Util.getXmlNodeValue=function(e){var t=null;return GeoGlobe.Util.Try((function(){t=(t=(t=e.text)||e.textContent)||e.firstChild.nodeValue}),(function(){t=e.textContent})),t},GeoGlobe.Util.mouseLeft=function(e,t){for(var i=e.relatedTarget?e.relatedTarget:e.toElement;i!=t&&null!=i;)i=i.parentNode;return i!=t},GeoGlobe.Util.DEFAULT_PRECISION=14,GeoGlobe.Util.toFloat=function(e,t){return null==t&&(t=GeoGlobe.Util.DEFAULT_PRECISION),"number"!=typeof e&&(e=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(e)),0===t?e:_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(e.toPrecision(t))},GeoGlobe.Util.rad=function(e){return e*Math.PI/180},GeoGlobe.Util.deg=function(e){return 180*e/Math.PI},GeoGlobe.Util.VincentyConstants={a:6378137,b:6356752.3142,f:1/298.257223563},GeoGlobe.Util.distVincenty=function(e,t){for(var i=GeoGlobe.Util.VincentyConstants,r=i.a,o=i.b,n=i.f,a=GeoGlobe.Util.rad(t.lng-e.lng),s=Math.atan((1-n)*Math.tan(GeoGlobe.Util.rad(e.lat))),l=Math.atan((1-n)*Math.tan(GeoGlobe.Util.rad(t.lat))),u=Math.sin(s),h=Math.cos(s),c=Math.sin(l),p=Math.cos(l),d=a,f=2*Math.PI,g=20;1e-12<Math.abs(d-f)&&0<--g;){var m=Math.sin(d),_=Math.cos(d),v=Math.sqrt(p*m*(p*m)+(h*c-u*p*_)*(h*c-u*p*_));if(0==v)return 0;var C=u*c+h*p*_,y=Math.atan2(v,C),A=Math.asin(h*p*m/v),I=Math.cos(A)*Math.cos(A),b=C-2*u*c/I,w=n/16*I*(4+n*(4-3*I));f=d,d=a+(1-w)*n*Math.sin(A)*(y+w*v*(b+w*C*(2*b*b-1)))}if(0==g)return NaN;var E=I*(r*r-o*o)/(o*o),G=E/1024*(256+E*(E*(74-47*E)-128));return(o*(1+E/16384*(4096+E*(E*(320-175*E)-768)))*(y-G*v*(b+G/4*(C*(2*b*b-1)-G/6*b*(4*v*v-3)*(4*b*b-3))))).toFixed(3)/1e3},GeoGlobe.Util.destinationVincenty=function(e,t,i){for(var r=GeoGlobe.Util,o=r.VincentyConstants,n=o.a,a=o.b,s=o.f,l=e.lng,u=e.lat,h=i,c=r.rad(t),p=Math.sin(c),d=Math.cos(c),f=(1-s)*Math.tan(r.rad(u)),g=1/Math.sqrt(1+f*f),m=f*g,_=Math.atan2(f,d),v=g*p,C=1-v*v,y=C*(n*n-a*a)/(a*a),A=1+y/16384*(4096+y*(y*(320-175*y)-768)),I=y/1024*(256+y*(y*(74-47*y)-128)),b=h/(a*A),w=2*Math.PI;1e-12<Math.abs(b-w);){var E=Math.cos(2*_+b),G=Math.sin(b),S=Math.cos(b);w=b,b=h/(a*A)+I*G*(E+I/4*(S*(2*E*E-1)-I/6*E*(4*G*G-3)*(4*E*E-3)))}var P=m*G-g*S*d,T=Math.atan2(m*S+g*G*d,(1-s)*Math.sqrt(v*v+P*P)),x=s/16*C*(4+s*(4-3*C)),M=Math.atan2(G*p,g*S-m*G*d)-(1-x)*s*v*(b+x*G*(E+x*S*(2*E*E-1)));return Math.atan2(v,-P),new GeoGlobe.LngLat(l+r.deg(M),r.deg(T))},GeoGlobe.Util.getParameters=function(e,t){t=t||{},e=null==e?window.location.href:e;var i="";if(GeoGlobe.String.contains(e,"?")){var r=e.indexOf("?")+1,o=GeoGlobe.String.contains(e,"#")?e.indexOf("#"):e.length;i=e.substring(r,o)}for(var n={},a=i.split(/[&;]/),s=0,l=a.length;s<l;++s){var u=a[s].split("=");if(u[0]){var h=u[0];try{h=decodeURIComponent(h)}catch(e){h=unescape(h)}var c=(u[1]||"").replace(/\+/g," ");try{c=decodeURIComponent(c)}catch(e){c=unescape(c)}!1!==t.splitArgs&&(c=c.split(",")),1==c.length&&(c=c[0]),n[h]=c}}return n},GeoGlobe.Util.lastSeqID=0,GeoGlobe.Util.createUniqueID=function(e){return e=null==e?"id_":e.replace(GeoGlobe.Util.dotless,"_"),GeoGlobe.Util.lastSeqID+=1,e+GeoGlobe.Util.lastSeqID},GeoGlobe.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:1/.0254,km:39370,dd:4374754,yd:36},GeoGlobe.INCHES_PER_UNIT.in=GeoGlobe.INCHES_PER_UNIT.inches,GeoGlobe.INCHES_PER_UNIT.degrees=GeoGlobe.INCHES_PER_UNIT.dd,GeoGlobe.INCHES_PER_UNIT.nmi=1852*GeoGlobe.INCHES_PER_UNIT.m,GeoGlobe.METERS_PER_INCH=.0254000508001016,GeoGlobe.Util.extend(GeoGlobe.INCHES_PER_UNIT,{Inch:GeoGlobe.INCHES_PER_UNIT.inches,Meter:1/GeoGlobe.METERS_PER_INCH,Foot:.3048006096012192/GeoGlobe.METERS_PER_INCH,IFoot:.3048/GeoGlobe.METERS_PER_INCH,ClarkeFoot:.3047972651151/GeoGlobe.METERS_PER_INCH,SearsFoot:.30479947153867626/GeoGlobe.METERS_PER_INCH,GoldCoastFoot:.3047997101815088/GeoGlobe.METERS_PER_INCH,IInch:.0254/GeoGlobe.METERS_PER_INCH,MicroInch:254e-7/GeoGlobe.METERS_PER_INCH,Mil:2.54e-8/GeoGlobe.METERS_PER_INCH,Centimeter:.01/GeoGlobe.METERS_PER_INCH,Kilometer:1e3/GeoGlobe.METERS_PER_INCH,Yard:.9144018288036576/GeoGlobe.METERS_PER_INCH,SearsYard:.914398414616029/GeoGlobe.METERS_PER_INCH,IndianYard:.9143985307444408/GeoGlobe.METERS_PER_INCH,IndianYd37:.91439523/GeoGlobe.METERS_PER_INCH,IndianYd62:.9143988/GeoGlobe.METERS_PER_INCH,IndianYd75:.9143985/GeoGlobe.METERS_PER_INCH,IndianFoot:.30479951/GeoGlobe.METERS_PER_INCH,IndianFt37:.30479841/GeoGlobe.METERS_PER_INCH,IndianFt62:.3047996/GeoGlobe.METERS_PER_INCH,IndianFt75:.3047995/GeoGlobe.METERS_PER_INCH,Mile:1609.3472186944373/GeoGlobe.METERS_PER_INCH,IYard:.9144/GeoGlobe.METERS_PER_INCH,IMile:1609.344/GeoGlobe.METERS_PER_INCH,NautM:1852/GeoGlobe.METERS_PER_INCH,"Lat-66":110943.31648893273/GeoGlobe.METERS_PER_INCH,"Lat-83":110946.25736872235/GeoGlobe.METERS_PER_INCH,Decimeter:.1/GeoGlobe.METERS_PER_INCH,Millimeter:.001/GeoGlobe.METERS_PER_INCH,Dekameter:10/GeoGlobe.METERS_PER_INCH,Decameter:10/GeoGlobe.METERS_PER_INCH,Hectometer:100/GeoGlobe.METERS_PER_INCH,GermanMeter:1.0000135965/GeoGlobe.METERS_PER_INCH,CaGrid:.999738/GeoGlobe.METERS_PER_INCH,ClarkeChain:20.1166194976/GeoGlobe.METERS_PER_INCH,GunterChain:20.11684023368047/GeoGlobe.METERS_PER_INCH,BenoitChain:20.116782494375872/GeoGlobe.METERS_PER_INCH,SearsChain:20.11676512155/GeoGlobe.METERS_PER_INCH,ClarkeLink:.201166194976/GeoGlobe.METERS_PER_INCH,GunterLink:.2011684023368047/GeoGlobe.METERS_PER_INCH,BenoitLink:.20116782494375873/GeoGlobe.METERS_PER_INCH,SearsLink:.2011676512155/GeoGlobe.METERS_PER_INCH,Rod:5.02921005842012/GeoGlobe.METERS_PER_INCH,IntnlChain:20.1168/GeoGlobe.METERS_PER_INCH,IntnlLink:.201168/GeoGlobe.METERS_PER_INCH,Perch:5.02921005842012/GeoGlobe.METERS_PER_INCH,Pole:5.02921005842012/GeoGlobe.METERS_PER_INCH,Furlong:201.1684023368046/GeoGlobe.METERS_PER_INCH,Rood:3.778266898/GeoGlobe.METERS_PER_INCH,CapeFoot:.3047972615/GeoGlobe.METERS_PER_INCH,Brealey:375/GeoGlobe.METERS_PER_INCH,ModAmFt:.304812252984506/GeoGlobe.METERS_PER_INCH,Fathom:1.8288/GeoGlobe.METERS_PER_INCH,"NautM-UK":1853.184/GeoGlobe.METERS_PER_INCH,"50kilometers":5e4/GeoGlobe.METERS_PER_INCH,"150kilometers":15e4/GeoGlobe.METERS_PER_INCH}),GeoGlobe.Util.extend(GeoGlobe.INCHES_PER_UNIT,{mm:GeoGlobe.INCHES_PER_UNIT.Meter/1e3,cm:GeoGlobe.INCHES_PER_UNIT.Meter/100,dm:100*GeoGlobe.INCHES_PER_UNIT.Meter,km:1e3*GeoGlobe.INCHES_PER_UNIT.Meter,kmi:GeoGlobe.INCHES_PER_UNIT.nmi,fath:GeoGlobe.INCHES_PER_UNIT.Fathom,ch:GeoGlobe.INCHES_PER_UNIT.IntnlChain,link:GeoGlobe.INCHES_PER_UNIT.IntnlLink,"us-in":GeoGlobe.INCHES_PER_UNIT.inches,"us-ft":GeoGlobe.INCHES_PER_UNIT.Foot,"us-yd":GeoGlobe.INCHES_PER_UNIT.Yard,"us-ch":GeoGlobe.INCHES_PER_UNIT.GunterChain,"us-mi":GeoGlobe.INCHES_PER_UNIT.Mile,"ind-yd":GeoGlobe.INCHES_PER_UNIT.IndianYd37,"ind-ft":GeoGlobe.INCHES_PER_UNIT.IndianFt37,"ind-ch":20.11669506/GeoGlobe.METERS_PER_INCH}),GeoGlobe.DOTS_PER_INCH=96,GeoGlobe.Util.normalizeScale=function(e){return 1<e?1/e:e},GeoGlobe.Util.getResolutionFromScale=function(e,t){var i;return e&&(null==t&&(t="degrees"),i=1/(GeoGlobe.Util.normalizeScale(e)*GeoGlobe.INCHES_PER_UNIT[t]*GeoGlobe.DOTS_PER_INCH)),i},GeoGlobe.Util.getScaleFromResolution=function(e,t){return null==t&&(t="degrees"),e*GeoGlobe.INCHES_PER_UNIT[t]*GeoGlobe.DOTS_PER_INCH},GeoGlobe.Util.pagePosition=function(e){var t=[0,0],i=GeoGlobe.Util.getViewportElement();if(!e||e==window||e==i)return t;var r,o=GeoGlobe.IS_GECKO&&document.getBoxObjectFor&&"absolute"==GeoGlobe.Element.getStyle(e,"position")&&(""==e.style.top||""==e.style.left),n=null;if(e.getBoundingClientRect){r=e.getBoundingClientRect();var a=window.pageYOffset||i.scrollTop,s=window.pageXOffset||i.scrollLeft;t[0]=r.left+s,t[1]=r.top+a}else if(document.getBoxObjectFor&&!o){r=document.getBoxObjectFor(e);var l=document.getBoxObjectFor(i);t[0]=r.screenX-l.screenX,t[1]=r.screenY-l.screenY}else{if(t[0]=e.offsetLeft,t[1]=e.offsetTop,(n=e.offsetParent)!=e)for(;n;)t[0]+=n.offsetLeft,t[1]+=n.offsetTop,n=n.offsetParent;var u=GeoGlobe.BROWSER_NAME;for(("opera"==u||"safari"==u&&"absolute"==GeoGlobe.Element.getStyle(e,"position"))&&(t[1]-=document.body.offsetTop),n=e.offsetParent;n&&n!=document.body;)t[0]-=n.scrollLeft,"opera"==u&&"TR"==n.tagName||(t[1]-=n.scrollTop),n=n.offsetParent}return t},GeoGlobe.Util.getViewportElement=function(){var e=arguments.callee.viewportElement;return null==e&&(e="msie"==GeoGlobe.BROWSER_NAME&&"CSS1Compat"!=document.compatMode?document.body:document.documentElement,arguments.callee.viewportElement=e),e},GeoGlobe.Util.isEquivalentUrl=function(e,t,i){i=i||{},GeoGlobe.Util.applyDefaults(i,{ignoreCase:!0,ignorePort80:!0,ignoreHash:!0,splitArgs:!1});var r=GeoGlobe.Util.createUrlObject(e,i),o=GeoGlobe.Util.createUrlObject(t,i);for(var n in r)if("args"!==n&&r[n]!=o[n])return!1;for(var n in r.args){if(r.args[n]!=o.args[n])return!1;delete o.args[n]}for(var n in o.args)return!1;return!0},GeoGlobe.Util.createUrlObject=function(e,t){if(t=t||{},!/^\w+:\/\//.test(e)){var i=window.location,r=i.port?":"+i.port:"",o=i.protocol+"//"+i.host.split(":").shift()+r;if(0===e.indexOf("/"))e=o+e;else{var n=i.pathname.split("/");n.pop(),e=o+n.join("/")+"/"+e}}t.ignoreCase&&(e=e.toLowerCase());var a=document.createElement("a");a.href=e;var s={};s.host=a.host.split(":").shift(),s.protocol=a.protocol,t.ignorePort80?s.port="80"==a.port||"0"==a.port?"":a.port:s.port=""==a.port||"0"==a.port?"80":a.port,s.hash=t.ignoreHash||"#"===a.hash?"":a.hash;var l=a.search;if(!l){var u=e.indexOf("?");l=-1!=u?e.substr(u):""}return s.args=GeoGlobe.Util.getParameters(l,{splitArgs:t.splitArgs}),s.pathname="/"==a.pathname.charAt(0)?a.pathname:"/"+a.pathname,s},GeoGlobe.Util.removeTail=function(e){var t=e.indexOf("?"),i=e.indexOf("#");return-1==t?-1!=i?e.substr(0,i):e:-1!=i?e.substr(0,Math.min(t,i)):e.substr(0,t)},GeoGlobe.IS_GECKO=(e=navigator.userAgent.toLowerCase(),-1==e.indexOf("webkit")&&-1!=e.indexOf("gecko")),GeoGlobe.CANVAS_SUPPORTED=function(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))}(),GeoGlobe.BROWSER_NAME=function(){var e="",t=navigator.userAgent.toLowerCase();return-1!=t.indexOf("opera")?e="opera":-1!=t.indexOf("msie")?e="msie":-1!=t.indexOf("safari")?e="safari":-1!=t.indexOf("mozilla")&&(e=-1!=t.indexOf("firefox")?"firefox":"mozilla"),e}(),GeoGlobe.Util.getBrowserName=function(){return GeoGlobe.BROWSER_NAME},GeoGlobe.Util.getScrollbarWidth=function(){var e=GeoGlobe.Util._scrollbarWidth;if(null==e){var t,i,r=null,o=null;(r=document.createElement("div")).style.position="absolute",r.style.top="-1000px",r.style.left="-1000px",r.style.width="100px",r.style.height="50px",r.style.overflow="hidden",(o=document.createElement("div")).style.width="100%",o.style.height="200px",r.appendChild(o),document.body.appendChild(r),t=o.offsetWidth,r.style.overflow="scroll",i=o.offsetWidth,document.body.removeChild(document.body.lastChild),GeoGlobe.Util._scrollbarWidth=t-i,e=GeoGlobe.Util._scrollbarWidth}return e},GeoGlobe.Util.randomStr=function(e){for(var t="",i=[],r=0;r<e;r++){var o=Math.ceil(25*Math.random());i.push(String.fromCharCode(97+o))}for(r=0;r<e;r++)t+=i[r];return t},GeoGlobe.Util.globalEval=function(e){e&&GeoGlobe.String.trim(e)&&(window.execScript||function(e){window.eval.call(window,e)})(e)},GeoGlobe.Util.getResolutionFromScale_DPI=function(e,t,i){var r;return e&&(null==t&&(t="degrees"),r=1/(GeoGlobe.Util.normalizeScale(e)*GeoGlobe.INCHES_PER_UNIT[t]*i)),r},GeoGlobe.Util.getScaleFromResolution_DPI=function(e,t,i){return null==t&&(t="degrees"),e*GeoGlobe.INCHES_PER_UNIT[t]*i},GeoGlobe.Util.getMapLevelFormResolution=function(e,t){if(!t)return 0;var i,r,o=Number.POSITIVE_INFINITY,n=e.getResolutions();for(i=0,len=n.length;i<len&&!(o<(r=Math.abs(n[i]-t)));i++)o=r;return Math.max(0,i-1)},GeoGlobe.Util.getMapLevelFormScale=function(e,t,i,r){i=i||"degrees",r=r||96;var o=GeoGlobe.Util.getResolutionFromScale_DPI(t,i,r);return GeoGlobe.Util.getMapLevelFormResolution(e,o)},GeoGlobe.Util.delayFun=function(e,t,i){var r;return function(){var o=this,n=arguments,a=i&&!r;clearTimeout(r),r=setTimeout((function(){r=null,i||e.apply(o,n)}),t),a&&e.apply(o,n)}},GeoGlobe.Util.clone=function(e){if("object"!=(void 0===e?"undefined":_typeof(e)))return e;if(null==e)return e;var t=e.constructor==Array?[]:{};for(var i in e)t[i]=GeoGlobe.Util.clone(e[i]);return t},GeoGlobe.Util.getType=function(e){var t=Object.prototype.toString;return e instanceof Element?"element":{"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regExp","[object Undefined]":"undefined","[object Null]":"null","[object Object]":"object"}[t.call(e)]},GeoGlobe.Util.formatNumberToThousands=function(e,t,i){e=e.toString().replace(/\$|\,/g,""),isNaN(e)&&(e="0");var r=e===(e=Math.abs(e)),o=(e=Math.floor(e*Math.pow(10,t)+.50000000001))%Math.pow(10,t);for(e=Math.floor(e/Math.pow(10,t)).toString(),o=o.toString();o.length<t;)o="0"+o;if(i)for(var n=0;n<Math.floor((e.length-(1+n))/3);n++)e=e.substring(0,e.length-(4*n+3))+","+e.substring(e.length-(4*n+3));return 0<t?(r?"":"-")+e+"."+o:(r?"":"-")+e},GeoGlobe.Util.getFormattedString=function(e,t){var i=t;if((i=(i=i.replace(/{a}/g,e.a)).replace(/{b}/g,e.b)).contains("{c"))for(var r=i.split("{c"),o=0,n=0;n<r.length-1;n++)o=r[n+1].split("}")[0],i=i.replace(new RegExp("{c"+o+"}","g"),GeoGlobe.Util.formatNumberToThousands(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(e.c),""===o?2:o,!0));return i},GeoGlobe.Util.getGradientImageData=function(e){var t=document.createElement("canvas"),i=t.getContext("2d");t.width=1,t.height=256;var r=i.createLinearGradient(0,0,0,256);for(var o in e)e.hasOwnProperty(o)&&r.addColorStop(o,e[o]);return i.fillStyle=r,i.fillRect(0,0,1,256),i.getImageData(0,0,1,256).data},GeoGlobe.Util.getRgbColor=function(e){if((e=e.toLowerCase())&&/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(e)){if(4===e.length){for(var t="#",i=1;i<4;i+=1)t+=e.slice(i,i+1).concat(e.slice(i,i+1));e=t}for(t=[],i=1;i<7;i+=2)t.push(_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()("0x"+e.slice(i,i+2)));return"rgb("+t.join(",")+")"}return e.startsWith("rgba")||e.startsWith("hsla")?e.substring(0,3)+e.substring(4,e.lastIndexOf(","))+")":e.startsWith("rgb")||e.startsWith("hsl")?e:""},GeoGlobe.Util.getShadeColor=function(e,t){e=(e=GeoGlobe.Util.getHexColor(e)).substr(1);var i=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(e,16),r=Math.round(2.55*t),o=(i>>16)+r,n=(i>>8&255)+r,a=(255&i)+r;return"#"+(16777216+65536*(o<255?o<1?0:o:255)+256*(n<255?n<1?0:n:255)+(a<255?a<1?0:a:255)).toString(16).slice(1)},GeoGlobe.Util.getHexColor=function(e){if(e=e.toLowerCase(),/^(rgb|rgba)/.test(e)){for(var t=e.split("(")[1].split(")")[0].split(","),i="#",r=0;r<3;r++){var o=Number(t[r]).toString(16);"0"===o&&(o+=o),1===o.length&&(o="0"+o),i+=o}return 7!==i.length&&(i=e),i}if(!/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/.test(e))return e;var n=e.replace(/#/,"").split("");if(6===n.length)return e;if(3===n.length){var a="#";for(r=0;r<n.length;r+=1)a+=n[r]+n[r];return a}},GeoGlobe.Util.transferToLonLat=function(e){return-238107693.23182276===e[1]?[e[0]/20037508.34*180,-90]:[e[0]/20037508.34*180,180/Math.PI*(2*Math.atan(Math.exp(e[1]/20037508.34*180*Math.PI/180))-Math.PI/2)]},GeoGlobe.Util.transferToMercator=function(e){return-90===e[1]?[20037508.34*e[0]/180,-238107693.23182276]:[20037508.34*e[0]/180,Math.log(Math.tan((90+e[1])*Math.PI/360))/(Math.PI/180)*20037508.34/180]},GeoGlobe.ProjAxisOrder={AXIS_ORDER_EN:!0,AXIS_ORDER_NE:!1},GeoGlobe.ProjAxisOrder.AxisOrder={"EPSG:900913":GeoGlobe.ProjAxisOrder.AXIS_ORDER_EN,WGS84:GeoGlobe.ProjAxisOrder.AXIS_ORDER_NE,"IGNF:WGS84G":GeoGlobe.ProjAxisOrder.AXIS_ORDER_NE,"EPSG:4326":GeoGlobe.ProjAxisOrder.AXIS_ORDER_NE,"EPSG:4490":GeoGlobe.ProjAxisOrder.AXIS_ORDER_NE,"EPSG:4269":GeoGlobe.ProjAxisOrder.AXIS_ORDER_NE,"EPSG:2361":GeoGlobe.ProjAxisOrder.AXIS_ORDER_NE,"EPSG:27700":GeoGlobe.ProjAxisOrder.AXIS_ORDER_EN,"EPSG:904490":GeoGlobe.ProjAxisOrder.AXIS_ORDER_NE,"EPSG:4171":GeoGlobe.ProjAxisOrder.AXIS_ORDER_NE,"EPSG:32637":GeoGlobe.ProjAxisOrder.AXIS_ORDER_EN,"EPSG:32638":GeoGlobe.ProjAxisOrder.AXIS_ORDER_EN,"EPSG:32639":GeoGlobe.ProjAxisOrder.AXIS_ORDER_EN,"EPSG:32640":GeoGlobe.ProjAxisOrder.AXIS_ORDER_EN,"EPSG:32641":GeoGlobe.ProjAxisOrder.AXIS_ORDER_EN,"EPSG:28991":GeoGlobe.ProjAxisOrder.AXIS_ORDER_EN,"EPSG:28992":GeoGlobe.ProjAxisOrder.AXIS_ORDER_EN,"EPSG:31300":GeoGlobe.ProjAxisOrder.AXIS_ORDER_EN,"EPSG:31370":GeoGlobe.ProjAxisOrder.AXIS_ORDER_EN,"EPSG:2176":GeoGlobe.ProjAxisOrder.AXIS_ORDER_EN,"EPSG:2177":GeoGlobe.ProjAxisOrder.AXIS_ORDER_EN,"EPSG:2178":GeoGlobe.ProjAxisOrder.AXIS_ORDER_EN,"EPSG:2179":GeoGlobe.ProjAxisOrder.AXIS_ORDER_EN,"EPSG:2180":GeoGlobe.ProjAxisOrder.AXIS_ORDER_EN,"EPSG:2154":GeoGlobe.ProjAxisOrder.AXIS_ORDER_EN,"EPSG:3346":GeoGlobe.ProjAxisOrder.AXIS_ORDER_EN,"EPSG:3857":GeoGlobe.ProjAxisOrder.AXIS_ORDER_EN,"EPSG:2065":GeoGlobe.ProjAxisOrder.AXIS_ORDER_EN};var _typeof="function"==typeof _babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14___default.a&&"symbol"==_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_13___default()(_babel_runtime_corejs2_core_js_symbol_iterator__WEBPACK_IMPORTED_MODULE_12___default.a)?function(e){return _babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_13___default()(e)}:function(e){return e&&"function"==typeof _babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14___default.a&&e.constructor===_babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14___default.a&&e!==_babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14___default.a.prototype?"symbol":_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_13___default()(e)};GeoGlobe.SpatialReference=GeoGlobe.Class({proj:null,projCode:null,titleRegEx:/\+title=[^\+]*/,initialize:function(e,t){GeoGlobe.Util.extend(this,t),this.projCode=e,"object"==("undefined"==typeof Proj4js?"undefined":_typeof(Proj4js))&&(this.proj=new Proj4js.Proj(e))},getCode:function(){return this.proj?this.proj.srsCode:this.projCode},getUnits:function(){return this.proj?this.proj.units:null},toString:function(){return this.getCode()},equals:function(e){var t=e,i=!1;if(t)if(t instanceof GeoGlobe.SpatialReference||(t=new GeoGlobe.SpatialReference(t)),"object"==("undefined"==typeof Proj4js?"undefined":_typeof(Proj4js))&&this.proj.defData&&t.proj.defData)i=this.proj.defData.replace(this.titleRegEx,"")==t.proj.defData.replace(this.titleRegEx,"");else if(t.getCode){var r=this.getCode(),o=t.getCode();i=r==o||!!GeoGlobe.SpatialReference.transforms[r]&&GeoGlobe.SpatialReference.transforms[r][o]===GeoGlobe.SpatialReference.nullTransform}return i},destroy:function(){delete this.proj,delete this.projCode},CLASS_NAME:"GeoGlobe.SpatialReference"}),GeoGlobe.SpatialReference.transforms={},GeoGlobe.SpatialReference.defaults={"EPSG:4326":{units:"degrees",maxExtent:[-180,-90,180,90],yx:!0},"CRS:84":{units:"degrees",maxExtent:[-180,-90,180,90]},"EPSG:900913":{units:"m",maxExtent:[-20037508.34,-20037508.34,20037508.34,20037508.34]}},GeoGlobe.SpatialReference.addTransform=function(e,t,i){if(i===GeoGlobe.SpatialReference.nullTransform){var r=GeoGlobe.SpatialReference.defaults[e];r&&!GeoGlobe.SpatialReference.defaults[t]&&(GeoGlobe.SpatialReference.defaults[t]=r)}GeoGlobe.SpatialReference.transforms[e]||(GeoGlobe.SpatialReference.transforms[e]={}),GeoGlobe.SpatialReference.transforms[e][t]=i},GeoGlobe.SpatialReference.transform=function(e,t,i){if(t&&i)if(t instanceof GeoGlobe.SpatialReference||(t=new GeoGlobe.SpatialReference(t)),i instanceof GeoGlobe.SpatialReference||(i=new GeoGlobe.SpatialReference(i)),t.proj&&i.proj)e=Proj4js.transform(t.proj,i.proj,e);else{var r=t.getCode(),o=i.getCode(),n=GeoGlobe.SpatialReference.transforms;n[r]&&n[r][o]&&n[r][o](e)}return e},GeoGlobe.SpatialReference.nullTransform=function(e){return e},function(){var e=20037508.34;function t(t){return t.x=180*t.x/e,t.y=180/Math.PI*(2*Math.atan(Math.exp(t.y/e*Math.PI))-Math.PI/2),t}function i(t){t.x=t.x*e/180;var i=Math.log(Math.tan((90+t.y)*Math.PI/360))/Math.PI*e;return t.y=Math.max(-20037508.34,Math.min(i,20037508.34)),t}function r(e,r){var o,n,a,s,l,u=GeoGlobe.SpatialReference.addTransform,h=GeoGlobe.SpatialReference.nullTransform;for(o=0,n=r.length;o<n;++o)for(u(e,a=r[o],i),u(a,e,t),l=o+1;l<n;++l)u(a,s=r[l],h),u(s,a,h)}var o,n=["EPSG:900913","EPSG:3857","EPSG:102113","EPSG:102100"],a=["CRS:84","urn:ogc:def:crs:EPSG:6.6:4326","EPSG:4326"];for(o=n.length-1;0<=o;--o)r(n[o],a);for(o=a.length-1;0<=o;--o)r(a[o],n)}(),GeoGlobe.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(e){alert(e)},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:"GeoGlobe.Console"},function(){for(var e=document.getElementsByTagName("script"),t=0,i=e.length;t<i;++t)if(-1!=e[t].src.indexOf("firebug.js")&&console){GeoGlobe.Util.extend(GeoGlobe.Console,console);break}}(),GeoGlobe.ProxyHost="",GeoGlobe.Request||(GeoGlobe.Request={}),GeoGlobe.Util.extend(GeoGlobe.Request,{DEFAULT_CONFIG:{method:"GET",url:window.location.href,async:!0,user:void 0,password:void 0,params:null,proxy:GeoGlobe.ProxyHost,headers:{},data:null,callback:function(){},success:null,failure:null,scope:null},URL_SPLIT_REGEX:/([^:]*:)\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/,makeSameOrigin:function(e,t){var i=0!==e.indexOf("http"),r=!i&&e.match(this.URL_SPLIT_REGEX);if(r){var o=window.location;i=r[1]==o.protocol&&r[3]==o.hostname;var n=r[4],a=o.port;(80!=n&&""!=n||"80"!=a&&""!=a)&&(i=i&&n==a)}return i||t&&(e="function"==typeof t?t(e):0<=e.indexOf("cts?")?t+e:t+encodeURIComponent(e)),e},issue:function(e){var t=GeoGlobe.Util.extend(this.DEFAULT_CONFIG,{proxy:GeoGlobe.ProxyHost});(e=e||{}).headers=e.headers||{},(e=GeoGlobe.Util.applyDefaults(e,t)).headers=GeoGlobe.Util.applyDefaults(e.headers,t.headers);var i,r=!1;for(i in e.headers)e.headers.hasOwnProperty(i)&&"x-requested-with"===i.toLowerCase()&&(r=!0);!1===r&&(e.headers["X-Requested-With"]="XMLHttpRequest");var o=new GeoGlobe.Request.XMLHttpRequest;e.url=encodeURI(e.url);var n=GeoGlobe.Util.urlAppend(e.url,GeoGlobe.Util.getParameterString(e.params||{}));for(var a in n=GeoGlobe.Request.makeSameOrigin(n,e.proxy),o.open(e.method,n,e.async,e.user,e.password),e.headers)o.setRequestHeader(a,e.headers[a]);var s=this;return!(o.onreadystatechange=function(){o.readyState==GeoGlobe.Request.XMLHttpRequest.DONE&&s.runCallbacks({request:o,config:e,requestUrl:n})})===e.async?o.send(e.data):window.setTimeout((function(){0!==o.readyState&&o.send(e.data)}),0),o},runCallbacks:function(e){var t,i,r=e.request,o=e.config,n=o.scope?GeoGlobe.Function.bind(o.callback,o.scope):o.callback;o.success&&(t=o.scope?GeoGlobe.Function.bind(o.success,o.scope):o.success),o.failure&&(i=o.scope?GeoGlobe.Function.bind(o.failure,o.scope):o.failure),"file:"==GeoGlobe.Util.createUrlObject(o.url).protocol&&r.responseText&&(r.status=200),n(r),(!r.status||200<=r.status&&r.status<300)&&t&&t(r),r.status&&(r.status<200||300<=r.status)&&i&&i(r)},GET:function(e){return e=GeoGlobe.Util.extend(e,{method:"GET"}),GeoGlobe.Request.issue(e)},POST:function(e){return(e=GeoGlobe.Util.extend(e,{method:"POST"})).headers=e.headers?e.headers:{},"CONTENT-TYPE"in GeoGlobe.Util.upperCaseObject(e.headers)||(e.headers["Content-Type"]="application/xml"),GeoGlobe.Request.issue(e)},PUT:function(e){return(e=GeoGlobe.Util.extend(e,{method:"PUT"})).headers=e.headers?e.headers:{},"CONTENT-TYPE"in GeoGlobe.Util.upperCaseObject(e.headers)||(e.headers["Content-Type"]="application/xml"),GeoGlobe.Request.issue(e)},DELETE:function(e){return e=GeoGlobe.Util.extend(e,{method:"DELETE"}),GeoGlobe.Request.issue(e)},HEAD:function(e){return e=GeoGlobe.Util.extend(e,{method:"HEAD"}),GeoGlobe.Request.issue(e)},OPTIONS:function(e){return e=GeoGlobe.Util.extend(e,{method:"OPTIONS"}),GeoGlobe.Request.issue(e)}}),GeoGlobe.nullHandler=function(e){GeoGlobe.Console.userError(GeoGlobe.i18n("unhandledRequest",{statusText:e.statusText}))},GeoGlobe.loadURL=function(e,t,i,r,o){"string"==typeof t&&(t=GeoGlobe.Util.getParameters(t));var n=r||GeoGlobe.nullHandler,a=o||GeoGlobe.nullHandler;return GeoGlobe.Request.GET({url:e,params:t,success:n,failure:a,scope:i})},GeoGlobe.Request.setProxyHost=function(e){GeoGlobe.ProxyHost=e},GeoGlobe.Request.getProxyHost=function(){return GeoGlobe.ProxyHost},GeoGlobe.appendToProxy=function(e){var t=e.split("?"),i=GeoGlobe.ProxyHost+encodeURI(encodeURI(t[0]));return 2===t.length&&(i+="?"+t[1]),i},GeoGlobe.loadScript=function(e){GeoGlobe.Request.GET({url:e,async:!1,headers:{Accept:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript, */*; q=0.01"},success:function(e){GeoGlobe.Util.globalEval(e.responseText)},failure:function(){alert("加载:"+e+" 失败。")}})},function(){var e=window.XMLHttpRequest,t=!!window.controllers,i=window.document.all&&!window.opera,r=i&&window.navigator.userAgent.match(/MSIE 7.0/);function o(){this._object=e&&!r?new e:new window.ActiveXObject("Microsoft.XMLHTTP"),this._listeners=[]}function n(){return new o}function a(e){n.onreadystatechange&&n.onreadystatechange.apply(e),e.dispatchEvent({type:"readystatechange",bubbles:!1,cancelable:!1,timeStamp:new Date+0})}function s(e){try{e.responseText=e._object.responseText}catch(e){}try{e.responseXML=function(e){var t=e.responseXML,r=e.responseText;return i&&r&&t&&!t.documentElement&&e.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/)&&((t=new window.ActiveXObject("Microsoft.XMLDOM")).async=!1,t.validateOnParse=!1,t.loadXML(r)),t&&(i&&0!=t.parseError||!t.documentElement||t.documentElement&&"parsererror"==t.documentElement.tagName)?null:t}(e._object)}catch(e){}try{e.status=e._object.status}catch(e){}try{e.statusText=e._object.statusText}catch(e){}}function l(e){e._object.onreadystatechange=new window.Function}n.prototype=o.prototype,t&&e.wrapped&&(n.wrapped=e.wrapped),n.UNSENT=0,n.OPENED=1,n.HEADERS_RECEIVED=2,n.LOADING=3,n.DONE=4,n.prototype.readyState=n.UNSENT,n.prototype.responseText="",n.prototype.responseXML=null,n.prototype.status=0,n.prototype.statusText="",n.prototype.priority="NORMAL",n.prototype.onreadystatechange=null,n.onreadystatechange=null,n.onopen=null,n.onsend=null,n.onabort=null,n.prototype.open=function(e,r,o,u,h){delete this._headers,arguments.length<3&&(o=!0),this._async=o;var c,p=this,d=this.readyState;i&&o&&(c=function(){d!=n.DONE&&(l(p),p.abort())},window.attachEvent("onunload",c)),n.onopen&&n.onopen.apply(this,arguments),4<arguments.length?this._object.open(e,r,o,u,h):3<arguments.length?this._object.open(e,r,o,u):this._object.open(e,r,o);try{this._object.responseType="msxml-document"}catch(e){}this.readyState=n.OPENED,a(this),this._object.onreadystatechange=function(){t&&!o||(p.readyState=p._object.readyState,s(p),p._aborted?p.readyState=n.UNSENT:(p.readyState==n.DONE&&(delete p._data,l(p),i&&o&&window.detachEvent("onunload",c)),d!=p.readyState&&a(p),d=p.readyState))}},n.prototype.send=function(e){n.onsend&&n.onsend.apply(this,arguments),arguments.length||(e=null),e&&e.nodeType&&(e=window.XMLSerializer?(new window.XMLSerializer).serializeToString(e):e.xml,this._headers["Content-Type"]||this._object.setRequestHeader("Content-Type","application/xml")),this._data=e,function(e){if(e._object.send(e._data),t&&!e._async)for(e.readyState=n.OPENED,s(e);e.readyState<n.DONE;)if(e.readyState++,a(e),e._aborted)return}(this)},n.prototype.abort=function(){n.onabort&&n.onabort.apply(this,arguments),this.readyState>n.UNSENT&&(this._aborted=!0),this._object.abort(),l(this),this.readyState=n.UNSENT,delete this._data},n.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders()},n.prototype.getResponseHeader=function(e){return this._object.getResponseHeader(e)},n.prototype.setRequestHeader=function(e,t){return this._headers||(this._headers={}),this._headers[e]=t,this._object.setRequestHeader(e,t)},n.prototype.addEventListener=function(e,t,i){for(var r,o=0;r=this._listeners[o];o++)if(r[0]==e&&r[1]==t&&r[2]==i)return;this._listeners.push([e,t,i])},n.prototype.removeEventListener=function(e,t,i){for(var r,o=0;(r=this._listeners[o])&&(r[0]!=e||r[1]!=t||r[2]!=i);o++);r&&this._listeners.splice(o,1)},n.prototype.dispatchEvent=function(e){var t={type:e.type,target:this,currentTarget:this,eventPhase:2,bubbles:e.bubbles,cancelable:e.cancelable,timeStamp:e.timeStamp,stopPropagation:function(){},preventDefault:function(){},initEvent:function(){}};"readystatechange"==t.type&&this.onreadystatechange&&(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[t]);for(var i,r=0;i=this._listeners[r];r++)i[0]!=t.type||i[2]||(i[1].handleEvent||i[1]).apply(this,[t])},n.prototype.toString=function(){return"[object XMLHttpRequest]"},n.toString=function(){return"[XMLHttpRequest]"},window.Function.prototype.apply||(window.Function.prototype.apply=function(e,t){t=t||[],e.__func=this,e.__func(t[0],t[1],t[2],t[3],t[4]),delete e.__func}),GeoGlobe.Request||(GeoGlobe.Request={}),GeoGlobe.Request.XMLHttpRequest=n}();var _typeof="function"==typeof _babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14___default.a&&"symbol"==_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_13___default()(_babel_runtime_corejs2_core_js_symbol_iterator__WEBPACK_IMPORTED_MODULE_12___default.a)?function(e){return _babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_13___default()(e)}:function(e){return e&&"function"==typeof _babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14___default.a&&e.constructor===_babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14___default.a&&e!==_babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14___default.a.prototype?"symbol":_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_13___default()(e)};GeoGlobe.Lang={code:null,defaultCode:"zh-CN",getCode:function(){return GeoGlobe.Lang.code||GeoGlobe.Lang.setCode(),GeoGlobe.Lang.code},setCode:function(e){var t,i=(e=e||("msie"==GeoGlobe.BROWSER_NAME?navigator.userLanguage:navigator.language)).split("-");if(i[0]=i[0].toLowerCase(),"object"==_typeof(GeoGlobe.Lang[i[0]])&&(t=i[0]),i[1]){var r=i[0]+"-"+i[1].toUpperCase();"object"==_typeof(GeoGlobe.Lang[r])&&(t=r)}t||(GeoGlobe.Console.warn("Failed to find GeoGlobe.Lang."+i.join("-")+" dictionary, falling back to default language"),t=GeoGlobe.Lang.defaultCode),GeoGlobe.Lang.code=t},translate:function(e,t){var i=GeoGlobe.Lang[GeoGlobe.Lang.getCode()],r=i&&i[e];return r=r||e,t&&(r=GeoGlobe.String.format(r,t)),r}},GeoGlobe.i18n=GeoGlobe.Lang.translate,GeoGlobe.Lang.en={unhandledRequest:"Unhandled request return ${statusText}",end:""},GeoGlobe.Lang["zh-CN"]={unhandledRequest:"未处理的请求，返回值为 ${statusText}",end:""},GeoGlobe.String={startsWith:function(e,t){return 0==e.indexOf(t)},contains:function(e,t){return-1!=e.indexOf(t)},trim:function(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(e){for(var t=e.split("-"),i=t[0],r=1,o=t.length;r<o;r++){var n=t[r];i+=n.charAt(0).toUpperCase()+n.substring(1)}return i},format:function(e,t,i){return t=t||window,e.replace(GeoGlobe.String.tokenRegEx,(function(e,r){for(var o,n=r.split(/\.+/),a=0;a<n.length&&(0==a&&(o=t),void 0!==o);a++)o=o[n[a]];return"function"==typeof o&&(o=i?o.apply(null,i):o()),void 0===o?"undefined":o}))},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(e){return GeoGlobe.String.numberRegEx.test(e)},numericIf:function(e,t){var i=e;return!0===t&&null!=e&&e.replace&&(e=e.replace(/^\s*|\s*$/g,"")),GeoGlobe.String.isNumeric(e)?_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(e):i}},GeoGlobe.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(e,t){var i=0;return 0<t&&(i=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(e.toPrecision(t))),i},format:function(e,t,i,r){t=void 0!==t?t:0,i=void 0!==i?i:GeoGlobe.Number.thousandsSeparator,r=void 0!==r?r:GeoGlobe.Number.decimalSeparator,null!=t&&(e=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(e.toFixed(t)));var o=e.toString().split(".");1==o.length&&null==t&&(t=0);var n,a=o[0];if(i)for(var s=/(-?[0-9]+)([0-9]{3})/;s.test(a);)a=a.replace(s,"$1"+i+"$2");if(0==t)n=a;else{var l=1<o.length?o[1]:"0";null!=t&&(l+=new Array(t-l.length+1).join("0")),n=a+r+l}return n},zeroPad:function(e,t,i){for(var r=e.toString(i||10);r.length<t;)r="0"+r;return r}},GeoGlobe.Function={bind:function(e,t){var i=Array.prototype.slice.apply(arguments,[2]);return function(){var r=i.concat(Array.prototype.slice.apply(arguments,[0]));return e.apply(t,r)}},bindAsEventListener:function(e,t){return function(i){return e.call(t,i||window.event)}},False:function(){return!1},True:function(){return!0},Void:function(){}},GeoGlobe.Array={filter:function(e,t,i){var r=[];if(Array.prototype.filter)r=e.filter(t,i);else{var o=e.length;if("function"!=typeof t)throw new TypeError;for(var n=0;n<o;n++)if(n in e){var a=e[n];t.call(i,a,n,e)&&r.push(a)}}return r}},String.prototype.endsWith||(String.prototype.endsWith=function(e,t){var i=this.toString();("number"!=typeof t||!isFinite(t)||Math.floor(t)!==t||t>i.length)&&(t=i.length),t-=e.length;var r=i.lastIndexOf(e,t);return-1!==r&&r===t}),GeoGlobe.Date={dateRegEx:/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:(?:T(\d{1,2}):(\d{2}):(\d{2}(?:\.\d+)?)(Z|(?:[+-]\d{1,2}(?::(\d{2}))?)))|Z)?$/,toISOString:"toISOString"in Date.prototype?function(e){return e.toISOString()}:function(e){return isNaN(e.getTime())?"Invalid Date":e.getUTCFullYear()+"-"+GeoGlobe.Number.zeroPad(e.getUTCMonth()+1,2)+"-"+GeoGlobe.Number.zeroPad(e.getUTCDate(),2)+"T"+GeoGlobe.Number.zeroPad(e.getUTCHours(),2)+":"+GeoGlobe.Number.zeroPad(e.getUTCMinutes(),2)+":"+GeoGlobe.Number.zeroPad(e.getUTCSeconds(),2)+"."+GeoGlobe.Number.zeroPad(e.getUTCMilliseconds(),3)+"Z"},parse:function(e){var t,i=e.match(this.dateRegEx);if(i&&(i[1]||i[7])){var r=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(i[1],10)||0,o=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(i[2],10)-1||0,n=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(i[3],10)||1;t=new Date(Date.UTC(r,o,n));var a=i[7];if(a){var s=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(i[4],10),l=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(i[5],10),u=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(i[6]),h=0|u,c=Math.round(1e3*(u-h));if(t.setUTCHours(s,l,h,c),"Z"!==a){var p=-1e3*(60*_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(a,10)*60+60*(_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(i[8],10)||0));t=new Date(t.getTime()+p)}}}else t=new Date("invalid");return t}};var _typeof="function"==typeof _babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14___default.a&&"symbol"==_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_13___default()(_babel_runtime_corejs2_core_js_symbol_iterator__WEBPACK_IMPORTED_MODULE_12___default.a)?function(e){return _babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_13___default()(e)}:function(e){return e&&"function"==typeof _babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14___default.a&&e.constructor===_babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14___default.a&&e!==_babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14___default.a.prototype?"symbol":_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_13___default()(e)},o,r;!function(e){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&void 0!==module?module.exports=e():"function"==typeof define&&__webpack_require__(121)?define([],e):("undefined"!=typeof window?window:void 0!==global?global:"undefined"!=typeof self?self:this)._GeoGlobe=e()}((function(){return function e(t,i,r){function o(a,s){if(!i[a]){if(!t[a]){if(!s&&("function"==typeof require&&require))return require(a,!0);if(n)return n(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var u=i[a]={exports:{}};t[a][0].call(u.exports,(function(e){return o(t[a][1][e]||e)}),u,u.exports,e,t,i,r)}return i[a].exports}for(var n="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,t,i){function r(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid LngLat object: ("+e+", "+t+")");this.lng=+e,this.lat=+t}r.prototype.wrap=function(){return new r(function(e,t,i){var r=((e-t)%360+360)%360+t;return r===t?180:r}(this.lng,-180),this.lat)},r.prototype.toArray=function(){return[this.lng,this.lat]},r.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},r.prototype.toBounds=function(t){var i=360*t/40075017,o=i/Math.cos(Math.PI/180*this.lat);return new(e("./lng_lat_bounds"))(new r(this.lng-o,this.lat-i),new r(this.lng+o,this.lat+i))},r.convert=function(e){if(e instanceof r)return e;if(_babel_runtime_corejs2_core_js_array_is_array__WEBPACK_IMPORTED_MODULE_4___default()(e)&&2===e.length)return new r(Number(e[0]),Number(e[1]));if(!_babel_runtime_corejs2_core_js_array_is_array__WEBPACK_IMPORTED_MODULE_4___default()(e)&&"object"===(void 0===e?"undefined":_typeof(e))&&null!==e)return new r(Number(e.lng),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")},t.exports=r},{"./lng_lat_bounds":2}],2:[function(e,t,i){function r(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}var o=e("./lng_lat");r.prototype.setNorthEast=function(e){return this._ne=e instanceof o?new o(e.lng,e.lat):o.convert(e),this},r.prototype.setSouthWest=function(e){return this._sw=e instanceof o?new o(e.lng,e.lat):o.convert(e),this},r.prototype.extend=function(e){var t,i,n=this._sw,a=this._ne;if(e instanceof o)i=t=e;else{if(!(e instanceof r))return _babel_runtime_corejs2_core_js_array_is_array__WEBPACK_IMPORTED_MODULE_4___default()(e)?e.every(_babel_runtime_corejs2_core_js_array_is_array__WEBPACK_IMPORTED_MODULE_4___default.a)?this.extend(r.convert(e)):this.extend(o.convert(e)):this;if(t=e._sw,i=e._ne,!t||!i)return this}return n||a?(n.lng=Math.min(t.lng,n.lng),n.lat=Math.min(t.lat,n.lat),a.lng=Math.max(i.lng,a.lng),a.lat=Math.max(i.lat,a.lat)):(this._sw=new o(t.lng,t.lat),this._ne=new o(i.lng,i.lat)),this},r.prototype.getCenter=function(){return new o((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},r.prototype.getSouthWest=function(){return this._sw},r.prototype.getNorthEast=function(){return this._ne},r.prototype.getNorthWest=function(){return new o(this.getWest(),this.getNorth())},r.prototype.getSouthEast=function(){return new o(this.getEast(),this.getSouth())},r.prototype.getWest=function(){return this._sw.lng},r.prototype.getSouth=function(){return this._sw.lat},r.prototype.getEast=function(){return this._ne.lng},r.prototype.getNorth=function(){return this._ne.lat},r.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},r.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},r.convert=function(e){return!e||e instanceof r?e:new r(e)},t.exports=r},{"./lng_lat":1}],3:[function(e,t,i){var r=e("./geo/lng_lat"),o=e("./geo/lng_lat_bounds");t.exports={LngLat:r,LngLatBounds:o}},{"./geo/lng_lat":1,"./geo/lng_lat_bounds":2}]},{},[3])(3)})),window.GeoGlobe.Util.extend(window.GeoGlobe,window._GeoGlobe),GeoGlobe.LngLat.prototype.CLASS_NAME="GeoGlobe.LngLat",GeoGlobe.LngLatBounds.prototype.clone=function(){return new GeoGlobe.LngLatBounds(this._sw,this._ne)},GeoGlobe.LngLatBounds.prototype.contains=function(e,t,i){return null==i&&(i=!0),null!=e&&null!=t&&(e=GeoGlobe.Util.toFloat(e),t=GeoGlobe.Util.toFloat(t),i?e>=this._sw.lng&&e<=this._ne.lng&&t>=this._sw.lat&&t<=this._ne.lat:e>this._sw.lng&&e<this._ne.lng&&t>this._sw.lat&&t<this._ne.lat)},GeoGlobe.LngLatBounds.prototype.getWidth=function(){return this._ne.lng-this._sw.lng},GeoGlobe.LngLatBounds.prototype.containsLonLat=function(e,t){"boolean"==typeof t&&(t={inclusive:t}),t=t||{};var i=this.contains(e.lng,e.lat,t.inclusive),r=t.worldBounds;if(r&&!i){var o=r.getWidth(),n=(r._sw.lng+r._ne.lng)/2,a=Math.round((e.lng-n)/o);i=this.containsLonLat({lng:e.lng-a*o,lat:e.lat},{inclusive:t.inclusive})}return i},GeoGlobe.LngLatBounds.prototype.equals=function(e){var t=!1;return null!=e&&(t=this._sw.lng==e._sw.lng&&this._ne.lng==e._ne.lng&&this._ne.lat==e._ne.lat&&this._sw.lat==e._sw.lat),t},GeoGlobe.LngLatBounds.prototype.toBBOX=function(e,t){null==e&&(e=6);var i=Math.pow(10,e),r=Math.round(this._sw.lng*i)/i,o=Math.round(this._sw.lat*i)/i,n=Math.round(this._ne.lng*i)/i,a=Math.round(this._ne.lat*i)/i;return!0===t?o+","+r+","+a+","+n:r+","+o+","+n+","+a},GeoGlobe.LngLatBounds.prototype.toGeometry=function(){return new GeoGlobe.Geometry.Polygon([new GeoGlobe.Geometry.LinearRing([new GeoGlobe.Geometry.Point(this._sw.lng,this._sw.lat),new GeoGlobe.Geometry.Point(this._ne.lng,this._sw.lat),new GeoGlobe.Geometry.Point(this._ne.lng,this._ne.lat),new GeoGlobe.Geometry.Point(this._sw.lng,this._ne.lat)])])},GeoGlobe.LngLatBounds.prototype.getCenterLonLat=function(){return this.centerLonLat||(this.centerLonLat=new GeoGlobe.LngLat((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)),this.centerLonLat},GeoGlobe.LngLatBounds.prototype.CLASS_NAME="GeoGlobe.LngLatBounds",GeoGlobe.LngLatBounds.fromString=function(e,t){var i=e.split(",");return GeoGlobe.LngLatBounds.fromArray(i,t)},GeoGlobe.LngLatBounds.fromArray=function(e,t){return!0===t?new GeoGlobe.LngLatBounds(new GeoGlobe.LngLat(e[1],e[0]),new GeoGlobe.LngLat(e[3],e[2])):new GeoGlobe.LngLatBounds(new GeoGlobe.LngLat(e[0],e[1]),new GeoGlobe.LngLat(e[2],e[3]))},GeoGlobe.Geometry=GeoGlobe.Class4OL({id:null,parent:null,bounds:null,initialize:function(){this.id=GeoGlobe.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){this.id=null,this.bounds=null},clone:function(){return new GeoGlobe.Geometry},setBounds:function(e){e&&(this.bounds=e.clone())},clearBounds:function(){this.bounds=null,this.parent&&this.parent.clearBounds()},extendBounds:function(e){this.getBounds()?this.bounds.extend(e):this.setBounds(e)},getBounds:function(){return null==this.bounds&&this.calculateBounds(),this.bounds},calculateBounds:function(){},distanceTo:function(){},getVertices:function(){},atPoint:function(e,t,i){var r=!1;if(null!=this.getBounds()&&null!=e){var o=null!=t?t:0,n=null!=i?i:0,a=new GeoGlobe.LngLat(this.bounds._sw.lng-o,this.bounds._sw.lat-n),s=new GeoGlobe.LngLat(this.bounds._ne.lng+o,this.bounds._ne.lat+n);r=new GeoGlobe.LngLatBounds(a,s).containsLonLat(e)}return r},getLength:function(){return 0},getArea:function(){return 0},getCentroid:function(){return null},toString:function(){return GeoGlobe.Format&&GeoGlobe.Format.WKT?GeoGlobe.Format.WKT.prototype.write(new GeoGlobe.Feature(this)):Object.prototype.toString.call(this)},CLASS_NAME:"GeoGlobe.Geometry"}),GeoGlobe.Geometry.fromWKT=function(e){var t;if(GeoGlobe.Format&&GeoGlobe.Format.WKT){var i=GeoGlobe.Geometry.fromWKT.format;i||(i=new GeoGlobe.Format.WKT,GeoGlobe.Geometry.fromWKT.format=i);var r=i.read(e);if(r instanceof GeoGlobe.Feature)t=r.geometry;else if(GeoGlobe.Util.isArray(r)){for(var o=r.length,n=new Array(o),a=0;a<o;++a)n[a]=r[a].geometry;t=new GeoGlobe.Geometry.Collection(n)}}return t},GeoGlobe.Geometry.segmentsIntersect=function(e,t,i){var r=i&&i.point,o=i&&i.tolerance,n=!1,a=e.x1-t.x1,s=e.y1-t.y1,l=e.x2-e.x1,u=e.y2-e.y1,h=t.y2-t.y1,c=t.x2-t.x1,p=h*l-c*u,d=c*s-h*a,f=l*s-u*a;if(0==p)0==d&&0==f&&(n=!0);else{var g=d/p,m=f/p;if(0<=g&&g<=1&&0<=m&&m<=1)if(r){var _=e.x1+g*l,v=e.y1+g*u;n=new GeoGlobe.Geometry.Point(_,v)}else n=!0}if(o)if(n){if(r){var C,y=[e,t];e:for(var A=0;A<2;++A){C=y[A];for(var I=1;I<3;++I)if(_=C["x"+I],v=C["y"+I],Math.sqrt(Math.pow(_-n.x,2)+Math.pow(v-n.y,2))<o){n.x=_,n.y=v;break e}}}}else{var b,w,E;y=[e,t];e:for(A=0;A<2;++A)for(b=y[A],w=y[(A+1)%2],I=1;I<3;++I)if(E={x:b["x"+I],y:b["y"+I]},GeoGlobe.Geometry.distanceToSegment(E,w).distance<o){n=!r||new GeoGlobe.Geometry.Point(E.x,E.y);break e}}return n},GeoGlobe.Geometry.distanceToSegment=function(e,t){var i=GeoGlobe.Geometry.distanceSquaredToSegment(e,t);return i.distance=Math.sqrt(i.distance),i},GeoGlobe.Geometry.distanceSquaredToSegment=function(e,t){var i,r,o=e.x,n=e.y,a=t.x1,s=t.y1,l=t.x2,u=t.y2,h=l-a,c=u-s,p=0==h&&0==c?0:(h*(o-a)+c*(n-s))/(Math.pow(h,2)+Math.pow(c,2));return r=p<=0?(i=a,s):1<=p?(i=l,u):(i=a+p*h,s+p*c),{distance:Math.pow(i-o,2)+Math.pow(r-n,2),x:i,y:r,along:p}},GeoGlobe.Geometry.fromGeoJson=function(e){var t;if(GeoGlobe.Format&&GeoGlobe.Format.GeoJSON){format=new GeoGlobe.Format.GeoJSON;var i=null;try{i=format.parseGeometry(geojson)}catch(e){console.log(e)}t=i}return t},GeoGlobe.Geometry.Collection=GeoGlobe.Class4OL(GeoGlobe.Geometry,{components:null,componentTypes:null,initialize:function(e){GeoGlobe.Geometry.prototype.initialize.apply(this,arguments),this.components=[],null!=e&&this.addComponents(e)},destroy:function(){this.components.length=0,this.components=null,GeoGlobe.Geometry.prototype.destroy.apply(this,arguments)},clone:function clone(){for(var geometry=eval("new "+this.CLASS_NAME+"()"),i=0,len=this.components.length;i<len;i++)geometry.addComponent(this.components[i].clone());return GeoGlobe.Util.applyDefaults(geometry,this),geometry},getComponentsString:function(){for(var e=[],t=0,i=this.components.length;t<i;t++)e.push(this.components[t].toShortString());return e.join(",")},calculateBounds:function(){this.bounds=null;var e=new GeoGlobe.LngLatBounds,t=this.components;if(t)for(var i=0,r=t.length;i<r;i++)e.extend(t[i].getBounds());null!=e._sw&&null!=e._sw&&null!=e._ne&&null!=e._ne&&null!=e._sw.lng&&null!=e._sw.lat&&null!=e._ne.lng&&null!=e._ne.lat&&this.setBounds(e)},addComponents:function(e){GeoGlobe.Util.isArray(e)||(e=[e]);for(var t=0,i=e.length;t<i;t++)this.addComponent(e[t])},addComponent:function(e,t){var i=!1;if(e&&(null==this.componentTypes||-1<GeoGlobe.Util.indexOf(this.componentTypes,e.CLASS_NAME))){if(null!=t&&t<this.components.length){var r=this.components.slice(0,t),o=this.components.slice(t,this.components.length);r.push(e),this.components=r.concat(o)}else this.components.push(e);(e.parent=this).clearBounds(),i=!0}return i},removeComponents:function(e){var t=!1;GeoGlobe.Util.isArray(e)||(e=[e]);for(var i=e.length-1;0<=i;--i)t=this.removeComponent(e[i])||t;return t},removeComponent:function(e){return GeoGlobe.Util.removeItem(this.components,e),this.clearBounds(),!0},getLength:function(){for(var e=0,t=0,i=this.components.length;t<i;t++)e+=this.components[t].getLength();return e},getArea:function(){for(var e=0,t=0,i=this.components.length;t<i;t++)e+=this.components[t].getArea();return e},getGeodesicArea:function(e){for(var t=0,i=0,r=this.components.length;i<r;i++)t+=this.components[i].getGeodesicArea(e);return t},getCentroid:function(e){if(!e)return this.components.length&&this.components[0].getCentroid();var t=this.components.length;if(!t)return!1;for(var i,r=[],o=[],n=0,a=Number.MAX_VALUE,s=0;s<t;++s){var l=(i=this.components[s]).getArea(),u=i.getCentroid(!0);isNaN(l)||isNaN(u.x)||isNaN(u.y)||(r.push(l),n+=l,a=l<a&&0<l?l:a,o.push(u))}if(t=r.length,0===n){for(s=0;s<t;++s)r[s]=1;n=r.length}else{for(s=0;s<t;++s)r[s]/=a;n/=a}var h=0,c=0;for(s=0;s<t;++s)u=o[s],l=r[s],h+=u.x*l,c+=u.y*l;return new GeoGlobe.Geometry.Point(h/n,c/n)},getGeodesicLength:function(e){for(var t=0,i=0,r=this.components.length;i<r;i++)t+=this.components[i].getGeodesicLength(e);return t},move:function(e,t){for(var i=0,r=this.components.length;i<r;i++)this.components[i].move(e,t)},rotate:function(e,t){for(var i=0,r=this.components.length;i<r;++i)this.components[i].rotate(e,t)},resize:function(e,t,i){for(var r=0;r<this.components.length;++r)this.components[r].resize(e,t,i);return this},distanceTo:function(e,t){for(var i,r,o,n=!(t&&!1===t.edge)&&t&&t.details,a=Number.POSITIVE_INFINITY,s=0,l=this.components.length;s<l&&(i=this.components[s].distanceTo(e,t),!((o=n?i.distance:i)<a&&(r=i,0==(a=o))));++s);return r},equals:function(e){var t=!0;if(e&&e.CLASS_NAME&&this.CLASS_NAME==e.CLASS_NAME)if(GeoGlobe.Util.isArray(e.components)&&e.components.length==this.components.length){for(var i=0,r=this.components.length;i<r;++i)if(!this.components[i].equals(e.components[i])){t=!1;break}}else t=!1;else t=!1;return t},transform:function(e,t){if(e&&t){for(var i=0,r=this.components.length;i<r;i++)this.components[i].transform(e,t);this.bounds=null}return this},intersects:function(e){for(var t=!1,i=0,r=this.components.length;i<r&&!(t=e.intersects(this.components[i]));++i);return t},getVertices:function(e){for(var t=[],i=0,r=this.components.length;i<r;++i)Array.prototype.push.apply(t,this.components[i].getVertices(e));return t},CLASS_NAME:"GeoGlobe.Geometry.Collection"}),GeoGlobe.Geometry.Point=GeoGlobe.Class4OL(GeoGlobe.Geometry,{x:null,y:null,initialize:function(e,t){GeoGlobe.Geometry.prototype.initialize.apply(this,arguments),this.x=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(e),this.y=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(t)},clone:function(e){return null==e&&(e=new GeoGlobe.Geometry.Point(this.x,this.y)),GeoGlobe.Util.applyDefaults(e,this),e},calculateBounds:function(){var e=new GeoGlobe.LngLat(this.x,this.y),t=new GeoGlobe.LngLat(this.x,this.y);this.bounds=new GeoGlobe.LngLatBounds(e,t)},distanceTo:function(e,t){var i,r,o,n,a,s,l=!(t&&!1===t.edge)&&t&&t.details;return e instanceof GeoGlobe.Geometry.Point?(r=this.x,o=this.y,n=e.x,a=e.y,i=Math.sqrt(Math.pow(r-n,2)+Math.pow(o-a,2)),s=l?{x0:r,y0:o,x1:n,y1:a,distance:i}:i):(s=e.distanceTo(this,t),l&&(s={x0:s.x1,y0:s.y1,x1:s.x0,y1:s.y0,distance:s.distance})),s},equals:function(e){var t=!1;return null!=e&&(t=this.x==e.x&&this.y==e.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(e.x)&&isNaN(e.y)),t},toShortString:function(){return this.x+", "+this.y},move:function(e,t){this.x=this.x+e,this.y=this.y+t,this.clearBounds()},rotate:function(e,t){e*=Math.PI/180;var i=this.distanceTo(t),r=e+Math.atan2(this.y-t.y,this.x-t.x);this.x=t.x+i*Math.cos(r),this.y=t.y+i*Math.sin(r),this.clearBounds()},getCentroid:function(){return new GeoGlobe.Geometry.Point(this.x,this.y)},resize:function(e,t,i){return i=null==i?1:i,this.x=t.x+e*i*(this.x-t.x),this.y=t.y+e*(this.y-t.y),this.clearBounds(),this},intersects:function(e){return"GeoGlobe.Geometry.Point"==e.CLASS_NAME?this.equals(e):e.intersects(this)},transform:function(e,t){return e&&t&&(GeoGlobe.SpatialReference.transform(this,e,t),this.bounds=null),this},getVertices:function(){return[this]},CLASS_NAME:"GeoGlobe.Geometry.Point"}),GeoGlobe.Geometry.MultiPoint=GeoGlobe.Class4OL(GeoGlobe.Geometry.Collection,{componentTypes:["GeoGlobe.Geometry.Point"],addPoint:function(e,t){this.addComponent(e,t)},removePoint:function(e){this.removeComponent(e)},CLASS_NAME:"GeoGlobe.Geometry.MultiPoint"}),GeoGlobe.Geometry.Curve=GeoGlobe.Class4OL(GeoGlobe.Geometry.MultiPoint,{componentTypes:["GeoGlobe.Geometry.Point"],getLength:function(){var e=0;if(this.components&&1<this.components.length)for(var t=1,i=this.components.length;t<i;t++)e+=this.components[t-1].distanceTo(this.components[t]);return e},getGeodesicLength:function(e){var t=this;if(e){var i=new GeoGlobe.SpatialReference("EPSG:4326");i.equals(e)||(t=this.clone().transform(e,i))}var r=0;if(t.components&&1<t.components.length)for(var o,n,a=1,s=t.components.length;a<s;a++)o=t.components[a-1],n=t.components[a],r+=GeoGlobe.Util.distVincenty({lng:o.x,lat:o.y},{lng:n.x,lat:n.y});return 1e3*r},CLASS_NAME:"GeoGlobe.Geometry.Curve"}),GeoGlobe.Geometry.LineString=GeoGlobe.Class4OL(GeoGlobe.Geometry.Curve,{removeComponent:function(e){var t=this.components&&2<this.components.length;return t&&GeoGlobe.Geometry.Collection.prototype.removeComponent.apply(this,arguments),t},intersects:function(e){var t=!1,i=e.CLASS_NAME;if("GeoGlobe.Geometry.LineString"==i||"GeoGlobe.Geometry.LinearRing"==i||"GeoGlobe.Geometry.Point"==i){var r,o,n,a,s,l,u,h,c,p=this.getSortedSegments();r="GeoGlobe.Geometry.Point"==i?[{x1:e.x,y1:e.y,x2:e.x,y2:e.y}]:e.getSortedSegments();e:for(var d=0,f=p.length;d<f;++d){n=(o=p[d]).x1,a=o.x2,s=o.y1,l=o.y2;for(var g=0,m=r.length;g<m&&!((u=r[g]).x1>a);++g)if(!(u.x2<n)&&(h=u.y1,c=u.y2,!(Math.min(h,c)>Math.max(s,l))&&!(Math.max(h,c)<Math.min(s,l))&&GeoGlobe.Geometry.segmentsIntersect(o,u))){t=!0;break e}}}else t=e.intersects(this);return t},getSortedSegments:function(){for(var e,t,i=this.components.length-1,r=new Array(i),o=0;o<i;++o)e=this.components[o],t=this.components[o+1],e.x<t.x?r[o]={x1:e.x,y1:e.y,x2:t.x,y2:t.y}:r[o]={x1:t.x,y1:t.y,x2:e.x,y2:e.y};return r.sort((function(e,t){return e.x1-t.x1}))},splitWithSegment:function(e,t){for(var i,r,o,n,a=!(t&&!1===t.edge),s=t&&t.tolerance,l=[],u=this.getVertices(),h=[],c=[],p=!1,d={point:!0,tolerance:s},f=null,g=0,m=u.length-2;g<=m;++g)if(i=u[g],h.push(i.clone()),r=u[g+1],n={x1:i.x,y1:i.y,x2:r.x,y2:r.y},(o=GeoGlobe.Geometry.segmentsIntersect(e,n,d))instanceof GeoGlobe.Geometry.Point&&(o.x===e.x1&&o.y===e.y1||o.x===e.x2&&o.y===e.y2||o.equals(i)||o.equals(r)||a)){if(o.equals(c[c.length-1])||c.push(o.clone()),0===g&&o.equals(i))continue;if(o.equals(r))continue;p=!0,o.equals(i)||h.push(o),l.push(new GeoGlobe.Geometry.LineString(h)),h=[o.clone()]}if(p&&(h.push(r.clone()),l.push(new GeoGlobe.Geometry.LineString(h))),0<c.length){var _=e.x1<e.x2?1:-1,v=e.y1<e.y2?1:-1;f={lines:l,points:c.sort((function(e,t){return _*e.x-_*t.x||v*e.y-v*t.y}))}}return f},split:function(e,t){var i,r,o,n,a=null,s=t&&t.mutual;if(e instanceof GeoGlobe.Geometry.LineString){var l,u,h,c,p,d,f=this.getVertices(),g=[];o=[];for(var m=0,_=f.length-2;m<=_;++m){l=f[m],u=f[m+1],h={x1:l.x,y1:l.y,x2:u.x,y2:u.y},n=n||[e],s&&g.push(l.clone());for(var v=0;v<n.length;++v)if((c=n[v].splitWithSegment(h,t))&&(0<(p=c.lines).length&&(p.unshift(v,1),Array.prototype.splice.apply(n,p),v+=p.length-2),s))for(var C=0,y=c.points.length;C<y;++C)(d=c.points[C]).equals(l)||(g.push(d),o.push(new GeoGlobe.Geometry.LineString(g)),g=d.equals(u)?[]:[d.clone()])}s&&0<o.length&&0<g.length&&(g.push(u.clone()),o.push(new GeoGlobe.Geometry.LineString(g)))}else a=e.splitWith(this,t);return n&&1<n.length?r=!0:n=[],o&&1<o.length?i=!0:o=[],(r||i)&&(a=s?[o,n]:n),a},splitWith:function(e,t){return e.split(this,t)},getVertices:function(e){return!0===e?[this.components[0],this.components[this.components.length-1]]:!1===e?this.components.slice(1,this.components.length-1):this.components.slice()},distanceTo:function(e,t){var i,r=!(t&&!1===t.edge)&&t&&t.details,o={},n=Number.POSITIVE_INFINITY;if(e instanceof GeoGlobe.Geometry.Point){for(var a,s=this.getSortedSegments(),l=e.x,u=e.y,h=0,c=s.length;h<c;++h)if(a=s[h],(i=GeoGlobe.Geometry.distanceToSegment(e,a)).distance<n){if(0===(n=(o=i).distance))break}else if(a.x2>l&&(u>a.y1&&u<a.y2||u<a.y1&&u>a.y2))break;o=r?{distance:o.distance,x0:o.x,y0:o.y,x1:l,y1:u}:o.distance}else if(e instanceof GeoGlobe.Geometry.LineString){var p,d,f,g,m,_=this.getSortedSegments(),v=e.getSortedSegments(),C=v.length,y={point:!0};e:for(h=0,c=_.length;h<c;++h){g=(p=_[h]).x1,m=p.y1;for(var A=0;A<C;++A){if(d=v[A],f=GeoGlobe.Geometry.segmentsIntersect(p,d,y)){o={distance:n=0,x0:f.x,y0:f.y,x1:f.x,y1:f.y};break e}(i=GeoGlobe.Geometry.distanceToSegment({x:g,y:m},d)).distance<n&&(o={distance:n=i.distance,x0:g,y0:m,x1:i.x,y1:i.y})}}if(r||(o=o.distance),0!==n&&p){i=e.distanceTo(new GeoGlobe.Geometry.Point(p.x2,p.y2),t);var I=r?i.distance:i;I<n&&(o=r?{distance:n,x0:i.x1,y0:i.y1,x1:i.x0,y1:i.y0}:I)}}else o=e.distanceTo(this,t),r&&(o={distance:o.distance,x0:o.x1,y0:o.y1,x1:o.x0,y1:o.y0});return o},simplify:function(e){if(this&&null!==this){var t=this.getVertices();if(t.length<3)return this;var i=function(e,t,i){return Math.abs(.5*(e.x*t.y+t.x*i.y+i.x*e.y-t.x*e.y-i.x*t.y-e.x*i.y))/Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))*2},r=t.length-1,o=[];for(o.push(0),o.push(r);t[0].equals(t[r]);)r--,o.push(r);!function e(t,r,n,a){for(var s,l=0,u=0,h=r;h<n;h++)l<(s=i(t[r],t[n],t[h]))&&(l=s,u=h);a<l&&u!=r&&(o.push(u),e(t,r,u,a),e(t,u,n,a))}(t,0,r,e);var n=[];o.sort((function(e,t){return e-t}));for(var a=0;a<o.length;a++)n.push(t[o[a]]);return new GeoGlobe.Geometry.LineString(n)}return this},CLASS_NAME:"GeoGlobe.Geometry.LineString"}),GeoGlobe.Geometry.LineString.createCurveLine=function(e){for(var t=[],i=0;i<e.length-1;i++){var r=GeoGlobe.Geometry.LineString.getCurveCoordinatesByTwoPoints(e[i],e[i+1]);r&&0<r.length&&(t=t.concat(r))}return new GeoGlobe.Geometry.LineString(t)},GeoGlobe.Geometry.LineString.getCurveCoordinatesByTwoPoints=function(e,t){if(!(e&&t&&e instanceof GeoGlobe.Geometry.Point&&t instanceof GeoGlobe.Geometry.Point))return null;function i(e){return 1-2*e+e*e}function r(e){return 2*e-2*e*e}function o(e){return e*e}curveCoordinates=[];var n,a,s,l,u,h,c=0,p=0;if(void 0!==t){var d=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(e.y),f=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(t.y),g=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(e.x),m=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(t.x);for(g<m&&180<_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(m-g)&&g<0&&(g=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(360+g)),m<g&&180<_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(g-m)&&m<0&&(m=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(360+m)),h=0,a=f==d?(n=0,g-m):m==g?(n=Math.PI/2,d-f):(n=Math.atan((f-d)/(m-g)),(f-d)/Math.sin(n)),0==h&&(h=n+Math.PI/5),u=(s=a/2)*Math.cos(h)+g,l=s*Math.sin(h)+d,c=0;c<31;c++)curveCoordinates.push(new GeoGlobe.Geometry.Point(g*i(p)+u*r(p)+m*o(p),d*i(p)+l*r(p)+f*o(p))),p+=1/30;return curveCoordinates}"undefined"!=typeof curveCoordinates&&(curveCoordinates=[])},GeoGlobe.Geometry.LinearRing=GeoGlobe.Class4OL(GeoGlobe.Geometry.LineString,{componentTypes:["GeoGlobe.Geometry.Point"],addComponent:function(e,t){var i=!1,r=this.components.pop();null==t&&e.equals(r)||(i=GeoGlobe.Geometry.Collection.prototype.addComponent.apply(this,arguments));var o=this.components[0];return GeoGlobe.Geometry.Collection.prototype.addComponent.apply(this,[o]),i},removeComponent:function(e){var t=this.components&&3<this.components.length;if(t){this.components.pop(),GeoGlobe.Geometry.Collection.prototype.removeComponent.apply(this,arguments);var i=this.components[0];GeoGlobe.Geometry.Collection.prototype.addComponent.apply(this,[i])}return t},move:function(e,t){for(var i=0,r=this.components.length;i<r-1;i++)this.components[i].move(e,t)},rotate:function(e,t){for(var i=0,r=this.components.length;i<r-1;++i)this.components[i].rotate(e,t)},resize:function(e,t,i){for(var r=0,o=this.components.length;r<o-1;++r)this.components[r].resize(e,t,i);return this},transform:function(e,t){if(e&&t){for(var i=0,r=this.components.length;i<r-1;i++)this.components[i].transform(e,t);this.bounds=null}return this},getCentroid:function(){if(this.components){var e=this.components.length;if(0<e&&e<=2)return this.components[0].clone();if(2<e){var t=0,i=0,r=this.components[0].x,o=this.components[0].y,n=-1*this.getArea();if(0!=n){for(var a=0;a<e-1;a++){var s=this.components[a],l=this.components[a+1];t+=(s.x+l.x-2*r)*((s.x-r)*(l.y-o)-(l.x-r)*(s.y-o)),i+=(s.y+l.y-2*o)*((s.x-r)*(l.y-o)-(l.x-r)*(s.y-o))}var u=r+t/(6*n),h=o+i/(6*n)}else{for(a=0;a<e-1;a++)t+=this.components[a].x,i+=this.components[a].y;u=t/(e-1),h=i/(e-1)}return new GeoGlobe.Geometry.Point(u,h)}return null}},getArea:function(){var e=0;if(this.components&&2<this.components.length){for(var t=0,i=0,r=this.components.length;i<r-1;i++){var o=this.components[i],n=this.components[i+1];t+=(o.x+n.x)*(n.y-o.y)}e=-t/2}return e},getGeodesicArea:function(e){var t=this;if(e){var i=new GeoGlobe.SpatialReference("EPSG:4326");i.equals(e)||(t=this.clone().transform(e,i))}var r=0,o=t.components&&t.components.length;if(2<o){for(var n,a,s=0;s<o-1;s++)n=t.components[s],a=t.components[s+1],r+=GeoGlobe.Util.rad(a.x-n.x)*(2+Math.sin(GeoGlobe.Util.rad(n.y))+Math.sin(GeoGlobe.Util.rad(a.y)));r=6378137*r*6378137/2}return r},containsPoint:function(e){for(var t,i,r,o,n,a,s,l,u,h=GeoGlobe.Number.limitSigDigs,c=h(e.x,14),p=h(e.y,14),d=this.components.length-1,f=0,g=0;g<d;++g)if(r=h((t=this.components[g]).x,14),o=h(t.y,14),n=h((i=this.components[g+1]).x,14),o!=(a=h(i.y,14))){if((s=h(((l=n)-r)/((u=a)-o)*(p-u)+l,14))==c&&(o<a&&o<=p&&p<=a||a<o&&p<=o&&a<=p)){f=-1;break}s<=c||r!=n&&(s<Math.min(r,n)||s>Math.max(r,n))||(o<a&&o<=p&&p<a||a<o&&p<o&&a<=p)&&++f}else if(p==o&&(r<=n&&r<=c&&c<=n||n<=r&&c<=r&&n<=c)){f=-1;break}return-1==f?1:!!(1&f)},intersects:function(e){var t=!1;if("GeoGlobe.Geometry.Point"==e.CLASS_NAME)t=this.containsPoint(e);else if("GeoGlobe.Geometry.LineString"==e.CLASS_NAME)t=e.intersects(this);else if("GeoGlobe.Geometry.LinearRing"==e.CLASS_NAME)t=GeoGlobe.Geometry.LineString.prototype.intersects.apply(this,[e]);else for(var i=0,r=e.components.length;i<r&&!(t=e.components[i].intersects(this));++i);return t},getVertices:function(e){return!0===e?[]:this.components.slice(0,this.components.length-1)},CLASS_NAME:"GeoGlobe.Geometry.LinearRing"}),GeoGlobe.Geometry.Polygon=GeoGlobe.Class4OL(GeoGlobe.Geometry.Collection,{componentTypes:["GeoGlobe.Geometry.LinearRing"],getArea:function(){var e=0;if(this.components&&0<this.components.length){e+=Math.abs(this.components[0].getArea());for(var t=1,i=this.components.length;t<i;t++)e-=Math.abs(this.components[t].getArea())}return e},getGeodesicArea:function(e){var t=0;if(this.components&&0<this.components.length){t+=Math.abs(this.components[0].getGeodesicArea(e));for(var i=1,r=this.components.length;i<r;i++)t-=Math.abs(this.components[i].getGeodesicArea(e))}return t},containsPoint:function(e){var t=this.components.length,i=!1;if(0<t&&1!==(i=this.components[0].containsPoint(e))&&i&&1<t)for(var r,o=1;o<t;++o)if(r=this.components[o].containsPoint(e)){i=1===r&&1;break}return i},intersects:function(e){var t,i,r=!1;if("GeoGlobe.Geometry.Point"==e.CLASS_NAME)r=this.containsPoint(e);else if("GeoGlobe.Geometry.LineString"==e.CLASS_NAME||"GeoGlobe.Geometry.LinearRing"==e.CLASS_NAME){for(t=0,i=this.components.length;t<i&&!(r=e.intersects(this.components[t]));++t);if(!r)for(t=0,i=e.components.length;t<i&&!(r=this.containsPoint(e.components[t]));++t);}else for(t=0,i=e.components.length;t<i&&!(r=this.intersects(e.components[t]));++t);if(!r&&"GeoGlobe.Geometry.Polygon"==e.CLASS_NAME){var o=this.components[0];for(t=0,i=o.components.length;t<i&&!(r=e.containsPoint(o.components[t]));++t);}return r},distanceTo:function(e,t){return t&&!1===t.edge&&this.intersects(e)?0:GeoGlobe.Geometry.Collection.prototype.distanceTo.apply(this,[e,t])},CLASS_NAME:"GeoGlobe.Geometry.Polygon"}),GeoGlobe.Geometry.Polygon.createRegularPolygon=function(e,t,i,r){var o,n,a,s=Math.PI*(1/i-.5);r&&(s+=r/180*Math.PI);for(var l=[],u=0;u<i;++u)o=s+2*u*Math.PI/i,n=e.x+t*Math.cos(o),a=e.y+t*Math.sin(o),l.push(new GeoGlobe.Geometry.Point(n,a));var h=new GeoGlobe.Geometry.LinearRing(l);return new GeoGlobe.Geometry.Polygon([h])},GeoGlobe.Geometry.MultiLineString=GeoGlobe.Class4OL(GeoGlobe.Geometry.Collection,{componentTypes:["GeoGlobe.Geometry.LineString"],split:function(e,t){for(var i,r,o,n,a,s=null,l=t&&t.mutual,u=[],h=[e],c=0,p=this.components.length;c<p;++c){r=this.components[c],n=!1;for(var d=0;d<h.length;++d)if(i=r.split(h[d],t)){if(l){for(var f=0,g=(o=i[0]).length;f<g;++f)0===f&&u.length?u[u.length-1].addComponent(o[f]):u.push(new GeoGlobe.Geometry.MultiLineString([o[f]]));n=!0,i=i[1]}if(i.length){i.unshift(d,1),Array.prototype.splice.apply(h,i);break}}n||(u.length?u[u.length-1].addComponent(r.clone()):u=[new GeoGlobe.Geometry.MultiLineString(r.clone())])}return u&&1<u.length?n=!0:u=[],h&&1<h.length?a=!0:h=[],(n||a)&&(s=l?[u,h]:h),s},splitWith:function(e,t){var i,r,o,n,a,s,l,u=null,h=t&&t.mutual;if(e instanceof GeoGlobe.Geometry.LineString){l=[],s=[e];for(var c=0,p=this.components.length;c<p;++c){a=!1,r=this.components[c];for(var d=0;d<s.length;++d)if(i=s[d].split(r,t)){h&&((o=i[0]).length&&(o.unshift(d,1),Array.prototype.splice.apply(s,o),d+=o.length-2),0===(i=i[1]).length&&(i=[r.clone()]));for(var f=0,g=i.length;f<g;++f)0===f&&l.length?l[l.length-1].addComponent(i[f]):l.push(new GeoGlobe.Geometry.MultiLineString([i[f]]));a=!0}a||(l.length?l[l.length-1].addComponent(r.clone()):l=[new GeoGlobe.Geometry.MultiLineString([r.clone()])])}}else u=e.split(this);return s&&1<s.length?n=!0:s=[],l&&1<l.length?a=!0:l=[],(n||a)&&(u=h?[s,l]:l),u},CLASS_NAME:"GeoGlobe.Geometry.MultiLineString"}),GeoGlobe.Geometry.MultiPolygon=GeoGlobe.Class4OL(GeoGlobe.Geometry.Collection,{componentTypes:["GeoGlobe.Geometry.Polygon"],CLASS_NAME:"GeoGlobe.Geometry.MultiPolygon"}),GeoGlobe.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"},GeoGlobe.Feature=GeoGlobe.Class4OL({id:null,fid:null,lonlat:null,geometry:null,attributes:null,data:null,bounds:null,state:null,url:null,modified:null,initialize:function(e,t){this.data=null!=t?t:{},this.id=GeoGlobe.Util.createUniqueID(this.CLASS_NAME+"_"),this.lonlat=null,this.geometry=e||null,this.state=null,this.attributes={},t&&(this.attributes=GeoGlobe.Util.extend(this.attributes,t))},destroy:function(){this.geometry=null,this.modified=null,this.id=null,this.lonlat=null,this.data=null},clone:function(){return new GeoGlobe.Feature(this.geometry?this.geometry.clone():null,this.attributes)},createMarker:function(){return null},destroyMarker:function(){},createPopup:function(){return null},atPoint:function(e,t,i){var r=!1;return this.geometry&&(r=this.geometry.atPoint(e,t,i)),r},destroyPopup:function(){},toState:function(e){if(e==GeoGlobe.State.UPDATE)switch(this.state){case GeoGlobe.State.UNKNOWN:case GeoGlobe.State.DELETE:this.state=e;break;case GeoGlobe.State.UPDATE:case GeoGlobe.State.INSERT:}else if(e==GeoGlobe.State.INSERT)switch(this.state){case GeoGlobe.State.UNKNOWN:break;default:this.state=e}else if(e==GeoGlobe.State.DELETE)switch(this.state){case GeoGlobe.State.INSERT:case GeoGlobe.State.DELETE:break;case GeoGlobe.State.UNKNOWN:case GeoGlobe.State.UPDATE:this.state=e}else e==GeoGlobe.State.UNKNOWN&&(this.state=e)},CLASS_NAME:"GeoGlobe.Feature"}),GeoGlobe.Feature.getBoundsByFeatures=function(e){for(var t=e.length,i=new Array(t),r=0;r<t;++r)i[r]=e[r].geometry;var o=new GeoGlobe.Geometry.Collection(i);return o.calculateBounds(),o.bounds},GeoGlobe.Feature.fromGeoJson=function(e){if(GeoGlobe.Format&&GeoGlobe.Format.GeoJSON){format=new GeoGlobe.Format.GeoJSON;var t=format.read(e)}return t},GeoGlobe.Filter=GeoGlobe.Class4OL({initialize:function(e){GeoGlobe.Util.extend(this,e)},destroy:function(){},evaluate:function(){return!0},clone:function(){return null},toString:function(){return GeoGlobe.Format&&GeoGlobe.Format.CQL?GeoGlobe.Format.CQL.prototype.write(this):Object.prototype.toString.call(this)},CLASS_NAME:"GeoGlobe.Filter"}),GeoGlobe.Filter.FeatureId=GeoGlobe.Class4OL(GeoGlobe.Filter,{fids:null,type:"FID",initialize:function(e){this.fids=[],GeoGlobe.Filter.prototype.initialize.apply(this,[e])},evaluate:function(e){for(var t=0,i=this.fids.length;t<i;t++)if((e.fid||e.id)==this.fids[t])return!0;return!1},clone:function(){var e=new GeoGlobe.Filter.FeatureId;return GeoGlobe.Util.extend(e,this),e.fids=this.fids.slice(),e},CLASS_NAME:"GeoGlobe.Filter.FeatureId"}),GeoGlobe.Filter.Logical=GeoGlobe.Class4OL(GeoGlobe.Filter,{filters:null,type:null,initialize:function(e){this.filters=[],GeoGlobe.Filter.prototype.initialize.apply(this,[e])},destroy:function(){this.filters=null,GeoGlobe.Filter.prototype.destroy.apply(this)},evaluate:function(e){var t,i;switch(this.type){case GeoGlobe.Filter.Logical.AND:for(t=0,i=this.filters.length;t<i;t++)if(0==this.filters[t].evaluate(e))return!1;return!0;case GeoGlobe.Filter.Logical.OR:for(t=0,i=this.filters.length;t<i;t++)if(1==this.filters[t].evaluate(e))return!0;return!1;case GeoGlobe.Filter.Logical.NOT:return!this.filters[0].evaluate(e)}},clone:function(){for(var e=[],t=0,i=this.filters.length;t<i;++t)e.push(this.filters[t].clone());return new GeoGlobe.Filter.Logical({type:this.type,filters:e})},CLASS_NAME:"GeoGlobe.Filter.Logical"}),GeoGlobe.Filter.Logical.AND="&&",GeoGlobe.Filter.Logical.OR="||",GeoGlobe.Filter.Logical.NOT="!",GeoGlobe.Filter.Comparison=GeoGlobe.Class4OL(GeoGlobe.Filter,{type:null,property:null,value:null,matchCase:!0,lowerBoundary:null,upperBoundary:null,initialize:function(e){GeoGlobe.Filter.prototype.initialize.apply(this,[e]),this.type===GeoGlobe.Filter.Comparison.LIKE&&void 0===e.matchCase&&(this.matchCase=null)},evaluate:function(e){e instanceof GeoGlobe.Feature&&(e=e.attributes);var t,i=!1,r=e[this.property];if(void 0===r)return!1;switch(this.type){case GeoGlobe.Filter.Comparison.EQUAL_TO:t=this.value,i=this.matchCase||"string"!=typeof r||"string"!=typeof t?r==t:r.toUpperCase()==t.toUpperCase();break;case GeoGlobe.Filter.Comparison.NOT_EQUAL_TO:t=this.value,i=this.matchCase||"string"!=typeof r||"string"!=typeof t?r!=t:r.toUpperCase()!=t.toUpperCase();break;case GeoGlobe.Filter.Comparison.LESS_THAN:i=r<this.value;break;case GeoGlobe.Filter.Comparison.GREATER_THAN:i=r>this.value;break;case GeoGlobe.Filter.Comparison.LESS_THAN_OR_EQUAL_TO:i=r<=this.value;break;case GeoGlobe.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO:i=r>=this.value;break;case GeoGlobe.Filter.Comparison.BETWEEN:i=r>=this.lowerBoundary&&r<=this.upperBoundary;break;case GeoGlobe.Filter.Comparison.LIKE:i=new RegExp(this.value,"gi").test(r);break;case GeoGlobe.Filter.Comparison.IS_NULL:i=null===r}return i},value2regex:function(e,t,i){if("."==e)throw new Error("'.' is an unsupported wildCard character for GeoGlobe.Filter.Comparison");return e=e||"*",t=t||".",i=i||"!",this.value=this.value.replace(new RegExp("\\"+i+"(.|$)","g"),"\\$1"),this.value=this.value.replace(new RegExp("\\"+t,"g"),"."),this.value=this.value.replace(new RegExp("\\"+e,"g"),".*"),this.value=this.value.replace(new RegExp("\\\\.\\*","g"),"\\"+e),this.value=this.value.replace(new RegExp("\\\\\\.","g"),"\\"+t),this.value},regex2value:function(){var e=this.value;return(e=(e=(e=(e=e.replace(/!/g,"!!")).replace(/(\\)?\\\./g,(function(e,t){return t?e:"!."}))).replace(/(\\)?\\\*/g,(function(e,t){return t?e:"!*"}))).replace(/\\\\/g,"\\")).replace(/\.\*/g,"*")},clone:function(){return GeoGlobe.Util.extend(new GeoGlobe.Filter.Comparison,this)},CLASS_NAME:"GeoGlobe.Filter.Comparison"}),GeoGlobe.Filter.Comparison.EQUAL_TO="==",GeoGlobe.Filter.Comparison.NOT_EQUAL_TO="!=",GeoGlobe.Filter.Comparison.LESS_THAN="<",GeoGlobe.Filter.Comparison.GREATER_THAN=">",GeoGlobe.Filter.Comparison.LESS_THAN_OR_EQUAL_TO="<=",GeoGlobe.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO=">=",GeoGlobe.Filter.Comparison.BETWEEN="..",GeoGlobe.Filter.Comparison.LIKE="~",GeoGlobe.Filter.Comparison.IS_NULL="NULL",GeoGlobe.Filter.Spatial=GeoGlobe.Class4OL(GeoGlobe.Filter,{type:null,property:null,value:null,distance:null,distanceUnits:null,evaluate:function(e){var t=!1;switch(this.type){case GeoGlobe.Filter.Spatial.BBOX:case GeoGlobe.Filter.Spatial.INTERSECTS:if(e.geometry){var i=this.value;"GeoGlobe.LngLatBounds"==this.value.CLASS_NAME&&(i=this.value.toGeometry()),e.geometry.intersects(i)&&(t=!0)}break;default:throw new Error("evaluate is not implemented for this filter type.")}return t},clone:function(){var e=GeoGlobe.Util.applyDefaults({value:this.value&&this.value.clone&&this.value.clone()},this);return new GeoGlobe.Filter.Spatial(e)},CLASS_NAME:"GeoGlobe.Filter.Spatial"}),GeoGlobe.Filter.Spatial.BBOX="BBOX",GeoGlobe.Filter.Spatial.INTERSECTS="INTERSECTS",GeoGlobe.Filter.Spatial.DWITHIN="DWITHIN",GeoGlobe.Filter.Spatial.WITHIN="WITHIN",GeoGlobe.Filter.Spatial.CONTAINS="CONTAINS",GeoGlobe.Filter.Function=GeoGlobe.Class4OL(GeoGlobe.Filter,{name:null,params:null,CLASS_NAME:"GeoGlobe.Filter.Function"}),GeoGlobe.Protocol=GeoGlobe.Class4OL({format:null,options:null,autoDestroy:!0,defaultFilter:null,initialize:function(e){e=e||{},GeoGlobe.Util.extend(this,e),this.options=e},mergeWithDefaultFilter:function(e){return e&&this.defaultFilter?new GeoGlobe.Filter.Logical({type:GeoGlobe.Filter.Logical.AND,filters:[this.defaultFilter,e]}):e||this.defaultFilter||void 0},destroy:function(){this.options=null,this.format=null},read:function(e){(e=e||{}).filter=this.mergeWithDefaultFilter(e.filter)},create:function(){},update:function(){},delete:function(){},commit:function(){},abort:function(){},createCallback:function(e,t,i){return GeoGlobe.Function.bind((function(){e.apply(this,[t,i])}),this)},CLASS_NAME:"GeoGlobe.Protocol"}),GeoGlobe.Protocol.Response=GeoGlobe.Class4OL({code:null,requestType:null,last:!0,features:null,data:null,reqFeatures:null,priv:null,error:null,initialize:function(e){GeoGlobe.Util.extend(this,e)},success:function(){return 0<this.code},CLASS_NAME:"GeoGlobe.Protocol.Response"}),GeoGlobe.Protocol.Response.SUCCESS=1,GeoGlobe.Protocol.Response.FAILURE=0,GeoGlobe.Protocol.HTTP=GeoGlobe.Class4OL(GeoGlobe.Protocol,{url:null,headers:null,params:null,callback:null,scope:null,readWithPOST:!1,updateWithPOST:!1,deleteWithPOST:!1,wildcarded:!1,srsInBBOX:!1,initialize:function(e){if(e=e||{},this.params={},this.headers={},GeoGlobe.Protocol.prototype.initialize.apply(this,arguments),!this.filterToParams&&GeoGlobe.Format.QueryStringFilter){var t=new GeoGlobe.Format.QueryStringFilter({wildcarded:this.wildcarded,srsInBBOX:this.srsInBBOX});this.filterToParams=function(e,i){return t.write(e,i)}}},destroy:function(){this.params=null,this.headers=null,GeoGlobe.Protocol.prototype.destroy.apply(this)},read:function(e){GeoGlobe.Protocol.prototype.read.apply(this,arguments),(e=e||{}).params=GeoGlobe.Util.applyDefaults(e.params,this.options.params),(e=GeoGlobe.Util.applyDefaults(e,this.options)).filter&&this.filterToParams&&(e.params=this.filterToParams(e.filter,e.params));var t=void 0!==e.readWithPOST?e.readWithPOST:this.readWithPOST,i=new GeoGlobe.Protocol.Response({requestType:"read"});if(t){var r=e.headers||{};r["Content-Type"]="application/x-www-form-urlencoded",i.priv=GeoGlobe.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,i,e),data:GeoGlobe.Util.getParameterString(e.params),headers:r})}else i.priv=GeoGlobe.Request.GET({url:e.url,callback:this.createCallback(this.handleRead,i,e),params:e.params,headers:e.headers});return i},handleRead:function(e,t){this.handleResponse(e,t)},create:function(e,t){t=GeoGlobe.Util.applyDefaults(t,this.options);var i=new GeoGlobe.Protocol.Response({reqFeatures:e,requestType:"create"});return i.priv=GeoGlobe.Request.POST({url:t.url,callback:this.createCallback(this.handleCreate,i,t),headers:t.headers,data:this.format.write(e)}),i},handleCreate:function(e,t){this.handleResponse(e,t)},update:function(e,t){var i=(t=t||{}).url||e.url||this.options.url+"/"+e.fid;t=GeoGlobe.Util.applyDefaults(t,this.options);var r=new GeoGlobe.Protocol.Response({reqFeatures:e,requestType:"update"}),o=this.updateWithPOST?"POST":"PUT";return r.priv=GeoGlobe.Request[o]({url:i,callback:this.createCallback(this.handleUpdate,r,t),headers:t.headers,data:this.format.write(e)}),r},handleUpdate:function(e,t){this.handleResponse(e,t)},delete:function(e,t){var i=(t=t||{}).url||e.url||this.options.url+"/"+e.fid;t=GeoGlobe.Util.applyDefaults(t,this.options);var r=new GeoGlobe.Protocol.Response({reqFeatures:e,requestType:"delete"}),o=this.deleteWithPOST?"POST":"DELETE",n={url:i,callback:this.createCallback(this.handleDelete,r,t),headers:t.headers};return this.deleteWithPOST&&(n.data=this.format.write(e)),r.priv=GeoGlobe.Request[o](n),r},handleDelete:function(e,t){this.handleResponse(e,t)},handleResponse:function(e,t){var i=e.priv;t.callback&&(200<=i.status&&i.status<300?("delete"!=e.requestType&&(e.features=this.parseFeatures(i)),e.code=GeoGlobe.Protocol.Response.SUCCESS):e.code=GeoGlobe.Protocol.Response.FAILURE,t.callback.call(t.scope,e))},parseFeatures:function(e){var t=e.responseXML;return t&&t.documentElement||(t=e.responseText),!t||t.length<=0?null:this.format.read(t)},commit:function(e,t){t=GeoGlobe.Util.applyDefaults(t,this.options);var i=[],r=0,o={};o[GeoGlobe.State.INSERT]=[],o[GeoGlobe.State.UPDATE]=[],o[GeoGlobe.State.DELETE]=[];for(var n,a,s=[],l=0,u=e.length;l<u;++l)(a=o[(n=e[l]).state])&&(a.push(n),s.push(n));var h=(0<o[GeoGlobe.State.INSERT].length?1:0)+o[GeoGlobe.State.UPDATE].length+o[GeoGlobe.State.DELETE].length,c=!0,p=new GeoGlobe.Protocol.Response({reqFeatures:s});function d(e){this.callUserCallback(e,t),c=c&&e.success(),h<=++r&&t.callback&&(p.code=c?GeoGlobe.Protocol.Response.SUCCESS:GeoGlobe.Protocol.Response.FAILURE,t.callback.apply(t.scope,[p]))}var f=o[GeoGlobe.State.INSERT];for(0<f.length&&i.push(this.create(f,GeoGlobe.Util.applyDefaults({callback:function(e){for(var t=e.features?e.features.length:0,i=new Array(t),r=0;r<t;++r)i[r]=e.features[r].fid;p.insertIds=i,d.apply(this,[e])},scope:this},t.create))),l=(f=o[GeoGlobe.State.UPDATE]).length-1;0<=l;--l)i.push(this.update(f[l],GeoGlobe.Util.applyDefaults({callback:d,scope:this},t.update)));for(l=(f=o[GeoGlobe.State.DELETE]).length-1;0<=l;--l)i.push(this.delete(f[l],GeoGlobe.Util.applyDefaults({callback:d,scope:this},t.delete)));return i},abort:function(e){e&&e.priv.abort()},callUserCallback:function(e,t){var i=t[e.requestType];i&&i.callback&&i.callback.call(i.scope,e)},CLASS_NAME:"GeoGlobe.Protocol.HTTP"}),GeoGlobe.Protocol.WFS=function(e){e=GeoGlobe.Util.applyDefaults(e,GeoGlobe.Protocol.WFS.DEFAULTS);var t=GeoGlobe.Protocol.WFS["v"+e.version.replace(/\./g,"_")];if(!t)throw"Unsupported WFS version: "+e.version;return new t(e)},GeoGlobe.Protocol.WFS.DEFAULTS={version:"1.0.0"},GeoGlobe.Protocol.WFS.v1=GeoGlobe.Class4OL(GeoGlobe.Protocol,{version:null,srsName:"EPSG:4326",featureType:null,featureNS:null,geometryName:"the_geom",schema:null,featurePrefix:"feature",formatOptions:null,readFormat:null,readOptions:null,initialize:function(e){GeoGlobe.Protocol.prototype.initialize.apply(this,[e]),e.format||(this.format=GeoGlobe.Format.WFST(GeoGlobe.Util.extend({version:this.version,featureType:this.featureType,featureNS:this.featureNS,featurePrefix:this.featurePrefix,geometryName:this.geometryName,srsName:this.srsName,schema:this.schema},this.formatOptions))),!e.geometryName&&1<_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(this.format.version)&&this.setGeometryName(null)},destroy:function(){this.options&&!this.options.format&&this.format.destroy(),this.format=null,GeoGlobe.Protocol.prototype.destroy.apply(this)},read:function(e){GeoGlobe.Protocol.prototype.read.apply(this,arguments),e=GeoGlobe.Util.extend({},e),GeoGlobe.Util.applyDefaults(e,this.options||{});var t=new GeoGlobe.Protocol.Response({requestType:"read"}),i=GeoGlobe.Format.XML.prototype.write.apply(this.format,[this.format.writeNode("wfs:GetFeature",e)]);return t.priv=GeoGlobe.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,t,e),params:e.params,headers:e.headers,data:i}),t},setFeatureType:function(e){this.featureType=e,this.format.featureType=e},setGeometryName:function(e){this.geometryName=e,this.format.geometryName=e},handleRead:function(e,t){if(t=GeoGlobe.Util.extend({},t),GeoGlobe.Util.applyDefaults(t,this.options),t.callback){var i=e.priv;if(200<=i.status&&i.status<300){var r=this.parseResponse(i,t.readOptions);r&&!1!==r.success?(t.readOptions&&"object"==t.readOptions.output?GeoGlobe.Util.extend(e,r):e.features=r,e.code=GeoGlobe.Protocol.Response.SUCCESS):(e.code=GeoGlobe.Protocol.Response.FAILURE,e.error=r)}else e.code=GeoGlobe.Protocol.Response.FAILURE;t.callback.call(t.scope,e)}},parseResponse:function(e,t){var i=e.responseXML;if(i&&i.documentElement||(i=e.responseText),!i||i.length<=0)return null;var r=null;try{r=null!==this.readFormat?this.readFormat.read(i):this.format.read(i,t)}catch(e){var o="程序运行异常："+e.name+"，"+e.message;alert(o)}if(!this.featureNS){var n=this.readFormat||this.format;this.featureNS=n.featureNS,n.autoConfig=!1,this.geometryName||this.setGeometryName(n.geometryName)}return r},commit:function(e,t){t=GeoGlobe.Util.extend({},t),GeoGlobe.Util.applyDefaults(t,this.options);var i=new GeoGlobe.Protocol.Response({requestType:"commit",reqFeatures:e});return i.priv=GeoGlobe.Request.POST({url:t.url,headers:t.headers,data:this.format.write(e,t),callback:this.createCallback(this.handleCommit,i,t)}),i},handleCommit:function(e,t){if(t.callback){var i=e.priv,r=i.responseXML;r&&r.documentElement||(r=i.responseText);var o=this.format.read(r)||{};e.insertIds=o.insertIds||[],o.success?e.code=GeoGlobe.Protocol.Response.SUCCESS:(e.code=GeoGlobe.Protocol.Response.FAILURE,e.error=o),t.callback.call(t.scope,e)}},filterDelete:function(e,t){t=GeoGlobe.Util.extend({},t),GeoGlobe.Util.applyDefaults(t,this.options),new GeoGlobe.Protocol.Response({requestType:"commit"});var i=this.format.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version}}),r=this.format.createElementNSPlus("wfs:Delete",{attributes:{typeName:(t.featureNS?this.featurePrefix+":":"")+t.featureType}});t.featureNS&&r.setAttribute("xmlns:"+this.featurePrefix,t.featureNS);var o=this.format.writeNode("ogc:Filter",e);r.appendChild(o),i.appendChild(r);var n=GeoGlobe.Format.XML.prototype.write.apply(this.format,[i]);return GeoGlobe.Request.POST({url:this.url,callback:t.callback||function(){},data:n})},abort:function(e){e&&e.priv.abort()},CLASS_NAME:"GeoGlobe.Protocol.WFS.v1"}),GeoGlobe.Protocol.WFS.v1_0_0=GeoGlobe.Class4OL(GeoGlobe.Protocol.WFS.v1,{version:"1.0.0",CLASS_NAME:"GeoGlobe.Protocol.WFS.v1_0_0"}),GeoGlobe.Protocol.WFS.v1_1_0=GeoGlobe.Class4OL(GeoGlobe.Protocol.WFS.v1,{version:"1.1.0",initialize:function(e){GeoGlobe.Protocol.WFS.v1.prototype.initialize.apply(this,arguments),this.outputFormat&&!this.readFormat&&("gml2"==this.outputFormat.toLowerCase()?this.readFormat=new GeoGlobe.Format.GML.v2({featureType:this.featureType,featureNS:this.featureNS,geometryName:this.geometryName}):"json"==this.outputFormat.toLowerCase()&&(this.readFormat=new GeoGlobe.Format.GeoJSON))},CLASS_NAME:"GeoGlobe.Protocol.WFS.v1_1_0"}),GeoGlobe.Protocol.CSW=function(e){e=GeoGlobe.Util.applyDefaults(e,GeoGlobe.Protocol.CSW.DEFAULTS);var t=GeoGlobe.Protocol.CSW["v"+e.version.replace(/\./g,"_")];if(!t)throw"Unsupported CSW version: "+e.version;return new t(e)},GeoGlobe.Protocol.CSW.DEFAULTS={version:"2.0.2"},GeoGlobe.Protocol.CSW.v2_0_2=GeoGlobe.Class4OL(GeoGlobe.Protocol,{formatOptions:null,initialize:function(e){GeoGlobe.Protocol.prototype.initialize.apply(this,[e]),e.format||(this.format=new GeoGlobe.Format.CSWGetRecords.v2_0_2(GeoGlobe.Util.extend({},this.formatOptions)))},destroy:function(){this.options&&!this.options.format&&this.format.destroy(),this.format=null,GeoGlobe.Protocol.prototype.destroy.apply(this)},read:function(e){e=GeoGlobe.Util.extend({},e),GeoGlobe.Util.applyDefaults(e,this.options||{});var t=new GeoGlobe.Protocol.Response({requestType:"read"}),i=this.format.write(e.params||e);return t.priv=GeoGlobe.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,t,e),params:e.params,headers:e.headers,data:i}),t},handleRead:function(e,t){if(t.callback){var i=e.priv;200<=i.status&&i.status<300?(e.data=this.parseData(i),e.code=GeoGlobe.Protocol.Response.SUCCESS):e.code=GeoGlobe.Protocol.Response.FAILURE,t.callback.call(t.scope,e)}},parseData:function(e){var t=e.responseXML;return t&&t.documentElement||(t=e.responseText),!t||t.length<=0?null:this.format.read(t)},CLASS_NAME:"GeoGlobe.Protocol.CSW.v2_0_2"}),GeoGlobe.Protocol.Script=GeoGlobe.Class4OL(GeoGlobe.Protocol,{url:null,params:null,callback:null,callbackTemplate:"GeoGlobe.Protocol.Script.registry.${id}",callbackKey:"callback",callbackPrefix:"",scope:null,format:null,pendingRequests:null,srsInBBOX:!1,initialize:function(e){if(e=e||{},this.params={},this.pendingRequests={},GeoGlobe.Protocol.prototype.initialize.apply(this,arguments),this.format||(this.format=new GeoGlobe.Format.GeoJSON),!this.filterToParams&&GeoGlobe.Format.QueryStringFilter){var t=new GeoGlobe.Format.QueryStringFilter({srsInBBOX:this.srsInBBOX});this.filterToParams=function(e,i){return t.write(e,i)}}},read:function(e){GeoGlobe.Protocol.prototype.read.apply(this,arguments),(e=GeoGlobe.Util.applyDefaults(e,this.options)).params=GeoGlobe.Util.applyDefaults(e.params,this.options.params),e.filter&&this.filterToParams&&(e.params=this.filterToParams(e.filter,e.params));var t=new GeoGlobe.Protocol.Response({requestType:"read"}),i=this.createRequest(e.url,e.params,GeoGlobe.Function.bind((function(i){t.data=i,this.handleRead(t,e)}),this));return t.priv=i,t},createRequest:function(e,t,i){var r=GeoGlobe.Protocol.Script.register(i),o=GeoGlobe.String.format(this.callbackTemplate,{id:r});(t=GeoGlobe.Util.extend({},t))[this.callbackKey]=this.callbackPrefix+o,e=GeoGlobe.Util.urlAppend(e,GeoGlobe.Util.getParameterString(t));var n=document.createElement("script");return n.type="text/javascript",n.src=e,n.id="GeoGlobe_Protocol_Script_"+r,this.pendingRequests[n.id]=n,document.getElementsByTagName("head")[0].appendChild(n),n},destroyRequest:function(e){GeoGlobe.Protocol.Script.unregister(e.id.split("_").pop()),delete this.pendingRequests[e.id],e.parentNode&&e.parentNode.removeChild(e)},handleRead:function(e,t){this.handleResponse(e,t)},handleResponse:function(e,t){t.callback&&(e.data?(e.features=this.parseFeatures(e.data),e.code=GeoGlobe.Protocol.Response.SUCCESS):e.code=GeoGlobe.Protocol.Response.FAILURE,this.destroyRequest(e.priv),t.callback.call(t.scope,e))},parseFeatures:function(e){return this.format.read(e)},abort:function(e){if(e)this.destroyRequest(e.priv);else for(var t in this.pendingRequests)this.destroyRequest(this.pendingRequests[t])},destroy:function(){this.abort(),delete this.params,delete this.format,GeoGlobe.Protocol.prototype.destroy.apply(this)},CLASS_NAME:"GeoGlobe.Protocol.Script"}),o=GeoGlobe.Protocol.Script,r=0,o.registry={},o.register=function(e){var t="c"+ ++r;return o.registry[t]=function(){e.apply(this,arguments)},t},o.unregister=function(e){delete o.registry[e]},GeoGlobe.Format=GeoGlobe.Class4OL({options:null,externalProjection:null,internalProjection:null,data:null,keepData:!1,initialize:function(e){GeoGlobe.Util.extend(this,e),this.options=e},destroy:function(){},read:function(){throw new Error("Read not implemented.")},write:function(){throw new Error("Write not implemented.")},CLASS_NAME:"GeoGlobe.Format"}),GeoGlobe.Format.XML=GeoGlobe.Class4OL(GeoGlobe.Format,{namespaces:null,namespaceAlias:null,defaultPrefix:null,readers:{},writers:{},xmldom:null,initialize:function(e){for(var t in window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM")),GeoGlobe.Format.prototype.initialize.apply(this,[e]),this.namespaces=GeoGlobe.Util.extend({},this.namespaces),this.namespaceAlias={},this.namespaces)this.namespaceAlias[this.namespaces[t]]=t},destroy:function(){this.xmldom=null,GeoGlobe.Format.prototype.destroy.apply(this,arguments)},setNamespace:function(e,t){this.namespaces[e]=t,this.namespaceAlias[t]=e},read:function(e){var t=e.indexOf("<");0<t&&(e=e.substring(t));var i=GeoGlobe.Util.Try(GeoGlobe.Function.bind((function(){var t;return(t=window.ActiveXObject&&!this.xmldom?new ActiveXObject("Microsoft.XMLDOM"):this.xmldom).loadXML(e),t}),this),(function(){return(new DOMParser).parseFromString(e,"text/xml")}),(function(){var t=new XMLHttpRequest;return t.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(e),!1),t.overrideMimeType&&t.overrideMimeType("text/xml"),t.send(null),t.responseXML}));return this.keepData&&(this.data=i),i},write:function(e){var t;if(e.xml)t=e.xml;else{var i=new XMLSerializer;if(1==e.nodeType){var r=document.implementation.createDocument("","",null);r.importNode&&(e=r.importNode(e,!0)),r.appendChild(e),t=i.serializeToString(r)}else t=i.serializeToString(e)}return t},createElementNS:function(e,t){return this.xmldom?"string"==typeof e?this.xmldom.createNode(1,t,e):this.xmldom.createNode(1,t,""):document.createElementNS(e,t)},createDocumentFragment:function(){return this.xmldom?this.xmldom.createDocumentFragment():document.createDocumentFragment()},createTextNode:function(e){return"string"!=typeof e&&(e=String(e)),this.xmldom?this.xmldom.createTextNode(e):document.createTextNode(e)},getElementsByTagNameNS:function(e,t,i){var r=[];if(e.getElementsByTagNameNS)r=e.getElementsByTagNameNS(t,i);else for(var o,n,a=e.getElementsByTagName("*"),s=0,l=a.length;s<l;++s)n=(o=a[s]).prefix?o.prefix+":"+i:i,"*"!=i&&n!=o.nodeName||"*"!=t&&t!=o.namespaceURI||r.push(o);return r},getAttributeNodeNS:function(e,t,i){var r=null;if(e.getAttributeNodeNS)r=e.getAttributeNodeNS(t,i);else for(var o,n=e.attributes,a=0,s=n.length;a<s;++a)if((o=n[a]).namespaceURI==t&&(o.prefix?o.prefix+":"+i:i)==o.nodeName){r=o;break}return r},getAttributeNS:function(e,t,i){var r="";if(e.getAttributeNS)r=e.getAttributeNS(t,i)||"";else{var o=this.getAttributeNodeNS(e,t,i);o&&(r=o.nodeValue)}return r},getChildValue:function(e,t){var i=t||"";if(e)for(var r=e.firstChild;r;r=r.nextSibling)switch(r.nodeType){case 3:case 4:i+=r.nodeValue}return i},isSimpleContent:function(e){for(var t=!0,i=e.firstChild;i;i=i.nextSibling)if(1===i.nodeType){t=!1;break}return t},contentType:function(e){for(var t=!1,i=!1,r=GeoGlobe.Format.XML.CONTENT_TYPE.EMPTY,o=e.firstChild;o;o=o.nextSibling){switch(o.nodeType){case 1:i=!0;break;case 8:break;default:t=!0}if(i&&t)break}if(i&&t)r=GeoGlobe.Format.XML.CONTENT_TYPE.MIXED;else{if(i)return GeoGlobe.Format.XML.CONTENT_TYPE.COMPLEX;if(t)return GeoGlobe.Format.XML.CONTENT_TYPE.SIMPLE}return r},hasAttributeNS:function(e,t,i){return e.hasAttributeNS?e.hasAttributeNS(t,i):!!this.getAttributeNodeNS(e,t,i)},setAttributeNS:function(e,t,i,r){if(e.setAttributeNS)e.setAttributeNS(t,i,r);else{if(!this.xmldom)throw"setAttributeNS not implemented";if(t){var o=e.ownerDocument.createNode(2,i,t);o.nodeValue=r,e.setAttributeNode(o)}else e.setAttribute(i,r)}},createElementNSPlus:function(e,t){var i=(t=t||{}).uri||this.namespaces[t.prefix];if(!i){var r=e.indexOf(":");i=this.namespaces[e.substring(0,r)]}i=i||this.namespaces[this.defaultPrefix];var o=this.createElementNS(i,e);t.attributes&&this.setAttributes(o,t.attributes);var n=t.value;return null!=n&&o.appendChild(this.createTextNode(n)),o},setAttributes:function(e,t){var i,r;for(var o in t)null!=t[o]&&t[o].toString&&(i=t[o].toString(),r=this.namespaces[o.substring(0,o.indexOf(":"))]||null,this.setAttributeNS(e,r,o,i))},readNode:function(e,t){t=t||{};var i=this.readers[e.namespaceURI?this.namespaceAlias[e.namespaceURI]:this.defaultPrefix];if(i){var r=i[e.localName||e.nodeName.split(":").pop()]||i["*"];r&&r.apply(this,[e,t])}return t},readChildNodes:function(e,t){t=t||{};for(var i,r=e.childNodes,o=0,n=r.length;o<n;++o)1==(i=r[o]).nodeType&&this.readNode(i,t);return t},writeNode:function(e,t,i){var r,o,n=e.indexOf(":");o=0<n?(r=e.substring(0,n),e.substring(n+1)):(r=i?this.namespaceAlias[i.namespaceURI]:this.defaultPrefix,e);var a=this.writers[r][o].apply(this,[t]);return i&&i.appendChild(a),a},getChildEl:function(e,t,i){return e&&this.getThisOrNextEl(e.firstChild,t,i)},getNextEl:function(e,t,i){return e&&this.getThisOrNextEl(e.nextSibling,t,i)},getThisOrNextEl:function(e,t,i){e:for(var r=e;r;r=r.nextSibling)switch(r.nodeType){case 1:if(!(t&&t!==(r.localName||r.nodeName.split(":").pop())||i&&i!==r.namespaceURI))break e;r=null;break e;case 3:if(/^\s*$/.test(r.nodeValue))break;case 4:case 6:case 12:case 10:case 11:r=null;break e}return r||null},lookupNamespaceURI:function(e,t){var i=null;if(e)if(e.lookupNamespaceURI)i=e.lookupNamespaceURI(t);else e:switch(e.nodeType){case 1:if(null!==e.namespaceURI&&e.prefix===t){i=e.namespaceURI;break e}var r=e.attributes.length;if(r)for(var o,n=0;n<r;++n){if("xmlns"===(o=e.attributes[n]).prefix&&o.name==="xmlns:"+t){i=o.value||null;break e}if("xmlns"===o.name&&null===t){i=o.value||null;break e}}i=this.lookupNamespaceURI(e.parentNode,t);break e;case 2:i=this.lookupNamespaceURI(e.ownerElement,t);break e;case 9:i=this.lookupNamespaceURI(e.documentElement,t);break e;case 6:case 12:case 10:case 11:break e;default:i=this.lookupNamespaceURI(e.parentNode,t)}return i},getXMLDoc:function(){return GeoGlobe.Format.XML.document||this.xmldom||(document.implementation&&document.implementation.createDocument?GeoGlobe.Format.XML.document=document.implementation.createDocument("","",null):!this.xmldom&&window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM"))),GeoGlobe.Format.XML.document||this.xmldom},CLASS_NAME:"GeoGlobe.Format.XML"}),GeoGlobe.Format.XML.CONTENT_TYPE={EMPTY:0,SIMPLE:1,COMPLEX:2,MIXED:3},GeoGlobe.Format.XML.lookupNamespaceURI=GeoGlobe.Function.bind(GeoGlobe.Format.XML.prototype.lookupNamespaceURI,GeoGlobe.Format.XML.prototype),GeoGlobe.Format.XML.document=null,GeoGlobe.Format.XML.VersionedOGC=GeoGlobe.Class4OL(GeoGlobe.Format.XML,{defaultVersion:null,version:null,profile:null,allowFallback:!1,name:null,stringifyOutput:!1,parser:null,initialize:function(e){GeoGlobe.Format.XML.prototype.initialize.apply(this,[e]);var t=this.CLASS_NAME;this.name=t.substring(t.lastIndexOf(".")+1)},getVersion:function(e,t){return e?this.version||e.getAttribute("version")||this.defaultVersion:t&&t.version||this.version||this.defaultVersion},getParser:function(e){e=e||this.defaultVersion;var t=this.profile?"_"+this.profile:"";if(!this.parser||this.parser.VERSION!=e){var i=GeoGlobe.Format[this.name]["v"+e.replace(/\./g,"_")+t];if(!i&&(""!==t&&this.allowFallback&&(t="",i=GeoGlobe.Format[this.name]["v"+e.replace(/\./g,"_")]),!i))throw"Can't find a "+this.name+" parser for version "+e+t;this.parser=new i(this.options)}return this.parser},write:function(e,t){var i=this.getVersion(null,t);this.parser=this.getParser(i);var r=this.parser.write(e,t);return!1===this.stringifyOutput?r:GeoGlobe.Format.XML.prototype.write.apply(this,[r])},read:function(e,t){"string"==typeof e&&(e=GeoGlobe.Format.XML.prototype.read.apply(this,[e]));var i=e.documentElement,r=this.getVersion(i);this.parser=this.getParser(r);var o=this.parser.read(e,t),n=this.parser.errorProperty||null;if(null!==n&&void 0===o[n]){var a=new GeoGlobe.Format.OGCExceptionReport;o.error=a.read(e)}return o.version=r,o},CLASS_NAME:"GeoGlobe.Format.XML.VersionedOGC"}),GeoGlobe.Format.GML=GeoGlobe.Class4OL(GeoGlobe.Format.XML,{featureNS:"http://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",featureName:"featureMember",layerName:"features",geometryName:"geometry",collectionName:"FeatureCollection",gmlns:"http://www.opengis.net/gml",extractAttributes:!0,xy:!0,initialize:function(e){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},GeoGlobe.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){"string"==typeof e&&(e=GeoGlobe.Format.XML.prototype.read.apply(this,[e]));for(var t=this.getElementsByTagNameNS(e.documentElement,this.gmlns,this.featureName),i=[],r=0;r<t.length;r++){var o=this.parseFeature(t[r]);o&&i.push(o)}return i},parseFeature:function(e){for(var t,i,r,o,n,a=["MultiPolygon","Polygon","MultiLineString","LineString","MultiPoint","Point","Envelope"],s=0;s<a.length;++s)if(t=a[s],0<(i=this.getElementsByTagNameNS(e,this.gmlns,t)).length){if(!(o=this.parseGeometry[t.toLowerCase()]))throw new TypeError("Unsupported geometry type: "+t);r=o.apply(this,[i[0]]),this.internalProjection&&this.externalProjection&&r.transform(this.externalProjection,this.internalProjection);break}var l,u=this.getElementsByTagNameNS(e,this.gmlns,"Box");for(s=0;s<u.length;++s){var h=u[s],c=this.parseGeometry.box.apply(this,[h]),p=h.parentNode;"boundedBy"===(p.localName||p.nodeName.split(":").pop())?n=c:r=c.toGeometry()}this.extractAttributes&&(l=this.parseAttributes(e));var d=new GeoGlobe.Feature(r,l);d.bounds=n,d.gml={featureType:e.firstChild.nodeName.split(":")[1],featureNS:e.firstChild.namespaceURI,featureNSPrefix:e.firstChild.prefix};for(var f,g=e.firstChild;g&&(1!=g.nodeType||!(f=g.getAttribute("fid")||g.getAttribute("id")));)g=g.nextSibling;return d.fid=f,d},parseGeometry:{point:function(e){var t,i=[];if(0<(t=this.getElementsByTagNameNS(e,this.gmlns,"pos")).length&&(i=t[0].firstChild.nodeValue.replace(this.regExes.trimSpace,"").split(this.regExes.splitSpace)),0==i.length&&0<(t=this.getElementsByTagNameNS(e,this.gmlns,"coordinates")).length&&(i=t[0].firstChild.nodeValue.replace(this.regExes.removeSpace,"").split(",")),0==i.length&&0<(t=this.getElementsByTagNameNS(e,this.gmlns,"coord")).length){var r=this.getElementsByTagNameNS(t[0],this.gmlns,"X"),o=this.getElementsByTagNameNS(t[0],this.gmlns,"Y");0<r.length&&0<o.length&&(i=[r[0].firstChild.nodeValue,o[0].firstChild.nodeValue])}return 2==i.length&&(i[2]=null),this.xy?new GeoGlobe.Geometry.Point(i[0],i[1],i[2]):new GeoGlobe.Geometry.Point(i[1],i[0],i[2])},multipoint:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"Point"),i=[];if(0<t.length)for(var r,o=0;o<t.length;++o)(r=this.parseGeometry.point.apply(this,[t[o]]))&&i.push(r);return new GeoGlobe.Geometry.MultiPoint(i)},linestring:function(e,t){var i,r=[],o=[];if(0<(i=this.getElementsByTagNameNS(e,this.gmlns,"posList")).length){r=this.getChildValue(i[0]).replace(this.regExes.trimSpace,"").split(this.regExes.splitSpace);for(var n,a,s,l,u=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(i[0].getAttribute("dimension")),h=0;h<r.length/u;++h)a=r[n=h*u],s=r[1+n],l=2==u?null:r[2+n],this.xy?o.push(new GeoGlobe.Geometry.Point(a,s,l)):o.push(new GeoGlobe.Geometry.Point(s,a,l))}if(0==r.length&&0<(i=this.getElementsByTagNameNS(e,this.gmlns,"coordinates")).length){var c=this.getChildValue(i[0]).replace(this.regExes.trimSpace,"").replace(this.regExes.trimComma,",").split(this.regExes.splitSpace);for(h=0;h<c.length;++h)2==(r=c[h].split(",")).length&&(r[2]=null),this.xy?o.push(new GeoGlobe.Geometry.Point(r[0],r[1],r[2])):o.push(new GeoGlobe.Geometry.Point(r[1],r[0],r[2]))}var p=null;return 0!=o.length&&(p=t?new GeoGlobe.Geometry.LinearRing(o):new GeoGlobe.Geometry.LineString(o)),p},multilinestring:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"LineString"),i=[];if(0<t.length)for(var r,o=0;o<t.length;++o)(r=this.parseGeometry.linestring.apply(this,[t[o]]))&&i.push(r);return new GeoGlobe.Geometry.MultiLineString(i)},polygon:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"LinearRing"),i=[];if(0<t.length)for(var r,o=0;o<t.length;++o)(r=this.parseGeometry.linestring.apply(this,[t[o],!0]))&&i.push(r);return new GeoGlobe.Geometry.Polygon(i)},multipolygon:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"Polygon"),i=[];if(0<t.length)for(var r,o=0;o<t.length;++o)(r=this.parseGeometry.polygon.apply(this,[t[o]]))&&i.push(r);return new GeoGlobe.Geometry.MultiPolygon(i)},envelope:function(e){var t,i=[],r=this.getElementsByTagNameNS(e,this.gmlns,"lowerCorner");if(0<r.length){var o=[];if(0<r.length&&(o=r[0].firstChild.nodeValue.replace(this.regExes.trimSpace,"").split(this.regExes.splitSpace)),2==o.length&&(o[2]=null),this.xy)var n=new GeoGlobe.Geometry.Point(o[0],o[1],o[2]);else n=new GeoGlobe.Geometry.Point(o[1],o[0],o[2])}var a=this.getElementsByTagNameNS(e,this.gmlns,"upperCorner");if(0<a.length)if(o=[],0<a.length&&(o=a[0].firstChild.nodeValue.replace(this.regExes.trimSpace,"").split(this.regExes.splitSpace)),2==o.length&&(o[2]=null),this.xy)var s=new GeoGlobe.Geometry.Point(o[0],o[1],o[2]);else s=new GeoGlobe.Geometry.Point(o[1],o[0],o[2]);if(n&&s){i.push(new GeoGlobe.Geometry.Point(n.x,n.y)),i.push(new GeoGlobe.Geometry.Point(s.x,n.y)),i.push(new GeoGlobe.Geometry.Point(s.x,s.y)),i.push(new GeoGlobe.Geometry.Point(n.x,s.y)),i.push(new GeoGlobe.Geometry.Point(n.x,n.y));var l=new GeoGlobe.Geometry.LinearRing(i);t=new GeoGlobe.Geometry.Polygon([l])}return t},box:function(e){var t,i=this.getElementsByTagNameNS(e,this.gmlns,"coordinates"),r=null,o=null;if(0<i.length&&2==(t=i[0].firstChild.nodeValue.split(" ")).length&&(r=t[0].split(","),o=t[1].split(",")),null!==r&&null!==o){var n=new GeoGlobe.LngLat(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(r[0]),_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(r[1])),a=new GeoGlobe.LngLat(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(o[0]),_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(o[1]));return new GeoGlobe.LngLatBounds(n,a)}}},parseAttributes:function(e){for(var t,i,r,o,n,a,s,l={},u=e.firstChild;u;){if(1==u.nodeType){for(t=u.childNodes,i=0;i<t.length;++i)1==(r=t[i]).nodeType&&(1==(o=r.childNodes).length?3!=(n=o[0]).nodeType&&4!=n.nodeType||(a=r.prefix?r.nodeName.split(":")[1]:r.nodeName,s=n.nodeValue.replace(this.regExes.trimSpace,""),l[a]=s):l[r.nodeName.split(":").pop()]=null);break}u=u.nextSibling}return l},write:function(e){GeoGlobe.Util.isArray(e)||(e=[e]);for(var t=this.createElementNS("http://www.opengis.net/wfs","wfs:"+this.collectionName),i=0;i<e.length;i++)t.appendChild(this.createFeatureXML(e[i]));return GeoGlobe.Format.XML.prototype.write.apply(this,[t])},createFeatureXML:function(e){var t=e.geometry,i=this.buildGeometryNode(t),r=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.geometryName);r.appendChild(i);var o=this.createElementNS(this.gmlns,"gml:"+this.featureName),n=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.layerName),a=e.fid||e.id;for(var s in n.setAttribute("fid",a),n.appendChild(r),e.attributes){var l=this.createTextNode(e.attributes[s]),u=s.substring(s.lastIndexOf(":")+1),h=this.createElementNS(this.featureNS,this.featurePrefix+":"+u);h.appendChild(l),n.appendChild(h)}return o.appendChild(n),o},buildGeometryNode:function(e){this.externalProjection&&this.internalProjection&&(e=e.clone()).transform(this.internalProjection,this.externalProjection);var t=e.CLASS_NAME,i=t.substring(t.lastIndexOf(".")+1);return this.buildGeometry[i.toLowerCase()].apply(this,[e])},buildGeometry:{point:function(e){var t=this.createElementNS(this.gmlns,"gml:Point");return t.appendChild(this.buildCoordinatesNode(e)),t},multipoint:function(e){for(var t,i,r=this.createElementNS(this.gmlns,"gml:MultiPoint"),o=e.components,n=0;n<o.length;n++)t=this.createElementNS(this.gmlns,"gml:pointMember"),i=this.buildGeometry.point.apply(this,[o[n]]),t.appendChild(i),r.appendChild(t);return r},linestring:function(e){var t=this.createElementNS(this.gmlns,"gml:LineString");return t.appendChild(this.buildCoordinatesNode(e)),t},multilinestring:function(e){for(var t,i,r=this.createElementNS(this.gmlns,"gml:MultiLineString"),o=e.components,n=0;n<o.length;++n)t=this.createElementNS(this.gmlns,"gml:lineStringMember"),i=this.buildGeometry.linestring.apply(this,[o[n]]),t.appendChild(i),r.appendChild(t);return r},linearring:function(e){var t=this.createElementNS(this.gmlns,"gml:LinearRing");return t.appendChild(this.buildCoordinatesNode(e)),t},polygon:function(e){for(var t,i,r,o=this.createElementNS(this.gmlns,"gml:Polygon"),n=e.components,a=0;a<n.length;++a)r=0==a?"outerBoundaryIs":"innerBoundaryIs",t=this.createElementNS(this.gmlns,"gml:"+r),i=this.buildGeometry.linearring.apply(this,[n[a]]),t.appendChild(i),o.appendChild(t);return o},multipolygon:function(e){for(var t,i,r=this.createElementNS(this.gmlns,"gml:MultiPolygon"),o=e.components,n=0;n<o.length;++n)t=this.createElementNS(this.gmlns,"gml:polygonMember"),i=this.buildGeometry.polygon.apply(this,[o[n]]),t.appendChild(i),r.appendChild(t);return r},lnglatbounds:function(e){var t=this.createElementNS(this.gmlns,"gml:Box");return t.appendChild(this.buildCoordinatesNode(e)),t}},buildCoordinatesNode:function(e){var t=this.createElementNS(this.gmlns,"gml:coordinates");t.setAttribute("decimal","."),t.setAttribute("cs",","),t.setAttribute("ts"," ");var i=[];if(e instanceof GeoGlobe.LngLatBounds)i.push(e.getWest()+","+e.getSouth()),i.push(e.getEast()+","+e.getNorth());else for(var r=e.components?e.components:[e],o=0;o<r.length;o++)i.push(r[o].x+","+r[o].y);var n=this.createTextNode(i.join(" "));return t.appendChild(n),t},CLASS_NAME:"GeoGlobe.Format.GML"}),GeoGlobe.Format.GML||(GeoGlobe.Format.GML={}),GeoGlobe.Format.GML.Base=GeoGlobe.Class4OL(GeoGlobe.Format.XML,{namespaces:{gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs"},defaultPrefix:"gml",schemaLocation:null,featureType:null,featureNS:null,geometryName:"geometry",extractAttributes:!0,srsName:null,xy:!0,geometryTypes:null,singleFeatureType:null,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,featureMember:/^(.*:)?featureMembers?$/},initialize:function(e){GeoGlobe.Format.XML.prototype.initialize.apply(this,[e]),this.setGeometryTypes(),e&&e.featureNS&&this.setNamespace("feature",e.featureNS),this.singleFeatureType=!e||"string"==typeof e.featureType},read:function(e){"string"==typeof e&&(e=GeoGlobe.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t,i=[];if(this.readNode(e,{features:i},!0),0==i.length)if((t=this.getElementsByTagNameNS(e,this.namespaces.gml,"featureMember")).length)for(var r=0,o=t.length;r<o;++r)this.readNode(t[r],{features:i},!0);else(t=this.getElementsByTagNameNS(e,this.namespaces.gml,"featureMembers")).length&&this.readNode(t[0],{features:i},!0);return i},readNode:function(e,t,i){return!0===i&&!0===this.autoConfig&&(this.featureType=null,delete this.namespaceAlias[this.featureNS],delete this.namespaces.feature,this.featureNS=null),this.featureNS||e.prefix in this.namespaces||e.parentNode.namespaceURI!=this.namespaces.gml||!this.regExes.featureMember.test(e.parentNode.nodeName)||(this.featureType=e.nodeName.split(":").pop(),this.setNamespace("feature",e.namespaceURI),this.featureNS=e.namespaceURI,this.autoConfig=!0),GeoGlobe.Format.XML.prototype.readNode.apply(this,[e,t])},readers:{gml:{_inherit:function(){},featureMember:function(e,t){this.readChildNodes(e,t)},featureMembers:function(e,t){this.readChildNodes(e,t)},name:function(e,t){t.name=this.getChildValue(e)},boundedBy:function(e,t){var i={};this.readChildNodes(e,i),i.components&&0<i.components.length&&(t.bounds=i.components[0])},Point:function(e,t){var i={points:[]};this.readChildNodes(e,i),t.components||(t.components=[]),t.components.push(i.points[0])},coordinates:function(e,t){for(var i,r=this.getChildValue(e).replace(this.regExes.trimSpace,""),o=(r=r.replace(this.regExes.trimComma,",")).split(this.regExes.splitSpace),n=o.length,a=new Array(n),s=0;s<n;++s)i=o[s].split(","),this.xy?a[s]=new GeoGlobe.Geometry.Point(i[0],i[1],i[2]):a[s]=new GeoGlobe.Geometry.Point(i[1],i[0],i[2]);t.points=a},coord:function(e,t){var i={};this.readChildNodes(e,i),t.points||(t.points=[]),t.points.push(new GeoGlobe.Geometry.Point(i.x,i.y,i.z))},X:function(e,t){t.x=this.getChildValue(e)},Y:function(e,t){t.y=this.getChildValue(e)},Z:function(e,t){t.z=this.getChildValue(e)},MultiPoint:function(e,t){var i={components:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),t.components=[new GeoGlobe.Geometry.MultiPoint(i.components)]},pointMember:function(e,t){this.readChildNodes(e,t)},LineString:function(e,t){var i={};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),t.components||(t.components=[]),t.components.push(new GeoGlobe.Geometry.LineString(i.points))},MultiLineString:function(e,t){var i={components:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),t.components=[new GeoGlobe.Geometry.MultiLineString(i.components)]},lineStringMember:function(e,t){this.readChildNodes(e,t)},Polygon:function(e,t){var i={outer:null,inner:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),i.inner.unshift(i.outer),t.components||(t.components=[]),t.components.push(new GeoGlobe.Geometry.Polygon(i.inner))},LinearRing:function(e,t){var i={};this.readers.gml._inherit.apply(this,[e,i]),this.readChildNodes(e,i),t.components=[new GeoGlobe.Geometry.LinearRing(i.points)]},MultiPolygon:function(e,t){var i={components:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),t.components=[new GeoGlobe.Geometry.MultiPolygon(i.components)]},polygonMember:function(e,t){this.readChildNodes(e,t)},GeometryCollection:function(e,t){var i={components:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),t.components=[new GeoGlobe.Geometry.Collection(i.components)]},geometryMember:function(e,t){this.readChildNodes(e,t)}},feature:{"*":function(e,t){var i,r=e.localName||e.nodeName.split(":").pop();if(t.features)if(this.singleFeatureType||-1===GeoGlobe.Util.indexOf(this.featureType,r)){if(r===this.featureType)i="_typeName";else if(GeoGlobe.Util.isArray(this.featureType_))for(var o=0;o<this.featureType_.length;o++)if(this.featureType_[o]===r){i="_typeName";break}}else i="_typeName";else 0==e.childNodes.length||1==e.childNodes.length&&3==e.firstChild.nodeType?this.extractAttributes&&(i="_attribute"):i="_geometry";i&&this.readers.feature[i].apply(this,[e,t])},_typeName:function(e,t){var i={components:[],attributes:{}};this.readChildNodes(e,i),i.name&&(i.attributes.name=i.name);var r=new GeoGlobe.Feature(i.components[0],i.attributes);this.singleFeatureType||(r.type=e.nodeName.split(":").pop(),r.namespace=e.namespaceURI);var o=e.getAttribute("fid")||this.getAttributeNS(e,this.namespaces.gml,"id");o&&(r.fid=o),this.internalProjection&&this.externalProjection&&r.geometry&&r.geometry.transform(this.externalProjection,this.internalProjection),i.bounds&&(r.bounds=i.bounds),t.features.push(r)},_geometry:function(e,t){this.geometryName||(this.geometryName=e.nodeName.split(":").pop()),this.readChildNodes(e,t)},_attribute:function(e,t){var i=e.localName||e.nodeName.split(":").pop(),r=this.getChildValue(e);t.attributes[i]=r}},wfs:{FeatureCollection:function(e,t){this.readChildNodes(e,t)}}},write:function(e){var t;t=GeoGlobe.Util.isArray(e)?"featureMembers":"featureMember";var i=this.writeNode("gml:"+t,e);return this.setAttributeNS(i,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),GeoGlobe.Format.XML.prototype.write.apply(this,[i])},writers:{gml:{featureMember:function(e){var t=this.createElementNSPlus("gml:featureMember");return this.writeNode("feature:_typeName",e,t),t},MultiPoint:function(e){for(var t=this.createElementNSPlus("gml:MultiPoint"),i=e.components||[e],r=0,o=i.length;r<o;++r)this.writeNode("pointMember",i[r],t);return t},pointMember:function(e){var t=this.createElementNSPlus("gml:pointMember");return this.writeNode("Point",e,t),t},MultiLineString:function(e){for(var t=this.createElementNSPlus("gml:MultiLineString"),i=e.components||[e],r=0,o=i.length;r<o;++r)this.writeNode("lineStringMember",i[r],t);return t},lineStringMember:function(e){var t=this.createElementNSPlus("gml:lineStringMember");return this.writeNode("LineString",e,t),t},MultiPolygon:function(e){for(var t=this.createElementNSPlus("gml:MultiPolygon"),i=e.components||[e],r=0,o=i.length;r<o;++r)this.writeNode("polygonMember",i[r],t);return t},polygonMember:function(e){var t=this.createElementNSPlus("gml:polygonMember");return this.writeNode("Polygon",e,t),t},GeometryCollection:function(e){for(var t=this.createElementNSPlus("gml:GeometryCollection"),i=0,r=e.components.length;i<r;++i)this.writeNode("geometryMember",e.components[i],t);return t},geometryMember:function(e){var t=this.createElementNSPlus("gml:geometryMember"),i=this.writeNode("feature:_geometry",e);return t.appendChild(i.firstChild),t}},feature:{_typeName:function(e){var t=this.createElementNSPlus("feature:"+this.featureType,{attributes:{fid:e.fid}});for(var i in e.geometry&&this.writeNode("feature:_geometry",e.geometry,t),e.attributes){var r=e.attributes[i];null!=r&&this.writeNode("feature:_attribute",{name:i,value:r},t)}return t},_geometry:function(e){this.externalProjection&&this.internalProjection&&(e=e.clone().transform(this.internalProjection,this.externalProjection));var t=this.createElementNSPlus("feature:"+this.geometryName),i=this.geometryTypes[e.CLASS_NAME],r=this.writeNode("gml:"+i,e,t);return this.srsName&&r.setAttribute("srsName",this.srsName),t},_attribute:function(e){return this.createElementNSPlus("feature:"+e.name,{value:e.value})}},wfs:{FeatureCollection:function(e){for(var t=this.createElementNSPlus("wfs:FeatureCollection"),i=0,r=e.length;i<r;++i)this.writeNode("gml:featureMember",e[i],t);return t}}},setGeometryTypes:function(){this.geometryTypes={"GeoGlobe.Geometry.Point":"Point","GeoGlobe.Geometry.MultiPoint":"MultiPoint","GeoGlobe.Geometry.LineString":"LineString","GeoGlobe.Geometry.MultiLineString":"MultiLineString","GeoGlobe.Geometry.Polygon":"Polygon","GeoGlobe.Geometry.MultiPolygon":"MultiPolygon","GeoGlobe.Geometry.Collection":"GeometryCollection"}},setFeatureType_:function(e){this.featureType_=e},CLASS_NAME:"GeoGlobe.Format.GML.Base"}),GeoGlobe.Format.GML.v2=GeoGlobe.Class4OL(GeoGlobe.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd",initialize:function(e){GeoGlobe.Format.GML.Base.prototype.initialize.apply(this,[e])},readers:{gml:GeoGlobe.Util.applyDefaults({outerBoundaryIs:function(e,t){var i={};this.readChildNodes(e,i),t.outer=i.components[0]},innerBoundaryIs:function(e,t){var i={};this.readChildNodes(e,i),t.inner.push(i.components[0])},Box:function(e,t){var i={};this.readChildNodes(e,i),t.components||(t.components=[]);var r=i.points[0],o=i.points[1],n=new GeoGlobe.LngLat(r.x,r.y),a=new GeoGlobe.LngLat(o.x,o.y);t.components.push(new GeoGlobe.LngLatBounds(n,a))}},GeoGlobe.Format.GML.Base.prototype.readers.gml),feature:GeoGlobe.Format.GML.Base.prototype.readers.feature,wfs:GeoGlobe.Format.GML.Base.prototype.readers.wfs},write:function(e){var t;t=GeoGlobe.Util.isArray(e)?"wfs:FeatureCollection":"gml:featureMember";var i=this.writeNode(t,e);return this.setAttributeNS(i,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),GeoGlobe.Format.XML.prototype.write.apply(this,[i])},writers:{gml:GeoGlobe.Util.applyDefaults({Point:function(e){var t=this.createElementNSPlus("gml:Point");return this.writeNode("coordinates",[e],t),t},coordinates:function(e){for(var t,i=e.length,r=new Array(i),o=0;o<i;++o)t=e[o],this.xy?r[o]=t.x+","+t.y:r[o]=t.y+","+t.x,null!=t.z&&(r[o]+=","+t.z);return this.createElementNSPlus("gml:coordinates",{attributes:{decimal:".",cs:",",ts:" "},value:1==i?r[0]:r.join(" ")})},LineString:function(e){var t=this.createElementNSPlus("gml:LineString");return this.writeNode("coordinates",e.components,t),t},Polygon:function(e){var t=this.createElementNSPlus("gml:Polygon");this.writeNode("outerBoundaryIs",e.components[0],t);for(var i=1;i<e.components.length;++i)this.writeNode("innerBoundaryIs",e.components[i],t);return t},outerBoundaryIs:function(e){var t=this.createElementNSPlus("gml:outerBoundaryIs");return this.writeNode("LinearRing",e,t),t},innerBoundaryIs:function(e){var t=this.createElementNSPlus("gml:innerBoundaryIs");return this.writeNode("LinearRing",e,t),t},LinearRing:function(e){var t=this.createElementNSPlus("gml:LinearRing");return this.writeNode("coordinates",e.components,t),t},Box:function(e){var t=this.createElementNSPlus("gml:Box");return this.writeNode("coordinates",[{x:e._sw.lng,y:e._sw.lat},{x:e._ne.lng,y:e._ne.lat}],t),this.srsName&&t.setAttribute("srsName",this.srsName),t}},GeoGlobe.Format.GML.Base.prototype.writers.gml),feature:GeoGlobe.Format.GML.Base.prototype.writers.feature,wfs:GeoGlobe.Format.GML.Base.prototype.writers.wfs},CLASS_NAME:"GeoGlobe.Format.GML.v2"}),GeoGlobe.Format.GML.v3=GeoGlobe.Class4OL(GeoGlobe.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",curve:!1,multiCurve:!0,surface:!1,multiSurface:!0,initialize:function(e){GeoGlobe.Format.GML.Base.prototype.initialize.apply(this,[e])},readers:{gml:GeoGlobe.Util.applyDefaults({_inherit:function(e,t,i){var r=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(e.getAttribute("srsDimension"),10)||i&&i.srsDimension;r&&(t.srsDimension=r)},featureMembers:function(e,t){this.readChildNodes(e,t)},Curve:function(e,t){var i={points:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),t.components||(t.components=[]),t.components.push(new GeoGlobe.Geometry.LineString(i.points))},segments:function(e,t){this.readChildNodes(e,t)},LineStringSegment:function(e,t){var i={};this.readChildNodes(e,i),i.points&&Array.prototype.push.apply(t.points,i.points)},pos:function(e,t){var i,r=this.getChildValue(e).replace(this.regExes.trimSpace,"").split(this.regExes.splitSpace);i=this.xy?new GeoGlobe.Geometry.Point(r[0],r[1],r[2]):new GeoGlobe.Geometry.Point(r[1],r[0],r[2]),t.points=[i]},posList:function(e,t){for(var i,r,o,n=this.getChildValue(e).replace(this.regExes.trimSpace,"").split(this.regExes.splitSpace),a=t.srsDimension||_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(e.getAttribute("srsDimension")||e.getAttribute("dimension"),10)||2,s=n.length/a,l=new Array(s),u=0,h=n.length;u<h;u+=a)i=n[u],r=n[u+1],o=2==a?void 0:n[u+2],this.xy?l[u/a]=new GeoGlobe.Geometry.Point(i,r,o):l[u/a]=new GeoGlobe.Geometry.Point(r,i,o);t.points=l},Surface:function(e,t){this.readChildNodes(e,t)},patches:function(e,t){this.readChildNodes(e,t)},PolygonPatch:function(e,t){this.readers.gml.Polygon.apply(this,[e,t])},exterior:function(e,t){var i={};this.readChildNodes(e,i),t.outer=i.components[0]},interior:function(e,t){var i={};this.readChildNodes(e,i),t.inner.push(i.components[0])},MultiCurve:function(e,t){var i={components:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),0<i.components.length&&(t.components=[new GeoGlobe.Geometry.MultiLineString(i.components)])},curveMember:function(e,t){this.readChildNodes(e,t)},MultiSurface:function(e,t){var i={components:[]};this.readers.gml._inherit.apply(this,[e,i,t]),this.readChildNodes(e,i),0<i.components.length&&(t.components=[new GeoGlobe.Geometry.MultiPolygon(i.components)])},surfaceMember:function(e,t){this.readChildNodes(e,t)},surfaceMembers:function(e,t){this.readChildNodes(e,t)},pointMembers:function(e,t){this.readChildNodes(e,t)},lineStringMembers:function(e,t){this.readChildNodes(e,t)},polygonMembers:function(e,t){this.readChildNodes(e,t)},geometryMembers:function(e,t){this.readChildNodes(e,t)},Envelope:function(e,t){var i={points:new Array(2)};this.readChildNodes(e,i),t.components||(t.components=[]);var r=i.points[0],o=i.points[1],n=new GeoGlobe.LngLat(r.x,r.y),a=new GeoGlobe.LngLat(o.x,o.y);t.components.push(new GeoGlobe.LngLatBounds(n,a))},lowerCorner:function(e,t){var i={};this.readers.gml.pos.apply(this,[e,i]),t.points[0]=i.points[0]},upperCorner:function(e,t){var i={};this.readers.gml.pos.apply(this,[e,i]),t.points[1]=i.points[0]}},GeoGlobe.Format.GML.Base.prototype.readers.gml),feature:GeoGlobe.Format.GML.Base.prototype.readers.feature,wfs:GeoGlobe.Format.GML.Base.prototype.readers.wfs},write:function(e){var t;t=GeoGlobe.Util.isArray(e)?"featureMembers":"featureMember";var i=this.writeNode("gml:"+t,e);return this.setAttributeNS(i,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),GeoGlobe.Format.XML.prototype.write.apply(this,[i])},writers:{gml:GeoGlobe.Util.applyDefaults({featureMembers:function(e){for(var t=this.createElementNSPlus("gml:featureMembers"),i=0,r=e.length;i<r;++i)this.writeNode("feature:_typeName",e[i],t);return t},Point:function(e){var t=this.createElementNSPlus("gml:Point");return this.writeNode("pos",e,t),t},pos:function(e){var t=this.xy?e.x+" "+e.y:e.y+" "+e.x;return this.createElementNSPlus("gml:pos",{value:t})},LineString:function(e){var t=this.createElementNSPlus("gml:LineString");return this.writeNode("posList",e.components,t),t},Curve:function(e){var t=this.createElementNSPlus("gml:Curve");return this.writeNode("segments",e,t),t},segments:function(e){var t=this.createElementNSPlus("gml:segments");return this.writeNode("LineStringSegment",e,t),t},LineStringSegment:function(e){var t=this.createElementNSPlus("gml:LineStringSegment");return this.writeNode("posList",e.components,t),t},posList:function(e){for(var t,i=e.length,r=new Array(i),o=0;o<i;++o)t=e[o],this.xy?r[o]=t.x+" "+t.y:r[o]=t.y+" "+t.x;return this.createElementNSPlus("gml:posList",{value:r.join(" ")})},Surface:function(e){var t=this.createElementNSPlus("gml:Surface");return this.writeNode("patches",e,t),t},patches:function(e){var t=this.createElementNSPlus("gml:patches");return this.writeNode("PolygonPatch",e,t),t},PolygonPatch:function(e){var t=this.createElementNSPlus("gml:PolygonPatch",{attributes:{interpolation:"planar"}});this.writeNode("exterior",e.components[0],t);for(var i=1,r=e.components.length;i<r;++i)this.writeNode("interior",e.components[i],t);return t},Polygon:function(e){var t=this.createElementNSPlus("gml:Polygon");this.writeNode("exterior",e.components[0],t);for(var i=1,r=e.components.length;i<r;++i)this.writeNode("interior",e.components[i],t);return t},exterior:function(e){var t=this.createElementNSPlus("gml:exterior");return this.writeNode("LinearRing",e,t),t},interior:function(e){var t=this.createElementNSPlus("gml:interior");return this.writeNode("LinearRing",e,t),t},LinearRing:function(e){var t=this.createElementNSPlus("gml:LinearRing");return this.writeNode("posList",e.components,t),t},MultiCurve:function(e){for(var t=this.createElementNSPlus("gml:MultiCurve"),i=e.components||[e],r=0,o=i.length;r<o;++r)this.writeNode("curveMember",i[r],t);return t},curveMember:function(e){var t=this.createElementNSPlus("gml:curveMember");return this.curve?this.writeNode("Curve",e,t):this.writeNode("LineString",e,t),t},MultiSurface:function(e){for(var t=this.createElementNSPlus("gml:MultiSurface"),i=e.components||[e],r=0,o=i.length;r<o;++r)this.writeNode("surfaceMember",i[r],t);return t},surfaceMember:function(e){var t=this.createElementNSPlus("gml:surfaceMember");return this.surface?this.writeNode("Surface",e,t):this.writeNode("Polygon",e,t),t},Envelope:function(e){var t=this.createElementNSPlus("gml:Envelope");return this.writeNode("lowerCorner",e,t),this.writeNode("upperCorner",e,t),this.srsName&&t.setAttribute("srsName",this.srsName),t},lowerCorner:function(e){var t=this.xy?e._sw.lng+" "+e._sw.lat:e._sw.lat+" "+e._sw.lng;return this.createElementNSPlus("gml:lowerCorner",{value:t})},upperCorner:function(e){var t=this.xy?e._ne.lng+" "+e._ne.lat:e._ne.lat+" "+e._ne.lng;return this.createElementNSPlus("gml:upperCorner",{value:t})}},GeoGlobe.Format.GML.Base.prototype.writers.gml),feature:GeoGlobe.Format.GML.Base.prototype.writers.feature,wfs:GeoGlobe.Format.GML.Base.prototype.writers.wfs},setGeometryTypes:function(){this.geometryTypes={"GeoGlobe.Geometry.Point":"Point","GeoGlobe.Geometry.MultiPoint":"MultiPoint","GeoGlobe.Geometry.LineString":!0===this.curve?"Curve":"LineString","GeoGlobe.Geometry.MultiLineString":!1===this.multiCurve?"MultiLineString":"MultiCurve","GeoGlobe.Geometry.Polygon":!0===this.surface?"Surface":"Polygon","GeoGlobe.Geometry.MultiPolygon":!1===this.multiSurface?"MultiPolygon":"MultiSurface","GeoGlobe.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"GeoGlobe.Format.GML.v3"});var _typeof="function"==typeof _babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14___default.a&&"symbol"==_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_13___default()(_babel_runtime_corejs2_core_js_symbol_iterator__WEBPACK_IMPORTED_MODULE_12___default.a)?function(e){return _babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_13___default()(e)}:function(e){return e&&"function"==typeof _babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14___default.a&&e.constructor===_babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14___default.a&&e!==_babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14___default.a.prototype?"symbol":_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_13___default()(e)};GeoGlobe.Format.KML=GeoGlobe.Class4OL(GeoGlobe.Format.XML,{namespaces:{kml:"http://www.opengis.net/kml/2.2",gx:"http://www.google.com/kml/ext/2.2"},kmlns:"http://earth.google.com/kml/2.0",placemarksDesc:"No description available",foldersName:"GeoGlobe export",foldersDesc:"Exported on "+new Date,extractAttributes:!0,kvpAttributes:!1,extractStyles:!1,extractTracks:!1,trackAttributes:null,internalns:null,features:null,styles:null,styleBaseUrl:"",fetched:null,maxDepth:0,initialize:function(e){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,kmlColor:/(\w{2})(\w{2})(\w{2})(\w{2})/,kmlIconPalette:/root:\/\/icons\/palette-(\d+)(\.\w+)/,straightBracket:/\$\[(.*?)\]/g},this.externalProjection=new GeoGlobe.SpatialReference("EPSG:4326"),GeoGlobe.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){this.features=[],this.styles={},this.fetched={};var t={depth:0,styleBaseUrl:this.styleBaseUrl};return this.parseData(e,t)},parseData:function(e,t){"string"==typeof e&&(e=GeoGlobe.Format.XML.prototype.read.apply(this,[e]));for(var i=["Link","NetworkLink","Style","StyleMap","Placemark"],r=0,o=i.length;r<o;++r){var n=i[r],a=this.getElementsByTagNameNS(e,"*",n);if(0!=a.length)switch(n.toLowerCase()){case"link":case"networklink":this.parseLinks(a,t);break;case"style":this.extractStyles&&this.parseStyles(a,t);break;case"stylemap":this.extractStyles&&this.parseStyleMaps(a,t);break;case"placemark":this.parseFeatures(a,t)}}return this.features},parseLinks:function(e,t){if(t.depth>=this.maxDepth)return!1;var i=GeoGlobe.Util.extend({},t);i.depth++;for(var r=0,o=e.length;r<o;r++){var n=this.parseProperty(e[r],"*","href");if(n&&!this.fetched[n]){this.fetched[n]=!0;var a=this.fetchLink(n);a&&this.parseData(a,i)}}},fetchLink:function(e){var t=GeoGlobe.Request.GET({url:e,async:!1});if(t)return t.responseText},parseStyles:function(e,t){for(var i=0,r=e.length;i<r;i++){var o=this.parseStyle(e[i]);if(o){var n=(t.styleBaseUrl||"")+"#"+o.id;this.styles[n]=o}}},parseKmlColor:function(e){var t=null;if(e){var i=e.match(this.regExes.kmlColor);i&&(t={color:"#"+i[4]+i[3]+i[2],opacity:_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(i[1],16)/255})}return t},parseStyle:function(e){for(var t,i,r={},o=["LineStyle","PolyStyle","IconStyle","BalloonStyle","LabelStyle"],n=0,a=o.length;n<a;++n)if(t=o[n],i=this.getElementsByTagNameNS(e,"*",t)[0])switch(t.toLowerCase()){case"linestyle":var s=this.parseProperty(i,"*","color");(w=this.parseKmlColor(s))&&(r.strokeColor=w.color,r.strokeOpacity=w.opacity),(u=this.parseProperty(i,"*","width"))&&(r.strokeWidth=u);break;case"polystyle":s=this.parseProperty(i,"*","color"),(w=this.parseKmlColor(s))&&(r.fillOpacity=w.opacity,r.fillColor=w.color),"0"==this.parseProperty(i,"*","fill")&&(r.fillColor="none"),"0"==this.parseProperty(i,"*","outline")&&(r.strokeWidth="0");break;case"iconstyle":var l=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(this.parseProperty(i,"*","scale")||1),u=32*l,h=32*l,c=this.getElementsByTagNameNS(i,"*","Icon")[0];if(c){var p=this.parseProperty(c,"*","href");if(p){var d=this.parseProperty(c,"*","w"),f=this.parseProperty(c,"*","h");!GeoGlobe.String.startsWith(p,"http://maps.google.com/mapfiles/kml")||d||f||(f=d=64,l/=2),d=d||f,f=f||d,d&&(u=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(d)*l),f&&(h=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(f)*l);var g=p.match(this.regExes.kmlIconPalette);if(g){var m=g[1],_=g[2],v=this.parseProperty(c,"*","x");p="http://maps.google.com/mapfiles/kml/pal"+m+"/icon"+(8*((y=this.parseProperty(c,"*","y"))?7-y/32:7)+(v?v/32:0))+_}r.graphicOpacity=1,r.externalGraphic=p}}var C=this.getElementsByTagNameNS(i,"*","hotSpot")[0];if(C){v=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(C.getAttribute("x"));var y=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(C.getAttribute("y")),A=C.getAttribute("xunits");"pixels"==A?r.graphicXOffset=-v*l:"insetPixels"==A?r.graphicXOffset=v*l-u:"fraction"==A&&(r.graphicXOffset=-u*v);var I=C.getAttribute("yunits");"pixels"==I?r.graphicYOffset=y*l-h+1:"insetPixels"==I?r.graphicYOffset=-y*l+1:"fraction"==I&&(r.graphicYOffset=-h*(1-y)+1)}r.graphicWidth=u,r.graphicHeight=h;break;case"balloonstyle":var b=GeoGlobe.Util.getXmlNodeValue(i);b&&(r.balloonStyle=b.replace(this.regExes.straightBracket,"${$1}"));break;case"labelstyle":var w;s=this.parseProperty(i,"*","color"),(w=this.parseKmlColor(s))&&(r.fontColor=w.color,r.fontOpacity=w.opacity)}!r.strokeColor&&r.fillColor&&(r.strokeColor=r.fillColor);var E=e.getAttribute("id");return E&&r&&(r.id=E),r},parseStyleMaps:function(e,t){for(var i=0,r=e.length;i<r;i++)for(var o=e[i],n=this.getElementsByTagNameNS(o,"*","Pair"),a=o.getAttribute("id"),s=0,l=n.length;s<l;s++){var u=n[s],h=this.parseProperty(u,"*","key"),c=this.parseProperty(u,"*","styleUrl");c&&"normal"==h&&(this.styles[(t.styleBaseUrl||"")+"#"+a]=this.styles[(t.styleBaseUrl||"")+c])}},parseFeatures:function(e,t){for(var i=[],r=0,o=e.length;r<o;r++){var n=e[r],a=this.parseFeature.apply(this,[n]);if(!a)throw"Bad Placemark: "+r;if(this.extractStyles&&a.attributes&&a.attributes.styleUrl&&(a.style=this.getStyle(a.attributes.styleUrl,t)),this.extractStyles){var s=this.getElementsByTagNameNS(n,"*","Style")[0];if(s){var l=this.parseStyle(s);l&&(a.style=GeoGlobe.Util.extend(a.style,l))}}if(this.extractTracks){var u=this.getElementsByTagNameNS(n,this.namespaces.gx,"Track");if(u&&0<u.length){var h=u[0],c={features:[],feature:a};this.readNode(h,c),0<c.features.length&&i.push.apply(i,c.features)}}else i.push(a)}this.features=this.features.concat(i)},readers:{kml:{when:function(e,t){t.whens.push(GeoGlobe.Date.parse(this.getChildValue(e)))},_trackPointAttribute:function(e,t){var i=e.nodeName.split(":").pop();t.attributes[i].push(this.getChildValue(e))}},gx:{Track:function(e,t){var i={whens:[],points:[],angles:[]};if(this.trackAttributes){i.attributes={};for(var r=0,o=this.trackAttributes.length;r<o;++r)c=this.trackAttributes[r],i.attributes[c]=[],c in this.readers.kml||(this.readers.kml[c]=this.readers.kml._trackPointAttribute)}if(this.readChildNodes(e,i),i.whens.length!==i.points.length)throw new Error("gx:Track with unequal number of when ("+i.whens.length+") and gx:coord ("+i.points.length+") elements.");var n,a,s,l=0<i.angles.length;if(l&&i.whens.length!==i.angles.length)throw new Error("gx:Track with unequal number of when ("+i.whens.length+") and gx:angles ("+i.angles.length+") elements.");for(r=0,o=i.whens.length;r<o;++r){if((n=t.feature.clone()).fid=t.feature.fid||t.feature.id,a=i.points[r],"z"in(n.geometry=a)&&(n.attributes.altitude=a.z),this.internalProjection&&this.externalProjection&&n.geometry.transform(this.externalProjection,this.internalProjection),this.trackAttributes)for(var u=0,h=this.trackAttributes.length;u<h;++u){var c=this.trackAttributes[u];n.attributes[c]=i.attributes[c][r]}n.attributes.when=i.whens[r],n.attributes.trackId=t.feature.id,l&&(s=i.angles[r],n.attributes.heading=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(s[0]),n.attributes.tilt=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(s[1]),n.attributes.roll=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(s[2])),t.features.push(n)}},coord:function(e,t){var i=this.getChildValue(e).replace(this.regExes.trimSpace,"").split(/\s+/),r=new GeoGlobe.Geometry.Point(i[0],i[1]);2<i.length&&(r.z=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(i[2])),t.points.push(r)},angles:function(e,t){var i=this.getChildValue(e).replace(this.regExes.trimSpace,"").split(/\s+/);t.angles.push(i)}}},parseFeature:function(e){for(var t,i,r,o,n=["MultiGeometry","Polygon","LineString","Point"],a=0,s=n.length;a<s;++a)if(t=n[a],this.internalns=e.namespaceURI?e.namespaceURI:this.kmlns,0<(i=this.getElementsByTagNameNS(e,this.internalns,t)).length){var l;if(!(l=this.parseGeometry[t.toLowerCase()]))throw new TypeError("Unsupported geometry type: "+t);r=l.apply(this,[i[0]]),this.internalProjection&&this.externalProjection&&r.transform(this.externalProjection,this.internalProjection);break}this.extractAttributes&&(o=this.parseAttributes(e));var u=new GeoGlobe.Feature(r,o),h=e.getAttribute("id")||e.getAttribute("name");return null!=h&&(u.fid=h),u},getStyle:function(e,t){var i=GeoGlobe.Util.removeTail(e),r=GeoGlobe.Util.extend({},t);if(r.depth++,r.styleBaseUrl=i,!this.styles[e]&&!GeoGlobe.String.startsWith(e,"#")&&r.depth<=this.maxDepth&&!this.fetched[i]){var o=this.fetchLink(i);o&&this.parseData(o,r)}return GeoGlobe.Util.extend({},this.styles[e])},parseGeometry:{point:function(e){var t=this.getElementsByTagNameNS(e,this.internalns,"coordinates"),i=[];if(0<t.length){var r=t[0].firstChild.nodeValue;i=(r=r.replace(this.regExes.removeSpace,"")).split(",")}if(!(1<i.length))throw"Bad coordinate string: "+r;return 2==i.length&&(i[2]=null),new GeoGlobe.Geometry.Point(i[0],i[1],i[2])},linestring:function(e,t){var i=this.getElementsByTagNameNS(e,this.internalns,"coordinates"),r=null;if(0<i.length){for(var o,n=this.getChildValue(i[0]),a=(n=(n=n.replace(this.regExes.trimSpace,"")).replace(this.regExes.trimComma,",")).split(this.regExes.splitSpace),s=a.length,l=new Array(s),u=0;u<s;++u){if(!(1<(o=a[u].split(",")).length))throw"Bad LineString point coordinates: "+a[u];2==o.length&&(o[2]=null),l[u]=new GeoGlobe.Geometry.Point(o[0],o[1],o[2])}if(!s)throw"Bad LineString coordinates: "+n;r=t?new GeoGlobe.Geometry.LinearRing(l):new GeoGlobe.Geometry.LineString(l)}return r},polygon:function(e){var t=this.getElementsByTagNameNS(e,this.internalns,"LinearRing"),i=t.length,r=new Array(i);if(0<i)for(var o,n=0,a=t.length;n<a;++n){if(!(o=this.parseGeometry.linestring.apply(this,[t[n],!0])))throw"Bad LinearRing geometry: "+n;r[n]=o}return new GeoGlobe.Geometry.Polygon(r)},multigeometry:function(e){for(var t,i=[],r=e.childNodes,o=0,n=r.length;o<n;++o)if(1==(t=r[o]).nodeType){var a,s=t.prefix?t.nodeName.split(":")[1]:t.nodeName;(a=this.parseGeometry[s.toLowerCase()])&&i.push(a.apply(this,[t]))}return new GeoGlobe.Geometry.Collection(i)}},parseAttributes:function(e){var t,i,r={},o=e.getElementsByTagName("ExtendedData");o.length&&(r=this.parseExtendedData(o[0]));for(var n=e.childNodes,a=0,s=n.length;a<s;++a)if(1==(t=n[a]).nodeType&&1<=(i=t.childNodes).length&&i.length<=3){var l;switch(i.length){case 1:l=i[0];break;case 2:var u=i[0],h=i[1];l=3==u.nodeType||4==u.nodeType?u:h;break;case 3:default:l=i[1]}if(3==l.nodeType||4==l.nodeType){var c=t.prefix?t.nodeName.split(":")[1]:t.nodeName,p=GeoGlobe.Util.getXmlNodeValue(l);p&&(p=p.replace(this.regExes.trimSpace,""),r[c]=p)}}return r},parseExtendedData:function(e){var t,i,r,o,n={},a=e.getElementsByTagName("Data");for(t=0,i=a.length;t<i;t++){o=(r=a[t]).getAttribute("name");var s={},l=r.getElementsByTagName("value");if(l.length&&(s.value=this.getChildValue(l[0])),this.kvpAttributes)n[o]=s.value;else{var u=r.getElementsByTagName("displayName");u.length&&(s.displayName=this.getChildValue(u[0])),n[o]=s}}var h=e.getElementsByTagName("SimpleData");for(t=0,i=h.length;t<i;t++)s={},o=(r=h[t]).getAttribute("name"),s.value=this.getChildValue(r),this.kvpAttributes?n[o]=s.value:n[s.displayName=o]=s;return n},parseProperty:function(e,t,i){var r,o=this.getElementsByTagNameNS(e,t,i);try{r=GeoGlobe.Util.getXmlNodeValue(o[0])}catch(e){r=null}return r},write:function(e){GeoGlobe.Util.isArray(e)||(e=[e]);for(var t=this.createElementNS(this.kmlns,"kml"),i=this.createFolderXML(),r=0,o=e.length;r<o;++r)i.appendChild(this.createPlacemarkXML(e[r]));return t.appendChild(i),GeoGlobe.Format.XML.prototype.write.apply(this,[t])},createFolderXML:function(){var e=this.createElementNS(this.kmlns,"Folder");if(this.foldersName){var t=this.createElementNS(this.kmlns,"name"),i=this.createTextNode(this.foldersName);t.appendChild(i),e.appendChild(t)}if(this.foldersDesc){var r=this.createElementNS(this.kmlns,"description"),o=this.createTextNode(this.foldersDesc);r.appendChild(o),e.appendChild(r)}return e},createPlacemarkXML:function(e){var t=this.createElementNS(this.kmlns,"name"),i=e.style&&e.style.label?e.style.label:e.id,r=e.attributes.name||i;t.appendChild(this.createTextNode(r));var o=this.createElementNS(this.kmlns,"description"),n=e.attributes.description||this.placemarksDesc;o.appendChild(this.createTextNode(n));var a=this.createElementNS(this.kmlns,"Placemark");null!=e.fid&&a.setAttribute("id",e.fid),a.appendChild(t),a.appendChild(o);var s=this.buildGeometryNode(e.geometry);if(a.appendChild(s),e.attributes){var l=this.buildExtendedData(e.attributes);l&&a.appendChild(l)}return a},buildGeometryNode:function(e){var t=e.CLASS_NAME,i=t.substring(t.lastIndexOf(".")+1),r=this.buildGeometry[i.toLowerCase()],o=null;return r&&(o=r.apply(this,[e])),o},buildGeometry:{point:function(e){var t=this.createElementNS(this.kmlns,"Point");return t.appendChild(this.buildCoordinatesNode(e)),t},multipoint:function(e){return this.buildGeometry.collection.apply(this,[e])},linestring:function(e){var t=this.createElementNS(this.kmlns,"LineString");return t.appendChild(this.buildCoordinatesNode(e)),t},multilinestring:function(e){return this.buildGeometry.collection.apply(this,[e])},linearring:function(e){var t=this.createElementNS(this.kmlns,"LinearRing");return t.appendChild(this.buildCoordinatesNode(e)),t},polygon:function(e){for(var t,i,r,o=this.createElementNS(this.kmlns,"Polygon"),n=e.components,a=0,s=n.length;a<s;++a)r=0==a?"outerBoundaryIs":"innerBoundaryIs",t=this.createElementNS(this.kmlns,r),i=this.buildGeometry.linearring.apply(this,[n[a]]),t.appendChild(i),o.appendChild(t);return o},multipolygon:function(e){return this.buildGeometry.collection.apply(this,[e])},collection:function(e){for(var t,i=this.createElementNS(this.kmlns,"MultiGeometry"),r=0,o=e.components.length;r<o;++r)(t=this.buildGeometryNode.apply(this,[e.components[r]]))&&i.appendChild(t);return i}},buildCoordinatesNode:function(e){var t,i=this.createElementNS(this.kmlns,"coordinates"),r=e.components;if(r){for(var o,n=r.length,a=new Array(n),s=0;s<n;++s)o=r[s],a[s]=this.buildCoordinates(o);t=a.join(" ")}else t=this.buildCoordinates(e);var l=this.createTextNode(t);return i.appendChild(l),i},buildCoordinates:function(e){return this.internalProjection&&this.externalProjection&&(e=e.clone()).transform(this.internalProjection,this.externalProjection),e.x+","+e.y},buildExtendedData:function(e){var t=this.createElementNS(this.kmlns,"ExtendedData");for(var i in e)if(e[i]&&"name"!=i&&"description"!=i&&"styleUrl"!=i){var r=this.createElementNS(this.kmlns,"Data");r.setAttribute("name",i);var o=this.createElementNS(this.kmlns,"value");if("object"==_typeof(e[i])){if(e[i].value&&o.appendChild(this.createTextNode(e[i].value)),e[i].displayName){var n=this.createElementNS(this.kmlns,"displayName");n.appendChild(this.getXMLDoc().createCDATASection(e[i].displayName)),r.appendChild(n)}}else o.appendChild(this.createTextNode(e[i]));r.appendChild(o),t.appendChild(r)}return this.isSimpleContent(t)?null:t},CLASS_NAME:"GeoGlobe.Format.KML"}),GeoGlobe.Format.OWSCommon=GeoGlobe.Class4OL(GeoGlobe.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",getVersion:function(e){var t=this.version;if(!t){var i=e.getAttribute("xmlns:ows");i&&"1.1"===i.substring(i.lastIndexOf("/")+1)&&(t="1.1.0"),t=t||this.defaultVersion}return t},CLASS_NAME:"GeoGlobe.Format.OWSCommon"}),GeoGlobe.Format.OWSCommon.v1=GeoGlobe.Class4OL(GeoGlobe.Format.XML,{regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(e,t){t=GeoGlobe.Util.applyDefaults(t,this.options);var i={};return this.readChildNodes(e,i),i},readers:{ows:{Exception:function(e,t){var i={code:e.getAttribute("exceptionCode"),locator:e.getAttribute("locator"),texts:[]};t.exceptions.push(i),this.readChildNodes(e,i)},ExceptionText:function(e,t){var i=this.getChildValue(e);t.texts.push(i)},ServiceIdentification:function(e,t){t.serviceIdentification={},this.readChildNodes(e,t.serviceIdentification)},Title:function(e,t){t.title=this.getChildValue(e)},Abstract:function(e,t){t.abstract=this.getChildValue(e)},Keywords:function(e,t){t.keywords={},this.readChildNodes(e,t.keywords)},Keyword:function(e,t){t[this.getChildValue(e)]=!0},ServiceType:function(e,t){t.serviceType={codeSpace:e.getAttribute("codeSpace"),value:this.getChildValue(e)}},ServiceTypeVersion:function(e,t){t.serviceTypeVersion=this.getChildValue(e)},Fees:function(e,t){t.fees=this.getChildValue(e)},AccessConstraints:function(e,t){t.accessConstraints=this.getChildValue(e)},ServiceProvider:function(e,t){t.serviceProvider={},this.readChildNodes(e,t.serviceProvider)},ProviderName:function(e,t){t.providerName=this.getChildValue(e)},ProviderSite:function(e,t){t.providerSite=this.getAttributeNS(e,this.namespaces.xlink,"href")},ServiceContact:function(e,t){t.serviceContact={},this.readChildNodes(e,t.serviceContact)},IndividualName:function(e,t){t.individualName=this.getChildValue(e)},PositionName:function(e,t){t.positionName=this.getChildValue(e)},ContactInfo:function(e,t){t.contactInfo={},this.readChildNodes(e,t.contactInfo)},Phone:function(e,t){t.phone={},this.readChildNodes(e,t.phone)},Voice:function(e,t){t.voice=this.getChildValue(e)},Address:function(e,t){t.address={},this.readChildNodes(e,t.address)},DeliveryPoint:function(e,t){t.deliveryPoint=this.getChildValue(e)},City:function(e,t){t.city=this.getChildValue(e)},AdministrativeArea:function(e,t){t.administrativeArea=this.getChildValue(e)},PostalCode:function(e,t){t.postalCode=this.getChildValue(e)},Country:function(e,t){t.country=this.getChildValue(e)},ElectronicMailAddress:function(e,t){t.electronicMailAddress=this.getChildValue(e)},Role:function(e,t){t.role=this.getChildValue(e)},OperationsMetadata:function(e,t){t.operationsMetadata={},this.readChildNodes(e,t.operationsMetadata)},Operation:function(e,t){var i=e.getAttribute("name");t[i]={},this.readChildNodes(e,t[i])},DCP:function(e,t){t.dcp={},this.readChildNodes(e,t.dcp)},HTTP:function(e,t){t.http={},this.readChildNodes(e,t.http)},Get:function(e,t){t.get||(t.get=[]);var i={url:this.getAttributeNS(e,this.namespaces.xlink,"href")};this.readChildNodes(e,i),t.get.push(i)},Post:function(e,t){t.post||(t.post=[]);var i={url:this.getAttributeNS(e,this.namespaces.xlink,"href")};this.readChildNodes(e,i),t.post.push(i)},Parameter:function(e,t){t.parameters||(t.parameters={});var i=e.getAttribute("name");t.parameters[i]={},this.readChildNodes(e,t.parameters[i])},Constraint:function(e,t){t.constraints||(t.constraints={});var i=e.getAttribute("name");t.constraints[i]={},this.readChildNodes(e,t.constraints[i])},Value:function(e,t){t[this.getChildValue(e)]=!0},OutputFormat:function(e,t){t.formats.push({value:this.getChildValue(e)}),this.readChildNodes(e,t)},WGS84BoundingBox:function(e,t){var i={};i.crs=e.getAttribute("crs"),t.BoundingBox?t.BoundingBox.push(i):(t.projection=i.crs,i=t),this.readChildNodes(e,i)},BoundingBox:function(e,t){this.readers.ows.WGS84BoundingBox.apply(this,[e,t])},LowerCorner:function(e,t){var i=this.getChildValue(e).replace(this.regExes.trimSpace,""),r=(i=i.replace(this.regExes.trimComma,",")).split(this.regExes.splitSpace);t.left=r[0],t.bottom=r[1]},UpperCorner:function(e,t){var i=this.getChildValue(e).replace(this.regExes.trimSpace,""),r=(i=i.replace(this.regExes.trimComma,",")).split(this.regExes.splitSpace);t.right=r[0],t.top=r[1],t.bounds=new GeoGlobe.LngLatBounds(new GeoGlobe.LngLat(t.left,t.bottom),new GeoGlobe.LngLat(t.right,t.top)),delete t.left,delete t.bottom,delete t.right,delete t.top},Language:function(e,t){t.language=this.getChildValue(e)}}},writers:{ows:{BoundingBox:function(e,t){var i=this.createElementNSPlus(t||"ows:BoundingBox",{attributes:{crs:e.projection}});return this.writeNode("ows:LowerCorner",e,i),this.writeNode("ows:UpperCorner",e,i),i},LowerCorner:function(e){return this.createElementNSPlus("ows:LowerCorner",{value:e.bounds._sw.lng+" "+e.bounds._sw.lat})},UpperCorner:function(e){return this.createElementNSPlus("ows:UpperCorner",{value:e.bounds._ne.lng+" "+e.bounds._ne.lat})},Identifier:function(e){return this.createElementNSPlus("ows:Identifier",{value:e})},Title:function(e){return this.createElementNSPlus("ows:Title",{value:e})},Abstract:function(e){return this.createElementNSPlus("ows:Abstract",{value:e})},OutputFormat:function(e){return this.createElementNSPlus("ows:OutputFormat",{value:e})}}},CLASS_NAME:"GeoGlobe.Format.OWSCommon.v1"}),GeoGlobe.Format.OWSCommon.v1_0_0=GeoGlobe.Class4OL(GeoGlobe.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:GeoGlobe.Util.applyDefaults({ExceptionReport:function(e,t){t.success=!1,t.exceptionReport={version:e.getAttribute("version"),language:e.getAttribute("language"),exceptions:[]},this.readChildNodes(e,t.exceptionReport)}},GeoGlobe.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:GeoGlobe.Format.OWSCommon.v1.prototype.writers.ows},CLASS_NAME:"GeoGlobe.Format.OWSCommon.v1_0_0"}),GeoGlobe.Format.OWSCommon.v1_1_0=GeoGlobe.Class4OL(GeoGlobe.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows/1.1",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:GeoGlobe.Util.applyDefaults({ExceptionReport:function(e,t){t.exceptionReport={version:e.getAttribute("version"),language:e.getAttribute("xml:lang"),exceptions:[]},this.readChildNodes(e,t.exceptionReport)},AllowedValues:function(e,t){t.allowedValues={},this.readChildNodes(e,t.allowedValues)},AnyValue:function(e,t){t.anyValue=!0},DataType:function(e,t){t.dataType=this.getChildValue(e)},Range:function(e,t){t.range={},this.readChildNodes(e,t.range)},MinimumValue:function(e,t){t.minValue=this.getChildValue(e)},MaximumValue:function(e,t){t.maxValue=this.getChildValue(e)},Identifier:function(e,t){t.identifier=this.getChildValue(e)},SupportedCRS:function(e,t){t.supportedCRS=this.getChildValue(e)}},GeoGlobe.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:GeoGlobe.Util.applyDefaults({Range:function(e){var t=this.createElementNSPlus("ows:Range",{attributes:{"ows:rangeClosure":e.closure}});return this.writeNode("ows:MinimumValue",e.minValue,t),this.writeNode("ows:MaximumValue",e.maxValue,t),t},MinimumValue:function(e){return this.createElementNSPlus("ows:MinimumValue",{value:e})},MaximumValue:function(e){return this.createElementNSPlus("ows:MaximumValue",{value:e})},Value:function(e){return this.createElementNSPlus("ows:Value",{value:e})}},GeoGlobe.Format.OWSCommon.v1.prototype.writers.ows)},CLASS_NAME:"GeoGlobe.Format.OWSCommon.v1_1_0"}),GeoGlobe.Format.WFSCapabilities=GeoGlobe.Class4OL(GeoGlobe.Format.XML.VersionedOGC,{defaultVersion:"1.1.0",CLASS_NAME:"GeoGlobe.Format.WFSCapabilities"}),GeoGlobe.Format.WFSCapabilities.v1=GeoGlobe.Class4OL(GeoGlobe.Format.XML,{namespaces:{wfs:"http://www.opengis.net/wfs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",ows:"http://www.opengis.net/ows"},errorProperty:"featureTypeList",defaultPrefix:"wfs",read:function(e){"string"==typeof e&&(e=GeoGlobe.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};return this.readNode(e,t),t},readers:{wfs:{WFS_Capabilities:function(e,t){this.readChildNodes(e,t)},FeatureTypeList:function(e,t){t.featureTypeList={featureTypes:[]},this.readChildNodes(e,t.featureTypeList)},FeatureType:function(e,t){var i={};this.readChildNodes(e,i),t.featureTypes.push(i)},Name:function(e,t){var i=this.getChildValue(e);if(i){var r=i.split(":");t.name=r.pop(),0<r.length&&(t.featureNS=this.lookupNamespaceURI(e,r[0]))}},Title:function(e,t){var i=this.getChildValue(e);i&&(t.title=i)},Abstract:function(e,t){var i=this.getChildValue(e);i&&(t.abstract=i)}}},CLASS_NAME:"GeoGlobe.Format.WFSCapabilities.v1"}),GeoGlobe.Format.WFSCapabilities.v1_0_0=GeoGlobe.Class4OL(GeoGlobe.Format.WFSCapabilities.v1,{readers:{wfs:GeoGlobe.Util.applyDefaults({Service:function(e,t){t.service={},this.readChildNodes(e,t.service)},Fees:function(e,t){var i=this.getChildValue(e);i&&"none"!=i.toLowerCase()&&(t.fees=i)},AccessConstraints:function(e,t){var i=this.getChildValue(e);i&&"none"!=i.toLowerCase()&&(t.accessConstraints=i)},OnlineResource:function(e,t){var i=this.getChildValue(e);i&&"none"!=i.toLowerCase()&&(t.onlineResource=i)},Keywords:function(e,t){var i=this.getChildValue(e);i&&"none"!=i.toLowerCase()&&(t.keywords=i.split(", "))},Capability:function(e,t){t.capability={},this.readChildNodes(e,t.capability)},Request:function(e,t){t.request={},this.readChildNodes(e,t.request)},GetFeature:function(e,t){t.getfeature={href:{},formats:[]},this.readChildNodes(e,t.getfeature)},ResultFormat:function(e,t){for(var i,r=e.childNodes,o=0;o<r.length;o++)1==(i=r[o]).nodeType&&t.formats.push(i.nodeName)},DCPType:function(e,t){this.readChildNodes(e,t)},HTTP:function(e,t){this.readChildNodes(e,t.href)},Get:function(e,t){t.get=e.getAttribute("onlineResource")},Post:function(e,t){t.post=e.getAttribute("onlineResource")},SRS:function(e,t){var i=this.getChildValue(e);i&&(t.srs=i)},LatLongBoundingBox:function(e,t){var i=e.getAttribute("minx"),r=e.getAttribute("miny"),o=e.getAttribute("maxx"),n=e.getAttribute("maxy");t.bbox=i+","+r+","+o+","+n},TemporalFeatureLayer:function(e,t){t.temporalFeatureLayers=[];var i={};this.readChildNodes(e,i),t.temporalFeatureLayers.push(i)},Extent:function(e,t){t.defaultTime=e.getAttribute("default");var i=this.getChildValue(e).split("/");t.time=i},Dimension:function(e,t){t.defaultTime=e.getAttribute("default");var i=this.getChildValue(e).split("/");t.time=i}},GeoGlobe.Format.WFSCapabilities.v1.prototype.readers.wfs)},CLASS_NAME:"GeoGlobe.Format.WFSCapabilities.v1_0_0"}),GeoGlobe.Format.WFSCapabilities.v1_1_0=GeoGlobe.Class4OL(GeoGlobe.Format.WFSCapabilities.v1,{regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},readers:{wfs:GeoGlobe.Util.applyDefaults({DefaultSRS:function(e,t){var i=this.getChildValue(e);i&&(t.srs=i)},WGS84BoundingBox:function(e,t){var i=e.getElementsByTagName("ows:LowerCorner"),r=this.getChildValue(i[0]).split(" "),o=e.getElementsByTagName("ows:UpperCorner"),n=this.getChildValue(o[0]).split(" ");t.bbox=r[0]+","+r[1]+","+n[0]+","+n[1]},TemporalFeatureLayer:function(e,t){t.temporalFeatureLayers=[];var i={};this.readChildNodes(e,i),t.temporalFeatureLayers.push(i)},Extent:function(e,t){t.defaultTime=e.getAttribute("default");var i=this.getChildValue(e).split("/");t.time=i},Dimension:function(e,t){t.defaultTime=e.getAttribute("default");var i=this.getChildValue(e).split("/");t.time=i}},GeoGlobe.Format.WFSCapabilities.v1.prototype.readers.wfs),ows:GeoGlobe.Format.OWSCommon.v1.prototype.readers.ows},CLASS_NAME:"GeoGlobe.Format.WFSCapabilities.v1_1_0"}),GeoGlobe.Format.WFSDescribeFeatureType=GeoGlobe.Class4OL(GeoGlobe.Format.XML,{regExes:{trimSpace:/^\s*|\s*$/g},namespaces:{xsd:"http://www.w3.org/2001/XMLSchema"},readers:{xsd:{schema:function(e,t){var i,r,o=[],n={},a={complexTypes:o,customTypes:n};this.readChildNodes(e,a);var s,l,u,h,c=e.attributes;for(i=0,r=c.length;i<r;++i)0===(l=(s=c[i]).name).indexOf("xmlns")?this.setNamespace(l.split(":")[1]||"",s.value):t[l]=s.value;for(t.featureTypes=o,t.targetPrefix=this.namespaceAlias[t.targetNamespace],i=0,r=o.length;i<r;++i)h=n[(u=o[i]).typeName],n[u.typeName]&&(u.typeName=h.name)},complexType:function(e,t){var i={typeName:e.getAttribute("name")};this.readChildNodes(e,i),t.complexTypes.push(i)},complexContent:function(e,t){this.readChildNodes(e,t)},extension:function(e,t){this.readChildNodes(e,t)},sequence:function(e,t){var i={elements:[]};this.readChildNodes(e,i),t.properties=i.elements},element:function(e,t){var i;if(t.elements){for(var r,o={},n=e.attributes,a=0,s=n.length;a<s;++a)o[(r=n[a]).name]=r.value;(i=o.type||o.ref)||(i={},this.readChildNodes(e,i),o.restriction=i,o.type=i.base);var l=i.base||i;o.localType=l.split(":").pop(),t.elements.push(o),this.readChildNodes(e,o)}if(t.complexTypes){var u=(i=e.getAttribute("type")).split(":").pop();t.customTypes[u]={name:e.getAttribute("name"),type:i}}},annotation:function(e,t){t.annotation={},this.readChildNodes(e,t.annotation)},appinfo:function(e,t){t.appinfo||(t.appinfo=[]),t.appinfo.push(this.getChildValue(e))},documentation:function(e,t){t.documentation||(t.documentation=[]);var i=this.getChildValue(e);t.documentation.push({lang:e.getAttribute("xml:lang"),textContent:i.replace(this.regExes.trimSpace,"")})},simpleType:function(e,t){this.readChildNodes(e,t)},restriction:function(e,t){t.base=e.getAttribute("base"),this.readRestriction(e,t)}}},readRestriction:function(e,t){for(var i,r,o,n=e.childNodes,a=0,s=n.length;a<s;++a)1==(i=n[a]).nodeType&&(r=i.nodeName.split(":").pop(),o=i.getAttribute("value"),t[r]?("string"==typeof t[r]&&(t[r]=[t[r]]),t[r].push(o)):t[r]=o)},read:function(e){"string"==typeof e&&(e=GeoGlobe.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};if("ExceptionReport"===e.nodeName.split(":").pop()){var i=new GeoGlobe.Format.OGCExceptionReport;t.error=i.read(e)}else this.readNode(e,t);return t},CLASS_NAME:"GeoGlobe.Format.WFSDescribeFeatureType"});var _typeof="function"==typeof _babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14___default.a&&"symbol"==_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_13___default()(_babel_runtime_corejs2_core_js_symbol_iterator__WEBPACK_IMPORTED_MODULE_12___default.a)?function(e){return _babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_13___default()(e)}:function(e){return e&&"function"==typeof _babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14___default.a&&e.constructor===_babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14___default.a&&e!==_babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14___default.a.prototype?"symbol":_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_13___default()(e)};GeoGlobe.Format.WKT=GeoGlobe.Class4OL(GeoGlobe.Format,{initialize:function(e){this.regExes={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},GeoGlobe.Format.prototype.initialize.apply(this,[e])},read:function(e){var t,i,r;e=e.replace(/[\n\r]/g," ");var o=this.regExes.typeStr.exec(e);if(o&&(i=o[1].toLowerCase(),r=o[2],this.parse[i]&&(t=this.parse[i].apply(this,[r])),this.internalProjection&&this.externalProjection))if(t&&"GeoGlobe.Feature"==t.CLASS_NAME)t.geometry.transform(this.externalProjection,this.internalProjection);else if(t&&"geometrycollection"!=i&&"object"==(void 0===t?"undefined":_typeof(t)))for(var n=0,a=t.length;n<a;n++)t[n].geometry.transform(this.externalProjection,this.internalProjection);return t},write:function(e){var t,i,r,o=[];(r=e.constructor==Array?(t=e,!0):!(t=[e]))&&o.push("GEOMETRYCOLLECTION(");for(var n=0,a=t.length;n<a;++n)r&&0<n&&o.push(","),i=t[n].geometry,o.push(this.extractGeometry(i));return r&&o.push(")"),o.join("")},extractGeometry:function(e){var t=e.CLASS_NAME.split(".")[2].toLowerCase();return this.extract[t]?(this.internalProjection&&this.externalProjection&&(e=e.clone()).transform(this.internalProjection,this.externalProjection),("collection"==t?"GEOMETRYCOLLECTION":t.toUpperCase())+"("+this.extract[t].apply(this,[e])+")"):null},extract:{point:function(e){return e.x+" "+e.y},multipoint:function(e){for(var t=[],i=0,r=e.components.length;i<r;++i)t.push("("+this.extract.point.apply(this,[e.components[i]])+")");return t.join(",")},linestring:function(e){for(var t=[],i=0,r=e.components.length;i<r;++i)t.push(this.extract.point.apply(this,[e.components[i]]));return t.join(",")},multilinestring:function(e){for(var t=[],i=0,r=e.components.length;i<r;++i)t.push("("+this.extract.linestring.apply(this,[e.components[i]])+")");return t.join(",")},polygon:function(e){for(var t=[],i=0,r=e.components.length;i<r;++i)t.push("("+this.extract.linestring.apply(this,[e.components[i]])+")");return t.join(",")},multipolygon:function(e){for(var t=[],i=0,r=e.components.length;i<r;++i)t.push("("+this.extract.polygon.apply(this,[e.components[i]])+")");return t.join(",")},collection:function(e){for(var t=[],i=0,r=e.components.length;i<r;++i)t.push(this.extractGeometry.apply(this,[e.components[i]]));return t.join(",")}},parse:{point:function(e){var t=GeoGlobe.String.trim(e).split(this.regExes.spaces);return new GeoGlobe.Feature(new GeoGlobe.Geometry.Point(t[0],t[1]))},multipoint:function(e){for(var t,i=GeoGlobe.String.trim(e).split(","),r=[],o=0,n=i.length;o<n;++o)t=i[o].replace(this.regExes.trimParens,"$1"),r.push(this.parse.point.apply(this,[t]).geometry);return new GeoGlobe.Feature(new GeoGlobe.Geometry.MultiPoint(r))},linestring:function(e){for(var t=GeoGlobe.String.trim(e).split(","),i=[],r=0,o=t.length;r<o;++r)i.push(this.parse.point.apply(this,[t[r]]).geometry);return new GeoGlobe.Feature(new GeoGlobe.Geometry.LineString(i))},multilinestring:function(e){for(var t,i=GeoGlobe.String.trim(e).split(this.regExes.parenComma),r=[],o=0,n=i.length;o<n;++o)t=i[o].replace(this.regExes.trimParens,"$1"),r.push(this.parse.linestring.apply(this,[t]).geometry);return new GeoGlobe.Feature(new GeoGlobe.Geometry.MultiLineString(r))},polygon:function(e){for(var t,i,r,o=GeoGlobe.String.trim(e).split(this.regExes.parenComma),n=[],a=0,s=o.length;a<s;++a)t=o[a].replace(this.regExes.trimParens,"$1"),i=this.parse.linestring.apply(this,[t]).geometry,r=new GeoGlobe.Geometry.LinearRing(i.components),n.push(r);return new GeoGlobe.Feature(new GeoGlobe.Geometry.Polygon(n))},multipolygon:function(e){for(var t,i=GeoGlobe.String.trim(e).split(this.regExes.doubleParenComma),r=[],o=0,n=i.length;o<n;++o)t=i[o].replace(this.regExes.trimParens,"$1"),r.push(this.parse.polygon.apply(this,[t]).geometry);return new GeoGlobe.Feature(new GeoGlobe.Geometry.MultiPolygon(r))},geometrycollection:function(e){e=e.replace(/,\s*([A-Za-z])/g,"|$1");for(var t=GeoGlobe.String.trim(e).split("|"),i=[],r=0,o=t.length;r<o;++r)i.push(GeoGlobe.Format.WKT.prototype.read.apply(this,[t[r]]));return i}},CLASS_NAME:"GeoGlobe.Format.WKT"}),GeoGlobe.Format.CQL=function(){var e,t={PROPERTY:/^[_a-zA-Z]\w*/,COMPARISON:/^(=|<>|<=|<|>=|>|LIKE)/i,IS_NULL:/^IS NULL/i,COMMA:/^,/,LOGICAL:/^(AND|OR)/i,VALUE:/^('([^']|'')*'|\d+(\.\d*)?|\.\d+)/,LPAREN:/^\(/,RPAREN:/^\)/,SPATIAL:/^(BBOX|INTERSECTS|DWITHIN|WITHIN|CONTAINS)/i,NOT:/^NOT/i,BETWEEN:/^BETWEEN/i,GEOMETRY:function(e){var t=/^(POINT|LINESTRING|POLYGON|MULTIPOINT|MULTILINESTRING|MULTIPOLYGON|GEOMETRYCOLLECTION)/.exec(e);if(t){var i=e.length,r=e.indexOf("(",t[0].length);if(-1<r)for(var o=1;r<i&&0<o;)switch(r++,e.charAt(r)){case"(":o++;break;case")":o--}return[e.substr(0,r+1)]}},END:/^$/},i={LPAREN:["GEOMETRY","SPATIAL","PROPERTY","VALUE","LPAREN"],RPAREN:["NOT","LOGICAL","END","RPAREN"],PROPERTY:["COMPARISON","BETWEEN","COMMA","IS_NULL"],BETWEEN:["VALUE"],IS_NULL:["END"],COMPARISON:["VALUE"],COMMA:["GEOMETRY","VALUE","PROPERTY"],VALUE:["LOGICAL","COMMA","RPAREN","END"],SPATIAL:["LPAREN"],LOGICAL:["NOT","VALUE","SPATIAL","PROPERTY","LPAREN"],NOT:["PROPERTY","LPAREN"],GEOMETRY:["COMMA","RPAREN"]},r={"=":GeoGlobe.Filter.Comparison.EQUAL_TO,"<>":GeoGlobe.Filter.Comparison.NOT_EQUAL_TO,"<":GeoGlobe.Filter.Comparison.LESS_THAN,"<=":GeoGlobe.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,">":GeoGlobe.Filter.Comparison.GREATER_THAN,">=":GeoGlobe.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,LIKE:GeoGlobe.Filter.Comparison.LIKE,BETWEEN:GeoGlobe.Filter.Comparison.BETWEEN,"IS NULL":GeoGlobe.Filter.Comparison.IS_NULL},o={},n={AND:GeoGlobe.Filter.Logical.AND,OR:GeoGlobe.Filter.Logical.OR},a={},s={RPAREN:3,LOGICAL:2,COMPARISON:1};for(e in r)r.hasOwnProperty(e)&&(o[r[e]]=e);for(e in n)n.hasOwnProperty(e)&&(a[n[e]]=e);function l(e,i){var r,o,n,a,s=i.length;for(r=0;r<s;r++){o=i[r];var l=(n=e,(a=t[o])instanceof RegExp?a.exec(n):a(n));if(l){var u=l[0];return{type:o,text:u,remainder:e.substr(u.length).replace(/^\s*/,"")}}}var h="ERROR: In parsing: ["+e+"], expected one of: ";for(r=0;r<s;r++)h+="\n    "+(o=i[r])+": "+t[o];throw new Error(h)}return GeoGlobe.Class4OL(GeoGlobe.Format,{read:function(e){var t=function(e){for(var t=[],i=[];e.length;){var o=e.shift();switch(o.type){case"PROPERTY":case"GEOMETRY":case"VALUE":i.push(o);break;case"COMPARISON":case"BETWEEN":case"IS_NULL":case"LOGICAL":for(var a=s[o.type];0<t.length&&s[t[t.length-1].type]<=a;)i.push(t.pop());t.push(o);break;case"SPATIAL":case"NOT":case"LPAREN":t.push(o);break;case"RPAREN":for(;0<t.length&&"LPAREN"!=t[t.length-1].type;)i.push(t.pop());t.pop(),0<t.length&&"SPATIAL"==t[t.length-1].type&&i.push(t.pop());case"COMMA":case"END":break;default:throw new Error("Unknown token type "+o.type)}}for(;0<t.length;)i.push(t.pop());var l=function e(){var t=i.pop();switch(t.type){case"LOGICAL":var o=e(),a=e();return new GeoGlobe.Filter.Logical({filters:[a,o],type:n[t.text.toUpperCase()]});case"NOT":var s=e();return new GeoGlobe.Filter.Logical({filters:[s],type:GeoGlobe.Filter.Logical.NOT});case"BETWEEN":var l,u;return i.pop(),u=e(),l=e(),c=e(),new GeoGlobe.Filter.Comparison({property:c,lowerBoundary:l,upperBoundary:u,type:GeoGlobe.Filter.Comparison.BETWEEN});case"COMPARISON":var h=e(),c=e();return new GeoGlobe.Filter.Comparison({property:c,value:h,type:r[t.text.toUpperCase()]});case"IS_NULL":return c=e(),new GeoGlobe.Filter.Comparison({property:c,type:r[t.text.toUpperCase()]});case"VALUE":var p=t.text.match(/^'(.*)'$/);return p?p[1].replace(/''/g,"'"):Number(t.text);case"SPATIAL":switch(t.text.toUpperCase()){case"BBOX":var d=e(),f=e(),g=e(),m=e(),_=e();return new GeoGlobe.Filter.Spatial({type:GeoGlobe.Filter.Spatial.BBOX,property:_,value:GeoGlobe.LngLatBounds.fromArray([m,g,f,d])});case"INTERSECTS":return h=e(),c=e(),new GeoGlobe.Filter.Spatial({type:GeoGlobe.Filter.Spatial.INTERSECTS,property:c,value:h});case"WITHIN":return h=e(),c=e(),new GeoGlobe.Filter.Spatial({type:GeoGlobe.Filter.Spatial.WITHIN,property:c,value:h});case"CONTAINS":return h=e(),c=e(),new GeoGlobe.Filter.Spatial({type:GeoGlobe.Filter.Spatial.CONTAINS,property:c,value:h});case"DWITHIN":var v=e();return h=e(),c=e(),new GeoGlobe.Filter.Spatial({type:GeoGlobe.Filter.Spatial.DWITHIN,value:h,property:c,distance:Number(v)})}case"GEOMETRY":return GeoGlobe.Geometry.fromWKT(t.text);default:return t.text}}();if(0<i.length){for(var u="Remaining tokens after building AST: \n",h=i.length-1;0<=h;h--)u+=i[h].type+": "+i[h].text+"\n";throw new Error(u)}return l}(function(e){var t,r=[],o=["NOT","GEOMETRY","SPATIAL","PROPERTY","LPAREN"];do{if(e=(t=l(e,o)).remainder,o=i[t.type],"END"!=t.type&&!o)throw new Error("No follows list for "+t.type);r.push(t)}while("END"!=t.type);return r}(e));return this.keepData&&(this.data=t),t},write:function(e){if(e instanceof GeoGlobe.Geometry)return e.toString();switch(e.CLASS_NAME){case"GeoGlobe.Filter.Spatial":switch(e.type){case GeoGlobe.Filter.Spatial.BBOX:return"BBOX("+e.property+","+e.value.toBBOX()+")";case GeoGlobe.Filter.Spatial.DWITHIN:return"DWITHIN("+e.property+", "+this.write(e.value)+", "+e.distance+")";case GeoGlobe.Filter.Spatial.WITHIN:return"WITHIN("+e.property+", "+this.write(e.value)+")";case GeoGlobe.Filter.Spatial.INTERSECTS:return"INTERSECTS("+e.property+", "+this.write(e.value)+")";case GeoGlobe.Filter.Spatial.CONTAINS:return"CONTAINS("+e.property+", "+this.write(e.value)+")";default:throw new Error("Unknown spatial filter type: "+e.type)}case"GeoGlobe.Filter.Logical":if(e.type==GeoGlobe.Filter.Logical.NOT)return"NOT ("+this.write(e.filters[0])+")";for(var t="(",i=!0,r=0;r<e.filters.length;r++)i?i=!1:t+=") "+a[e.type]+" (",t+=this.write(e.filters[r]);return t+")";case"GeoGlobe.Filter.Comparison":return e.type==GeoGlobe.Filter.Comparison.BETWEEN?e.property+" BETWEEN "+this.write(e.lowerBoundary)+" AND "+this.write(e.upperBoundary):null!==e.value?e.property+" "+o[e.type]+" "+this.write(e.value):e.property+" "+o[e.type];case void 0:if("string"==typeof e)return"'"+e.replace(/'/g,"''")+"'";if("number"==typeof e)return String(e);default:throw new Error("Can't encode: "+e.CLASS_NAME+" "+e)}},CLASS_NAME:"GeoGlobe.Format.CQL"})}(),GeoGlobe.Format.Filter=GeoGlobe.Class4OL(GeoGlobe.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"GeoGlobe.Format.Filter"}),GeoGlobe.Format.Filter.v1=GeoGlobe.Class4OL(GeoGlobe.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"ogc",schemaLocation:null,initialize:function(e){GeoGlobe.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){var t={};return this.readers.ogc.Filter.apply(this,[e,t]),t.filter},readers:{ogc:{_expression:function(e){for(var t,i="",r=e.firstChild;r;r=r.nextSibling)switch(r.nodeType){case 1:(t=this.readNode(r)).property?i+="${"+t.property+"}":void 0!==t.value&&(i+=t.value);break;case 3:case 4:i+=r.nodeValue}return i},Filter:function(e,t){var i={fids:[],filters:[]};this.readChildNodes(e,i),0<i.fids.length?t.filter=new GeoGlobe.Filter.FeatureId({fids:i.fids}):0<i.filters.length&&(t.filter=i.filters[0])},FeatureId:function(e,t){var i=e.getAttribute("fid");i&&t.fids.push(i)},And:function(e,t){var i=new GeoGlobe.Filter.Logical({type:GeoGlobe.Filter.Logical.AND});this.readChildNodes(e,i),t.filters.push(i)},Or:function(e,t){var i=new GeoGlobe.Filter.Logical({type:GeoGlobe.Filter.Logical.OR});this.readChildNodes(e,i),t.filters.push(i)},Not:function(e,t){var i=new GeoGlobe.Filter.Logical({type:GeoGlobe.Filter.Logical.NOT});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsLessThan:function(e,t){var i=new GeoGlobe.Filter.Comparison({type:GeoGlobe.Filter.Comparison.LESS_THAN});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsGreaterThan:function(e,t){var i=new GeoGlobe.Filter.Comparison({type:GeoGlobe.Filter.Comparison.GREATER_THAN});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsLessThanOrEqualTo:function(e,t){var i=new GeoGlobe.Filter.Comparison({type:GeoGlobe.Filter.Comparison.LESS_THAN_OR_EQUAL_TO});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsGreaterThanOrEqualTo:function(e,t){var i=new GeoGlobe.Filter.Comparison({type:GeoGlobe.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsBetween:function(e,t){var i=new GeoGlobe.Filter.Comparison({type:GeoGlobe.Filter.Comparison.BETWEEN});this.readChildNodes(e,i),t.filters.push(i)},Literal:function(e,t){t.value=GeoGlobe.String.numericIf(this.getChildValue(e),!0)},PropertyName:function(e,t){t.property=this.getChildValue(e)},LowerBoundary:function(e,t){t.lowerBoundary=GeoGlobe.String.numericIf(this.readers.ogc._expression.call(this,e),!0)},UpperBoundary:function(e,t){t.upperBoundary=GeoGlobe.String.numericIf(this.readers.ogc._expression.call(this,e),!0)},Intersects:function(e,t){this.readSpatial(e,t,GeoGlobe.Filter.Spatial.INTERSECTS)},Within:function(e,t){this.readSpatial(e,t,GeoGlobe.Filter.Spatial.WITHIN)},Contains:function(e,t){this.readSpatial(e,t,GeoGlobe.Filter.Spatial.CONTAINS)},DWithin:function(e,t){this.readSpatial(e,t,GeoGlobe.Filter.Spatial.DWITHIN)},Distance:function(e,t){t.distance=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e)),t.distanceUnits=e.getAttribute("units")},Function:function(){},PropertyIsNull:function(e,t){var i=new GeoGlobe.Filter.Comparison({type:GeoGlobe.Filter.Comparison.IS_NULL});this.readChildNodes(e,i),t.filters.push(i)}}},readSpatial:function(e,t,i){var r=new GeoGlobe.Filter.Spatial({type:i});this.readChildNodes(e,r),r.value=r.components[0],delete r.components,t.filters.push(r)},encodeLiteral:function(e){return e instanceof Date&&(e=GeoGlobe.Date.toISOString(e)),e},writeOgcExpression:function(e,t){return e instanceof GeoGlobe.Filter.Function?this.writeNode("Function",e,t):this.writeNode("Literal",e,t),t},write:function(e){return this.writers.ogc.Filter.apply(this,[e])},writers:{ogc:{Filter:function(e){var t=this.createElementNSPlus("ogc:Filter");return this.writeNode(this.getFilterType(e),e,t),t},_featureIds:function(e){for(var t=this.createDocumentFragment(),i=0,r=e.fids.length;i<r;++i)this.writeNode("ogc:FeatureId",e.fids[i],t);return t},FeatureId:function(e){return this.createElementNSPlus("ogc:FeatureId",{attributes:{fid:e}})},And:function(e){for(var t,i=this.createElementNSPlus("ogc:And"),r=0,o=e.filters.length;r<o;++r)t=e.filters[r],this.writeNode(this.getFilterType(t),t,i);return i},Or:function(e){for(var t,i=this.createElementNSPlus("ogc:Or"),r=0,o=e.filters.length;r<o;++r)t=e.filters[r],this.writeNode(this.getFilterType(t),t,i);return i},Not:function(e){var t=this.createElementNSPlus("ogc:Not"),i=e.filters[0];return this.writeNode(this.getFilterType(i),i,t),t},PropertyIsLessThan:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLessThan");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsGreaterThan:function(e){var t=this.createElementNSPlus("ogc:PropertyIsGreaterThan");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsLessThanOrEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLessThanOrEqualTo");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsGreaterThanOrEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsGreaterThanOrEqualTo");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsBetween:function(e){var t=this.createElementNSPlus("ogc:PropertyIsBetween");return this.writeNode("PropertyName",e,t),this.writeNode("LowerBoundary",e,t),this.writeNode("UpperBoundary",e,t),t},PropertyName:function(e){return this.createElementNSPlus("ogc:PropertyName",{value:e.property})},Literal:function(e){var t=this.encodeLiteral||GeoGlobe.Format.Filter.v1.prototype.encodeLiteral;return this.createElementNSPlus("ogc:Literal",{value:t(e)})},LowerBoundary:function(e){var t=this.createElementNSPlus("ogc:LowerBoundary");return this.writeOgcExpression(e.lowerBoundary,t),t},UpperBoundary:function(e){var t=this.createElementNSPlus("ogc:UpperBoundary");return this.writeNode("Literal",e.upperBoundary,t),t},INTERSECTS:function(e){return this.writeSpatial(e,"Intersects")},WITHIN:function(e){return this.writeSpatial(e,"Within")},CONTAINS:function(e){return this.writeSpatial(e,"Contains")},DWITHIN:function(e){var t=this.writeSpatial(e,"DWithin");return this.writeNode("Distance",e,t),t},Distance:function(e){return this.createElementNSPlus("ogc:Distance",{attributes:{units:e.distanceUnits},value:e.distance})},Function:function(e){for(var t=this.createElementNSPlus("ogc:Function",{attributes:{name:e.name}}),i=e.params,r=0,o=i.length;r<o;r++)this.writeOgcExpression(i[r],t);return t},PropertyIsNull:function(e){var t=this.createElementNSPlus("ogc:PropertyIsNull");return this.writeNode("PropertyName",e,t),t},SortBy:function(e){for(var t=this.createElementNSPlus("ogc:SortBy"),i=0,r=e.length;i<r;i++)this.writeNode("ogc:SortProperty",e[i],t);return t},SortProperty:function(e){var t=this.createElementNSPlus("ogc:SortProperty");return this.writeNode("ogc:PropertyName",e,t),this.writeNode("ogc:SortOrder","DESC"==e.order?"DESC":"ASC",t),t},SortOrder:function(e){return this.createElementNSPlus("ogc:SortOrder",{value:e})}}},getFilterType:function(e){var t=this.filterMap[e.type];if(!t)throw"Filter writing not supported for rule type: "+e.type;return t},filterMap:{"&&":"And","||":"Or","!":"Not","==":"PropertyIsEqualTo","!=":"PropertyIsNotEqualTo","<":"PropertyIsLessThan",">":"PropertyIsGreaterThan","<=":"PropertyIsLessThanOrEqualTo",">=":"PropertyIsGreaterThanOrEqualTo","..":"PropertyIsBetween","~":"PropertyIsLike",NULL:"PropertyIsNull",BBOX:"BBOX",DWITHIN:"DWITHIN",WITHIN:"WITHIN",CONTAINS:"CONTAINS",INTERSECTS:"INTERSECTS",FID:"_featureIds"},CLASS_NAME:"GeoGlobe.Format.Filter.v1"}),GeoGlobe.Format.Filter.v1_0_0=GeoGlobe.Class4OL(GeoGlobe.Format.GML.v2,GeoGlobe.Format.Filter.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.0.0/filter.xsd",initialize:function(e){GeoGlobe.Format.GML.v2.prototype.initialize.apply(this,[e])},readers:{ogc:GeoGlobe.Util.applyDefaults({PropertyIsEqualTo:function(e,t){var i=new GeoGlobe.Filter.Comparison({type:GeoGlobe.Filter.Comparison.EQUAL_TO});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsNotEqualTo:function(e,t){var i=new GeoGlobe.Filter.Comparison({type:GeoGlobe.Filter.Comparison.NOT_EQUAL_TO});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsLike:function(e,t){var i=new GeoGlobe.Filter.Comparison({type:GeoGlobe.Filter.Comparison.LIKE});this.readChildNodes(e,i);var r=e.getAttribute("wildCard"),o=e.getAttribute("singleChar"),n=e.getAttribute("escape");i.value2regex(r,o,n),t.filters.push(i)}},GeoGlobe.Format.Filter.v1.prototype.readers.ogc),gml:GeoGlobe.Format.GML.v2.prototype.readers.gml,feature:GeoGlobe.Format.GML.v2.prototype.readers.feature},writers:{ogc:GeoGlobe.Util.applyDefaults({PropertyIsEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsEqualTo");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsNotEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsNotEqualTo");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsLike:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{wildCard:"*",singleChar:".",escape:"!"}});return this.writeNode("PropertyName",e,t),this.writeNode("Literal",e.regex2value(),t),t},BBOX:function(e){var t=this.createElementNSPlus("ogc:BBOX");e.property&&this.writeNode("PropertyName",e,t);var i=this.writeNode("gml:Box",e.value,t);return e.projection&&i.setAttribute("srsName",e.projection),t}},GeoGlobe.Format.Filter.v1.prototype.writers.ogc),gml:GeoGlobe.Format.GML.v2.prototype.writers.gml,feature:GeoGlobe.Format.GML.v2.prototype.writers.feature},writeSpatial:function(e,t){var i,r=this.createElementNSPlus("ogc:"+t);return this.writeNode("PropertyName",e,r),e.value instanceof GeoGlobe.Filter.Function?this.writeNode("Function",e.value,r):(i=e.value instanceof GeoGlobe.Geometry?this.writeNode("feature:_geometry",e.value).firstChild:this.writeNode("gml:Box",e.value),e.projection&&i.setAttribute("srsName",e.projection),r.appendChild(i)),r},CLASS_NAME:"GeoGlobe.Format.Filter.v1_0_0"}),GeoGlobe.Format.Filter.v1_1_0=GeoGlobe.Class4OL(GeoGlobe.Format.GML.v3,GeoGlobe.Format.Filter.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.1.0/filter.xsd",initialize:function(e){GeoGlobe.Format.GML.v3.prototype.initialize.apply(this,[e])},readers:{ogc:GeoGlobe.Util.applyDefaults({PropertyIsEqualTo:function(e,t){var i=e.getAttribute("matchCase"),r=new GeoGlobe.Filter.Comparison({type:GeoGlobe.Filter.Comparison.EQUAL_TO,matchCase:!("false"===i||"0"===i)});this.readChildNodes(e,r),t.filters.push(r)},PropertyIsNotEqualTo:function(e,t){var i=e.getAttribute("matchCase"),r=new GeoGlobe.Filter.Comparison({type:GeoGlobe.Filter.Comparison.NOT_EQUAL_TO,matchCase:!("false"===i||"0"===i)});this.readChildNodes(e,r),t.filters.push(r)},PropertyIsLike:function(e,t){var i=new GeoGlobe.Filter.Comparison({type:GeoGlobe.Filter.Comparison.LIKE});this.readChildNodes(e,i);var r=e.getAttribute("wildCard"),o=e.getAttribute("singleChar"),n=e.getAttribute("escapeChar");i.value2regex(r,o,n),t.filters.push(i)}},GeoGlobe.Format.Filter.v1.prototype.readers.ogc),gml:GeoGlobe.Format.GML.v3.prototype.readers.gml,feature:GeoGlobe.Format.GML.v3.prototype.readers.feature},writers:{ogc:GeoGlobe.Util.applyDefaults({PropertyIsEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsEqualTo",{attributes:{matchCase:e.matchCase}});return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsNotEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsNotEqualTo",{attributes:{matchCase:e.matchCase}});return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsLike:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{matchCase:e.matchCase,wildCard:"*",singleChar:".",escapeChar:"!"}});return this.writeNode("PropertyName",e,t),this.writeNode("Literal",e.regex2value(),t),t},BBOX:function(e){var t=this.createElementNSPlus("ogc:BBOX");e.property&&this.writeNode("PropertyName",e,t);var i=this.writeNode("gml:Envelope",e.value);return e.projection&&i.setAttribute("srsName",e.projection),t.appendChild(i),t},SortBy:function(e){for(var t=this.createElementNSPlus("ogc:SortBy"),i=0,r=e.length;i<r;i++)this.writeNode("ogc:SortProperty",e[i],t);return t},SortProperty:function(e){var t=this.createElementNSPlus("ogc:SortProperty");return this.writeNode("ogc:PropertyName",e,t),this.writeNode("ogc:SortOrder","DESC"==e.order?"DESC":"ASC",t),t},SortOrder:function(e){return this.createElementNSPlus("ogc:SortOrder",{value:e})}},GeoGlobe.Format.Filter.v1.prototype.writers.ogc),gml:GeoGlobe.Format.GML.v3.prototype.writers.gml,feature:GeoGlobe.Format.GML.v3.prototype.writers.feature},writeSpatial:function(e,t){var i,r=this.createElementNSPlus("ogc:"+t);return this.writeNode("PropertyName",e,r),e.value instanceof GeoGlobe.Filter.Function?this.writeNode("Function",e.value,r):(i=e.value instanceof GeoGlobe.Geometry?this.writeNode("feature:_geometry",e.value).firstChild:this.writeNode("gml:Envelope",e.value),e.projection&&i.setAttribute("srsName",e.projection),r.appendChild(i)),r},CLASS_NAME:"GeoGlobe.Format.Filter.v1_1_0"}),GeoGlobe.Format.WFST=function(e){e=GeoGlobe.Util.applyDefaults(e,GeoGlobe.Format.WFST.DEFAULTS);var t=GeoGlobe.Format.WFST["v"+e.version.replace(/\./g,"_")];if(!t)throw"Unsupported WFST version: "+e.version;return new t(e)},GeoGlobe.Format.WFST.DEFAULTS={version:"1.0.0"},GeoGlobe.Format.WFST.v1=GeoGlobe.Class4OL(GeoGlobe.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs",gml:"http://www.opengis.net/gml",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows"},defaultPrefix:"wfs",version:null,schemaLocations:null,srsName:null,extractAttributes:!0,xy:!0,stateName:null,initialize:function(e){this.stateName={},this.stateName[GeoGlobe.State.INSERT]="wfs:Insert",this.stateName[GeoGlobe.State.UPDATE]="wfs:Update",this.stateName[GeoGlobe.State.DELETE]="wfs:Delete",GeoGlobe.Format.XML.prototype.initialize.apply(this,[e])},getSrsName:function(e,t){var i=t&&t.srsName;return i||(e&&e.layer?e.layer.projection.getCode():this.srsName)},read:function(e,t){t=t||{},GeoGlobe.Util.applyDefaults(t,{output:"features"}),"string"==typeof e&&(e=GeoGlobe.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var i={};return e&&this.readNode(e,i,!0),i.features&&"features"===t.output&&(i=i.features),i},readers:{wfs:{FeatureCollection:function(e,t){t.features=[],this.readChildNodes(e,t)}}},write:function(e,t){var i=this.writeNode("wfs:Transaction",{features:e,options:t}),r=this.schemaLocationAttr();return r&&this.setAttributeNS(i,this.namespaces.xsi,"xsi:schemaLocation",r),GeoGlobe.Format.XML.prototype.write.apply(this,[i])},writers:{wfs:{GetFeature:function(e){var t=this.createElementNSPlus("wfs:GetFeature",{attributes:{service:"WFS",version:this.version,outputFormat:e&&e.outputFormat,maxFeatures:e&&e.maxFeatures,resultType:e&&e.resultType,startPosition:e&&e.startPosition,"xsi:schemaLocation":this.schemaLocationAttr(e)}});if("string"==typeof this.featureType)this.writeNode("Query",e,t);else for(var i=0,r=this.featureType.length;i<r;i++)e.featureType=this.featureType[i],this.writeNode("Query",e,t);return t},Transaction:function(e){var t,i,r=(e=e||{}).options||{},o=this.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version,handle:r.handle}}),n=e.features;if(n){var a,s;for(!0===r.multi&&GeoGlobe.Util.extend(this.geometryTypes,{"GeoGlobe.Geometry.Point":"MultiPoint","GeoGlobe.Geometry.LineString":!0===this.multiCurve?"MultiCurve":"MultiLineString","GeoGlobe.Geometry.Polygon":!0===this.multiSurface?"MultiSurface":"MultiPolygon"}),t=0,i=n.length;t<i;++t)s=n[t],(a=this.stateName[s.state])&&this.writeNode(a,{feature:s,options:r},o);!0===r.multi&&this.setGeometryTypes()}if(r.nativeElements)for(t=0,i=r.nativeElements.length;t<i;++t)this.writeNode("wfs:Native",r.nativeElements[t],o);return o},Native:function(e){return this.createElementNSPlus("wfs:Native",{attributes:{vendorId:e.vendorId,safeToIgnore:e.safeToIgnore},value:e.value})},Insert:function(e){var t=e.feature,i=e.options,r=this.createElementNSPlus("wfs:Insert",{attributes:{handle:i&&i.handle}});return this.srsName=this.getSrsName(t),this.writeNode("feature:_typeName",t,r),r},Update:function(e){var t=e.feature,i=e.options,r=this.createElementNSPlus("wfs:Update",{attributes:{handle:i&&i.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});this.featureNS&&r.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var o=t.modified;for(var n in null===this.geometryName||o&&void 0===o.geometry||(this.srsName=this.getSrsName(t),this.writeNode("Property",{name:this.geometryName,value:t.geometry},r)),t.attributes)void 0===t.attributes[n]||o&&o.attributes&&(!o.attributes||void 0===o.attributes[n])||this.writeNode("Property",{name:n,value:t.attributes[n]},r);return this.writeNode("ogc:Filter",new GeoGlobe.Filter.FeatureId({fids:[t.fid]}),r),r},Property:function(e){var t=this.createElementNSPlus("wfs:Property");return this.writeNode("Name",e.name,t),null!==e.value&&this.writeNode("Value",e.value,t),t},Name:function(e){return this.createElementNSPlus("wfs:Name",{value:e})},Value:function(e){var t;if(e instanceof GeoGlobe.Geometry){t=this.createElementNSPlus("wfs:Value");var i=this.writeNode("feature:_geometry",e).firstChild;t.appendChild(i)}else t=this.createElementNSPlus("wfs:Value",{value:e});return t},Delete:function(e){var t=e.feature,i=e.options,r=this.createElementNSPlus("wfs:Delete",{attributes:{handle:i&&i.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});return this.featureNS&&r.setAttribute("xmlns:"+this.featurePrefix,this.featureNS),this.writeNode("ogc:Filter",new GeoGlobe.Filter.FeatureId({fids:[t.fid]}),r),r}}},schemaLocationAttr:function(e){e=GeoGlobe.Util.extend({featurePrefix:this.featurePrefix,schema:this.schema},e);var t=GeoGlobe.Util.extend({},this.schemaLocations);e.schema&&(t[e.featurePrefix]=e.schema);var i,r=[];for(var o in t)(i=this.namespaces[o])&&r.push(i+" "+t[o]);return r.join(" ")||void 0},setFilterProperty:function(e){if(e.filters)for(var t=0,i=e.filters.length;t<i;++t)GeoGlobe.Format.WFST.v1.prototype.setFilterProperty.call(this,e.filters[t]);else e instanceof GeoGlobe.Filter.Spatial&&!e.property&&(e.property=this.geometryName)},CLASS_NAME:"GeoGlobe.Format.WFST.v1"}),GeoGlobe.Format.WFST.v1_0_0=GeoGlobe.Class4OL(GeoGlobe.Format.Filter.v1_0_0,GeoGlobe.Format.WFST.v1,{version:"1.0.0",srsNameInQuery:!1,schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.0.0/WFS-transaction.xsd"},initialize:function(e){GeoGlobe.Format.Filter.v1_0_0.prototype.initialize.apply(this,[e]),GeoGlobe.Format.WFST.v1.prototype.initialize.apply(this,[e])},readNode:function(e,t,i){return GeoGlobe.Format.GML.v2.prototype.readNode.apply(this,arguments)},readers:{wfs:GeoGlobe.Util.applyDefaults({WFS_TransactionResponse:function(e,t){t.insertIds=[],t.success=!1,this.readChildNodes(e,t)},InsertResult:function(e,t){var i={fids:[]};this.readChildNodes(e,i),t.insertIds=t.insertIds.concat(i.fids)},TransactionResult:function(e,t){this.readChildNodes(e,t)},Status:function(e,t){this.readChildNodes(e,t)},SUCCESS:function(e,t){t.success=!0}},GeoGlobe.Format.WFST.v1.prototype.readers.wfs),gml:GeoGlobe.Format.GML.v2.prototype.readers.gml,feature:GeoGlobe.Format.GML.v2.prototype.readers.feature,ogc:GeoGlobe.Format.Filter.v1_0_0.prototype.readers.ogc},writers:{wfs:GeoGlobe.Util.applyDefaults({Query:function(e){var t=(e=GeoGlobe.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName,srsNameInQuery:this.srsNameInQuery},e)).featurePrefix,i=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(e.featureNS?t+":":"")+e.featureType,time:e&&e.time,userecent:e&&e.userecent}});if(e.srsNameInQuery&&e.srsName&&i.setAttribute("srsName",e.srsName),e.featureNS&&i.setAttribute("xmlns:"+t,e.featureNS),e.propertyNames)for(var r=0,o=e.propertyNames.length;r<o;r++)this.writeNode("ogc:PropertyName",{property:e.propertyNames[r]},i);return e.filter&&(this.setFilterProperty(e.filter),this.writeNode("ogc:Filter",e.filter,i)),e.sortBy&&this.writeNode("ogc:SortBy",e.sortBy,i),e.groupBy&&this.writeNode("ogc:GroupBy",e.groupBy,i),i}},GeoGlobe.Format.WFST.v1.prototype.writers.wfs),gml:GeoGlobe.Format.GML.v2.prototype.writers.gml,feature:GeoGlobe.Format.GML.v2.prototype.writers.feature,ogc:GeoGlobe.Format.Filter.v1_0_0.prototype.writers.ogc},CLASS_NAME:"GeoGlobe.Format.WFST.v1_0_0"}),GeoGlobe.Format.WFST.v1_1_0=GeoGlobe.Class4OL(GeoGlobe.Format.Filter.v1_1_0,GeoGlobe.Format.WFST.v1,{version:"1.1.0",schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"},initialize:function(e){GeoGlobe.Format.Filter.v1_1_0.prototype.initialize.apply(this,[e]),GeoGlobe.Format.WFST.v1.prototype.initialize.apply(this,[e])},readNode:function(e,t,i){return GeoGlobe.Format.GML.v3.prototype.readNode.apply(this,arguments)},readers:{wfs:GeoGlobe.Util.applyDefaults({FeatureCollection:function(e,t){t.numberOfFeatures=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(e.getAttribute("numberOfFeatures")),GeoGlobe.Format.WFST.v1.prototype.readers.wfs.FeatureCollection.apply(this,arguments)},TransactionResponse:function(e,t){t.insertIds=[],t.success=!1,this.readChildNodes(e,t)},TransactionSummary:function(e,t){t.success=!0},InsertResults:function(e,t){this.readChildNodes(e,t)},Feature:function(e,t){var i={fids:[]};this.readChildNodes(e,i),t.insertIds.push(i.fids[0])}},GeoGlobe.Format.WFST.v1.prototype.readers.wfs),gml:GeoGlobe.Format.GML.v3.prototype.readers.gml,feature:GeoGlobe.Format.GML.v3.prototype.readers.feature,ogc:GeoGlobe.Format.Filter.v1_1_0.prototype.readers.ogc,ows:GeoGlobe.Format.OWSCommon.v1_0_0.prototype.readers.ows},writers:{wfs:GeoGlobe.Util.applyDefaults({GetFeature:function(e){var t=GeoGlobe.Format.WFST.v1.prototype.writers.wfs.GetFeature.apply(this,arguments);return e&&this.setAttributes(t,{resultType:e.resultType,startIndex:e.startIndex,count:e.count}),t},Query:function(e){var t=(e=GeoGlobe.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName},e)).featurePrefix,i=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(e.featureNS?t+":":"")+e.featureType,srsName:e.srsName,time:e&&e.time,userecent:e&&e.userecent}});if(e.featureNS&&i.setAttribute("xmlns:"+t,e.featureNS),e.propertyNames)for(var r=0,o=e.propertyNames.length;r<o;r++)this.writeNode("wfs:PropertyName",{property:e.propertyNames[r]},i);return e.filter&&(GeoGlobe.Format.WFST.v1_1_0.prototype.setFilterProperty.call(this,e.filter),this.writeNode("ogc:Filter",e.filter,i)),e.sortBy&&this.writeNode("ogc:SortBy",e.sortBy,i),e.groupBy&&this.writeNode("ogc:GroupBy",e.groupBy,i),i},PropertyName:function(e){return this.createElementNSPlus("wfs:PropertyName",{value:e.property})}},GeoGlobe.Format.WFST.v1.prototype.writers.wfs),gml:GeoGlobe.Format.GML.v3.prototype.writers.gml,feature:GeoGlobe.Format.GML.v3.prototype.writers.feature,ogc:GeoGlobe.Format.Filter.v1_1_0.prototype.writers.ogc},CLASS_NAME:"GeoGlobe.Format.WFST.v1_1_0"});var _typeof="function"==typeof _babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14___default.a&&"symbol"==_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_13___default()(_babel_runtime_corejs2_core_js_symbol_iterator__WEBPACK_IMPORTED_MODULE_12___default.a)?function(e){return _babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_13___default()(e)}:function(e){return e&&"function"==typeof _babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14___default.a&&e.constructor===_babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14___default.a&&e!==_babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14___default.a.prototype?"symbol":_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_13___default()(e)},l;GeoGlobe.Format.JSON=GeoGlobe.Class4OL(GeoGlobe.Format,{indent:"    ",space:" ",newline:"\n",level:0,pretty:!1,nativeJSON:!(!window.JSON||"function"!=typeof JSON.parse||"function"!=typeof _babel_runtime_corejs2_core_js_json_stringify__WEBPACK_IMPORTED_MODULE_2___default.a),read:function read(json,filter){var object;if(this.nativeJSON)object=JSON.parse(json,filter);else try{if(/^[\],:{}\s]*$/.test(json.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))&&(object=eval("("+json+")"),"function"==typeof filter)){var walk=function e(t,i){if(i&&"object"===(void 0===i?"undefined":_typeof(i)))for(var r in i)i.hasOwnProperty(r)&&(i[r]=e(r,i[r]));return filter(t,i)};object=walk("",object)}}catch(e){}return this.keepData&&(this.data=object),object},write:function(e,t){this.pretty=!!t;var i=null,r=void 0===e?"undefined":_typeof(e);if(this.serialize[r])try{i=!this.pretty&&this.nativeJSON?_babel_runtime_corejs2_core_js_json_stringify__WEBPACK_IMPORTED_MODULE_2___default()(e):this.serialize[r].apply(this,[e])}catch(e){GeoGlobe.Console.error("Trouble serializing: "+e)}return i},writeIndent:function(){var e=[];if(this.pretty)for(var t=0;t<this.level;++t)e.push(this.indent);return e.join("")},writeNewline:function(){return this.pretty?this.newline:""},writeSpace:function(){return this.pretty?this.space:""},serialize:{object:function(e){if(null==e)return"null";if(e.constructor==Date)return this.serialize.date.apply(this,[e]);if(e.constructor==Array)return this.serialize.array.apply(this,[e]);var t,i,r,o=["{"];this.level+=1;var n=!1;for(t in e)e.hasOwnProperty(t)&&(i=GeoGlobe.Format.JSON.prototype.write.apply(this,[t,this.pretty]),r=GeoGlobe.Format.JSON.prototype.write.apply(this,[e[t],this.pretty]),null!=i&&null!=r&&(n&&o.push(","),o.push(this.writeNewline(),this.writeIndent(),i,":",this.writeSpace(),r),n=!0));return this.level-=1,o.push(this.writeNewline(),this.writeIndent(),"}"),o.join("")},array:function(e){var t,i=["["];this.level+=1;for(var r=0,o=e.length;r<o;++r)null!=(t=GeoGlobe.Format.JSON.prototype.write.apply(this,[e[r],this.pretty]))&&(0<r&&i.push(","),i.push(this.writeNewline(),this.writeIndent(),t));return this.level-=1,i.push(this.writeNewline(),this.writeIndent(),"]"),i.join("")},string:function(e){var t={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return/["\\\x00-\x1f]/.test(e)?'"'+e.replace(/([\x00-\x1f\\"])/g,(function(e,i){var r=t[i];return r||(r=i.charCodeAt(),"\\u00"+Math.floor(r/16).toString(16)+(r%16).toString(16))}))+'"':'"'+e+'"'},number:function(e){return isFinite(e)?String(e):"null"},boolean:function(e){return String(e)},date:function(e){function t(e){return e<10?"0"+e:e}return'"'+e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+"T"+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+'"'}},CLASS_NAME:"GeoGlobe.Format.JSON"}),GeoGlobe.Format.GeoJSON=GeoGlobe.Class4OL(GeoGlobe.Format.JSON,{ignoreExtraDims:!1,read:function(e,t,i){t=t||"FeatureCollection";var r,o=null;if(r="string"==typeof e?GeoGlobe.Format.JSON.prototype.read.apply(this,[e,i]):e){if("string"!=typeof r.type)GeoGlobe.Console.error("Bad GeoJSON - no type: "+e);else if(this.isValidType(r,t))switch(t){case"Geometry":try{o=this.parseGeometry(r)}catch(e){GeoGlobe.Console.error(e)}break;case"Feature":try{(o=this.parseFeature(r)).type="Feature"}catch(e){GeoGlobe.Console.error(e)}break;case"FeatureCollection":switch(o=[],r.type){case"Feature":try{o.push(this.parseFeature(r))}catch(e){o=null,GeoGlobe.Console.error(e)}break;case"FeatureCollection":for(var n=0,a=r.features.length;n<a;++n)try{o.push(this.parseFeature(r.features[n]))}catch(e){o=null,GeoGlobe.Console.error(e)}break;default:try{var s=this.parseGeometry(r);o.push(new GeoGlobe.Feature(s))}catch(e){o=null,GeoGlobe.Console.error(e)}}}}else GeoGlobe.Console.error("Bad JSON: "+e);return o},isValidType:function(e,t){var i=!1;switch(t){case"Geometry":-1==GeoGlobe.Util.indexOf(["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Box","GeometryCollection"],e.type)?GeoGlobe.Console.error("Unsupported geometry type: "+e.type):i=!0;break;case"FeatureCollection":i=!0;break;default:e.type==t?i=!0:GeoGlobe.Console.error("Cannot convert types from "+e.type+" to "+t)}return i},parseFeature:function(e){var t,i,r,o;r=e.properties?e.properties:{},o=e.geometry&&e.geometry.bbox||e.bbox;try{i=this.parseGeometry(e.geometry)}catch(e){throw e}return t=new GeoGlobe.Feature(i,r),o&&(t.bounds=GeoGlobe.LngLatBounds.fromArray(o)),e.id&&(t.fid=e.id),t},parseGeometry:function(e){if(null==e)return null;var t,i=!1;if("GeometryCollection"==e.type){if(!GeoGlobe.Util.isArray(e.geometries))throw"GeometryCollection must have geometries array: "+e;for(var r=e.geometries.length,o=new Array(r),n=0;n<r;++n)o[n]=this.parseGeometry.apply(this,[e.geometries[n]]);t=new GeoGlobe.Geometry.Collection(o),i=!0}else{if(!GeoGlobe.Util.isArray(e.coordinates))throw"Geometry must have coordinates array: "+e;if(!this.parseCoords[e.type.toLowerCase()])throw"Unsupported geometry type: "+e.type;try{t=this.parseCoords[e.type.toLowerCase()].apply(this,[e.coordinates])}catch(e){throw e}}return this.internalProjection&&this.externalProjection&&!i&&t.transform(this.externalProjection,this.internalProjection),t},parseCoords:{point:function(e){if(0==this.ignoreExtraDims&&2!=e.length)throw"Only 2D points are supported: "+e;return new GeoGlobe.Geometry.Point(e[0],e[1])},multipoint:function(e){for(var t=[],i=null,r=0,o=e.length;r<o;++r){try{i=this.parseCoords.point.apply(this,[e[r]])}catch(e){throw e}t.push(i)}return new GeoGlobe.Geometry.MultiPoint(t)},linestring:function(e){for(var t=[],i=null,r=0,o=e.length;r<o;++r){try{i=this.parseCoords.point.apply(this,[e[r]])}catch(e){throw e}t.push(i)}return new GeoGlobe.Geometry.LineString(t)},multilinestring:function(e){for(var t=[],i=null,r=0,o=e.length;r<o;++r){try{i=this.parseCoords.linestring.apply(this,[e[r]])}catch(e){throw e}t.push(i)}return new GeoGlobe.Geometry.MultiLineString(t)},polygon:function(e){for(var t,i,r=[],o=0,n=e.length;o<n;++o){try{i=this.parseCoords.linestring.apply(this,[e[o]])}catch(e){throw e}t=new GeoGlobe.Geometry.LinearRing(i.components),r.push(t)}return new GeoGlobe.Geometry.Polygon(r)},multipolygon:function(e){for(var t=[],i=null,r=0,o=e.length;r<o;++r){try{i=this.parseCoords.polygon.apply(this,[e[r]])}catch(e){throw e}t.push(i)}return new GeoGlobe.Geometry.MultiPolygon(t)},box:function(e){if(2!=e.length)throw"GeoJSON box coordinates must have 2 elements";return new GeoGlobe.Geometry.Polygon([new GeoGlobe.Geometry.LinearRing([new GeoGlobe.Geometry.Point(e[0][0],e[0][1]),new GeoGlobe.Geometry.Point(e[1][0],e[0][1]),new GeoGlobe.Geometry.Point(e[1][0],e[1][1]),new GeoGlobe.Geometry.Point(e[0][0],e[1][1]),new GeoGlobe.Geometry.Point(e[0][0],e[0][1])])])}},write:function(e,t){var i={type:null};if(GeoGlobe.Util.isArray(e)){i.type="FeatureCollection";var r=e.length;i.features=new Array(r);for(var o=0;o<r;++o){var n=e[o];if(!n instanceof GeoGlobe.Feature)throw"FeatureCollection only supports collections of features: "+n;i.features[o]=this.extract.feature.apply(this,[n])}}else 0==e.CLASS_NAME.indexOf("GeoGlobe.Geometry")?i=this.extract.geometry.apply(this,[e]):e instanceof GeoGlobe.Feature&&(i=this.extract.feature.apply(this,[e]),e.layer&&e.layer.projection&&(i.crs=this.createCRSObject(e)));return GeoGlobe.Format.JSON.prototype.write.apply(this,[i,t])},createCRSObject:function(e){var t=e.layer.projection.toString(),i={};if(t.match(/epsg:/i)){var r=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(t.substring(t.indexOf(":")+1));i=4326==r?{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}}:{type:"name",properties:{name:"EPSG:"+r}}}return i},extract:{feature:function(e){var t=this.extract.geometry.apply(this,[e.geometry]),i={type:"Feature",properties:e.attributes,geometry:t};return null!=e.fid&&(i.id=e.fid),i},geometry:function(e){if(null==e)return null;this.internalProjection&&this.externalProjection&&(e=e.clone()).transform(this.internalProjection,this.externalProjection);var t=e.CLASS_NAME.split(".")[2],i=this.extract[t.toLowerCase()].apply(this,[e]);return"Collection"==t?{type:"GeometryCollection",geometries:i}:{type:t,coordinates:i}},point:function(e){return[e.x,e.y]},multipoint:function(e){for(var t=[],i=0,r=e.components.length;i<r;++i)t.push(this.extract.point.apply(this,[e.components[i]]));return t},linestring:function(e){for(var t=[],i=0,r=e.components.length;i<r;++i)t.push(this.extract.point.apply(this,[e.components[i]]));return t},multilinestring:function(e){for(var t=[],i=0,r=e.components.length;i<r;++i)t.push(this.extract.linestring.apply(this,[e.components[i]]));return t},polygon:function(e){for(var t=[],i=0,r=e.components.length;i<r;++i)t.push(this.extract.linestring.apply(this,[e.components[i]]));return t},multipolygon:function(e){for(var t=[],i=0,r=e.components.length;i<r;++i)t.push(this.extract.polygon.apply(this,[e.components[i]]));return t},collection:function(e){for(var t=e.components.length,i=new Array(t),r=0;r<t;++r)i[r]=this.extract.geometry.apply(this,[e.components[r]]);return i}},CLASS_NAME:"GeoGlobe.Format.GeoJSON"}),GeoGlobe.Format.WMTS=GeoGlobe.Class4OL({initialize:function(e){GeoGlobe.Util.extend(this,e)},getWMTSCapabilities:function(e){var t=null;return this.getCapabilities(e,(function(e){var i=e.responseXML;i&&i.documentElement||(i=e.responseText);var r=new GeoGlobe.Format.WMTSCapabilities.v1_0_0;t=r.read(i)}),(function(){alert("WMTS服务请求失败，请检查服务是否正常运行或请求地址是否正确。\n请求地址："+e+"\n操作类型：GetCapabilities")})),t},getCapabilities:function(e,t,i){"function"!=typeof i&&(i=function(){alert("WMTS服务请求失败，请检查服务是否正常运行或请求地址是否正确。\n请求地址："+e+"\n操作类型：GetCapabilities")}),GeoGlobe.Request.GET({url:e,params:{REQUEST:"GetCapabilities",SERVICE:"WMTS"},scope:this,async:!1,success:function(e){"function"==typeof t&&t(e)},failure:i})},createLayerOption:function(e,t,i){if(!("layer"in i))throw new Error("Missing property 'layer' in configuration.");for(var r,o=t.contents,n=(o.layers,0),a=o.layers.length;n<a;++n)if(o.layers[n].identifier===i.layer){r=o.layers[n];break}if(!r)throw new Error("Layer not found");var s,l,u=i.format;if(!u&&r.formats&&r.formats.length&&(u=r.formats[0]),i.matrixSet)s=o.tileMatrixSets[i.matrixSet];else if(i.projection){n=0;for(var h=r.tileMatrixSetLinks.length;n<h;n++)if(o.tileMatrixSets[r.tileMatrixSetLinks[n].tileMatrixSet].supportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3")===i.projection){s=o.tileMatrixSets[r.tileMatrixSetLinks[n].tileMatrixSet];break}}else 1<=r.tileMatrixSetLinks.length&&(s=o.tileMatrixSets[r.tileMatrixSetLinks[0].tileMatrixSet]);if(!s)throw new Error("matrixSet not found");for(n=0,a=r.styles.length;n<a&&!(l=r.styles[n]).isDefault;++n);var c=i.requestEncoding;c||(c="KVP",t.operationsMetadata.GetTile.dcp.http);var p=[],d=i.params||{};delete i.params;for(var f=0,g=r.dimensions.length;f<g;f++){var m=r.dimensions[f];p.push(m.identifier),d.hasOwnProperty(m.identifier)||(d[m.identifier]=m.default)}var _,v,C,y=i.projection||s.supportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"),A=i.units||("EPSG:4326"===y?"degrees":"m"),I=[],b=[],w=r.tileMatrixSetLinks,E=function(e){I.push(28e-5*e/GeoGlobe.METERS_PER_INCH/GeoGlobe.INCHES_PER_UNIT[A]),(!_||e<_)&&(_=e),(!v||v<e)&&(v=e)},G=0;for(h=w.length;G<h;G++)if((C=w[G]).tileMatrixSet===s.identifier){if(C.tileMatrixSetLimits){for(var S,P={},T=0,x=s.matrixIds.length;T<x;T++)P[s.matrixIds[T].identifier]=s.matrixIds[T];for(T=0,x=C.tileMatrixSetLimits.length;T<x;T++)S=P[C.tileMatrixSetLimits[T].tileMatrix],b.push(S),E(S.scaleDenominator)}else for(T=0,x=s.matrixIds.length;T<x;T++)E(s.matrixIds[T].scaleDenominator);break}I.sort((function(e,t){return t-e}));var M,L=this.getParameterString({SERVICE:"WMTS",REQUEST:"GetTile",VERSION:t.version,LAYER:r.identifier,STYLE:l.identifier,TILEMATRIXSET:s.identifier,FORMAT:u,TILEMATRIX:"{z}",TILEROW:"{y}",TILECOL:"{x}"});M=e.endsWith("?")?GeoGlobe.ProxyHost+e+L:GeoGlobe.ProxyHost+e+"?"+L;var N=GeoGlobe.Util.randomStr(10);if(r.bounds)var R=[r.bounds._sw.lng,r.bounds._sw.lat,r.bounds._ne.lng,r.bounds._ne.lat];else r.BoundingBox&&(R=r.BoundingBox[0].bounds.toBBOX());var O=r.tileMatrixSetLinks[0].tileMatrixSet,D=o.tileMatrixSets[O].matrixIds[0].identifier,F={name:r.identifier,srs:y,bbox:R,format:r.formats,zoomoffset:D};return{id:"layer_"+r.identifier+"_"+N,type:"raster",source:{type:"raster",tiles:[M],tileSize:256},metadata:F,paint:{"raster-opacity":1}}},createLayer:function(e,t){var i=this.getWMTSCapabilities(e);if(t)var r={layer:t.layer};else r={layer:i.contents.layers[0].identifier};return this.createLayerOption(e,i,r)},createLayers:function(e){for(var t=this.getWMTSCapabilities(e),i=t.contents.layers,r=[],o=0;o<i.length;o++){var n={layer:i[o].identifier},a=this.createLayerOption(e,t,n);r.push(a)}return r},getParameterString:function(e){var t=[];for(var i in e){var r=e[i];null!=r&&"function"!=typeof r&&t.push(i+"="+r)}return t.join("&")},CLASS_NAME:"GeoGlobe.Format.WMTS"}),GeoGlobe.Format.WMS=GeoGlobe.Class4OL({initialize:function(e){GeoGlobe.Util.extend(this,e)},getWMSCapabilities:function(e){var t=null;return this.getCapabilities(e,(function(e){var i=e.responseXML;i&&i.documentElement||(i=e.responseText);var r=new GeoGlobe.Format.WMSCapabilities.v1_1_1;t=r.read(i)}),(function(){alert("WMS服务请求失败，请检查服务是否正常运行或请求地址是否正确。\n请求地址："+e+"\n操作类型：GetCapabilities")})),t},getCapabilities:function(e,t,i){"function"!=typeof i&&(i=function(){alert("WMS服务请求失败，请检查服务是否正常运行或请求地址是否正确。\n请求地址："+e+"\n操作类型：GetCapabilities")}),GeoGlobe.Request.GET({url:e,params:{REQUEST:"GetCapabilities",SERVICE:"WMS",VERSION:"1.1.1"},scope:this,async:!1,success:function(e){"function"==typeof t&&t(e)},failure:i})},createLayerOption:function createLayerOption(url,capabilities,config){var layer;if(!("layer"in config))throw new Error("Missing property 'layer' in configuration.");for(var contents=capabilities.capability,layers=contents.layers,layerDef,i=0,ii=contents.layers.length;i<ii;++i)if(contents.layers[i].name===config.layer){layerDef=contents.layers[i];break}if(!layerDef)throw new Error("Layer not found");var format=config.format;if(!format&&layerDef.formats&&layerDef.formats.length){for(var f=0;f<layerDef.formats.length;f++)"image/png"==layerDef.formats[f]&&(format=layerDef.formats[f]);"image/png"!=format&&(format=layerDef.formats[0])}var styles=config.styles;!styles&&layerDef.styles&&layerDef.styles.length&&(styles=layerDef.styles[0].name);var srs=eval(layerDef.srs),SRS;for(var o in srs)SRS=o;var wms_url="",transparent=config.transparent;if(config.isTile){var param=this.getParameterString({SERVICE:"WMS",REQUEST:"GetMap",VERSION:"1.1.1",LAYERS:layerDef.name,styles:styles,FORMAT:format,TRANSPARENT:transparent,BBOX:"{bbox-epsg-3857}",WIDTH:"256",HEIGHT:"256",SRS:SRS});wms_url=url.endsWith("?")?url+param:url+"?"+param,wms_url=GeoGlobe.appendToProxy(wms_url);var randomNum=GeoGlobe.Util.randomStr(10),metadata={name:layerDef.name,srs:SRS,bbox:layerDef.bbox,format:format},layerOption={id:"layer_"+layerDef.name+"_"+randomNum,type:"raster",source:{type:"raster",tiles:[wms_url],tileSize:256},metadata:metadata,paint:{"raster-opacity":1}};return layerOption}return layerOption=new GeoGlobe.Layer.WMS({url:url,layer:layerDef.name,format:format,version:"1.1.1",SRS:SRS,styles:styles,bbox:layerDef.bbox,isTile:!1}),layerOption},createLayer:function(e,t,i){this.url=e,i=!(void 0!==i&&!i);var r=!!(t&&void 0===t.transparent||t.transparent),o=this.getWMSCapabilities(e),n={layer:t&&t.layer?t.layer:o.capability.layers[0].name,transparent:r,isTile:i};return this.createLayerOption(e,o,n)},createLayers:function(e,t,i){i=!(void 0!==i&&!i);for(var r=!!(t&&void 0===t.transparent||t.transparent),o=this.getWMSCapabilities(e),n=o.capability.layers,a=[],s=0;s<n.length;s++){var l={layer:n[s].name,transparent:r,isTile:i},u=this.createLayerOption(e,o,l);a.push(u)}return a},getParameterString:function(e){var t=[];for(var i in e){var r=e[i];null!=r&&"function"!=typeof r&&t.push(i+"="+r)}return t.join("&")},CLASS_NAME:"GeoGlobe.Format.WMS"}),GeoGlobe.Format.VTS=GeoGlobe.Class4OL({initialize:function(e){GeoGlobe.Util.extend(this,e)},getVTSCapabilities:function(e){this.url=e;var t=null;return this.getCapabilities(e,(function(e){var i=e.responseXML;i&&i.documentElement||(i=e.responseText);var r=new GeoGlobe.Format.VTSCapabilities.v1_0_0;t=r.read(i)}),(function(){alert("VTS服务请求失败，请检查服务是否正常运行或请求地址是否正确。\n请求地址："+e+"\n操作类型：GetCapabilities")})),t},getCapabilities:function(e,t,i){"function"!=typeof i&&(i=function(){alert("VTS服务请求失败，请检查服务是否正常运行或请求地址是否正确。\n请求地址："+e+"\n操作类型：GetCapabilities")}),GeoGlobe.Request.GET({url:e,params:{REQUEST:"GetCapabilities",SERVICE:"WMTS"},scope:this,async:!1,success:function(e){"function"==typeof t&&t(e)},failure:i})},createLayerOption:function(e,t,i){if(!("layer"in i))throw new Error("Missing property 'layer' in configuration.");for(var r,o=t.contents,n=(o.layers,0),a=o.layers.length;n<a;++n)if(o.layers[n].identifier===i.layer){r=o.layers[n];break}if(!r)throw new Error("Layer not found");var s,l=i.format;if(!l&&r.formats&&r.formats.length&&(l=r.formats[0]),i.matrixSet)s=o.tileMatrixSets[i.matrixSet];else if(i.projection){n=0;for(var u=r.tileMatrixSetLinks.length;n<u;n++)if(o.tileMatrixSets[r.tileMatrixSetLinks[n].tileMatrixSet].supportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3")===i.projection){s=o.tileMatrixSets[r.tileMatrixSetLinks[n].tileMatrixSet];break}}else 1<=r.tileMatrixSetLinks.length&&(s=o.tileMatrixSets[r.tileMatrixSetLinks[0].tileMatrixSet]);if(!s)throw new Error("matrixSet not found");var h=[];i.styleName&&""!=i.styleName?h[0]=i.styleName:this.GetStyleName((function(e){h=e}));var c=i.requestEncoding;c||(c="KVP",t.operationsMetadata.GetTile.dcp.http);var p=[],d=i.params||{};delete i.params;for(var f=0,g=r.dimensions.length;f<g;f++){var m=r.dimensions[f];p.push(m.identifier),d.hasOwnProperty(m.identifier)||(d[m.identifier]=m.default)}var _,v,C,y=i.projection||s.supportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"),A=i.units||("EPSG:4326"===y?"degrees":"m"),I=[],b=[],w=r.tileMatrixSetLinks,E=function(e){I.push(28e-5*e/GeoGlobe.METERS_PER_INCH/GeoGlobe.INCHES_PER_UNIT[A]),(!_||e<_)&&(_=e),(!v||v<e)&&(v=e)},G=0;for(u=w.length;G<u;G++)if((C=w[G]).tileMatrixSet===s.identifier){if(C.tileMatrixSetLimits){for(var S,P={},T=0,x=s.matrixIds.length;T<x;T++)P[s.matrixIds[T].identifier]=s.matrixIds[T];for(T=0,x=C.tileMatrixSetLimits.length;T<x;T++)S=P[C.tileMatrixSetLimits[T].tileMatrix],b.push(S),E(S.scaleDenominator)}else for(T=0,x=s.matrixIds.length;T<x;T++)E(s.matrixIds[T].scaleDenominator);break}I.sort((function(e,t){return t-e}));var M,L={layers:[],source:{},source_id:"",url:"",url_tmpl:"",layerType:"VTS"},N=this.getParameterString({SERVICE:"WMTS",REQUEST:"GetTile",VERSION:t.version,LAYER:r.identifier,TILEMATRIXSET:s.identifier,FORMAT:"protobuf",TILEMATRIX:"{z}",TILEROW:"{y}",TILECOL:"{x}"});if(L.url=e,M=e.endsWith("?")?GeoGlobe.ProxyHost+e+N:GeoGlobe.ProxyHost+e+"?"+N,L.url_tmpl=M,GeoGlobe.Util.randomStr(10),r.bounds)var R=[r.bounds._sw.lng,r.bounds._sw.lat,r.bounds._ne.lng,r.bounds._ne.lat];else r.BoundingBox&&(R=r.BoundingBox[0].bounds.toBBOX());var O=r.tileMatrixSetLinks[0].tileMatrixSet,D=o.tileMatrixSets[O].matrixIds[0].identifier;return this.GetStyle(h[0],(function(e){if(e.sprite)var t=GeoGlobe.ProxyHost+e.sprite;else t="";if(e.glyphs)var i=GeoGlobe.ProxyHost+e.glyphs;else i="";var o={name:r.identifier,sprite:t,glyphs:i,styleName:e.styleName,srs:y,bbox:R,format:r.formats,zoomoffset:D},n="source_vts_"+GeoGlobe.Util.randomStr(6);if(L.source_id=n,L.source={type:"vector",tiles:[M]},e.styleData)for(var a=0;a<e.styleData.layers.length;a++)e.styleData.layers[a].metadata=o,e.styleData.layers[a].source=n,L.layers[a]=e.styleData.layers[a];else for(a=0;a<e.layers.length;a++)e.layers[a].metadata=o,e.layers[a].source=n,L.layers[a]=e.layers[a]}),(function(){alert("WMTS服务请求失败，请检查服务是否正常运行或请求地址是否正确。\n请求地址："+e+"\n操作类型：GetCapabilities")})),L},createLayer:function(e,t){var i=this.getVTSCapabilities(e);return(t=t||{}).layer=t.layer?t.layer:i.contents.layers[0].identifier,t.styleName=t.styleName?t.styleName:"",this.createLayerOption(e,i,t)},createLayers:function(e){for(var t=this.getVTSCapabilities(e),i=t.contents.layers,r=[],o=0;o<i.length;o++){var n={layer:i[o].identifier},a=this.createLayerOption(e,t,n);r.push(a)}return r},GetStyleName:function(e,t){var i=this.url,r={REQUEST:"GetStyle",SERVICE:"WMTS",VERSION:"1.0.0"};t=t||function(){this.failFn(r.REQUEST)},GeoGlobe.Request.GET({url:i,params:r,scope:this,async:!1,success:function(i){var r=i.responseText;if(!r)return t(),!1;var o=(new GeoGlobe.Format.JSON).read(r),n=[];if(o.style)for(var a=0;a<o.style.length;a++)n.push(o.style[a].styleName);else if(o.styleName)for(var s=0;s<o.styleName.length;s++)n.push(o.styleName[s]);e(n)},failure:t})},GetStyle:function(e,t,i){var r=this.url;if(""!=e&&null!=e){var o={REQUEST:"GetStyle",SERVICE:"WMTS",VERSION:"1.0.0",STYLENAME:e};i=i||function(){this.failFn(o.REQUEST)},GeoGlobe.Request.GET({url:r,params:o,scope:this,async:!1,success:function(e){var r=e.responseText;if(!r)return i(),!1;var o=(new GeoGlobe.Format.JSON).read(r);t(o)},failure:i})}else alert("请查看样式名称是否存在")},getParameterString:function(e){var t=[];for(var i in e){var r=e[i];null!=r&&"function"!=typeof r&&t.push(i+"="+r)}return t.join("&")},CLASS_NAME:"GeoGlobe.Format.VTS"}),GeoGlobe.Format.WMSCapabilities=GeoGlobe.Class4OL(GeoGlobe.Format.XML.VersionedOGC,{defaultVersion:"1.1.1",profile:null,CLASS_NAME:"GeoGlobe.Format.WMSCapabilities"}),GeoGlobe.Format.WMSCapabilities.v1=GeoGlobe.Class4OL(GeoGlobe.Format.XML,{namespaces:{wms:"http://www.opengis.net/wms",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"wms",read:function(e){"string"==typeof e&&(e=GeoGlobe.Format.XML.prototype.read.apply(this,[e]));var t=e;e&&9==e.nodeType&&(e=e.documentElement);var i={};if(this.readNode(e,i),void 0===i.service){var r=new GeoGlobe.Format.OGCExceptionReport;i.error=r.read(t)}return i},readers:{wms:{Service:function(e,t){t.service={},this.readChildNodes(e,t.service)},Name:function(e,t){t.name=this.getChildValue(e)},Title:function(e,t){t.title=this.getChildValue(e)},Abstract:function(e,t){t.abstract=this.getChildValue(e)},BoundingBox:function(e){var t={};t.bbox=[_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(e.getAttribute("minx")),_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(e.getAttribute("miny")),_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(e.getAttribute("maxx")),_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(e.getAttribute("maxy"))];var i={x:_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(e.getAttribute("resx")),y:_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(e.getAttribute("resy"))};return isNaN(i.x)&&isNaN(i.y)||(t.res=i),t},OnlineResource:function(e,t){t.href=this.getAttributeNS(e,this.namespaces.xlink,"href")},ContactInformation:function(e,t){t.contactInformation={},this.readChildNodes(e,t.contactInformation)},ContactPersonPrimary:function(e,t){t.personPrimary={},this.readChildNodes(e,t.personPrimary)},ContactPerson:function(e,t){t.person=this.getChildValue(e)},ContactOrganization:function(e,t){t.organization=this.getChildValue(e)},ContactPosition:function(e,t){t.position=this.getChildValue(e)},ContactAddress:function(e,t){t.contactAddress={},this.readChildNodes(e,t.contactAddress)},AddressType:function(e,t){t.type=this.getChildValue(e)},Address:function(e,t){t.address=this.getChildValue(e)},City:function(e,t){t.city=this.getChildValue(e)},StateOrProvince:function(e,t){t.stateOrProvince=this.getChildValue(e)},PostCode:function(e,t){t.postcode=this.getChildValue(e)},Country:function(e,t){t.country=this.getChildValue(e)},ContactVoiceTelephone:function(e,t){t.phone=this.getChildValue(e)},ContactFacsimileTelephone:function(e,t){t.fax=this.getChildValue(e)},ContactElectronicMailAddress:function(e,t){t.email=this.getChildValue(e)},Fees:function(e,t){var i=this.getChildValue(e);i&&"none"!=i.toLowerCase()&&(t.fees=i)},AccessConstraints:function(e,t){var i=this.getChildValue(e);i&&"none"!=i.toLowerCase()&&(t.accessConstraints=i)},Capability:function(e,t){t.capability={nestedLayers:[],layers:[]},this.readChildNodes(e,t.capability)},Request:function(e,t){t.request={},this.readChildNodes(e,t.request)},GetCapabilities:function(e,t){t.getcapabilities={formats:[]},this.readChildNodes(e,t.getcapabilities)},Format:function(e,t){GeoGlobe.Util.isArray(t.formats)?t.formats.push(this.getChildValue(e)):t.format=this.getChildValue(e)},DCPType:function(e,t){this.readChildNodes(e,t)},HTTP:function(e,t){this.readChildNodes(e,t)},Get:function(e,t){t.get={},this.readChildNodes(e,t.get),t.href||(t.href=t.get.href)},Post:function(e,t){t.post={},this.readChildNodes(e,t.post),t.href||(t.href=t.get.href)},GetMap:function(e,t){t.getmap={formats:[]},this.readChildNodes(e,t.getmap)},GetFeatureInfo:function(e,t){t.getfeatureinfo={formats:[]},this.readChildNodes(e,t.getfeatureinfo)},Exception:function(e,t){t.exception={formats:[]},this.readChildNodes(e,t.exception)},Layer:function(e,t){var i,r;t.capability?(r=t.capability,i=t):r=t;var o=e.getAttributeNode("queryable"),n=o&&o.specified?e.getAttribute("queryable"):null,a=(o=e.getAttributeNode("cascaded"))&&o.specified?e.getAttribute("cascaded"):null,s=(o=e.getAttributeNode("opaque"))&&o.specified?e.getAttribute("opaque"):null,l=e.getAttribute("noSubsets"),u=e.getAttribute("fixedWidth"),h=e.getAttribute("fixedHeight"),c=i||{},p=GeoGlobe.Util.extend,d={nestedLayers:[],styles:i?[].concat(i.styles):[],srs:i?p({},c.srs):{},metadataURLs:[],bbox:i?p({},c.bbox):{},llbbox:c.llbbox,dimensions:i?p({},c.dimensions):{},authorityURLs:i?p({},c.authorityURLs):{},identifiers:{},keywords:[],queryable:n&&""!==n?"1"===n||"true"===n:c.queryable||!1,cascaded:null!==a?_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(a):c.cascaded||0,opaque:s?"1"===s||"true"===s:c.opaque||!1,noSubsets:null!==l?"1"===l||"true"===l:c.noSubsets||!1,fixedWidth:null!=u?_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(u):c.fixedWidth||0,fixedHeight:null!=h?_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(h):c.fixedHeight||0,minScale:c.minScale,maxScale:c.maxScale,attribution:c.attribution};if(t.nestedLayers.push(d),d.capability=r,this.readChildNodes(e,d),delete d.capability,d.name){var f=d.name.split(":"),g=r.request,m=g.getfeatureinfo;0<f.length&&(d.prefix=f[0]),r.layers.push(d),void 0===d.formats&&(d.formats=g.getmap.formats),void 0===d.infoFormats&&m&&(d.infoFormats=m.formats)}},Attribution:function(e,t){t.attribution={},this.readChildNodes(e,t.attribution)},LogoURL:function(e,t){t.logo={width:e.getAttribute("width"),height:e.getAttribute("height")},this.readChildNodes(e,t.logo)},Style:function(e,t){var i={};t.styles.push(i),this.readChildNodes(e,i)},LegendURL:function(e,t){var i={width:e.getAttribute("width"),height:e.getAttribute("height")};t.legend=i,this.readChildNodes(e,i)},MetadataURL:function(e,t){var i={type:e.getAttribute("type")};t.metadataURLs.push(i),this.readChildNodes(e,i)},DataURL:function(e,t){t.dataURL={},this.readChildNodes(e,t.dataURL)},FeatureListURL:function(e,t){t.featureListURL={},this.readChildNodes(e,t.featureListURL)},AuthorityURL:function(e,t){var i=e.getAttribute("name"),r={};this.readChildNodes(e,r),t.authorityURLs[i]=r.href},Identifier:function(e,t){var i=e.getAttribute("authority");t.identifiers[i]=this.getChildValue(e)},KeywordList:function(e,t){this.readChildNodes(e,t)},SRS:function(e,t){t.srs[this.getChildValue(e)]=!0}}},CLASS_NAME:"GeoGlobe.Format.WMSCapabilities.v1"}),GeoGlobe.Format.WMSCapabilities.v1_1=GeoGlobe.Class4OL(GeoGlobe.Format.WMSCapabilities.v1,{readers:{wms:GeoGlobe.Util.applyDefaults({WMT_MS_Capabilities:function(e,t){this.readChildNodes(e,t)},Keyword:function(e,t){t.keywords&&t.keywords.push(this.getChildValue(e))},DescribeLayer:function(e,t){t.describelayer={formats:[]},this.readChildNodes(e,t.describelayer)},GetLegendGraphic:function(e,t){t.getlegendgraphic={formats:[]},this.readChildNodes(e,t.getlegendgraphic)},GetStyles:function(e,t){t.getstyles={formats:[]},this.readChildNodes(e,t.getstyles)},PutStyles:function(e,t){t.putstyles={formats:[]},this.readChildNodes(e,t.putstyles)},UserDefinedSymbolization:function(e,t){var i={supportSLD:1==_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(e.getAttribute("SupportSLD")),userLayer:1==_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(e.getAttribute("UserLayer")),userStyle:1==_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(e.getAttribute("UserStyle")),remoteWFS:1==_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(e.getAttribute("RemoteWFS"))};t.userSymbols=i},LatLonBoundingBox:function(e,t){t.llbbox=[_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(e.getAttribute("minx")),_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(e.getAttribute("miny")),_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(e.getAttribute("maxx")),_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(e.getAttribute("maxy"))]},BoundingBox:function(e,t){var i=GeoGlobe.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[e,t]);i.srs=e.getAttribute("SRS"),t.bbox[i.srs]=i},ScaleHint:function(e,t){var i=e.getAttribute("min"),r=e.getAttribute("max"),o=Math.pow(2,.5),n=GeoGlobe.INCHES_PER_UNIT.m;0!=i&&(t.maxScale=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()((i/o*n*GeoGlobe.DOTS_PER_INCH).toPrecision(13))),r!=Number.POSITIVE_INFINITY&&(t.minScale=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()((r/o*n*GeoGlobe.DOTS_PER_INCH).toPrecision(13)))},Dimension:function(e,t){var i={name:e.getAttribute("name").toLowerCase(),units:e.getAttribute("units"),unitsymbol:e.getAttribute("unitSymbol")};t.dimensions[i.name]=i},Extent:function(e,t){var i=e.getAttribute("name").toLowerCase();if(i in t.dimensions){var r=t.dimensions[i];r.nearestVal="1"===e.getAttribute("nearestValue"),r.multipleVal="1"===e.getAttribute("multipleValues"),r.current="1"===e.getAttribute("current"),r.default=e.getAttribute("default")||"";var o=this.getChildValue(e);r.values=o.split(",")}}},GeoGlobe.Format.WMSCapabilities.v1.prototype.readers.wms)},CLASS_NAME:"GeoGlobe.Format.WMSCapabilities.v1_1"}),GeoGlobe.Format.WMSCapabilities.v1_1_0=GeoGlobe.Class4OL(GeoGlobe.Format.WMSCapabilities.v1_1,{version:"1.1.0",readers:{wms:GeoGlobe.Util.applyDefaults({SRS:function(e,t){for(var i=this.getChildValue(e).split(/ +/),r=0,o=i.length;r<o;r++)t.srs[i[r]]=!0}},GeoGlobe.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"GeoGlobe.Format.WMSCapabilities.v1_1_0"}),GeoGlobe.Format.WMSCapabilities.v1_1_1=GeoGlobe.Class4OL(GeoGlobe.Format.WMSCapabilities.v1_1,{version:"1.1.1",readers:{wms:GeoGlobe.Util.applyDefaults({SRS:function(e,t){t.srs[this.getChildValue(e)]=!0}},GeoGlobe.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"GeoGlobe.Format.WMSCapabilities.v1_1_1"}),GeoGlobe.Format.WMSCapabilities.v1_1_1_WMSC=GeoGlobe.Class4OL(GeoGlobe.Format.WMSCapabilities.v1_1_1,{version:"1.1.1",profile:"WMSC",readers:{wms:GeoGlobe.Util.applyDefaults({VendorSpecificCapabilities:function(e,t){t.vendorSpecific={tileSets:[]},this.readChildNodes(e,t.vendorSpecific)},TileSet:function(e,t){var i={srs:{},bbox:{},resolutions:[]};this.readChildNodes(e,i),t.tileSets.push(i)},Resolutions:function(e,t){for(var i=this.getChildValue(e).split(" "),r=0,o=i.length;r<o;r++)""!=i[r]&&t.resolutions.push(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(i[r]))},Width:function(e,t){t.width=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e))},Height:function(e,t){t.height=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e))},Layers:function(e,t){t.layers=this.getChildValue(e)},Styles:function(e,t){t.styles=this.getChildValue(e)}},GeoGlobe.Format.WMSCapabilities.v1_1_1.prototype.readers.wms)},CLASS_NAME:"GeoGlobe.Format.WMSCapabilities.v1_1_1_WMSC"}),GeoGlobe.Format.WMSCapabilities.v1_3=GeoGlobe.Class4OL(GeoGlobe.Format.WMSCapabilities.v1,{readers:{wms:GeoGlobe.Util.applyDefaults({WMS_Capabilities:function(e,t){this.readChildNodes(e,t)},LayerLimit:function(e,t){t.layerLimit=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e))},MaxWidth:function(e,t){t.maxWidth=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e))},MaxHeight:function(e,t){t.maxHeight=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e))},BoundingBox:function(e,t){var i=GeoGlobe.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[e,t]);i.srs=e.getAttribute("CRS"),t.bbox[i.srs]=i},CRS:function(e,t){this.readers.wms.SRS.apply(this,[e,t])},EX_GeographicBoundingBox:function(e,t){t.llbbox=[],this.readChildNodes(e,t.llbbox)},westBoundLongitude:function(e,t){t[0]=this.getChildValue(e)},eastBoundLongitude:function(e,t){t[2]=this.getChildValue(e)},southBoundLatitude:function(e,t){t[1]=this.getChildValue(e)},northBoundLatitude:function(e,t){t[3]=this.getChildValue(e)},MinScaleDenominator:function(e,t){t.maxScale=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(this.getChildValue(e)).toPrecision(16)},MaxScaleDenominator:function(e,t){t.minScale=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(this.getChildValue(e)).toPrecision(16)},Dimension:function(e,t){var i={name:e.getAttribute("name").toLowerCase(),units:e.getAttribute("units"),unitsymbol:e.getAttribute("unitSymbol"),nearestVal:"1"===e.getAttribute("nearestValue"),multipleVal:"1"===e.getAttribute("multipleValues"),default:e.getAttribute("default")||"",current:"1"===e.getAttribute("current"),values:this.getChildValue(e).split(",")};t.dimensions[i.name]=i},Keyword:function(e,t){var i={value:this.getChildValue(e),vocabulary:e.getAttribute("vocabulary")};t.keywords&&t.keywords.push(i)}},GeoGlobe.Format.WMSCapabilities.v1.prototype.readers.wms),sld:{UserDefinedSymbolization:function(e,t){this.readers.wms.UserDefinedSymbolization.apply(this,[e,t]),t.userSymbols.inlineFeature=1==_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(e.getAttribute("InlineFeature")),t.userSymbols.remoteWCS=1==_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(e.getAttribute("RemoteWCS"))},DescribeLayer:function(e,t){this.readers.wms.DescribeLayer.apply(this,[e,t])},GetLegendGraphic:function(e,t){this.readers.wms.GetLegendGraphic.apply(this,[e,t])}}},CLASS_NAME:"GeoGlobe.Format.WMSCapabilities.v1_3"}),GeoGlobe.Format.WMSCapabilities.v1_3_0=GeoGlobe.Class4OL(GeoGlobe.Format.WMSCapabilities.v1_3,{version:"1.3.0",CLASS_NAME:"GeoGlobe.Format.WMSCapabilities.v1_3_0"}),GeoGlobe.Format.WMTSCapabilities=GeoGlobe.Class4OL(GeoGlobe.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",yx:{"urn:ogc:def:crs:EPSG::4326":!0},createLayer:function(e,t){if(!("layer"in t))throw new Error("Missing property 'layer' in configuration.");for(var i,r=e.contents,o=(r.layers,0),n=r.layers.length;o<n;++o)if(r.layers[o].identifier===t.layer){i=r.layers[o];break}if(!i)throw new Error("Layer not found");var a,s,l=t.format;if(!l&&i.formats&&i.formats.length&&(l=i.formats[0]),t.matrixSet)a=r.tileMatrixSets[t.matrixSet];else if(t.projection){o=0;for(var u=i.tileMatrixSetLinks.length;o<u;o++)if(r.tileMatrixSets[i.tileMatrixSetLinks[o].tileMatrixSet].supportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3")===t.projection){a=r.tileMatrixSets[i.tileMatrixSetLinks[o].tileMatrixSet];break}}else 1<=i.tileMatrixSetLinks.length&&(a=r.tileMatrixSets[i.tileMatrixSetLinks[0].tileMatrixSet]);if(!a)throw new Error("matrixSet not found");for(o=0,n=i.styles.length;o<n&&!(s=i.styles[o]).isDefault;++o);var h=t.requestEncoding;h||(h="KVP",e.operationsMetadata.GetTile.dcp.http);var c=[],p=t.params||{};delete t.params;for(var d=0,f=i.dimensions.length;d<f;d++){var g=i.dimensions[d];c.push(g.identifier),p.hasOwnProperty(g.identifier)||(p[g.identifier]=g.default)}var m,_,v,C,y=t.projection||a.supportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"),A=t.units||("EPSG:4326"===y?"degrees":"m"),I=[],b=[],w=i.tileMatrixSetLinks,E=function(e){I.push(28e-5*e/GeoGlobe.METERS_PER_INCH/GeoGlobe.INCHES_PER_UNIT[A]),(!m||e<m)&&(m=e),(!_||_<e)&&(_=e)},G=0;for(u=w.length;G<u;G++)if((v=w[G]).tileMatrixSet===a.identifier){if(v.tileMatrixSetLimits){for(var S,P={},T=0,x=a.matrixIds.length;T<x;T++)P[a.matrixIds[T].identifier]=a.matrixIds[T];for(T=0,x=v.tileMatrixSetLimits.length;T<x;T++)S=P[v.tileMatrixSetLimits[T].tileMatrix],b.push(S),E(S.scaleDenominator)}else for(T=0,x=a.matrixIds.length;T<x;T++)E(a.matrixIds[T].scaleDenominator);break}if("REST"===h&&i.resourceUrls){C=[],i.resourceUrls;for(var M,L=0,N=i.resourceUrls.length;L<N;++L)(M=i.resourceUrls[L]).format===l&&"tile"===M.resourceType&&C.push(M.template)}else{var R,O=e.operationsMetadata.GetTile.dcp.http.get;for(C=[],o=0,n=O.length;o<n;o++)(!(R=O[o].constraints)||R&&R.GetEncoding.allowedValues[h])&&C.push(O[o].url)}I.sort((function(e,t){return t-e}));var D,F="SERVICE=WMTS&REQUEST=GetTile&VERSION="+e.version+"&LAYER="+i.identifier+"&STYLE="+s.identifier+"&TILEMATRIXSET="+a.identifier+"&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&FORMAT="+l;D=C[0].endsWith("?")?C[0]+F:C[0]+"?"+F;var U=GeoGlobe.Util.applyDefaults(t,{id:i.identifier,url:[D]}),B={id:U.id,layer:{id:U.id,type:"raster",source:U.id},source:{type:"raster",tiles:U.url,tileSize:256}};return B.matrixSet=a,B.identifier=i.identifier,B.bounds=i.bounds,B},CLASS_NAME:"GeoGlobe.Format.WMTSCapabilities"}),GeoGlobe.Format.WMTSCapabilities.v1_0_0=GeoGlobe.Class4OL(GeoGlobe.Format.OWSCommon.v1_1_0,{version:"1.0.0",namespaces:{ows:"http://www.opengis.net/ows/1.1",wmts:"http://www.opengis.net/wmts/1.0",xlink:"http://www.w3.org/1999/xlink"},yx:null,defaultPrefix:"wmts",initialize:function(e){GeoGlobe.Format.XML.prototype.initialize.apply(this,[e]),this.options=e;var t=GeoGlobe.Util.extend({},GeoGlobe.Format.WMTSCapabilities.prototype.yx);this.yx=GeoGlobe.Util.extend(t,this.yx)},read:function(e){"string"==typeof e&&(e=GeoGlobe.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};return this.readNode(e,t),t.version=this.version,t},readers:{wmts:{Capabilities:function(e,t){this.readChildNodes(e,t)},Contents:function(e,t){t.contents={},t.contents.layers=[],t.contents.tileMatrixSets={},this.readChildNodes(e,t.contents)},Layer:function(e,t){var i={styles:[],formats:[],dimensions:[],tileMatrixSetLinks:[]};this.readChildNodes(e,i),t.layers.push(i)},Style:function(e,t){var i={};i.isDefault="true"===e.getAttribute("isDefault"),this.readChildNodes(e,i),t.styles.push(i)},Format:function(e,t){t.formats.push(this.getChildValue(e))},TileMatrixSetLink:function(e,t){var i={};this.readChildNodes(e,i),t.tileMatrixSetLinks.push(i)},TileMatrixSet:function(e,t){if(t.layers){var i={matrixIds:[]};this.readChildNodes(e,i),t.tileMatrixSets[i.identifier]=i}else t.tileMatrixSet=this.getChildValue(e)},TileMatrixSetLimits:function(e,t){t.tileMatrixSetLimits=[],this.readChildNodes(e,t)},TileMatrixLimits:function(e,t){var i={};this.readChildNodes(e,i),t.tileMatrixSetLimits.push(i)},MinTileRow:function(e,t){t.minTileRow=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e))},MaxTileRow:function(e,t){t.maxTileRow=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e))},MinTileCol:function(e,t){t.minTileCol=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e))},MaxTileCol:function(e,t){t.maxTileCol=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e))},TileMatrix:function(e,t){if(t.identifier){var i={supportedCRS:t.supportedCRS};this.readChildNodes(e,i),t.matrixIds.push(i)}else t.tileMatrix=this.getChildValue(e)},ScaleDenominator:function(e,t){t.scaleDenominator=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(this.getChildValue(e))},TopLeftCorner:function(e,t){var i,r=this.getChildValue(e).split(" ");if(t.supportedCRS){var o=t.supportedCRS.replace(/urn:ogc:def:crs:(\w+):.+:(\w+)$/,"urn:ogc:def:crs:$1::$2");i=!!this.yx[o]}t.topLeftCorner=i?new GeoGlobe.LngLat(r[1],r[0]):new GeoGlobe.LngLat(r[0],r[1])},TileWidth:function(e,t){t.tileWidth=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e))},TileHeight:function(e,t){t.tileHeight=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e))},MatrixWidth:function(e,t){t.matrixWidth=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e))},MatrixHeight:function(e,t){t.matrixHeight=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e))},ResourceURL:function(e,t){t.resourceUrl=t.resourceUrl||{};var i=e.getAttribute("resourceType");t.resourceUrls||(t.resourceUrls=[]);var r=t.resourceUrl[i]={format:e.getAttribute("format"),template:e.getAttribute("template"),resourceType:i};t.resourceUrls.push(r)},LegendURL:function(e,t){t.legends=t.legends||[];var i={format:e.getAttribute("format"),href:e.getAttribute("xlink:href")},r=e.getAttribute("width"),o=e.getAttribute("height"),n=e.getAttribute("minScaleDenominator"),a=e.getAttribute("maxScaleDenominator");null!==r&&(i.width=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(r)),null!==o&&(i.height=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(o)),null!==n&&(i.minScaleDenominator=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(n)),null!==a&&(i.maxScaleDenominator=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(a)),t.legends.push(i)},InfoFormat:function(e,t){t.infoFormats=t.infoFormats||[],t.infoFormats.push(this.getChildValue(e))},WSDL:function(e,t){t.wsdl={},t.wsdl.href=e.getAttribute("xlink:href")},ServiceMetadataURL:function(e,t){t.serviceMetadataUrl={},t.serviceMetadataUrl.href=e.getAttribute("xlink:href")},Dimension:function(e,t){var i={values:[]};this.readChildNodes(e,i),t.dimensions.push(i)},Default:function(e,t){t.default=this.getChildValue(e)},Value:function(e,t){t.values.push(this.getChildValue(e))}},ows:GeoGlobe.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"GeoGlobe.Format.WMTSCapabilities.v1_0_0"}),GeoGlobe.Format.VTSCapabilities=GeoGlobe.Class4OL(GeoGlobe.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",yx:{"urn:ogc:def:crs:EPSG::4326":!0},createLayer:function(e,t){if(!("layer"in t))throw new Error("Missing property 'layer' in configuration.");for(var i,r=e.contents,o=(r.layers,0),n=r.layers.length;o<n;++o)if(r.layers[o].identifier===t.layer){i=r.layers[o];break}if(!i)throw new Error("Layer not found");var a,s,l=t.format;if(!l&&i.formats&&i.formats.length&&(l=i.formats[0]),t.matrixSet)a=r.tileMatrixSets[t.matrixSet];else if(t.projection){o=0;for(var u=i.tileMatrixSetLinks.length;o<u;o++)if(r.tileMatrixSets[i.tileMatrixSetLinks[o].tileMatrixSet].supportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3")===t.projection){a=r.tileMatrixSets[i.tileMatrixSetLinks[o].tileMatrixSet];break}}else 1<=i.tileMatrixSetLinks.length&&(a=r.tileMatrixSets[i.tileMatrixSetLinks[0].tileMatrixSet]);if(!a)throw new Error("matrixSet not found");for(o=0,n=i.styles.length;o<n&&!(s=i.styles[o]).isDefault;++o);var h=t.requestEncoding;h||(h="KVP",e.operationsMetadata.GetTile.dcp.http);var c=[],p=t.params||{};delete t.params;for(var d=0,f=i.dimensions.length;d<f;d++){var g=i.dimensions[d];c.push(g.identifier),p.hasOwnProperty(g.identifier)||(p[g.identifier]=g.default)}var m,_,v,C,y=t.projection||a.supportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"),A=t.units||("EPSG:4326"===y?"degrees":"m"),I=[],b=[],w=i.tileMatrixSetLinks,E=function(e){I.push(28e-5*e/GeoGlobe.METERS_PER_INCH/GeoGlobe.INCHES_PER_UNIT[A]),(!m||e<m)&&(m=e),(!_||_<e)&&(_=e)},G=0;for(u=w.length;G<u;G++)if((v=w[G]).tileMatrixSet===a.identifier){if(v.tileMatrixSetLimits){for(var S,P={},T=0,x=a.matrixIds.length;T<x;T++)P[a.matrixIds[T].identifier]=a.matrixIds[T];for(T=0,x=v.tileMatrixSetLimits.length;T<x;T++)S=P[v.tileMatrixSetLimits[T].tileMatrix],b.push(S),E(S.scaleDenominator)}else for(T=0,x=a.matrixIds.length;T<x;T++)E(a.matrixIds[T].scaleDenominator);break}if("REST"===h&&i.resourceUrls){C=[],i.resourceUrls;for(var M,L=0,N=i.resourceUrls.length;L<N;++L)(M=i.resourceUrls[L]).format===l&&"tile"===M.resourceType&&C.push(M.template)}else{var R,O=e.operationsMetadata.GetTile.dcp.http.get;for(C=[],o=0,n=O.length;o<n;o++)(!(R=O[o].constraints)||R&&R.GetEncoding.allowedValues[h])&&C.push(O[o].url)}I.sort((function(e,t){return t-e}));var D,F="SERVICE=WMTS&REQUEST=GetTile&VERSION="+e.version+"&LAYER="+i.identifier+"&STYLE="+s.identifier+"&TILEMATRIXSET="+a.identifier+"&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&FORMAT="+l;D=C[0].endsWith("?")?C[0]+F:C[0]+"?"+F;var U=GeoGlobe.Util.applyDefaults(t,{id:i.identifier,url:[D]}),B=new GeoGlobe.Layer.VTS(U);return B.matrixSet=a,B.identifier=i.identifier,B.bounds=i.bounds,B},CLASS_NAME:"GeoGlobe.Format.VTSCapabilities"}),GeoGlobe.Format.VTSCapabilities.v1_0_0=GeoGlobe.Class4OL(GeoGlobe.Format.OWSCommon.v1_1_0,{version:"1.0.0",namespaces:{ows:"http://www.opengis.net/ows/1.1",wmts:"http://www.opengis.net/wmts/1.0",xlink:"http://www.w3.org/1999/xlink"},yx:null,defaultPrefix:"wmts",initialize:function(e){GeoGlobe.Format.XML.prototype.initialize.apply(this,[e]),this.options=e;var t=GeoGlobe.Util.extend({},GeoGlobe.Format.VTSCapabilities.prototype.yx);this.yx=GeoGlobe.Util.extend(t,this.yx)},read:function(e){"string"==typeof e&&(e=GeoGlobe.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};return this.readNode(e,t),t.version=this.version,t},readers:{wmts:{Capabilities:function(e,t){this.readChildNodes(e,t)},Contents:function(e,t){t.contents={},t.contents.layers=[],t.contents.tileMatrixSets={},this.readChildNodes(e,t.contents)},Layer:function(e,t){var i={styles:[],formats:[],dimensions:[],tileMatrixSetLinks:[]};this.readChildNodes(e,i),t.layers.push(i)},Style:function(e,t){var i={};i.isDefault="true"===e.getAttribute("isDefault"),this.readChildNodes(e,i),t.styles.push(i)},Format:function(e,t){t.formats.push(this.getChildValue(e))},TileMatrixSetLink:function(e,t){var i={};this.readChildNodes(e,i),t.tileMatrixSetLinks.push(i)},TileMatrixSet:function(e,t){if(t.layers){var i={matrixIds:[]};this.readChildNodes(e,i),t.tileMatrixSets[i.identifier]=i}else t.tileMatrixSet=this.getChildValue(e)},TileMatrixSetLimits:function(e,t){t.tileMatrixSetLimits=[],this.readChildNodes(e,t)},TileMatrixLimits:function(e,t){var i={};this.readChildNodes(e,i),t.tileMatrixSetLimits.push(i)},MinTileRow:function(e,t){t.minTileRow=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e))},MaxTileRow:function(e,t){t.maxTileRow=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e))},MinTileCol:function(e,t){t.minTileCol=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e))},MaxTileCol:function(e,t){t.maxTileCol=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e))},TileMatrix:function(e,t){if(t.identifier){var i={supportedCRS:t.supportedCRS};this.readChildNodes(e,i),t.matrixIds.push(i)}else t.tileMatrix=this.getChildValue(e)},ScaleDenominator:function(e,t){t.scaleDenominator=_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(this.getChildValue(e))},TopLeftCorner:function(e,t){var i,r=this.getChildValue(e).split(" ");if(t.supportedCRS){var o=t.supportedCRS.replace(/urn:ogc:def:crs:(\w+):.+:(\w+)$/,"urn:ogc:def:crs:$1::$2");i=!!this.yx[o]}t.topLeftCorner=i?new GeoGlobe.LngLat(r[1],r[0]):new GeoGlobe.LngLat(r[0],r[1])},TileWidth:function(e,t){t.tileWidth=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e))},TileHeight:function(e,t){t.tileHeight=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e))},MatrixWidth:function(e,t){t.matrixWidth=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e))},MatrixHeight:function(e,t){t.matrixHeight=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(this.getChildValue(e))},ResourceURL:function(e,t){t.resourceUrl=t.resourceUrl||{};var i=e.getAttribute("resourceType");t.resourceUrls||(t.resourceUrls=[]);var r=t.resourceUrl[i]={format:e.getAttribute("format"),template:e.getAttribute("template"),resourceType:i};t.resourceUrls.push(r)},LegendURL:function(e,t){t.legends=t.legends||[];var i={format:e.getAttribute("format"),href:e.getAttribute("xlink:href")},r=e.getAttribute("width"),o=e.getAttribute("height"),n=e.getAttribute("minScaleDenominator"),a=e.getAttribute("maxScaleDenominator");null!==r&&(i.width=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(r)),null!==o&&(i.height=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(o)),null!==n&&(i.minScaleDenominator=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(n)),null!==a&&(i.maxScaleDenominator=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(a)),t.legends.push(i)},InfoFormat:function(e,t){t.infoFormats=t.infoFormats||[],t.infoFormats.push(this.getChildValue(e))},WSDL:function(e,t){t.wsdl={},t.wsdl.href=e.getAttribute("xlink:href")},ServiceMetadataURL:function(e,t){t.serviceMetadataUrl={},t.serviceMetadataUrl.href=e.getAttribute("xlink:href")},Dimension:function(e,t){var i={values:[]};this.readChildNodes(e,i),t.dimensions.push(i)},Default:function(e,t){t.default=this.getChildValue(e)},Value:function(e,t){t.values.push(this.getChildValue(e))}},ows:GeoGlobe.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"GeoGlobe.Format.VTSCapabilities.v1_0_0"}),GeoGlobe.Format.WPSCapabilities=GeoGlobe.Class4OL(GeoGlobe.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"GeoGlobe.Format.WPSCapabilities"}),GeoGlobe.Format.WPSCapabilities.v1_0_0=GeoGlobe.Class4OL(GeoGlobe.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",wps:"http://www.opengis.net/wps/1.0.0",xlink:"http://www.w3.org/1999/xlink"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(e){GeoGlobe.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){"string"==typeof e&&(e=GeoGlobe.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};return this.readNode(e,t),t},readers:{wps:{Capabilities:function(e,t){this.readChildNodes(e,t)},ProcessOfferings:function(e,t){t.processOfferings={},this.readChildNodes(e,t.processOfferings)},Process:function(e,t){var i={processVersion:this.getAttributeNS(e,this.namespaces.wps,"processVersion")};this.readChildNodes(e,i),t[i.identifier]=i},Languages:function(e,t){t.languages=[],this.readChildNodes(e,t.languages)},Default:function(e,t){var i={isDefault:!0};this.readChildNodes(e,i),t.push(i)},Supported:function(e,t){var i={};this.readChildNodes(e,i),t.push(i)}},ows:GeoGlobe.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"GeoGlobe.Format.WPSCapabilities.v1_0_0"}),GeoGlobe.Format.WCSGetCoverage=GeoGlobe.Class4OL(GeoGlobe.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",wcs:"http://www.opengis.net/wcs/1.1",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.1.2",schemaLocation:"http://www.opengis.net/wcs/1.1 http://schemas.opengis.net/wcs/1.1/wcsGetCoverage.xsd",write:function(e){var t=this.writeNode("wcs:GetCoverage",e);return this.setAttributeNS(t,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),GeoGlobe.Format.XML.prototype.write.apply(this,[t])},writers:{wcs:{GetCoverage:function(e){var t=this.createElementNSPlus("wcs:GetCoverage",{attributes:{version:e.version||this.VERSION,service:"WCS"}});return this.writeNode("ows:Identifier",e.identifier,t),this.writeNode("wcs:DomainSubset",e.domainSubset,t),this.writeNode("wcs:Output",e.output,t),t},DomainSubset:function(e){var t=this.createElementNSPlus("wcs:DomainSubset",{});return this.writeNode("ows:BoundingBox",e.boundingBox,t),e.temporalSubset&&this.writeNode("wcs:TemporalSubset",e.temporalSubset,t),t},TemporalSubset:function(e){for(var t=this.createElementNSPlus("wcs:TemporalSubset",{}),i=0,r=e.timePeriods.length;i<r;++i)this.writeNode("wcs:TimePeriod",e.timePeriods[i],t);return t},TimePeriod:function(e){var t=this.createElementNSPlus("wcs:TimePeriod",{});return this.writeNode("wcs:BeginPosition",e.begin,t),this.writeNode("wcs:EndPosition",e.end,t),e.resolution&&this.writeNode("wcs:TimeResolution",e.resolution,t),t},BeginPosition:function(e){return this.createElementNSPlus("wcs:BeginPosition",{value:e})},EndPosition:function(e){return this.createElementNSPlus("wcs:EndPosition",{value:e})},TimeResolution:function(e){return this.createElementNSPlus("wcs:TimeResolution",{value:e})},Output:function(e){var t=this.createElementNSPlus("wcs:Output",{attributes:{format:e.format,store:e.store}});return e.gridCRS&&this.writeNode("wcs:GridCRS",e.gridCRS,t),t},GridCRS:function(e){var t=this.createElementNSPlus("wcs:GridCRS",{});return this.writeNode("wcs:GridBaseCRS",e.baseCRS,t),e.type&&this.writeNode("wcs:GridType",e.type,t),e.origin&&this.writeNode("wcs:GridOrigin",e.origin,t),this.writeNode("wcs:GridOffsets",e.offsets,t),e.CS&&this.writeNode("wcs:GridCS",e.CS,t),t},GridBaseCRS:function(e){return this.createElementNSPlus("wcs:GridBaseCRS",{value:e})},GridOrigin:function(e){return this.createElementNSPlus("wcs:GridOrigin",{value:e})},GridType:function(e){return this.createElementNSPlus("wcs:GridType",{value:e})},GridOffsets:function(e){return this.createElementNSPlus("wcs:GridOffsets",{value:e})},GridCS:function(e){return this.createElementNSPlus("wcs:GridCS",{value:e})}},ows:GeoGlobe.Format.OWSCommon.v1_1_0.prototype.writers.ows},CLASS_NAME:"GeoGlobe.Format.WCSGetCoverage"}),GeoGlobe.Format.WPSExecute=GeoGlobe.Class4OL(GeoGlobe.Format.XML,GeoGlobe.Format.Filter.v1_1_0,{namespaces:{ows:"http://www.opengis.net/ows/1.1",gml:"http://www.opengis.net/gml",wps:"http://www.opengis.net/wps/1.0.0",wfs:"http://www.opengis.net/wfs",ogc:"http://www.opengis.net/ogc",wcs:"http://www.opengis.net/wcs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd",schemaLocationAttr:function(){},write:function(e){var t;GeoGlobe.Format.XML.supportActiveX?(t=new ActiveXObject("Microsoft.XMLDOM"),this.xmldom=t):t=document.implementation.createDocument("","",null);var i=this.writeNode("wps:Execute",e,t);return this.setAttributeNS(i,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),GeoGlobe.Format.XML.prototype.write.apply(this,[i])},read:function(e){"string"==typeof e&&(e=GeoGlobe.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};return this.readNode(e,t),t},writers:{wps:{Execute:function(e){var t=this.createElementNSPlus("wps:Execute",{attributes:{version:this.VERSION,service:"WPS"}});return this.writeNode("ows:Identifier",e.identifier,t),this.writeNode("wps:DataInputs",e.dataInputs,t),this.writeNode("wps:ResponseForm",e.responseForm,t),t},ResponseForm:function(e){var t=this.createElementNSPlus("wps:ResponseForm",{});return e.rawDataOutput&&this.writeNode("wps:RawDataOutput",e.rawDataOutput,t),e.responseDocument&&this.writeNode("wps:ResponseDocument",e.responseDocument,t),t},ResponseDocument:function(e){var t=this.createElementNSPlus("wps:ResponseDocument",{attributes:{storeExecuteResponse:e.storeExecuteResponse,lineage:e.lineage,status:e.status}});if(e.outputs)for(var i=0,r=e.outputs.length;i<r;i++)this.writeNode("wps:Output",e.outputs[i],t);return t},Output:function(e){var t=this.createElementNSPlus("wps:Output",{attributes:{asReference:e.asReference,mimeType:e.mimeType,encoding:e.encoding,schema:e.schema}});return this.writeNode("ows:Identifier",e.identifier,t),this.writeNode("ows:Title",e.title,t),this.writeNode("ows:Abstract",e.abstract,t),t},RawDataOutput:function(e){var t=this.createElementNSPlus("wps:RawDataOutput",{attributes:{mimeType:e.mimeType,encoding:e.encoding,schema:e.schema}});return this.writeNode("ows:Identifier",e.identifier,t),t},DataInputs:function(e){for(var t=this.createElementNSPlus("wps:DataInputs",{}),i=0,r=e.length;i<r;++i)this.writeNode("wps:Input",e[i],t);return t},Input:function(e){var t=this.createElementNSPlus("wps:Input",{});return this.writeNode("ows:Identifier",e.identifier,t),e.title&&this.writeNode("ows:Title",e.title,t),e.data&&this.writeNode("wps:Data",e.data,t),e.reference&&this.writeNode("wps:Reference",e.reference,t),e.boundingBoxData&&this.writeNode("wps:BoundingBoxData",e.boundingBoxData,t),t},Data:function(e){var t=this.createElementNSPlus("wps:Data",{});return e.literalData?this.writeNode("wps:LiteralData",e.literalData,t):e.complexData?this.writeNode("wps:ComplexData",e.complexData,t):e.boundingBoxData&&this.writeNode("ows:BoundingBox",e.boundingBoxData,t),t},LiteralData:function(e){return this.createElementNSPlus("wps:LiteralData",{attributes:{uom:e.uom},value:e.value})},ComplexData:function(e){var t=this.createElementNSPlus("wps:ComplexData",{attributes:{mimeType:e.mimeType,encoding:e.encoding,schema:e.schema}}),i=e.value;return"string"==typeof i?t.appendChild(this.getXMLDoc().createCDATASection(e.value)):t.appendChild(i),t},Reference:function(e){var t=this.createElementNSPlus("wps:Reference",{attributes:{mimeType:e.mimeType,"xlink:href":e.href,method:e.method,encoding:e.encoding,schema:e.schema}});return e.body&&this.writeNode("wps:Body",e.body,t),t},BoundingBoxData:function(e,t){this.writers.ows.BoundingBox.apply(this,[e,t,"wps:BoundingBoxData"])},Body:function(e){var t=this.createElementNSPlus("wps:Body",{});return e.wcs?this.writeNode("wcs:GetCoverage",e.wcs,t):e.wfs?(this.featureType=e.wfs.featureType,this.version=e.wfs.version,this.writeNode("wfs:GetFeature",e.wfs,t)):this.writeNode("wps:Execute",e,t),t}},wcs:GeoGlobe.Format.WCSGetCoverage.prototype.writers.wcs,wfs:GeoGlobe.Format.WFST.v1_1_0.prototype.writers.wfs,ogc:GeoGlobe.Format.Filter.v1_1_0.prototype.writers.ogc,ows:GeoGlobe.Format.OWSCommon.v1_1_0.prototype.writers.ows},readers:{wps:{ExecuteResponse:function(e,t){t.executeResponse={lang:e.getAttribute("lang"),statusLocation:e.getAttribute("statusLocation"),serviceInstance:e.getAttribute("serviceInstance"),service:e.getAttribute("service")},this.readChildNodes(e,t.executeResponse)},Process:function(e,t){t.process={},this.readChildNodes(e,t.process)},Status:function(e,t){t.status={creationTime:e.getAttribute("creationTime")},this.readChildNodes(e,t.status)},ProcessSucceeded:function(e,t){t.processSucceeded=!0},ProcessOutputs:function(e,t){t.processOutputs=[],this.readChildNodes(e,t.processOutputs)},Output:function(e,t){var i={};this.readChildNodes(e,i),t.push(i)},Reference:function(e,t){t.reference={href:e.getAttribute("href"),mimeType:e.getAttribute("mimeType"),encoding:e.getAttribute("encoding"),schema:e.getAttribute("schema")}},Data:function(e,t){t.data={},this.readChildNodes(e,t)},LiteralData:function(e,t){t.literalData={dataType:e.getAttribute("dataType"),uom:e.getAttribute("uom"),value:this.getChildValue(e)}},ComplexData:function(e,t){var i;if(t.complexData={mimeType:e.getAttribute("mimeType"),schema:e.getAttribute("schema"),encoding:e.getAttribute("encoding"),value:""},this.isSimpleContent(e))for(i=e.firstChild;i;i=i.nextSibling)switch(i.nodeType){case 3:case 4:t.complexData.value+=i.nodeValue}else for(i=e.firstChild;i;i=i.nextSibling)1==i.nodeType&&(t.complexData.value=i)},BoundingBox:function(e,t){t.boundingBoxData={dimensions:e.getAttribute("dimensions"),crs:e.getAttribute("crs")},this.readChildNodes(e,t.boundingBoxData)}},ows:GeoGlobe.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"GeoGlobe.Format.WPSExecute"}),GeoGlobe.Format.OGCExceptionReport=GeoGlobe.Class4OL(GeoGlobe.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},defaultPrefix:"ogc",read:function(e){"string"==typeof e&&(e=GeoGlobe.Format.XML.prototype.read.apply(this,[e]));var t={exceptionReport:null};return e.documentElement&&(this.readChildNodes(e,t),null===t.exceptionReport&&(t=(new GeoGlobe.Format.OWSCommon).read(e))),t},readers:{ogc:{ServiceExceptionReport:function(e,t){t.exceptionReport={exceptions:[]},this.readChildNodes(e,t.exceptionReport)},ServiceException:function(e,t){var i={code:e.getAttribute("code"),locator:e.getAttribute("locator"),text:this.getChildValue(e)};t.exceptions.push(i)}}},CLASS_NAME:"GeoGlobe.Format.OGCExceptionReport"}),GeoGlobe.Format.QueryStringFilter=(l={},l[GeoGlobe.Filter.Comparison.EQUAL_TO]="eq",l[GeoGlobe.Filter.Comparison.NOT_EQUAL_TO]="ne",l[GeoGlobe.Filter.Comparison.LESS_THAN]="lt",l[GeoGlobe.Filter.Comparison.LESS_THAN_OR_EQUAL_TO]="lte",l[GeoGlobe.Filter.Comparison.GREATER_THAN]="gt",l[GeoGlobe.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO]="gte",l[GeoGlobe.Filter.Comparison.LIKE]="ilike",GeoGlobe.Class4OL(GeoGlobe.Format,{wildcarded:!1,srsInBBOX:!1,write:function(e,t){t=t||{};var i=e.CLASS_NAME,r=i.substring(i.lastIndexOf(".")+1);switch(r){case"Spatial":switch(e.type){case GeoGlobe.Filter.Spatial.BBOX:t.bbox=e.value.toArray(),this.srsInBBOX&&e.projection&&t.bbox.push(e.projection.getCode());break;case GeoGlobe.Filter.Spatial.DWITHIN:t.tolerance=e.distance;case GeoGlobe.Filter.Spatial.WITHIN:t.lon=e.value.x,t.lat=e.value.y;break;default:GeoGlobe.Console.warn("Unknown spatial filter type "+e.type)}break;case"Comparison":var o=l[e.type];if(void 0!==o){var n=e.value;e.type==GeoGlobe.Filter.Comparison.LIKE&&(n=function(e){return(e=(e=(e=(e=(e=(e=e.replace(/%/g,"\\%")).replace(/\\\\\.(\*)?/g,(function(e,t){return t?e:"\\\\_"}))).replace(/\\\\\.\*/g,"\\\\%")).replace(/(\\)?\.(\*)?/g,(function(e,t,i){return t||i?e:"_"}))).replace(/(\\)?\.\*/g,(function(e,t){return t?e:"%"}))).replace(/\\\./g,".")).replace(/(\\)?\\\*/g,(function(e,t){return t?e:"*"}))}(n),this.wildcarded&&(n="%"+n+"%")),t[e.property+"__"+o]=n,t.queryable=t.queryable||[],t.queryable.push(e.property)}else GeoGlobe.Console.warn("Unknown comparison filter type "+e.type);break;case"Logical":if(e.type===GeoGlobe.Filter.Logical.AND)for(var a=0,s=e.filters.length;a<s;a++)t=this.write(e.filters[a],t);else GeoGlobe.Console.warn("Unsupported logical filter type "+e.type);break;default:GeoGlobe.Console.warn("Unknown filter type "+r)}return t},CLASS_NAME:"GeoGolobe.Format.QueryStringFilter"})),GeoGlobe.Format.BusCapabilities=GeoGlobe.Class4OL(GeoGlobe.Format.XML,{tagName:"NETWORK_Capabilities",read:function(e){var t;"string"==typeof e&&(e=GeoGlobe.Format.XML.prototype.read.apply(this,[e]));var i={};return 0<(t=e.nodeName!=this.tagName?e.getElementsByTagName(this.tagName):[e]).length&&this.runChildNodes(i,t[0]),i},runChildNodes:function(e,t,i){for(var r,o,n=t.childNodes,a=0;a<n.length;++a)1==(r=n[a]).nodeType&&(o=i?this["read_"+i+"_"+r.nodeName]:this["read_"+r.nodeName])&&o.apply(this,[e,r])},read_Service:function(e,t){var i={};this.runChildNodes(i,t,"Service"),e.service=i},read_Service_Name:function(e,t){var i=this.getChildValue(t);i&&(e.name=i)},read_Service_Title:function(e,t){var i=this.getChildValue(t);i&&(e.title=i)},read_Service_Abstract:function(e,t){var i=this.getChildValue(t);i&&(e.serviceAbstract=i)},read_Service_KeywordList:function(){},read_Service_OnlineResource:function(e,t){var i=this.getChildValue(t);e&&(e.onlineResource=i)},read_Capability:function(e,t){var i={};this.runChildNodes(i,t,"Capability"),e.capability=i},read_Capability_Request:function(e,t){var i={};this.runChildNodes(i,t,"Capability_Request"),e.request=i},read_Capability_Request_GetCapabilities:function(e,t){var i=t.getElementsByTagName("HTTP"),r={};i[0]&&this.runChildNodes(r,i[0],"Capability_Request_GetCapabilities_DCPType_HTTP"),e.getCapabilities=r},read_Capability_Request_GetCapabilities_DCPType_HTTP_Get:function(e,t){var i=t.getAttribute("onlineResource");i&&(e.getUrl=i)},read_Capability_Request_GetCapabilities_DCPType_HTTP_Post:function(e,t){var i=t.getAttribute("onlineResource");i&&(e.postUrl=i)},read_Capability_Request_queryStation:function(e,t){var i=t.getElementsByTagName("HTTP"),r={};i[0]&&this.runChildNodes(r,i[0],"Capability_Request_queryStation_DCPType_HTTP"),e.queryStation=r},read_Capability_Request_queryStation_DCPType_HTTP_Get:function(e,t){var i=t.getAttribute("onlineResource");i&&(e.getUrl=i)},read_Capability_Request_queryStation_DCPType_HTTP_Post:function(e,t){var i=t.getAttribute("onlineResource");i&&(e.postUrl=i)},read_Capability_Request_queryLine:function(e,t){var i=t.getElementsByTagName("HTTP"),r={};i[0]&&this.runChildNodes(r,i[0],"Capability_Request_queryLine_DCPType_HTTP"),e.queryLine=r},read_Capability_Request_queryLine_DCPType_HTTP_Get:function(e,t){var i=t.getAttribute("onlineResource");i&&(e.getUrl=i)},read_Capability_Request_queryLine_DCPType_HTTP_Post:function(e,t){var i=t.getAttribute("onlineResource");i&&(e.postUrl=i)},read_Capability_Request_queryChange:function(e,t){var i=t.getElementsByTagName("HTTP");i[0]&&this.runChildNodes({},i[0],"Capability_Request_queryChange_DCPType_HTTP")},read_Capability_Request_queryChange_DCPType_HTTP_Get:function(e,t){var i=t.getAttribute("onlineResource");i&&(e.getUrl=i)},read_Capability_Request_queryChange_DCPType_HTTP_Post:function(e,t){var i=t.getAttribute("onlineResource");i&&(e.postUrl=i)},read_Capability_Networks:function(e,t){for(var i=t.getElementsByTagName("Name"),r=[],o=0;o<i.length;o++){var n=this.getChildValue(i[o]);n&&r.push(n)}e.networks=r},CLASS_NAME:"GeoGlobe.Format.BusCapabilities"});var _typeof="function"==typeof _babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14___default.a&&"symbol"==_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_13___default()(_babel_runtime_corejs2_core_js_symbol_iterator__WEBPACK_IMPORTED_MODULE_12___default.a)?function(e){return _babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_13___default()(e)}:function(e){return e&&"function"==typeof _babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14___default.a&&e.constructor===_babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14___default.a&&e!==_babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14___default.a.prototype?"symbol":_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_13___default()(e)};GeoGlobe.Format.XML2JSON=GeoGlobe.Class4OL({initialize:function(){},read:function(e,t,i){t=t||"",e=(e=e.replace(/\s*\/>/g,"/>")).replace(/<\?[^>]*>/g,"").replace(/<\![^>]*>/g,""),t.sort||(t=t.split(","));var r=this.no_fast_endings(e);r=this.attris_to_tags(r),r=(r=escape(r)).split("%3C").join("<").split("%3E").join(">").split("%3D").join("=").split("%22").join('"');for(var o=0;o<t.length;o++)r=(r=r.replace(new RegExp("<"+t[o]+">","g"),"*$**"+t[o]+"**$*")).replace(new RegExp("</"+t[o]+">","g"),"*$***"+t[o]+"**$*");r="<JSONTAGWRAPPER>"+r+"</JSONTAGWRAPPER>",this.xmlobject={};var n=this.xml_to_object(r).JSONTAGWRAPPER;return i&&(n=this.show_json_structure(n,i)),n},xml_to_object:function xml_to_object(xmlcode){var x=xmlcode.replace(/<\//g,"?");x=x.split("<");for(var y=[],level=0,opentags=[],i=1;i<x.length;i++){var tagname=x[i].split(">")[0];for(opentags.push(tagname),level++,y.push(level+"<"+x[i].split("?")[0]);0<=x[i].indexOf("?"+opentags[opentags.length-1]+">");)level--,opentags.pop()}for(var oldniva=-1,objname="this.xmlobject",i=0;i<y.length;i++){var preeval="",niva=y[i].split("<")[0],tagnamn=y[i].split("<")[1].split(">")[0];tagnamn=tagnamn.replace(/%3A/,"_");var rest=y[i].split(">")[1];if(niva<=oldniva)for(var tabort=oldniva-niva+1,j=0;j<tabort;j++)objname=objname.substring(0,objname.lastIndexOf("."));objname+="."+tagnamn;var pobject=objname.substring(0,objname.lastIndexOf("."));"object"!=eval("typeof "+pobject)&&(preeval+=pobject+"={value:"+pobject+"};\n");var objlast=objname.substring(objname.lastIndexOf(".")+1),already=!1;for(k in eval(pobject))k==objlast&&(already=!0);for(var onlywhites=!0,s=0;s<rest.length;s+=3)"%"!=rest.charAt(s)&&(onlywhites=!1);""==rest||onlywhites?rest="{}":rest/1!=rest&&(rest="'"+rest.replace(/\'/g,"\\'")+"'",rest=rest.replace(/\*\$\*\*\*/g,"</"),rest=rest.replace(/\*\$\*\*/g,"<"),rest=rest.replace(/\*\*\$\*/g,">")),"'"==rest.charAt(0)&&(rest="unescape("+rest+")"),already&&!eval(objname+".sort")&&(preeval+=objname+"=["+objname+"];\n");var before="=";after="",already&&(before=".push(",after=")");var toeval=preeval+objname+before+rest+after;eval(toeval),eval(objname+".sort")&&(objname+="["+eval(objname+".length-1")+"]"),oldniva=niva}return this.xmlobject},show_json_structure:function(e,t,i){var r="";for(var o in e.sort?r+="[\n":r+="{\n",e)e.sort||(r+=o+":"),"object"==_typeof(e[o])?r+=this.show_json_structure(e[o],!1,1):"function"==typeof e[o]?r+=e[o]+"":"string"!=typeof e[o]?r+=e[o]+",\n":r+="'"+e[o].replace(/\'/g,"\\'").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/\r/g,"\\r")+"',\n";if(e.sort?r+="],\n":r+="},\n",!i){var n=(r=(r=(r=r.substring(0,r.lastIndexOf(","))).replace(new RegExp(",\n}","g"),"\n}")).replace(new RegExp(",\n]","g"),"\n]")).split("\n");r="";var a=0;for(o=0;o<n.length;o++){(0<=n[o].indexOf("}")||0<=n[o].indexOf("]"))&&a--,tabs="";for(var s=0;s<a;s++)tabs+="\t";r+=tabs+n[o]+"\n",(0<=n[o].indexOf("{")||0<=n[o].indexOf("["))&&a++}"html"==t&&(r=(r=r.replace(/</g,"&lt;").replace(/>/g,"&gt;")).replace(/\n/g,"<BR>").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;")),"compact"==t&&(r=r.replace(/\n/g,"").replace(/\t/g,""))}return r},no_fast_endings:function(e){e=e.split("/>");for(var t=1;t<e.length;t++){var i=e[t-1].substring(e[t-1].lastIndexOf("<")+1).split(" ")[0];e[t]="></"+i+">"+e[t]}return e.join("")},attris_to_tags:function(e){var t=" =\"'".split("");e=e.split(">");for(var i=0;i<e.length;i++){for(var r=e[i].split("<"),o=0;o<4;o++)r[0]=r[0].replace(new RegExp(t[o],"g"),"_jsonconvtemp"+o+"_");if(r[1]){r[1]=r[1].replace(/'/g,'"'),r[1]=r[1].split('"');for(var n=1;n<r[1].length;n+=2)for(o=0;o<4;o++)r[1][n]=r[1][n].replace(new RegExp(t[o],"g"),"_jsonconvtemp"+o+"_");r[1]=r[1].join('"')}e[i]=r.join("<")}for(e=(e=(e=e.join(">")).replace(/ ([^=]*)=([^ |>]*)/g,"><$1>$2</$1")).replace(/>"/g,">").replace(/"</g,"<"),o=0;o<4;o++)e=e.replace(new RegExp("_jsonconvtemp"+o+"_","g"),t[o]);return e},CLASS_NAME:"GeoGlobe.Format.XML2JSON"}),GeoGlobe.Format.CSWGetRecords=function(e){e=GeoGlobe.Util.applyDefaults(e,GeoGlobe.Format.CSWGetRecords.DEFAULTS);var t=GeoGlobe.Format.CSWGetRecords["v"+e.version.replace(/\./g,"_")];if(!t)throw"Unsupported CSWGetRecords version: "+e.version;return new t(e)},GeoGlobe.Format.CSWGetRecords.DEFAULTS={version:"2.0.2"},GeoGlobe.Format.CSWGetRecords.v2_0_2=GeoGlobe.Class4OL(GeoGlobe.Format.XML,{namespaces:{csw:"http://www.opengis.net/cat/csw/2.0.2",dc:"http://purl.org/dc/elements/1.1/",dct:"http://purl.org/dc/terms/",gmd:"http://www.isotc211.org/2005/gmd",geonet:"http://www.fao.org/geonetwork",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"csw",version:"2.0.2",schemaLocation:"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd",requestId:null,resultType:null,outputFormat:null,outputSchema:null,startPosition:null,maxRecords:null,DistributedSearch:null,ResponseHandler:null,Query:null,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(e){GeoGlobe.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){"string"==typeof e&&(e=GeoGlobe.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t={};return this.readNode(e,t),t},readers:{csw:{GetRecordsResponse:function(e,t){t.records=[],this.readChildNodes(e,t);var i=this.getAttributeNS(e,"","version");""!=i&&(t.version=i)},RequestId:function(e,t){t.RequestId=this.getChildValue(e)},SearchStatus:function(e,t){t.SearchStatus={};var i=this.getAttributeNS(e,"","timestamp");""!=i&&(t.SearchStatus.timestamp=i)},SearchResults:function(e,t){this.readChildNodes(e,t);for(var i=e.attributes,r={},o=0,n=i.length;o<n;++o)"numberOfRecordsMatched"==i[o].name||"numberOfRecordsReturned"==i[o].name||"nextRecord"==i[o].name?r[i[o].name]=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(i[o].nodeValue):r[i[o].name]=i[o].nodeValue;t.SearchResults=r},SummaryRecord:function(e,t){var i={type:"SummaryRecord"};this.readChildNodes(e,i),t.records.push(i)},BriefRecord:function(e,t){var i={type:"BriefRecord"};this.readChildNodes(e,i),t.records.push(i)},DCMIRecord:function(e,t){var i={type:"DCMIRecord"};this.readChildNodes(e,i),t.records.push(i)},Record:function(e,t){var i={type:"Record"};this.readChildNodes(e,i),t.records.push(i)},"*":function(e,t){t[e.localName||e.nodeName.split(":").pop()]=this.getChildValue(e)}},geonet:{info:function(e,t){var i={};this.readChildNodes(e,i),t.gninfo=i}},dc:{"*":function(e,t){var i=e.localName||e.nodeName.split(":").pop();GeoGlobe.Util.isArray(t[i])||(t[i]=[]);for(var r={},o=e.attributes,n=0,a=o.length;n<a;++n)r[o[n].name]=o[n].nodeValue;r.value=this.getChildValue(e),""!=r.value&&t[i].push(r)}},dct:{"*":function(e,t){var i=e.localName||e.nodeName.split(":").pop();GeoGlobe.Util.isArray(t[i])||(t[i]=[]),t[i].push(this.getChildValue(e))}},ows:GeoGlobe.Util.applyDefaults({BoundingBox:function(e,t){t.bounds&&(t.BoundingBox=[{crs:t.projection,value:[t.bounds._sw.lng,t.bounds._sw.lat,t.bounds._ne.lng,t.bounds._ne.lat]}],delete t.projection,delete t.bounds),GeoGlobe.Format.OWSCommon.v1_0_0.prototype.readers.ows.BoundingBox.apply(this,arguments)}},GeoGlobe.Format.OWSCommon.v1_0_0.prototype.readers.ows)},write:function(e){var t=this.writeNode("csw:GetRecords",e);return t.setAttribute("xmlns:gmd",this.namespaces.gmd),GeoGlobe.Format.XML.prototype.write.apply(this,[t])},writers:{csw:{GetRecords:function(e){e=e||{};var t=this.createElementNSPlus("csw:GetRecords",{attributes:{service:"CSW",version:this.version,requestId:e.requestId||this.requestId,resultType:e.resultType||this.resultType,outputFormat:e.outputFormat||this.outputFormat,outputSchema:e.outputSchema||this.outputSchema,startPosition:e.startPosition||this.startPosition,maxRecords:e.maxRecords||this.maxRecords}});(e.DistributedSearch||this.DistributedSearch)&&this.writeNode("csw:DistributedSearch",e.DistributedSearch||this.DistributedSearch,t);var i=e.ResponseHandler||this.ResponseHandler;if(GeoGlobe.Util.isArray(i)&&0<i.length)for(var r=0,o=i.length;r<o;r++)this.writeNode("csw:ResponseHandler",i[r],t);return this.writeNode("Query",e.Query||this.Query,t),t},DistributedSearch:function(e){return this.createElementNSPlus("csw:DistributedSearch",{attributes:{hopCount:e.hopCount}})},ResponseHandler:function(e){return this.createElementNSPlus("csw:ResponseHandler",{value:e.value})},Query:function(e){e=e||{};var t=this.createElementNSPlus("csw:Query",{attributes:{typeNames:e.typeNames||"csw:Record"}}),i=e.ElementName;if(GeoGlobe.Util.isArray(i)&&0<i.length)for(var r=0,o=i.length;r<o;r++)this.writeNode("csw:ElementName",i[r],t);else this.writeNode("csw:ElementSetName",e.ElementSetName||{value:"summary"},t);return e.Constraint&&this.writeNode("csw:Constraint",e.Constraint,t),e.SortBy&&this.writeNode("ogc:SortBy",e.SortBy,t),t},ElementName:function(e){return this.createElementNSPlus("csw:ElementName",{value:e.value})},ElementSetName:function(e){return this.createElementNSPlus("csw:ElementSetName",{attributes:{typeNames:e.typeNames},value:e.value})},Constraint:function(e){var t=this.createElementNSPlus("csw:Constraint",{attributes:{version:e.version}});if(e.Filter){var i=new GeoGlobe.Format.Filter({version:e.version});t.appendChild(i.write(e.Filter))}else if(e.CqlText){var r=this.createElementNSPlus("CqlText",{value:e.CqlText.value});t.appendChild(r)}return t}},ogc:GeoGlobe.Format.Filter.v1_1_0.prototype.writers.ogc},CLASS_NAME:"GeoGlobe.Format.CSWGetRecords.v2_0_2"}),function(e){e.GeoGlobe.Format.X2JS=function(e){void 0===(e=e||{}).escapeMode&&(e.escapeMode=!0),e.attributePrefix=e.attributePrefix||"_",e.arrayAccessForm=e.arrayAccessForm||"none",e.emptyNodeForm=e.emptyNodeForm||"text",void 0===e.enableToStringFunc&&(e.enableToStringFunc=!0),e.arrayAccessFormPaths=e.arrayAccessFormPaths||[],void 0===e.skipEmptyTextNodesForObj&&(e.skipEmptyTextNodesForObj=!0),void 0===e.stripWhitespaces&&(e.stripWhitespaces=!0),e.datetimeAccessFormPaths=e.datetimeAccessFormPaths||[],void 0===e.useDoubleQuotes&&(e.useDoubleQuotes=!1),e.xmlElementsFilter=e.xmlElementsFilter||[],e.jsonPropertiesFilter=e.jsonPropertiesFilter||[],void 0===e.keepCData&&(e.keepCData=!1);var t=1,i=3,r=4,o=8,n=9;function a(e){var t=e.localName;return null==t&&(t=e.baseName),null!=t&&""!=t||(t=e.nodeName),t}function s(e){return"string"==typeof e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):e}function l(e,t,i,r){for(var o=0;o<e.length;o++){var n=e[o];if("string"==typeof n){if(n==r)break}else if(n instanceof RegExp){if(n.test(r))break}else if("function"==typeof n&&n(t,i,r))break}return o!=e.length}function u(t,i,r){switch(e.arrayAccessForm){case"property":t[i]instanceof Array?t[i+"_asArray"]=t[i]:t[i+"_asArray"]=[t[i]]}!(t[i]instanceof Array)&&0<e.arrayAccessFormPaths.length&&l(e.arrayAccessFormPaths,t,i,r)&&(t[i]=[t[i]])}function h(e){var t=e.split(/[-T:+Z]/g),i=new Date(t[0],t[1]-1,t[2]),r=t[5].split(".");if(i.setHours(t[3],t[4],r[0]),1<r.length&&i.setMilliseconds(r[1]),t[6]&&t[7]){var o=60*t[6]+Number(t[7]);o=0+("-"==(/\d\d-\d\d:\d\d$/.test(e)?"-":"+")?-1*o:o),i.setMinutes(i.getMinutes()-o-i.getTimezoneOffset())}else-1!==e.indexOf("Z",e.length-1)&&(i=new Date(Date.UTC(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds())));return i}function c(i,r,o,n){return!(r==t&&0<e.xmlElementsFilter.length)||l(e.xmlElementsFilter,i,o,n)}function p(t,i,r,o){var n="<"+(null!=t&&null!=t.__prefix?t.__prefix+":":"")+i;if(null!=r)for(var a=0;a<r.length;a++){var l=r[a],u=t[l];e.escapeMode&&(u=s(u)),n+=" "+l.substr(e.attributePrefix.length)+"=",e.useDoubleQuotes?n+='"'+u+'"':n+="'"+u+"'"}return n+(o?"/>":">")}function d(e,t){return"</"+(null!=e.__prefix?e.__prefix+":":"")+t+">"}function f(t,i){return!!("property"==e.arrayAccessForm&&function(e,t){return-1!==e.indexOf(t,e.length-t.length)}(i.toString(),"_asArray")||0==i.toString().indexOf(e.attributePrefix)||0==i.toString().indexOf("__")||t[i]instanceof Function)}function g(e){var t=0;if(e instanceof Object)for(var i in e)f(e,i)||t++;return t}function m(t){var i=[];if(t instanceof Object)for(var r in t)-1==r.toString().indexOf("__")&&0==r.toString().indexOf(e.attributePrefix)&&i.push(r);return i}function _(t){var i="";return t instanceof Object?i+=function(t){var i="";return null!=t.__cdata&&(i+="<![CDATA["+t.__cdata+"]]>"),null!=t.__text&&(e.escapeMode?i+=s(t.__text):i+=t.__text),i}(t):null!=t&&(e.escapeMode?i+=s(t):i+=t),i}function v(e,t){return""===e?t:e+"."+t}function C(e,t,i,r){var o="";if(0==e.length)o+=p(e,t,i,!0);else for(var n=0;n<e.length;n++)o+=p(e[n],t,m(e[n]),!1),o+=y(e[n],v(r,t)),o+=d(e[n],t);return o}function y(t,i){var r,o,n,a="";if(0<g(t))for(var s in t)if(!f(t,s)&&(""==i||(r=t,n=v(i,o=s),0==e.jsonPropertiesFilter.length||""==n||l(e.jsonPropertiesFilter,r,o,n)))){var u=t[s],h=m(u);if(null==u||null==u)a+=p(u,s,h,!0);else if(u instanceof Object)if(u instanceof Array)a+=C(u,s,h,i);else if(u instanceof Date)a+=p(u,s,h,!1),a+=u.toISOString(),a+=d(u,s);else{0<g(u)||null!=u.__text||null!=u.__cdata?(a+=p(u,s,h,!1),a+=y(u,v(i,s)),a+=d(u,s)):a+=p(u,s,h,!0)}else a+=p(u,s,h,!1),a+=_(u),a+=d(u,s)}return a+_(t)}this.parseXmlString=function(e){var t,i=window.ActiveXObject||"ActiveXObject"in window;if(void 0===e)return null;if(window.DOMParser){var r=new window.DOMParser,o=null;if(!i)try{o=r.parseFromString("INVALID","text/xml").getElementsByTagName("parsererror")[0].namespaceURI}catch(e){o=null}try{t=r.parseFromString(e,"text/xml"),null!=o&&0<t.getElementsByTagNameNS(o,"parsererror").length&&(t=null)}catch(e){t=null}}else 0==e.indexOf("<?")&&(e=e.substr(e.indexOf("?>")+2)),(t=new ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(e);return t},this.asArray=function(e){return void 0===e||null==e?[]:e instanceof Array?e:[e]},this.toXmlDateTime=function(e){return e instanceof Date?e.toISOString():"number"==typeof e?new Date(e).toISOString():null},this.asDateTime=function(e){return"string"==typeof e?h(e):e},this.xml2json=function(s){return function s(p,d){if(p.nodeType==n){for(var f=new Object,g=p.childNodes,m=0;m<g.length;m++){if((_=g.item(m)).nodeType==t)f[v=a(_)]=s(_,v)}return f}if(p.nodeType==t){(f=new Object).__cnt=0;for(g=p.childNodes,m=0;m<g.length;m++){var _,v=a(_=g.item(m));if(_.nodeType!=o){var C=d+"."+v;c(f,_.nodeType,v,C)&&(f.__cnt++,null==f[v]?(f[v]=s(_,C),u(f,v,C)):(null!=f[v]&&(f[v]instanceof Array||(f[v]=[f[v]],u(f,v,C))),f[v][f[v].length]=s(_,C)))}}for(var y=0;y<p.attributes.length;y++){var A=p.attributes.item(y);f.__cnt++,f[e.attributePrefix+A.name]=A.value}var I=function(e){return e.prefix}(p);return null!=I&&""!=I&&(f.__cnt++,f.__prefix=I),null!=f["#text"]&&(f.__text=f["#text"],f.__text instanceof Array&&(f.__text=f.__text.join("\n")),e.stripWhitespaces&&(f.__text=f.__text.trim()),delete f["#text"],"property"==e.arrayAccessForm&&delete f["#text_asArray"],f.__text=function(t,i,r){if(0<e.datetimeAccessFormPaths.length){var o=r.split(".#")[0];return l(e.datetimeAccessFormPaths,t,i,o)?h(t):t}return t}(f.__text,v,d+"."+v)),null!=f["#cdata-section"]&&(f.__cdata=f["#cdata-section"],delete f["#cdata-section"],"property"==e.arrayAccessForm&&delete f["#cdata-section_asArray"]),0==f.__cnt&&"text"==e.emptyNodeForm?f="":1==f.__cnt&&null!=f.__text?f=f.__text:1!=f.__cnt||null==f.__cdata||e.keepCData?1<f.__cnt&&null!=f.__text&&e.skipEmptyTextNodesForObj&&(e.stripWhitespaces&&""==f.__text||""==f.__text.trim())&&delete f.__text:f=f.__cdata,delete f.__cnt,!e.enableToStringFunc||null==f.__text&&null==f.__cdata||(f.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),f}if(p.nodeType==i||p.nodeType==r)return p.nodeValue}(s)},this.xml_str2json=function(e){var t=this.parseXmlString(e);return null!=t?this.xml2json(t):null},this.json2xml_str=function(e){return y(e,"")},this.json2xml=function(e){var t=this.json2xml_str(e);return this.parseXmlString(t)},this.getVersion=function(){return"1.2.0"}},e.GeoGlobe.Format.X2JS.CLASS_NAME="GeoGlobe.Format.X2JS"}(window),GeoGlobe.Query.Service=GeoGlobe.Class4OL({name:null,url:null,version:null,userid:"test@liferay.com",initialize:function(e,t,i){this.name=e,this.url=t,GeoGlobe.Util.extend(this,i)},getCapabilities:function(){},isExist:function(){},failFn:function(e){alert("服务请求失败，请检查服务是否正常运行或请求地址是否正确。\n请求地址："+this.url+"\n操作类型："+e)},_parseToXML:function(e){var t=e.responseXML;return t&&t.documentElement||(t=e.responseText),(new GeoGlobe.Format.XML).read(t)},_checkIsError:function(e){return 0<(new GeoGlobe.Format.XML).read(e).selectNodes("ServiceExceptionReport").length?this._parseToJSON(e):null},_isException:function(e){return!(!e||!e.ServiceExceptionReport)},_parseToJSON:function(e){return(new GeoGlobe.Util.Format.XML2JSON).read(e)},CLASS_NAME:"GeoGlobe.Query.Service"}),GeoGlobe.Query.RouteQuery=GeoGlobe.Class4OL(GeoGlobe.Query.Service,{_format:null,initialize:function(e,t,i){this.name=e,this.url=t,this._format=new GeoGlobe.Format.RouteQuery,GeoGlobe.Util.extend(this,i)},getCapabilities:function(e,t){var i=this.url;GeoGlobe.loadURL(i,{REQUEST:"GetCapabilities"},this,e,t)},findRoute:function(e,t,i){var r={REQUEST:"FindRoute",SERVICE:"ROUTE",VERSION:"1.0.0"};for(var o in{data:!0,orig:!0,dest:!0})if(!(o in e))throw new Error("Missing property '"+o+"'");r.DATA=e.data,r.ORIG=e.orig,r.DEST=e.dest,null!==e.service&&void 0!==e.service&&(r.SERVICE=e.service),null!==e.version&&void 0!==e.version&&(r.VERSION=e.version),null!==e.radius&&void 0!==e.radius&&(r.RADIUS=e.radius),null!==e.queryType&&void 0!==e.queryType&&(r.QUERYTYPE=e.queryType),null!==e.midpos&&void 0!==e.midpos&&(r.MIDPOS=e.midpos),null!==e.avoidPos&&void 0!==e.avoidPos&&(r.AVOIDPOS=e.avoidPos),null!==e.filterRoute&&void 0!==e.filterRoute&&(r.FILTERROUTE=e.filterRoute),null!==e.resultCount&&void 0!==e.resultCount&&(r.RESULTCOUNT=e.resultCount),GeoGlobe.Request.GET({url:this.url,params:r,async:!1,scope:this,success:function(e){var i=this._format.read(e.responseText);if("string"!=typeof i.exceptionInfo){var r=new GeoGlobe.Query.RoutesResult(i),o=r.routes,n=(new GeoGlobe.Format.GeoJSON).write(o),a=new GeoGlobe.Format.JSON;geojsonRoute=a.read(n),r.geojsonRoute=geojsonRoute,t(r)}else t(i)},failure:i})},getRouteInfo:function(e,t,i){var r={REQUEST:"GetRouteInfo",SERVICE:"ROUTE",VERSION:"1.0.0"};if(!e.data||!e.id)throw"Error!Not data and id for bus query.";r.DATA=e.data,r.ID=e.id,GeoGlobe.Request.GET({url:this.url,params:r,scope:this,success:function(e){var i=this._format.read(e.responseText);"string"!=typeof i.exceptionInfo&&(i=new GeoGlobe.Query.RouteInfoResult(i)),t(i)},failure:i})},CLASS_NAME:"GeoGlobe.Query.RouteQuery"}),GeoGlobe.Format.RouteQuery=new GeoGlobe.Class4OL(GeoGlobe.Format.XML,{initialize:function(e){GeoGlobe.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){var t={},i=[];if("string"==typeof e&&(e=GeoGlobe.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType){i=[];var r=GeoGlobe.Format.XML.prototype.getChildEl.apply(this,[e]).nodeName;if("ServiceExceptionReport"===r){var o=GeoGlobe.Format.XML.prototype.getElementsByTagNameNS(e,"*","ServiceException")[0];return{exceptionInfo:GeoGlobe.Format.XML.prototype.getChildValue.apply(this,[o]),exceptionCode:o.getAttribute("code")}}for(var n=e.getElementsByTagName(r)[0].childNodes,a=0;a<n.length;a++){var s=n[a],l=s.nodeName;this._resultPaser[r][l]&&this._resultPaser[r][l].apply(this,[s,i])}}return"routeinfo"===(r=r.toLowerCase())?t.items=i:t[r]=i,t},_resultPaser:{RouteInfo:{Item:function(e,t){var i=e.childNodes,r=e.getAttribute("id"),o={};r&&(o={id:r});for(var n=0;n<i.length;n++){var a=(e=i[n]).nodeName;this._resultPaser.RouteInfo[a]&&this._resultPaser.RouteInfo[a].apply(this,[e,o])}t.push(o)},Name:function(e,t){var i=GeoGlobe.Format.XML.prototype.getChildValue.apply(this,[e]);i&&(t.name=i)},Toll:function(e,t){var i=GeoGlobe.Format.XML.prototype.getChildValue.apply(this,[e]);t.toll=i},Level:function(e,t){var i=GeoGlobe.Format.XML.prototype.getChildValue.apply(this,[e]);t.level=i},Length:function(e,t){var i=GeoGlobe.Format.XML.prototype.getChildValue.apply(this,[e]);t.length=i},Geometry:function(e,t){var i=GeoGlobe.Format.XML.prototype.getElementsByTagNameNS(e,"*","LineString")[0];if(i){var r=GeoGlobe.Format.XML.prototype.getChildValue.apply(this,[i]);if("string"==typeof r&&0<r.length){for(var o=r.split(" "),n=[],a=0,s=o.length;a<s;a++){var l=o[a].split(",");n.push(new GeoGlobe.Geometry.Point(new Number(l[0]),new Number(l[1])))}var u=new GeoGlobe.Geometry.LineString(n);t.geometry=u}}},Directions:function(e,t){t.directions=[];for(var i=e.childNodes,r=0;r<i.length;r++){var o=(e=i[r]).nodeName;this._resultPaser.RouteInfo[o]&&this._resultPaser.RouteInfo[o](e,t.directions)}},Direction:function(e,t){var i={},r=GeoGlobe.Format.XML.prototype.getChildValue.apply(this,[e]);i.direction=r,i.nextID=e.getAttribute("nextID"),i.nextItem=e.getAttribute("nextItem"),t.push(i)}},Routes:{Route:function(e,t){for(var i=e.childNodes,r={},o=0;o<i.length;o++){var n=(e=i[o]).nodeName;this._resultPaser.Routes[n]&&this._resultPaser.Routes[n].apply(this,[e,r])}t.push(r)},Item:function(e,t){GeoGlobe.Util.isArray(t.items)||(t.items=[]);var i=e.childNodes,r=e.getAttribute("id"),o={};r&&(o={id:r});for(var n=0;n<i.length;n++){var a=(e=i[n]).nodeName;this._resultPaser.Routes[a]&&this._resultPaser.Routes[a].apply(this,[e,o])}t.items.push(o)},Distance:function(e,t){var i=GeoGlobe.Format.XML.prototype.getChildValue.apply(this,[e]);t.distance=i},Name:function(e,t){var i=GeoGlobe.Format.XML.prototype.getChildValue.apply(this,[e]);i&&(t.name=i)},Length:function(e,t){var i=GeoGlobe.Format.XML.prototype.getChildValue.apply(this,[e]);t.length=i},Direction:function(e,t){var i={},r=GeoGlobe.Format.XML.prototype.getChildValue.apply(this,[e]);i.direction=r,i.nextID=e.getAttribute("nextID"),i.nextItem=e.getAttribute("nextItem"),t.direction=i},Geometry:function(e,t){var i=GeoGlobe.Format.XML.prototype.getElementsByTagNameNS(e,"*","LineString")[0];if(i){var r=GeoGlobe.Format.XML.prototype.getChildValue.apply(this,[i]);if("string"==typeof r&&0<r.length){for(var o=r.split(" "),n=[],a=0,s=o.length;a<s;a++){var l=o[a].split(",");n.push(new GeoGlobe.Geometry.Point(new Number(l[0]),new Number(l[1])))}var u=new GeoGlobe.Geometry.LineString(n);t.geometry=u}}},Duration:function(e,t){var i=GeoGlobe.Format.XML.prototype.getChildValue.apply(this,[e]);t.duration=i},BoundingBox:function(e,t){for(var i=e.childNodes,r=0;r<i.length;r++){var o=(e=i[r]).nodeName;this._resultPaser.Routes[o]&&this._resultPaser.Routes[o].apply(this,[e,t])}},LowerCorner:function(e,t){var i=GeoGlobe.Format.XML.prototype.getChildValue.apply(this,[e]).replace(/^\s*|\s*$/g,""),r=(i=i.replace(/\s*,\s*/g,",")).split(",");t.left=r[0],t.bottom=r[1]},UpperCorner:function(e,t){var i=GeoGlobe.Format.XML.prototype.getChildValue.apply(this,[e]).replace(/^\s*|\s*$/g,""),r=(i=i.replace(/\s*,\s*/g,",")).split(",");t.right=r[0],t.top=r[1],t.bounds=new GeoGlobe.LngLatBounds(new GeoGlobe.LngLat(t.left,t.bottom),new GeoGlobe.LngLat(t.right,t.top)),delete t.left,delete t.bottom,delete t.right,delete t.top},Count:function(e,t){var i=GeoGlobe.Format.XML.prototype.getChildValue.apply(this,[e]);t.count=i}}}}),GeoGlobe.Query.RoutesResult=GeoGlobe.Class4OL({data:null,routes:null,initialize:function(e){this.routes=[];var t=null;if(e&&e.routes&&(t=(this.data=e).routes),GeoGlobe.Util.isArray(t))for(var i=0,r=t.length;i<r;i++){var o=new GeoGlobe.Query.RouteResult;for(var n in t[i])o[n]=t[i][n];this.routes.push(o)}},CLASS_NAME:"GeoGlobe.Query.RoutesResult"}),GeoGlobe.Query.RouteResult=GeoGlobe.Class4OL({bounds:null,count:null,distance:null,duration:null,geometry:null,items:null,initialize:function(){},CLASS_NAME:"GeoGlobe.Query.RouteResult"}),GeoGlobe.Query.RouteInfoResult=GeoGlobe.Class4OL({data:null,items:null,initialize:function(e){if(this.items=[],e&&e.items)var t=(this.data=e).items;if(GeoGlobe.Util.isArray(t))for(var i=0,r=t.length;i<r;i++){var o=new GeoGlobe.Query.RouteInfoItem;for(var n in t[i])o[n]=t[i][n];this.items.push(o)}},CLASS_NAME:"GeoGlobe.Query.RouteInfoResult"}),GeoGlobe.Query.RouteInfoItem=GeoGlobe.Class4OL({id:null,name:null,toll:null,length:null,geometry:null,level:null,directions:null,initialize:function(){},CLASS_NAME:"GeoGlobe.Query.RouteInfoItem"}),GeoGlobe.Query.BusQuery=GeoGlobe.Class4OL(GeoGlobe.Query.Service,{networkName:null,transferScheme:null,initialize:function(e,t,i){this.name=e,this.url=t,GeoGlobe.Util.extend(this,i)},getCapabilities:function(e,t){"function"!=typeof t&&(t=function(){alert("公交服务请求失败，请检查服务是否正常运行或请求地址是否正确。\n请求地址："+this.url+"\n操作类型：GetCapabilities")}),GeoGlobe.Request.GET({url:this.url,params:{REQUEST:"GetCapabilities"},scope:this,async:!1,success:function(t){"function"==typeof e&&e(t)},failure:t})},isExist:function(){var e=!1,t=this.url;return GeoGlobe.Request.GET({url:t,scope:this,async:!1,success:function(){e=!0}}),e},queryStation:function(e,t,i){var r={REQUEST:"QueryStation"};if(!e.networkName)throw"Error!Not network name for bus query.";r.NETWORKNAME=e.networkName,null!==e.stationId&&void 0!==e.stationId&&(r.STATIONID=e.stationId),null!==e.stationName&&void 0!==e.stationName&&(r.STATIONNAME=e.stationName),null!==e.lineId&&void 0!==e.lineId&&(r.LINEID=e.lineId),null!==e.lineName&&void 0!==e.lineName&&(r.LINENAME=e.lineName),null!==e.coordinate&&void 0!==e.coordinate&&(r.COORDINATE=e.coordinate),null!==e.bbox&&void 0!==e.bbox&&(r.BOX=e.bbox),GeoGlobe.Request.GET({url:this.url,params:r,scope:this,success:function(e){var i=this._parserFeatures(e.responseText);t(i)},failure:i})},queryLine:function(e,t,i){var r={REQUEST:"QueryLine"};if(!e.networkName)throw"Error!Not network name for bus query.";r.NETWORKNAME=e.networkName,null!==e.lineName&&void 0!==e.lineName&&(r.LINENAME=e.lineName),null!==e.lineId&&void 0!==e.lineId&&(r.LINEID=e.lineId),null!==e.stationName&&void 0!==e.stationName&&(r.STATIONNAME=e.stationName),null!==e.stationId&&void 0!==e.stationId&&(r.STATIONID=e.stationId),null!==e.coordinate&&void 0!==e.coordinate&&(r.COORDINATE=e.coordinate),null!==e.bbox&&void 0!==e.bbox&&(r.BOX=e.bbox),GeoGlobe.Request.GET({url:this.url,params:r,scope:this,success:function(e){var i=this._parserFeatures(e.responseText);t(i)},failure:i})},queryChange:function(e,t,i){var r={REQUEST:"QueryChange"};if(!e.networkName)throw"Error!Not network name for bus query.";r.NETWORKNAME=e.networkName,null!==e.startStationId&&void 0!==e.startStationId&&(r.STARTSTATIONID=e.startStationId),null!==e.endStationId&&void 0!==e.endStationId&&(r.ENDSTATIONID=e.endStationId),null!==e.orderType&&void 0!==e.orderType&&(r.ORDERTYPE=e.orderType),null!==e.startCoordinate&&void 0!==e.startCoordinate&&(r.STARTCOORDINATE=e.startCoordinate),null!==e.endCoordinate&&void 0!==e.endCoordinate&&(r.ENDCOORDINATE=e.endCoordinate),null!==e.maxDepth&&void 0!==e.maxDepth&&(r.MAXDEPTH=e.maxDepth),null!==e.maxCost&&void 0!==e.maxCost&&(r.MAXCOST=e.maxCost),null!==e.maxSolutions&&void 0!==e.maxSolutions&&(r.MAXSOLUTIONS=e.maxSolutions),null!==e.ChangeCount&&void 0!==e.ChangeCount&&(r.CHANGECOUNT=e.ChangeCount),GeoGlobe.Request.GET({url:this.url,params:r,scope:this,success:function(e){for(var i=[],r=(e.responseXML.documentElement?e.responseXML:format.read(e.responseText)).selectNodes("/Features/FeatureCollection"),o=new GeoGlobe.Format.XML,n=0;n<r.length;n++){var a=r[n],s=this._getAttibutionOfNode(a,["cost","price","walkingDistance","transferTimes"]),l=o.write(r[n]),u=this._parserFeatures(l);u.attributes=s;for(var h=a.selectNodes("featureMember"),c=0;c<h.length;c++){var p=h[c].selectNodes("Road");u[c].isOnFoot=p[0].getAttribute("isOnFoot")}i.push(u)}t(i)},failure:i})},_getAttibutionOfNode:function(e,t){var i={};if(e.tagName)for(var r=0;r<t.length;r++)i[t[r]]=e.getAttribute(t[r]);return i},_getGeometryType:function(){return"polygon"},_pagingToString:function(e,t){return"<numPerPage>"+(t=t||this.maxPerPage)+"</numPerPage><curPage>"+(e=e||1)+"</curPage>"},_orderByToString:function(e){return e?"<orderBy><PropertyName>"+e+"</PropertyName></orderBy>":""},_geometryToString:function(){return'<geometry><Polygon><outerBoundaryIs><LinearRing><coordinates decimal="." cs="," ts=" ">20,30 21,41 52,42 53,33 20,30</coordinates></LinearRing></outerBoundaryIs></Polygon></geometry>'},_stringToGeometry:function(){return GeoGlobe.Geometry.Polygon.createRegularPolygon(new GeoGlobe.Geometry.Point(360*Math.random()-160,90*Math.random()-70),Math.round(20*Math.random()),Math.round(10*Math.random()))},_parserFeatures:function(e){var t=new GeoGlobe.Format.GML;return t.gmlns="*",t.read(e)},_parserResponseText:function(e,t){if(t){var i=new RegExp("<"+t+">",["g"]),r=new RegExp("</"+t+">",["g"]);e=(e=e.replace(i,"<featureMember><"+t+">")).replace(r,"</"+t+"></featureMember>")}return(e=(e=(e=e.replace(/<gml:LineString>/g,"<gml:LineString><gml:coordinates>")).replace(/<\/gml:LineString>/g,"</gml:coordinates></gml:LineString>")).replace(/<gml:Point>/g,"<gml:Point><gml:coordinates>")).replace(/<\/gml:Point>/g,"</gml:coordinates></gml:Point>")},_parserFeaturesNew:function(e,t){var i=new GeoGlobe.Format.GML;return i.gmlns="*",t&&(i.featureName=t),i.read(e)},_parserSuccessResult:function(e){return(new GeoGlobe.Util.Format.XML2JSON).read(e)},_parseToXML:function(e){var t=e.responseXML;return t&&t.documentElement||(t=e.responseText),(new GeoGlobe.Format.XML).read(t)},_parseToJSON:function(e){return(new GeoGlobe.Format.XML2JSON).read(e)},queryTransferScheme:function(e,t,i){var r={request:"QueryTransferScheme",SERVICE:"BUS",VERSION:"1.0.0"};for(var o in{networkName:!0,transferMode:!0,startInput:!0,endInput:!0})if(!(o in e))throw new Error("缺少必选属性：'"+o+"'。");r.networkName=e.networkName,null!==e.service&&void 0!==e.service&&(r.SERVICE=e.service),null!==e.version&&void 0!==e.version&&(r.VERSION=e.version),null!==e.transferMode&&void 0!==e.transferMode&&(r.TRANSFERMODE=e.transferMode),null!==e.startInput&&void 0!==e.startInput&&(r.STARTINPUT=e.startInput),null!==e.endInput&&void 0!==e.endInput&&(r.ENDINPUT=e.endInput),null!==e.inputMode&&void 0!==e.inputMode&&(r.INPUTMODEL=e.inputMode),null!==e.ExistGoTime&&void 0!==e.ExistGoTime&&(r.EXISTGOTIME=e.ExistGoTime),null!==e.StartTime&&void 0!==e.StartTime&&(r.STARTTIME=e.StartTime),null!==e.MaxSearchDistance&&void 0!==e.MaxSearchDistance&&(r.MAXSEARCHDISTANCE=e.MaxSearchDistance),null!==e.PrioritySubset&&void 0!==e.PrioritySubset&&(r.PRIORITYSUBSET=e.PrioritySubset),null!==e.ExistAbsolutePriority&&void 0!==e.ExistAbsolutePriority&&(r.EXISTABSOLUTEPRIORITY=e.ExistAbsolutePriority),null!==e.LagSubset&&void 0!==e.LagSubset&&(r.LAGSUBSET=e.LagSubset),null!==e.OutputPage&&void 0!==e.OutputPage&&(r.OUTPUTPAGE=e.OutputPage),null!==e.PageSize&&void 0!==e.PageSize&&(r.PAGESIZE=e.PageSize),null!==e.ChangeCount&&void 0!==e.ChangeCount&&(r.CHANGECOUNT=e.ChangeCount),GeoGlobe.Request.GET({url:this.url,params:r,async:!1,scope:this,success:GeoGlobe.Function.bind((function(e){var i=e.responseXML,r={startPoint:[],transferScheme:[],endPoint:[]};if(!i)return t(r),r;var o=new GeoGlobe.Format.XML,n=i.selectNodes("/ServiceExceptionReport/ServiceExceptionMessage");if(n&&0<n.length)return t(r),r;var a=i.selectNodes("/QueryTransferSchemeResponse"),s=o.write(a[0]),l=this._parseToJSON(s),u=l.QueryTransferSchemeResponse.StartPoint;GeoGlobe.Util.isArray(u)||(u=[u]);var h=l.QueryTransferSchemeResponse.EndPoint;GeoGlobe.Util.isArray(h)||(h=[h]);var c=l.QueryTransferSchemeResponse.TransferScheme,p=this._getPointGeometryByGMLPointStr(u[0].Geometry.gml_Point),d=new GeoGlobe.Feature(p),f=this._getPointGeometryByGMLPointStr(h[0].Geometry.gml_Point),g=new GeoGlobe.Feature(f),m=this._parserTransferScheme(c);t(r={startPoint:d,transferScheme:m,endPoint:g})}),this),failure:i})},_parserTransferScheme:function(e){GeoGlobe.Util.isArray(e)||(e=[e]);for(var t=new Array,i=0;i<e.length;i++){var r=e[i],o=this._parserSectionInfo(r.SectionInfo),n=this._parserSectionRouting(r.SectionRouting),a={Cost:e[i].Cost,SectionInfo:o,SectionRouting:n,TotalDistance:e[i].TotalDistance,TransferCount:e[i].TransferCount};t.push(a)}return t},_parserSectionInfo:function(e){GeoGlobe.Util.isArray(e)||(e=[e]);for(var t=new Array,i=0;i<e.length;i++){var r=this._getPointFeatureByObj(e[i].FromStation);e[i].FromStation.PassagewayRouting&&((o=this._getPointFeatureByObj(e[i].FromStation.PassagewayRouting)).SectionRouting&&(o.attributes.SectionRouting=o.data.SectionRouting=this._parserSectionRouting(o.SectionRouting)),r.attributes.PassagewayRouting=r.data.PassagewayRouting=o);var o,n=this._getPointFeatureByObj(e[i].ToStation);e[i].ToStation.PassagewayRouting&&((o=this._getPointFeatureByObj(e[i].ToStation.PassagewayRouting)).SectionRouting&&(o.attributes.SectionRouting=o.data.SectionRouting=this._parserSectionRouting(o.SectionRouting)),n.attributes.PassagewayRouting=n.data.PassagewayRouting=o);var a=this._parserSectionLines(e[i].SectionLines.SectionLine),s=this._parserSectionRouting(e[i].SectionRouting);t.push({FromStation:r,SectionLine:a,ToStation:n,SectionRouting:s})}return t},_parserSectionLines:function(e){GeoGlobe.Util.isArray(e)||(e=[e]);for(var t=new Array,i=0;i<e.length;i++){var r=new GeoGlobe.Feature(null,e[i]);t.push(r)}return t},_parserSectionRouting:function(e){GeoGlobe.Util.isArray(e)||(e=[e]);for(var t=new Array,i=0;i<e.length;i++)t.push(e[i]);return t},_getPointGeometryByGMLPointStr:function(e){var t=e.split(",");return new GeoGlobe.Geometry.Point(_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(t[0]),_babel_runtime_corejs2_core_js_parse_float__WEBPACK_IMPORTED_MODULE_11___default()(t[1]))},_getPointFeatureByObj:function(e){var t=null;return e.Geometry&&e.Geometry.gml_Point&&(t=this._getPointGeometryByGMLPointStr(e.Geometry.gml_Point)),new GeoGlobe.Feature(t,e)},_getLineGeometryByGMLLineStr:function(e){if(!e)return null;for(var t=e.split(" "),i=[],r=0,o=t.length;r<o;r++){var n=this._getPointGeometryByGMLPointStr(t[r]);i.push(n)}return new GeoGlobe.Geometry.LineString(i)},queryTransferGeometry:function(e,t,i){var r={request:"QueryTransferGeometry",SERVICE:"BUS",VERSION:"1.0.0"};if(!e.networkName)throw"Error!Not network name for bus query.";if(null===e.parameterInfo||void 0===e.parameterInfo||""===e.parameterInfo)throw"Error!Not parameterInfo for bus query.";r.networkName=e.networkName,r.PARAMETERINFO="";for(var o=0;o<e.parameterInfo.length;o++)r.PARAMETERINFO+=e.parameterInfo[o].toString(),o!=e.parameterInfo.length-1&&(r.PARAMETERINFO+="_");null!==e.service&&void 0!==e.service&&(r.SERVICE=e.service),null!==e.version&&void 0!==e.version&&(r.VERSION=e.version),GeoGlobe.Request.GET({url:this.url,params:r,scope:this,async:!1,success:GeoGlobe.Function.bind((function(e){var i=this._parseQueryTransferGeometryResult(e);t(i)}),this),failure:i})},_parseQueryTransferGeometryResult:function(e){resXML=e.responseXML;var t=[];if(!resXML)return t;var i=new GeoGlobe.Format.XML,r=resXML.selectNodes("/QueryTransferGeometryResponse");if(r&&r.length<=0)return t;var o=i.write(r[0]),n=this._parseToJSON(o).QueryTransferGeometryResponse.SectionGeometry;if(n){GeoGlobe.Util.isArray(n)||(n=[n]);for(var a=0;a<n.length;a++){var s=this._getLineGeometryByGMLLineStr(n[a].Geometry.gml_LineString),l=new GeoGlobe.Feature(s,{ID:n[a].ID});t.push(l)}}return t},queryKeyWord:function(e,t,i){var r={REQUEST:"QueryKeyWord",SERVICE:"BUS",VERSION:"1.0.0",SEARCHTYPE:2};if(!e.networkName)throw"Error!Not network name for bus query.";if(null===e.keyWord||void 0===e.keyWord||""===e.keyWord)throw"Error!Not keyWord for bus query.";r.NETWORKNAME=e.networkName,r.KEYWORD=e.keyWord,null!==e.service&&void 0!==e.service&&(r.SERVICE=e.service),null!==e.version&&void 0!==e.version&&(r.VERSION=e.version),null!==e.searchType&&void 0!==e.searchType&&(r.SEARCHTYPE=e.searchType),null!==e.keyWordType&&void 0!==e.keyWordType&&(r.KEYWORDTYPE=e.keyWordType),GeoGlobe.Request.GET({url:this.url,params:r,async:!1,scope:this,success:GeoGlobe.Function.bind((function(i){var r=this._parserQueryKeyWordResult(i,e.keyWordType);t(r)}),this),failure:i})},_parserQueryKeyWordResult:function(e,t){var i=e.responseXML,r=[];if(!i)return r;var o=new GeoGlobe.Format.XML,n=i.selectNodes("/ServiceExceptionReport/ServiceExceptionMessage");if(n&&0<n.length)return r;var a=i.selectNodes("/QueryKeyWordResponse"),s=o.write(a[0]),l=this._parseToJSON(s);if(1===t){var u=l.QueryKeyWordResponse.Stations.Station;u&&!GeoGlobe.Util.isArray(u)&&(u=[u]);for(var h=0;h<u.length;h++){var c=this._getPointFeatureByObj(u[h]);r.push(c)}}else if(2===t){var p=l.QueryKeyWordResponse.Passageways.Passageway;for(p&&!GeoGlobe.Util.isArray(p)&&(p=[p]),h=0;h<p.length;h++)c=this._getPointFeatureByObj(p[h]),r.push(c)}else{var d=l.QueryKeyWordResponse.Lines.Line;for(d&&!GeoGlobe.Util.isArray(d)&&(d=[d]),h=0;h<d.length;h++){var f=new GeoGlobe.Feature(null,d[h]);r.push(f)}}return r},queryStationInfo:function(e,t,i){var r={REQUEST:"QueryStationInfo",SERVICE:"BUS",VERSION:"1.0.0"};if(!e.networkName)throw"Error!Not network name for bus query.";if(null===e.stationId||void 0===e.stationId||""===e.stationId)throw"Error!Not stationId for bus query.";r.NETWORKNAME=e.networkName,null!==e.service&&void 0!==e.service&&(r.SERVICE=e.service),null!==e.version&&void 0!==e.version&&(r.VERSION=e.version),null!==e.stationId&&void 0!==e.stationId&&(r.STATIONID=e.stationId),GeoGlobe.Request.GET({url:this.url,params:r,scope:this,success:function(e){if(resXML=e.responseXML,resXML){for(var i=new GeoGlobe.Format.XML,r=this._parserQueryStationInfoNode("Lines",i,resXML),o=this._parserQueryStationInfoNode("Passageways",i,resXML),n=new Array,a=0;a<o.length;a++){var s=this._getPointFeatureByObj(o[a]);n.push(s)}t({lines:r,passageways:n})}else t({lines:[],passageways:[]})},failure:i})},_parserQueryStationInfoNode:function(e,t,i){switch(e){case"Lines":var r=i.selectNodes("/QueryStationInfoResponse/StationInfo/Lines"),o=new Array;if(0<r.length){var n=t.write(r[0]);o=this._parseToJSON(n).Lines.Line,GeoGlobe.Util.isArray(o)||(o=[o])}return o;case"Passageways":r=i.selectNodes("/QueryStationInfoResponse");var a=new Array;if(0<r.length){n=t.write(r[0]);var s=this._parseToJSON(n).QueryStationInfoResponse.StationInfo.Passageways;s&&(a=s.Passageway,GeoGlobe.Util.isArray(a)||(a=[a]))}return a;default:return[]}},queryLineInfo:function(e,t,i){var r={REQUEST:"QueryLineInfo",SERVICE:"BUS",VERSION:"1.0.0"};if(!e.networkName)throw"Error!Not network name for bus query.";if(null===e.lineId||void 0===e.lineId||""===e.lineId)throw"Error!Not lineId for bus query.";r.NETWORKNAME=e.networkName,null!==e.service&&void 0!==e.service&&(r.SERVICE=e.service),null!==e.version&&void 0!==e.version&&(r.VERSION=e.version),null!==e.lineId&&void 0!==e.lineId&&(r.LINEID=e.lineId),null!==e.startNodeNumber&&void 0!==e.startNodeNumber&&(r.STARTNODENUMBER=e.startNodeNumber),null!==e.endNodeNumber&&void 0!==e.endNodeNumber&&(r.ENDNODENUMBER=e.endNodeNumber),GeoGlobe.Request.GET({url:this.url,params:r,scope:this,success:function(e){var i=[],r=null;if(e.responseXML){var o=(r=e.responseXML).selectNodes("/ServiceExceptionReport/ServiceExceptionMessage");if(o&&0<o.length)return void t(i);for(var n=new GeoGlobe.Format.XML,a=this._parserQueryLineInfoNode("Line",n,r),s=new Array,l=0;l<a.length;l++){for(var u=new Array,h=0;h<a[l].VIAStations.Station.length;h++){var c=this._getPointFeatureByObj(a[l].VIAStations.Station[h]);u.push(c)}a[l].Stations=u;var p=this._getLineGeometryByGMLLineStr(a[l].Geometry.gml_LineString),d=new GeoGlobe.Feature(p,a[l]);s.push(d)}i=s}t(i)},failure:i})},_parserQueryLineInfoNode:function(e,t,i){switch(e){case"Line":var r=i.selectNodes("/QueryLineInfoResponse"),o=t.write(r[0]),n=this._parseToJSON(o).QueryLineInfoResponse.Line;return new Array,n&&!GeoGlobe.Util.isArray(n)?[n]:n;default:return[]}},queryPassagewayInfo:function(e,t){var i={REQUEST:"QueryPassagewayInfo",SERVICE:"BUS",VERSION:"1.0.0"};if(!e.networkName)throw"Error!Not network name for bus query.";if(null===e.passagewayId||void 0===e.passagewayId||""===e.passagewayId)throw"Error!Not passagewayId for bus query.";i.NETWORKNAME=e.networkName,null!==e.service&&void 0!==e.service&&(i.SERVICE=e.service),null!==e.version&&void 0!==e.version&&(i.VERSION=e.version),null!==e.passagewayId&&void 0!==e.passagewayId&&(i.PASSAGEWAYID=e.passagewayId),GeoGlobe.Request.GET({url:this.url,params:i,scope:this,success:function(e){var i=e.responseXML,r=[];if(!i)return t(r),r;new GeoGlobe.Format.XML;var o=i.selectNodes("/ServiceExceptionReport/ServiceExceptionMessage");if(o&&0<o.length)return t(r),r;var n=this._parserResponseText(e.responseText);r=this._parserFeaturesNew(n,"Stations"),t(r)}})},_queryByName:function(e,t,i){var r=this,o=null;return r.queryKeyWord({networkName:r.networkName,keyWord:e,keyWordType:1,SEARCHTYPE:2},(function(e){if(0!=e.length){var n=e[0].geometry.x+" "+e[0].geometry.y;r.queryKeyWord({networkName:r.networkName,keyWord:t,keyWordType:1,SEARCHTYPE:2},(function(e){if(0!=e.length){var t=e[0].geometry.x+" "+e[0].geometry.y;o=r._queryTransferScheme(n,t,i)}else alert("没有查询到终点")}))}else alert("没有查询到起点")})),o},queryBus:function(e,t,i){var r=this,o=null;return r.getCapabilities(GeoGlobe.Function.bind((function(n){var a=n.responseXML;a&&a.documentElement||(a=n.responseText);var s=(new GeoGlobe.Format.BusCapabilities).read(a);if(s.capability){var l=s.capability.networks[0];if(r.networkName=l,"string"==typeof e&&"string"==typeof t)o=r._queryByName(e,t,i);else{var u=e.lng+" "+e.lat,h=t.lng+" "+t.lat;o=r._queryTransferScheme(u,h,i)}}else alert("公交服务请求失败，请检查服务是否正常运行或请求地址是否正确。\n请求地址："+url+"\n操作类型：GetCapabilities")}),this),(function(){alert("公交服务请求失败，请检查服务是否正常运行或请求地址是否正确。\n请求地址："+url+"\n操作类型：GetCapabilities")})),{flag:!!o,featuresInfo:o}},failFn:function(){alert("公交服务请求失败，请检查服务是否正常运行或请求地址是否正确。\n请求地址："+url+"\n操作类型：GetCapabilities")},_queryTransferScheme:function(e,t,i){return this.queryTransferScheme({networkName:this.networkName,transferMode:i||0,inputMode:0,startInput:e,endInput:t},(function(e){featuresInfo=e})),this.transferScheme=featuresInfo.transferScheme,featuresInfo},queryBusTransferSchemeByIndex:function(e){var t=null,r=_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(e),o=this.transferScheme[r].SectionInfo,n=new Array,a=new Array;for(i=0;i<o.length;i++){var s=o[i].SectionLine[0],l=s.data.ID,u=s.data.FromOrdinal,h=s.data.ToOrdinal;n.push([0,l,u,h]),a.push(o[i].FromStation),a.push(o[i].ToStation)}return this.queryTransferGeometry({networkName:this.networkName,parameterInfo:n},(function(e){var i=e,r=new GeoGlobe.Format.GeoJSON,o=r.write(i),n=r.write(a),s=new GeoGlobe.Format.JSON,l=s.read(o),u=s.read(n);t={lineFeatures:i,geojsonRoute:l,stationFeatures:a,geojsonStation:u}})),t},CLASS_NAME:"GeoGlobe.Query.BusQuery"}),document.implementation.hasFeature("XPath","3.0")&&(XMLDocument.prototype.selectNodes=function(e,t){t=t||this;for(var i=this.evaluate(e,t,(function(e){return{csw:"http://www.opengis.net/cat/csw",smmd:"http://data.sbsm.gov.cn/smmd/2007",wfs:"http://www.opengis.net/wfs",gml:"http://www.opengis.net/gml",geoglobe:"http://www.geostar.com.cn/geoglobe"}[e]||null}),XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),r=[],o=0;o<i.snapshotLength;o++)r[o]=i.snapshotItem(o);return r},Element.prototype.selectNodes=function(e){if(this.ownerDocument.selectNodes)return this.ownerDocument.selectNodes(e,this);throw"For XML Elements Only"}),document.implementation.hasFeature("XPath","3.0")&&(XMLDocument.prototype.selectSingleNode=function(e,t){t=t||this;var i=this.selectNodes(e,t);return 0<i.length?i[0]:null},Element.prototype.selectSingleNode=function(e){if(this.ownerDocument.selectSingleNode)return this.ownerDocument.selectSingleNode(e,this);throw"For XML Elements Only"}),GeoGlobe.Query.WFSQuery=GeoGlobe.Class4OL({url:null,version:"1.0.0",featureNS:null,isReverse:!1,featurePrefix:"",featureType:"",maxFeatures:10,filter:null,geometryName:"the_geom",protocol:null,format:null,formatOptions:null,isSeparate:!1,srsName:"EPSG:4326",time:null,userecent:!0,sortBy:null,groupBy:null,resultType:"Results",startPosition:null,initialize:function(e,t,i){this.url=e,this.featureType=t;var r=null;i&&(r=!0===i.isReverse||!1===i.isReverse?(this.isReverse=i.isReverse,!i.isReverse):!this.isReverse,i.format?(i.format instanceof GeoGlobe.Format.GML.v2||i.format instanceof GeoGlobe.Format.GML.v3)&&i.format.setFeatureType_(t):this.format=new GeoGlobe.Format.GML({xy:r})),GeoGlobe.Util.extend(this,i)},query:function(e,t,i){this.protocol=new GeoGlobe.Protocol.WFS({readFormat:this.format,formatOptions:this.formatOptions,propertyNames:this.propertyNames,maxFeatures:this.maxFeatures,featurePrefix:this.featurePrefix,featureNS:this.featureNS,url:this.url,version:this.version,geometryName:this.geometryName,featureType:this.featureType,time:this.time,userecent:this.userecent,srsName:this.srsName});var r=e||this.filter,o=t||this.successFn,n=i||this.failFn,a=GeoGlobe.Function.bind((function(e){if(e.success()){var t=e.features;this.isSeparate&&(t=this._separateFeatures(t));var i=this._read_trueName(e);i&&(t.trueNames=i);var r=(new GeoGlobe.Format.GeoJSON).write(t),a=(new GeoGlobe.Format.JSON).read(r);o({features:t,geojson:a})}else n()}),this);this.response=this.protocol.read({sortBy:this.sortBy,filter:r,callback:a})},queryPage:function(e,t,i,r){var o=r&&r.perPageNumber||15,n=((r&&r.pageNumber||1)-1)*o+1;this.protocol=new GeoGlobe.Protocol.WFS({readFormat:this.format,multi:!0,formatOptions:this.formatOptions,propertyNames:this.propertyNames,maxFeatures:o,startPosition:n,featurePrefix:this.featurePrefix,url:this.url,featureNS:this.featureNS,version:this.version,geometryName:this.geometryName,featureType:this.featureType,time:this.time,userecent:this.userecent,srsName:this.srsName});var a=e||this.filter,s=t||this.successFn,l=i||this.failFn,u=GeoGlobe.Function.bind((function(e){if(e.success()){var t=e.features;this.isSeparate&&(t=this._separateFeatures(t));var i=this._read_trueName(e);t.trueNames=i;var r=(new GeoGlobe.Format.GeoJSON).write(t),o=(new GeoGlobe.Format.JSON).read(r);s({features:t,geojson:o})}else l()}),this);this.response=this.protocol.read({sortBy:this.sortBy,filter:a,callback:u})},queryTotalNumber:function(e,t,i){var r=new GeoGlobe.Format.WFSHits;this.protocol=new GeoGlobe.Protocol.WFS({readFormat:r,propertyNames:this.propertyNames,resultType:"hits",maxFeatures:this.maxFeatures,featurePrefix:this.featurePrefix,featureNS:this.featureNS,url:this.url,version:this.version,geometryName:this.geometryName,featureType:this.featureType,time:this.time,userecent:this.userecent});var o=e||this.filter,n=t||this.successFn,a=i||this.failFn,s=GeoGlobe.Function.bind((function(e){if(e.success()){var t=e.features;n(t)}else a()}),this);this.response=this.protocol.read({filter:o,callback:s})},_read_trueName:function(e){var t=[];if(e.priv&&e.priv.responseText){if(null==this.format)return null;var i=this.format.getXMLDoc().getElementsByTagName("trueName");if(null==i||0==i.length)return null;for(var r=0;r<i.length;r++)t.push(i[r].text);return t}return t},getBufferRegion:function(e,t,i){var r=this._getFeaturesCenter(e);switch(i){case"km":t*=1e3;case"m":t=this._meterToDegree(t,r)}return GeoGlobe.Geometry.Polygon.createRegularPolygon(e.geometry,t,40,360)},_getFeaturesCenter:function(e){return this._getFeaturesExtent(e).getCenterLonLat()},_getFeaturesExtent:function(e){GeoGlobe.Util.isArray(e)||(e=[e]);var t=null;if(e&&0<e.length){t=new GeoGlobe.LngLatBounds;for(var i=null,r=0,o=e.length;r<o;r++)(i=e[r].geometry)&&t.extend(i.getBounds())}return t},_meterToDegree:function(e,t){var i=t.lat;return e*(899e-8/Math.cos(GeoGlobe.Util.rad(i)))},pointQuery:function(e,t,i,r,o){t=t||0,i=i||"degree";var n=new GeoGlobe.Filter.Spatial({type:GeoGlobe.Filter.Spatial.DWITHIN,property:this.geometryName,distance:t,distanceUnits:i,value:e});this.query(n,r,o)},pathQuery:function(e,t,i,r,o){t=t||0,i=i||"degree";var n=new GeoGlobe.Filter.Spatial({type:GeoGlobe.Filter.Spatial.DWITHIN,property:this.geometryName,distance:t,distanceUnits:i,value:e});this.query(n,r,o)},polygonQuery:function(e,t,i,r){var o=t?GeoGlobe.Filter.Spatial.CONTAINS:GeoGlobe.Filter.Spatial.INTERSECTS,n=new GeoGlobe.Filter.Spatial({type:o,property:this.geometryName,value:e});this.query(n,i,r)},bboxQuery:function(e,t,i){var r=new GeoGlobe.Filter.Spatial({type:GeoGlobe.Filter.Spatial.BBOX,property:this.geometryName,value:e});this.query(r,t,i)},attributeQuery:function(e,t,i,r,o,n){var a=r&&r.matchCase,s=r?r.lowerBoundary:null,l=r?r.upperBoundary:null,u=new GeoGlobe.Filter.Comparison({type:e,property:t,value:i,matchCase:a,lowerBoundary:s,upperBoundary:l});this.query(u,o,n)},statisticsQuery:function(e,t,i){this.protocol=new GeoGlobe.Protocol.WFS({readFormat:this.format,formatOptions:this.formatOptions,propertyNames:this.propertyNames,resultType:"statistics",maxFeatures:this.maxFeatures,featurePrefix:this.featurePrefix,featureNS:this.featureNS,url:this.url,version:this.version,geometryName:this.geometryName,featureType:this.featureType,time:this.time,userecent:this.userecent});var r=e||this.filter,o=t||this.successFn,n=i||this.failFn,a=GeoGlobe.Function.bind((function(e){if(e.success()){try{var t=e.priv.responseXML,i=this._analysis_StatisticsResult(t)}catch(t){return void o(e.priv.responseText)}o(i)}else n()}),this);this.response=this.protocol.read({sortBy:this.sortBy,groupBy:this.groupBy,filter:r,callback:a})},_analysis_StatisticsResult:function(e){var t={},i=e.documentElement.firstChild.childNodes;return 0<i.length&&(t.layers=this._analysis_StatisticsResult_results(i)),t},_analysis_StatisticsResult_results:function(e){for(var t=[],i=0;i<e.length;i++){for(var r={},o=[],n=e[i].childNodes,a=0;a<n.length;a++){var s={};s.layerName=n[a].parentNode.nodeName,"Microsoft Internet Explorer"==navigator.appName?s.result=this._analysis_StatisticsResult_results_result_IE(n[a]):s.result=this._analysis_StatisticsResult_results_result_google(n[a]),o.push(s)}r.results=o,t.push(r)}return t},_analysis_StatisticsResult_results_result_IE:function(e){var t={},i=0;"Key"==e.childNodes[0].nodeName&&(t.Key=e.childNodes[0].text,i=1);for(var r=[],o=[];i<e.childNodes.length;i++){var n={},a={};n.name=e.childNodes[i].getAttribute("name"),a.Value=e.childNodes[i].text,r.push(n),o.push(a)}return t.name=r,t.values=o,t},_analysis_StatisticsResult_results_result_google:function(e){var t={},i=0;"Key"==e.childNodes[0].nodeName&&(t.Key=e.childNodes[0].innerHTML,i=1);for(var r=[],o=[];i<e.childNodes.length;i++){var n={},a={};n.name=e.childNodes[i].getAttribute("name"),a.Value=e.childNodes[i].innerHTML,r.push(n),o.push(a)}return t.name=r,t.values=o,t},successFn:function(){},failFn:function(){alert("对不起,查询失败,请查询服务是否正常。")},_separateFeatures:function(e){for(var t={},i=0;i<e.length;i++){var r,o=e[i];t[r=o.gml?o.gml.featureType:o.type]||(t[r]=[]),t[r].push(o)}return t},setTime:function(e){this.time=e},setUserecent:function(e){this.userecent=e},CLASS_NAME:"GeoGlobe.Query.WFSQuery"}),GeoGlobe.Query.WFSQuery.reverseGeometryXY=function(e){var t={Point:function(e){var t=e.x,i=e.y,r=e.clone(e);return r.x=i,r.y=t,r},LineString:function(e,t){for(var i=e.clone(e),r=0;r<i.components.length;r++){var o=t.Point(i.components[r]);i.components[r]=o}return i},Polygon:function(e,t){for(var i=e.clone(e),r=0;r<i.components.length;r++)for(var o=0;o<i.components[r].components.length-1;o++){var n=t.Point(i.components[r].components[o]);i.components[r].components[o]=n}return i}};return t[{"GeoGlobe.Geometry.Point":"Point","GeoGlobe.Geometry.MultiPoint":"MultiPoint","GeoGlobe.Geometry.LineString":"LineString","GeoGlobe.Geometry.MultiLineString":"MultiLineString","GeoGlobe.Geometry.Polygon":"Polygon","GeoGlobe.Geometry.MultiPolygon":"MultiPolygon","GeoGlobe.Geometry.Collection":"GeometryCollection"}[e.CLASS_NAME]](e,t)},GeoGlobe.Format.WFSHits=GeoGlobe.Class4OL(GeoGlobe.Format.XML,{wfsns:"http://www.opengis.net/wfs",featureCollection:"FeatureCollection",read:function(e){"string"==typeof e&&(e=GeoGlobe.Format.XML.prototype.read.apply(this,[e]));var t=e.documentElement;return{numberOfFeatures:_babel_runtime_corejs2_core_js_parse_int__WEBPACK_IMPORTED_MODULE_7___default()(t.getAttribute("numberOfFeatures"))}}}),GeoGlobe.Query.GeoCodingQuery=function(e,t){t=GeoGlobe.Util.applyDefaults(t,GeoGlobe.Query.GeoCodingQuery.DEFAULTS);var i=GeoGlobe.Query.GeoCodingQuery["v"+t.version.replace(/\./g,"_")];if(!i)throw"不支持的地址匹配服务版本: "+t.version;return new i(e,t)},GeoGlobe.Query.GeoCodingQuery.DEFAULTS={version:"1.0.0"},GeoGlobe.Query.GeoCodingQuery.v1=GeoGlobe.Class4OL({version:"1.0.0",url:null,initialize:function(e,t){this.url=e,GeoGlobe.Util.extend(this,t),this.format=new GeoGlobe.Format.JSON},getCommonParams:function(e){var t={request:"GetCategory",service:"GeoCoding",version:this.version,output:"json"};return GeoGlobe.Util.extend(t,e),t},getCategoryByName:function(e,t,i){var r=this.getCommonParams();"string"==typeof e&&0!==e.length&&(r.categoryName=e),i=i||this.failFn,GeoGlobe.Function.bind(this._requestCategory,this)(r,t,i)},getCategoryByCode:function(e,t,i){var r=this.getCommonParams();"number"==typeof e&&(r.categoryCode=e),GeoGlobe.Function.bind(this._requestCategory,this)(r,t,i)},getAllCategory:function(e,t){var i=this.getCommonParams();GeoGlobe.Function.bind(this._requestCategory,this)(i,e,t)},_requestCategory:function(e,t,i){i=i||this.failFn,GeoGlobe.loadURL(this.url,e,this,(function(e){try{var i=this.format.read(e.responseText)}catch(i){return void t(e.responseText)}t(i)}),i)},_analysis_GeoCodeResult:function(e){var t={status:e.status};switch(e.status){case"OK":(i=e.results)&&(t.results=this._analysis_GeoCodeResult_results(i));break;case"INVALID_REQUEST":case"NO_RESULTS":case"UNKNOWN_ERROR":break;default:var i;t={requestKeyWord:e.requestKeyWord,count:e.count,statisticsLevel:e.statisticsLevel,statisticsLevelName:e.statisticsLevelName},e&&0<e.count&&(i=e.results)&&(t.results=this._analysis_GeoCodeResult_statistics(i))}return t},_analysis_GeoCodeResult_results:function(e){var t=[];if(GeoGlobe.Util.isArray(e)){for(var i=0,r=e.length;i<r;i++){var o={};o.requestKeyWord=e[i].requestKeyWord,e[i].errorCorrectionTips&&(o.errorCorrectionTips=e[i].errorCorrectionTips),o.count=e[i].count,e[i].result&&(o.result=this._analysis_GeoCodeResult_results_result(e[i].result)),t.push(o)}return t}},_analysis_GeoCodeResult_statistics:function(e){var t=[];if(GeoGlobe.Util.isArray(e)){for(var i=0,r=e.length;i<r;i++){var o={};e[i].errorCorrectionTips&&(o.errorCorrectionTips=e[i].errorCorrectionTips),e[i]&&(o.name=e[i].name,o.value=e[i].value,o.remark=e[i].remark),t.push(o)}return t}},_analysis_GeoCodeResult_results_result:function(e){for(var t=[],i=0,r=e.length;i<r;i++){var o={},n={};o.resultType=e[i].resultType,o.precise=e[i].precise,o.isBrief=e[i].isBrief,o.score=e[i].score,e[i].addressComponent.street&&(n=e[i].addressComponent.street),0==o.isBrief&&(o.addressComponent=this._analysis_GeoCodeResult_results_result_address(e[i].addressComponent,o.resultType)),o.poiArray=this._analysispoiArray(e[i].poiArray),e[i].location&&(o.location=e[i].location),0==o.precise&&(o.referenceAddressArray=e[i].referenceAddressArray),n&&(o.street_path=n),t.push(o)}return t},_analysis_GeoCodeResult_results_result_address:function(e,t){var i={country:e.country};if(e.province&&(i.province=e.province),e.city&&(i.city=e.city),e.district&&(i.district=e.district),e.town&&(i.town=e.town),e.street&&(i.street={name:e.street.name},"street"===t&&e.street.geometry)){var r=this.format.read(e.street.geometry),o=null;(r.paths||r.rings||r.x&&r.y)&&(o=this._getGeometry(r),i.street.geometry=o)}if(e.streetNumber&&(i.streetNumber=e.streetNumber),e.buildingNumber&&(i.buildingNumber=e.buildingNumber),"adminArea"===t){if(e.geometry){var n=this.format.read(e.geometry),a=null;n.rings||n.paths?(a=this._getGeometry(n),i.geometry=a):"number"==typeof n.x&&"number"==typeof n.y&&(i.geometry=this._getGeometry(n))}e.subordinate&&(i.subordinate=e.subordinate),e.zipCode&&(i.zipCode=e.zipCode),e.callingCode&&(i.callingCode=e.callingCode)}return i},_analysispoiArray:function(e){for(var t=[],i=0,r=e.length;i<r;i++){var o={};for(var n in e[i])o[n]=e[i][n];if(""!=o.geometry&&null!=o.geometry){var a=this.format.read(o.geometry);o.geometry=this._getGeometry(a)}t.push(o)}return t},_analysisLocation:function(){},_getGeometry:function(e){for(var t in e){if("spatialReference"==t)return;return e=e.hasOwnProperty("x")&&e.hasOwnProperty("y")?new GeoGlobe.Geometry.Point(e.x,e.y):e.hasOwnProperty("xmin")&&e.hasOwnProperty("ymin")&&e.hasOwnProperty("xmax")&&e.hasOwnProperty("ymax")?new GeoGlobe.Bounds(e.xmin,e.ymin,e.xmax,e.ymax).toGeometry():this._geometryType[t](e[t])}},_geometryType:{points:function(e){var t=[];if(GeoGlobe.Util.isArray(e))for(var i=0,r=e.length;i<r;i++){var o=new GeoGlobe.Geometry.Point(e[i][0],e[i][1]);t.push(o)}return t},paths:function(e){var t=[];if(GeoGlobe.Util.isArray(e)){for(var i=0,r=e.length;i<r;i++){for(var o=[],n=0,a=e[i].length;n<a;n++)o.push(new GeoGlobe.Geometry.Point(e[i][n][0],e[i][n][1]));var s=new GeoGlobe.Geometry.LineString(o);t.push(s)}var l=new GeoGlobe.Geometry.MultiLineString(t)}return l},rings:function(e){var t=[];if(GeoGlobe.Util.isArray(e)){for(var i=0,r=e.length;i<r;i++){for(var o=[],n=0,a=e[i].length;n<a;n++)o.push(new GeoGlobe.Geometry.Point(e[i][n][0],e[i][n][1]));var s=new GeoGlobe.Geometry.LinearRing(o);t.push(s)}var l=new GeoGlobe.Geometry.Polygon(t)}return l}},failFn:function(e){"string"==typeof e&&alert(e),alert("对不起，查询请求失败！请检查地址匹配服务是否正常运行。\n当前服务地址为："+this.url)},CLASS_NAME:"GeoGlobe.Query.GeoCodingQuery.v1"}),GeoGlobe.Query.GeoCodingQuery.v1_0_0=GeoGlobe.Class4OL(GeoGlobe.Query.GeoCodingQuery.v1,{addressesToLocations:function(e,t){var i=this.getCommonParams({request:"GeoCoder"});if("string"==typeof e.address)i.address=e.address;else if(GeoGlobe.Util.isArray(e.address)){for(var r="",o=0;o<e.address.length;o++)r+=e.address[o]+",";r=r.substr(0,r.length-1),i.address=r}else if(null==e.address||null==e.address)throw"address是必选参数！";if("number"==typeof e.categoryCode&&(i.categoryCode=e.categoryCode),e.extent instanceof GeoGlobe.LngLatBounds)i.bbox=e.extent.toBBOX(null,!0);else if(e.extent instanceof GeoGlobe.Geometry.Polygon){for(var n=e.extent,a=[],s=(o=0,n.components.length);o<s;o++)for(var l=n.components[o].components,u=0;u<l.length;u++)a.push(l[u].toShortString());i.bbox=a.join(",")}"boolean"==typeof e.fuzzyMatch&&(i.fuzzyMatch=e.fuzzyMatch),"string"==typeof e.resultType&&(i.resultType=e.resultType),"number"==typeof e.maxCount&&(i.maxCount=e.maxCount),"number"==typeof e.startPosition&&(i.startPosition=e.startPosition),GeoGlobe.loadURL(this.url,i,this,(function(e){try{var r=this.format.read(e.responseText);if("result"==i.resultType)var o=this._parseQueryResultToFeature(r);else o=this._analysis_GeoCodeResult(r)}catch(r){return void t(e.responseText)}t(o)}),this.failFn)},locationToAddresses:function(e,t){var i=this.getCommonParams({request:"GeoCoder"});if(!e.lonlat)throw"address是必选参数！请填写正确的数据类型！";i.latlng=e.lonlat.lat+","+e.lonlat.lng,"number"==typeof e.tolerance&&(i.tolerance=e.tolerance),"string"==typeof e.unit&&(i.unit=e.unit),"string"==typeof e.resultType&&(i.resultType=e.resultType),"number"==typeof e.maxCount&&(i.maxCount=e.maxCount),"number"==typeof e.startPosition&&(i.startPosition=e.startPosition),GeoGlobe.loadURL(this.url,i,this,(function(e){try{var r=this.format.read(e.responseText);if("result"==i.resultType)var o=this._parseQueryResultToFeature(r);else o=this._analysis_GeoCodeResult(r)}catch(r){return void t(e.responseText)}t(o,r)}),this.failFn)},getLocations:function(e,t,i){this.addressesToLocations(e,GeoGlobe.Function.bind((function(e){t(this._parseQueryResultToFeature(e,total))}),this),i)},getLocationsByPage:function(e,t,i){e.resultType="hits",this.addressesToLocations(e,GeoGlobe.Function.bind((function(r){if("OK"==r.status){e.resultType="result";var o=r.results[0].count;null!=e.maxCount&&null!=e.maxCount||(e.maxCount=3),e.startPosition=(e.startPosition-1)*e.maxCount+1,this.addressesToLocations(e,GeoGlobe.Function.bind((function(e){t(this._parseQueryResultToFeature(e,o))}),this),i)}else alert("没有查询到任何数据")}),this),i)},getAddresses:function(e,t,i){this.locationToAddresses(e,GeoGlobe.Function.bind((function(e){t(this._parseQueryResultToFeature(e,total))}),this),i)},getAddressesByPage:function(e,t,i){e.resultType="hits",this.locationToAddresses(e,GeoGlobe.Function.bind((function(r){if("OK"==r.status){e.resultType="result";var o=r.results[0].count;null!=e.maxCount&&null!=e.maxCount||(e.maxCount=3),e.startPosition=(e.startPosition-1)*e.maxCount+1,this.locationToAddresses(e,GeoGlobe.Function.bind((function(e){t(this._parseQueryResultToFeature(e,o))}),this),i)}else alert("没有查询到任何数据")}),this),i)},_parseQueryResultToFeature:function(e){var t=[];if("OK"==e.status&&e.results)for(var i=0;i<e.results.length;i++){var r=e.results[i].result;if(r)for(var o=0;o<r.length;o++){var n={},a=null;if(n.requestKeyWord=e.results[i].requestKeyWord,GeoGlobe.Util.isArray(r[o].poiArray))for(var s=0;s<r[o].poiArray.length;s++)n.CONTINENT=r[o].poiArray[s].CONTINENT,n.GBCODE=r[o].poiArray[s].GBCODE,n.STANDARDNAME=r[o].poiArray[s].STANDARDNAME,n.name=r[o].poiArray[s].name;if(r[o].addressComponent){var l=r[o].addressComponent;n.address=this._getAddress(l,n.name),n.country=r[o].addressComponent.country,n.province=r[o].addressComponent.province,n.city=r[o].addressComponent.city,n.district=r[o].addressComponent.district,r[o].addressComponent.street?(n.streetName=r[o].addressComponent.street.name,n.streetgeometry=r[o].addressComponent.street.geometry):n.streetName="",n.streetNumber=r[o].addressComponent.streetNumber}r[o].location&&(r[o].location.lng&&(n.lng=r[o].location.lng),r[o].location.lat&&(n.lat=r[o].location.lat),a=new GeoGlobe.Geometry.Point(r[o].location.lng,r[o].location.lat)),n.isBrief=r[o].isBrief,n.precise=r[o].precise,n.resultType=r[o].resultType,n.score=r[o].score;var u=new GeoGlobe.Feature(a,n);t.push(u)}}var h=(new GeoGlobe.Format.GeoJSON).write(t),c=(new GeoGlobe.Format.JSON).read(h);return{status:e.status,features:t,geojsonFeatures:c}},_getAddress:function(e,t){var i="";return e.country&&(i+=e.country),e.province&&(i+=e.province),e.city&&(i+=e.city),e.district&&(i+=e.district),e.street&&(e.street.name&&(i+=e.street.name),e.streetNumber&&(i+=e.streetNumber+"号")),t&&(i+=t),i},CLASS_NAME:"GeoGlobe.Query.GeoCodingQuery.v1_0_0"}),GeoGlobe.Query.GeoCodingQuery.v1_1_0=GeoGlobe.Class4OL(GeoGlobe.Query.GeoCodingQuery.v1,{method:"get",initialize:function(e,t){GeoGlobe.Util.extend(this,t),this.filterFormat=new GeoGlobe.Format.Filter,GeoGlobe.Query.GeoCodingQuery.v1.prototype.initialize.apply(this,arguments)},addressesToLocations:function(e,t,i){var r=this.getCommonParams({request:"GeoCoder"});if(r.reverseMatch=!1,"string"==typeof e.address&&(r.keyword=e.address),"number"==typeof e.categoryCode&&(r.categoryCode=e.categoryCode),!(null!=e.address&&null!=e.address||null!=e.categoryCode&&null!=e.categoryCode))throw"address是必选参数！";if(e.extent instanceof GeoGlobe.LngLatBounds)r.bbox=e.extent.toBBOX(null,!0);else if(e.extent instanceof GeoGlobe.Geometry.Polygon){for(var o=e.extent,n=[],a=0,s=o.components.length;a<s;a++)for(var l=o.components[a].components,u=0;u<l.length;u++)n.push(l[u].toShortString());r.bbox=n.join(",")}if(e.filter instanceof GeoGlobe.Filter){var h=this.filterFormat.write(e.filter),c=GeoGlobe.Format.XML.prototype.write.apply(this.filterFormat,[h]);r.filter=c}"string"==typeof e.resultType&&(r.resultType=e.resultType),"statistics"==e.resultType&&(r.statisticsLevel=e.statisticsLevel),"number"==typeof e.maxCount&&(r.maxCount=e.maxCount),"number"==typeof e.startPosition&&(r.startPosition=e.startPosition),"boolean"==typeof e.semanticAnalysis&&(r.semanticAnalysis=e.semanticAnalysis),"boolean"==typeof e.customWeight&&(r.customWeight=e.customWeight),this._setGeoCoderCommonProperty(r,e),this._getCodingRequest(r,t,i)},_getCodingRequest:function(e,t){if("get"==this.method)GeoGlobe.loadURL(this.url,e,this,(function(i){try{var r=this.format.read(i.responseText);if("result"==e.resultType)var o=this._parseQueryResultToFeature(r);else o=this._analysis_GeoCodeResult(r)}catch(r){return void t(i.responseText)}t(o)}),this.failFn);else{var i=GeoGlobe.Util.getParameterString(e);GeoGlobe.Request.POST({url:this.url,data:i,success:function(e){try{var i=this.format.read(e.responseText),r=this._analysis_GeoCodeResult(i)}catch(i){return void t(e.responseText)}t(r)},failure:this.failFn,scope:this})}},_setGeoCoderCommonProperty:function(e,t){"string"==typeof t.sortFields&&(e.sortFields=t.sortFields),"string"==typeof t.scoreFilter&&(e.scoreFilter=t.scoreFilter)},locationToAddresses:function(e,t,i){var r=this.getCommonParams({request:"GeoCoder"});if(r.reverseMatch=!0,!e.lonlat)throw"address是必选参数！请填写正确的数据类型！";r.keyword=e.lonlat.lat+","+e.lonlat.lng,"number"==typeof e.tolerance&&(r.tolerance=e.tolerance),"string"==typeof e.unit&&(r.unit=e.unit),"string"==typeof e.resultType&&(r.resultType=e.resultType),"statistics"==e.resultType&&(r.statisticsLevel=e.statisticsLevel),"number"==typeof e.maxCount&&(r.maxCount=e.maxCount),"number"==typeof e.startPosition&&(r.startPosition=e.startPosition),"boolean"==typeof e.customWeight&&(r.customWeight=e.customWeight),this._setGeoCoderCommonProperty(r,e),this._getCodingRequest(r,t,i)},batchAddressesToLocations:function(e,t,i){var r=this.getCommonParams({request:"BatchGeoCoder",service:"GeoCoding"});if(r.reverseMatch=!1,GeoGlobe.Util.isArray(e.address)){for(var o="",n=0;n<e.address.length;n++)o+=e.address[n]+",";o=o.substr(0,o.length-1),r.keywords=o}else if(null==e.address||null==e.address)throw"address是必选参数！";if("number"==typeof e.singleKeywordResultCount&&(r.singleKeywordResultCount=e.singleKeywordResultCount),e.filter instanceof GeoGlobe.Filter){var a=this.filterFormat.write(e.filter),s=GeoGlobe.Format.XML.prototype.write.apply(this.filterFormat,[a]);r.filter=s}this._setGeoCoderCommonProperty(r,e),this._getCodingRequest(r,t,i)},batchLocationToAddresses:function(e,t,i){var r=this.getCommonParams({request:"BatchGeoCoder",service:"GeoCoding"});if(r.reverseMatch=!0,e.lonlats instanceof GeoGlobe.LonLat)e.lonlats=[e.lonlats];else if(!GeoGlobe.Util.isArray(e.lonlats))throw"address是必选参数！请填写正确的数据类型！";if(GeoGlobe.Util.isArray(e.lonlats)){for(var o="",n=0;n<e.lonlats.length;n++)o+=e.lonlats[n].lat+","+e.lonlats[n].lng+";";o=o.substr(0,o.length-1),r.keywords=o}"number"==typeof e.tolerance&&(r.tolerance=e.tolerance),"string"==typeof e.unit&&(r.unit=e.unit),"number"==typeof e.singleKeywordResultCount&&(r.singleKeywordResultCount=e.singleKeywordResultCount),this._setGeoCoderCommonProperty(r,e),this._getCodingRequest(r,t,i)},_getAddress:function(e,t){var i="";return e.country&&(i+=e.country),e.province&&(i+=e.province),e.city&&(i+=e.city),e.district&&(i+=e.district),e.street&&(e.street.name&&(i+=e.street.name),e.streetNumber&&(i+=e.streetNumber+"号")),t&&(i+=t),i},getLocations:function(e,t,i){this.addressesToLocations(e,GeoGlobe.Function.bind((function(e){t(this._parseQueryResultToFeature(e,total))}),this),i)},getLocationsByPage:function(e,t,i){e.resultType="hits",this.addressesToLocations(e,GeoGlobe.Function.bind((function(r){if("OK"==r.status){e.resultType="result";var o=r.results[0].count;null!=e.maxCount&&null!=e.maxCount||(e.maxCount=3),e.startPosition=(e.startPosition-1)*e.maxCount+1,this.addressesToLocations(e,GeoGlobe.Function.bind((function(e){t(this._parseQueryResultToFeature(e,o))}),this),i)}else alert("没有查询到任何数据")}),this),i)},getAddresses:function(e,t,i){this.locationToAddresses(e,GeoGlobe.Function.bind((function(e){t(this._parseQueryResultToFeature(e,total))}),this),i)},getAddressesByPage:function(e,t,i){e.resultType="hits",this.locationToAddresses(e,GeoGlobe.Function.bind((function(r){if("OK"==r.status){e.resultType="result";var o=r.results[0].count;null!=e.maxCount&&null!=e.maxCount||(e.maxCount=3),e.startPosition=(e.startPosition-1)*e.maxCount+1,this.locationToAddresses(e,GeoGlobe.Function.bind((function(e){t(this._parseQueryResultToFeature(e,o))}),this),i)}else alert("没有查询到任何数据")}),this),i)},batchGetAddresses:function(e,t,i){this.batchLocationToAddresses(e,GeoGlobe.Function.bind((function(e){t(this._parseQueryResultToFeature(e))}),this),i)},batchGetLocations:function(e,t,i){this.batchAddressesToLocations(e,GeoGlobe.Function.bind((function(e){t(this._parseQueryResultToFeature(e))}),this),i)},_parseQueryResultToFeature:function(e){var t=[];if("OK"==e.status&&e.results)for(var i=0;i<e.results.length;i++){var r=e.results[i].result;if(r)for(var o=0;o<r.length;o++){var n={},a=null;if(n.requestKeyWord=e.results[i].requestKeyWord,GeoGlobe.Util.isArray(r[o].poiArray))for(var s=0;s<r[o].poiArray.length;s++)n.CONTINENT=r[o].poiArray[s].CONTINENT,n.GBCODE=r[o].poiArray[s].GBCODE,n.STANDARDNAME=r[o].poiArray[s].STANDARDNAME,n.name=r[o].poiArray[s].name;if(r[o].addressComponent){var l=r[o].addressComponent;n.address=this._getAddress(l,n.name),n.country=r[o].addressComponent.country,n.province=r[o].addressComponent.province,n.city=r[o].addressComponent.city,n.district=r[o].addressComponent.district,r[o].addressComponent.street?(n.streetName=r[o].addressComponent.street.name,n.streetgeometry=r[o].addressComponent.street.geometry):n.streetName="",n.streetNumber=r[o].addressComponent.streetNumber}r[o].location&&(r[o].location.lng&&(n.lng=r[o].location.lng),r[o].location.lat&&(n.lat=r[o].location.lat),a=new GeoGlobe.Geometry.Point(r[o].location.lng,r[o].location.lat)),n.isBrief=r[o].isBrief,n.precise=r[o].precise,n.resultType=r[o].resultType,n.score=r[o].score;var u=new GeoGlobe.Feature(a,n);t.push(u)}}var h=(new GeoGlobe.Format.GeoJSON).write(t),c=(new GeoGlobe.Format.JSON).read(h);return{status:e.status,features:t,geojsonFeatures:c}},CLASS_NAME:"GeoGlobe.Query.GeoCodingQuery.v1_1_0"}),GeoGlobe.Service=GeoGlobe.Class({name:null,url:null,version:null,userid:"test@liferay.com",initialize:function(e,t,i){this.name=e,this.url=t,GeoGlobe.Util.extend(this,i)},getCapabilities:function(){},isExist:function(){},failFn:function(e){alert("服务请求失败，请检查服务是否正常运行或请求地址是否正确。\n请求地址："+this.url+"\n操作类型："+e)},_parseToXML:function(e){var t=e.responseXML;return t&&t.documentElement||(t=e.responseText),(new GeoGlobe.Format.XML).read(t)},_checkIsError:function(e){return 0<(new GeoGlobe.Format.XML).read(e).selectNodes("ServiceExceptionReport").length?this._parseToJSON(e):null},_isException:function(e){return!(!e||!e.ServiceExceptionReport)},_parseToJSON:function(e){return(new GeoGlobe.Util.Format.XML2JSON).read(e)},CLASS_NAME:"GeoGlobe.Service"}),GeoGlobe.Service.WFST=GeoGlobe.Class4OL(GeoGlobe.Service,{xy:!0,initialize:function(e,t,i){GeoGlobe.Service.prototype.initialize.apply(this,arguments)},getCapabilities:function(e,t){var i=this.url,r={REQUEST:"GetCapabilities",SERVICE:"WFS",VERSION:"1.0.0"};t=t||function(){this.failFn(r.REQUEST)},GeoGlobe.loadURL(i,r,this,(function(t){e(t)}),t)},isExist:function(){var e=!1,t=this.url;return GeoGlobe.Request.GET({url:t,params:{REQUEST:"GetCapabilities",SERVICE:"WFS"},scope:this,async:!1,success:function(){e=!0}}),e},describeFeatureType:function(e,t,i){var r=this.url;GeoGlobe.Util.applyDefaults(e,{SERVICE:"WFS",VERSION:"1.0.0",REQUEST:"DescribeFeatureType"}),i=i||function(){this.failFn(e.REQUEST)},GeoGlobe.loadURL(r,e,this,(function(e){t(e)}),i)},getFeature:function(e,t,i){var r=this.url;GeoGlobe.Util.applyDefaults(e,{SERVICE:"WFS",VERSION:"1.0.0",REQUEST:"GetFeature"}),i=i||function(){this.failFn(e.REQUEST)},GeoGlobe.loadURL(r,e,this,(function(e){t(e)}),i)},lockFeature:function(e,t,i){this.url,GeoGlobe.Util.applyDefaults(e,{service:"WFS",version:"1.0.0",request:"LockFeature",expiry:1,lockAction:"ALL"});var r=this._parserFilterToString(e.filter),o=GeoGlobe.String.format('<?xml version="1.0" encoding="UTF-8"?><LockFeature version="${version}" service="${service}" lockAction="${lockAction}" expiry="${expiry}" xmlns:wfs=" http://www.opengis.net/wfs" xmlns:gml=" http://www.opengis.net/gml" xmlns:myns=" http://www.someserver.com/myns" xmlns:ogc=" http://www.opengis.net/ogc" xmlns:xsi=" http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.opengis.net/wfs ../wfs/1.1.0/WFS.xsd"><Lock typeName="${typeName}">${filterXMLString}</Lock></LockFeature>',{version:e.version,service:e.service,lockAction:e.lockAction,expiry:e.expiry,typeName:e.typeName,filterXMLString:r});i=i||function(){this.failFn(e.request)},new GeoGlobe.Request.POST({url:this.url,data:o,scope:this,success:t,failure:i})},transaction:function(e,t,i,r,o,n){var a=this.url;GeoGlobe.Util.applyDefaults(e,{service:"WFS",version:"1.0.0",request:"Transaction",releaseAction:"ALL"});var s=e.lockId,l="";s&&(l+="<LockId>"+s+"</LockId>");var u="";t&&(u+=this._getInsertString(t)),i&&(u+=this._getUpdateString(i)),r&&(u+=this._getDeleteString(r));var h=GeoGlobe.String.format('<?xml version="1.0" encoding="UTF-8"?><wfs:Transaction releaseAction="${releaseAction}" handle="Transaction 01" version="${version}" service="${service}" xmlns="http://www.someserver.com/myns" xmlns:gml="http://www.opengis.net/gml" xmlns:ogc="http://www.opengis.net/ogc" xmlns:wfs="http://www.opengis.net/wfs" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">${lockIdString}${transactionString}</wfs:Transaction>',{releaseAction:e.releaseAction,version:e.version,service:e.service,lockIdString:l,transactionString:u});n=n||function(){this.failFn(e.request)},new GeoGlobe.Request.POST({url:a,data:h,scope:this,success:o,failure:n})},parseTransactionResult:function(e){var t=(new GeoGlobe.Format.XML2JSON).read(e.responseText),i=new Array,r=this._objToArray(t.wfs_WFS_TransactionResponse.wfs_TransactionResult.wfs_Status),o=this._objToArray(t.wfs_WFS_TransactionResponse.wfs_InsertResults);if(!r)return i;for(var n=0;n<r.length;n++)void 0!==r[n].wfs_SUCCESS?i.push({status:"SUCCESS",fid:o&&o[n]?o[n].ogc_FeatureId.fid:null}):i.push({status:"FAILED",fid:null});return i},_objToArray:function(e){return!e||e instanceof Array||(e=[e]),e},_getInsertString:function(e){for(var t=e.features,i=e.typeName,r="",o=0;o<t.length;o++){var n=t[o];r+='<wfs:Insert handle="Insert '+o+'">'+this._getInsertFeatureString(n,i)+"</wfs:Insert>"}return r},_getInsertFeatureString:function(e,t){var i="";for(var r in e.attributes)"OID"!=r&&(i+=GeoGlobe.String.format("<${tag}><![CDATA[${value}]]></${tag}>",{value:e.attributes[r]?e.attributes[r]:"",tag:r}));return i+=GeoGlobe.String.format("<GEOMETRY>${geometry}</GEOMETRY>",{geometry:this._getGeometryStringByFeature(e)}),GeoGlobe.String.format("<${typeName}>${content}</${typeName}>",{typeName:t,content:i})},_getUpdateString:function(e){e.filter;for(var t=e.typeName,i=e.features,r="",o=0;o<i.length;o++)if(i[o].geometry){var n=this._getUpdatePropertyString(i[o]),a=new GeoGlobe.Filter.FeatureId({fids:[t+"."+i[o].attributes.OID]});r+='<wfs:Update typeName="'+t+'" handle="Update '+o+'">'+n+this._parserFilterToString(a)+"</wfs:Update>"}return r},_getUpdatePropertyString:function(e){var t="";for(var i in e.data)"OID"!=i&&e.data[i]&&(t+="<wfs:Property><wfs:Name><![CDATA["+i+"]]></wfs:Name><wfs:Value><![CDATA["+(e.data[i]?e.data[i]:"")+"]]></wfs:Value></wfs:Property>");return t+"<wfs:Property><wfs:Name>Geometry</wfs:Name><wfs:Value>"+this._getGeometryStringByFeature(e)+"</wfs:Value></wfs:Property>"},_getGeometryStringByFeature:function(e){var t=new GeoGlobe.Format.GML({xy:this.xy});t.buildCoordinatesNode=GeoGlobe.Function.bind((function(e){var t=this.createElementNS(this.gmlns,"gml:coordinates");t.setAttribute("decimal","."),t.setAttribute("cs",","),t.setAttribute("ts"," ");var i=[];if(e instanceof GeoGlobe.LngLatBounds)this.xy?(i.push(e.left+","+e.bottom),i.push(e.right+","+e.top)):(i.push(e.bottom+","+e.left),i.push(e.top+","+e.right));else for(var r=e.components?e.components:[e],o=0;o<r.length;o++)this.xy?i.push(r[o].x+","+r[o].y):i.push(r[o].y+","+r[o].x);var n=this.createTextNode(i.join(" "));return t.appendChild(n),t}),t);var i=t.buildGeometryNode(e.geometry);return(new GeoGlobe.Format.XML).write(i)},_getDeleteString:function(e){for(var t=e.filter,i=e.typeName,r="",o=0;o<t.fids.length;o++){r+='<wfs:Delete typeName="'+i+'" handle="Delete '+o+'">';var n=new GeoGlobe.Filter.FeatureId({fids:[t.fids[o]]});r+=this._parserFilterToString(n),r+="</wfs:Delete>"}return r},_parserFilterToString:function(e){var t="";if(e){var i=(new GeoGlobe.Format.Filter.v1).write(e);return(new GeoGlobe.Format.XML).write(i)}return t},CLASS_NAME:"GeoGlobe.Service.WFST"}),GeoGlobe.Service.CTS=GeoGlobe.Class4OL(GeoGlobe.Service,{initialize:function(e,t,i){GeoGlobe.Service.prototype.initialize.apply(this,arguments)},getCapabilities:function(e,t){var i=this.url,r={REQUEST:"GetCapabilities",SERVICE:"CTS"};t=t||function(){this.failFn(r.REQUEST)},GeoGlobe.loadURL(i,r,this,(function(t){e(t)}),t)},isExist:function(){var e=!1,t=this.url;return GeoGlobe.Request.GET({url:t,params:{REQUEST:"GetCapabilities",SERVICE:"CTS"},scope:this,async:!1,success:function(){e=!0}}),e},TransCoords:function(e,t,i){var r=this.url;GeoGlobe.Util.applyDefaults(e,{SERVICE:"CTS",REQUEST:"TransCoords"}),i=i||function(){this.failFn(e.REQUEST)},GeoGlobe.loadURL(r,e,this,(function(i){if("xml"==e.FORMAT){var r={},o=i.responseXML;GeoGlobe.Function.bind(this.xmltoJson,this);var n=this.xmltoJson(o);r.attributes=n.CTS_TransResult["cts:Coordinate"].attributes.dim;for(var a=n.CTS_TransResult["cts:Coordinate"].text.split(","),s=[],l=0;l<a.length;l++)s.push(a[l]);r.coordvalue=s}else if("json"==e.FORMAT){r={},n=i.responseText;var u=(new GeoGlobe.Format.JSON).read(n);r.attributes=u.CTS_TransResult.dim,r.coordvalue=u.CTS_TransResult.Coordinate}t(r)}),i)},xmltoJson:function(e){var t={};if(1==e.nodeType){if(0<e.attributes.length){t.attributes={};for(var i=0;i<e.attributes.length;i++){var r=e.attributes.item(i);t.attributes[r.nodeName]=r.nodeValue}}}else 3==e.nodeType&&(t=e.nodeValue);if(e.hasChildNodes())for(var o=0;o<e.childNodes.length;o++){var n=e.childNodes.item(o),a=n.nodeName.replace("ows:","");if(void 0===t[a=a.replace("#","")])t[a]=this.xmltoJson(n);else{if(void 0===t[a].push){var s=t[a];t[a]=[],t[a].push(s)}t[a].push(this.xmltoJson(n))}}return t},AffineTransform:function(e,t,i){var r=this.url;GeoGlobe.Util.applyDefaults(e,{SERVICE:"CTS",REQUEST:"AffineTransform"}),i=i||function(){this.failFn(e.REQUEST)},GeoGlobe.loadURL(r,e,this,(function(i){if("xml"==e.FORMAT){var r={},o=i.responseXML;GeoGlobe.Function.bind(this.xmltoJson,this);var n=this.xmltoJson(o);r.attributes=n.CTS_AffineTransResult["cts:Coordinate"].attributes.dim;for(var a=n.CTS_AffineTransResult["cts:Coordinate"].text.split(","),s=[],l=0;l<a.length;l++)s.push(a[l]);r.coordvalue=s}else if("json"==e.FORMAT){r={},n=i.responseText;var u=(new GeoGlobe.Format.JSON).read(n);r.attributes=u.CTS_AffineTransResult.dim,r.coordvalue=u.CTS_AffineTransResult.Coordinate}t(r)}),i)},CLASS_NAME:"GeoGlobe.Service.CTS"});var _typeof="function"==typeof _babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14___default.a&&"symbol"==_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_13___default()(_babel_runtime_corejs2_core_js_symbol_iterator__WEBPACK_IMPORTED_MODULE_12___default.a)?function(e){return _babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_13___default()(e)}:function(e){return e&&"function"==typeof _babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14___default.a&&e.constructor===_babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14___default.a&&e!==_babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14___default.a.prototype?"symbol":_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_13___default()(e)};GeoGlobe.Service.WMS=GeoGlobe.Class4OL(GeoGlobe.Service,{initialize:function(e,t,i){GeoGlobe.Service.prototype.initialize.apply(this,arguments)},getCapabilities:function(e,t){var i=this.url,r={REQUEST:"GetCapabilities",SERVICE:"WMS"};t=t||function(){this.failFn(r.REQUEST)},GeoGlobe.loadURL(i,r,this,(function(t){var i=t.responseXML;GeoGlobe.Function.bind(this.xmlToJson,this);var r,o=this.xmlToJson(i),n={},a=o.WMT_MS_Capabilities,s=a.Capability.Layer.Layer,l=a.Capability.Request;r=s.length?s[0]:s,n.version=a.attributes.version,n.format=l.GetMap.Format[1].text,n.layer=r.Title.text,n.bbox=r.BoundingBox.attributes.SRS,n.maxExtent=a.Capability.Layer.LatLonBoundingBox.attributes,e(n,o)}),t)},isExist:function(){var e=!1,t=this.url;return GeoGlobe.Request.GET({url:t,params:{REQUEST:"GetCapabilities",SERVICE:"WMS"},scope:this,async:!1,success:function(){e=!0}}),e},xmlToJson:function(e){var t={};if(1==e.nodeType){if(0<e.attributes.length){t.attributes={};for(var i=0;i<e.attributes.length;i++){var r=e.attributes.item(i);t.attributes[r.nodeName]=r.nodeValue}}}else 3==e.nodeType&&(t=e.nodeValue);if(e.hasChildNodes())for(var o=0;o<e.childNodes.length;o++){var n=e.childNodes.item(o),a=n.nodeName.replace("ows:","");if(void 0===t[a=a.replace("#","")])t[a]=this.xmlToJson(n);else{if(void 0===t[a].push){var s=t[a];t[a]=[],t[a].push(s)}t[a].push(this.xmlToJson(n))}}return t},getMap:function(e){this.url;var t={};return e.layers&&(t.LAYERS=e.layers),e.format&&(t.FORMAT=e.format),e.bbox&&(t.BBOX="{bbox-epsg-3857}"),e.width&&(t.WIDTH=e.width),e.height&&(t.HEIGHT=e.height),e.version&&(t.VERSION=e.version),e.SRS&&(t.SRS=e.SRS),GeoGlobe.Util.applyDefaults(t,{service:"WMS",request:"GetMap",TRANSPARENT:!0}),this.urlAppend(this.url,this.getParameterString(t||{}))},getParameterString:function(e){var t=[];for(var i in e){var r=e[i];if(null!=r&&"function"!=typeof r){var o;if("object"==(void 0===r?"undefined":_typeof(r))&&r.constructor==Array){for(var n,a=[],s=0,l=r.length;s<l;s++)n=r[s],a.push(encodeURIComponent(null==n?"":n));o=a.join(",")}else o=r;t.push(encodeURIComponent(i)+"="+o)}}return t.join("&")},urlAppend:function(e,t){var i=e;if(t){var r=(e+" ").split(/[?&]/);i+=" "===r.pop()?t:r.length?"&"+t:"?"+t}return i},CLASS_NAME:"GeoGlobe.Service.WMS"});var _typeof="function"==typeof _babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14___default.a&&"symbol"==_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_13___default()(_babel_runtime_corejs2_core_js_symbol_iterator__WEBPACK_IMPORTED_MODULE_12___default.a)?function(e){return _babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_13___default()(e)}:function(e){return e&&"function"==typeof _babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14___default.a&&e.constructor===_babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14___default.a&&e!==_babel_runtime_corejs2_core_js_symbol__WEBPACK_IMPORTED_MODULE_14___default.a.prototype?"symbol":_babel_runtime_corejs2_helpers_typeof__WEBPACK_IMPORTED_MODULE_13___default()(e)};GeoGlobe.Service.WMTS=GeoGlobe.Class4OL(GeoGlobe.Service,{initialize:function(e,t,i){GeoGlobe.Service.prototype.initialize.apply(this,arguments)},getCapabilities:function(e,t){var i=this.url,r={REQUEST:"GetCapabilities",SERVICE:"WMTS"};t=t||function(){this.failFn(r.REQUEST)},GeoGlobe.loadURL(i,r,this,(function(t){var i=t.responseXML;GeoGlobe.Function.bind(this.xmlToJson,this);var r=this.xmlToJson(i),o=r.Capabilities,n={},a=o.Contents.Layer;a=a.length?a[0]:a,n.version=o.attributes.version;var s=o.Contents;n.layer=a.Title.text,n.LayerIdentifier=a.Identifier.text,n.StyleIdentifier=a.Style.Identifier.text,n.MatrixSet=a.TileMatrixSetLink[0].TileMatrixSet.text,n.Format=a.Format[1].text,n.Bounding=a.BoundingBox;var l="",u=s.TileMatrixSet[0].TileMatrix;if(0<u.length)for(var h=0,c=u.length;h<c&&h!=c;h++)l+=u[h].ScaleDenominator.text+",";n.Scales=l.substr(0,l.length-1),n.zoomOffset=u[0].Identifier.text,e(n,r)}),t)},xmlToJson:function(e){var t={};if(1==e.nodeType){if(0<e.attributes.length){t.attributes={};for(var i=0;i<e.attributes.length;i++){var r=e.attributes.item(i);t.attributes[r.nodeName]=r.nodeValue}}}else 3==e.nodeType&&(t=e.nodeValue);if(e.hasChildNodes())for(var o=0;o<e.childNodes.length;o++){var n=e.childNodes.item(o),a=n.nodeName.replace("ows:","");if(void 0===t[a=a.replace("#","")])t[a]=this.xmlToJson(n);else{if(void 0===t[a].push){var s=t[a];t[a]=[],t[a].push(s)}t[a].push(this.xmlToJson(n))}}return t},isExist:function(){var e=!1,t=this.url;return GeoGlobe.Request.GET({url:t,params:{REQUEST:"GetCapabilities",SERVICE:"WMTS"},scope:this,async:!1,success:function(){e=!0}}),e},getTile:function(e){var t={};return e.layer&&(t.LAYER=e.layer),e.format&&(t.FORMAT=e.format),e.tileMatrixSet&&(t.TILEMATRIXSET=e.tileMatrixSet),e.TILEMATRIX&&(t.TILEMATRIX=e.TILEMATRIX),e.TILEROW&&(t.TILEROW=e.TILEROW),e.TILECOL&&(t.TILECOL=e.TILECOL),e.version&&(t.VERSION=e.version),e.style&&(t.STYLE=e.style),GeoGlobe.Util.applyDefaults(t,{service:"WMTS",request:"GetTile"}),this.urlAppend(this.url,this.getParameterString(t||{}))},getParameterString:function(e){var t=[];for(var i in e){var r=e[i];if(null!=r&&"function"!=typeof r){var o;if("object"==(void 0===r?"undefined":_typeof(r))&&r.constructor==Array){for(var n,a=[],s=0,l=r.length;s<l;s++)n=r[s],a.push(encodeURIComponent(null==n?"":n));o=a.join(",")}else o=r;t.push(encodeURIComponent(i)+"="+o)}}return t.join("&")},urlAppend:function(e,t){var i=e;if(t){var r=(e+" ").split(/[?&]/);i+=" "===r.pop()?t:r.length?"&"+t:"?"+t}return i},getCapabilitiesForRest:function(e,t){var i=this.url;i.match(/\/$/)||(i+="/"),i+="1.0.0/WMTSCapabilities.xml",t=t||function(){this.failFn("GetCapabilities")},GeoGlobe.loadURL(i,null,this,(function(t){e(t)}),t)},getTileForRest:function(e){var t=e.layer,i=e.style,r=e.tileMatrixSet,o=e.tileMatrix,n=e.tileRow,a=e.tileCol,s=null,l=e.format?e.format:"image/png",u=t+"/"+i+"/"+r+"/"+o+"/"+n+"/"+a+"."+(s=s||{"image/png":"png","image/png8":"png","image/png24":"png","image/png32":"png",png:"png","image/jpeg":"jpg","image/jpg":"jpg",jpeg:"jpg",jpg:"jpg"}[l]||l.split("/").pop()),h=this.url;return h.match(/\/$/)||(h+="/"),h+u},CLASS_NAME:"GeoGlobe.Service.WMTS"}),GeoGlobe.Analysis.BufferAnalysis=GeoGlobe.Class4OL({url:null,type:1,accuracy:32,initialize:function(e,t){this.url=e,GeoGlobe.Util.extend(this,t)},_buildPostXML:function(e,t){return'<?xml version="1.0" encoding="UTF-8" standalone="yes"?><wps:Execute service="WPS" version="1.0.0" xmlns:gml="http://www.opengis.net/gml" xmlns:wps="http://www.opengis.net/wps/1.0.0" xmlns:ows="http://www.opengis.net/ows/1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 ../wpsExecute_request.xsd"><ows:Identifier>Buffer</ows:Identifier><wps:DataInputs><wps:Input><ows:Identifier>InputPolygon</ows:Identifier><wps:Data><wps:ComplexData schema="http://foo.bar/MyComplexValueSchema.xsd" mimeType="text/xml" encoding="UTF-8">'+(new GeoGlobe.Format.GML).write(e)+"</wps:ComplexData></wps:Data></wps:Input><wps:Input><ows:Identifier>BufferDistance</ows:Identifier><wps:Data><wps:LiteralData>"+t+"</wps:LiteralData></wps:Data></wps:Input><wps:Input><ows:Identifier>BufferType</ows:Identifier><wps:Data><wps:LiteralData>"+this.type+"</wps:LiteralData></wps:Data></wps:Input><wps:Input><ows:Identifier>BufferAccuracy</ows:Identifier><wps:Data><wps:LiteralData>"+this.accuracy+"</wps:LiteralData></wps:Data></wps:Input></wps:DataInputs><wps:ResponseForm><wps:RawDataOutput><ows:Identifier>BufferedPolygon</ows:Identifier></wps:RawDataOutput></wps:ResponseForm></wps:Execute>"},_getFeaturesCenter:function(e){return this._getFeaturesExtent(e).getCenterLonLat()},_getFeaturesExtent:function(e){GeoGlobe.Util.isArray(e)||(e=[e]);var t=null;if(e&&0<e.length){t=new GeoGlobe.LngLatBounds;for(var i=null,r=0,o=e.length;r<o;r++)(i=e[r].geometry)&&t.extend(i.getBounds())}return t},startAnalysis:function(e,t,i){var r=(new GeoGlobe.Format.GeoJSON).read(e),o=this._getFeaturesCenter(r);switch(i&&-1!=GeoGlobe.Util.indexOf(["m","km","degree"],i)||(i="m"),i){case"km":t*=1e3;case"m":t=this._meterToDegree(t,o)}var n=this._buildPostXML(r,t);new GeoGlobe.Request.POST({url:this.url,data:n,scope:this,success:function(e){if(""!=e.responseText&&null!=e.responseText){var t=this._parserResult(e),i=(new GeoGlobe.Format.GeoJSON).write(t),r=(new GeoGlobe.Format.JSON).read(i);this.successFn(r)}else this.failFn()},failure:this.failFn})},_meterToDegree:function(e,t){var i=t.lat;return e*(899e-8/Math.cos(GeoGlobe.Util.rad(i)))},successFn:function(){},failFn:function(){alert("缓冲分析操作失败，请检测服务是否正常运行。")},_parserResult:function(e){var t=new GeoGlobe.Format.XML;return e.responseXML||(e.responseXML=t.read(e.responseText)),(new GeoGlobe.Format.GML).read(e.responseXML)},CLASS_NAME:"GeoGlobe.Analysis.BufferAnalysis"}),GeoGlobe.Analysis.BufferAnalysis.CAP_ROUND=1,GeoGlobe.Analysis.BufferAnalysis.CAP_BUTT=2,GeoGlobe.Analysis.BufferAnalysis.CAP_SQUARE=3,GeoGlobe.Analysis.CoreBufferAnalysis=GeoGlobe.Class({url:null,type:"intersection",_requestStrTemplate:"{'BufferAnalysis': {'service': 'OverlapService','version': '1.0.0','layerName': '${layerName}','bufferRadius': '${bufferRadius}','bufferStyle':'${bufferStyle}','outPutFormat': 'JSON','bufferType': '${bufferType}','isSynchronization': 'true'}}",initialize:function(e,t){this.url=e,GeoGlobe.Util.extend(this,t)},_buildRequestStr:function(){return GeoGlobe.String.format(this._requestStrTemplate,{type:this.type,layerName:this.layerName,bufferRadius:this.bufferRadius,bufferStyle:this.bufferStyle,bufferType:this.bufferType})},startAnalysis:function(e){if(this._checkSet())return!1;var t=this._buildRequestStr();new GeoGlobe.Request.POST({url:this.url,data:t,scope:this,success:function(t){""!=t.responseText&&null!=t.responseText?this.successFn(t,e):this.failFn()},failure:this.failFn})},_checkSet:function(){if(!this.url)return!1},successFn:function(){},failFn:function(){alert("缓冲分析操作失败，请检测服务是否正常运行")},CLASS_NAME:"GeoGlobe.Analysis.CoreBufferAnalysis"}),GeoGlobe.Analysis.GetFeature=GeoGlobe.Class4OL({url:null,type:"intersection",_reqStrTemplate:"{'GetFeature': {'service': 'OverlapService','version': '1.0.0','dataSource':'${sourceInputs}','Query': [{'typeName':'${dataInputs}'}],'maxFeatures': '','startPosition': '','outPutFormat': 'GeoJSON','resultType': ''}}",initialize:function(e,t){this.url=e,GeoGlobe.Util.extend(this,t)},_buildReqStr:function(){return GeoGlobe.String.format(this._reqStrTemplate,{type:this.type,dataInputs:this.typeName,sourceInputs:this.DataSource})},startAnalysis:function(){if(this._checkSet())return!1;var e=this._buildReqStr();new GeoGlobe.Request.POST({url:this.url,data:e,scope:this,success:function(e){""!=e.responseText&&null!=e.responseText?this.successFn(e):this.failFn()},failure:this.failFn})},_checkSet:function(){if(!this.url)return!1},successFn:function(){},failFn:function(){alert("服务请求操作失败，请检测服务是否正常运行。")},CLASS_NAME:"GeoGlobe.Analysis.GetFeature"}),GeoGlobe.Analysis.SpatialAnalysis=GeoGlobe.Class({url:null,type:"intersection",_requestStrTemplate:"{'SpatialAnalysis': {'service': 'OverlapService','version': '1.0.0','origionLayerNames': ['${origionLayerNames}'],'targetLayerNames': ['${targetLayerNames}'],'outPutFormat': 'GeoJSON','operator': '${dataInputs}','isSynchronization': 'true','tolerance': '${tolerance}'}}",initialize:function(e,t){this.url=e,GeoGlobe.Util.extend(this,t)},_buildRequestStr:function(){return GeoGlobe.String.format(this._requestStrTemplate,{type:this.type,dataInputs:this.operator,origionLayerNames:this.origionLayerNames,targetLayerNames:this.targetLayerNames,tolerance:this.tolerance})},startAnalysis:function(e){if(this._checkSet())return!1;var t=this._buildRequestStr();new GeoGlobe.Request.POST({url:this.url,data:t,scope:this,success:function(t){""!=t.responseText&&null!=t.responseText?this.successFn(t,e):this.failFn()},failure:this.failFn})},_checkSet:function(){if(!this.url)return!1},successFn:function(){},failFn:function(){alert("叠置分析操作失败，请检测服务是否正常运行。")},CLASS_NAME:"GeoGlobe.Analysis.SpatialAnalysis"})}).call(this,__webpack_require__(95)(module),__webpack_require__(234))},function(e,t){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(e){"object"==typeof window&&(i=window)}e.exports=i},function(e,t,i){"use strict";var r=i(18),o=i(236),n=i(58);i(61)("search",1,(function(e,t,i,a){return[function(i){var r=e(this),o=null==i?void 0:i[t];return void 0!==o?o.call(i,r):new RegExp(i)[t](String(r))},function(e){var t=a(i,e,this);if(t.done)return t.value;var s=r(e),l=String(this),u=s.lastIndex;o(u,0)||(s.lastIndex=0);var h=n(s,l);return o(s.lastIndex,u)||(s.lastIndex=u),null===h?-1:h.index}]}))},function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}},function(e,i,r){"use strict";r.r(i);r(143);var o=r(11),n=r.n(o),a=(r(189),r(77),r(191),r(141)),s=r.n(a),l=(r(194),r(205),r(206),r(207),r(4)),u=r.n(l),h=(r(128),r(131),r(208),r(93)),c=r.n(h),p=(r(211),r(213),r(83),r(142)),d=r.n(p),f=(r(229),r(0)),g=r.n(f),m=r(2),_=r.n(m),v=(r(137),r(86),r(138),r(9)),C=r.n(v),A=r(1),I=r.n(A),b=r(3),w=r.n(b);r(140),r(64),r(39),r(84),r(82);!function(e){e&&(e.GeoOption={GeoCamera:!0,GeoCameraEventAggregator:!0,GeoScreenSpaceCameraController:!0},e.GEO_VERSION_NUMBER="$ Cesium Version: 1.40 build-20190301 $")}(window.Cesium),function(e){var t=e.DrawCircleWidget=function(t,i){this.viewer=t.viewer,this.color=t.color?t.color:e.Color.RED.withAlpha(.3),this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.ellipsoid=this.scene.globe.ellipsoid,this.mode=t.mode?t.mode:1,this.appearance=new e.PerInstanceColorAppearance,this.callback=i||null};function i(e,t){for(var i=0;i<t.length;i++)t.get(i).name==e&&(t.remove(t.get(i)),i--)}t.prototype.activate=function(){if(!this.handler){this.handler=new e.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var t,i,r=this,o=[];this._array_=o,this._circles_=t=[],this._labels_=i,this.handler.setInputAction((function(i){r.lastP=i;var n=r.scene.pickPosition(i.position);if(!n){var a=r.camera.getPickRay(i.position);n=r.scene.globe.pick(a,r.scene)}if(n&&(e.Cartographic.fromCartesian(n).height<0&&(a=r.camera.getPickRay(i.position),n=r.scene.globe.pick(a,r.scene)),o[0]=n,0<o.length)){var s=new e.CircleGeometry({center:n,radius:0,height:0});s.name="draw_circle";var l=new e.GroundPrimitive({geometryInstances:new e.GeometryInstance({geometry:s,attributes:{color:e.ColorGeometryInstanceAttribute.fromColor(r.color)}}),appearance:r.appearance,classificationType:e.ClassificationType.BOTH,interleave:!0});l.name="draw_circle",t.push({geometry:{center:n,radius:0,height:0},primitive:l}),r.primitives.add(l)}}),e.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction((function(n){var a=r.scene.pickPosition(n.endPosition);if(!a){var s=r.camera.getPickRay(n.endPosition);a=r.scene.globe.pick(s,r.scene)}if(!a)return i&&(r.primitives.remove(i),i=null),void(r._labels_=i);e.Cartographic.fromCartesian(a).height<0&&(s=r.camera.getPickRay(n.endPosition),a=r.scene.globe.pick(s,r.scene));var l=e.Cartographic.fromCartesian(a),u=e.Math.toDegrees(l.longitude),h=e.Math.toDegrees(l.latitude),c=l.height;0<o.length&&(t[0],r.primitives.remove(t[0].primitive),t[0].geometry.radius=e.Cartesian3.distance(t[0].geometry.center,a),3189100<t[0].geometry.radius&&(t[0].geometry.radius=3189100),t[0].primitive=new e.GroundPrimitive({geometryInstances:new e.GeometryInstance({geometry:new e.CircleGeometry({center:t[0].geometry.center.clone(),radius:t[0].geometry.radius,height:t[0].geometry.height}),attributes:{color:e.ColorGeometryInstanceAttribute.fromColor(r.color)}}),appearance:r.appearance,classificationType:e.ClassificationType.BOTH,interleave:!0}),t[0].primitive.name="draw_circle",r.primitives.add(t[0].primitive)),i||((i=r.primitives.add(new e.LabelCollection)).name="draw_label",i.add({text:"左键单击开始绘制，右键单击结束绘制",font:"15px Microsoft YaHei",showBackground:!0})),i.get(i.length-1).position=e.Cartesian3.fromDegrees(u,h,c),r._labels_=i}),e.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction((function(e){r.drawEnd(e)}),e.ScreenSpaceEventType.RIGHT_CLICK)}},t.prototype.drawEnd=function(t){var i=this._array_,r=this._circles_,o=this._labels_;t=t||this.lastP,this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",o&&(this.primitives.remove(o),o=null);var n=this.scene.pickPosition(t.position);if(!n){var a=this.camera.getPickRay(t.position);n=this.scene.globe.pick(a,this.scene)}if(n){e.Cartographic.fromCartesian(n).height<0&&(a=this.camera.getPickRay(t.position),n=this.scene.globe.pick(a,this.scene));var s=e.Cartographic.fromCartesian(n);if(e.Math.toDegrees(s.longitude),e.Math.toDegrees(s.latitude),s.height,this.mode,0<i.length&&(this.primitives.remove(r[0].primitive),r[0].geometry.radius=e.Cartesian3.distance(r[0].geometry.center,n),3189100<r[0].geometry.radius&&(r[0].geometry.radius=3189100),r[0].primitive=new e.GroundPrimitive({geometryInstances:new e.GeometryInstance({geometry:new e.CircleGeometry({center:r[0].geometry.center.clone(),radius:r[0].geometry.radius,height:r[0].geometry.height}),attributes:{color:e.ColorGeometryInstanceAttribute.fromColor(this.color)}}),appearance:this.appearance,classificationType:e.ClassificationType.BOTH,interleave:!0}),r[0].primitive.name="draw_circle",this.primitives.add(r[0].primitive),this.callback)){var l=e.CircleGeometry.createGeometry(new e.CircleGeometry({center:r[0].geometry.center.clone(),radius:r[0].geometry.radius,height:r[0].geometry.height})),u=new e.Entity({polygon:{hierarchy:{positions:function(){for(var t=[],i=l.attributes.position.values,r=0;r<i.length;r+=3)t.push(new e.Cartesian3(i[r],i[r+1],i[r+2]));return t}()}}});this.callback(u)}i=[],r=[]}},t.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",i("draw_label",this.primitives),i("draw_circle",this.primitives),function(e,t){for(var i=t.values,r=0;r<i.length;r++)"draw_circle"==i[r].name&&(t.remove(i[r]),r--)}(0,this.viewer.entities)}}(window.Cesium),function(e){var t=e.DrawHeightWidget=function(t,i){this.viewer=t.viewer,this.color=t.color?t.color:e.Color.CHARTREUSE.withAlpha(.5),this.lineWidth=t.lineWidth?t.lineWidth:2,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.ellipsoid=this.scene.globe.ellipsoid,this.callback=i||null};function i(e,t){for(var i=0;i<t.length;i++)t.get(i).name==e&&(t.remove(t.get(i)),i--)}t.prototype.activate=function(){if(!this.handler){this.handler=new e.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var t,i,r=this,o=[];this.handler.setInputAction((function(i){if(!(0<o.length)){var n=r.camera.getPickRay(i.position),a=r.scene.globe.pick(n,r.scene);if(a){var s=e.Cartographic.fromCartesian(a),l=e.Math.toDegrees(s.longitude),u=e.Math.toDegrees(s.latitude),h=s.height;0==o.length&&(o.push(l),o.push(u),o.push(h),o.push(l),o.push(u),o.push(h),o.push(l),o.push(u),o.push(h),(t=r.primitives.add(new e.PolylineCollection)).name="draw_polyline",t.add({polyline:{}}),t.get(t.length-1).width=r.lineWidth,t.get(t.length-1).loop=!0,t.get(t.length-1).material.uniforms.color=r.color,t.get(t.length-1).positions=e.Cartesian3.fromDegreesArrayHeights(o))}}}),e.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction((function(n){var a=r.camera.getPickRay(n.endPosition),s=r.scene.globe.pick(a,r.scene);if(s){var l=e.Cartographic.fromCartesian(s),u=e.Math.toDegrees(l.longitude),h=e.Math.toDegrees(l.latitude),c=l.height;9==o.length&&(o[3]=u,o[4]=h,o[5]=c,o[2]>=o[5]?(o[6]=o[0],o[7]=o[1],o[8]=o[5]):(o[6]=o[3],o[7]=o[4],o[8]=o[2]),t.get(t.length-1).positions=e.Cartesian3.fromDegreesArrayHeights(o)),i||((i=r.primitives.add(new e.LabelCollection)).name="draw_label",i.add({text:"左键单击开始绘制，右键单击结束绘制",font:"16px sans-serif",showBackground:!0,disableDepthTestDistance:Number.POSITIVE_INFINITY})),i.get(i.length-1).position=e.Cartesian3.fromDegrees(u,h,c)}else i&&(r.primitives.remove(i),i=null)}),e.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction((function(t){if(r.handler=r.handler&&r.handler.destroy(),r.viewer.canvas.style.cursor="default",i&&(r.primitives.remove(i),i=null),r.callback){var n=new e.Entity({polyline:{positions:e.Cartesian3.fromDegreesArrayHeights(o)}});r.callback(n)}}),e.ScreenSpaceEventType.RIGHT_CLICK)}},t.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",i("draw_label",this.primitives),i("draw_polyline",this.primitives)}}(window.Cesium),function(e){var t=e.DrawPointWidget=function(t,i){this.viewer=t.viewer,this.color=t.color?t.color:e.Color.RED,this.pixelSize=t.pixelSize?t.pixelSize:10,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.ellipsoid=this.scene.globe.ellipsoid,this.callback=i||null};function i(e,t){for(var i=0;i<t.length;i++)t.get(i).name==e&&(t.remove(t.get(i)),i--)}t.prototype.activate=function(){if(!this.handler){this.handler=new e.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var t,i,r=this,o=[];this.handler.setInputAction((function(n){var a=r.scene.pickPosition(n.position);if(!a){var s=r.camera.getPickRay(n.position);a=r.scene.globe.pick(s,r.scene)}if(a&&(e.Cartographic.fromCartesian(a).height<0&&(s=r.camera.getPickRay(n.position),a=r.scene.globe.pick(s,r.scene)),o[0]=a,t?t.removeAll():(t=r.primitives.add(new e.PointPrimitiveCollection)).name="draw_point",t.add({position:a,color:r.color,pixelSize:r.pixelSize,disableDepthTestDistance:30}),r.handler=r.handler&&r.handler.destroy(),r.viewer.canvas.style.cursor="default",i&&(r.primitives.remove(i),i=null),r.callback)){var l=new e.Entity({position:o[0],point:{}});r.callback(l)}}),e.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction((function(t){var o=r.scene.pickPosition(t.endPosition);if(!o){var n=r.camera.getPickRay(t.endPosition);o=r.scene.globe.pick(n,r.scene)}o?(e.Cartographic.fromCartesian(o).height<0&&(n=r.camera.getPickRay(t.endPosition),o=r.scene.globe.pick(n,r.scene)),i||((i=r.primitives.add(new e.LabelCollection)).name="draw_label",i.add({text:"左键单击进行绘制",font:"15px Microsoft YaHei",showBackground:!0})),i.get(i.length-1).position=o):i&&(r.primitives.remove(i),i=null)}),e.ScreenSpaceEventType.MOUSE_MOVE)}},t.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",i("draw_label",this.primitives),i("draw_point",this.primitives)}}(window.Cesium),function(e){var t=e.DrawPolygonWidget=function(t,i){this.viewer=t.viewer,this.color=t.color?t.color:e.Color.CHARTREUSE.withAlpha(.5),this.lineWidth=t.lineWidth?t.lineWidth:2,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.ellipsoid=this.scene.globe.ellipsoid,this.callback=i||null,this.count=0};function i(e,t){for(var i=0;i<t.length;i++)t.get(i).name==e&&(t.remove(t.get(i)),i--)}t.prototype.activate=function(){if(!this.handler){this.handler=new e.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var t,i,r=this,o=[],n=[],a=[];this._array_=n,this._array2_=a,this._polylines_=t,this._labels_=i,this.handler.setInputAction((function(i){r.lastP=i;var s=r.scene.pickPosition(i.position);if(!s){var l=r.camera.getPickRay(i.position);s=r.scene.globe.pick(l,r.scene)}if(s){e.Cartographic.fromCartesian(s).height<0&&(l=r.camera.getPickRay(i.position),s=r.scene.globe.pick(l,r.scene));var u=e.Cartographic.fromCartesian(s);n.push(s);var h=e.Math.toDegrees(u.longitude),c=e.Math.toDegrees(u.latitude),p=u.height;a.push([h,c]),o.push(h),o.push(c),o.push(p),3==o.length&&((t=r.primitives.add(new e.PolylineCollection)).name="draw_polyline",t.add({polyline:{}}),t.get(t.length-1).width=r.lineWidth,t.get(t.length-1).loop=!0,t.get(t.length-1).material.uniforms.color=r.color,t.get(t.length-1).positions=e.Cartesian3.fromDegreesArrayHeights(o)),3<o.length&&(t.get(t.length-1).positions=e.Cartesian3.fromDegreesArrayHeights(o)),r._polylines_=t}}),e.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction((function(n){var a=r.scene.pickPosition(n.endPosition);if(!a){var s=r.camera.getPickRay(n.endPosition);a=r.scene.globe.pick(s,r.scene)}if(a){e.Cartographic.fromCartesian(a).height<0&&(s=r.camera.getPickRay(n.endPosition),a=r.scene.globe.pick(s,r.scene));var l=e.Cartographic.fromCartesian(a),u=e.Math.toDegrees(l.longitude),h=e.Math.toDegrees(l.latitude),c=l.height;if(3<=o.length){var p=o.concat();p.push(u),p.push(h),p.push(c),t.get(t.length-1).positions=e.Cartesian3.fromDegreesArrayHeights(p)}i||((i=r.primitives.add(new e.LabelCollection)).name="draw_label",i.add({text:"左键单击开始绘制，右键单击结束绘制",font:"15px Microsoft YaHei",showBackground:!0})),i.get(i.length-1).position=e.Cartesian3.fromDegrees(u,h,c),r._labels_=i}}),e.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction((function(e){r.drawEnd(e)}),e.ScreenSpaceEventType.RIGHT_CLICK),this.count++}},t.prototype.drawEnd=function(t){if(0!=this._array_.length){var i=this._array_,r=this._array2_,o=this._polylines_,n=this._labels_;t||(console.log("点击按钮结束绘制"),t=this.lastP),this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",n&&(this.primitives.remove(n),n=null);var a=this.scene.pickPosition(t.position);if(!a){var s=this.camera.getPickRay(t.position);a=this.scene.globe.pick(s,this.scene)}if(a){e.Cartographic.fromCartesian(a).height<0&&(s=this.camera.getPickRay(t.position),a=this.scene.globe.pick(s,this.scene)),i.push(a);var l=e.Cartographic.fromCartesian(a),u=e.Math.toDegrees(l.longitude),h=e.Math.toDegrees(l.latitude);r.push([u,h]),o.get(o.length-1).material.uniforms.color=e.Color.DODGERBLUE.withAlpha(0);var c=new e.GroundPrimitive({geometryInstances:[],appearance:new e.PerInstanceColorAppearance,show:!0,classificationType:e.ClassificationType.BOTH}),p=new e.GeometryInstance({geometry:e.PolygonGeometry.fromPositions({positions:i,vertexFormat:e.EllipsoidSurfaceAppearance.VERTEX_FORMAT}),attributes:{color:e.ColorGeometryInstanceAttribute.fromColor(e.Color.GREEN.withAlpha(.3))}});if(c.geometryInstances.push(p),this.primitives.add(c).name="draw_polygon",this.callback){var d=new e.Entity({polygon:{hierarchy:{positions:i}}});this.callback(d)}this._array_=[],this._polylines_=null}}},t.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",i("draw_label",this.primitives),i("draw_polyline",this.primitives),i("draw_polygon",this.primitives)}}(window.Cesium),function(e){var t=e.DrawPolylineWidget=function(t,i){this.viewer=t.viewer,this.lineColor=e.defaultValue(t.lineColor,e.Color.CHARTREUSE.withAlpha(.5)),this.lineWidth=e.defaultValue(t.lineWidth,1),this.lineLoop=e.defaultValue(t.lineLoop,!0),this.lineClampGround=e.defaultValue(t.lineClampGround,!0),this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.primitives=this.scene.primitives,this.callback=i||null};function i(e,t){for(var i=0;i<t.length;i++)t.get(i).name==e&&(t.remove(t.get(i)),i--)}function r(t){return[e.Math.toDegrees(e.Cartographic.fromCartesian(t).longitude),e.Math.toDegrees(e.Cartographic.fromCartesian(t).latitude),e.Cartographic.fromCartesian(t).height]}t.prototype.screenToCartesian=function(t){if(this.lineClampGround){if(!(r=this.scene.pickPosition(t))){var i=this.camera.getPickRay(t);r=this.scene.globe.pick(i,this.scene)}if(!r)return;e.Cartographic.fromCartesian(r).height<0&&(i=this.camera.getPickRay(t),r=this.scene.globe.pick(i,this.scene))}else{i=this.camera.getPickRay(t);var r=this.scene.globe.pick(i,this.scene)}return r},t.prototype.createGroundPrimitive=function(t){if(this.lineWidth&&this.lineColor&&this.primitives){var i=new e.GroundPrimitive({geometryInstances:new e.GeometryInstance({geometry:new e.CorridorGeometry({vertexFormat:e.VertexFormat.POSITION_ONLY,positions:t,width:this.lineWidth}),attributes:{color:e.ColorGeometryInstanceAttribute.fromColor(this.lineColor)}}),classificationType:e.ClassificationType.BOTH});return this.primitives.add(i)}return!1},t.prototype.createPrimitive=function(t){if(this.lineWidth&&this.lineColor&&this.primitives){var i=this.primitives.add(new e.PolylineCollection);return i.add({polyline:{}}),i.get(i.length-1).width=this.lineWidth,i.get(i.length-1).material.uniforms.color=this.lineColor,i.get(i.length-1).positions=t,i}return!1},t.prototype.activate=function(){if(!this.handler){this.handler=new e.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var t=[];this.degreesArrayHeights=[],this._labels=null;var i=this;this.handler.setInputAction((function(e){var o=i.screenToCartesian(e.position);t.push(o),i.degreesArrayHeights=i.degreesArrayHeights.concat(r(o));var n=t.length,a=[],s=[];1==n?a=[t[n-1]]:s=i.lineLoop?(a=[t[n-2],t[n-1]],[t[0],t[n-1]]):(a=[t[n-2],t[n-1]],[]),i.lineClampGround?(i.primitives.remove(i.temporaryGroundPrimitive),i.primitives.remove(i.concatGroundPrimitive),i.fixedGroundPrimitive=i.createGroundPrimitive(a),i.fixedGroundPrimitive.name="draw_polyline",i.concatGroundPrimitive=i.createGroundPrimitive(s),i.concatGroundPrimitive.name="draw_polylineConcat"):(i.primitives.remove(i.concatPrimitive),i.primitives.remove(i.temporaryPrimitive),i.fixedPrimitive=i.createPrimitive(a),i.fixedPrimitive.name="draw_polyline",i.concatPrimitive=i.createPrimitive(s),i.concatPrimitive.name="draw_polylineConcat")}),e.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction((function(r){var o=i.screenToCartesian(r.endPosition);if(o){var n=t.length;if(n)if(i.lineClampGround){i.primitives.remove(i.temporaryGroundPrimitive),i.primitives.remove(i.concatGroundPrimitive);var a=i.lineLoop&&2<=n?[t[n-1],o.clone(),t[0]]:[t[n-1],o.clone()];i.temporaryGroundPrimitive=i.createGroundPrimitive(a),i.temporaryGroundPrimitive.name="draw_polylineTemple"}else{i.primitives.remove(i.temporaryPrimitive),i.primitives.remove(i.concatPrimitive);var s=i.lineLoop&&2<=n?[t[n-1],o.clone(),t[0]]:[t[n-1],o.clone()];i.temporaryPrimitive=i.createPrimitive(s),i.temporaryPrimitive.name="draw_polylineTemple"}i._labels||(i._labels=i.primitives.add(new e.LabelCollection),i._labels.name="draw_label",i._labels.add({text:"左键单击开始绘制，右键单击结束绘制",font:"15px Microsoft YaHei",showBackground:!0})),i._labels.get(i._labels.length-1).position=o}else i._labels&&(i.primitives.remove(i._labels),i._labels=null)}),e.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction((function(e){i.drawEnd(t,e)}),e.ScreenSpaceEventType.RIGHT_CLICK)}},t.prototype.drawEnd=function(t,i){var o=this._labels;this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",o&&(this.primitives.remove(o),o=null);var n=this.screenToCartesian(i.position);t.push(n),this.degreesArrayHeights=this.degreesArrayHeights.concat(r(n));var a=t.length;if(this.lineClampGround){this.primitives.remove(this.temporaryGroundPrimitive),this.primitives.remove(this.concatGroundPrimitive);var s=this.lineLoop&&2<a?[t[a-2],t[a-1],t[0]]:[t[a-2],t[a-1]];this.finalGroundPrimitive=this.createGroundPrimitive(s),this.finalGroundPrimitive.name="draw_polyline"}else{this.primitives.remove(this.temporaryPrimitive),this.primitives.remove(this.concatPrimitive);var l=this.lineLoop&&2<a?[t[a-2],t[a-1],t[0]]:[t[a-2],t[a-1]];this.finalPrimitive=this.createPrimitive(l),this.finalPrimitive.name="draw_polyline"}if(this.callback){var u=new e.Entity({polyline:{positions:e.Cartesian3.fromDegreesArrayHeights(this.degreesArrayHeights)}});this.callback(u)}},t.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",i("draw_label",this.primitives),i("draw_polyline",this.primitives)}}(window.Cesium);var E={version:"1.0.0",createTime:"2018.6.19",author:"xupinhui"},G="doublearrow",S=.25,P=.3,T=.85,x=.15,M={headHeightFactor:.18,headWidthFactor:.3,neckHeightFactor:.85,neckWidthFactor:.15,tailWidthFactor:.1,headTailFactor:.8,swallowTailFactor:1};E.algorithm={},E.algorithm.doubleArrow=function(e){this.connPoint=null;var t={controlPoint:this.tempPoint4=null,polygonalPoint:null};if(!((s=(this.points=e).length)<2)){if(2==s)return e;var i,r,o=this.points[0],n=this.points[1],a=this.points[2],s=e.length;this.tempPoint4=3==s?E.algorithm.getTempPoint4(o,n,a):this.points[3],this.connPoint=3==s||4==s?V.PlotUtils.mid(o,n):this.points[4],r=V.PlotUtils.isClockWise(o,n,a)?(i=E.algorithm.getArrowPoints(o,this.connPoint,this.tempPoint4,!1),E.algorithm.getArrowPoints(this.connPoint,n,a,!0)):(i=E.algorithm.getArrowPoints(n,this.connPoint,a,!1),E.algorithm.getArrowPoints(this.connPoint,o,this.tempPoint4,!0));var l=i.length,u=(l-5)/2,h=i.slice(0,u),c=i.slice(u,5+u),p=i.slice(5+u,l),d=r.slice(0,u),f=r.slice(u,5+u),g=r.slice(5+u,l);d=V.PlotUtils.getBezierPoints(d);var m=V.PlotUtils.getBezierPoints(g.concat(h.slice(1)));p=V.PlotUtils.getBezierPoints(p);var _=d.concat(f,m,c,p),v=E.algorithm.array2Dto1D(_);t.controlPoint=[o,n,a,this.tempPoint4,this.connPoint],t.polygonalPoint=Cesium.Cartesian3.fromDegreesArray(v)}return t},E.algorithm.getTempPoint4=function(e,t,i,r){this.type=G,this.headHeightFactor=S,this.headWidthFactor=P,this.neckHeightFactor=T,this.neckWidthFactor=x;var o=V.PlotUtils.mid(e,t),n=V.PlotUtils.distance(o,i),a=V.PlotUtils.getThirdPoint(i,o,0,.3*n,!0),s=V.PlotUtils.getThirdPoint(i,o,0,.5*n,!0),l=[o,a=V.PlotUtils.getThirdPoint(o,a,V.Constants.HALF_PI,n/5,r),s=V.PlotUtils.getThirdPoint(o,s,V.Constants.HALF_PI,n/4,r),i],u=E.algorithm.getArrowHeadPoints(l,this.headHeightFactor,this.headWidthFactor,this.neckHeightFactor,this.neckWidthFactor),h=u[0],c=u[4],p=V.PlotUtils.distance(e,t)/V.PlotUtils.getBaseLength(l)/2,d=E.algorithm.getArrowBodyPoints(l,h,c,p),f=d.length,g=d.slice(0,f/2),m=d.slice(f/2,f);return g.push(h),m.push(c),(g=g.reverse()).push(t),(m=m.reverse()).push(e),g.reverse().concat(u,m)},E.algorithm.array2Dto1D=function(e){var t=[];return e.forEach((function(e){t.push(e[0]),t.push(e[1])})),t},E.algorithm.getArrowPoints=function(e,t,i,r){this.type=G,this.headHeightFactor=S,this.headWidthFactor=P,this.neckHeightFactor=T,this.neckWidthFactor=x;var o=V.PlotUtils.mid(e,t),n=V.PlotUtils.distance(o,i),a=V.PlotUtils.getThirdPoint(i,o,0,.3*n,!0),s=V.PlotUtils.getThirdPoint(i,o,0,.5*n,!0),l=[o,a=V.PlotUtils.getThirdPoint(o,a,V.Constants.HALF_PI,n/5,r),s=V.PlotUtils.getThirdPoint(o,s,V.Constants.HALF_PI,n/4,r),i],u=E.algorithm.getArrowHeadPoints(l,this.headHeightFactor,this.headWidthFactor,this.neckHeightFactor,this.neckWidthFactor),h=u[0],c=u[4],p=V.PlotUtils.distance(e,t)/V.PlotUtils.getBaseLength(l)/2,d=E.algorithm.getArrowBodyPoints(l,h,c,p),f=d.length,g=d.slice(0,f/2),m=d.slice(f/2,f);return g.push(h),m.push(c),(g=g.reverse()).push(t),(m=m.reverse()).push(e),g.reverse().concat(u,m)},E.algorithm.getArrowHeadPoints=function(e,t,i){this.type=G,this.headHeightFactor=S,this.headWidthFactor=P,this.neckHeightFactor=T,this.neckWidthFactor=x;var r=V.PlotUtils.getBaseLength(e)*this.headHeightFactor,o=e[e.length-1],n=(V.PlotUtils.distance(t,i),r*this.headWidthFactor),a=r*this.neckWidthFactor,s=r*this.neckHeightFactor,l=V.PlotUtils.getThirdPoint(e[e.length-2],o,0,r,!0),u=V.PlotUtils.getThirdPoint(e[e.length-2],o,0,s,!0),h=V.PlotUtils.getThirdPoint(o,l,V.Constants.HALF_PI,n,!1),c=V.PlotUtils.getThirdPoint(o,l,V.Constants.HALF_PI,n,!0);return[V.PlotUtils.getThirdPoint(o,u,V.Constants.HALF_PI,a,!1),h,o,c,V.PlotUtils.getThirdPoint(o,u,V.Constants.HALF_PI,a,!0)]},E.algorithm.getArrowBodyPoints=function(e,t,i,r){for(var o=V.PlotUtils.wholeDistance(e),n=V.PlotUtils.getBaseLength(e)*r,a=(n-V.PlotUtils.distance(t,i))/2,s=0,l=[],u=[],h=1;h<e.length-1;h++){var c=V.PlotUtils.getAngleOfThreePoints(e[h-1],e[h],e[h+1])/2,p=(n/2-(s+=V.PlotUtils.distance(e[h-1],e[h]))/o*a)/Math.sin(c),d=V.PlotUtils.getThirdPoint(e[h-1],e[h],Math.PI-c,p,!0),f=V.PlotUtils.getThirdPoint(e[h-1],e[h],c,p,!1);l.push(d),u.push(f)}return l.concat(u)},E.algorithm.getTempPoint4=function(e,t,i){var r,o,n,a=V.PlotUtils.mid(e,t),s=V.PlotUtils.distance(a,i),l=V.PlotUtils.getAngleOfThreePoints(e,a,i);return l<V.Constants.HALF_PI?(r=s*Math.sin(l),o=s*Math.cos(l),n=V.PlotUtils.getThirdPoint(e,a,V.Constants.HALF_PI,r,!1),V.PlotUtils.getThirdPoint(a,n,V.Constants.HALF_PI,o,!0)):l>=V.Constants.HALF_PI&&l<Math.PI?(r=s*Math.sin(Math.PI-l),o=s*Math.cos(Math.PI-l),n=V.PlotUtils.getThirdPoint(e,a,V.Constants.HALF_PI,r,!1),V.PlotUtils.getThirdPoint(a,n,V.Constants.HALF_PI,o,!1)):l>=Math.PI&&l<1.5*Math.PI?(r=s*Math.sin(l-Math.PI),o=s*Math.cos(l-Math.PI),n=V.PlotUtils.getThirdPoint(e,a,V.Constants.HALF_PI,r,!0),V.PlotUtils.getThirdPoint(a,n,V.Constants.HALF_PI,o,!0)):(r=s*Math.sin(2*Math.PI-l),o=s*Math.cos(2*Math.PI-l),n=V.PlotUtils.getThirdPoint(e,a,V.Constants.HALF_PI,r,!0),V.PlotUtils.getThirdPoint(a,n,V.Constants.HALF_PI,o,!1))},E.algorithm.tailedAttackArrow=function(e){e=E.algorithm.dereplication(e),this.tailWidthFactor=M.tailWidthFactor,this.swallowTailFactor=M.swallowTailFactor,this.swallowTailPnt=M.swallowTailPnt;var t={controlPoint:null,polygonalPoint:null};if(!((f=(t.controlPoint=e).length)<2)){if(2==e.length)return t.polygonalPoint=e,t;var i=e,r=i[0],o=i[1];V.PlotUtils.isClockWise(i[0],i[1],i[2])&&(r=i[1],o=i[0]);var n=[V.PlotUtils.mid(r,o)].concat(i.slice(2)),a=E.algorithm.getAttackArrowHeadPoints(n,r,o,M),s=a[0],l=a[4],u=V.PlotUtils.distance(r,o),h=V.PlotUtils.getBaseLength(n),c=h*this.tailWidthFactor*this.swallowTailFactor;this.swallowTailPnt=V.PlotUtils.getThirdPoint(n[1],n[0],0,c,!0);var p=u/h,d=E.algorithm.getAttackArrowBodyPoints(n,s,l,p),f=d.length,g=[r].concat(d.slice(0,f/2));g.push(s);var m,_=[o].concat(d.slice(f/2,f));_.push(l),g=V.PlotUtils.getQBSplinePoints(g),_=V.PlotUtils.getQBSplinePoints(_),m=E.algorithm.array2Dto1D(g.concat(a,_.reverse(),[this.swallowTailPnt,g[0]])),t.polygonalPoint=Cesium.Cartesian3.fromDegreesArray(m)}return t},E.algorithm.getAttackArrowHeadPoints=function(e,t,i,r){this.headHeightFactor=r.headHeightFactor,this.headTailFactor=r.headTailFactor,this.headWidthFactor=r.headWidthFactor,this.neckWidthFactor=r.neckWidthFactor,this.neckHeightFactor=r.neckHeightFactor;var o=V.PlotUtils.getBaseLength(e),n=o*this.headHeightFactor,a=e[e.length-1];o=V.PlotUtils.distance(a,e[e.length-2]);var s=V.PlotUtils.distance(t,i);n>s*this.headTailFactor&&(n=s*this.headTailFactor);var l=n*this.headWidthFactor,u=n*this.neckWidthFactor,h=(n=o<n?o:n)*this.neckHeightFactor,c=V.PlotUtils.getThirdPoint(e[e.length-2],a,0,n,!0),p=V.PlotUtils.getThirdPoint(e[e.length-2],a,0,h,!0),d=V.PlotUtils.getThirdPoint(a,c,V.Constants.HALF_PI,l,!1),f=V.PlotUtils.getThirdPoint(a,c,V.Constants.HALF_PI,l,!0);return[V.PlotUtils.getThirdPoint(a,p,V.Constants.HALF_PI,u,!1),d,a,f,V.PlotUtils.getThirdPoint(a,p,V.Constants.HALF_PI,u,!0)]},E.algorithm.getAttackArrowBodyPoints=function(e,t,i,r){for(var o=V.PlotUtils.wholeDistance(e),n=V.PlotUtils.getBaseLength(e)*r,a=(n-V.PlotUtils.distance(t,i))/2,s=0,l=[],u=[],h=1;h<e.length-1;h++){var c=V.PlotUtils.getAngleOfThreePoints(e[h-1],e[h],e[h+1])/2,p=(n/2-(s+=V.PlotUtils.distance(e[h-1],e[h]))/o*a)/Math.sin(c),d=V.PlotUtils.getThirdPoint(e[h-1],e[h],Math.PI-c,p,!0),f=V.PlotUtils.getThirdPoint(e[h-1],e[h],c,p,!1);l.push(d),u.push(f)}return l.concat(u)},E.algorithm.dereplication=function(e){var t=e[e.length-1],i=!1,r=[];return r=e.filter((function(e){if(e[0]!=t[0]&&e[1]!=t[1])return e;i=!0})),i&&r.push(t),r};var L,N,R="function"==typeof w.a&&"symbol"==I()(C.a)?function(e){return I()(e)}:function(e){return e&&"function"==typeof w.a&&e.constructor===w.a&&e!==w.a.prototype?"symbol":I()(e)};L=window.Cesium,N=L.DrawHelper=function(){var e=L.Ellipsoid.WGS84,t={billBoard:[],primitives:[]};function i(e){this._scene=e.scene,this._tooltip=function(e){function t(e){var t=document.createElement("DIV");t.className="twipsy right";var i=document.createElement("DIV");i.className="twipsy-arrow",t.appendChild(i);var r=document.createElement("DIV");r.className="twipsy-inner",t.appendChild(r),this._div=t,this._title=r,e.appendChild(t)}return t.prototype.setVisible=function(e){this._div.style.display=e?"block":"none"},t.prototype.showAt=function(e,t){e&&t&&(this.setVisible(!0),this._title.innerHTML=t,this._div.style.left=e.x+10+"px",this._div.style.top=e.y-this._div.clientHeight/2+"px")},new t(e)}(e.container),this._surfaces=[],this.initialiseHandlers(),this.enhancePrimitives()}i.prototype.initialiseHandlers=function(){var e,t=this._scene,i=this,r=new L.ScreenSpaceEventHandler(t.canvas);function o(e,r){if(1!=i._handlersMuted){var o=t.pick(r);o&&o.primitive&&o.primitive[e]&&o.primitive[e](r)}}r.setInputAction((function(e){o("leftClick",e.position)}),L.ScreenSpaceEventType.LEFT_CLICK),r.setInputAction((function(e){o("leftDoubleClick",e.position)}),L.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),r.setInputAction((function(r){if(1!=i._handlersMuted){var o=t.pick(r.endPosition);!e||o&&e==o.primitive||(e.isDestroyed&&e.isDestroyed()||e.mouseOut(r.endPosition),e=null),o&&o.primitive&&((o=o.primitive).mouseOut&&(e=o),o.mouseMove&&o.mouseMove(r.endPosition))}}),L.ScreenSpaceEventType.MOUSE_MOVE),r.setInputAction((function(e){o("leftUp",e.position)}),L.ScreenSpaceEventType.LEFT_UP),r.setInputAction((function(e){o("leftDown",e.position)}),L.ScreenSpaceEventType.LEFT_DOWN)},i.prototype.setListener=function(e,t,i){e[t]=i},i.prototype.muteHandlers=function(e){this._handlersMuted=e},i.prototype.registerEditableShape=function(e){var i=this;S(e,"mouseMove",(function(t){e.setHighlighted(!0),e._editMode||i._tooltip.showAt(t,"点击以编辑图形")})),S(e,"mouseOut",(function(t){e.setHighlighted(!1),i._tooltip.setVisible(!1)})),S(e,"leftClick",(function(i){e.setEditMode(!0),t.primitives.push(e)})),S(e,"leftDoubleClick",(function(i){t.primitives.push(e)}))},i.prototype.startDrawing=function(e){this.disableAllEditMode(),this.editCleanUp&&this.editCleanUp(),this.editCleanUp=e,this.muteHandlers(!0)},i.prototype.stopDrawing=function(){this.editCleanUp&&(this.editCleanUp(),this.editCleanUp=null),this.muteHandlers(!1)},i.prototype.disableAllHighlights=function(){this.setHighlighted(void 0)},i.prototype.setHighlighted=function(e){this._highlightedSurface&&!this._highlightedSurface.isDestroyed()&&this._highlightedSurface!=e&&this._highlightedSurface.setHighlighted(!1),this._highlightedSurface=e},i.prototype.disableAllEditMode=function(){this.setEdited(void 0)},i.prototype.setEdited=function(e){this._editedSurface&&!this._editedSurface.isDestroyed()&&this._editedSurface.setEditMode(!1),this._editedSurface=e};var r=L.Material.fromType(L.Material.ColorType);r.uniforms.color=new L.Color(1,1,0,.5);var o={ellipsoid:L.Ellipsoid.WGS84,textureRotationAngle:0,height:0,asynchronous:!0,show:!0,debugShowBoundingVolume:!1},n=G(o,{appearance:new L.EllipsoidSurfaceAppearance({aboveGround:!1}),material:r,granularity:Math.PI/180}),a=G(o,{}),s=G(o,{}),l=G(o,{}),u=(G(n,{rotation:0}),G(o,{width:5,geodesic:!0,granularity:1e4,appearance:new L.PolylineMaterialAppearance({aboveGround:!1}),material:r})),h=(c.prototype.initialiseOptions=function(e){w(this,e),this._ellipsoid=void 0,this._granularity=void 0,this._height=void 0,this._textureRotationAngle=void 0,this._id=void 0,this._createPrimitive=!0,this._primitive=void 0,this._outlinePolygon=void 0},c.prototype.setAttribute=function(e,t){this[e]=t,this._createPrimitive=!0},c.prototype.getAttribute=function(e){return this[e]},c.prototype.update=function(e,t,i){if(!L.defined(this.ellipsoid))throw new L.DeveloperError("this.ellipsoid must be defined.");if(!L.defined(this.appearance))throw new L.DeveloperError("this.material must be defined.");if(this.granularity<0)throw new L.DeveloperError("this.granularity and scene2D/scene3D overrides must be greater than zero.");if(this.show&&(this._createPrimitive||L.defined(this._primitive))){if(this._createPrimitive||this._ellipsoid!==this.ellipsoid||this._granularity!==this.granularity||this._height!==this.height||this._textureRotationAngle!==this.textureRotationAngle||this._id!==this.id){var r=this.getGeometry();if(!r)return;this._createPrimitive=!1,this._ellipsoid=this.ellipsoid,this._granularity=this.granularity,this._height=this.height,this._textureRotationAngle=this.textureRotationAngle,this._id=this.id,this._primitive=this._primitive&&this._primitive.destroy(),this._primitive=new L.Primitive({geometryInstances:new L.GeometryInstance({geometry:r,id:this.id,pickPrimitive:this}),appearance:this.appearance,asynchronous:this.asynchronous}),this._outlinePolygon=this._outlinePolygon&&this._outlinePolygon.destroy(),this.strokeColor&&this.getOutlineGeometry&&(this._outlinePolygon=new L.Primitive({geometryInstances:new L.GeometryInstance({geometry:this.getOutlineGeometry(),attributes:{color:L.ColorGeometryInstanceAttribute.fromColor(this.strokeColor)}}),appearance:new L.PerInstanceColorAppearance({flat:!0,renderState:{depthTest:{enabled:!0},lineWidth:1}})}))}var o=this._primitive;o.appearance.material=this.material,o.debugShowBoundingVolume=this.debugShowBoundingVolume,o.update(e,t,i),this._outlinePolygon&&this._outlinePolygon.update(e,t,i)}},c.prototype.isDestroyed=function(){return!1},c.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),L.destroyObject(this)},c.prototype.setStrokeStyle=function(e,t){this.strokeColor&&this.strokeColor.equals(e)&&this.strokeWidth==t||(this._createPrimitive=!0,this.strokeColor=e,this.strokeWidth=t)},c);function c(){}function p(e){if(!L.defined(e.extent))throw new L.DeveloperError("Extent is required");e=G(e,n),this.initialiseOptions(e),this.setExtent(e.extent)}function d(e){e=G(e,n),this.initialiseOptions(e),this.isPolygon=!0}function f(e){e=G(e,n),this.initialiseOptions(e),this.isPolygon=!0}function g(e){e=G(e,u),this.initialiseOptions(e)}i.ExtentPrimitive=((p.prototype=new h).setExtent=function(e){this.setAttribute("extent",e)},p.prototype.getExtent=function(){return this.getAttribute("extent")},p.prototype.getGeometry=function(){if(L.defined(this.extent))return L.PolygonGeometry.fromPositions({positions:this.extent,height:this.height,vertexFormat:L.EllipsoidSurfaceAppearance.VERTEX_FORMAT,stRotation:this.textureRotationAngle,ellipsoid:this.ellipsoid,granularity:this.granularity})},p.prototype.getOutlineGeometry=function(){return L.PolygonOutlineGeometry.fromPositions({positions:this.extent})},p),i.PolygonPrimitive=((d.prototype=new h).setPositions=function(e){this.setAttribute("positions",e)},d.prototype.getPositions=function(){return this.getAttribute("positions")},d.prototype.setCustom=function(e){this.setAttribute("custom")},d.prototype.getCustom=function(e){return this.getAttribute("custom")},d.prototype.getGeometry=function(){if(L.defined(this.positions)&&!(this.positions.length<3))return L.PolygonGeometry.fromPositions({positions:this.positions,height:this.height,vertexFormat:L.EllipsoidSurfaceAppearance.VERTEX_FORMAT,stRotation:this.textureRotationAngle,ellipsoid:this.ellipsoid,granularity:this.granularity})},d.prototype.getOutlineGeometry=function(){return L.PolygonOutlineGeometry.fromPositions({positions:this.getPositions()})},d),i.TailedAttackPrimitive=((f.prototype=new h).setPositions=function(e){this.setAttribute("positions",e)},f.prototype.getPositions=function(){return this.getAttribute("positions")},f.prototype.setCustom=function(e){this.setAttribute("custom")},f.prototype.getCustom=function(e){return this.getAttribute("custom")},f.prototype.getGeometry=function(){if(L.defined(this.positions)&&!(this.positions.length<3))return L.PolygonGeometry.fromPositions({positions:this.positions,height:this.height,vertexFormat:L.EllipsoidSurfaceAppearance.VERTEX_FORMAT,stRotation:this.textureRotationAngle,ellipsoid:this.ellipsoid,granularity:this.granularity})},f.prototype.getOutlineGeometry=function(){return L.PolygonOutlineGeometry.fromPositions({positions:this.getPositions()})},f),i.PolylinePrimitive=((g.prototype=new h).setPositions=function(e){this.setAttribute("positions",e)},g.prototype.setWidth=function(e){this.setAttribute("width",e)},g.prototype.setGeodesic=function(e){this.setAttribute("geodesic",e)},g.prototype.getPositions=function(){return this.getAttribute("positions")},g.prototype.getWidth=function(){return this.getAttribute("width")},g.prototype.getGeodesic=function(e){return this.getAttribute("geodesic")},g.prototype.getGeometry=function(){if(L.defined(this.positions)&&!(this.positions.length<2))return new L.PolylineGeometry({positions:this.positions,height:this.height,width:this.width<1?1:this.width,vertexFormat:L.EllipsoidSurfaceAppearance.VERTEX_FORMAT,ellipsoid:this.ellipsoid})},g);var m={iconUrl:"/geomap-api/JsCesuimDemo/resource/images/img_plot/dragIcon.png",shiftX:0,shiftY:0},_={iconUrl:"/geomap-api/JsCesuimDemo/resource/images/img_plot/dragIcon.png",shiftX:0,shiftY:0},v={iconUrl:"/geomap-api/JsCesuimDemo/resource/images/img_plot/dragIconLight.png",shiftX:0,shiftY:0};function C(e){return[e[7],e[3]]}function y(e){var t=L.Cartographic.fromCartesian(e);return[L.Math.toDegrees(t.longitude),L.Math.toDegrees(t.latitude)]}function A(e,t){if(!(e.length<2||t.length<2)){var i=Math.PI/8.5,r=Math.PI/13,o=[];o[0]=e,o[1]=t;var n=o[0],a=o[1],s=V.PlotUtils.getBaseLength(o),l=.15*s,u=.2*s,h=.25*s,c=V.PlotUtils.getThirdPoint(a,n,V.Constants.HALF_PI,l,!0),p=V.PlotUtils.getThirdPoint(a,n,V.Constants.HALF_PI,l,!1),d=V.PlotUtils.getThirdPoint(n,a,i,h,!1),f=V.PlotUtils.getThirdPoint(n,a,i,h,!0),g=V.PlotUtils.getThirdPoint(n,a,r,u,!1),m=V.PlotUtils.getThirdPoint(n,a,r,u,!0),_=[];return _.push(c[0],c[1],g[0],g[1],d[0],d[1],a[0],a[1],f[0],f[1],m[0],m[1],p[0],p[1],n[0],n[1]),L.Cartesian3.fromDegreesArray(_)}}function I(e){for(var t=[],i=0;i<e.length;i++){var r=L.Cartesian3.fromDegrees(e[i][0],e[i][1],0);t.push(r)}return t}function b(e,t){if(null==e||"object"!=(void 0===e?"undefined":R(e)))return e;if(e.constructor!=Object&&e.constructor!=Array)return e;if(e.constructor==Date||e.constructor==RegExp||e.constructor==Function||e.constructor==String||e.constructor==Number||e.constructor==Boolean)return new e.constructor(e);for(var i in t=t||new e.constructor,e)t[i]=void 0===t[i]?b(e[i],null):t[i];return t}function w(e,t){var i;for(i in e=e||{},t)void 0===e[i]&&(e[i]=b(t[i]))}function G(e,t){var i,r=b(e);for(i in t)void 0===r[i]&&(r[i]=b(t[i]));return r}function S(e,t,i){e[t]=i}function P(e){e._listeners={},e.addListener=function(e,t){return this._listeners[e]=this._listeners[e]||[],this._listeners[e].push(t),this._listeners[e].length},e.executeListeners=function(e,t){if(this._listeners[e.name]&&0<this._listeners[e.name].length)for(var i=0;i<this._listeners[e.name].length;i++)this._listeners[e.name][i](e);else t&&t(e)}}return i.prototype.createBillboardGroup=function(e,t,r){var o=new i.BillboardGroup(this,t);return o.addBillboards(e,r),o},(i.BillboardGroup=function(e,t){this._drawHelper=e,this._scene=e._scene,this._options=G(t,m);var i=new L.BillboardCollection;this._scene.primitives.add(i),this._billboards=i,this._orderedBillboards=[]}).prototype.createBillboard=function(t,i){var r=this._billboards.add({show:!0,position:t,pixelOffset:new L.Cartesian2(this._options.shiftX,this._options.shiftY),eyeOffset:new L.Cartesian3(0,0,0),horizontalOrigin:L.HorizontalOrigin.CENTER,verticalOrigin:L.VerticalOrigin.CENTER,scale:1,image:this._options.iconUrl,color:new L.Color(1,1,1,1)});if(i){var o=function(e){s.enableRotate=e},n=function(){for(var e=0,t=a._orderedBillboards.length;e<t&&a._orderedBillboards[e]!=r;++e);return e},a=this,s=this._scene.screenSpaceCameraController;i.dragHandlers&&(a=this,S(r,"leftDown",(function(t){function s(e){l.destroy(),o(!0),i.dragHandlers.onDragEnd&&i.dragHandlers.onDragEnd(n(),e)}var l=new L.ScreenSpaceEventHandler(a._scene.canvas);l.setInputAction((function(t){var o=a._scene.camera.pickEllipsoid(t.endPosition,e);o?function(e){r.position=e;for(var t=0,o=a._orderedBillboards.length;t<o&&a._orderedBillboards[t]!=r;++t);i.dragHandlers.onDrag&&i.dragHandlers.onDrag(n(),e)}(o):s(o)}),L.ScreenSpaceEventType.MOUSE_MOVE),l.setInputAction((function(t){s(a._scene.camera.pickEllipsoid(t.position,e))}),L.ScreenSpaceEventType.LEFT_UP),o(!1),i.dragHandlers.onDragStart&&i.dragHandlers.onDragStart(n(),a._scene.camera.pickEllipsoid(t,e))}))),i.onDoubleClick&&S(r,"leftDoubleClick",(function(e){i.onDoubleClick(n())})),i.onClick&&S(r,"leftClick",(function(e){i.onClick(n())})),i.tooltip&&(S(r,"mouseMove",(function(e){a._drawHelper._tooltip.showAt(e,i.tooltip())})),S(r,"mouseOut",(function(e){a._drawHelper._tooltip.setVisible(!1)})))}return r},i.BillboardGroup.prototype.insertBillboard=function(e,t,i){this._orderedBillboards.splice(e,0,this.createBillboard(t,i))},i.BillboardGroup.prototype.addBillboard=function(e,t){this._orderedBillboards.push(this.createBillboard(e,t))},i.BillboardGroup.prototype.removeLastBillboard=function(){this._billboards.remove(this._orderedBillboards.pop())},i.BillboardGroup.prototype.addBillboards=function(e,t){for(var i=0;i<e.length;i++)this.addBillboard(e[i],t)},i.BillboardGroup.prototype.updateBillboardsPositions=function(e){for(var t=0;t<e.length;t++)this.getBillboard(t).position=e[t]},i.BillboardGroup.prototype.countBillboards=function(){return this._orderedBillboards.length},i.BillboardGroup.prototype.getBillboard=function(e){return this._orderedBillboards[e]},i.BillboardGroup.prototype.removeBillboard=function(e){this._billboards.remove(this.getBillboard(e)),this._orderedBillboards.splice(e,1)},i.BillboardGroup.prototype.remove=function(){this._billboards=this._billboards&&this._billboards.removeAll()&&this._billboards.destroy()},i.BillboardGroup.prototype.setOnTop=function(){this._scene.primitives.raiseToTop(this._billboards)},i.prototype.startDrawingPolygon=function(e){e=G(e,n),this.startDrawingPolyshape(!0,e)},i.prototype.startDrawingPolyline=function(t){t=G(t,u),this.startDrawing((function(){a.remove(r),h.remove(),c.destroy(),s.setVisible(!1)}));var r,o=this,n=this._scene,a=n.primitives,s=this._tooltip;(r=new N.PolylinePrimitive(t)).asynchronous=!1,a.add(r);var l=[],h=new i.BillboardGroup(this,m),c=new L.ScreenSpaceEventHandler(n.canvas);c.setInputAction((function(t){if(null!=t.position){var i=n.camera.pickEllipsoid(t.position,e);i&&(0==l.length&&(l.push(i.clone()),h.addBillboard(l[0])),2<=l.length&&(r.positions=l,r._createPrimitive=!0),l.push(i),h.addBillboard(i))}}),L.ScreenSpaceEventType.LEFT_CLICK),c.setInputAction((function(t){var i=t.endPosition;if(null!=i)if(0==l.length)s.showAt(i,"<p>Click to add first point</p>");else{var o=n.camera.pickEllipsoid(i,e);o&&(l.pop(),o.y+=1+Math.random(),l.push(o),2<=l.length&&(r.positions=l,r._createPrimitive=!0),h.getBillboard(l.length-1).position=o,s.showAt(i,"<p>Click to add new point ("+l.length+")</p>"+(2<l.length?"<p>Double click to finish drawing</p>":"")))}}),L.ScreenSpaceEventType.MOUSE_MOVE),c.setInputAction((function(i){var r=i.position;if(null!=r){if(l.length<4)return;n.camera.pickEllipsoid(r,e)&&(o.stopDrawing(),"function"==typeof t.callback)&&(l.length,t.callback(l))}}),L.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)},i.prototype.startDrawingTailedAttack=function(t){this.startDrawing((function(){n.remove(s),h.remove(),c.destroy(),a.setVisible(!1)})),this.firstTime=!0,this.options=t;var r=this,o=this._scene,n=o.primitives,a=this._tooltip,s=new N.TailedAttackPrimitive(t);/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent)?s.asynchronous=!0:s.asynchronous=!1,n.add(s);var l=[],u=[],h=new i.BillboardGroup(this,m),c=new L.ScreenSpaceEventHandler(o.canvas);this.positions=l,this.minPoints=2,this.poly=s,c.setInputAction((function(t){if(null!=t.position){var i=o.camera.pickEllipsoid(t.position,e),r=L.Cartographic.fromCartesian(i),n=[L.Math.toDegrees(r.longitude),L.Math.toDegrees(r.latitude)];if(i){if(0==u.length&&(l.push(i.clone()),h.addBillboard(l[0])),u.length<3&&u.push(n),2<=u.length){u.push(n);var a=E.algorithm.tailedAttackArrow(u);s.positions=a.polygonalPoint,s.custom=a.controlPoint,s._createPrimitive=!0}l.push(i),5<=l.length&&h.removeLastBillboard(),h.addBillboard(i)}}}),L.ScreenSpaceEventType.LEFT_CLICK),c.setInputAction((function(t){var i=t.endPosition;if(null!=i)if(0==l.length)a.showAt(i,"<p>点击以增加第一个控制点</p>");else{var r=o.camera.pickEllipsoid(i,e),n=L.Cartographic.fromCartesian(r),h=[L.Math.toDegrees(n.longitude),L.Math.toDegrees(n.latitude)];if(r){if(l.pop(),r.y+=1+Math.random(),l.push(r),3<=u.length&&(u.pop(),u.push(h)),2==u.length&&u.push(h),2<l.length){var c=E.algorithm.tailedAttackArrow(u);s.positions=c?c.polygonalPoint:null,s.custom=c?c.controlPoint:null,s._createPrimitive=!0}var p=3==l.length?"<p>双击可结束绘制</p>":"单击以增加一个新的控制点";a.showAt(i,p)}}}),L.ScreenSpaceEventType.MOUSE_MOVE),c.setInputAction((function(e){r.drawEnd(e,t)}),L.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)},i.prototype.drawEnd=function(t,i){var r,o=this.positions,n=this.minPoints,a=this.poly;if(i=this.options,null==t){if(this.firstTime){if(this.stopDrawing(),"function"!=typeof i.callback)return;o.length,i.callback(a.positions,a.custom),this.firstTime=!1}}else if(null!=(r=t.position)){if(o.length<n+2)return;scene.camera.pickEllipsoid(r,e)&&(this.stopDrawing(),"function"==typeof i.callback)&&(o.length,i.callback(a.positions,a.custom))}},i.prototype.startDrawingPolyshape=function(t,r){this.startDrawing((function(){s.remove(o),c.remove(),p.destroy(),l.setVisible(!1)})),this.firstTime=!0,this.options=r;var o,n=this,a=this._scene,s=a.primitives,l=this._tooltip;this.minPoints=2,o=t?new N.PolygonPrimitive(r):new N.PolylinePrimitive(r),/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent)?o.asynchronous=!0:o.asynchronous=!1,s.add(o);var u=[],h=[],c=new i.BillboardGroup(this,m),p=new L.ScreenSpaceEventHandler(a.canvas);this.poly=o,this.positions=u,p.setInputAction((function(t){if(null!=t.position){var i=a.camera.pickEllipsoid(t.position,e),r=L.Cartographic.fromCartesian(i),n=[L.Math.toDegrees(r.longitude),L.Math.toDegrees(r.latitude)];if(i){if(0==h.length&&(u.push(i.clone()),c.addBillboard(u[0])),h.length<3&&h.push(n),2<=h.length){var s=E.algorithm.doubleArrow(h);o.positions=s.polygonalPoint,o.custom=s.controlPoint,o._createPrimitive=!0}u.push(i),5<=u.length&&c.removeLastBillboard(),c.addBillboard(i)}}}),L.ScreenSpaceEventType.LEFT_CLICK),p.setInputAction((function(t){var i=t.endPosition;if(null!=i)if(0==u.length)l.showAt(i,"<p>点击以增加第一个控制点</p>");else{var r=a.camera.pickEllipsoid(i,e),n=L.Cartographic.fromCartesian(r),s=[L.Math.toDegrees(n.longitude),L.Math.toDegrees(n.latitude)];if(r){if(u.pop(),r.y+=1+Math.random(),u.push(r),3==h.length&&(h.pop(),h.push(s)),2==h.length&&h.push(s),2<=u.length){var c=E.algorithm.doubleArrow(h);o.positions=c?c.polygonalPoint:null,o.custom=c?c.controlPoint:null,o._createPrimitive=!0}var p=3==u.length?"<p>双击可结束绘制</p>":"单击以增加一个新的控制点";l.showAt(i,p)}}}),L.ScreenSpaceEventType.MOUSE_MOVE),p.setInputAction((function(e){n.drawEnd(e,r)}),L.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)},i.prototype.startDrawingExtent=function(t){t=G(t,n),this.startDrawing((function(){null!=u&&a.remove(u),h.remove(),c.destroy(),s.setVisible(!1)}));var r=this,o=this._scene,a=this._scene.primitives,s=this._tooltip,l=[],u=null,h=null,c=new L.ScreenSpaceEventHandler(o.canvas);c.setInputAction((function(n){if(null!=n.position){var s=o.camera.pickEllipsoid(n.position,e);if(s)if(null==u){var c=L.Cartographic.fromCartesian(s),p=L.Math.toDegrees(c.longitude),d=L.Math.toDegrees(c.latitude);l.push(p,d);var f=A(l,l);u=new i.ExtentPrimitive({extent:f,asynchronous:!1,material:t.material}),a.add(u),h=new i.BillboardGroup(r,m);var g=I([l,l]);h.addBillboards(g)}else r.stopDrawing(),"function"==typeof t.callback&&(c=L.Cartographic.fromCartesian(s),p=L.Math.toDegrees(c.longitude),d=L.Math.toDegrees(c.latitude),t.callback(A(l,[p,d])))}}),L.ScreenSpaceEventType.LEFT_DOWN),c.setInputAction((function(t){var i=t.endPosition;if(null!=i)if(null==u)s.showAt(i,"<p>点击开始绘制</p>");else{var r=o.camera.pickEllipsoid(i,e);if(r){var n=L.Cartographic.fromCartesian(r),a=L.Math.toDegrees(n.longitude),c=L.Math.toDegrees(n.latitude),p=A(l,[a,c]);u.setExtent(p);var d=I([l,[a,c]]);h.updateBillboardsPositions(d),s.showAt(i,"<p>拖动改变箭头</p><p>再次点击结束绘制</p>")}}}),L.ScreenSpaceEventType.MOUSE_MOVE)},i.prototype.enhancePrimitives=function(){var r=this;function o(e){r._scene,this._highlighted&&this._highlighted==e||!0!==this._editMode&&((this._highlighted=e)?(r.setHighlighted(this),this._strokeColor=this.strokeColor,this.setStrokeStyle(L.Color.fromCssColorString("white"),this.strokeWidth)):this._strokeColor?this.setStrokeStyle(this._strokeColor,this.strokeWidth):this.setStrokeStyle(void 0,void 0))}function n(o){if(this._editMode!=o)if(r.disableAllHighlights(),o){r.setEdited(this);var n=r._scene,a=this;if(null==this._markers){var s=function(e,t){var i=e-1<0?t.length-1:e-1;i<c.countBillboards()&&(c.getBillboard(i).position=u(i)),(i=e)<c.countBillboards()&&(c.getBillboard(i).position=u(i))},l=function(){a.executeListeners({name:"onEdited",positions:a.positions})},u=function(t){var i=a.positions;return e.cartographicToCartesian(new L.EllipsoidGeodesic(e.cartesianToCartographic(i[t]),e.cartesianToCartographic(i[t<i.length-1?t+1:0])).interpolateUsingFraction(.5))},h=new i.BillboardGroup(r,_);t.billBoard.push(h);var c=new i.BillboardGroup(r,v);t.billBoard.push(c);var p={dragHandlers:{onDrag:function(e,t){a.positions[e]=t,s(e,a.positions),a._createPrimitive=!0},onDragEnd:function(){a._createPrimitive=!0,l()}},onDoubleClick:function(e){a.positions.length<4||(a.positions.splice(e,1),a._createPrimitive=!0,h.removeBillboard(e),c.removeBillboard(e),s(e,a.positions),l())},tooltip:function(){if(3<a.positions.length)return"Double click to remove this point"}};h.addBillboards(a.positions,p),this._markers=h;for(var d=[],f=0,g=a.positions.length+(this.isPolygon?0:-1);f<g;f++)d.push(u(f));var m={dragHandlers:{onDragStart:function(e,t){this.index=e+1,a.positions.splice(this.index,0,t),a._createPrimitive=!0},onDrag:function(e,t){a.positions[this.index]=t,a._createPrimitive=!0},onDragEnd:function(e,t){h.insertBillboard(this.index,t,p),c.getBillboard(this.index-1).position=u(this.index-1),c.insertBillboard(this.index,u(this.index),m),a._createPrimitive=!0,l()}},tooltip:function(){return"Drag to create a new point"}};c.addBillboards(d,m),this._editMarkers=c,this._globeClickhandler=new L.ScreenSpaceEventHandler(n.canvas),this._globeClickhandler.setInputAction((function(e){var t=n.pick(e.position);t&&t.primitive||a.setEditMode(!1)}),L.ScreenSpaceEventType.LEFT_CLICK),h.setOnTop(),c.setOnTop()}this._editMode=!0}else null!=this._markers&&(this._markers.remove(),this._editMarkers.remove(),this._markers=null,this._editMarkers=null,this._globeClickhandler.destroy()),this._editMode=!1}L.Billboard.prototype.setEditable=function(){if(!this._editable){this._editable=!0;var t=this,i=this;S(t,"leftDown",(function(n){function a(e){s.destroy(),o(!0),i.executeListeners({name:"dragEnd",positions:e})}var s=new L.ScreenSpaceEventHandler(r._scene.canvas);s.setInputAction((function(o){var n=r._scene.camera.pickEllipsoid(o.endPosition,e);n?function(e){t.position=e,i.executeListeners({name:"drag",positions:e})}(n):a(n)}),L.ScreenSpaceEventType.MOUSE_MOVE),s.setInputAction((function(t){a(r._scene.camera.pickEllipsoid(t.position,e))}),L.ScreenSpaceEventType.LEFT_UP),o(!1)})),P(t)}function o(e){r._scene.screenSpaceCameraController.enableRotate=e}},N.PolylinePrimitive.prototype.setEditable=function(){if(!this.setEditMode){var t=this;t.isPolygon=!1,t.asynchronous=!1,r.registerEditableShape(t),t.setEditMode=n;var i=this.width;t.setHighlighted=function(e){!0!==this._editMode&&(e?(r.setHighlighted(this),this.setWidth(2*i)):this.setWidth(i))},t.getExtent=function(){return L.Extent.fromCartographicArray(e.cartesianArrayToCartographicArray(this.positions))},P(t),t.setEditMode(!1)}},N.PolygonPrimitive.prototype.setEditable=function(){var e=this;e.asynchronous=!1;var n=r._scene;r.registerEditableShape(e),e.setEditMode=function(o){if(this._editMode!=o)if(r.disableAllHighlights(),o){if(r.setEdited(this),null==this._markers){var a=new i.BillboardGroup(r,_);t.billBoard.push(a);var s={dragHandlers:{onDrag:function(t,i){var r=e.custom;r[t]=y(i);var o=E.algorithm.doubleArrow(r);e.positions=o.polygonalPoint,e.custom=o.controlPoint,e._createPrimitive=!0,a.updateBillboardsPositions(I(e.custom))},onDragEnd:function(){e.executeListeners({name:"onEdited",positions:e.positions})}},tooltip:function(){return"拖动以钳击形状"}},l=e.custom;a.addBillboards(I(l),s),this._markers=a,this._globeClickhandler=new L.ScreenSpaceEventHandler(n.canvas),this._globeClickhandler.setInputAction((function(t){var i=n.pick(t.position);console.log("PolygonPrimitive单击"),i&&i.primitive||e.setEditMode(!1)}),L.ScreenSpaceEventType.LEFT_CLICK),a.setOnTop()}this._editMode=!0}else null!=this._markers&&(this._markers.remove(),this._markers=null,this._globeClickhandler.destroy()),this._editMode=!1},e.setHighlighted=o,P(e),e.setEditMode(!1)},N.TailedAttackPrimitive.prototype.setEditable=function(){var e=this;e.asynchronous=!1;var n=r._scene;r.registerEditableShape(e),e.setEditMode=function(o){if(this._editMode!=o)if(r.disableAllHighlights(),o){if(r.setEdited(this),null==this._markers){var a=new i.BillboardGroup(r,_);t.billBoard.push(a);var s={dragHandlers:{onDrag:function(t,i){var r=e.custom;r[t]=y(i);var o=E.algorithm.tailedAttackArrow(r);e.positions=o.polygonalPoint,e.custom=o.controlPoint,e._createPrimitive=!0,a.updateBillboardsPositions(I(e.custom))},onDragEnd:function(){e.executeListeners({name:"onEdited",positions:e.positions})}},tooltip:function(){return"拖动以改变形状"}},l=e.custom;a.addBillboards(I(l),s),this._markers=a,this._globeClickhandler=new L.ScreenSpaceEventHandler(n.canvas),this._globeClickhandler.setInputAction((function(t){var i=n.pick(t.position);console.log("TailedAttackPrimitive单击"),i&&i.primitive||e.setEditMode(!1)}),L.ScreenSpaceEventType.LEFT_CLICK),a.setOnTop()}this._editMode=!0}else null!=this._markers&&(this._markers.remove(),this._markers=null,this._globeClickhandler.destroy()),this._editMode=!1},e.setHighlighted=o,P(e),e.setEditMode(!1)},N.ExtentPrimitive.prototype.setEditable=function(){if(!this.setEditMode){var e=this,n=r._scene;r.registerEditableShape(e),e.asynchronous=!1,e.setEditMode=function(o){if(this._editMode!=o)if(r.disableAllHighlights(),o){if(r.setEdited(this),null==this._markers){var a=new i.BillboardGroup(r,_);t.billBoard.push(a);var s={dragHandlers:{onDrag:function(t,i){var r=y(i),o=y(a.getBillboard((t+1)%2).position),n=0==t?A(r,o):A(o,r);e.setExtent(n),a.updateBillboardsPositions(C(e.extent))},onDragEnd:function(){e.executeListeners({name:"onEdited",extent:e.extent})}},tooltip:function(){return"拖动以改变此箭头形状"}};a.addBillboards(C(e.extent),s),this._markers=a,this._globeClickhandler=new L.ScreenSpaceEventHandler(n.canvas),this._globeClickhandler.setInputAction((function(t){var i=n.pick(t.position);console.log("ExtentPrimitive单击"),i&&i.primitive||e.setEditMode(!1)}),L.ScreenSpaceEventType.LEFT_CLICK),a.setOnTop()}this._editMode=!0}else null!=this._markers&&(this._markers.remove(),this._markers=null,this._globeClickhandler.destroy()),this._editMode=!1},e.setHighlighted=o,P(e),e.setEditMode(!1)}}},i.DrawHelperWidget=function(e,i){if(!L.defined(i.container))throw new L.DeveloperError("Container is required");w(i,{markerIcon:"./img/glyphicons_242_google_maps.png",polylineIcon:"./img/glyphicons_097_vector_path_line.png",polygonIcon:"./img/qianjijiantou.png",circleIcon:"./img/glyphicons_095_vector_path_circle.png",tailedAttackArrowIcon:"./img/gongjijiantou.png",extentIcon:"./img/zhijiaojiantou.png",clearIcon:"./img/glyphicons_067_cleaning.png",polylineDrawingOptions:u,polygonDrawingOptions:a,extentDrawingOptions:s,circleDrawingOptions:l});var r=this,o=document.createElement("DIV");function n(e,t,i,r){var n=document.createElement("DIV");n.className="button",n.title=i,o.appendChild(n),n.onclick=r;var a=document.createElement("SPAN");n.appendChild(a);var s=document.createElement("IMG");return s.src=t,a.appendChild(s),n}o.className="toolbar",i.container.appendChild(o);var h=e._scene;n(0,i.extentIcon,"点击以绘制直箭头",(function(){e.startDrawingExtent({callback:function(e){r.executeListeners({name:"extentCreated",extent:e})}})})),n(0,i.polygonIcon,"点击以绘制钳击箭头",(function(){e.startDrawingPolygon({callback:function(e,t){r.executeListeners({name:"polygonCreated",positions:e,custom:t})}})})),n(0,i.tailedAttackArrowIcon,"点击以绘制攻击箭头",(function(){e.startDrawingTailedAttack({callback:function(e,t){r.executeListeners({name:"tailedAttackCreated",positions:e,custom:t})}})}));var c=document.createElement("DIV");c.className="divider",o.appendChild(c),n(0,i.clearIcon,"Remove all primitives",(function(){for(var e=t.primitives.length,i=t.billBoard.length,r=0;r<e;r++){var o=t.primitives.pop();o._globeClickhandler.destroy(),h.primitives.remove(o)}for(r=0;r<i;r++)t.billBoard.pop().remove()})),P(this)},i.prototype.addToolbar=function(e,t){return t=G(t,{container:e}),new i.DrawHelperWidget(this,t)},i.DrawWidget=function(e,t){var i=this;"extentCreated"==t&&e.startDrawingExtent({callback:function(e){i.executeListeners({name:"extentCreated",extent:e})}}),"polygonCreated"==t&&e.startDrawingPolygon({callback:function(e,t){i.executeListeners({name:"polygonCreated",positions:e,custom:t})}}),"tailedAttackCreated"==t&&e.startDrawingTailedAttack({callback:function(e,t){i.executeListeners({name:"tailedAttackCreated",positions:e,custom:t})}}),P(this)},i.ClearWidget=function(){var e=drawHelper._scene,i=t.primitives.length,r=t.billBoard.length;if(0!=i&&t.primitives[i-1]._editMode){for(var o=0;o<1;o++){var n=t.primitives[i-1];n._globeClickhandler.destroy(),e.primitives.remove(n)}for(o=0;o<1;o++)t.billBoard[r-1].remove();t={billBoard:[],primitives:[]},P(this)}},i.prototype.active=function(e){return new i.DrawWidget(this,e)},i.prototype.clear=function(){return new i.ClearWidget(this)},i}();var O,D,F,U,B,k,V={version:"1.0.0",PlotUtils:{}};if(V.PlotUtils.distance=function(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))},V.PlotUtils.wholeDistance=function(e){for(var t=0,i=0;i<e.length-1;i++)t+=V.PlotUtils.distance(e[i],e[i+1]);return t},V.PlotUtils.getBaseLength=function(e){return Math.pow(V.PlotUtils.wholeDistance(e),.99)},V.PlotUtils.mid=function(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]},V.PlotUtils.getCircleCenterOfThreePoints=function(e,t,i){var r=[(e[0]+t[0])/2,(e[1]+t[1])/2],o=[r[0]-e[1]+t[1],r[1]+e[0]-t[0]],n=[(e[0]+i[0])/2,(e[1]+i[1])/2],a=[n[0]-e[1]+i[1],n[1]+e[0]-i[0]];return V.PlotUtils.getIntersectPoint(r,o,n,a)},V.PlotUtils.getIntersectPoint=function(e,t,i,r){if(e[1]==t[1]){var o=(r[0]-i[0])/(r[1]-i[1]),n=o*(e[1]-i[1])+i[0],a=e[1];return[n,a]}if(i[1]!=r[1])return s=(t[0]-e[0])/(t[1]-e[1]),o=(r[0]-i[0])/(r[1]-i[1]),[n=s*(a=(s*e[1]-e[0]-o*i[1]+i[0])/(s-o))-s*e[1]+e[0],a];var s=(t[0]-e[0])/(t[1]-e[1]);return[n=s*(i[1]-e[1])+e[0],a=i[1]]},V.PlotUtils.getAzimuth=function(e,t){var i,r=Math.asin(Math.abs(t[1]-e[1])/V.PlotUtils.distance(e,t));return t[1]>=e[1]&&t[0]>=e[0]?i=r+Math.PI:t[1]>=e[1]&&t[0]<e[0]?i=V.Constants.TWO_PI-r:t[1]<e[1]&&t[0]<e[0]?i=r:t[1]<e[1]&&t[0]>=e[0]&&(i=Math.PI-r),i},V.PlotUtils.getAngleOfThreePoints=function(e,t,i){var r=V.PlotUtils.getAzimuth(t,e)-V.PlotUtils.getAzimuth(t,i);return r<0?r+V.Constants.TWO_PI:r},V.PlotUtils.isClockWise=function(e,t,i){return(i[1]-e[1])*(t[0]-e[0])>(t[1]-e[1])*(i[0]-e[0])},V.PlotUtils.getPointOnLine=function(e,t,i){return[t[0]+e*(i[0]-t[0]),t[1]+e*(i[1]-t[1])]},V.PlotUtils.getCubicValue=function(e,t,i,r,o){var n=1-(e=Math.max(Math.min(e,1),0)),a=e*e,s=a*e,l=n*n,u=l*n;return[u*t[0]+3*l*e*i[0]+3*n*a*r[0]+s*o[0],u*t[1]+3*l*e*i[1]+3*n*a*r[1]+s*o[1]]},V.PlotUtils.getThirdPoint=function(e,t,i,r,o){var n=V.PlotUtils.getAzimuth(e,t),a=o?n+i:n-i,s=r*Math.cos(a),l=r*Math.sin(a);return[t[0]+s,t[1]+l]},V.PlotUtils.getArcPoints=function(e,t,i,r){var o,n,a=[],s=r-i;s=s<0?s+V.Constants.TWO_PI:s;for(var l=0;l<=V.Constants.FITTING_COUNT;l++){var u=i+s*l/V.Constants.FITTING_COUNT;o=e[0]+t*Math.cos(u),n=e[1]+t*Math.sin(u),a.push([o,n])}return a},V.PlotUtils.getBisectorNormals=function(e,t,i,r){var o=V.PlotUtils.getNormal(t,i,r),n=Math.sqrt(o[0]*o[0]+o[1]*o[1]),a=o[0]/n,s=o[1]/n,l=V.PlotUtils.distance(t,i),u=V.PlotUtils.distance(i,r);if(n>V.Constants.ZERO_TOLERANCE)if(V.PlotUtils.isClockWise(t,i,r)){var h=e*l,c=i[0]-h*s,p=i[1]+h*a,d=[c,p];h=e*u;var f=[c=i[0]+h*s,p=i[1]-h*a]}else h=e*l,d=[c=i[0]+h*s,p=i[1]-h*a],h=e*u,f=[c=i[0]-h*s,p=i[1]+h*a];else d=[c=i[0]+e*(t[0]-i[0]),p=i[1]+e*(t[1]-i[1])],f=[c=i[0]+e*(r[0]-i[0]),p=i[1]+e*(r[1]-i[1])];return[d,f]},V.PlotUtils.getNormal=function(e,t,i){var r=e[0]-t[0],o=e[1]-t[1],n=Math.sqrt(r*r+o*o);r/=n,o/=n;var a=i[0]-t[0],s=i[1]-t[1],l=Math.sqrt(a*a+s*s);return[r+(a/=l),o+(s/=l)]},V.PlotUtils.getCurvePoints=function(e,t){for(var i=[V.PlotUtils.getLeftMostControlPoint(t)],r=0;r<t.length-2;r++){var o=t[r],n=t[r+1],a=t[r+2],s=V.PlotUtils.getBisectorNormals(e,o,n,a);i=i.concat(s)}var l=V.PlotUtils.getRightMostControlPoint(t);i.push(l);var u=[];for(r=0;r<t.length-1;r++){for(o=t[r],n=t[r+1],u.push(o),e=0;e<V.Constants.FITTING_COUNT;e++){var h=V.PlotUtils.getCubicValue(e/V.Constants.FITTING_COUNT,o,i[2*r],i[2*r+1],n);u.push(h)}u.push(n)}return u},V.PlotUtils.getLeftMostControlPoint=function(e){var i=e[0],r=e[1],o=e[2],n=V.PlotUtils.getBisectorNormals(0,i,r,o)[0],a=V.PlotUtils.getNormal(i,r,o);if(Math.sqrt(a[0]*a[0]+a[1]*a[1])>V.Constants.ZERO_TOLERANCE)var s=V.PlotUtils.mid(i,r),l=i[0]-s[0],u=i[1]-s[1],h=2/V.PlotUtils.distance(i,r),c=-h*u,p=h*l,d=c*c-p*p,f=2*c*p,g=p*p-c*c,m=n[0]-s[0],_=n[1]-s[1],v=s[0]+d*m+f*_,C=s[1]+f*m+g*_;else v=i[0]+t*(r[0]-i[0]),C=i[1]+t*(r[1]-i[1]);return[v,C]},V.PlotUtils.getRightMostControlPoint=function(e){var i=e.length,r=e[i-3],o=e[i-2],n=e[i-1],a=V.PlotUtils.getBisectorNormals(0,r,o,n)[1],s=V.PlotUtils.getNormal(r,o,n);if(Math.sqrt(s[0]*s[0]+s[1]*s[1])>V.Constants.ZERO_TOLERANCE)var l=V.PlotUtils.mid(o,n),u=n[0]-l[0],h=n[1]-l[1],c=2/V.PlotUtils.distance(o,n),p=-c*h,d=c*u,f=p*p-d*d,g=2*p*d,m=d*d-p*p,_=a[0]-l[0],v=a[1]-l[1],C=l[0]+f*_+g*v,y=l[1]+g*_+m*v;else C=n[0]+t*(o[0]-n[0]),y=n[1]+t*(o[1]-n[1]);return[C,y]},V.PlotUtils.getBezierPoints=function(e){if(e.length<=2)return e;for(var t=[],i=e.length-1,r=0;r<=1;r+=.01){for(var o=y=0,n=0;n<=i;n++){var a=V.PlotUtils.getBinomialFactor(i,n),s=Math.pow(r,n),l=Math.pow(1-r,i-n);o+=a*s*l*e[n][0],y+=a*s*l*e[n][1]}t.push([o,y])}return t.push(e[i]),t},V.PlotUtils.getBinomialFactor=function(e,t){return V.PlotUtils.getFactorial(e)/(V.PlotUtils.getFactorial(t)*V.PlotUtils.getFactorial(e-t))},V.PlotUtils.getFactorial=function(e){if(e<=1)return 1;if(2==e)return 2;if(3==e)return 6;if(4==e)return 24;if(5==e)return 120;for(var t=1,i=1;i<=e;i++)t*=i;return t},V.PlotUtils.getQBSplinePoints=function(e){if(e.length<=2)return e;var t=[],i=e.length-2-1;t.push(e[0]);for(var r=0;r<=i;r++)for(var o=0;o<=1;o+=.05){for(var n=y=0,a=0;a<=2;a++){var s=V.PlotUtils.getQuadricBSplineFactor(a,o);n+=s*e[r+a][0],y+=s*e[r+a][1]}t.push([n,y])}return t.push(e[e.length-1]),t},V.PlotUtils.getQuadricBSplineFactor=function(e,t){return 0==e?Math.pow(t-1,2)/2:1==e?(-2*Math.pow(t,2)+2*t+1)/2:2==e?Math.pow(t,2)/2:0},V.Constants={TWO_PI:2*Math.PI,HALF_PI:Math.PI/2,FITTING_COUNT:100,ZERO_TOLERANCE:1e-4},function(e){var t=e.MeasureAreaWidget=function(t,i){this.viewer=t.viewer,this.color=t.color?t.color:e.Color.CHARTREUSE.withAlpha(.5),this.lineWidth=t.lineWidth?t.lineWidth:2,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.ellipsoid=this.scene.globe.ellipsoid,this.count=0,this.entityNames=[],this.labelNames=[],this.mode=t.mode?t.mode:1};function i(t,i,r,o){var n=t.add(new e.LabelCollection);n.name="result_labelArea"+o,n.add({text:i,font:"16px sans-serif",showBackground:!0,disableDepthTestDistance:Number.POSITIVE_INFINITY}),n.get(n.length-1).position=r[r.length-1]}function r(e,t){for(var i=0;i<t.length;i++)void 0!==t.get(i).name&&-1<t.get(i).name.indexOf(e)&&(t.remove(t.get(i)),i--)}function o(e,t){for(var i=t.values,r=0;r<i.length;r++)-1<i[r].name.indexOf(e)&&(t.remove(i[r]),r--)}t.prototype.activate=function(){if(this.handler=this.handler&&this.handler.destroy(),!this.handler){this.handler=new e.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var t,i,r,o=this,n=[];this._array_=n,this._polylines_=t,this._labels_=i,this.handler.setInputAction((function(i){if(o.lastP=i,1==o.mode)var a=o.camera.getPickRay(i.position),s=o.scene.globe.pick(a,o.scene);else s=o.scene.pickPosition(i.position);s&&(n.push(s),1==n.length&&((t=o.primitives.add(new e.PolylineCollection)).name="draw_polyline",t.add({polyline:{}}),t.get(t.length-1).width=o.lineWidth,t.get(t.length-1).loop=!0,t.get(t.length-1).material.uniforms.color=o.color,t.get(t.length-1).positions=n),3<=n.length&&(t.get(t.length-1).positions=n,/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent)&&o.measureEnd()),o._polylines_=t,/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent)&&((r=o.primitives.add(new e.PointPrimitiveCollection)).name="draw_point",r.add({position:s,color:e.Color.WHITE,outlineColor:e.Color.RED,outlineWidth:1,pixelSize:5})))}),e.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction((function(r){if(!/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent)){if(1==o.mode)var a=o.camera.getPickRay(r.endPosition),s=o.scene.globe.pick(a,o.scene);else s=o.scene.pickPosition(r.endPosition);if(!s)return void(i&&(o.primitives.remove(i),i=null));if(1<=n.length){var l=n.concat();l.push(s),t.get(t.length-1).positions=l}i||((i=o.primitives.add(new e.LabelCollection)).name="draw_label",i.add({text:"左键单击开始绘制，右键单击结束绘制",font:"16px sans-serif",showBackground:!0,pixelOffset:new e.Cartesian2(10,10),disableDepthTestDistance:Number.POSITIVE_INFINITY})),i.get(i.length-1).position=s,o._labels_=i}}),e.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction((function(e){o.measureEnd(),o.handler=o.handler&&o.handler.destroy(),o.viewer.canvas.style.cursor="default"}),e.ScreenSpaceEventType.RIGHT_CLICK)}},t.prototype.selectFeatures=function(t){this.handler=this.handler&&this.handler.destroy(),this.handler=new e.ScreenSpaceEventHandler(this.canvas);var i=this;this.handler.setInputAction((function(t){var r=i.viewer.scene.pick(new e.Cartesian2(t.position.x,t.position.y));if(null!=r&&null!=r.id&&null!=r.id.polygon){r.id.polygon.material.color=e.Color.CHARTREUSE;var o=r.id.name,n=o.replace(/draw_polygon/,"result_labelArea");i.entityNames.push(o),i.labelNames.push(n)}}),e.ScreenSpaceEventType.LEFT_CLICK)},t.prototype.delete=function(){this.handler=this.handler&&this.handler.destroy();for(var e=0;e<this.entityNames.length;e++)o(this.entityNames[e],this.viewer.entities);for(var t=0;t<this.labelNames.length;t++)r(this.labelNames[t],this.primitives);this.count=0,this.entityNames=[],this.labelNames=[]},t.prototype.measureEnd=function(t){if(null!=this._array_&&0!=this._array_.length){if(this._labels_&&(this.primitives.remove(this._labels_),this._labels_=null),t=t||this.lastP,1==this.mode)var r=this.camera.getPickRay(t.position),o=this.scene.globe.pick(r,this.scene);else o=this.scene.pickPosition(t.position);if(o){this._array_.push(o),this._polylines_.get(this._polylines_.length-1).material.uniforms.color=e.Color.CHARTREUSE.withAlpha(0),this.viewer.entities.add({name:"draw_polygon"+this.count,polygon:{hierarchy:{positions:this._array_},material:this.color,perPositionHeight:!1}});for(var n=[],a=0;a<this._array_.length;a++){var s=e.Cartographic.fromCartesian(this._array_[a]),l=e.Math.toDegrees(s.longitude),u=e.Math.toDegrees(s.latitude);n.push([l,u])}n.push(n[0]);var h,c=turf.polygon([n]),p=turf.area(c);h=p<1e6?"总面积："+p.toFixed(2)+"m²":"总面积："+(p/1e6).toFixed(2)+"km²",/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent)?(4<this.primitives.length&&this.primitives.remove(this.primitives.get(this.primitives.length-2)),i(this.primitives,h,this._array_)):(i(this.primitives,h,this._array_,this.count),this.count++)}}},t.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",r("result_labelArea",this.primitives),r("draw_label",this.primitives),r("draw_polyline",this.primitives),o("draw_polygon",this.viewer.entities)}}(window.Cesium),function(e){var t=e.MeasureDistanceWidget=function(t,i){this.viewer=t.viewer,this.color=t.color?t.color:e.Color.CHARTREUSE.withAlpha(.5),this.lineWidth=t.lineWidth?t.lineWidth:2,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.entities=this.viewer.entities,this.ellipsoid=this.scene.globe.ellipsoid,this.mode=t.mode?t.mode:1,this.count=0,this.tags=[]};function i(e,t){for(var i=0;i<t.length;i++)t.get(i).name==e&&(t.remove(t.get(i)),i--)}function r(e,t){for(var i=0;i<t.length;i++)t.get(i).tag==e&&(t.remove(t.get(i)),i--)}function o(e,t){for(var i=t.values,r=0;r<i.length;r++)i[r].tag==e&&(t.remove(i[r]),r--)}t.prototype.activate=function(){var t=this;t.count++,this.handler=new e.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var i,r,o,n=[];this._array_=n,this._polylines_=i,this._labels_=r,this.handler.setInputAction((function(r){if(t.lastP=r,3==t.mode)var a=t.scene.pickPosition(r.position);else{var s=t.camera.getPickRay(r.position);a=t.scene.globe.pick(s,t.scene)}if(a){var l=e.Cartographic.fromCartesian(a),u=e.Math.toDegrees(l.longitude),h=e.Math.toDegrees(l.latitude),c=l.height;n.push(u),n.push(h),n.push(c),3==n.length&&((i=t.primitives.add(new e.PolylineCollection)).tag=t.mode+"_"+t.count,i.name="draw_polyline",i.add({polyline:{}}),i.get(i.length-1).width=t.lineWidth,i.get(i.length-1).material.uniforms.color=t.color,i.get(i.length-1).positions=e.Cartesian3.fromDegreesArrayHeights(n)),3<n.length&&(i.get(i.length-1).positions=e.Cartesian3.fromDegreesArrayHeights(n)),t._polylines_=i,(o=t.primitives.add(new e.PointPrimitiveCollection)).tag=t.mode+"_"+t.count,o.name="draw_point",o.add({position:a,color:e.Color.WHITE,outlineColor:e.Color.RED,outlineWidth:1,pixelSize:t.pixelSize}),t.flag=!1,t.measureEnd(r)}}),e.ScreenSpaceEventType.LEFT_DOWN),this.handler.setInputAction((function(o){if(3==t.mode)var a=t.scene.pickPosition(o.endPosition);else{var s=t.camera.getPickRay(o.endPosition);a=t.scene.globe.pick(s,t.scene)}if(!a)return console.log("!cartesian"),void(r&&(t.primitives.remove(r),r=null));var l=e.Cartographic.fromCartesian(a),u=e.Math.toDegrees(l.longitude),h=e.Math.toDegrees(l.latitude),c=l.height;if(/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent))r=null;else{if(3<=n.length){var p=n.concat();p.push(u),p.push(h),p.push(c),i.get(i.length-1).positions=e.Cartesian3.fromDegreesArrayHeights(p)}r&&0!=r.length||((r=t.primitives.add(new e.LabelCollection)).name="draw_label",r.tag=t.mode+"_"+t.count,r.add({text:"左键单击开始绘制，右键单击结束绘制",font:"16px sans-serif",showBackground:!0,pixelOffset:new e.Cartesian2(10,10),disableDepthTestDistance:Number.POSITIVE_INFINITY})),r.get(r.length-1).position=e.Cartesian3.fromDegrees(u,h,c)}t._labels_=r}),e.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction((function(i){if(t.flag=!0,i=t.lastP,3==t.mode)var r=t.scene.pickPosition(i.position);else{var n=t.camera.getPickRay(i.position);r=t.scene.globe.pick(n,t.scene)}if(r){var a=e.Cartographic.fromCartesian(r),s=e.Math.toDegrees(a.longitude),l=e.Math.toDegrees(a.latitude),u=a.height;(o=t.primitives.add(new e.PointPrimitiveCollection)).tag=t.mode+"_"+t.count,o.name="draw_point",o.add({position:r,color:e.Color.WHITE,outlineColor:e.Color.RED,outlineWidth:1,pixelSize:t.pixelSize}),t._array_.push(s),t._array_.push(l),t._array_.push(u),t.measureEnd(i),t.handler=t.handler&&t.handler.destroy(),t.viewer.canvas.style.cursor="default",t._array_=[],t._polylines_=null}}),e.ScreenSpaceEventType.RIGHT_CLICK)},t.prototype.measureEnd=function(t){if(null!=this._array_&&0!=this._array_.length){if(/Android|webOS|iPhone|ipad|iPod|BlackBerry/i.test(navigator.userAgent))this._array_=this._array_;else if(!t){console.log("点击按钮结束绘制"),t=this.lastP;var i=this.camera.getPickRay(t.position),r=this.scene.globe.pick(i,this.scene);if(!r)return;var o=e.Cartographic.fromCartesian(r),n=e.Math.toDegrees(o.longitude),a=e.Math.toDegrees(o.latitude),s=o.height;this._array_[this._array_.length-1]==s&&this._array_[this._array_.length-2]==a&&this._array_[this._array_.length-3]==n?this._array_=this._array_:(this._array_.push(n),this._array_.push(a),this._array_.push(s))}this._labels_&&(this.primitives.remove(this._labels_),this._labels_=null);var l=this.mode;if(2==this.mode){var u=function(t,i){for(var r=[],o=0;o<t.length/3-1;o++){var n=3*o,a=t[n],s=t[1+n],l=t[2+n],u=t[3+n],h=t[4+n],c=t[5+n];r.push(a),r.push(s),r.push(l);for(var p=0;p<100;p++){var d={longitude:e.Math.toRadians(a),latitude:e.Math.toRadians(s),height:l},f={longitude:e.Math.toRadians(u),latitude:e.Math.toRadians(h),height:c},g=e.Math.lerp(d.longitude,f.longitude,.01*(p+1)),m=e.Math.lerp(d.latitude,f.latitude,.01*(p+1)),_={longitude:g,latitude:m},v=i.globe.getHeight(_);r.push(e.Math.toDegrees(g)),r.push(e.Math.toDegrees(m)),r.push(v)}r.push(u),r.push(h),r.push(c)}return r}(this._array_,this.scene);this._polylines_.get(this._polylines_.length-1).material.uniforms.color=e.Color.CHARTREUSE.withAlpha(0),this.viewer.entities.add({tag:this.mode+"_"+this.count,name:"draw_polyline",polyline:{positions:e.Cartesian3.fromDegreesArrayHeights(u),width:this.lineWidth,material:this.color}})}var h,c=e.Cartesian3.fromDegreesArrayHeights(e.defined(u)?u:this._array_),p=0;if(new e.EllipsoidGeodesic,1==l||3==l){for(var d=1;d<c.length;d++)p+=e.Cartesian3.distance(c[d-1],c[d]);h=0==p?"起点":0<p&&p<1e3?this.flag?"总长："+p.toFixed(2)+"m":p.toFixed(2)+"m":this.flag?"总长："+(p/1e3).toFixed(2)+"km":(p/1e3).toFixed(2)+"km"}else if(2==l){for(d=1;d<c.length;d++)p+=e.Cartesian3.distance(c[d-1],c[d]);h=0==p?"起点":0<p&&p<1e3?this.flag?"总长："+p.toFixed(2)+"m":p.toFixed(2)+"m":this.flag?"总长："+(p/1e3).toFixed(2)+"km":(p/1e3).toFixed(2)+"km"}!function(t,i,r,o,n){var a=r.add(new e.LabelCollection);a.name="result_label",a.tag=t+"_"+i,a.add({text:o,font:"16px sans-serif",showBackground:!0,backgroundColor:new e.Color(1,0,0,.3),pixelOffset:new e.Cartesian2(10,10),disableDepthTestDistance:Number.POSITIVE_INFINITY}),a.get(a.length-1).position=n[n.length-1],3<r.length&&"result_label"==r._primitives[r.length-3].name&&(r._primitives[r.length-3]._labels[0].backgroundColor=new e.Color(0,1,0,.3))}(l,this.count,this.primitives,h,c)}},t.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",i("draw_point",this.primitives),i("result_label",this.primitives),i("draw_label",this.primitives),i("draw_polyline",this.primitives),function(e,t){for(var i=t.values,r=0;r<i.length;r++)"draw_polyline"==i[r].name&&(t.remove(i[r]),r--)}(0,this.viewer.entities)},t.prototype.selectFeatures=function(){var t=this;this.handler||(this.handler=new e.ScreenSpaceEventHandler(this.canvas),this.handler.setInputAction((function(i){var r=viewer.scene.pick(i.position);r&&(r.primitive._polylineCollection&&(t.tags.push(r.primitive._polylineCollection.tag),r.primitive.material.uniforms.color=e.Color.YELLOW.withAlpha(.5)),r.id&&r.id._polyline&&(t.tags.push(r.id.tag),r.id._polyline.material.color=e.Color.YELLOW.withAlpha(.5)))}),e.ScreenSpaceEventType.LEFT_CLICK))},t.prototype.delete=function(e){if(this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",this.tags&&0<this.tags.length)for(var t=0;t<this.tags.length;t++)r(this.tags[t],this.primitives),o(this.tags[t],this.viewer.entities)}}(window.Cesium),function(e){var t=e.MeasureElevationWidget=function(t,i){this.viewer=t.viewer,this.color=t.color?t.color:e.Color.YELLOW,this.pixelSize=t.pixelSize?t.pixelSize:10,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.ellipsoid=this.scene.globe.ellipsoid,this.count=0,this.tags=[],this.mode=t.mode?t.mode:1};function i(e,t){for(var i=0;i<t.length;i++)t.get(i).name==e&&(t.remove(t.get(i)),i--)}function r(e,t){for(var i=0;i<t.length;i++)t.get(i).tag==e&&(t.remove(t.get(i)),i--)}t.prototype.activate=function(){this.count++,this.handler&&(this.handler=this.handler&&this.handler.destroy()),this.handler=new e.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var t,i,r=this,o=[];this.handler.setInputAction((function(n){if(2==r.mode)var a=r.scene.pickPosition(n.position);else{var s=r.camera.getPickRay(n.position);a=r.scene.globe.pick(s,r.scene)}if(a){o[0]=a,t?t.removeAll():((t=r.primitives.add(new e.PointPrimitiveCollection)).tag=r.count,t.name="draw_point"),t.add({position:a,color:r.color,pixelSize:r.pixelSize}),r.handler=r.handler&&r.handler.destroy(),r.viewer.canvas.style.cursor="default",i&&(r.primitives.remove(i),i=null);var l="高程值："+e.Cartographic.fromCartesian(o[0]).height.toFixed(2)+"m";!function(t,i,r,o){var n=t.add(new e.LabelCollection);n.name="result_label",n.tag=o,n.add({text:i,font:"16px sans-serif",showBackground:!0,pixelOffset:new e.Cartesian2(6,2),disableDepthTestDistance:Number.POSITIVE_INFINITY}),n.get(n.length-1).position=r[r.length-1]}(r.primitives,l,o,r.count)}}),e.ScreenSpaceEventType.LEFT_DOWN)},t.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",i("result_label",this.primitives),i("draw_point",this.primitives)},t.prototype.selectFeatures=function(){var t=this;this.handler||(this.handler=new e.ScreenSpaceEventHandler(this.canvas),this.handler.setInputAction((function(i){var r=viewer.scene.pick(i.position);"draw_point"===r.collection.name?r.primitive&&(t.tags.push(r.collection.tag),r.primitive.color=e.Color.YELLOW.withAlpha(.5)):alert("您选择的不是高程点！")}),e.ScreenSpaceEventType.LEFT_CLICK))},t.prototype.delete=function(e){if(this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",this.tags&&0<this.tags.length)for(var t=0;t<this.tags.length;t++)r(this.tags[t],this.primitives)}}(window.Cesium),function(e){var t=e.MeasureHeightWidget=function(t,i){this.viewer=t.viewer,this.color=t.color?t.color:e.Color.CHARTREUSE.withAlpha(.5),this.lineWidth=t.lineWidth?t.lineWidth:2,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.ellipsoid=this.scene.globe.ellipsoid,this.callback=i||function(){},this.count=0,this.entityNames=[],this.labelNames=[],this.pointNames=[],this.mode=t.mode?t.mode:1};function i(t,i,r,o){var n=t.add(new e.LabelCollection);n.name="result_labelHeight"+o,n.add({text:i,font:"16px sans-serif",showBackground:!0,disableDepthTestDistance:Number.POSITIVE_INFINITY}),n.get(n.length-1).position=e.Cartesian3.fromDegrees(r[r.length-3],r[r.length-2],r[r.length-1])}function r(e,t){for(var i=0;i<t.length;i++)void 0!==t.get(i).name&&-1<t.get(i).name.indexOf(e)&&(t.remove(t.get(i)),i--)}function o(e,t){for(var i=0;i<t.length;i++)t.get(i).name==e&&(t.remove(t.get(i)),i--)}t.prototype.activate=function(){if(this.handler=this.handler&&this.handler.destroy(),!this.handler){this.handler=new e.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var t,i,r=this,o=[];this._array_=o,this._polylines_=t,this._labels_=void 0,this.handler.setInputAction((function(n){if(2==r.mode)var a=r.scene.pickPosition(n.position);else{var s=r.camera.getPickRay(n.position);a=r.scene.globe.pick(s,r.scene)}if(a){var l=e.Cartographic.fromCartesian(a),u=e.Math.toDegrees(l.longitude),h=e.Math.toDegrees(l.latitude),c=l.height;0<o.length&&(9==o.length&&(o[3]=u,o[4]=h,o[5]=c,o[2]>=o[5]?(o[6]=o[0],o[7]=o[1],o[8]=o[5]):(o[6]=o[3],o[7]=o[4],o[8]=o[2]),t.get(t.length-1).positions=e.Cartesian3.fromDegreesArrayHeights(o)),(i=r.primitives.add(new e.PointPrimitiveCollection)).name="draw_point"+r.count,i.add({position:a,color:r.color,pixelSize:r.pixelSize}),r._array_=o,r.measureEnd()),0==o.length&&(o.push(u),o.push(h),o.push(c),o.push(u),o.push(h),o.push(c),o.push(u),o.push(h),o.push(c),(t=r.primitives.add(new e.PolylineCollection)).name="draw_polyline"+r.count,t.add({polyline:{}}),t.get(t.length-1).width=r.lineWidth,t.get(t.length-1).loop=!0,t.get(t.length-1).material.uniforms.color=r.color,t.get(t.length-1).positions=e.Cartesian3.fromDegreesArrayHeights(o),(i=r.primitives.add(new e.PointPrimitiveCollection)).name="draw_point"+r.count,i.add({position:a,color:r.color,pixelSize:r.pixelSize}))}}),e.ScreenSpaceEventType.LEFT_CLICK)}},t.prototype.selectFeatures=function(t){this.handler=this.handler&&this.handler.destroy(),this.handler=new e.ScreenSpaceEventHandler(this.canvas);var i=this;this.handler.setInputAction((function(t){var r=i.viewer.scene.pick(t.position);if(null!=r){if(null!=r.collection&&null!=r.collection.name&&null!=r.primitive&&null!=r.primitive.material){r.primitive.material.uniforms.color=e.Color.CHARTREUSE;var o=r.collection.name,n=o.replace(/draw_polyline/,"result_labelHeight"),a=o.replace(/draw_polyline/,"draw_point");i.entityNames.push(o),i.labelNames.push(n),i.pointNames.push(a)}}else alert("没有选中目标")}),e.ScreenSpaceEventType.LEFT_CLICK)},t.prototype.delete=function(e){this.handler=this.handler&&this.handler.destroy();for(var t=0;t<this.entityNames.length;t++)o(this.entityNames[t],this.primitives);for(var i=0;i<this.labelNames.length;i++)o(this.labelNames[i],this.primitives);for(i=0;i<this.pointNames.length;i++)o(this.pointNames[i],this.primitives);this.count=0,this.entityNames=[],this.labelNames=[],this.pointNames=[]},t.prototype.measureEnd=function(){var t;this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",this._labels_&&(this.primitives.remove(this._labels_),this._labels_=null),(l=[]).push((this._array_[0]+this._array_[3])/2),l.push((this._array_[1]+this._array_[4])/2),t=this._array_[2]>=this._array_[5]?(l.push(this._array_[5]),this._array_[5]):(l.push(this._array_[2]),this._array_[2]);var r=e.Cartesian3.fromDegrees(this._array_[0],this._array_[1],t),o=e.Cartesian3.fromDegrees(this._array_[3],this._array_[4],t),n=e.Cartesian3.distance(r,o);a=n<1e3?"水平距离："+n.toFixed(2)+"m":"水平距离："+(n/1e3).toFixed(2)+"km",i(this.primitives,a,l,this.count);var a,s=Math.abs(this._array_[2]-this._array_[5]),l=[];this._array_[2]>=this._array_[5]?(l.push(this._array_[0]),l.push(this._array_[1])):(l.push(this._array_[3]),l.push(this._array_[4])),l.push((this._array_[2]+this._array_[5])/2),a=s<1e3?"垂直高度："+s.toFixed(2)+"m":"垂直高度："+(s/1e3).toFixed(2)+"km",i(this.primitives,a,l,this.count),(l=[]).push((this._array_[0]+this._array_[3])/2),l.push((this._array_[1]+this._array_[4])/2),l.push((this._array_[2]+this._array_[5])/2);var u=Math.sqrt(Math.pow(n,2)+Math.pow(s,2));a=u<1e3?"空间距离："+u.toFixed(2)+"m":"空间距离："+(u/1e3).toFixed(2)+"km",i(this.primitives,a,l,this.count),this.count++,this.callback(n,s,u,this._array_)},t.prototype.clear=function(){this.handler=this.handler&&this.handler.destroy(),this.viewer.canvas.style.cursor="default",r("result_labelHeight",this.primitives),r("draw_label",this.primitives),r("draw_polyline",this.primitives),r("draw_point",this.primitives)}}(window.Cesium),function(e){function t(t,i){if(!e.defined(t))throw new DeveloperError("viewer is required.");i=e.defaultValue(i,e.defaultValue.EMPTY_OBJECT),this._viewer=t,this._isEnable=e.defaultValue(i.isEnable,!0),this._splitDirection=e.defaultValue(i.splitDirection,e.ImagerySplitDirection.LEFT),this._slider=function(t){var i=document.createElement("div");i.className="geo-split-slider",t.container.appendChild(i);var r=new e.ScreenSpaceEventHandler(i),o=!1;function n(e){if(o){var r=e.endPosition.x,n=(i.offsetLeft+r)/i.parentElement.offsetWidth;i.style.left=100*n+"%",t.scene.imagerySplitPosition=n}}return r.setInputAction((function(){o=!0}),e.ScreenSpaceEventType.LEFT_DOWN),r.setInputAction((function(){o=!0}),e.ScreenSpaceEventType.PINCH_START),r.setInputAction(n,e.ScreenSpaceEventType.MOUSE_MOVE),r.setInputAction(n,e.ScreenSpaceEventType.PINCH_MOVE),r.setInputAction((function(){o=!1}),e.ScreenSpaceEventType.LEFT_UP),r.setInputAction((function(){o=!1}),e.ScreenSpaceEventType.PINCH_END),i}(t),this.updateImagerySplitPosition()}t.prototype.enableLayers=function(t){for(var i=e.defaultValue(t,[]),r=i.length-1;0<=r;r--)i[r].splitDirection=this._splitDirection},t.prototype.updateImagerySplitPosition=function(){var e=this._viewer,t=this._slider;e.scene.imagerySplitPosition=t.offsetLeft/t.parentElement.offsetWidth},e.GeoSplitSliderWidget=t}(window.Cesium),(k=window.Cesium).Map=function(e,t){if((t=t||{}).baseLayerPicker=k.defaultValue(t.baseLayerPicker,!1),t.timeline=k.defaultValue(t.timeline,!1),t.animation=k.defaultValue(t.animation,!1),t.homeButton=k.defaultValue(t.homeButton,!1),t.navigationHelpButton=k.defaultValue(t.navigationHelpButton,!1),t.orderIndependentTranslucency=k.defaultValue(t.orderIndependentTranslucency,!0),t.sceneMode=k.defaultValue(t.sceneMode,k.SceneMode.SCENE3D),t.scene3DOnly=k.defaultValue(t.scene3DOnly,!0),t.maxLevel=k.defaultValue(t.maxLevel,25),t.geocoder=k.defaultValue(t.geocoder,!1),t.fullscreenButton=k.defaultValue(t.fullscreenButton,!1),!k.defined(t.imageryProvider)){var i=function(){for(var e="",t=new RegExp("(^|(.*?\\/))(Cesium.js)(\\?|$)"),i=document.getElementsByTagName("script"),r=0,o=i.length;r<o;r++){var n=i[r].getAttribute("src");if(n){var a=n.match(t);if(a){e=a[1];break}}}return e}(),r=new k.SingleTileImageryProvider({url:i+"Assets/Images/Earth.jpg",rectangle:k.Rectangle.fromDegrees(-180,-90,180,90)});t.imageryProvider=r}return new k.Viewer(e,t)},function(e){var t=e.defaultValue,i=e.GeoClipping=function(i,r){i=t(i,e.defaultValue.EMPTY_OBJECT),this.steps=t(i.steps,64),this.edgeWidth=t(i.edgeWidth,2),this.edgeColor=t(i.edgeColor,e.Color.WHITE),this.cylinderRadius=t(i.cylinderRadius,50),this.clippingModeUnion=t(i.clippingModeUnion,!0),this.enabled=t(i.enabled,!0),this.clippingPlanes=void 0,this.modelEntityClippingPlanes=void 0};i.prototype.computePlanes=function(t){t=e.defined(t)?t:this.steps;for(var i=e.Math.TWO_PI/t,r=[],o=0;o<t;o++){var n=o*i,a=new e.Cartesian3;a.x=1,a.y=Math.tan(n),n>e.Math.PI_OVER_TWO&&(a.x=-1,a.y*=-1),n>e.Math.PI&&(a.x=-1),n>3*e.Math.PI_OVER_TWO&&(a.x=1,a.y=-a.y),e.Cartesian3.normalize(a,a);var s=new e.ClippingPlane(a,this.cylinderRadius);r.push(s)}return this.clippingPlanes=r},i.prototype.createClippingPlanes=function(t,i){for(var r=new e.ClippingPlaneCollection({modelMatrix:e.defined(t)?t:e.Matrix4.IDENTITY,edgeWidth:this.edgeWidth,edgeColor:this.edgeColor,unionClippingRegions:this.clippingModeUnion,enabled:this.enabled}),o=this.computePlanes(i),n=0;n<o.length;n++)r.add(o[n]);return this.modelEntityClippingPlanes=r}}(window.Cesium),function(e){var t=e.GeoFlood=function(e,t){this.viewer=e.viewer,this.scene=this.viewer.scene,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.cartesianArrayHeights=null,this.fragmentShader=null,this.normalMapUrl=null,this.geometry=null,this.appearance=null,this.callback=t||null};t.prototype.createWaterFace=function(e,t,i){return this.primitive&&this.clear(),this.primitive=this.creatPrimitive(e,t,i),this.primitive},t.prototype.creatPrimitive=function(t,i,r){if(t&&i&&!(i&&i.length<3))return this.fragmentShader="varying vec3 v_positionMC;\n\t\t\t\t\tvarying vec3 v_positionEC;\n\t\t\t\t\tvarying vec2 v_st;\n\t\t\t\t\t\n\t\t\t\t\tvoid main()\n\t\t\t\t\t{\n\t\t\t\t\t\tczm_materialInput materialInput;\n\t\t\t\t\t\tvec3 normalEC = normalize(czm_normal3D * czm_geodeticSurfaceNormal(v_positionMC, vec3(0.0), vec3(1.0)));\n\t\t\t\t\t#ifdef FACE_FORWARD\n\t\t\t\t\t\tnormalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n\t\t\t\t\t#endif\n\t\t\t\t\t\tmaterialInput.s = v_st.s;\n\t\t\t\t\t\tmaterialInput.st = v_st;\n\t\t\t\t\t\tmaterialInput.str = vec3(v_st, 0.0);\n\t\t\t\t\t\tmaterialInput.normalEC = normalEC;\n\t\t\t\t\t\tmaterialInput.tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(v_positionMC, materialInput.normalEC);\n\t\t\t\t\t\tvec3 positionToEyeEC = -v_positionEC;\n\t\t\t\t\t\tmaterialInput.positionToEyeEC = positionToEyeEC;\n\t\t\t\t\t\tczm_material material = czm_getMaterial(materialInput);\n\t\t\t\t\t#ifdef FLAT\n\t\t\t\t\t\tgl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n\t\t\t\t\t#else\n\t\t\t\t\t\tgl_FragColor = czm_phong(normalize(positionToEyeEC), material);\n\t\t\t\t\t\tgl_FragColor.a = 1.0;\n\t\t\t\t\t#endif\n\t\t\t\t\t}\n\t\t\t\t\t",this.normalMapUrl=t,this.geometry=function(t,i){return new e.PolygonGeometry({polygonHierarchy:new e.PolygonHierarchy(e.Cartesian3.fromDegreesArrayHeights(t)),extrudedHeight:i||0,perPositionHeight:!1,closeTop:!0,closeBottom:!0,vertexFormat:e.EllipsoidSurfaceAppearance.VERTEXT_FORMAT})}(i,r),this.appearance||(this.appearance=function(t,i){return new e.EllipsoidSurfaceAppearance({material:new e.Material({translucent:!1,fabric:{type:"Water",uniforms:{normalMap:i,frequency:90,animationSpeed:.03,amplitude:90,specularIntensity:5}}}),fragmentShaderSource:t})}(this.fragmentShader,this.normalMapUrl)),this.primitives.add(new e.Primitive({allowPicking:!0,geometryInstances:new e.GeometryInstance({geometry:this.geometry,id:"GEOFlood_ID"}),vertexCacheOptimize:!0,appearance:this.appearance,interleave:!0,asynchronous:!1,cull:!1,releaseGeometryInstances:!0,show:!0}))},t.prototype.clear=function(){this.canvas.style.cursor="default",this.primitive&&this.primitives.remove(this.primitive)},t.prototype.clearPrimitive=function(e){e&&this.primitives.remove(e)},t.prototype.destroy=function(){this.clear(),this.viewer=void 0,this.scene=void 0,this.canvas=void 0,this.primitives=void 0,this.callback=void 0}}(window.Cesium),function(e){var t=e.defaultValue,i=e.GeoLimitHeight=function(i,r){i=t(i,e.defaultValue.EMPTY_OBJECT),this.viewer=i.viewer,this.scene=this.viewer.scene,this.entities=this.viewer.entities};i.prototype.analysis=function(i){i=t(i,e.defaultValue.EMPTY_OBJECT),this.targetHeight=t(i.targetHeight,0);var r=i.labelOption,o=i.polygonPlaneOption,n=i.polygonFitOption;r&&this.drawLabel(r),o&&this.drawPolygonPlane(o),n&&this.drawPolygonFit(n)},i.prototype.drawLabel=function(i){return this.clearLabelEntity(),i=t(i,e.defaultValue.EMPTY_OBJECT),this.labelEntity=this.entities.add({position:t(i.labelPosition,new e.Cartesian2(0,0,0)),label:{text:t(i.labelText,""),pixelOffset:t(i.labelPixelOffset,new e.Cartesian2(0,-60)),fillColor:t(i.labelFillColor,new e.Color(0,0,1,1)),font:t(i.labelFont,"18px 楷体"),outlineColor:t(i.labelOutlineColor,new e.Color(0,0,1,1)),outlineWidth:t(i.labelOutlineWidth,1.8),style:e.defaultValue(i.labelStyle,e.LabelStyle.FILL_AND_OUTLINE),show:t(i.labelShow,!0),disableDepthTestDistance:Number.POSITIVE_INFINITY}}),!0},i.prototype.drawPolygonPlane=function(i){return this.clearPolygonPlaneEntity(),i=t(i,e.defaultValue.EMPTY_OBJECT),this.polygonPlaneEntity=this.entities.add({polygon:{hierarchy:t(i.polygonPlaneHierarchy,new e.Cartesian3(0,0,0)),perPositionHeight:t(i.polygonPlanePerPositionHeight,!1),height:t(i.polygonPlaneHeight,this.targetHeight),material:t(i.polygonPlaneMaterial,e.Color.YELLOW.withAlpha(.3)),outline:t(i.polygonPlaneOutline,!0),outlineColor:t(i.polygonPlaneOutlineColor,e.Color.WHITE),show:t(i.polygonPlaneShow,!0)}}),!0},i.prototype.drawPolygonFit=function(i){this.clearPolygonFitPrimitive();var r=(i=t(i,e.defaultValue.EMPTY_OBJECT)).polygonFitPositions;if(!r||0==r.length)return console.error("请输入有效的坐标数组！"),!1;var o=function(t,i,r,o){return new e.GeometryInstance({geometry:new e.PolygonGeometry({polygonHierarchy:new e.PolygonHierarchy(e.Cartesian3.fromDegreesArray(t)),height:i,extrudedHeight:r}),attributes:{color:e.ColorGeometryInstanceAttribute.fromColor(o)}})}(r,t(i.polygonFitHeight,this.targetHeight),t(i.polygonFitExtrudedHeight,1e4),t(i.polygonFitColor,new e.Color(1,0,0,.5))),n=new e.PerInstanceColorAppearance({flat:!0}),a=new e.ClassificationPrimitive({geometryInstances:[o],appearance:n,classificationType:e.ClassificationType.CESIUM_3D_TILE});return this.polygonFitPrimitive=this.scene.primitives.add(a),!0},i.prototype.clearLabelEntity=function(){this.labelEntity&&this.entities.contains(this.labelEntity)&&(this.entities.remove(this.labelEntity),this.labelEntity=void 0)},i.prototype.clearPolygonPlaneEntity=function(){this.polygonPlaneEntity&&this.entities.contains(this.polygonPlaneEntity)&&(this.entities.remove(this.polygonPlaneEntity),this.polygonPlaneEntity=void 0)},i.prototype.clearPolygonFitPrimitive=function(){this.polygonFitPrimitive&&this.scene.primitives.contains(this.polygonFitPrimitive)&&(this.scene.primitives.remove(this.polygonFitPrimitive),this.polygonFitPrimitive=void 0)},i.prototype.clearAll=function(){this.clearLabelEntity(),this.clearPolygonPlaneEntity(),this.clearPolygonFitPrimitive()}}(window.Cesium),function(e){var t="GeoPLSViewShed3D_TIP",i="GeoPLSViewShed3D_LIGHTPOINT",r="GeoPLSViewShed3D_BOUNDARY",o="GeoPLSViewShed3D_DSP",n="GeoPLSViewShed3D_ORIENTLINE",a=e.GeoPLSViewShed3D=function(t,i){this.viewer=t.viewer,this.scene=this.viewer.scene,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.groundPrimitives=this.scene.groundPrimitives,this.callback=i||null,this._pointLightHeight=e.defaultValue(t.pointLightHeight,.2),this._pointLightPixelSize=e.defaultValue(t.pointLightPixelSize,5),this._pointLightColor=e.defaultValue(t.pointLightColor,e.Color.YELLOW),this._boundaryWidth=e.defaultValue(t.boundaryWidth,4),this._boundaryColor=e.defaultValue(t.boundaryColor,e.Color.YELLOW),this._orientLineWidth=e.defaultValue(t.orientLineWidth,8),this._orientLineColor=e.defaultValue(t.orientLineColor,new e.Color(1,1,0,.5)),this._baseDEMLerpCfg=e.defaultValue(t.baseDEMLerpCfg,{}),this._intervalAnalysis=e.defaultValue(t.intervalAnalysis,!0),this._pointLightCamera=void 0,_()(e.VERSION)<1.5&&console.error("当前Cesium版本："+e.VERSION+",点光源可视域分析暂不支持该版本，请更换至1.50以上的版本!")};function s(t,i,r,o,n,a){for(var s=[],l=[],u=g()(t.realTimeRadius/r),c=0;c<u;c++){var p={longitude:i[0],latitude:i[1],height:i[2]},d={longitude:i[3],latitude:i[4],height:i[5]},f=e.Math.lerp(p.longitude,d.longitude,1/u*(c+1)),m=e.Math.lerp(p.latitude,d.latitude,1/u*(c+1)),_={longitude:f,latitude:m},v=t.scene.globe.getHeight(_),C=e.Cartesian3.fromRadians(f,m,v);s.push(C);var y={longitude:i[0],latitude:i[1],height:v},A=e.Cartographic.toCartesian(y),I=e.Cartesian3.distance(A,C),b=(v-i[2])/I;l.push(b)}for(var w=[],E=[],G=[],S=[0],P=0;P<l.length-1;P++)w.length||l[P+1]<l[P]&&(w.push(l[P]),E.push(P)),w.length&&(l[P]>w[w.length-1]&&l[P+1]<l[P]&&(w.push(l[P]),E.push(P)),l[P]>w[w.length-1]&&l[P-1]<w[w.length-1]&&(G.push(l[P]),S.push(P)));E.push(l.length-1);var T=E.concat(S);T.sort((function(e,t){return e-t}));for(var x=[],M=0;M<T.length-1;M++){var L=[s[T[M]],s[T[M+1]]];x=M%2==0?x.concat(h(L,a,o,!0)):x.concat(h(L,a,n,!0))}return x}function l(t,i,r){var o=t.scene.pickPosition(i);if(o){var n=e.Cartographic.fromCartesian(o);if(n.height<0){t.scene.globe.depthTestAgainstTerrain=!0,t.viewer.terrainShadows=e.ShadowMode.ENABLED;var a=t.scene.camera.getPickRay(i),s=t.scene.globe.pick(a,t.scene);n=e.Cartographic.fromCartesian(s)}r=r||0;var l=e.Cartesian3.fromRadians(n.longitude,n.latitude,n.height+r),u=e.Cartographic.fromCartesian(l);return[e.Math.toDegrees(u.longitude),e.Math.toDegrees(u.latitude),u.height]}}function u(t,i,r,o){var n=t.add(new e.LabelCollection);return n.add({text:i,font:"16px sans-serif",showBackground:!0,position:r,pixelOffset:new e.Cartesian2(10,-30),style:e.LabelStyle.FILL_AND_OUTLINE}),n.name=o,n}function h(t,i,r,o){var n=[],a=o?t:e.Cartesian3.fromDegreesArray(t),s=new e.GeometryInstance({geometry:new e.GroundPolylineGeometry({positions:a,width:i}),attributes:{color:e.ColorGeometryInstanceAttribute.fromColor(r)}});return n.push(s),n}function c(t,i,r){var o=t.add(new e.GroundPolylinePrimitive({geometryInstances:i,appearance:new e.PolylineColorAppearance({translucent:!0})}));return o.name=r,o}function p(e,t,i){for(var r=0;r<e.length;r++)e.name==i&&(t.position&&(e.get(r).position=t.position),t.text&&(e.get(r).text=t.text),void 0!==t.showBackground&&(e.get(r).showBackground=t.showBackground),t.backgroundColor&&(e.get(r).backgroundColor=t.backgroundColor),void 0!==t.horizontalOrigin&&(e.get(r).horizontalOrigin=t.horizontalOrigin),void 0!==t.verticalOrigin&&(e.get(r).verticalOrigin=t.verticalOrigin),t.pixelOffset&&(e.get(r).pixelOffset=t.pixelOffset),t.fillColor&&(e.get(r).fillColor=t.fillColor),t.outlineWidth&&(e.get(r).outlineWidth=t.outlineWidth),t.outlineColor&&(e.get(r).outlineColor=t.outlineColor))}function d(e,t){for(var i=0;i<t.length;i++)t.get(i).name==e&&(t.remove(t.get(i)),i--)}a.prototype.activate=function(){this.clear(),this.canvas.style.cursor="crosshair";var a=null,f=null,g=null,m=null,_=!0,v=null,C=null,y=this;this.handler=new e.ScreenSpaceEventHandler(this.canvas),this.handler.setInputAction((function(o){if(_){v=l(y,o.position,y._pointLightHeight),C=e.Cartesian3.fromDegrees(v[0],v[1],v[2]),d(t,y.primitives),_=!1,y.firstLeftClick=_,a=null,d(i,y.primitives);var n=y.primitives.add(new e.PointPrimitiveCollection);n.name=i,n.add({position:C,color:y._pointLightColor,pixelSize:y._pointLightPixelSize})}else if(y.scene.globe.depthTestAgainstTerrain=!1,y.scene.shadowMap.enableGeoPLSViewShed3D=!0,y.canvas.style.cursor="default",y.handler&&!y.handler.isDestroyed()&&y.handler.destroy(),d(t,y.primitives),_=!0,y.firstLeftClick=_,a=null,y._baseDEMLerpCfg.enable)if(y._intervalAnalysis)y.angleInterval=e.defaultValue(y._baseDEMLerpCfg.angleInterval,1),y.timeInterval=e.defaultValue(y._baseDEMLerpCfg.timeInterval,100),y.num=0,setTimeout((function(){!function t(i){if(i.num%(2*i.angleInterval)==0){var o={longitude:i.boundaryPositionArr[i.num],latitude:i.boundaryPositionArr[i.num+1]},n=i.scene.globe.getHeight(o),a=[i.startPointLng,i.startPointLat,i.startPointHgt,o.longitude,o.latitude,n],l=e.defaultValue(i._baseDEMLerpCfg.interpolationBase,10),u=e.defaultValue(i._baseDEMLerpCfg.visibleColor,new e.Color(0,1,0,.8)),h=e.defaultValue(i._baseDEMLerpCfg.invisibleColor,new e.Color(1,0,0,.8)),p=e.defaultValue(i._baseDEMLerpCfg.lineWidth,5),d=s(i,a,l,u,h,p);c(i.scene.groundPrimitives,d,r)}i.num+=2*i.angleInterval,i.num<720&&setTimeout((function(){t(i)}),i.timeInterval)}(y)}),y.timeInterval);else{for(var u=[],h=0;h<y.boundaryPositionArr.length;h++)if(h%2==0){var p={longitude:y.boundaryPositionArr[h],latitude:y.boundaryPositionArr[h+1]},f=y.scene.globe.getHeight(p),g=[y.startPointLng,y.startPointLat,y.startPointHgt,p.longitude,p.latitude,f],m=e.defaultValue(y._baseDEMLerpCfg.interpolationBase,10),A=e.defaultValue(y._baseDEMLerpCfg.visibleColor,new e.Color(0,1,0,.8)),I=e.defaultValue(y._baseDEMLerpCfg.invisibleColor,new e.Color(1,0,0,.8)),b=e.defaultValue(y._baseDEMLerpCfg.lineWidth,5);s(y,g,m,A,I,b),u=u.concat(radiusLineInstance)}c(y.scene.groundPrimitives,u,r)}}),e.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction((function(i){if(y.tipPosition=y.scene.pickPosition(i.endPosition),y.tipPosition&&(_&&(a?p(a,{position:y.tipPosition},t):a=u(y.primitives,"单击左键确定可视域位置",y.tipPosition,t)),!_)){a?p(a,{position:y.tipPosition},t):a=u(y.primitives,"单击左键固定可视域半径",y.tipPosition,t);var s=l(y,i.endPosition),v=e.Cartesian3.fromDegrees(s[0],s[1],s[2]);if(m=e.Cartesian3.distance(C,v),d(r,y.groundPrimitives),d(n,y.groundPrimitives),m){var A=e.Math.toDegrees(e.Cartographic.fromCartesian(C).longitude),I=e.Math.toDegrees(e.Cartographic.fromCartesian(C).latitude),b=e.Cartographic.fromCartesian(C).height,w=function(e,t,i){for(var r=[],o=0;o<=360;o++){var n=i*Math.sin(o*Math.PI/180),a=i*Math.cos(o*Math.PI/180),s=6356725+21412*(90-t)/90,l=e+n/(s*Math.cos(t*Math.PI/180))*180/Math.PI,u=t+a/s*180/Math.PI;r.push(l),r.push(u)}return r}(A,I,m),E=h(w,y._boundaryWidth,y._boundaryColor),G=(c(y.groundPrimitives,E,r),[A,I,w[0],w[1]]),S=(function(t,i,r,o,n){var a=new e.GeometryInstance({geometry:new e.GroundPolylineGeometry({positions:e.Cartesian3.fromDegreesArray(i),width:r})});t.add(new e.GroundPolylinePrimitive({geometryInstances:a,appearance:new e.PolylineMaterialAppearance({material:new e.Material({fabric:{type:"PolylineArrow",uniforms:{color:o}}})})})).name="GeoPLSViewShed3D_ORIENTLINE"}(y.groundPrimitives,G,y._orientLineWidth,y._orientLineColor),[A,I,b,A,I,b+m/3]),P=e.Color.fromAlpha(e.Color.YELLOW,.7);g?g.polyline.positions=e.Cartesian3.fromDegreesArrayHeights(S):g=function(t,i,r,o,n){return t.add({name:"GeoPLSViewShed3D_DASHLINE",polyline:{positions:e.Cartesian3.fromDegreesArrayHeights(i),width:2,material:new e.PolylineDashMaterialProperty({color:o,dashLength:5})}})}(y.viewer.entities,S,0,P);var T=e.Cartesian3.fromDegrees(A,I,b+m/3),x="视高："+y._pointLightHeight.toFixed(2)+"米\n半径："+m.toFixed(4)+"米\n经度："+A.toFixed(6)+"度\n纬度："+I.toFixed(6)+"度",M={position:T,text:x,showBackground:!0,backgroundColor:e.Color.fromAlpha(e.Color.WHITE,.8),horizontalOrigin:e.HorizontalOrigin.CENTER,verticalOrigin:e.VerticalOrigin.BOTTOM,pixelOffset:new e.Cartesian2(0,0),fillColor:e.Color.BLACK};if(p(f||(f=u(y.primitives,x,T,o)),M,o),y._baseDEMLerpCfg.enable||y.dynamicAnalysis(C,m),y.pointLightPosition=C,y.realTimeRadius=m,y.firstLeftClick=_,y._baseDEMLerpCfg.enable){y.startPointLng=e.Math.toRadians(A),y.startPointLat=e.Math.toRadians(I),y.startPointHgt=b,y.boundaryPositionArr=[];for(var L=0;L<w.length;L++)y.boundaryPositionArr.push(e.Math.toRadians(w[L]));y.realTimeRadius=m}}}}),e.ScreenSpaceEventType.MOUSE_MOVE)},a.prototype.dynamicAnalysis=function(t,i){var r,o;t&&i&&(null==this._pointLightCamera?(this._pointLightCamera=new e.Camera(this.scene),this._pointLightCamera.position=t,r={context:this.scene.context,lightCamera:this._pointLightCamera,isPointLight:!0},this.scene.shadowMap.destroy(),this.scene.shadowMap=new e.ShadowMap(r),(o=this.scene.shadowMap).size=1024,o._pointLightRadius=i,o._terrainBias.depthBias=0,o.enabled=!0,o.enableGeoPLSViewShed3D=!0):(o=this.scene.shadowMap)._pointLightRadius=i)},a.prototype.clear=function(){this._baseDEMLerpCfg.enable&&(this.num=721),this.scene.globe.depthTestAgainstTerrain=!1,this.scene.shadowMap.enabled=!1,this.scene.shadowMap.enableGeoPLSViewShed3D=void 0,this.canvas.style.cursor="default",this._pointLightCamera=void 0,this.handler&&!this.handler.isDestroyed()&&this.handler.destroy(),d(t,this.primitives),d(o,this.primitives),d(i,this.primitives),d(r,this.groundPrimitives),d(n,this.groundPrimitives),function(e,t){for(var i=0;i<t.values.length;i++)"GeoPLSViewShed3D_DASHLINE"==t.values[i].name&&(t.remove(t.values[i]),i--)}(0,this.viewer.entities)},a.prototype.destroy=function(){this.clear(),this.viewer=void 0,this._pointLightHeight=void 0,this.scene=void 0,this.canvas=void 0,this.primitives=void 0,this.callback=void 0,this._pointLightCamera=void 0}}(window.Cesium),function(e){var t="GeoProfile",i=e.GeoProfile=function(e,t){this.viewer=e.viewer,this.scene=this.viewer.scene};i.prototype.getLerpValue=function(t,i){this.lng_origin=t[0],this.lat_origin=t[1],this.hgt_origin=t[2],this.lng_destination=t[t.length-3],this.lat_destination=t[t.length-2],this.hgt_destination=t[t.length-1];for(var r=[],o=0;o<t.length-3;o+=3){var n=e.Cartesian3.fromDegrees(t[o],t[o+1]),a=e.Cartesian3.fromDegrees(t[o+3],t[o+4]),s=e.Cartesian3.distance(n,a);r.push(s),e.Cartesian3.distance(n,a)}for(var l=0,u=[],h=0;h<r.length;h++){var c=Math.floor(r[h]/i);u.push(c),l+=c}this.samplingNum=l;var p=[],d=[];for(o=0;o<u.length;o++){for(var f=0;f<=u[o];f++){var g=f*i;if(r[o]-g<=i)p.push(1);else{var m=g/r[o];p.push(m)}}d.push(p),p=[]}for(var _=[],v=[],C=[],y=[],A=(o=0,0);A<d.length;A++){for(f=0;f<d[A].length;f++){var I=e.Math.lerp(t[o],t[o+3],d[A][f]),b=e.Math.lerp(t[o+1],t[o+4],d[A][f]),w={longitude:e.Math.toRadians(I),latitude:e.Math.toRadians(b)},E=Number(this.scene.globe.getHeight(w).toFixed(2));C.push(E),_.push(e.Cartesian3.fromDegrees(I,b,E)),v.push(e.Cartesian3.fromDegrees(I,b,0))}o+=3}var G=Math.min.apply(null,C);this.minHeight=G;var S=Math.max.apply(null,C);this.maxHeight=S;var P=0;for(o=0;o<_.length-1;o++)P+=e.Cartesian3.distance(_[o],_[o+1]);this.surfaceLen=P;var T=e.Cartesian3.distance(_[0],_[_.length-1]);this.straightLen=T;var x=0;for(A=0;A<v.length-1;A++)x+=e.Cartesian3.distance(v[A],v[A+1]),y.push(x.toFixed(2));y.unshift(0);var M={};return M.YValueArray=C,M.addLenArray=y,M.lerpCoordnatesArray=_,M},i.prototype.drawChart=function(e,t){var i=document.getElementById(t);i.onmousedown=function(e){var t=e||event,r=t.clientX-i.offsetLeft,o=t.clientY-i.offsetTop;document.onmousemove=function(e){var t=e||event;i.style.left=t.clientX-r+"px",i.style.top=t.clientY-o+"px"},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null}};var r=echarts.init(i),o={title:{x:"center",padding:15,text:"剖面示意图",textStyle:{color:"#ccc",fontStyle:"normal",fontWeight:"bold",fontFamily:"sans-serif",fontSize:18}},tooltip:{trigger:"axis",confine:!0,formatter:function(e){return"长度: "+e[0].name+"<br />高程: "+e[0].value}},grid:{left:"2%",right:"12%",bottom:"3%",containLabel:!0},xAxis:{splitArea:{show:!1},splitLine:{show:!1,lineStyle:{color:["#aaa"],width:1,type:"solid"}},type:"category",boundaryGap:!1,data:e.addLenArray,name:"长度(米)",nameTextStyle:{color:"#ccc",fontWeight:"bolder"},axisLine:{lineStyle:{color:"rgba(0.0, 128, 255, 0.6)",width:4}},axisLabel:{color:"#ccc",fontWeight:"bolder"}},yAxis:{splitArea:{show:!1},splitLine:{show:!0,lineStyle:{color:["#aaa"],width:1,type:"dashed"}},type:"value",name:"高程(米)",nameTextStyle:{color:"#ccc",fontWeight:"bolder"},axisLine:{lineStyle:{color:"rgba(0.0, 128, 255, 0.6)",width:4}},axisLabel:{color:"#ccc",fontWeight:"bolder"}},series:[{type:"line",data:e.YValueArray,areaStyle:{color:"rgba(0.0,255.0,255.0,0.8)"}}]};r.setOption(o);var n=document.createElement("table"),a=document.createElement("tbody"),s=document.createElement("tr"),l=document.createElement("td");l.innerHTML="起点经度："+this.lng_origin.toFixed(6),s.appendChild(l);var u=document.createElement("td");u.innerHTML="起点高程："+e.YValueArray[0].toFixed(2),s.appendChild(u);var h=document.createElement("td");h.innerHTML="投影距离："+Number(e.addLenArray[e.addLenArray.length-1]).toFixed(2),s.appendChild(h),a.appendChild(s);var c=document.createElement("tr"),p=document.createElement("td");p.innerHTML="起点纬度："+this.lat_origin.toFixed(6),c.appendChild(p);var d=document.createElement("td");d.innerHTML="终点高程："+e.YValueArray[e.YValueArray.length-1].toFixed(2),c.appendChild(d);var f=document.createElement("td");f.innerHTML="地表距离："+this.surfaceLen.toFixed(2),c.appendChild(f),a.appendChild(c);var g=document.createElement("tr"),m=document.createElement("td");m.innerHTML="终点经度："+this.lng_destination.toFixed(6),g.appendChild(m);var _=document.createElement("td");_.innerHTML="最高高程："+this.maxHeight,g.appendChild(_);var v=document.createElement("td");v.innerHTML="直线距离："+this.straightLen.toFixed(2),g.appendChild(v),a.appendChild(g);var C=document.createElement("tr"),y=document.createElement("td");y.innerHTML="终点纬度："+this.lat_destination.toFixed(6),C.appendChild(y);var A=document.createElement("td");A.innerHTML="最低高程："+this.minHeight,C.appendChild(A);var I=document.createElement("td");return I.innerHTML="采样点数："+this.samplingNum,C.appendChild(I),a.appendChild(C),n.appendChild(a),i.appendChild(n),this.oTable=n,this.chartContainer=i,this.myChart=r},i.prototype.drawMark=function(i){i=e.defaultValue(i,{});var r=this.scene.primitives.add(new e.BillboardCollection);r.add({position:i.originCoordanate,image:i.originImage,verticalOrigin:e.VerticalOrigin.BOTTOM,scale:.2}),r.add({position:i.destinationCoordanate,image:i.destinationImage,verticalOrigin:e.VerticalOrigin.BOTTOM,scale:.2}),r.name=t},i.prototype.clearMark=function(){for(var e=0;e<this.scene.primitives.length;e++)this.scene.primitives.get(e).name==t&&(this.scene.primitives.remove(this.scene.primitives.get(e)),e--)},i.prototype.clearChart=function(){this.myChart&&(this.myChart.clear(),this.myChart=null),this.oTable&&this.chartContainer&&this.chartContainer.removeChild(this.oTable)},i.prototype.clear=function(){this.clearChart(),this.clearMark()}}(window.Cesium),function(e){var t="GEOSIGHTLINE_TIP",i="GEOSIGHTLINEBILLBOARD",r="REDLINE",o="GREENLINE",n=e.GeoSightline=function(t,i){this.viewer=t.viewer,this.observeRelativeHeight=t.observeRelativeHeight,this.targetRelativeHeight=t.targetRelativeHeight,this.observeImage=t.observeImage,this.targetImage=t.targetImage,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.entities=this.viewer.entities,this.callback=i||null,this.objectsToExclude=[],this.observeActualPosition=null,this.targetActualPosition=null,this.observeEntity=null,this.targetEntity=null,_()(e.VERSION)<1.5&&console.error("当前Cesium版本："+e.VERSION+",通视分析暂不支持该版本，请更换至1.50以上的版本!")};function a(t,i,r){if(t.scene){var o=t.scene.pickPosition(i);if(1.58<=_()(e.VERSION)){var n=viewer.scene.clampToHeight(o);n&&(o=n)}var a,s=e.Cartographic.fromCartesian(o);if(s.height<0){var l=t.camera.getPickRay(i),u=t.scene.globe.pick(l,t.scene);s=e.Cartographic.fromCartesian(u),t.scene.globe.depthTestAgainstTerrain=!0}return r=r||1,a=s.height+r,e.Cartesian3.fromRadians(s.longitude,s.latitude,a)}}function s(t,i,r,o){var n=t.add(new e.LabelCollection);return n.add({text:i,font:"16px sans-serif",showBackground:!0,position:r,pixelOffset:new e.Cartesian2(10,-10)}),n.name=o,n}function l(e,t,i){for(var r=0;r<e.length;r++)e.name==i&&(e.get(r).position=t)}function u(e,t){c(e,t)}function h(t,r,o){var n=t.add(new e.BillboardCollection);return n.add({position:r,image:o,scale:.4,verticalOrigin:e.VerticalOrigin.MIDDLE}),n.name=i,n}function c(e,t){for(var i=0;i<t.length;i++)t.get(i).name==e&&(t.remove(t.get(i)),i--)}function p(e,t){for(var i=0;i<t._entities._array.length;i++)t._entities._array[i].name==e&&(t.remove(t._entities._array[i]),i--)}n.prototype.activate=function(){this.scene.globe.depthTestAgainstTerrain=!1,this.destroyHandler(),this.clear(),1.52==_()(e.VERSION)&&(this.scene.enableGeoSightline=!0),1.58<=_()(e.VERSION)&&(this.scene.enableGeoSightline=!1),this.canvas.style.cursor="crosshair";var i=null,r=!0,o=this;this.handler=new e.ScreenSpaceEventHandler(this.canvas),this.handler.setInputAction((function(e){r?(o.clear(),o.observeActualPosition=a(o,e.position,o.observeRelativeHeight),h(o.primitives,o.observeActualPosition,o.observeImage),u(t,o.primitives),i=null,r=!1):(o.targetActualPosition=a(o,e.position,o.targetRelativeHeight),h(o.primitives,o.targetActualPosition,o.targetImage),o.pickFromRays(),u(t,o.primitives),r=!(i=null),o.scene.enableGeoSightline=!1,o.destroyHandler())}),e.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction((function(e){o.tipPosition=o.scene.pickPosition(e.endPosition),o.tipPosition&&(r&&(i?l(i,o.tipPosition,t):i=s(o.primitives,"单击左键确定观察点",o.tipPosition,t)),r||(i?l(i,o.tipPosition,t):i=s(o.primitives,"单击左键确定目标点",o.tipPosition,t)))}),e.ScreenSpaceEventType.MOUSE_MOVE)},n.prototype.pickFromRays=function(){var t=new e.Cartesian3(0,0,0);this.objectsToExclude=[this.observeEntity,this.targetEntity];var i=e.Cartesian3.normalize(e.Cartesian3.subtract(this.targetActualPosition,this.observeActualPosition,new e.Cartesian3),new e.Cartesian3),n=new e.Ray(this.observeActualPosition,i),a=[],s=[],l=[];a=this.scene.drillPickFromRay(n,1e3,this.objectsToExclude);var u=e.Cartesian3.distance(this.observeActualPosition,this.targetActualPosition);if(0!==a.length&&!a[0].position)for(var h=1;h<Math.floor(u)+1;h++)if(e.Cartesian3.lerp(this.observeActualPosition,this.targetActualPosition,h*(1/Math.floor(u)),t),i=e.Cartesian3.normalize(e.Cartesian3.subtract(this.targetActualPosition,this.observeActualPosition,new e.Cartesian3),new e.Cartesian3),n=new e.Ray(t,i),a=[],s=[],l=[],0<(a=this.scene.drillPickFromRay(n,1,this.objectsToExclude)).length){a[0].position||(e.Cartesian3.lerp(this.observeActualPosition,this.targetActualPosition,h*(1/Math.floor(u)),t),a[0].position=t);break}if(0==a.length)s=[this.observeActualPosition,this.targetActualPosition];else{var c=e.Cartesian3.normalize(e.Cartesian3.subtract(a[0].position,this.observeActualPosition,new e.Cartesian3),new e.Cartesian3),p=e.Cartesian3.normalize(e.Cartesian3.subtract(a[0].position,this.targetActualPosition,new e.Cartesian3),new e.Cartesian3);if(c.x.toFixed(8)==p.x.toFixed(8)&&c.y.toFixed(8)==p.y.toFixed(8)&&c.z.toFixed(8)==p.z.toFixed(8))s=[this.targetActualPosition,this.observeActualPosition];else{s=[this.observeActualPosition,a[0].position],l=[a[0].position,this.targetActualPosition];var d={name:r,polyline:{positions:l,width:7,followSurface:!1,material:new e.PolylineArrowMaterialProperty(e.Color.RED)}};this.entities.add(d)}}var f={name:o,polyline:{positions:s,width:2,followSurface:!1,material:e.Color.GREEN}};this.entities.add(f)},n.prototype.clear=function(){this.primitives&&(c(t,this.primitives),c(i,this.primitives)),this.entities&&(p(r,this.entities),p(o,this.entities))},n.prototype.destroyHandler=function(){this.handler=this.handler&&this.handler.destroy(),this.canvas.style.cursor="default"},n.prototype.destroy=function(){this.scene.enableGeoSightline=!1,this.scene.globe.depthTestAgainstTerrain=!1,this.destroyHandler(),this.clear(),this.viewer=void 0,this.observeRelativeHeight=void 0,this.targetRelativeHeight=void 0,this.scene=void 0,this.camera=void 0,this.canvas=void 0,this.primitives=void 0,this.entities=void 0,this.ellipsoid=void 0,this.callback=void 0,this.objectsToExclude=void 0,this.observeEntity=null,this.targetEntity=null}}(window.Cesium),function(e){var t=e.defaultValue,i=e.GeoSkyLine=function(i,r){this.viewer=i.viewer,this.scene=this.viewer.scene,this.canvas=this.viewer.canvas,this.entities=this.viewer.entities,this.skyLineShow=t(i.skylineShow,!0),this.skyLineWidth=t(i.skyLineWidth,2),this.skyLineMaterial=t(i.skyLineMaterial,e.Color.RED.clone()),this.skyLineDepthFailMaterial=t(i.skyLineDepthFailMaterial,void 0),this.skyLineVolumeMaterial=t(i.skyLineVolumeMaterial,e.Color.ORANGE.clone()),this.skyLineVolumeOutLine=t(i.skyLineVolumeOutLine,!1),this.skyLineVolumeOutLineColor=t(i.skyLineVolumeOutLineColor,e.Color.BLACK.clone()),this.extrudeRatio=t(i.extrudeRatio,1.2)};i.prototype.calculateSkyLinePositions=function(){if(!this.skyLine){for(var t=[],i={addLenArray:[],YValueArray:[]},r=this.canvas.width,o=this.canvas.height,n=50,a=[],s=0;s<r;s+=g()(r/3))for(var l=0;l<o;l++){var u=new e.Cartesian2(s,l);if(this.scene.pickPosition(u)){a.push(l);break}}Math.max.apply(null,a)<10&&(n=1);for(var h=0;h<r;h+=3)for(var c=0;c<o;c+=n){var p=new e.Cartesian2(h,c);if(this.scene.pickPosition(p))for(s=c-1;c-n<=s;s-=1){var d=new e.Cartesian2(h,s);if(!this.scene.pickPosition(d)){var f=new e.Cartesian2(h,s+1),m=this.scene.pickPosition(f);t.push(m),i.YValueArray.push(o-s),i.addLenArray.push(h),c=o;break}}}this.data=i,this.skyLinePositions=t,this.cameraPosition=this.viewer.camera.position.clone(),this.cameraHeight=e.Cartographic.fromCartesian(this.cameraPosition).height}},i.prototype.drawSkyLine=function(){this.skyLine||(this.skyLinePositions||this.calculateSkyLinePositions(),this.skyLine=this.entities.add({name:"GeoSkyLine",polyline:{positions:this.skyLinePositions,width:this.skyLineWidth,show:this.skyLineShow,material:this.skyLineMaterial,depthFailMaterial:this.skyLineDepthFailMaterial}}))},i.prototype.drawSkyLineVolume=function(){this.skyLineVolume||(this.skyLinePositions||this.calculateSkyLinePositions(),this.skyLinePositions=this.skyLinePositions.concat([this.cameraPosition]),this.skyLinePositions.push(this.skyLinePositions[0]),this.skyLineVolume=this.entities.add({name:"GeoSkyLineVolume",polygon:{hierarchy:this.skyLinePositions,extrudedHeight:this.cameraHeight/this.extrudeRatio,perPositionHeight:!0,material:this.skyLineVolumeMaterial,outline:this.skyLineVolumeOutLine,outlineColor:this.skyLineVolumeOutLineColor}}))},i.prototype.drawChart=function(e){if(!this.myChart&&(this.skyLinePositions||this.calculateSkyLinePositions(),this.data)){var t=document.getElementById(e);t.onmousedown=function(e){var i=e||event,r=i.clientX-t.offsetLeft,o=i.clientY-t.offsetTop;document.onmousemove=function(e){var i=e||event;t.style.left=i.clientX-r+"px",t.style.top=i.clientY-o+"px"},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null}};var i=echarts.init(t),r={title:{x:"center",padding:15,text:"天际线示意图",textStyle:{color:"#ccc",fontStyle:"normal",fontWeight:"bold",fontFamily:"sans-serif",fontSize:18}},tooltip:{trigger:"axis",confine:!0,formatter:function(e){return"宽度: "+e[0].name+"<br />高度: "+e[0].value}},grid:{left:"2%",right:"12%",bottom:"3%",containLabel:!0},xAxis:{splitArea:{show:!1},splitLine:{show:!1,lineStyle:{color:["#aaa"],width:1,type:"solid"}},type:"category",boundaryGap:!1,data:this.data.addLenArray,name:"宽度(PX)",nameTextStyle:{color:"#ccc",fontWeight:"bolder"},axisLine:{lineStyle:{color:"rgba(0.0, 128, 255, 0.6)",width:4}},axisLabel:{color:"#ccc",fontWeight:"bolder"}},yAxis:{splitArea:{show:!1},splitLine:{show:!0,lineStyle:{color:["#aaa"],width:1,type:"dashed"}},type:"value",name:"高度(PX)",nameTextStyle:{color:"#ccc",fontWeight:"bolder"},axisLine:{lineStyle:{color:"rgba(0.0, 128, 255, 0.6)",width:4}},axisLabel:{color:"#ccc",fontWeight:"bolder"}},series:[{type:"line",data:this.data.YValueArray,areaStyle:{color:"rgba(0.0,255.0,255.0,0.8)"}}]};return i.setOption(r),this.chartContainer=t,this.myChart=i}},i.prototype.clearChart=function(){this.myChart&&(this.myChart.clear(),this.myChart=null)},i.prototype.clear=function(){this.clearChart(),this.skyLine&&(this.entities.remove(this.skyLine),this.skyLine=void 0),this.skyLineVolume&&(this.entities.remove(this.skyLineVolume),this.skyLineVolume=void 0),this.data=void 0,this.skyLinePositions=void 0,this.cameraPosition=void 0,this.cameraHeight=void 0,this.skyLinePositions=void 0}}(window.Cesium),((B=window.Cesium).GeoExcavationRegion=function(e){this.viewer=e.viewer,this.scene=this.viewer.scene,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this._samplingPoints=e.samplingPoints,this._sideMaterial=e.sideMaterial,this._bottomMaterial=e.bottomMaterial,this._interNumber=B.defaultValue(e.interNumber,20),this._depth=B.defaultValue(e.depth,-500),this._sideMaterial=B.defaultValue(e.sideMaterial,new B.StripeMaterialProperty({evenColor:B.Color.YELLOW.withAlpha(1)})),this._bottomMaterial=B.defaultValue(e.bottomMaterial,new B.StripeMaterialProperty({evenColor:B.Color.BLUE.withAlpha(1)})),this._entitys=[],!this._samplingPoints||this._samplingPoints.length<=2||(function(e,t){!function(e){e.length<3||!function(e){var t=e[0],i=e[1],r=e[2],o=B.Cartesian3.subtract(i,t,new B.Cartesian3),n=B.Cartesian3.subtract(r,t,new B.Cartesian3),a=B.Cartesian3.cross(o,n,new B.Cartesian3);return 0<=B.Cartesian3.dot(t,a)}(e)&&e.reverse()}(e);for(var i=e.length,r=[],o=0;o<i;++o){var n=(o+1)%i,a=B.Cartesian3.add(e[o],e[n],new B.Cartesian3);a=B.Cartesian3.multiplyByScalar(a,.5,a);var s=B.Cartesian3.normalize(a,new B.Cartesian3),l=B.Cartesian3.subtract(e[n],a,new B.Cartesian3);l=B.Cartesian3.normalize(l,l);var u=B.Cartesian3.cross(l,s,new B.Cartesian3);u=B.Cartesian3.normalize(u,u);var h=new B.Plane(u,0),c=B.Plane.getPointDistance(h,a);r.push(new B.ClippingPlane(u,c))}t.scene.globe.clippingPlanes=new B.ClippingPlaneCollection({planes:r,edgeWidth:2,edgeColor:B.Color.WHITE})}(this._samplingPoints,this.viewer),function(e){for(var t=e.interNumber,i=e.holeDepth,r=e.arrPoints,o=e.earth,n=e.sideMaterial,a=e.bottomMaterial,s=e.entitys,l=[],u=0;u<r.length;u++){var h=o.scene.globe.ellipsoid.cartesianToCartographic(r[u]);if(h.height=0,l.push(h),u==r.length-1)for(var c=1;c<=t;c++){var p=B.Cartesian3.lerp(r[u],r[0],c/t,new B.Cartesian3);(d=B.Cartographic.fromCartesian(p)).height=0,l.push(d)}else for(c=1;c<=t;c++){var d;p=B.Cartesian3.lerp(r[u],r[u+1],c/t,new B.Cartesian3),(d=B.Cartographic.fromCartesian(p)).height=0,l.push(d)}}for(u=0;u<l.length;u++){var f=o.scene.globe.getHeight(l[u]);l[u].height=f}var g=[];for(u=0;u<l.length;u++){var m=(u+1)%l.length,_=[];_.push(B.Math.toDegrees(l[u].longitude)),_.push(B.Math.toDegrees(l[u].latitude)),_.push(l[u].height),_.push(B.Math.toDegrees(l[m].longitude)),_.push(B.Math.toDegrees(l[m].latitude)),_.push(l[m].height),_.push(B.Math.toDegrees(l[m].longitude)),_.push(B.Math.toDegrees(l[m].latitude)),_.push(l[m].height+i),_.push(B.Math.toDegrees(l[u].longitude)),_.push(B.Math.toDegrees(l[u].latitude)),_.push(l[u].height+i),g.push(B.Math.toDegrees(l[u].longitude)),g.push(B.Math.toDegrees(l[u].latitude)),g.push(l[u].height+i);var v=o.entities.add({polygon:{hierarchy:B.Cartesian3.fromDegreesArrayHeights(_),material:n,perPositionHeight:!0}});s.push(v)}var C=o.entities.add({polygon:{hierarchy:B.Cartesian3.fromDegreesArrayHeights(g),material:a,perPositionHeight:!0}});s.push(C)}({arrPoints:this._samplingPoints,earth:this.viewer,holeDepth:this._depth,interNumber:this._interNumber,sideMaterial:this._sideMaterial,bottomMaterial:this._bottomMaterial,entitys:this._entitys}))}).prototype.destroy=function(){for(var e=0;e<this._entitys.length;e++)this.viewer.entities.remove(this._entitys[e]);this._entitys.length=0,this.viewer.scene.globe.clippingPlanes.destroy()},function(e){e.defaultValue;var t=e.GeoTerrainExcavate=function(t,i){this.viewer=t.viewer,this.scene=this.viewer.scene,this.canvas=this.scene.canvas,this.entities=this.viewer.entities,this._callback=i,this.depth=e.defaultValue(t.depth,-500),this._sideMaterial=t.sideMaterial,this._bottomMaterial=t.bottomMaterial,this._outPoints=[],this._arrayVertex=[],this._polylineCollection=void 0,this._vPolyline=void 0,this._vertexNum=0,this._excavationRegion=void 0,this.viewer.scene.globe.depthTestAgainstTerrain=!0};t.prototype.activate=function(){if(this.clear(),!this.handler){this.handler=new e.ScreenSpaceEventHandler(this.canvas),this.viewer.canvas.style.cursor="crosshair";var t=this;this.handler.setInputAction((function(i){var r=t.viewer.camera.getPickRay(i.position),o=t.viewer.scene.globe.pick(r,t.viewer.scene);t._arrayVertex.push(o);var n=e.Cartographic.fromCartesian(o);t._outPoints.push(e.Math.toDegrees(n.longitude)),t._outPoints.push(e.Math.toDegrees(n.latitude)),t._outPoints.push(n.height),null==t._polylineCollection&&(t._polylineCollection=t.viewer.scene.primitives.add(new e.PolylineCollection),t._polylineCollection.name="draw_polyline",t._vPolyline=t._polylineCollection.add({polyline:{}}),t._vPolyline.width=2,t._vPolyline.loop=!1,t._vPolyline.material.uniforms.color={red:1,green:0,blue:0,alpha:1}),t._vPolyline.positions=t._arrayVertex,t._vertexNum++}),e.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction((function(e){if(null!=t._polylineCollection){var i=t.viewer.camera.getPickRay(e.endPosition),r=t.viewer.scene.globe.pick(i,t.viewer.scene);t._arrayVertex.length>t._vertexNum&&t._arrayVertex.pop(),t._arrayVertex.push(r),t._vPolyline.positions=t._arrayVertex}}),e.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction((function(i){if(null!=t._polylineCollection){var r=t.viewer.camera.getPickRay(i.position),o=t.viewer.scene.globe.pick(r,t.viewer.scene),n=e.Cartographic.fromCartesian(o);t._outPoints.push(e.Math.toDegrees(n.longitude)),t._outPoints.push(e.Math.toDegrees(n.latitude)),t._outPoints.push(n.height),t._polylineCollection.remove(t._vPolyline),t.viewer.scene.primitives.remove(t._polylineCollection),t.handler.destroy(),t.handler=void 0,t._polylineCollection=void 0,t._vPolyline=void 0,t._vertexNum=0,t.viewer.canvas.style.cursor="default",t._excavationRegion=new e.GeoExcavationRegion({viewer:t.viewer,samplingPoints:t._arrayVertex,depth:t.depth,sideMaterial:t._sideMaterial,bottomMaterial:t._bottomMaterial,interNumber:10}),t._callback(t._outPoints)}}),e.ScreenSpaceEventType.RIGHT_CLICK)}},t.prototype.clear=function(){this._excavationRegion&&(this._outPoints.length=0,this._arrayVertex.length=0,this._excavationRegion.destroy(),this._excavationRegion=void 0)}}(window.Cesium),function(e){var t=e.defaultValue;(e.GeoTerrainSlope=function(e,i){e=t(e,t.EMPTY_OBJECT),this.viewer=e.viewer,this.scene=this.viewer.scene,this.canvas=this.scene.canvas,this.camera=this.scene.camera,this.primitives=this.scene.primitives,this.callback=i||null,this.contourUniforms={},this.shadingUniforms={}}).prototype.updateMaterial=function(n){var a=!1;if(n&&n.contour){a=t(n.contour.enable,!1);var s=t(n.contour.width,2),l=t(n.contour.spacing,150),u=t(n.contour.color,e.Color.RED.clone())}var h="none";if(n&&n.selectedShading&&(h=n.selectedShading,-1==["elevation","slope","aspect","none"].indexOf(h)))return alert("输入值可选elevation,slope,aspect,none中的一个！"),!1;var c,p=-414,d=8777;return n&&n.minHeight&&(p=n.minHeight),n&&n.maxHeight&&(d=n.maxHeight),a?("elevation"===h?(c=new e.Material({fabric:{type:"ElevationColorContour",materials:{contourMaterial:{type:"ElevationContour"},elevationRampMaterial:{type:"ElevationRamp"}},components:{diffuse:"contourMaterial.alpha == 0.0 ? elevationRampMaterial.diffuse : contourMaterial.diffuse",alpha:"max(contourMaterial.alpha, elevationRampMaterial.alpha)"}},translucent:!1}),this.shadingUniforms=c.materials.elevationRampMaterial.uniforms,this.shadingUniforms.minimumHeight=p,this.shadingUniforms.maximumHeight=d,this.contourUniforms=c.materials.contourMaterial.uniforms):"slope"===h?(c=new e.Material({fabric:{type:"SlopeColorContour",materials:{contourMaterial:{type:"ElevationContour"},slopeRampMaterial:{type:"SlopeRamp"}},components:{diffuse:"contourMaterial.alpha == 0.0 ? slopeRampMaterial.diffuse : contourMaterial.diffuse",alpha:"max(contourMaterial.alpha, slopeRampMaterial.alpha)"}},translucent:!0}),this.shadingUniforms=c.materials.slopeRampMaterial.uniforms,this.contourUniforms=c.materials.contourMaterial.uniforms):"aspect"===h?(c=new e.Material({fabric:{type:"AspectColorContour",materials:{contourMaterial:{type:"ElevationContour"},aspectRampMaterial:{type:"AspectRamp"}},components:{diffuse:"contourMaterial.alpha == 0.0 ? aspectRampMaterial.diffuse : contourMaterial.diffuse",alpha:"max(contourMaterial.alpha, aspectRampMaterial.alpha)"}},translucent:!1}),this.shadingUniforms=c.materials.aspectRampMaterial.uniforms,this.contourUniforms=c.materials.contourMaterial.uniforms):(c=e.Material.fromType("ElevationContour"),this.contourUniforms=c.uniforms),this.contourUniforms.width=s,this.contourUniforms.spacing=l,this.contourUniforms.color=u):"elevation"===h?(c=e.Material.fromType("ElevationRamp"),this.shadingUniforms=c.uniforms,this.shadingUniforms.minimumHeight=p,this.shadingUniforms.maximumHeight=d):"slope"===h?(c=e.Material.fromType("SlopeRamp"),this.shadingUniforms=c.uniforms):"aspect"===h&&(c=e.Material.fromType("AspectRamp"),this.shadingUniforms=c.uniforms),"none"!==h&&(this.shadingUniforms.image=function(e){var t=document.createElement("canvas");t.width=100,t.height=1;var n,a=t.getContext("2d");"elevation"===e?n=i:"slope"===e?n=r:"aspect"===e&&(n=o);var s=a.createLinearGradient(0,0,100,0);return 7==n.length?(s.addColorStop(n[0],"#000000"),s.addColorStop(n[1],"#2747E0"),s.addColorStop(n[2],"#D33B7D"),s.addColorStop(n[3],"#D33038"),s.addColorStop(n[4],"#FF9742"),s.addColorStop(n[5],"#ffd700"),s.addColorStop(n[6],"#ffffff")):(s.addColorStop(n[0],"#0a8d33"),s.addColorStop(n[1],"#599668"),s.addColorStop(n[2],"#afdd76"),s.addColorStop(n[3],"#fafcb4"),s.addColorStop(n[4],"#f2b602"),s.addColorStop(n[5],"#eea706"),s.addColorStop(n[6],"#df7702"),s.addColorStop(n[7],"#a52100"),s.addColorStop(n[8],"#682b06"),s.addColorStop(n[9],"#6a2402"),s.addColorStop(n[10],"#420202")),a.fillStyle=s,a.fillRect(0,0,100,1),t}(h)),this.scene.globe.material=c,!0};var i=[0,.045,.1,.15,.37,.54,1],r=[0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1],o=[0,.2,.4,.6,.8,.9,1]}(window.Cesium),function(e){var t=e.GeoTilesetFlatten=function(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),this._ready=!1,this.dirty=!1,this.polys=[],this.isCartesian3Point=e.defaultValue(t.isCartesian3Point,!0),this.show=e.defaultValue(t.show,!0),this.ellipsoid=e.defaultValue(t.ellipsoid,e.Ellipsoid.WGS84)};function i(t){var i=t.content._model;e.defined(i)&&e.defined(i.platSlot)&&delete i.platSlot}function r(t){var i=t.content._model;if(e.defined(i)){var r=i.platSlot;if(!e.defined(r))throw new e.DeveloperError("storing of model vertex buffers is fail.")}}t.prototype.bindTileset=function(t){if(!e.defined(t))throw new e.DeveloperError("parameter tileset is required.");if(e.defined(this._tileset))throw new e.DeveloperError("There is a tileset already, Only One Bind");this._tileset=t,(this._tileset.platBodyDebug=this).dirty=!0,this._tileset.tileUnload.addEventListener(i),this._tileset.tileLoad.addEventListener(r)},t.prototype.showPlat=function(e){this.show!=e&&(that.dirty=!0),this.show=e},t.prototype.isPlatShow=function(e){return this.show},t.prototype.isPlatDirty=function(){return this.dirty},t.prototype.clearPlatDirty=function(){this.dirty=!1},t.prototype.addPlatArea=function(t){var i=this;if(void 0!==t&&t instanceof Array){var r=t.length;if(!(r<3)){for(var o=[],n=i.isCartesian3Point,a=0;a<r;a++){var s=t[a];n?void 0!==s.height?o.push(e.Cartesian3.fromRadians(s.longitude,s.latitude,s.height,i.ellipsoid)):o.push(e.Cartesian3.clone(s,new e.Cartesian3)):void 0!==s.height?o.push(e.Cartographic.clone(s,new e.Cartographic)):o.push(e.Cartographic.fromCartesian(s,i.ellipsoid,new e.Cartographic))}if(i.isCartesian3Point){if(!o[0].equals(o[r-1])){var l=e.Cartesian3.clone(o[0],new e.Cartesian3);o.push(l)}}else e.Cartographic.equals(o[0],o[r-1])||(l=e.Cartographic.clone(o[0],new e.Cartographic),o.push(l));var u={};u.platPickPoints=o,u._show=!0,i.polys.push(u);var h=i.polys.length-1;return i.dirty=!0,i.initPlatBodyDebug(),this._ready=!0,h}}},t.prototype.getPlatArea=function(t){if(void 0!==t&&"number"==typeof t&&t<this.polys.length){var i=this.polys[t];if(void 0===i)return;var r=i.platPickPoints;if(void 0===r)return;for(var o=[],n=0;n<r.length;n++){var a=e.Cartesian3.clone(r[n],new e.Cartesian3);o.push(a)}return o}},t.prototype.removePlatArea=function(e){void 0!==e&&"number"==typeof e&&e<this.polys.length&&(delete this.polys[e],this.dirty=!0)},t.prototype.showPlatArea=function(e,t){void 0!==e&&"number"==typeof e&&e<this.polys.length&&(this.polys[e]._show=t,this.dirty=!0)},t.prototype.initRegionMatrixes=function(t){var i=t,r=i._pickObject.content._tile;if(e.defined(i._runtime.rootNodes)&&!(i._runtime.rootNodes.length<1)){var o=r._boundingVolume._orientedBoundingBox.halfAxes,n=r._boundingVolume._orientedBoundingBox.center,a={};if(a.matOrg=this.createHalfMatrix(o),a.matOrgI=this.invertMatrix(a.matOrg),e.defined(a.matOrgI)&&(a.matPrj=e.Transforms.eastNorthUpToFixedFrame(n,this.ellipsoid,new e.Matrix4),a.matPrjI=this.invertMatrix(a.matPrj),e.defined(a.matPrjI)))return a.modelMatrix=e.Matrix4.clone(i._runtime.rootNodes[0].computedMatrix,new e.Matrix4),a}},t.prototype.initBoxMatrixes=function(t){var i=t,r=i._pickObject.content._tile;if(e.defined(i._runtime.rootNodes)&&!(i._runtime.rootNodes.length<1)){var o=r._boundingVolume._orientedBoundingBox.center,n={};if(n.matPrj=e.Transforms.eastNorthUpToFixedFrame(o,this.ellipsoid,new e.Matrix4),n.matPrjI=this.invertMatrix(n.matPrj),e.defined(n.matPrjI)&&(n.modelMatrix=e.Matrix4.clone(i._runtime.rootNodes[0].computedMatrix,new e.Matrix4),n.modelMatrixI=this.invertMatrix(n.modelMatrix),e.defined(n.modelMatrixI)))return n}},t.prototype.toPlatRegionModel=function(t,i){var r=i,o=r.platSlot.buffers,n=o.length,a=this.initRegionMatrixes(r);if(e.defined(a)){this.initializePlatPoly(r);for(var s=0;s<n;s++){var l=o[s];if(void 0!==l&&1!=l.showPlat){l.showPlat=!0;for(var u=l.buffer.slice(0),h=new Float32Array(u.buffer,u.byteOffset,u.length/Float32Array.BYTES_PER_ELEMENT),c=0,p=[],d=[],f=0;f<h.length;f+=3){var g=new e.Cartesian3(h[f],h[f+1],h[f+2]);d.push(g),(m=e.Matrix4.multiplyByPoint(a.matOrgI,g,new e.Cartesian3)).z<c&&(c=m.z),p.push(m)}for(f=0;f<p.length;f++){var m=p[f];g=d[f],g=e.Matrix4.multiplyByPoint(a.modelMatrix,g,new e.Cartesian3),g=e.Matrix4.multiplyByPoint(a.matPrjI,g,new e.Cartesian3),this.isPlatPoint(r,g)&&(m.z=c),m=e.Matrix4.multiplyByPoint(a.matOrg,m,new e.Cartesian3),h[3*f]=m.x,h[3*f+1]=m.y,h[3*f+2]=m.z}this.replaceCommandVertexBuffer(r,u,s,t)}}r.platSlot.platPolys=void 0}},t.prototype.toPlatBoxModel=function(t,i){var r=this,o=i,n=o.platSlot.buffers,a=n.length,s=r.initBoxMatrixes(o);if(e.defined(s)){var l={};r.initializePlatPoly(o);for(var u=0;u<a;u++){var h=n[u];if(!h.showPlat||r.isPlatDirty()){h.showPlat=!0;for(var c=h.buffer.slice(0),p=new Float32Array(c.buffer,c.byteOffset,c.length/Float32Array.BYTES_PER_ELEMENT),d=0;d<p.length;d+=3){var f=new e.Cartesian3(p[d],p[d+1],p[d+2]);f=e.Cartesian3.clone(f);var g=e.Matrix4.multiplyByPoint(s.modelMatrix,f,new e.Cartesian3);l.pt=g,f=e.Matrix4.multiplyByPoint(s.matPrjI,g,new e.Cartesian3),r.isPlatPoint(o,f,l)&&(g=e.Matrix4.multiplyByPoint(s.modelMatrixI,l.pt,new e.Cartesian3),p[d]=g.x,p[d+1]=g.y,p[d+2]=g.z)}r.replaceCommandVertexBuffer(o,c,u,t)}}o.platSlot.platPolys=void 0}},t.prototype.toPlatModel=function(t,i){var r=i._pickObject.content._tile._header.boundingVolume.region;e.defined(r)?this.toPlatRegionModel(t,i):this.toPlatBoxModel(t,i)},t.prototype.toUnplatModel=function(e,t){for(var i=t,r=i.platSlot.buffers,o=r.length,n=0;n<o;n++){var a=r[n];if(void 0!==a&&0!=a.showPlat){a.showPlat=!1;var s=a.buffer.slice(0);this.replaceCommandVertexBuffer(i,s,n,e)}}i.platSlot.platPolys=void 0},t.prototype.platModel=function(e,t){var i=t;if(this._ready&&void 0!==i.platSlot&&void 0!==i.platSlot.buffers&&!(i.platSlot.buffers.length<1)){var r=this.hitPlatTest(i);(r||i.platSlot.isUsed)&&(i.platSlot.isUsed=!0,r?this.toPlatModel(e,t):this.toUnplatModel(e,t))}},t.prototype.hitPlatTest=function(e){var t=e,i=this.polys,r=i.length;if(r<1)return!1;for(var o=0;o<r;o++){var n=i[o];if(void 0!==n&&void 0!==n.platPickRegion&&this.hitPlatTestByRegion(t,n.platPickRegion))return!0}return!1},t.prototype.initPlatBodyDebug=function(){var t=this,i=t.ellipsoid;if(t.isCartesian3Point){if(void 0===(s=t.polys))return;if(void 0===(l=s.length)||l<1)return;if(!t.dirty)return;for(var r=0;r<l;r++)if(void 0!==(u=s[r])&&!e.defined(u.platPickRegion)){if(void 0===(f=u.platPickPoints))return;if(void 0===(g=f.length)||g<1)return;for(var o=0;o<g;o++){var n=e.Cartesian3.clone(f[o],new e.Cartesian3),a=e.Cartographic.fromCartesian(n,i);0!=o?(c>a.longitude?c=a.longitude:h<a.longitude&&(h=a.longitude),p>a.latitude?p=a.latitude:d<a.latitude&&(d=a.latitude)):(h=c=a.longitude,p=d=a.latitude)}u.platPickRegion={west:c,south:p,east:h,north:d}}}else{var s,l;if(void 0===(s=t.polys))return;if(void 0===(l=s.length)||l<1)return;if(!t.dirty)return;for(r=0;r<l;r++){var u;if(void 0!==(u=s[r])&&!e.defined(u.platPickRegion)){var h,c,p,d,f,g;if(void 0===(f=u.platPickPoints))return;if(void 0===(g=f.length)||g<1)return;for(h=c=f[0].longitude,p=d=f[0].latitude,o=1;o<g;o++)c>(n=e.Cartographic.clone(f[o],new e.Cartographic)).longitude?c=n.longitude:h<n.longitude&&(h=n.longitude),p>n.latitude?p=n.latitude:d<n.latitude&&(d=n.latitude);u.platPickRegion={west:c,south:p,east:h,north:d}}}}},t.prototype.createTileRegion=function(t){var i=t._header.boundingVolume;if(e.defined(i)){if(void 0!==i.region){var r=i.region;if(!e.defined(r))return;return{west:r[0],south:r[1],east:r[2],north:r[3]}}if(i.box){if(!e.defined(t._boundingVolume))return;var o=t._boundingVolume._orientedBoundingBox;if(!e.defined(o))return;var n,a=e.Cartesian3.add,s=e.Cartesian3.subtract,l=[];for(n=0;n<3;n++){var u=new e.Cartesian3(o.halfAxes[3*n],o.halfAxes[3*n+1],o.halfAxes[3*n+2]),h=[];h.push({f:a,a:u}),h.push({f:s,a:u}),l.push(h)}var c,p,d,f,g,m,_=this.ellipsoid,v=o.center,C=[],y=l[0],A=l[1],I=l[2];for(n=0;n<y.length;n++)for(var b=y[n],w=e.Cartesian3.clone(v,new e.Cartesian3),E=b.f(w,b.a,new e.Cartesian3),G=0;G<A.length;G++)for(var S=A[G],P=S.f(E,S.a,new e.Cartesian3),T=0;T<I.length;T++){var x=I[T],M=x.f(P,x.a,new e.Cartesian3);C.push(M)}for(c=p=C[0].x,d=f=C[0].y,g=m=C[0].z,n=1;n<C.length;n++){var L=C[n];c>L.x?c=L.x:p<L.x&&(p=L.x),d>L.y?d=L.y:f<L.y&&(f=L.y),g>L.z?g=L.z:m<L.z&&(m=L.z)}var N,R,O,D,F=[];for(F.push(e.Cartographic.fromCartesian(new e.Cartesian3(c,d,g),_,new e.Cartographic)),F.push(e.Cartographic.fromCartesian(new e.Cartesian3(p,f,m),_,new e.Cartographic)),n=0;n<F.length;n++){var U=F[n];0!=n?(N>U.longitude?N=U.longitude:R<U.longitude&&(R=U.longitude),D>U.latitude?D=U.latitude:O<U.latitude&&(O=U.latitude)):(N=R=U.longitude,O=D=U.latitude)}return{west:N,south:D,east:R,north:O}}}},t.prototype.hitPlatTestByRegion=function(t,i){return!!e.defined(i)},t.prototype.initializePlatPoly=function(e){this.isCartesian3Point?this.initializeCartesianPlatPoly(e):this.initializeCartographicPlatPoly(e)},t.prototype.initializeCartesianPlatPoly=function(t){var i=this,r=t,o=r.platSlot;if(e.defined(o.platPolys)){if(!i.isPlatDirty())return;delete o.platPolys}var n,a=i.ellipsoid,s=i.polys;if(e.defined(r._runtime.rootNodes)&&(n=r._runtime.rootNodes[0].computedMatrix),e.defined(n)){var l=i.invertMatrix(n);if(e.defined(l)){o.platPolys=[];var u,h,c=o.platPolys;for(h=0;h<s.length;h++){var p=s[h];if(e.defined(p)){var d,f,g,m,_=p.platPickPoints,v=new e.Cartesian3,C=[];for(u=1;u<_.length;u++){var y=_[u];v=e.Cartesian3.add(v,y,new e.Cartesian3);var A=e.Matrix4.multiplyByPoint(l,y,new e.Cartesian3);C.push(A),e.defined(d)?(d>A.x?d=A.x:g<A.x&&(g=A.x),f>A.y?f=A.y:m<A.y&&(m=A.y)):(d=g=A.x,f=m=A.y)}v=e.Cartesian3.divideByScalar(v,C.length,new e.Cartesian3);var I={pts:C,minX:d,minY:f,maxX:g,maxY:m,compressPlane:i.initCompressPlane(a,v),show:p._show};c.push(I)}}}}},t.prototype.initializeCartographicPlatPoly=function(t){var i=this,r=t,o=r._pickObject.content._tile,n=r.platSlot;if(e.defined(n.platPolys)){if(!i.isPlatDirty())return;n.platPolys=void 0}var a,s=i.ellipsoid,l=i.polys;if(e.defined(o._boundingVolume)&&e.defined(o._boundingVolume._orientedBoundingBox)&&(a=o._boundingVolume._orientedBoundingBox.center),e.defined(a)){var u,h=e.Transforms.eastNorthUpToFixedFrame(a,s,new e.Matrix4),c=i.invertMatrix(h);if(e.defined(c)&&(e.defined(r._runtime)&&e.defined(r._runtime.rootNodes)&&0<r._runtime.rootNodes.length&&e.defined(r._runtime.rootNodes[0])&&(u=r._runtime.rootNodes[0].computedMatrix),e.defined(u))){var p=i.invertMatrix(u);if(e.defined(p)){n.platPolys=[];var d,f,g=n.platPolys;for(f=0;f<l.length;f++){var m=l[f];if(e.defined(m)){var _=m.platPickPoints;if(e.defined(_)&&!(_.length<1)){var v,C,y,A,I=new e.Cartesian3,b=[];for(d=0;d<_.length;d++){var w,E=_[d];if(i.isCartesian3Point)w=e.Cartesian3.clone(E,new e.Cartesian3),I=e.Cartesian3.add(I,w,new e.Cartesian3),w=e.Matrix4.multiplyByPoint(p,w,new e.Cartesian3);else{w=e.Cartographic.clone(E,new e.Cartographic);var G=e.Cartesian3.fromRadians(w.longitude,w.latitude,0,s);I=e.Cartesian3.add(I,G,new e.Cartesian3),w=e.Matrix4.multiplyByPoint(c,G,new e.Cartesian3)}b.push(w),e.defined(v)?(v>w.x?v=w.x:y<w.x&&(y=w.x),C>w.y?C=w.y:A<w.y&&(A=w.y)):(v=y=w.x,C=A=w.y)}I=e.Cartesian3.divideByScalar(I,b.length,new e.Cartesian3);var S={pts:b,minX:v,minY:C,maxX:y,maxY:A,compressPlane:i.initCompressPlane(s,I)};g.push(S)}}}}}}},t.prototype.initCompressPlane=function(t,i){var r=e.Cartesian3.clone(i,new e.Cartesian3),o=e.Cartographic.fromCartesian(r,t,new e.Cartographic),n=e.Cartesian3.fromRadians(o.longitude,o.latitude,0,t);if(!r.equals(n))return e.Plane.fromPointNormal(r,e.Cartesian3.normalize(e.Cartesian3.subtract(r,n,new e.Cartesian3),new e.Cartesian3))},t.prototype.isPlatPointNoResult=function(t,i){for(var r=t.platSlot.platPolys,o=e.Cartesian3.clone(i,new e.Cartesian3),n=0;n<r.length;n++){var a=r[n];if(e.defined(a)&&this.isInsidedPoint(a,o))return!0}return!1},t.prototype.isPlatPointResult=function(t,i,r){for(var o=t.platSlot.platPolys,n=e.Cartesian3.clone(i,new e.Cartesian3),a=e.Cartesian3.clone(r.pt,new e.Cartesian3),s=!1,l=0;l<o.length;l++){var u=o[l];if(e.defined(u)&&this.isInsidedPoint(u,n)){var h=this.mapPosition(u.compressPlane,a);e.defined(h)&&(a=h),s=!0}}return s&&(r.pt=a),s},t.prototype.isPlatPoint=function(t,i,r){return e.defined(r)?this.isPlatPointResult(t,i,r):this.isPlatPointNoResult(t,i)},t.prototype.mapPosition=function(t,i){if(e.defined(t)&&e.defined(i)&&e.defined(t.normal)){var r=e.Cartesian3.clone(t.normal,new e.Cartesian3),o=e.Cartesian3.clone(i,new e.Cartesian3),n=new e.Ray(o,r),a=e.IntersectionTests.rayPlane(n,t);if(e.defined(a))return o;var s=e.Cartesian3.negate(r,new e.Cartesian3),l=new e.Ray(o,s),u=e.IntersectionTests.rayPlane(l,t);if(!e.defined(u))return o;var h=e.Cartesian3.distance(u,o);return e.Cartesian3.add(o,e.Cartesian3.multiplyByScalar(s,h,new e.Cartesian3),new e.Cartesian3)}},t.prototype.isInsidedPoint=function(t,i){var r=this;if(!e.defined(t))return!1;if(!e.defined(t.show)||!t.show)return!1;if(!e.defined(i))return!1;var o,n,a=i.x,s=i.y;if(a<t.minX||a>t.maxX||s<t.minY||s>t.maxY)return!1;var l,u,h,c,p,d,f={z:!1,b:!1,t:!1},g=t.pts,m=g.length;for(o=0,n=m-1;o<m;n=o++){if(l=g[o],u=g[n],h=l.x,c=l.y,p=u.x,d=u.y,r.isEqualFloat(d,c)){if(r.isEqualFloat(s,c)){if(r.isEqualFloat(a,h))return!0;if(r.isEqualFloat(a,p))return!0;if(a<h==p<a)return!0}}else if(r.isEqualFloat(s,c)){if(r.isEqualFloat(a,h))return!0;h<a&&(d<s?f.b=!f.b:f.t=!f.t)}else if(r.isEqualFloat(s,d)){if(r.isEqualFloat(a,p))return!0;p<a&&(c<s?f.b=!f.b:f.t=!f.t)}if(s<c!=s<d){var _=(p-h)/(d-c);if(_*=s-c,_+=h,r.isEqualFloat(a,_))return!0;a<_&&(f.z=!f.z)}}return f.t==f.b?f.t?!f.z:f.z:void 0},t.prototype.isEqualFloat=function(t,i,r){if(e.defined(r)||(r=1e-8),!e.defined(t))return!1;if(!e.defined(i))return!1;var o=t-i;return(o=Math.abs(o))<r},t.prototype.replaceCommandVertexBuffer=function(t,i,r,o){var n=t;if(e.defined(i)&&e.defined(r)&&"number"==typeof r&&e.defined(o)&&e.defined(o.context)){var a=n._nodeCommands;if(e.defined(a)&&!(a.length<=r)){var s=e.Buffer.createVertexBuffer({context:o.context,typedArray:i,usage:e.BufferUsage.STATIC_DRAW});if(e.defined(s)){var l=a[r];if(e.defined(l)){var u=l.command;if(e.defined(u)){var h=u._vertexArray;if(e.defined(h)){var c=h._attributes;if(e.defined(c)&&0<c.length){var p=c[0];if(!e.defined(p))return;var d=p.vertexBuffer;e.defined(d)&&!d.isDestroyed()&&d.vertexArrayDestroyable&&d.destroy(),p.vertexBuffer=s;var f=h._vao;e.defined(f)&&(o.context.glDeleteVertexArray(h._vao),h._vao=void 0)}}}}}}}},t.prototype.storeVertexBuffer=function(t){if(e.defined(t)){var i=t;if(!e.defined(i.platSlot)){var r=i._pickObject;if(e.defined(r)){var o=r.content;if(e.defined(o)){var n=o._tileset;if(e.defined(n)&&e.defined(n.platBodyDebug)){var a=i._loadResources;if(e.defined(a)){var s=i._cachedGltf._gltf;if(e.defined(s)){var l=s.accessors;if(e.defined(l)){var u=s.bufferViews;if(e.defined(u)){var h=s.meshes;if(e.defined(h)){i.platSlot={},i.platSlot.buffers=[],i.platSlot.isUsed=!1;for(var c=0;c<h.length;c++){var p=h[c];if(e.defined(p)){var d=p.primitives;if(e.defined(d))for(var f=0;f<d.length;f++){var g=d[f];if(e.defined(g)){var m=g.attributes;if(e.defined(m))for(var _ in m)if("POSITION"===_){var v=u[l[m[_]].bufferView],C=a.getBuffer(v),y=C.slice(0,C.length);i.platSlot.buffers.push({buffer:y,showPlat:!1})}}}}}}}}}}}}}}}},t.prototype.invertMatrix=function(t){var i=void 0;try{i=e.Matrix4.inverse(t,new e.Matrix4)}catch(t){}return i},t.prototype.createMatrix=function(t){if(e.defined(t)){var i=new e.Matrix4;return e.Matrix4.setColumn(i,0,new e.Cartesian4(t[0].x,t[0].y,t[0].z,0),i),e.Matrix4.setColumn(i,1,new e.Cartesian4(t[1].x,t[1].y,t[1].z,0),i),e.Matrix4.setColumn(i,2,new e.Cartesian4(t[2].x,t[2].y,t[2].z,0),i),e.Matrix4.setColumn(i,3,new e.Cartesian4(0,0,0,1),i),i}},t.prototype.createHalfMatrix=function(t){if(e.defined(t)){for(var i=[],r=0;r<3;r++)i.push(this.createNormal(t[3*r],t[3*r+1],t[3*r+2]));return this.createMatrix(i)}},t.prototype.createNormal=function(t,i,r){return e.Cartesian3.normalize(new e.Cartesian3(t,i,r),new e.Cartesian3)}}(window.Cesium),function(e){var t="GEOVIEWRADAR_TIP",i="GEOVIEWRADAR_LIGHTPOINT",r=e.GeoViewRadar=function(t,i){this.viewer=t.viewer,this.pointLightHeight=e.defaultValue(t.pointLightHeight,.2),this.boundingSphereStackPartitions=e.defaultValue(t.boundingSphereStackPartitions,100),this.boundingSphereSlicePartitions=e.defaultValue(t.boundingSphereSlicePartitions,80),this.boundingSphereSubdivisions=e.defaultValue(t.boundingSphereSubdivisions,100),this.scene=this.viewer.scene,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.callback=i||null,_()(e.VERSION)<1.5&&console.error("当前Cesium版本："+e.VERSION+",雷达分析暂不支持该版本，请更换至1.50以上的版本!")};function o(t,i,r){var o=t.scene.pickPosition(i);if(o){var n=e.Cartographic.fromCartesian(o);if(n.height<0){t.scene.globe.depthTestAgainstTerrain=!0,t.viewer.terrainShadows=e.ShadowMode.CAST_ONLY;var a=t.scene.camera.getPickRay(i),s=t.scene.globe.pick(a,t.scene);n=e.Cartographic.fromCartesian(s)}r=r||0;var l=e.Cartesian3.fromRadians(n.longitude,n.latitude,n.height+r),u=e.Cartographic.fromCartesian(l);return[e.Math.toDegrees(u.longitude),e.Math.toDegrees(u.latitude),u.height]}}function n(t,i,r,o){var n=t.add(new e.LabelCollection);return n.add({text:i,font:"16px sans-serif",showBackground:!0,position:r,pixelOffset:new e.Cartesian2(10,-30)}),n.name=o,n}function a(e,t,i){for(var r=0;r<e.length;r++)e.name==i&&(e.get(r).position=t)}function s(e,t){l(e,t)}function l(e,t){for(var i=0;i<t.length;i++)t.get(i).name==e&&(t.remove(t.get(i)),i--)}r.prototype.activate=function(){this.clear(),this.canvas.style.cursor="crosshair";var i=null,r=null,l=!0,u=null,h=null,c=this;this.handler=new e.ScreenSpaceEventHandler(this.canvas),this.handler.setInputAction((function(r){l=l?(u=o(c,r.position,c.pointLightHeight),h=e.Cartesian3.fromDegrees(u[0],u[1],u[2]),s(t,c.primitives),!1):(c.scene.shadowMap.enableGeoViewRadar=!0,c.canvas.style.cursor="default",c.handler&&!c.handler.isDestroyed()&&c.handler.destroy(),s(t,c.primitives),!0),c.firstLeftClick=l,i=null}),e.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction((function(s){if(c.tipPosition=c.scene.pickPosition(s.endPosition),c.tipPosition&&(l&&(i?a(i,c.tipPosition,t):i=n(c.primitives,"单击左键确定雷达位置",c.tipPosition,t)),!l)){i?a(i,c.tipPosition,t):i=n(c.primitives,"单击左键固定雷达半径",c.tipPosition,t);var u=o(c,s.endPosition),p=e.Cartesian3.fromDegrees(u[0],u[1],u[2]);r=e.Cartesian3.distance(h,p),c.dynamicAnalysis(h,r),c.pointLightPosition=h,c.realTimeRadius=r,c.firstLeftClick=l}}),e.ScreenSpaceEventType.MOUSE_MOVE)},r.prototype.dynamicAnalysis=function(t,r){if(t&&r){var o=new e.Camera(this.scene);o.position=t,l(i,this.primitives);var n,a=this.primitives.add(new e.PointPrimitiveCollection);a.name=i,a.add({position:t,color:e.Color.YELLOW,pixelSize:5}),n={context:this.scene.context,lightCamera:o,isPointLight:!0},this.scene.shadowMap.destroy(),this.scene.shadowMap=new e.ShadowMap(n);var s=this.scene.shadowMap;s.enabled=!0,s.debugShow=!0,s.enableGeoViewRadar=!0,s.size=1024,s._pointLightRadius=r,s._boundingSphere.stackPartitions=this.boundingSphereStackPartitions,s._boundingSphere.slicePartitions=this.boundingSphereSlicePartitions,s._boundingSphere.subdivisions=this.boundingSphereSubdivisions}},r.prototype.clear=function(){this.scene.shadowMap.enabled=!1,this.scene.shadowMap.enableGeoViewRadar=void 0,this.canvas.style.cursor="default",this.handler&&!this.handler.isDestroyed()&&this.handler.destroy(),s(t,this.primitives),l(i,this.primitives)},r.prototype.destroy=function(){this.clear(),this.viewer=void 0,this.pointLightHeight=void 0,this.scene=void 0,this.canvas=void 0,this.primitives=void 0,this.callback=void 0}}(window.Cesium),function(e){var t="GEOVIEWSHED3D_TIP",i="GEOVIEWSHED3D_SPOTID",r=e.GeoViewShed3D=function(t,i){this.viewer=t.viewer,this.spotLightHeight=e.defaultValue(t.spotLightHeight,1),this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.canvas=this.scene.canvas,this.primitives=this.scene.primitives,this.callback=i||null,this._shadowMapNum=0,this._spotLightCameraList=[],null==this.scene.expandShadowMapList&&(this.scene.expandShadowMapList=[]),_()(e.VERSION)<1.5&&console.error("当前Cesium版本："+e.VERSION+",可视域分析暂不支持该版本，请更换至1.50以上的版本!")};function o(t,i,r){var o=t.scene.pickPosition(i);if(o){var n=e.Cartographic.fromCartesian(o);if(n.height<0){t.scene.globe.depthTestAgainstTerrain=!0,t.viewer.terrainShadows=e.ShadowMode.ENABLED;var a=t.camera.getPickRay(i),s=t.scene.globe.pick(a,t.scene);n=e.Cartographic.fromCartesian(s)}r=r||0;var l=e.Cartesian3.fromRadians(n.longitude,n.latitude,n.height+r),u=e.Cartographic.fromCartesian(l);return[e.Math.toDegrees(u.longitude),e.Math.toDegrees(u.latitude),u.height]}}function n(t,i,r,o){var n=t.add(new e.LabelCollection);return n.add({text:i,font:"16px sans-serif",showBackground:!0,position:r,pixelOffset:new e.Cartesian2(10,-10)}),n.name=o,n}function a(e,t,i){for(var r=0;r<e.length;r++)e.name==i&&(e.get(r).position=t)}function s(e,t){!function(e,t){for(var i=0;i<t.length;i++)t.get(i).name==e&&(t.remove(t.get(i)),i--)}(e,t)}function l(e,t){for(var i=0;i<t.length;i++)t.get(i).id==e&&(t.remove(t.get(i)),i--)}r.prototype.activate=function(){var i=null,r=this._spotLightCameraList.length;this._spotLightCameraList[r]=new e.Camera(this.scene),this.scene.shadowMap.enabled=!1;var l=null,u=null,h=null;this.handler&&!this.handler.isDestroyed()&&this.handler.destroy(),this.canvas.style.cursor="crosshair";var c=this,p=!0,d=null,f=null;this.handler=new e.ScreenSpaceEventHandler(this.canvas),this.handler.setInputAction((function(e){p?(d=o(c,e.position,c.spotLightHeight),p=!1,c.firstLeftClick=p,s(t,c.primitives),i=null):(c.handler&&!c.handler.isDestroyed()&&c.handler.destroy(),p=!0,c.firstLeftClick=p,c.canvas.style.cursor="default",s(t,c.primitives),i=null,c._shadowMapNum++)}),e.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction((function(r){if(c.tipPosition=c.scene.pickPosition(r.endPosition),c.tipPosition&&(p&&(i?a(i,c.tipPosition,t):i=n(c.primitives,"单击左键确定观察位置",c.tipPosition,t)),!p)){i?a(i,c.tipPosition,t):i=n(c.primitives,"单击左键固定视域范围",c.tipPosition,t),f=o(c,r.endPosition),l=turf.bearing(turf.point([d[0],d[1]]),turf.point([f[0],f[1]]));var s=turf.distance(turf.point([d[0],d[1]]),turf.point([f[0],f[1]])),g=f[2]-d[2];u=e.Math.toDegrees(Math.atan(g/(1e3*s)));var m=e.Cartesian3.fromDegrees(d[0],d[1],d[2]),_=e.Cartesian3.fromDegrees(f[0],f[1],f[2]);h=e.Cartesian3.distance(m,_),c.analysis({observePtCoordinate:d,frustumLength:h,frustumHead:l,frustumPitch:u,frustumField:30}),c.spotLightPosition=d,c.realTimeHeading=l,c.realTimePitching=u,c.realTimeDistance=h,c.realTimeFieldAngle=30,c.firstLeftClick=p}}),e.ScreenSpaceEventType.MOUSE_MOVE)},r.prototype.analysis=function(t){var r=t.observePtCoordinate,o=t.frustumLength,n=t.frustumHead,a=t.frustumPitch,s=t.frustumField;if(null!=r&&null!=o&&null!=n&&null!=a&&null!=s){var u=e.Cartesian3.fromDegrees(r[0],r[1],r[2]),h=e.Math.toRadians(n),c=e.Math.toRadians(a),p=this._spotLightCameraList.length,d=i+(p-1),f=this.scene.expandShadowMapList.length;f>this._shadowMapNum&&this.scene.expandShadowMapList.splice(f-1,1);var g,m=this._spotLightCameraList[p-1];m.frustum=new e.PerspectiveFrustum({fov:e.Math.toRadians(s),aspectRatio:1.6,near:1,far:o}),g={context:this.scene.context,lightCamera:m,cascadesEnabled:!1,darkness:.5,isPointLight:!1},this.scene.expandShadowMapList.push(new e.ShadowMap(g));var _=this.scene.expandShadowMapList[this.scene.expandShadowMapList.length-1];_._terrainBias.depthBias=0,_.enabled=!0,_.size=2048,_.enableGeoViewShed3D=!0,m.lookAt(u,new e.HeadingPitchRange(h,c,1e-21)),l(d,this.primitives),this.primitives.add(new e.DebugCameraPrimitive({camera:m,color:e.Color.fromHsl(1,1,1,1),id:d}))}},r.prototype.clear=function(){this.scene.shadowMap.enableGeoViewShed3D=void 0;for(var e=this._spotLightCameraList.length,r=0;r<e;r++)l(i+r,this.primitives);s(t,this.primitives),this._spotLightCameraList.length=0,this.scene.expandShadowMapList.length=0},r.prototype.destroy=function(){this.scene.shadowMap.enableGeoViewShed3D=void 0,this.handler&&!this.handler.isDestroyed()&&this.handler.destroy(),this.scene.shadowMap.enabled=!1,this.canvas.style.cursor="default",this.clear(),this.viewer=void 0,this.spotLightHeight=void 0,this.scene=void 0,this.camera=void 0,this.canvas=void 0,this.primitives=void 0,this.ellipsoid=void 0,this.callback=void 0}}(window.Cesium),function(e){var t="GeoVolumeCalculate_LINE",i="GeoVolumeCalculate_TIP",r="GeoVolumeCalculate_GON",o="GeoVolumeCalculate_DEGON",n="GeoVolumeCalculate_CORAL",a=e.GeoVolumeCalculate=function(e,t){this.viewer=e.viewer,this.scene=this.viewer.scene,this.canvas=this.scene.canvas,this.camera=this.scene.camera,this.primitives=this.scene.primitives,this.designElevation=e.designElevation?e.designElevation:4e3,this.samplingPointsNumber=e.samplingPointsNumber?e.samplingPointsNumber:500,this.callback=t||null};function s(e,t){for(var i=0,r=0;r<t.length;r++)if(t[r]==e&&i++,2==i)return!0}function l(e,t,i,r,o,n,a){var s={},l=turf.polygon([[e.geometry.coordinates[0][i[0]],t[0],t[1],e.geometry.coordinates[0][i[0]]]]),u=turf.area(l),h=a-r,c=1/3*u*h,p=turf.polygon([[e.geometry.coordinates[0][i[1]],t[0],t[1],e.geometry.coordinates[0][i[1]]]]),d=turf.area(p),f=a-o,g=turf.polygon([[e.geometry.coordinates[0][i[1]],e.geometry.coordinates[0][i[2]],t[0],t[1],e.geometry.coordinates[0][i[1]]]]),m=turf.area(g),_=turf.polygon([[e.geometry.coordinates[0][i[1]],e.geometry.coordinates[0][i[2]],t[1],t[0],e.geometry.coordinates[0][i[1]]]]),v=turf.area(_),C=v<m?m:v,y=1/3*d*f+1/3*(C-d)*(f+(a-n));return 0<=h?(s.fillVolume=c,s.fillArea=u,s.excavationVolume=y,s.excavationArea=C):(s.fillVolume=y,s.fillArea=C,s.excavationVolume=c,s.excavationArea=u),s}function u(t,i,r,o,n,a,s,l,u){var h={},c=Math.abs(t/(t-i)),p=new e.Cartesian3(0,0,0),d=e.Cartesian3.fromRadians(r.geometry.coordinates[0][o][0],r.geometry.coordinates[0][n][1],l),f=e.Cartesian3.fromRadians(r.geometry.coordinates[0][n][0],r.geometry.coordinates[0][n][1],u),g=e.Cartographic.fromCartesian(e.Cartesian3.lerp(d,f,c,p));return h.intersection=[g.longitude,g.latitude],h.vertexSerial=[a,s],h}function h(t,r){return t.add({name:i,position:r,label:{text:"左键点击绘制，右键点击结束",font:"15px sans-serif",showBackground:!0,pixeloffset:new e.Cartesian2(0,20)}})}function c(e,t){for(var i=0;i<t.values.length;i++)t.values[i].name==e&&(t.remove(t.values[i]),i--)}a.prototype.activate=function(){this.canvas.style.cursor="crosshair";var a=0,s=this,l=[],u=[],p=[],d=[],f=[];this.handler=new e.ScreenSpaceEventHandler(this.canvas),this.handler.setInputAction((function(i){var r=s.camera.getPickRay(i.position),o=s.scene.globe.pick(r,s.scene);u.push(o);var n=e.Cartographic.fromCartesian(o),h=e.Math.toDegrees(n.longitude),c=e.Math.toDegrees(n.latitude),g=n.height;p.push(h,c,g),d.push(h,c,s.designElevation),l=a?(f[a-1].polyline.positions.getValue().shift(),[f[0].polyline.positions.getValue()[1],o,f[a-1].polyline.positions.getValue()[0]]):[o,o,o],s.polylineEntity=s.viewer.entities.add({name:t,polyline:{positions:l,clampToGround:!0,width:5,material:new e.PolylineOutlineMaterialProperty({color:e.Color.ORANGE,outlineWidth:2,outlineColor:e.Color.BLACK})}}),f.push(s.polylineEntity),a++}),e.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction((function(e){if(l.length){var t=s.camera.getPickRay(e.endPosition),i=s.scene.globe.pick(t,s.scene);l.splice(l.length-2,1,i),f[a-1].polyline.positions=l,s.labelEntity?s.labelEntity.position=i:s.labelEntity=h(s.viewer.entities,i)}else s.labelEntity?s.labelEntity.position=i:s.labelEntity=h(s.viewer.entities,i)}),e.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction((function(a){var l=s.camera.getPickRay(a.position),h=s.scene.globe.pick(l,s.scene);u.push(h);var f=e.Cartographic.fromCartesian(h),g=e.Math.toDegrees(f.longitude),m=e.Math.toDegrees(f.latitude),_=f.height;p.push(g,m,_),d.push(g,m,s.designElevation),s.handler.destroy(),s.canvas.style.cursor="default",s.labelEntity&&c(i,s.viewer.entities),s.polylineEntity&&c(t,s.viewer.entities),s.VOLUME=s.volumeAnalysis(s.scene,p,s.designElevation,s.samplingPointsNumber),s.callback(s.VOLUME),s.designPolygonEntity=s.viewer.entities.add({name:o,polygon:{hierarchy:{positions:e.Cartesian3.fromDegreesArrayHeights(d)},material:e.Color.BLUE.withAlpha(.8),perPositionHeight:!0}}),s.polygonEntity=s.viewer.entities.add({name:r,polygon:{hierarchy:{positions:u},material:e.Color.GREEN.withAlpha(.5)}}),s.designPolygonEntity_coral=s.viewer.entities.add({name:n,polygon:{hierarchy:{positions:e.Cartesian3.fromDegreesArrayHeights(d)},material:e.Color.CORAL.withAlpha(.5),perPositionHeight:!0,outline:!0,outlineColor:e.Color.YELLOW.withAlpha(1),extrudedHeight:0,closeTop:!0,closeBottom:!1}})}),e.ScreenSpaceEventType.RIGHT_CLICK)},a.prototype.volumeAnalysis=function(t,i,r,o){for(var n,a={features:[]},h=t.globe.ellipsoid,c=[],p=e.Cartesian3.fromDegreesArrayHeights(i),f=0;f<p.length;f++){var g=e.Math.toDegrees(h.cartesianToCartographic(p[f]).longitude),m=e.Math.toDegrees(h.cartesianToCartographic(p[f]).latitude);c.push([g,m])}c.push([e.Math.toDegrees(h.cartesianToCartographic(p[0]).longitude),e.Math.toDegrees(h.cartesianToCartographic(p[0]).latitude)]);var _=turf.lineString(c),v=turf.bbox(_),C=turf.randomPoint(2*o,{bbox:v}),y=turf.polygon([c]);for(f=0;f<C.features.length;f++){var A=turf.point(C.features[f].geometry.coordinates);turf.booleanPointInPolygon(A,y)||(C.features.splice(f,1),f--)}var I=[],b=p.concat(p[0]);for(f=0;f<b.length-1;f++)for(var w=1;w<Math.ceil(o/10);w++){var E=new e.Cartesian3(0,0,0);E=e.Cartesian3.lerp(b[f],b[f+1],w*(1/Math.ceil(o/10)),E),I.push(E)}p=p.concat(I);var G=[],S=[];for(f=0;f<p.length;f++){var P=h.cartesianToCartographic(p[f]).longitude,T=h.cartesianToCartographic(p[f]).latitude;G.push(new e.Cartographic(P,T)),S.push([P,T])}for(f=0;f<C.features.length;f++){var x=e.Math.toRadians(C.features[f].geometry.coordinates[0]),M=e.Math.toRadians(C.features[f].geometry.coordinates[1]);G.push(new e.Cartographic(x,M))}return t.sampleHeightMostDetailed(G).then((function(e){a.type="FeatureCollection";for(var t=0;t<e.length;t++)a.features.push({type:"Feature",geometry:{coordinates:[e[t].longitude,e[t].latitude],type:"Point"},properties:{z:e[t].height}});n=turf.tin(a,"z");var i=0,o=0,h=0,c=0,p=r;for(t=0;t<n.features.length;t++){var f=n.features[t].properties.a-p,g=n.features[t].properties.b-p,m=n.features[t].properties.c-p,_=[],v=[];if(f*g<0||f*m<0||g*m<0){if(f*g<0){var C=u(f,g,n.features[t],0,1,"a","b",n.features[t].properties.a,n.features[t].properties.b);_.push(C.intersection),v.push(C.vertexSerial[0],C.vertexSerial[1])}var y;f*m<0&&(C=u(f,m,n.features[t],0,2,"a","c",n.features[t].properties.a,n.features[t].properties.c),_.push(C.intersection),v.push(C.vertexSerial[0],C.vertexSerial[1])),g*m<0&&(C=u(g,m,n.features[t],1,2,"b","c",n.features[t].properties.b,n.features[t].properties.c),_.push(C.intersection),v.push(C.vertexSerial[0],C.vertexSerial[1])),s("a",v)&&(o+=(y=l(n.features[t],_,[0,1,2],n.features[t].properties.a,n.features[t].properties.b,n.features[t].properties.c,p)).fillVolume,c+=y.fillArea,i+=y.excavationVolume,h+=y.excavationArea),s("b",v)&&(o+=(y=l(n.features[t],_,[1,0,2],n.features[t].properties.b,n.features[t].properties.a,n.features[t].properties.c,p)).fillVolume,c+=y.fillArea,i+=y.excavationVolume,h+=y.excavationArea),s("c",v)&&(o+=(y=l(n.features[t],_,[2,0,1],n.features[t].properties.c,n.features[t].properties.a,n.features[t].properties.b,p)).fillVolume,c+=y.fillArea,i+=y.excavationVolume,h+=y.excavationArea)}else{var A=turf.polygon([n.features[t].geometry.coordinates[0]]),I=turf.area(A),b=1/3*[p-n.features[t].properties.a+(p-n.features[t].properties.b)+(p-n.features[t].properties.c)];0<=b?(o+=I*b,c+=I):(i+=I*b,h+=I)}}var w={fillVolume:Number(o.toFixed(3)),excavationVolume:Number(Math.abs(i).toFixed(3)),totalVolume:Number(o.toFixed(3))+Number(Math.abs(i).toFixed(3)),fillArea:Number(c.toFixed(3)),excavationArea:Number(h.toFixed(3)),totalArea:Number(c.toFixed(3))+Number(h.toFixed(3))};return new d.a((function(e){e(w)}))}))},a.prototype.clear=function(){this.canvas.style.cursor="default",this.handler&&!this.handler.isDestroyed()&&this.handler.destroy(),this.polylineEntity&&c(t,this.viewer.entities),this.labelEntity&&c(i,this.viewer.entities),this.polygonEntity&&c(r,this.viewer.entities),this.designPolygonEntity&&c(o,this.viewer.entities),this.designPolygonEntity_coral&&c(n,this.viewer.entities),this.polylineEntity=void 0,this.labelEntity=void 0},a.prototype.destroy=function(){this.clear(),this.viewer=void 0,this.scene=void 0,this.canvas=void 0,this.camera=void 0,this.primitives=void 0,this.designElevation=void 0,this.samplingPointsNumber=void 0,this.callback=void 0}}(window.Cesium),function(e){var t=e.SingleBuildingWidget=function(t,i,r){this.viewer=t.viewer,this.scene=this.viewer.scene,this.globe=this.viewer.scene.globe,this.data=t.data?t.data:{},this.classificationPrimitiveCollection=new e.PrimitiveCollection,this.scene.primitives.add(this.classificationPrimitiveCollection),this.callback_click=i||function(){},this.callback_move=r||function(){},this.show=void 0===t.show||t.show,this.fillColor=t.fillColor?t.fillColor:e.Color.CORNFLOWERBLUE.withAlpha(.3),this.highlightColor_click=t.highlightColor_click?t.highlightColor_click:e.Color.YELLOW.withAlpha(.3),this.highlightColor_move=t.highlightColor_move?t.highlightColor_move:e.Color.WHITE.withAlpha(.2),this._INTERSECTED_FLOOR=null,this._INTERSECTED_FLOOR2=null,this._INTERSECTED_FLOOR3=null,this.handler=new e.ScreenSpaceEventHandler(this.viewer.canvas)};e.defineProperties(t.prototype,{show:{set:function(e){this._show=e,this.classificationPrimitiveCollection.show=e},get:function(){return this._show}}}),t.prototype.extrudeToBuilding=function(){var t=this;if(this.clear(),this._INTERSECTED_FLOOR=null,this._INTERSECTED_FLOOR2=null,this._INTERSECTED_FLOOR3=null,this.classificationPrimitiveCollection.show=this._show,t.data&&t.data.geometry){var i=0;if(t.data.properties.baseHeight)i=t.data.properties.baseHeight;else if(t.scene.sampleHeightSupported){var r=t.data.geometry.coordinates[0][0],o=new e.Cartographic(e.Math.toRadians(r[0]),e.Math.toRadians(r[1]));i=t.scene.sampleHeight(o)}else(i=t.globe.getHeight({longitude:e.Math.toRadians(t.data.geometry.coordinates[0][0][0]),latitude:e.Math.toRadians(t.data.geometry.coordinates[0][0][1])}))||console.error("地形还未准备好！");if(!i)return void console.warn("建筑物基础高度baseHeight是必需的！");for(var n=t.data.properties.levels,a=[],s=0;s<t.data.geometry.coordinates[0].length;s++)a.push(t.data.geometry.coordinates[0][s][0]),a.push(t.data.geometry.coordinates[0][s][1]);for(var l=0,u=0;u<n.length;u++){var h=i+l,c=h+n[u],p=new e.GeometryInstance({geometry:e.PolygonGeometry.fromPositions({positions:e.Cartesian3.fromDegreesArray(a),height:h,extrudedHeight:c,vertexFormat:e.EllipsoidSurfaceAppearance.VERTEX_FORMAT}),attributes:{color:e.ColorGeometryInstanceAttribute.fromColor(this.fillColor)},id:{tag:"GEO_SINGLEBUILDING",description:t.data,level:u+1}}),d=new e.ClassificationPrimitive({geometryInstances:p,classificationType:e.ClassificationType.BOTH});this.classificationPrimitiveCollection.add(d),l+=n[u]}}},t.prototype.activate=function(){var t=this;t.handler.setInputAction((function(i){var r=t.scene.pick(i.position);if(r&&r.id&&"GEO_SINGLEBUILDING"==r.id.tag){if(t.callback_click(r),t._INTERSECTED_FLOOR&&t._INTERSECTED_FLOOR!=r&&(t._INTERSECTED_FLOOR.primitive.getGeometryInstanceAttributes(t._INTERSECTED_FLOOR.id).color=e.ColorGeometryInstanceAttribute.toValue(t.fillColor)),t._INTERSECTED_FLOOR=r,t._INTERSECTED_FLOOR3){var o=t._INTERSECTED_FLOOR3._primitiveOptions.geometryInstances[0].id,n=t._INTERSECTED_FLOOR3.getGeometryInstanceAttributes(o);n.color.toString()==e.ColorGeometryInstanceAttribute.toValue(t.highlightColor_click).toString()&&(n.color=e.ColorGeometryInstanceAttribute.toValue(t.fillColor))}var a=t._INTERSECTED_FLOOR.primitive.getGeometryInstanceAttributes(t._INTERSECTED_FLOOR.id);if(a.color.toString()==e.ColorGeometryInstanceAttribute.toValue(t.highlightColor_click).toString())return;a.color=e.ColorGeometryInstanceAttribute.toValue(t.highlightColor_click)}}),e.ScreenSpaceEventType.LEFT_CLICK),t.handler.setInputAction((function(i){var r=t.scene.pick(i.endPosition);if(r&&r.id&&"GEO_SINGLEBUILDING"==r.id.tag){if(t.callback_move(r),t._INTERSECTED_FLOOR2&&t._INTERSECTED_FLOOR2!=r&&(t._INTERSECTED_FLOOR2.primitive.getGeometryInstanceAttributes(t._INTERSECTED_FLOOR2.id).color=e.ColorGeometryInstanceAttribute.toValue(t.fillColor)),t._INTERSECTED_FLOOR2=r,t._INTERSECTED_FLOOR){var o=t._INTERSECTED_FLOOR.primitive.getGeometryInstanceAttributes(t._INTERSECTED_FLOOR.id);o.color.toString()==e.ColorGeometryInstanceAttribute.toValue(t.fillColor).toString()&&(o.color=e.ColorGeometryInstanceAttribute.toValue(t.highlightColor_click))}var n=t._INTERSECTED_FLOOR2.primitive.getGeometryInstanceAttributes(t._INTERSECTED_FLOOR2.id);if(n.color.toString()==e.ColorGeometryInstanceAttribute.toValue(t.highlightColor_move).toString())return;n.color=e.ColorGeometryInstanceAttribute.toValue(t.highlightColor_move)}}),e.ScreenSpaceEventType.MOUSE_MOVE)},t.prototype.highlightFloor=function(t){var i=null;if(this.data&&this.data.geometry&&this._show&&(i=this.classificationPrimitiveCollection.get(t-1))){if(this._INTERSECTED_FLOOR3&&this._INTERSECTED_FLOOR3!=i){var r=this._INTERSECTED_FLOOR3._primitiveOptions.geometryInstances[0].id;this._INTERSECTED_FLOOR3.getGeometryInstanceAttributes(r).color=e.ColorGeometryInstanceAttribute.toValue(this.fillColor)}this._INTERSECTED_FLOOR3=i;var o=this._INTERSECTED_FLOOR3._primitiveOptions.geometryInstances[0].id;this._INTERSECTED_FLOOR3.getGeometryInstanceAttributes(o).color=e.ColorGeometryInstanceAttribute.toValue(this.highlightColor_click)}return i},t.prototype.clear=function(){this.classificationPrimitiveCollection.removeAll()},t.prototype.deActivate=function(){this.handler.removeInputAction(e.ScreenSpaceEventType.MOUSE_MOVE),this.handler.removeInputAction(e.ScreenSpaceEventType.LEFT_CLICK)},t.prototype.destroy=function(){this.clear(),this.classificationPrimitiveCollection.destroy(),this.classificationPrimitiveCollection=void 0,this.handler=this.handler&&this.handler.destroy(),this.viewer=void 0,this.data=void 0,this.fillColor=void 0,this.highlightColor_click=void 0,this.highlightColor_move=void 0,this._INTERSECTED_FLOOR=void 0,this._INTERSECTED_FLOOR2=void 0,this._INTERSECTED_FLOOR3=void 0}}(window.Cesium),(U=window.Cesium).FlyAround=function(e){this.viewer=e.viewer,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.heading=U.Math.toDegrees(this.camera.heading),this.pitch=U.Math.toDegrees(this.camera.pitch),this.dip_angle=U.Math.toRadians(-30),this.speed=e.speed,this.height=0,this.distance=0,this.isFlying=e.isFlying,this.deltaHeight=0,this.deltaRadians=U.Math.toRadians(1),this.deltaDistance=0,this.roll=0,this.keyEvent()},U.FlyAround.prototype.play=function(e,t){var i=this,r=this.camera.heading;this.scene.preRender.addEventListener((function(o,n){if(i.isFlying){i.heading=U.Math.toDegrees(o.camera.heading),i.pitch=U.Math.toDegrees(o.camera.pitch);var a=r+=U.Math.toRadians(i.speed);i.height=(t[2]+i.deltaHeight).toFixed(1),i.distance=(e+i.deltaDistance).toFixed(1),i.camera.setView({destination:U.Cartesian3.fromDegrees(t[0],t[1],t[2]+i.deltaHeight),orientation:{heading:a,pitch:i.dip_angle,roll:i.roll}}),i.camera.moveBackward(e+i.deltaDistance)}}))},U.FlyAround.prototype.pause=function(){this.viewer.scene.postRender.removeEventListener(this.play,this)},U.FlyAround.prototype.continue=function(){0!=this.viewer.entities._entities.length?(this.viewer.scene.postRender.removeEventListener(this.play,this),this.viewer.scene.postRender.addEventListener(this.play,this)):this.viewer.scene.postRender.removeEventListener(this.play,this)},U.FlyAround.prototype.stop=function(){this.viewer.scene.postRender.removeEventListener(this.play,this),this.viewer.entities.removeAll(),document.removeEventListener("keydown",this.keydownOption)},U.FlyAround.prototype.keyEvent=function(){var e=this;document.addEventListener("keydown",(function(t){switch(t.keyCode){case 40:t.shiftKey?e.deltaHeight-=10:(e.dip_angle-=e.deltaRadians,e.dip_angle<-U.Math.TWO_PI&&(e.dip_angle+=U.Math.TWO_PI));break;case 38:t.shiftKey?e.deltaHeight+=10:(e.dip_angle+=e.deltaRadians,e.dip_angle>-U.Math.TWO_PI&&(e.dip_angle-=U.Math.TWO_PI));break;case 39:t.shiftKey?(e.roll+=e.deltaRadians,e.roll>U.Math.TWO_PI&&(e.roll-=U.Math.TWO_PI)):e.deltaDistance-=50;break;case 37:t.shiftKey?(e.roll-=e.deltaRadians,e.roll<U.Math.TWO_PI&&(e.roll+=U.Math.TWO_PI)):e.deltaDistance+=50}}))},(F=window.Cesium).FreeFlight=function(e){this.viewer=e.viewer,this.direct=e.direct,this.pitch=e.pitch,this.roll=e.roll,this.height=e.height,this.speed=e.speed,this.lon=e.lon,this.lat=e.lat,this.planePrimitive=e.planePrimitive,this.hpRoll=e.hpRoll,this.fromBehind=e.fromBehind,this.isFlying=e.isFlying,this.position=e.position,this.fixedFrameTransform=e.fixedFrameTransform,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.pathPosition=new F.SampledPositionProperty,this.speedVector=new F.Cartesian3,this.center=new F.Cartesian3,this.hpRange=new F.HeadingPitchRange,this.deltaRadians=F.Math.toRadians(3),this.init(),this.keyEvent()},F.FreeFlight.prototype.init=function(){var e=this,t=this.scene.screenSpaceCameraController,i=0;this.planePrimitive.readyPromise.then((function(r){r.activeAnimations.addAll({speedup:.5,loop:F.ModelAnimationLoop.REPEAT}),i=2*Math.max(r.boundingSphere.radius,e.camera.frustum.near),t.minimumZoomDistance=.5*i,F.Matrix4.multiplyByPoint(r.modelMatrix,r.boundingSphere.center,e.center);var o=F.Math.toRadians(230),n=F.Math.toRadians(-20);e.hpRange.heading=o,e.hpRange.pitch=n,e.hpRange.range=50*i,e.camera.lookAt(e.center,e.hpRange)})),viewer.entities.add({position:this.pathPosition,name:"path",path:{show:!0,leadTime:0,trailTime:60,width:2,resolution:1,material:new F.PolylineGlowMaterialProperty({glowPower:.3,color:F.Color.PALEGOLDENROD})}})},F.FreeFlight.prototype.animation=function(){if(this.isFlying){this.direct=F.Math.toDegrees(this.hpRoll.heading).toFixed(1),this.pitch=F.Math.toDegrees(this.hpRoll.pitch).toFixed(1),this.roll=F.Math.toDegrees(this.hpRoll.roll).toFixed(1),this.speed=this.speed,this.speedVector=F.Cartesian3.multiplyByScalar(F.Cartesian3.UNIT_X,this.speed/10,this.speedVector);var e=F.Matrix4.multiplyByPoint(this.planePrimitive.modelMatrix,this.speedVector,this.position);this.pathPosition.addSample(F.JulianDate.now(),e),F.Transforms.headingPitchRollToFixedFrame(e,this.hpRoll,F.Ellipsoid.WGS84,this.fixedFrameTransform,this.planePrimitive.modelMatrix);var t=F.Cartographic.fromCartesian(e);this.lon=F.Math.toDegrees(t.longitude),this.lat=F.Math.toDegrees(t.latitude),this.height=t.height,this.fromBehind&&(F.Matrix4.multiplyByPoint(this.planePrimitive.modelMatrix,this.planePrimitive.boundingSphere.center,this.center),this.hpRange.heading=this.hpRoll.heading,this.hpRange.pitch=this.hpRoll.pitch,this.camera.lookAt(this.center,this.hpRange))}},F.FreeFlight.prototype.play=function(){this.viewer.scene.postRender.addEventListener(this.animation,this)},F.FreeFlight.prototype.pause=function(){this.viewer.scene.postRender.removeEventListener(this.animation,this)},F.FreeFlight.prototype.continue=function(){0!=this.viewer.entities._entities.length?(this.viewer.scene.postRender.removeEventListener(this.animation,this),this.viewer.scene.postRender.addEventListener(this.animation,this)):this.viewer.scene.postRender.removeEventListener(this.animation,this)},F.FreeFlight.prototype.stop=function(){this.viewer.scene.postRender.removeEventListener(this.animation,this),this.viewer.entities.removeAll(),this.scene.primitives.removeAll(),document.removeEventListener("keydown",this.keydownOption)},F.FreeFlight.prototype.keyEvent=function(){var e=this;document.addEventListener("keydown",(function(t){switch(t.keyCode){case 40:t.shiftKey?e.speed=Math.max(--e.speed,1):(e.hpRoll.pitch-=e.deltaRadians,e.hpRoll.pitch<-F.Math.TWO_PI&&(e.hpRoll.pitch+=F.Math.TWO_PI));break;case 38:t.shiftKey?e.speed=Math.min(++e.speed,100):(e.hpRoll.pitch+=e.deltaRadians,e.hpRoll.pitch>F.Math.TWO_PI&&(e.hpRoll.pitch-=F.Math.TWO_PI));break;case 39:t.shiftKey?(e.hpRoll.roll+=e.deltaRadians,e.hpRoll.roll>F.Math.TWO_PI&&(e.hpRoll.roll-=F.Math.TWO_PI)):(e.hpRoll.heading+=e.deltaRadians,e.hpRoll.heading>F.Math.TWO_PI&&(e.hpRoll.heading-=F.Math.TWO_PI));break;case 37:t.shiftKey?(e.hpRoll.roll-=e.deltaRadians,e.hpRoll.roll<0&&(e.hpRoll.roll+=F.Math.TWO_PI)):(e.hpRoll.heading-=e.deltaRadians,e.hpRoll.heading<0&&(e.hpRoll.heading+=F.Math.TWO_PI))}}))},(D=window.Cesium).RouteFly=function(e){this.viewer=e.viewer,this.cartographicArray=e.cartographicArray,this.pointArray=e.pointArray,this.start=e.start,this.stop=e.stop,this.speed=e.speed,this.deltaHeight=D.defaultValue(e.deltaHeight,10),this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.cartesian3=new D.Cartesian3(0,0,0),this.initialHeading=[],this.keydownOption=null,this.point=[],this.bearing=[],this.differentBearing=[],this.reduceBearing=[],this.HorizontalRadian=0,this.VerticalRadians=0,this.i=0,this.keyEvent()},D.RouteFly.prototype.init=function(){for(var e=0;e<this.pointArray.length;e++)this.point.push(turf.point(this.pointArray[e]));for(var t=0;t<this.point.length-1;t++)this.bearing.push(turf.bearing(this.point[t],this.point[t+1]));for(e=0;e<this.bearing.length;e++)this.initialHeading.push(D.Math.toRadians(this.bearing[e]));for(var i=0;i<this.bearing.length-1;i++)this.bearing[i+1]-this.bearing[i]<-180?(this.differentBearing.push(D.Math.toRadians(this.bearing[i+1]-this.bearing[i]+360)),this.reduceBearing.push(D.Math.toRadians(this.bearing[i+1]-this.bearing[i]+360))):180<this.bearing[i+1]-this.bearing[i]?(this.differentBearing.push(D.Math.toRadians(this.bearing[i+1]-this.bearing[i]-360)),this.reduceBearing.push(D.Math.toRadians(Math.abs(this.bearing[i+1]-this.bearing[i]-360)))):(this.differentBearing.push(D.Math.toRadians(this.bearing[i+1]-this.bearing[i])),this.reduceBearing.push(D.Math.toRadians(Math.abs(this.bearing[i+1]-this.bearing[i]))))},D.RouteFly.prototype.initializationFly=function(){this.viewer.clock.startTime=this.start.clone(),this.viewer.clock.stopTime=this.stop.clone(),this.viewer.clock.currentTime=this.start.clone(),this.viewer.clock.clockRange=D.ClockRange.CLAMPED},D.RouteFly.prototype.computeCirclularFlight=function(e){for(var t=new D.SampledPositionProperty,i=0;i<e.length;i++){var r=D.JulianDate.addSeconds(this.start,i,new D.JulianDate),o=D.Cartesian3.fromRadians(Number(e[i][0]),Number(e[i][1]),Number(e[i][2]));t.addSample(r,o),this.viewer.entities.add({position:o,point:{pixelSize:2,color:D.Color.TRANSPARENT,outlineColor:D.Color.YELLOW,outlineWidth:2}})}return t},D.RouteFly.prototype.animation=function(){if(this.cartographicArray){var e=this.computeCirclularFlight(this.cartographicArray),t=this.viewer.entities.add({availability:new D.TimeIntervalCollection([new D.TimeInterval({start:this.start,stop:this.stop})]),position:e});this.cartesian3=t.position.getValue(this.viewer.clock.currentTime);var i=this.scene.globe.ellipsoid;if(null==this.cartesian3)this.viewer.clock.multiplier=0,document.removeEventListener("keydown",this.keydownOption),this.viewer.scene.postRender.removeEventListener(this.animation);else{var r=i.cartesianToCartographic(this.cartesian3),o=Math.floor(1e5*D.Math.toDegrees(r.latitude))/1e5,n=Math.floor(1e5*D.Math.toDegrees(r.longitude))/1e5,a=(Math.floor(1e5*r.height),1e3*turf.distance(turf.point(this.pointArray[this.i+1]),turf.point([n,o,0]))),s=turf.distance(turf.point(this.pointArray[this.i]),turf.point(this.pointArray[this.i+1]));a<=1*(50+this.deltaHeight)/10?(this.camera.setView({destination:D.Cartesian3.fromDegrees(D.Math.toDegrees(this.cartographicArray[this.i+1][0]),D.Math.toDegrees(this.cartographicArray[this.i+1][1]),50+this.deltaHeight),orientation:{heading:this.initialHeading[this.i]+this.HorizontalRadian,pitch:D.Math.toRadians(0)+this.VerticalRadians,roll:0}}),this.viewer.clock.multiplier=0,this.i<this.reduceBearing.length?this.reduceBearing[this.i]<1e-5?(this.HorizontalRadian=0,this.i+=1,this.viewer.clock.multiplier=this.speed):(this.HorizontalRadian+=this.differentBearing[this.i]/200,this.reduceBearing[this.i]-=Math.abs(this.differentBearing[this.i]/200)):(this.viewer.clock.multiplier=0,document.removeEventListener("keydown",this.keydownOption),this.viewer.scene.postRender.removeEventListener(this.animation,this))):(this.camera.setView({destination:D.Cartesian3.fromDegrees(D.Math.toDegrees(r.longitude),D.Math.toDegrees(r.latitude),50+this.deltaHeight),orientation:{heading:this.initialHeading[this.i],pitch:D.Math.toRadians(0)+this.VerticalRadians,roll:0}}),this.viewer.clock.multiplier=1<s?this.speed*(1/s):this.speed*(1-s))}}},D.RouteFly.prototype.play=function(){this.initializationFly(),this.init(),this.scene.postRender.addEventListener(this.animation,this)},D.RouteFly.prototype.pause=function(){this.scene.postRender.removeEventListener(this.animation,this)},D.RouteFly.prototype.continue=function(){this.scene.postRender.removeEventListener(this.animation,this),this.scene.postRender.addEventListener(this.animation,this)},D.RouteFly.prototype.STOP=function(){this.scene.postRender.removeEventListener(this.animation,this),this.viewer.entities.removeAll(),document.removeEventListener("keydown",this.keydownOption),this.viewer=null,this.cartographicArray=null,this.pointArray=null,this.start=null,this.stop=null,this.speed=null,this.scene=null,this.camera=null,this.cartesian3=new D.Cartesian3(0,0,0),this.initialHeading=[],this.keydownOption=null,this.point=[],this.bearing=[],this.differentBearing=[],this.reduceBearing=[],this.deltaHeight=D.defaultValue(this.deltaHeight,10),this.HorizontalRadian=0,this.VerticalRadians=0,this.i=0},D.RouteFly.prototype.reset=function(e){this.viewer&&(this.scene.postRender.removeEventListener(this.animation,this),this.cartesian3=new D.Cartesian3(0,0,0),this.initialHeading=[],this.keydownOption=null,this.point=[],this.bearing=[],this.differentBearing=[],this.reduceBearing=[],this.deltaHeight=D.defaultValue(this.deltaHeight,10),this.HorizontalRadian=0,this.VerticalRadians=0,this.i=0,this.play())},D.RouteFly.prototype.keyEvent=function(){var e=this;this.keydownOption=function(t){switch(t.keyCode){case 40:t.shiftKey?e.deltaHeight-=1:e.VerticalRadians-=.01;break;case 38:t.shiftKey?e.deltaHeight+=1:e.VerticalRadians+=.01}},document.addEventListener("keydown",this.keydownOption)},(O=window.Cesium).WalkBrowse=function(e){this.viewer=e.viewer,this.pointArray=e.pointArray,this.orientationAngle=[],this.point1=turf.point(this.pointArray[0]),this.point2=turf.point(this.pointArray[1]),this.point3=turf.point(this.pointArray[2]),this.bearing1=turf.bearing(this.point1,this.point2),this.bearing2=turf.bearing(this.point2,this.point3),this.drawMarker(),this.init()},O.WalkBrowse.prototype.animation=function(){var e=this.viewer.scene.globe.ellipsoid,t=this.viewer.camera.position,i=e.cartesianToCartographic(t),r=Math.floor(1e5*O.Math.toDegrees(i.latitude))/1e5,o=Math.floor(1e5*O.Math.toDegrees(i.longitude))/1e5;o==this.pointArray[1][0]&&r==this.pointArray[1][1]?(this.orientationAngle.push(O.Math.toDegrees(this.viewer.camera.heading)),1e-12<=this.bearing2-O.Math.toDegrees(this.viewer.camera.heading)?(this.viewer.camera.moveForward(0),this.viewer.camera.lookRight(O.Math.toRadians((this.bearing2-this.orientationAngle[0])/200))):(this.orientationAngle=[],this.viewer.camera.setView({destination:O.Cartesian3.fromDegrees(this.pointArray[1][0],this.pointArray[1][1],this.pointArray[1][2]),orientation:{heading:O.Math.toRadians(this.bearing2),pitch:O.Math.toRadians(0)}}),this.viewer.camera.moveForward(this.viewer.clock.multiplier))):-1e-5<o-this.pointArray[2][0]&&-1e-5<r-this.pointArray[2][1]?this.viewer.camera.moveForward(0):this.viewer.camera.moveForward(this.viewer.clock.multiplier)},O.WalkBrowse.prototype.init=function(){this.viewer.camera.setView({destination:O.Cartesian3.fromDegrees(this.pointArray[0][0],this.pointArray[0][1],this.pointArray[0][2]),orientation:{heading:O.Math.toRadians(this.bearing1),pitch:O.Math.toRadians(0)}})},O.WalkBrowse.prototype.drawMarker=function(){this.viewer.entities.add({position:O.Cartesian3.fromDegrees(this.pointArray[1][0],this.pointArray[1][1]),point:{pixelSize:2,color:O.Color.TRANSPARENT,outlineColor:O.Color.YELLOW,outlineWidth:2}}),this.viewer.entities.add({position:O.Cartesian3.fromDegrees(this.pointArray[2][0],this.pointArray[2][1]),point:{pixelSize:2,color:O.Color.TRANSPARENT,outlineColor:O.Color.RED,outlineWidth:2}})},O.WalkBrowse.prototype.play=function(){0==this.viewer.entities._entities.length&&this.drawMarker(),this.viewer.scene.postRender.removeEventListener(this.animation,this),this.viewer.camera.setView({destination:O.Cartesian3.fromDegrees(this.pointArray[0][0],this.pointArray[0][1],this.pointArray[0][2]),orientation:{heading:O.Math.toRadians(this.bearing1),pitch:O.Math.toRadians(0)}}),this.viewer.scene.postRender.addEventListener(this.animation,this)},O.WalkBrowse.prototype.pause=function(){this.viewer.scene.postRender.removeEventListener(this.animation,this)},O.WalkBrowse.prototype.continue=function(){0!=this.viewer.entities._entities.length?(this.viewer.scene.postRender.removeEventListener(this.animation,this),this.viewer.scene.postRender.addEventListener(this.animation,this)):this.viewer.scene.postRender.removeEventListener(this.animation,this)},O.WalkBrowse.prototype.stop=function(){this.viewer.scene.postRender.removeEventListener(this.animation,this),this.viewer.entities.removeAll(),this.init()},function(e){var t=e.GeoCylinderApertureSpreadEffect=function(t){t=t||{},this._center=e.Cartesian3.fromRadians(t.center.longitude,t.center.latitude,t.center.height),this._maxRadius=t.radius,this._height=t.height,this._drawCommandAlpha=null,this._drawCommandOpaque=null,this._needUpdate=!1,this._va=null,this._boundingVolume=null,this._color=t.color?t.color.clone():new e.Color(.5,.8,1,1),this._speed=t.speed?t.speed:1,this._speed*=4,this._actived=!t.actived||t.actived,this._time=0,this._lastTime=0,this._life=this._maxRadius/this._speed,this._hSpeed=2*this._height/this._life,this._modelTransform=null,this._metallicFactor=t.metallicFactor?t.metallicFactor:.115,this._roughnessFactor=t.roughnessFactor?t.roughnessFactor:.918,this._emissiveFactor=t.emissiveFactor?t.emissiveFactor.clone():new e.Cartesian3(.6,.6,.6),this._initTransform()};e.defineProperties(t.prototype,{actived:{get:function(){return this._actived},set:function(e){this._actived=e}}}),t.prototype._initTransform=function(){this._modelTransform=e.Transforms.eastNorthUpToFixedFrame(this._center)},t.prototype.update=function(e){if(this._actived&&(this._updateTime(),this._fetchGeometry(e),this._updateCommands(e),this._drawCommandAlpha&&this._va)){var t=e.commandList;t.push(this._drawCommandAlpha),t.push(this._drawCommandOpaque)}},t.prototype.destroy=function(){this._actived=!1,this._va&&(this._va.destroy(),this._va=null),this._drawCommandAlpha&&(this._drawCommandAlpha.vertexArray=null,this._drawCommandAlpha.shaderProgram&&(this._drawCommandAlpha.shaderProgram.destroy(),this._drawCommandAlpha.shaderProgram=null),this._drawCommandAlpha.owner=null,this._drawCommandAlpha=null),this._drawCommandOpaque&&(this._drawCommandOpaque.vertexArray=null,this._drawCommandOpaque.shaderProgram&&(this._drawCommandOpaque.shaderProgram.destroy(),this._drawCommandOpaque.shaderProgram=null),this._drawCommandOpaque.owner=null,this._drawCommandOpaque=null)},t.prototype._fetchGeometry=function(e){this._updateVA(e)},t.prototype._updateTime=function(){this._time>=this._life&&(this._time=0);var t=e.getTimestamp()/1e3;0<this._lastTime?(this._time+=t-this._lastTime,this._lastTime=t,this._time>this._life&&(this._time=this._life)):this._lastTime=t},t.prototype._updateCommands=function(e){this._updateAlphaCommand(e),this._updateOpaqueCommand(e)},t.prototype._updateAlphaCommand=function(t){var s=t.context,l=this;if(!this._drawCommandAlpha){var u=this._drawCommandAlpha=new e.DrawCommand;u.pass=e.Pass.TRANSLUCENT,u.owner=this,u.modelMatrix=this._modelTransform,u.renderState=e.RenderState.fromCache({cull:{enabled:!1},depthTest:{enabled:!0,func:e.WebGLConstants.LEQUAL},depthMask:!1,blending:e.BlendingState.ALPHA_BLEND}),u.shaderProgram=e.ShaderProgram.fromCache({context:s,defines:["HDR"],vertexShaderSource:n,fragmentShaderSource:a,attributeLocations:{aPoint:0,aNormal:1,aT:2}}),u.uniformMap={u_color:function(){return l._color},u_metallicFactor:function(){return l._metallicFactor},u_roughnessFactor:function(){return l._roughnessFactor},u_emissiveFactor:function(){return l._emissiveFactor},u_normalMatrix:function(){return e.Matrix4.multiplyTransformation(t.camera.viewMatrix,l._modelTransform,i),e.Matrix4.inverse(i,r),e.Matrix4.getRotation(r,o),e.Matrix3.transpose(o,o)}}}this._drawCommandAlpha.vertexArray=this._va};var i=new e.Matrix4,r=new e.Matrix4,o=new e.Matrix3;t.prototype._updateOpaqueCommand=function(t){var a=t.context,l=this;if(!this._drawCommandOpaque){var u=this._drawCommandOpaque=new e.DrawCommand;u.pass=e.Pass.OPAQUE,u.owner=this,u.modelMatrix=this._modelTransform,u.renderState=e.RenderState.fromCache({cull:{enabled:!1},depthTest:{enabled:!0,func:e.WebGLConstants.LEQUAL},depthMask:!1}),u.shaderProgram=e.ShaderProgram.fromCache({context:a,defines:["HDR"],vertexShaderSource:n,fragmentShaderSource:s,attributeLocations:{aPoint:0,aNormal:1,aT:2}}),u.uniformMap={u_color:function(){return l._color},u_metallicFactor:function(){return l._metallicFactor},u_roughnessFactor:function(){return l._roughnessFactor},u_emissiveFactor:function(){return l._emissiveFactor},u_normalMatrix:function(){return e.Matrix4.multiplyTransformation(t.camera.viewMatrix,l._modelTransform,i),e.Matrix4.inverse(i,r),e.Matrix4.getRotation(r,o),e.Matrix3.transpose(o,o)}}}this._drawCommandOpaque.vertexArray=this._va},t.prototype._updateVA=function(t){this._va&&(this._va.destroy(),this._va=null);var i=e.Math.TWO_PI,r=this._time*this._speed;if(!(r<1e-5)){var o=0;if(this._time/this._life<.5)o=this._hSpeed*this._time;else{var n=this._life-this._time;o=this._hSpeed*n}var a=this._computeStepCount(r);if(!(o<1e-5)){for(var s,l,u,h,c=t.context,p=i/a,d=2*a,f=3*d,g=e.ComponentDatatype.createTypedArray(e.ComponentDatatype.FLOAT,3*d),m=e.ComponentDatatype.createTypedArray(e.ComponentDatatype.FLOAT,3*d),_=e.ComponentDatatype.createTypedArray(e.ComponentDatatype.FLOAT,d),v=e.ComponentDatatype.createTypedArray(e.ComponentDatatype.UNSIGNED_SHORT,f),C=0,y=0,A=0,I=0,b=0;b<a;b++)s=b*p,l=r*Math.cos(s),u=r*Math.sin(s),h=0,g[C++]=l,g[C++]=u,g[C++]=h,m[y++]=l,m[y++]=u,m[y++]=0,_[A++]=0,h=o,g[C++]=l,g[C++]=u,g[C++]=h,m[y++]=l,m[y++]=u,m[y++]=0,v[I++]=2*b,v[I++]=(b+1)%a*2,v[I++]=2*b+1,v[I++]=2*b+1,v[I++]=(b+1)%a*2,v[I++]=(b+1)%a*2+1,_[A++]=1;var w=e.Buffer.createVertexBuffer({context:c,typedArray:g,usage:e.BufferUsage.STATIC_DRAW}),E=[];E.push({index:0,vertexBuffer:w,componentsPerAttribute:3,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:12,normalize:!1});var G=e.Buffer.createVertexBuffer({context:c,typedArray:m,usage:e.BufferUsage.STATIC_DRAW});E.push({index:1,vertexBuffer:G,componentsPerAttribute:3,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:12,normalize:!1});var S=e.Buffer.createVertexBuffer({context:c,typedArray:_,usage:e.BufferUsage.STATIC_DRAW});E.push({index:2,vertexBuffer:S,componentsPerAttribute:1,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:4,normalize:!1});var P=e.Buffer.createIndexBuffer({context:c,typedArray:v,usage:e.BufferUsage.STATIC_DRAW,indexDatatype:e.IndexDatatype.UNSIGNED_SHORT});this._va=new e.VertexArray({context:c,attributes:E,indexBuffer:P}),this._updateBoundingVolume(r,o)}}},t.prototype._computeStepCount=function(t){var i=10<t?1/t:.1,r=2*Math.asin(i);return Math.round(e.Math.TWO_PI/r)},t.prototype._updateBoundingVolume=function(t,i){var r=Math.sqrt(t*t+i+i);this._boundingVolume=new e.BoundingSphere(e.Cartesian3.ZERO,r+1),e.BoundingSphere.transform(this._boundingVolume,this._modelTransform,this._boundingVolume)};var n="attribute vec3 aPoint;\nattribute vec3 aNormal;\nattribute float aT;\nuniform mat3 u_normalMatrix;\nvarying vec3 v_normalEC;\nvarying vec3 v_positionEC;\nvarying float v_t;\nvoid main(){\n   v_positionEC = (czm_modelViewRelativeToEye * vec4(aPoint, 1.0)).xyz;\n   v_normalEC = u_normalMatrix * aNormal;\n   gl_Position = czm_modelViewProjection * vec4(aPoint, 1.0);\n   v_t = aT;\n}",a="uniform vec4 u_color;\nuniform float u_metallicFactor;\nuniform float u_roughnessFactor;\nuniform vec3 u_emissiveFactor;\nvarying vec3 v_normalEC;\nvarying vec3 v_positionEC;\nvarying float v_t;\nconst float M_PI = 3.141592653589793;\nvec3 fresnelSchlick2(vec3 f0, vec3 f90, float VdotH) \n{\n    return f0 + (f90 - f0) * pow(clamp(1.0 - VdotH, 0.0, 1.0), 5.0);\n}\nfloat smithVisibilityG1(float NdotV, float roughness) \n{\n    float k = (roughness + 1.0) * (roughness + 1.0) / 8.0;\n    return NdotV / (NdotV * (1.0 - k) + k);\n}\nfloat smithVisibilityGGX(float roughness, float NdotL, float NdotV) \n{\n    return smithVisibilityG1(NdotL, roughness) * smithVisibilityG1(NdotV, roughness);\n}\nfloat GGX(float roughness, float NdotH) \n{\n    float roughnessSquared = roughness * roughness;\n    float f = (NdotH * roughnessSquared - NdotH) * NdotH + 1.0;\n    return roughnessSquared / (M_PI * f * f);\n}\nvec3 lambertianDiffuse(vec3 diffuseColor) \n{\n    return diffuseColor / M_PI;\n}\nvec3 LINEARtoSRGB(vec3 linearIn) \n{\n#ifndef HDR \n    return pow(linearIn, vec3(1.0/2.2));\n#else \n    return linearIn;\n#endif \n}\nvoid main(){\n   vec3 n = normalize(v_normalEC);\n   if (!gl_FrontFacing){\n       n = -n;\n   }\n   vec4 baseColorWithAlpha = u_color;\n   if (v_t > 0.5){       baseColorWithAlpha.a = (2.0 - v_t * 2.0);\n   }\n   else{\n       baseColorWithAlpha.a = 1.0;\n   }\n   vec3 baseColor = baseColorWithAlpha.rgb;\n   float metalness = clamp(u_metallicFactor, 0.0, 1.0);\n   float roughness = clamp(u_roughnessFactor, 0.04, 1.0);\n   vec3 v = -normalize(v_positionEC);\n   vec3 lightColor = vec3(1.5, 1.4, 1.2);\n   vec3 l = normalize(czm_sunDirectionEC);\n   vec3 h = normalize(v + l);\n   float NdotL = clamp(dot(n, l), 0.001, 1.0);\n   float NdotV = abs(dot(n, v)) + 0.001;\n   float NdotH = clamp(dot(n, h), 0.0, 1.0);\n   float LdotH = clamp(dot(l, h), 0.0, 1.0);\n   float VdotH = clamp(dot(v, h), 0.0, 1.0);\n   vec3 f0 = vec3(0.04);\n   vec3 diffuseColor = baseColor * (1.0 - metalness) * (1.0 - f0);\n   vec3 specularColor = mix(f0, baseColor, metalness);\n   float alpha = roughness * roughness;\n   float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);\n   vec3 r90 = vec3(clamp(reflectance * 25.0, 0.0, 1.0));\n   vec3 r0 = specularColor.rgb;\n   vec3 F = fresnelSchlick2(r0, r90, VdotH);\n   float G = smithVisibilityGGX(alpha, NdotL, NdotV);\n   float D = GGX(alpha, NdotH);\n   vec3 diffuseContribution = (1.0 - F) * lambertianDiffuse(diffuseColor);\n   vec3 specularContribution = F * G * D / (4.0 * NdotL * NdotV);\n   vec3 color = NdotL * lightColor * (diffuseContribution + specularContribution);\n   color += u_emissiveFactor;\n   color = LINEARtoSRGB(color);\n   gl_FragColor = vec4(color, baseColorWithAlpha.a);\n}",s="uniform vec4 u_color;\nuniform float u_metallicFactor;\nuniform float u_roughnessFactor;\nuniform vec3 u_emissiveFactor;\nvarying vec3 v_normalEC;\nvarying vec3 v_positionEC;\nvarying float v_t;\nconst float M_PI = 3.141592653589793;\nvec3 fresnelSchlick2(vec3 f0, vec3 f90, float VdotH) \n{\n    return f0 + (f90 - f0) * pow(clamp(1.0 - VdotH, 0.0, 1.0), 5.0);\n}\nfloat smithVisibilityG1(float NdotV, float roughness) \n{\n    float k = (roughness + 1.0) * (roughness + 1.0) / 8.0;\n    return NdotV / (NdotV * (1.0 - k) + k);\n}\nfloat smithVisibilityGGX(float roughness, float NdotL, float NdotV) \n{\n    return smithVisibilityG1(NdotL, roughness) * smithVisibilityG1(NdotV, roughness);\n}\nfloat GGX(float roughness, float NdotH) \n{\n    float roughnessSquared = roughness * roughness;\n    float f = (NdotH * roughnessSquared - NdotH) * NdotH + 1.0;\n    return roughnessSquared / (M_PI * f * f);\n}\nvec3 lambertianDiffuse(vec3 diffuseColor) \n{\n    return diffuseColor / M_PI;\n}\nvec3 LINEARtoSRGB(vec3 linearIn) \n{\n#ifndef HDR \n    return pow(linearIn, vec3(1.0/2.2));\n#else \n    return linearIn;\n#endif \n}\nvoid main(){\n   if (v_t > 0.5){discard;}\n   vec3 n = normalize(v_normalEC);\n   if (!gl_FrontFacing){\n       n = -n;\n   }\n   vec4 baseColorWithAlpha = u_color;\n   baseColorWithAlpha.a = 1.0;\n   vec3 baseColor = baseColorWithAlpha.rgb;\n   float metalness = clamp(u_metallicFactor, 0.0, 1.0);\n   float roughness = clamp(u_roughnessFactor, 0.04, 1.0);\n   vec3 v = -normalize(v_positionEC);\n   vec3 lightColor = vec3(1.5, 1.4, 1.2);\n   vec3 l = normalize(czm_sunDirectionEC);\n   vec3 h = normalize(v + l);\n   float NdotL = clamp(dot(n, l), 0.001, 1.0);\n   float NdotV = abs(dot(n, v)) + 0.001;\n   float NdotH = clamp(dot(n, h), 0.0, 1.0);\n   float LdotH = clamp(dot(l, h), 0.0, 1.0);\n   float VdotH = clamp(dot(v, h), 0.0, 1.0);\n   vec3 f0 = vec3(0.04);\n   vec3 diffuseColor = baseColor * (1.0 - metalness) * (1.0 - f0);\n   vec3 specularColor = mix(f0, baseColor, metalness);\n   float alpha = roughness * roughness;\n   float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);\n   vec3 r90 = vec3(clamp(reflectance * 25.0, 0.0, 1.0));\n   vec3 r0 = specularColor.rgb;\n   vec3 F = fresnelSchlick2(r0, r90, VdotH);\n   float G = smithVisibilityGGX(alpha, NdotL, NdotV);\n   float D = GGX(alpha, NdotH);\n   vec3 diffuseContribution = (1.0 - F) * lambertianDiffuse(diffuseColor);\n   vec3 specularContribution = F * G * D / (4.0 * NdotL * NdotV);\n   vec3 color = NdotL * lightColor * (diffuseContribution + specularContribution);\n   color += u_emissiveFactor;\n   color = LINEARtoSRGB(color);\n   gl_FragColor = vec4(color, baseColorWithAlpha.a);\n}"}(window.Cesium),function(e){var t=e.GeoHeatMap=function(t,i){return this.viewer=t.viewer,this.heatmapOptions=t.heatmapOptions,this.dataOptions=t.dataOptions,this.defaults={minCanvasSize:700,maxCanvasSize:2e3,useEntities:!0,radiusFactor:60,spacingFactor:1.5,maxOpacity:.8,minOpacity:.1,blur:.85,gradient:{.3:"blue",.65:"yellow",.8:"orange",.95:"red"}},this.heatmapOptions.useEntities=e.defaultValue(this.heatmapOptions.useEntities,this.defaults.useEntities),this.heatmapOptions.gradient=e.defaultValue(this.heatmapOptions.gradient,this.defaults.gradient),this.heatmapOptions.maxOpacity=e.defaultValue(this.heatmapOptions.maxOpacity,this.defaults.maxOpacity),this.heatmapOptions.minOpacity=e.defaultValue(this.heatmapOptions.minOpacity,this.defaults.minOpacity),this.heatmapOptions.blur=e.defaultValue(this.heatmapOptions.blur,this.defaults.blur),this};t.prototype._computeBounds=function(e){if(e&&e.features&&0<e.features.length&&e.features[0].geometry&&e.features[0].geometry.coordinates){for(var t={west:e.features[0].geometry.coordinates[0],south:e.features[0].geometry.coordinates[1],east:e.features[0].geometry.coordinates[0],north:e.features[0].geometry.coordinates[1]},i=0;i<e.features.length;i++){var r=e.features[i].geometry.coordinates[0],o=e.features[i].geometry.coordinates[1];t.west=r>t.west?t.west:r,t.east=r>t.east?r:t.east,t.south=o>t.south?t.south:o,t.north=o>t.north?o:t.north}return t}return!1},t.prototype._getContainer=function(e,t,i){var r=document.createElement("div");return i&&r.setAttribute("id",i),r.setAttribute("style","width: "+e+"px; height: "+t+"px; margin: 0px; display: none;"),document.body.appendChild(r),r},t.prototype._getImageryProvider=function(t){var i=t._heatmap.getDataURL(),r=new e.SingleTileImageryProvider({url:i,rectangle:t._rectangle});return r._tilingScheme=new e.WebMercatorTilingScheme({rectangleSouthwestInMeters:new e.Cartesian2(t._mbounds.west,t._mbounds.south),rectangleNortheastInMeters:new e.Cartesian2(t._mbounds.east,t._mbounds.north)}),r},t.prototype._getID=function(e){for(var t="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<(e||8);r++)t+=i.charAt(Math.floor(Math.random()*i.length));return t};var i=new e.WebMercatorProjection;t.prototype.wgs84ToMercator=function(t){var r=i.project(e.Cartographic.fromDegrees(t.x,t.y));return{x:r.x,y:r.y}},t.prototype.wgs84ToMercatorBB=function(t){var r=i.project(e.Cartographic.fromDegrees(t.west,t.south)),o=i.project(e.Cartographic.fromDegrees(t.east,t.north));return{north:o.y,east:o.x,south:r.y,west:r.x}},t.prototype.mercatorToWgs84=function(t){var r=i.unproject(new e.Cartesian3(t.x,t.y));return{x:r.longitude,y:r.latitude}},t.prototype.mercatorToWgs84BB=function(t){var r=i.unproject(new e.Cartesian3(t.west,t.south)),o=i.unproject(new e.Cartesian3(t.east,t.north));return{north:this.rad2deg(o.latitude),east:this.rad2deg(o.longitude),south:this.rad2deg(r.latitude),west:this.rad2deg(r.longitude)}},t.prototype.deg2rad=function(e){return e*(Math.PI/180)},t.prototype.rad2deg=function(e){return e/(Math.PI/180)},t.prototype.wgs84PointToHeatmapPoint=function(e){return this.mercatorPointToHeatmapPoint(this.wgs84ToMercator(e))},t.prototype.mercatorPointToHeatmapPoint=function(e){var t={};return t.x=Math.round((e.x-this._xoffset)/this._factor+this._spacing),t.y=Math.round((e.y-this._yoffset)/this._factor+this._spacing),t.y=this.height-t.y,t},t.prototype._setWidthAndHeight=function(e){this.width=0<e.east&&e.west<0?e.east+Math.abs(e.west):Math.abs(e.east-e.west),this.height=0<e.north&&e.south<0?e.north+Math.abs(e.south):Math.abs(e.north-e.south),this._factor=1,this.width>this.height&&this.width>this.defaults.maxCanvasSize?(this._factor=this.width/this.defaults.maxCanvasSize,this.height/this._factor<this.defaults.minCanvasSize&&(this._factor=this.height/this.defaults.minCanvasSize)):this.height>this.width&&this.height>this.defaults.maxCanvasSize?(this._factor=this.height/this.defaults.maxCanvasSize,this.width/this._factor<this.defaults.minCanvasSize&&(this._factor=this.width/this.defaults.minCanvasSize)):this.width<this.height&&this.width<this.defaults.minCanvasSize?(this._factor=this.width/this.defaults.minCanvasSize,this.height/this._factor>this.defaults.maxCanvasSize&&(this._factor=this.height/this.defaults.maxCanvasSize)):this.height<this.width&&this.height<this.defaults.minCanvasSize&&(this._factor=this.height/this.defaults.minCanvasSize,this.width/this._factor>this.defaults.maxCanvasSize&&(this._factor=this.width/this.defaults.maxCanvasSize)),this.width=this.width/this._factor,this.height=this.height/this._factor},t.prototype.setData=function(t,i,r){if(this._id=this._getID(),this._initBounds=this._computeBounds(r),this._mbounds=this.wgs84ToMercatorBB(this._initBounds),this._setWidthAndHeight(this._mbounds),this.heatmapOptions.radius=Math.round(this.heatmapOptions.radius?this.heatmapOptions.radius:this.width>this.height?this.width/this.defaults.radiusFactor:this.height/this.defaults.radiusFactor),this._spacing=this.heatmapOptions.radius*this.defaults.spacingFactor,this._xoffset=this._mbounds.west,this._yoffset=this._mbounds.south,this.width=Math.round(this.width+2*this._spacing),this.height=Math.round(this.height+2*this._spacing),this._mbounds.west-=this._spacing*this._factor,this._mbounds.east+=this._spacing*this._factor,this._mbounds.south-=this._spacing*this._factor,this._mbounds.north+=this._spacing*this._factor,this.bounds=this.mercatorToWgs84BB(this._mbounds),this._rectangle=e.Rectangle.fromDegrees(this.bounds.west,this.bounds.south,this.bounds.east,this.bounds.north),this._container?(this._id&&this._container.setAttribute("id",this._id),this._container.setAttribute("style","width: "+this.width+"px; height: "+this.height+"px; margin: 0px; display: none;")):this._container=this._getContainer(this.width,this.height,this._id),this.heatmapOptions.container=this._container,this._heatmap?this._heatmap.repaint():this._heatmap=h337.create(this.heatmapOptions),this._container.children[0].setAttribute("id",this._id+"-hm"),r&&0<r.features.length&&null!==t&&!1!==t&&null!==i&&!1!==i){for(var o=[],n=0;n<r.features.length;n++){var a={};a.x=r.features[n].geometry.coordinates[0],a.y=r.features[n].geometry.coordinates[1],a.value=r.features[n].properties.z,o.push(a)}for(var s=[],l=0;l<o.length;l++){var u=o[l],h=this.wgs84PointToHeatmapPoint(u);!u.value&&0!==u.value||(h.value=u.value),s.push(h)}return this._heatmap.setData({min:t,max:i,data:s}),this.updateLayer(),!0}return!1},t.prototype.show=function(e){this._layer&&(this._layer.show=e)},t.prototype.remove=function(){this._layer&&(this.viewer.scene.imageryLayers.remove(this._layer),this.viewer.entities.remove(this._layer))},t.prototype.updateLayer=function(){if(this.heatmapOptions.useEntities&&this.viewer.entities){this._layer&&this.viewer.entities.remove(this._layer);var t=new e.ImageMaterialProperty({image:this._heatmap._renderer.canvas});"1.21"<=e.VERSION?t.transparent=!0:"1.16"<=e.VERSION&&(t.alpha=.99),this._layer=this.viewer.entities.add({show:!0,rectangle:{coordinates:this._rectangle,material:t}})}else this._layer&&this.viewer.scene.imageryLayers.remove(this._layer),this._layer=this.viewer.scene.imageryLayers.addImageryProvider(this._getImageryProvider(this))}}(window.Cesium),function(e){function t(){this._position=null,this._actived=!1,this._speed=0,this._direction=null,this._baseScale=1,this._life=0,this._time=0,this._mode=0}t.prototype.active=function(){this._actived=!0,this._time=0},t.prototype.update=function(e){this._actived&&(this._time+=e,this._time>this._life&&(this._actived=!1))},e.defineProperties(t.prototype,{position:{get:function(){return this._position},set:function(e){e&&(this._position=e.clone(this._position))}},direction:{get:function(){return this._direction},set:function(e){e&&(this._direction=e.clone(this._direction))}},actived:{get:function(){return this._actived}},speed:{get:function(){return this._speed},set:function(e){this._speed=e}},baseScale:{get:function(){return this._baseScale},set:function(e){this._baseScale=e}},life:{get:function(){return this._life},set:function(e){this._life=e}},time:{get:function(){return this._time}},mode:{get:function(){return this._mode},set:function(e){this._mode=e}}});var i=new e.Cartesian3,r=e.GeoLineFireEffect=function(t){t=t||{},this._url=t.url?e.buildModuleUrl(t.url):null,this._url_1=t.urlTop?e.buildModuleUrl(t.urlTop):null,this._explode=t.explode?t.explode:0,this._positions=[],this._scene=t.viewer.scene,this._clock=viewer.clock;var i=t.scale?t.scale:1;this._startScale=2*i,this._endScale=.1*i,this._imageSize=1*i,this._startColor=new e.Color(1,1,1,1),this._endColor=new e.Color(.8,0,0,.01),t.smoking&&(this._endColor.red=1-t.smoking);var r=t.life?t.life:1;this._minLife=.5*r,this._maxLife=2*r;var o=t.speed?t.speed:1;if(this._minSpeed=7*o,this._maxSpeed=20*o,this._count=t.count?t.count:0,this._radius=t.radius?t.radius:1,this._grow=t.grow?t.grow:4,this._fires=[],this._texture_0=null,this._texture_1=null,this._drawCommand=null,this._pointsArray=null,this._directionsArray=null,this._speedScaleLifeTimesArray=null,this._needUpdate=!0,this._preTime=0,this._time=0,this._loadTexture(),this._initFires(this._count),t.positions&&t.positions.length)for(var n=t.positions,a=0;a<n.length;a++)this.addPosition(n[a])};e.defineProperties(r.prototype,{explode:{get:function(){return this._explode},set:function(e){this._explode=e}},scale:{get:function(){return this._imageSize},set:function(e){this._startScale=2*e,this._endScale=.1*e,this._imageSize=1*e}},life:{get:function(){return this._maxLife/2},set:function(e){this._minLife=.5*e,this._maxLife=2*e}},speed:{get:function(){return this._maxSpeed/20},set:function(e){this._minSpeed=7*e,this._maxSpeed=20*e}},radius:{get:function(){return this._radius},set:function(e){this._radius=e}},grow:{get:function(){return this._grow},set:function(e){this._grow=e}},pntsCount:{get:function(){return this._positions.length}},smoking:{get:function(){return 1-this._endColor.red},set:function(e){this._endColor.red=1-e}}}),r.prototype.addPosition=function(t){if(t&&void 0!==t.longitude){t=e.Cartesian3.fromRadians(t.longitude,t.latitude,t.height);var r=10,o=this._positions.length;if(0<o){var n=this._positions[o-1];i=e.Cartesian3.subtract(t,n,i),r=e.Cartesian3.magnitude(i)}r<.5||(this._positions.push(t.clone()),this._growFires(this._grow,r))}},r.prototype.destroy=function(){this._scene=null,this._clock=null,this._drawCommand&&(this._drawCommand.vertexArray&&(this._drawCommand.vertexArray.destroy(),this._drawCommand.vertexArray=null),this._drawCommand.shaderProgram&&(this._drawCommand.shaderProgram.destroy(),this._drawCommand.shaderProgram=null),this._drawCommand._owner=null,this._drawCommand=null),this._texture_0&&(this._texture_0.destroy(),this._texture_0=null),this._texture_1&&(this._texture_1.destroy(),this._texture_1=null),this._fires.length=0,this._positions.length=0,this._pointsArray=null,this._directionsArray=null,this._speedScaleLifeTimesArray=null},r.prototype._loadTexture=function(){var t=this,i=t._scene.frameState.context;this._url&&e.Resource.fetchImage(this._url).then((function(r){t._texture_0=new e.Texture({context:i,source:r},(function(e){}))})),this._url_1&&e.Resource.fetchImage(this._url_1).then((function(r){t._texture_1=new e.Texture({context:i,source:r},(function(e){}))}))},r.prototype._emissionPosition=function(){var t=this._positions.length;if(t<1)return null;if(t<2)return this._positions[0].clone(i),i.x+=e.Math.randomBetween(0,1)*this._radius,i.y+=e.Math.randomBetween(0,1)*this._radius,i.z+=e.Math.randomBetween(0,1)*this._radius,i;var r=e.Math.randomBetween(0,t-1);r=Math.floor(r);var o=this._positions[r],n=this._positions[r+1],a=e.Math.randomBetween(0,1);return i=e.Cartesian3.lerp(o,n,a,i)},r.prototype._initFires=function(e){if(e&&!(e<1))for(var i=0;i<e;i++){var r=new t;this._fires.push(r)}},r.prototype._growFires=function(e,i){e=Math.round(e*i),this._count+=e;for(var r=0;r<e;r++){var o=new t;this._fires.push(o)}},r.prototype._initFire=function(t){return t.position=this._emissionPosition(),t.position&&(t.direction=e.Cartesian3.normalize(t.position,new e.Cartesian3)),t.speed=e.Math.randomBetween(this._minSpeed,this._maxSpeed),t.life=e.Math.randomBetween(this._minLife,this._maxLife),t.baseScale=e.Math.randomBetween(.5,5),(t.mode=0)<this._explode&&e.Math.randomBetween(0,1)>1-this._explode&&(t.mode=1,t.baseScale*=1.2,t.life*=.2,t.speed*=2),null!=t.position},r.prototype._updateFire=function(e){e.update(this._time),e.actived||this._initFire(e)&&e.active()},r.prototype._updateTime=function(t){var i;if(i=this._clock.shouldAnimate?t.time.secondsOfDay:e.getTimestamp()/1e3,0==this._preTime)this._preTime=i;else{var r=i-this._preTime;r>this._maxLife&&(r=this._maxLife),this._time=r,this._preTime=i}},r.prototype.update=function(e){this._updateTime(e);var t=this._count;if(!(t<1||t!=this._fires.length||this._positions.length<1)&&this._texture_0){if(this._needUpdate){for(var i=0;i<t;i++){var r=this._fires[i];this._updateFire(r)}this._updateCommand(e),this._needUpdate=!1}else this._needUpdate=!0;this._isCommandReady()&&e.commandList.push(this._drawCommand)}},r.prototype.updateNext=function(e){this._isCommandReady()&&e.commandList.push(this._drawCommand)},r.prototype._updateCommand=function(t){var i=this._drawCommand;i||((i=this._drawCommand=new e.DrawCommand).pass=e.Pass.TRANSLUCENT,i.owner=this,i.count=6),i.instanceCount=this._count,this._updateCommandVA(t,i),this._updateCommandBoundingVolume(t,i),this._updateCommandShaderProgram(t,i),this._updateCommandUniforms(t,i),this._updateCommandRenderState(t,i),this._updateCommandModelMatrix(t,i)},r.prototype._isCommandReady=function(){var e=this._drawCommand;return!!(e&&e.vertexArray&&e.boundingVolume&&e.shaderProgram&&e.uniformMap&&e.renderState)};var o={aPlane:0,aPosition:1,aDirection:2,aSpeedScaleLifeTime:3,aTexcoord:4};r.prototype._updateCommandVA=function(t,i){var r=this._count,n=t.context;this._pointsArray||(this._pointsArray=e.ComponentDatatype.createTypedArray(e.ComponentDatatype.FLOAT,3*r));var a=this._pointsArray;this._directionsArray||(this._directionsArray=e.ComponentDatatype.createTypedArray(e.ComponentDatatype.FLOAT,4*r));var s=this._directionsArray;this._speedScaleLifeTimesArray||(this._speedScaleLifeTimesArray=e.ComponentDatatype.createTypedArray(e.ComponentDatatype.FLOAT,4*r));for(var l=this._speedScaleLifeTimesArray,u=0;u<r;u++){var h=this._fires[u],c=h.position;a[3*u]=c.x,a[3*u+1]=c.y,a[3*u+2]=c.z;var p=h.direction;s[4*u]=p.x,s[4*u+1]=p.y,s[4*u+2]=p.z,s[4*u+3]=h.mode,l[4*u]=h.speed,l[4*u+1]=h.baseScale,l[4*u+2]=h.life,l[4*u+3]=h.time}var d=e.Buffer.createVertexBuffer({context:n,typedArray:new Float32Array([-1,0,1,0,.5,2,-.5,2]),usage:e.BufferUsage.STATIC_DRAW}),f=e.Buffer.createVertexBuffer({context:n,typedArray:a,usage:e.BufferUsage.STATIC_DRAW}),g=e.Buffer.createVertexBuffer({context:n,typedArray:s,usage:e.BufferUsage.STATIC_DRAW}),m=e.Buffer.createVertexBuffer({context:n,typedArray:l,usage:e.BufferUsage.STATIC_DRAW}),_=e.Buffer.createVertexBuffer({context:n,typedArray:new Float32Array([0,0,1,0,1,1,0,1]),usage:e.BufferUsage.STATIC_DRAW}),v=e.Buffer.createIndexBuffer({context:n,typedArray:new Uint16Array([0,1,2,0,2,3]),usage:e.BufferUsage.STATIC_DRAW,indexDatatype:e.IndexDatatype.UNSIGNED_SHORT}),C=[];C.push({index:o.aPosition,vertexBuffer:f,componentsPerAttribute:3,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:12,normalize:!1,instanceDivisor:1}),C.push({index:o.aDirection,vertexBuffer:g,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:16,normalize:!1,instanceDivisor:1}),C.push({index:o.aSpeedScaleLifeTime,vertexBuffer:m,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:16,normalize:!1,instanceDivisor:1}),C.push({index:o.aTexcoord,vertexBuffer:_,componentsPerAttribute:2,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:8,normalize:!1}),C.push({index:o.aPlane,vertexBuffer:d,componentsPerAttribute:2,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:8,normalize:!1});var y=new e.VertexArray({context:n,attributes:C,indexBuffer:v});i.vertexArray&&i.vertexArray.destroy(),i.vertexArray=y},r.prototype._updateCommandBoundingVolume=function(t,i){var r=this._positions.length;if(!(r<1))if(r<2)i.boundingVolume=new e.BoundingSphere(this._positions[0].clone(),this._radius);else{for(var o=new e.BoundingSphere(this._positions[0].clone(),this._radius),n=1;n<r;n++)o=e.BoundingSphere.expand(o,this._positions[n],o);i.boundingVolume=o}},r.prototype._updateCommandShaderProgram=function(t,i){if(!i.shaderProgram){var r=t.context;i.shaderProgram=e.ShaderProgram.fromCache({context:r,vertexShaderSource:n,fragmentShaderSource:a,attributeLocations:o})}},r.prototype._updateCommandUniforms=function(e,t){var i=t.uniformMap={};if(!i||!i._ready){var r=this;i._ready=!0,i.u_startScale=function(){return r._startScale},i.u_endScale=function(){return r._endScale},i.u_imageSize=function(){return r._imageSize},i.u_startColor=function(){return r._startColor},i.u_endColor=function(){return r._endColor},i.u_texture_0=function(){return r._texture_0},i.u_texture_1=function(){return r._texture_1?r._texture_1:r._texture_0}}},r.prototype._updateCommandRenderState=function(t,i){i.renderState||(i.renderState=e.RenderState.fromCache({cull:{enabled:!1},depthTest:{enabled:!0,func:e.WebGLConstants.LEQUAL},depthMask:!1,blending:e.BlendingState.ALPHA_BLEND}))},r.prototype._updateCommandModelMatrix=function(t,i){i.modelMatrix||(i.modelMatrix=e.Matrix4.IDENTITY)};var n="attribute vec2 aPlane;\nattribute vec3 aPosition;\nattribute vec4 aDirection;\nattribute vec4 aSpeedScaleLifeTime;\nattribute vec2 aTexcoord;\nuniform vec4 u_startColor;\nuniform vec4 u_endColor;\nuniform float u_startScale;\nuniform float u_endScale;\nuniform float u_imageSize;\nvarying vec3 v_texcoord_0;\nvarying vec4 v_colorFact;\nvarying float v_texIndex;\nvec4 computePosition(vec3 position, vec2 plane, vec3 direction, float imageSize, float baseScale, float speed, float time){\n   vec3 v = normalize(direction) * speed * time;\n   v += position;\n   vec4 result = czm_modelView * vec4(v, 1.0);\n   result.xy += plane * imageSize * baseScale;\n   return result;\n}\nvoid main()\n{\n   float speed = aSpeedScaleLifeTime.x;\n   float baseScale = aSpeedScaleLifeTime.y;\n   float life = aSpeedScaleLifeTime.z;\n   float time = aSpeedScaleLifeTime.w;\n   float t = time / life;\n   baseScale *= mix(u_startScale, u_endScale, t);\n   vec4 positionEC = computePosition(aPosition, aPlane, aDirection.xyz, u_imageSize, baseScale, speed, time);\n   gl_Position = czm_projection * positionEC;\n   v_texcoord_0.xy = aTexcoord;\n   v_texcoord_0.z = aDirection.w;\n   if (t > 0.618){\n       v_texIndex = 2.0;\n   }\n   else if (t > 0.382){\n       v_texIndex = 1.0;\n   }\n   else{\n       v_texIndex = 0.0;\n   }\n   if (t > 0.618){\n       v_colorFact = vec4(1.0 - t);\n   }\n   else{\n       v_colorFact = mix(u_startColor, u_endColor, t);\n   }\n}",a="varying vec3 v_texcoord_0;\nvarying vec4 v_colorFact;\nvarying float v_texIndex;\nuniform sampler2D u_texture_0;\nuniform sampler2D u_texture_1;\nvoid main()\n{\n   int mode = int(v_texcoord_0.z);\n   vec4 color = vec4(0.0);\n   if (mode == 0){\n       if (v_texIndex == 1.0){\n           color = texture2D(u_texture_1, v_texcoord_0.xy);\n       }\n       else{\n           color = texture2D(u_texture_0, v_texcoord_0.xy);\n       }\n   }\n   else if (mode == 1){\n       if (v_texIndex == 1.0){\n           color = texture2D(u_texture_1, v_texcoord_0.xy);\n       }\n       else{\n           color = texture2D(u_texture_0, v_texcoord_0.xy);\n       }\n       color.rg *= 1.4;\n   }\n   else if (mode == 2){\n       color = v_colorFact;\n   }\n   if (color.a == 1.0){\n       float mc = max(max(color.r, color.g), color.b);\n       color.a = mc;\n   }\n   else{\n       if (color.a > 0.995){\n           color.a = 0.0;\n       }\n   }\n   color = czm_gammaCorrect(color);\n   vec4 fact = czm_gammaCorrect(v_colorFact);\n   color *= fact;\n   if (color.a < 0.1){discard;}\n   gl_FragColor = color;\n}"}(window.Cesium),function(e){function t(){this._position=null,this._actived=!1,this._speed=0,this._direction=null,this._baseScale=1,this._life=0,this._time=0,this._mode=0,this._alphaFact=0,this._normalFact=1}t.prototype.active=function(){this._actived=!0,this._time=0};var i=new e.Cartesian3,r=new e.Cartesian3;t.prototype.update=function(t){if(this._actived)if(this._time+=t,this._time>this._life)this._actived=!1;else{var o=e.Cartesian3.normalize(this._position,i),n=e.Cartesian3.multiplyByScalar(this._direction,this._normalFact,r);e.Cartesian3.add(o,n,o),e.Cartesian3.normalize(o,this._direction),e.Cartesian3.multiplyByScalar(this._direction,t*this._speed,o),e.Cartesian3.add(this._position,o,this._position),.025<this._speed&&(this._speed-=.025)}},e.defineProperties(t.prototype,{position:{get:function(){return this._position},set:function(e){e&&(this._position=e.clone(this._position))}},direction:{get:function(){return this._direction},set:function(e){e&&(this._direction=e.clone(this._direction))}},actived:{get:function(){return this._actived}},speed:{get:function(){return this._speed},set:function(e){this._speed=e}},baseScale:{get:function(){return this._baseScale},set:function(e){this._baseScale=e}},life:{get:function(){return this._life},set:function(e){this._life=e}},time:{get:function(){return this._time}},mode:{get:function(){return this._mode},set:function(e){this._mode=e}},alphaFact:{get:function(){return this._alphaFact},set:function(e){this._alphaFact=e}},normalFact:{get:function(){return this._normalFact},set:function(e){this._normalFact=e}}});var o=new e.Cartesian3,n=e.GeoLineSmokeEffect=function(t){if(t=t||{},this._url=t.url?e.buildModuleUrl(t.url):null,this._positions=[],this._scene=t.viewer.scene,this._clock=viewer.clock,this.scale=t.scale?t.scale:1,this._startColor=new e.Color,this._endColor=new e.Color,this.density=t.density?t.density:.5,this.life=t.life?t.life:1,this.speed=t.speed?t.speed:1,this.normalFactor=t.normalFactor?t.normalFactor:1,this._count=t.count?t.count:600,this._radius=t.radius?t.radius:.5,this._grow=t.grow?t.grow:60,this._smokes=[],this._texture_0=null,this._drawCommandAlpha=null,this._drawCommandOpaque=null,this._pointsArray=null,this._directionsArray=null,this._speedScaleLifeTimesArray=null,this._needUpdate=!0,this._needTime=0,this._preTime=0,this._time=0,this._door=.075,this._loadTexture(),this._initSmokes(this._count),t.positions&&t.positions.length)for(var i=t.positions,r=i.length,o=0;o<r;o++)this.addPosition(i[o])};e.defineProperties(n.prototype,{scale:{get:function(){return this._imageSize},set:function(e){this._startScale=.7*e,this._endScale=1.6*e,this._imageSize=1*e}},life:{get:function(){return this._maxLife/4},set:function(e){this._minLife=2.5*e,this._maxLife=4*e}},speed:{get:function(){return this._maxSpeed/6},set:function(e){this._minSpeed=1.5*e,this._maxSpeed=6*e}},radius:{get:function(){return this._radius},set:function(e){this._radius=e}},grow:{get:function(){return this._grow},set:function(e){this._grow=e}},pntsCount:{get:function(){return this._positions.length}},density:{get:function(){return 1-this._endColor.red},set:function(e){e=1-e,this._endColor.red=e,this._endColor.green=e,this._endColor.blue=e,this._endColor.alpha=.715,this._startColor.red=Math.min(1,e+.3),this._startColor.green=Math.min(1,e+.3),this._startColor.blue=Math.min(1,e+.3),this._startColor.alpha=1}},normalFactor:{get:function(){this._maxNormalFactor},set:function(e){this._minNormalFactor=5*e,this._maxNormalFactor=16*e}}});var a=new e.Cartesian3;n.prototype.addPosition=function(t){if(t&&void 0!==t.longitude){t=e.Cartesian3.fromRadians(t.longitude,t.latitude,t.height,void 0,a);var i=10,r=this._positions.length;if(0<r){var n=this._positions[r-1];o=e.Cartesian3.subtract(t,n,o),i=e.Cartesian3.magnitude(o)}i<.5||(this._positions.push(t.clone()),this._growSmokes(this._grow,i))}},n.prototype.destroy=function(){this._scene=null,this._clock=null,this._drawCommandAlpha&&(this._drawCommandAlpha.vertexArray&&(this._drawCommandAlpha.vertexArray.destroy(),this._drawCommandAlpha.vertexArray=null),this._drawCommandAlpha.shaderProgram&&(this._drawCommandAlpha.shaderProgram.destroy(),this._drawCommandAlpha.shaderProgram=null),this._drawCommandAlpha._owner=null,this._drawCommandAlpha=null),this._drawCommandOpaque&&(this._drawCommandOpaque.vertexArray&&(this._drawCommandOpaque.vertexArray.destroy(),this._drawCommandOpaque.vertexArray=null),this._drawCommandOpaque.shaderProgram&&(this._drawCommandOpaque.shaderProgram.destroy(),this._drawCommandOpaque.shaderProgram=null),this._drawCommandOpaque._owner=null,this._drawCommandOpaque=null),this._texture_0&&(this._texture_0.destroy(),this._texture_0=null),this._smokes.length=0,this._positions.length=0,this._pointsArray=null,this._directionsArray=null,this._speedScaleLifeTimesArray=null},n.prototype._loadTexture=function(){var t=this,i=t._scene.frameState.context;t._url&&(t._texture_0&&(t._texture_0.destroy(),t._texture_0=null),e.Resource.fetchImage(t._url).then((function(r){t._texture_0=new e.Texture({context:i,source:r},(function(e){}))})))},n.prototype._emissionPosition=function(){var t=this._positions.length;if(t<1)return null;if(t<2)return this._positions[0].clone(o),o.x+=e.Math.randomBetween(0,1)*this._radius,o.y+=e.Math.randomBetween(0,1)*this._radius,o.z+=e.Math.randomBetween(0,1)*this._radius,o;var i=e.Math.randomBetween(0,t-1);i=Math.floor(i);var r=this._positions[i],n=this._positions[i+1],a=e.Math.randomBetween(0,1);return o=e.Cartesian3.lerp(r,n,a,o)},n.prototype._initSmokes=function(e){if(e&&!(e<1))for(var i=0;i<e;i++){var r=new t;this._smokes.push(r)}},n.prototype._growSmokes=function(e,i){e=Math.round(e*i),this._count+=e;for(var r=0;r<e;r++){var o=new t;this._smokes.push(o)}};var s=new e.Cartesian3,l=new e.Quaternion,u=new e.Matrix4,h=new e.Matrix3;n.prototype._initSmoke=function(t){var i=this._emissionPosition();if(!i)return!1;if(t.position=i.clone(t.position),t.position){t.direction||(t.direction=new e.Cartesian3),e.Cartesian3.normalize(t.position,t.direction);var r=e.Math.randomBetween(.5,1.570789),o=e.Math.randomBetween(0,6.28318),n=e.Quaternion.fromAxisAngle(t.direction,o,l);if(t.direction.equals(e.Cartesian3.UNIT_X)){var a=e.Cartesian3.cross(t.direction,e.Cartesian3.UNIT_Z,s);e.Cartesian3.normalize(a,a),o=e.Quaternion.fromAxisAngle(a,r,l)}else a=e.Cartesian3.cross(t.direction,e.Cartesian3.UNIT_X,s),e.Cartesian3.normalize(a,a),o=e.Quaternion.fromAxisAngle(a,r,l);var c=e.Quaternion.multiply(n,o,n),p=e.Matrix4.fromRotationTranslation(e.Matrix3.fromQuaternion(c,h),void 0,u);e.Matrix4.multiplyByPointAsVector(p,t.direction,t.direction),e.Cartesian3.normalize(t.direction,t.direction)}return t.speed=e.Math.randomBetween(this._minSpeed,this._maxSpeed),t.life=e.Math.randomBetween(this._minLife,this._maxLife),t.baseScale=e.Math.randomBetween(.5,5),t.mode=0,t.alphaFact=e.Math.randomBetween(this._startColor.alpha,this._endColor.alpha),t.normalFact=e.Math.randomBetween(this._minNormalFactor,this._maxNormalFactor),null!=t.position},n.prototype._updateSmoke=function(e){e.update(this._time),e.actived||this._initSmoke(e)&&0<this._udoor&&(e.active(),this._udoor-=1)},n.prototype._updateTime=function(t){var i;if(i=this._clock.shouldAnimate?t.time.secondsOfDay:e.getTimestamp()/1e3,0==this._preTime)this._preTime=i;else{var r=i-this._preTime;r>this._maxLife&&(r=this._maxLife),this._time=r,this._preTime=i}},n.prototype.update=function(e){this._updateTime(e);var t=this._count;if(!(t<1||t!=this._smokes.length||this._positions.length<1)&&this._texture_0){if(this._needUpdate){this._udoor=this._door*t;for(var i=0;i<t;i++){var r=this._smokes[i];this._updateSmoke(r)}this._updateCommand(e),this._needUpdate=!1}else this._needUpdate=!0;this._isCommandReady()&&(e.commandList.push(this._drawCommandAlpha),e.commandList.push(this._drawCommandOpaque))}},n.prototype.updateNext=function(e){this._isCommandReady()&&(e.commandList.push(this._drawCommandAlpha),e.commandList.push(this._drawCommandOpaque))},n.prototype._updateCommand=function(t){var i=this._drawCommandAlpha;i||((i=this._drawCommandAlpha=new e.DrawCommand).pass=e.Pass.TRANSLUCENT,i.owner=this,i.count=6),i.instanceCount=this._count,this._updateCommandVA(t,i),this._updateCommandBoundingVolume(t,i),this._updateCommandShaderProgramAlpha(t,i),this._updateCommandUniforms(t,i),this._updateCommandRenderStateAlpha(t,i),this._updateCommandModelMatrix(t,i);var r=this._drawCommandOpaque;r||((r=this._drawCommandOpaque=new e.DrawCommand).pass=e.Pass.OPAQUE,r.owner=this,r.count=6),r.instanceCount=this._count,this._updateCommandRepeatVA(t,r),this._updateCommandBoundingVolume(t,r),this._updateCommandShaderProgramOpaque(t,r),this._updateCommandUniforms(t,r),this._updateCommandRenderStateOpaque(t,r),this._updateCommandModelMatrix(t,r)},n.prototype._isCommandReady=function(){var e=this._drawCommandAlpha;return!!(e&&e.vertexArray&&e.boundingVolume&&e.shaderProgram&&e.uniformMap&&e.renderState)};var c={aPlane:0,aPosition:1,aDirection:2,aSpeedScaleLifeTime:3,aTexcoord:4};n.prototype._updateCommandVA=function(t,i){var r=this._count,o=t.context;this._pointsArray||(this._pointsArray=e.ComponentDatatype.createTypedArray(e.ComponentDatatype.FLOAT,4*r));var n=this._pointsArray;this._directionsArray||(this._directionsArray=e.ComponentDatatype.createTypedArray(e.ComponentDatatype.FLOAT,4*r));var a=this._directionsArray;this._speedScaleLifeTimesArray||(this._speedScaleLifeTimesArray=e.ComponentDatatype.createTypedArray(e.ComponentDatatype.FLOAT,4*r));for(var s=this._speedScaleLifeTimesArray,l=0;l<r;l++){var u=this._smokes[l],h=u.position;n[4*l]=h.x,n[4*l+1]=h.y,n[4*l+2]=h.z,n[4*l+3]=u.alphaFact;var p=u.direction;a[4*l]=p.x,a[4*l+1]=p.y,a[4*l+2]=p.z,a[4*l+3]=u.mode,s[4*l]=u.speed,s[4*l+1]=u.baseScale,s[4*l+2]=u.life,s[4*l+3]=u.time}var d=e.Buffer.createVertexBuffer({context:o,typedArray:new Float32Array([-.5,0,.5,0,1,2,-1,2]),usage:e.BufferUsage.STATIC_DRAW}),f=e.Buffer.createVertexBuffer({context:o,typedArray:n,usage:e.BufferUsage.STATIC_DRAW}),g=e.Buffer.createVertexBuffer({context:o,typedArray:a,usage:e.BufferUsage.STATIC_DRAW}),m=e.Buffer.createVertexBuffer({context:o,typedArray:s,usage:e.BufferUsage.STATIC_DRAW}),_=e.Buffer.createVertexBuffer({context:o,typedArray:new Float32Array([0,0,1,0,1,1,0,1]),usage:e.BufferUsage.STATIC_DRAW}),v=e.Buffer.createIndexBuffer({context:o,typedArray:new Uint16Array([0,1,2,0,2,3]),usage:e.BufferUsage.STATIC_DRAW,indexDatatype:e.IndexDatatype.UNSIGNED_SHORT}),C=[];C.push({index:c.aPosition,vertexBuffer:f,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:16,normalize:!1,instanceDivisor:1}),C.push({index:c.aDirection,vertexBuffer:g,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:16,normalize:!1,instanceDivisor:1}),C.push({index:c.aSpeedScaleLifeTime,vertexBuffer:m,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:16,normalize:!1,instanceDivisor:1}),C.push({index:c.aTexcoord,vertexBuffer:_,componentsPerAttribute:2,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:8,normalize:!1}),C.push({index:c.aPlane,vertexBuffer:d,componentsPerAttribute:2,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:8,normalize:!1});var y=new e.VertexArray({context:o,attributes:C,indexBuffer:v});i.vertexArray&&i.vertexArray.destroy(),i.vertexArray=y},n.prototype._updateCommandRepeatVA=function(t,i){this._count;var r=t.context;if(this._pointsArray){var o=this._pointsArray,n=this._directionsArray,a=this._speedScaleLifeTimesArray,s=e.Buffer.createVertexBuffer({context:r,typedArray:new Float32Array([-.5,0,.5,0,1,2,-1,2]),usage:e.BufferUsage.STATIC_DRAW}),l=e.Buffer.createVertexBuffer({context:r,typedArray:o,usage:e.BufferUsage.STATIC_DRAW}),u=e.Buffer.createVertexBuffer({context:r,typedArray:n,usage:e.BufferUsage.STATIC_DRAW}),h=e.Buffer.createVertexBuffer({context:r,typedArray:a,usage:e.BufferUsage.STATIC_DRAW}),p=e.Buffer.createVertexBuffer({context:r,typedArray:new Float32Array([0,0,1,0,1,1,0,1]),usage:e.BufferUsage.STATIC_DRAW}),d=e.Buffer.createIndexBuffer({context:r,typedArray:new Uint16Array([0,1,2,0,2,3]),usage:e.BufferUsage.STATIC_DRAW,indexDatatype:e.IndexDatatype.UNSIGNED_SHORT}),f=[];f.push({index:c.aPosition,vertexBuffer:l,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:16,normalize:!1,instanceDivisor:1}),f.push({index:c.aDirection,vertexBuffer:u,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:16,normalize:!1,instanceDivisor:1}),f.push({index:c.aSpeedScaleLifeTime,vertexBuffer:h,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:16,normalize:!1,instanceDivisor:1}),f.push({index:c.aTexcoord,vertexBuffer:p,componentsPerAttribute:2,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:8,normalize:!1}),f.push({index:c.aPlane,vertexBuffer:s,componentsPerAttribute:2,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:8,normalize:!1});var g=new e.VertexArray({context:r,attributes:f,indexBuffer:d});i.vertexArray&&i.vertexArray.destroy(),i.vertexArray=g}};var p=new e.BoundingSphere;n.prototype._updateCommandBoundingVolume=function(t,i){var r=this._positions.length;if(r<1)i.boundingVolume=null;else if(r<2)p.center=this._positions[0].clone(p.center),p.radius=this._radius+this._maxSpeed*this._maxLife,i.boundingVolume=p;else{p.center=this._positions[0].clone(p.center),p.radius=this._radius;for(var o=1;o<r;o++)e.BoundingSphere.expand(p,this._positions[o],p);i.boundingVolume=p}},n.prototype._updateCommandShaderProgramAlpha=function(t,i){if(!i.shaderProgram){var r=t.context;i.shaderProgram=e.ShaderProgram.fromCache({context:r,vertexShaderSource:d,fragmentShaderSource:f,attributeLocations:c})}},n.prototype._updateCommandShaderProgramOpaque=function(t,i){if(!i.shaderProgram){var r=t.context;i.shaderProgram=e.ShaderProgram.fromCache({context:r,vertexShaderSource:g,fragmentShaderSource:m,attributeLocations:c})}},n.prototype._updateCommandUniforms=function(e,t){var i=t.uniformMap={};if(!i||!i._ready){var r=this;i._ready=!0,i.u_startScale=function(){return r._startScale},i.u_endScale=function(){return r._endScale},i.u_imageSize=function(){return r._imageSize},i.u_startColor=function(){return r._startColor},i.u_endColor=function(){return r._endColor},i.u_texture_0=function(){return r._texture_0}}},n.prototype._updateCommandRenderStateAlpha=function(t,i){i.renderState||(i.renderState=e.RenderState.fromCache({cull:{enabled:!1},depthTest:{enabled:!0,func:e.WebGLConstants.LEQUAL},depthMask:!1,blending:e.BlendingState.ALPHA_BLEND}))},n.prototype._updateCommandRenderStateOpaque=function(t,i){i.renderState||(i.renderState=e.RenderState.fromCache({cull:{enabled:!1},depthTest:{enabled:!0,func:e.WebGLConstants.LEQUAL},depthMask:!0}))},n.prototype._updateCommandModelMatrix=function(t,i){i.modelMatrix||(i.modelMatrix=e.Matrix4.IDENTITY)};var d="attribute vec2 aPlane;\nattribute vec4 aPosition;\nattribute vec4 aDirection;\nattribute vec4 aSpeedScaleLifeTime;\nattribute vec2 aTexcoord;\nuniform vec4 u_startColor;\nuniform vec4 u_endColor;\nuniform float u_startScale;\nuniform float u_endScale;\nuniform float u_imageSize;\nvarying vec3 v_texcoord_0;\nvarying vec4 v_colorFact;\nvec4 computePosition(vec3 position, vec2 plane, vec3 direction, float imageSize, float baseScale, float speed, float time){\n   vec3 v = position;\n   vec4 result = czm_modelView * vec4(v, 1.0);\n   result /= result.w;\n   result.xy += plane * imageSize * baseScale;\n   return result;\n}\nvoid main()\n{\n   float speed = aSpeedScaleLifeTime.x;\n   float baseScale = aSpeedScaleLifeTime.y;\n   float life = aSpeedScaleLifeTime.z;\n   float time = aSpeedScaleLifeTime.w;\n   float t = time / life;\n   baseScale *= mix(u_startScale, u_endScale, t);\n   vec4 positionEC = computePosition(aPosition.xyz, aPlane, aDirection.xyz, u_imageSize, baseScale, speed, time);\n   gl_Position = czm_projection * positionEC;\n   v_texcoord_0.xy = aTexcoord;\n   v_texcoord_0.z = t;\n   v_colorFact = vec4(mix(u_startColor.rgb, u_endColor.rgb, aPosition.w * (u_startColor.a + u_endColor.a) / 2.0), aPosition.w);\n}",f="varying vec3 v_texcoord_0;\nvarying vec4 v_colorFact;\nuniform sampler2D u_texture_0;\nvoid main()\n{\n   vec4 color = vec4(0.0);\n   color = texture2D(u_texture_0, v_texcoord_0.xy);\n   color = czm_gammaCorrect(color);\n   vec4 fact = v_colorFact;\n   color *= fact;\n   if (v_texcoord_0.z > 0.9){color.a *= 0.1;}\n   gl_FragColor = color;\n}",g="attribute vec2 aPlane;\nattribute vec4 aPosition;\nattribute vec4 aDirection;\nattribute vec4 aSpeedScaleLifeTime;\nattribute vec2 aTexcoord;\nuniform vec4 u_startColor;\nuniform vec4 u_endColor;\nuniform float u_startScale;\nuniform float u_endScale;\nuniform float u_imageSize;\nvarying vec3 v_texcoord_0;\nvarying vec4 v_colorFact;\nvec4 computePosition(vec3 position, vec2 plane, vec3 direction, float imageSize, float baseScale, float speed, float time){\n   vec3 v = position;\n   vec4 result = czm_modelView * vec4(v, 1.0);\n   result /= result.w;\n   result.xy += plane * imageSize * baseScale;\n   return result;\n}\nvoid main()\n{\n   float speed = aSpeedScaleLifeTime.x;\n   float baseScale = aSpeedScaleLifeTime.y;\n   float life = aSpeedScaleLifeTime.z;\n   float time = aSpeedScaleLifeTime.w;\n   float t = time / life;\n   baseScale *= mix(u_startScale, u_endScale, t);\n   vec4 positionEC = computePosition(aPosition.xyz, aPlane, aDirection.xyz, u_imageSize, baseScale, speed, time);\n   gl_Position = czm_projection * positionEC;\n   v_texcoord_0.xy = aTexcoord;\n   v_texcoord_0.z = t;\n   v_colorFact = vec4(mix(u_startColor.rgb, u_endColor.rgb, aPosition.w * (u_startColor.a + u_endColor.a) / 2.0), aPosition.w);\n}",m="varying vec3 v_texcoord_0;\nvarying vec4 v_colorFact;\nuniform sampler2D u_texture_0;\nvoid main()\n{\n   if (v_texcoord_0.z > 0.9){discard;}\n   vec4 color = vec4(0.0);\n   color = texture2D(u_texture_0, v_texcoord_0.xy);\n   color = czm_gammaCorrect(color);\n   vec4 fact = v_colorFact;\n   color *= fact;\n   if (color.a < 0.746){discard;}\n   gl_FragColor = color;\n}"}(window.Cesium),function(e){function t(t){t=i(t,i.EMPTY_OBJECT),this.viewer=t.viewer,this.playing=t.playing,this.data=t.data,this.sampleMaxHeight=i(t.sampleMaxHeight,2e4),this.sampleMaxPoint=i(t.sampleMaxPoint,50),this._data=[],this._name=r+"_"+e.createGuid(),this._lines=[],this.setData(this.data),this.render()}t.prototype.setData=function(t){var i=this;this._data=[];var r=this;t instanceof Array&&t.forEach((function(t){var o=function(t,i,r,o){var n=[],a=e.Cartographic.fromCartesian(t),s=e.Cartographic.fromCartesian(i),l=180*a.longitude/Math.PI,u=180*a.latitude/Math.PI,h=180*s.longitude/Math.PI,c=180*s.latitude/Math.PI,p=Math.sqrt((l-h)*(l-h)+(u-c)*(u-c))*r,d=e.Cartesian3.clone(t),f=e.Cartesian3.clone(i),g=e.Cartesian3.distance(d,e.Cartesian3.ZERO),m=e.Cartesian3.distance(f,e.Cartesian3.ZERO);if(e.Cartesian3.normalize(d,d),e.Cartesian3.normalize(f,f),0==e.Cartesian3.distance(d,f))return n;var _=e.Cartesian3.angleBetween(d,f);n.push(t);for(var v=1;v<o-1;v++){var C=1*v/(o-1),y=1-C,A=Math.sin(y*_)/Math.sin(_),I=Math.sin(C*_)/Math.sin(_),b=e.Cartesian3.multiplyByScalar(d,A,new e.Cartesian3),w=e.Cartesian3.multiplyByScalar(f,I,new e.Cartesian3),E=e.Cartesian3.add(b,w,new e.Cartesian3),G=C*Math.PI,S=g*y+m*C+Math.sin(G)*p;E=e.Cartesian3.multiplyByScalar(E,S,E),n.push(E)}return n.push(i),n}(e.Cartesian3.fromDegrees.apply(i,t.posititons[0]),e.Cartesian3.fromDegrees.apply(i,t.posititons[1]),r.sampleMaxHeight,r.sampleMaxPoint);r._data.push({posititons:o,color:t.color,width:t.width,duration:t.duration})}))},t.prototype.getData=function(){return this._data},t.prototype._createPolylines=function(){var t=this._data,i=this._lines,r=this.viewer.entities,n=this._name,a=this;this._clearPolylines(),t instanceof Array&&t.forEach((function(t){var s=new e.Entity({name:n,polyline:{positions:t.posititons,width:t.width,material:new o({color:t.color,width:t.width,duration:t.duration,playing:a.playing})}});i.push(s),r.add(s)}))},t.prototype.render=function(){this._createPolylines()},t.prototype._clearPolylines=function(){var e=this._lines,t=this.viewer.entities;e.forEach((function(e){t.remove(e)})),e.length=0},t.prototype.play=function(e){this.playing="boolean"==typeof e?e:!this.playing;var t=this._lines;e=this.playing,t.forEach((function(t){t.polyline.material.playing=e}))},t.prototype.destroy=function(){};var i=e.defaultValue,r=(e.defined,"GEOODLINE");function o(t){this._definitionChanged=new e.Event,this._color=void 0,this._colorSubscription=void 0,this.color=t.color,this.width=t.width,this.duration=t.duration,this.playing=t.playing,this._time=(new Date).getTime()}e.defineProperties(o.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}},color:e.createPropertyDescriptor("color")}),o.prototype.getType=function(e){return r},o.prototype.getValue=function(t,i){return e.defined(i)||(i={}),i.color=e.Property.getValueOrClonedDefault(this._color,t,e.Color.WHITE,i.color),i.totoalFrameCount=this.playing?60*this.duration:0,i},o.prototype.equals=function(e){return this===e},delete e.Material._materialCache._materials[r],e.Material._materialCache.addMaterial(r,{fabric:{type:r,uniforms:{color:new e.Color(1,1,0,1),totoalFrameCount:450},source:"\n\t\tczm_material czm_getMaterial(czm_materialInput materialInput)\n\t\t{\n\t\t    czm_material material = czm_getDefaultMaterial(materialInput);\n\t\t    vec2 st = materialInput.st;\n\t\t    float t = mod(czm_frameNumber, totoalFrameCount) / totoalFrameCount; \n\t\t    t *= 1.03;\n\t\t    float alpha = smoothstep(t- 0.03, t, st.s) * step(-t, -st.s); \n\t\t    alpha += 0.1;\n\t\t    material.diffuse = color.rgb;\n\t\t    material.alpha = alpha;\n\t\t    return material;\n\t\t}\n    "},translucent:function(){return!0}}),e.GeoODLine=t}(window.Cesium),function(e){var t=e.GeoOutlineFireEffect=function(t){this._viewer=t.viewer,this._actived=!!t.actived&&t.actived,this._fireEffect=null,this._postProcess=null,this._viewMatrix=e.Matrix4.IDENTITY,this._assigned=[],this._framebuffer=null,this._depthAttachment=null,this._clearCommand=null,this._groundTexture=null,this._xPlane=null,this._yPlane=null,this._zPlane=null,this._xyRange=null,this._needUpdate=!1,this._checkPositionsOrder(t),this._createGroundTexture(t),this._createFireEffect(t),this._createXYPlanes(t),this._createPostProcess(t)};e.defineProperties(t.prototype,{explode:{get:function(){return this._fireEffect?this._fireEffect.explode:0},set:function(e){this._fireEffect&&(this._fireEffect.explode=e)}},scale:{get:function(){return this._fireEffect?this._fireEffect.scale:1},set:function(e){this._fireEffect&&(this._fireEffect.scale=e)}},life:{get:function(){return this._fireEffect?this._fireEffect.life:0},set:function(e){this._fireEffect&&(this._fireEffect.life=e)}},speed:{get:function(){return this._fireEffect?this._fireEffect.speed:0},set:function(e){this._fireEffect&&(this._fireEffect.speed=e)}},radius:{get:function(){return this._fireEffect?this._fireEffect.radius:0},set:function(e){this._fireEffect&&(this._fireEffect.radius=e)}},grow:{get:function(){return this._fireEffect?this._fireEffect.grow:0},set:function(e){this._fireEffect&&(this._fireEffect.grow=e)}},smoking:{get:function(){return this._fireEffect?this._fireEffect.smoking:0},set:function(e){this._fireEffect&&(this._fireEffect.smoking=e)}},actived:{get:function(){return this._actived},set:function(e){this._actived=e}}}),t.prototype.update=function(e){this._actived?(this._updateAssiged(e),this._postProcess&&(this._viewMatrix=e.camera._invViewMatrix,this._groundTexture?this._postProcess.enabled=!0:this._postProcess.enabled=!1)):this._postProcess&&(this._postProcess.enabled=!1)},t.prototype._createFireEffect=function(t){if(t&&!this._fireEffect){var i=t.positions;if(i&&void 0!==i.length&&!(i.length<1)){var r=i.length;i[0]!=i[r-1]&&i.push(i[0].clone()),t.explode||(t.explode=.21),t.smoking||(t.smoking=.15),t.scale||(t.scale=1),t.life||(t.life=1.1),t.speed||(t.speed=1.7),this._fireEffect=new e.GeoLineFireEffect(t)}}};var i=new e.Cartesian3,r=new e.Cartesian3;t.prototype._computePlane=function(t,o){var n=e.Cartesian3.cross(o,t,i);e.Cartesian3.normalize(n,n);var a=e.Cartesian3.lerp(t,o,.5,r);return new e.Cartesian4(n.x,n.y,n.z,-e.Cartesian3.dot(n,a))},t.prototype._appendAreaPlanes=function(e,t,i,r){e.push(this._computePlane(t,i)),e.push(this._computePlane(i,r)),e.push(this._computePlane(r,t))},t.prototype._createAssignedFrameBuffer=function(t){var i=this,r=t.context,o=r.drawingBufferWidth,n=r.drawingBufferHeight;i._depthAttachment&&(i._depthAttachment.destroy(),i._depthAttachment=null),i._framebuffer&&(i._framebuffer.destroy(),i._framebuffer=null);var a=new e.Texture({context:r,width:o,height:n,pixelFormat:e.PixelFormat.DEPTH_STENCIL,pixelDatatype:e.PixelDatatype.UNSIGNED_INT_24_8,sampler:new e.Sampler({wrapS:e.TextureWrap.CLAMP_TO_EDGE,wrapT:e.TextureWrap.CLAMP_TO_EDGE,minificationFilter:e.TextureMinificationFilter.NEAREST,magnificationFilter:e.TextureMagnificationFilter.NEAREST})}),s=new e.Framebuffer({context:r,depthStencilTexture:a,destroyAttachments:!1});i._clearCommand||(i._clearCommand=new e.ClearCommand({depth:1,color:new e.Color})),i._framebuffer=s,i._depthAttachment=a},t.prototype.addFireEffect=function(t){(t=t||{}).explode=t.explode?.2*t.explode:.2,t.smoking=t.smoking?.95*t.smoking:.95,t.life=t.life?4.5*t.life:4.5,t.scale=t.scale?t.scale:1,t.radius=t.radius?.5*t.radius:.5,t.speed=t.speed?.4*t.speed:.4;var i=new e.GeoLineFireEffect(t);this._assigned.push(i)},t.prototype.addSmokeEffect=function(t){var i=new e.GeoLineSmokeEffect(t);this._assigned.push(i)},t.prototype._updateAssiged=function(e){var t=this;this._fireEffect&&this._fireEffect.update(e);for(var i=t._assigned.length,r=0;r<i;r++)t._assigned[r].update(e);if(t._framebuffer&&t._framebuffer._depthStencilTexture._width==e.context.drawingBufferWidth&&t._framebuffer._depthStencilTexture._height==e.context.drawingBufferHeight||t._createAssignedFrameBuffer(e),t._framebuffer){var o=e.context,n=e.commandList,a=e.commandList=[];for(a.push(t._clearCommand),r=0;r<i;r++)t._assigned[r].updateNext(e);t._fireEffect.updateNext(e),e.commandList=n;var s=t._viewer.scene._view.passState,l=s.framebuffer;if(s.framebuffer=t._framebuffer,0<a.length)for(var u=0;u<a.length;u++)a[u].execute(o,s);s.framebuffer=l}},t.prototype._createPostProcess=function(t){if(t&&!this._postProcess){var i=t.positions;if(i){var r=i.length;if(r&&!(r<4)){var o=this;r-=2;for(var n=[],a=e.Cartesian3.fromRadians(i[0].longitude,i[0].latitude,i[0].height),s=1;s<r&&!(12<=s);s++){var l=e.Cartesian3.fromRadians(i[s].longitude,i[s].latitude,i[s].height),u=e.Cartesian3.fromRadians(i[s+1].longitude,i[s+1].latitude,i[s+1].height);this._appendAreaPlanes(n,a,l,u)}var h="uniform mat4 u_nViewMatrix;\nuniform int u_count;\nuniform vec4 u_planes["+12..toString()+"];\nuniform vec4 u_xPlane;\nuniform vec4 u_yPlane;\nuniform vec4 u_zPlane;\nuniform vec2 u_xyRange;\nuniform sampler2D colorTexture;\nuniform sampler2D depthTexture;\nuniform sampler2D u_assignedTexture;\nuniform sampler2D u_groundTexture;\nvarying vec2 v_textureCoordinates;\nvec4 toEye(in vec2 uv, in float depth){\n    vec2 xy = vec2((uv.x * 2.0 - 1.0),(uv.y * 2.0 - 1.0));\n    vec4 posInCamera = czm_inverseProjection * vec4(xy, depth, 1.0);\n    posInCamera = posInCamera / posInCamera.w;\n    return posInCamera;\n}\nfloat getDepth(in vec4 depth){\n    float z_window = czm_unpackDepth(depth);\n    z_window = czm_reverseLogDepth(z_window);\n    float n_range = czm_depthRange.near;\n    float f_range = czm_depthRange.far;\n    return (2.0 * z_window - n_range - f_range) / (f_range - n_range);\n}\nvec2 getGroundTexCoord(in vec3 position){\n    float x = czm_planeDistance(u_xPlane, position) / u_xyRange.x;\n    float y = czm_planeDistance(u_yPlane, position) / u_xyRange.y;\n    return vec2(x * 4.0, y * 4.0);\n}\nvoid main(){\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\n    vec4 currD = texture2D(depthTexture, v_textureCoordinates);\n    if(currD.r>=1.0){\n        gl_FragColor = color;\n        return;\n    }\n    vec4 assigned = texture2D(u_assignedTexture, v_textureCoordinates);\n    if(assigned.r < 1.0){\n        gl_FragColor = color;\n        return;\n    }\n    float depth = getDepth(currD);\n    vec4 positionEC = toEye(v_textureCoordinates, depth);\n    vec4 position = u_nViewMatrix * positionEC;\n    position /= position.w;\n    float z = czm_planeDistance(u_zPlane, position.xyz);\n    vec2 gndTexCoord = getGroundTexCoord(position.xyz);\n    vec4 colorGround = texture2D(u_groundTexture, gndTexCoord);\n    for (int i = 0; i < "+12..toString()+"; i += 3){\n        if (i >= u_count){\n            break;\n        }\n        float d0 = czm_planeDistance(u_planes[i], position.xyz);\n        float d1 = czm_planeDistance(u_planes[i+1], position.xyz);\n        float d2 = czm_planeDistance(u_planes[i+2], position.xyz);\n        if (d0 > 0.0 && d1 > 0.0 && d2 > 0.0){\n           if (z < -1000.0){break;}\n           color += colorGround * vec4(0.5);\n           break;\n        }\n    }\n    gl_FragColor = color;\n}";this._postProcess=new e.PostProcessStage({fragmentShader:h,uniforms:{u_nViewMatrix:function(){return o._viewMatrix},u_planes:function(){return n},u_count:function(){return n.length},u_assignedTexture:function(){return o._depthAttachment},u_groundTexture:function(){return o._groundTexture},u_xPlane:function(){return o._xPlane},u_yPlane:function(){return o._yPlane},u_zPlane:function(){return o._zPlane},u_xyRange:function(){return o._xyRange}}}),this._postProcess.enabled=!1,this._viewer.scene.postProcessStages.add(this._postProcess)}}}},t.prototype._checkPositionsOrder=function(t){var i=t.positions;if(i&&void 0!==i.length&&!(i.length<4)){var r=e.Cartesian3.fromRadians(i[0].longitude,i[0].latitude,i[0].height),o=e.Cartesian3.fromRadians(i[1].longitude,i[1].latitude,i[1].height),n=e.Cartesian3.fromRadians(i[2].longitude,i[2].latitude,i[2].height),a=e.Cartesian3.subtract(o,r,new e.Cartesian3),s=e.Cartesian3.subtract(n,r,new e.Cartesian3),l=e.Cartesian3.cross(s,a,new e.Cartesian3);e.Cartesian3.dot(l,r)<0&&i.reverse()}},t.prototype._createXYPlanes=function(t){var i=t.positions;if(i&&void 0!==i.length&&!(i.length<4)){var r=e.Cartesian3.fromRadians(i[0].longitude,i[0].latitude,i[0].height),o=e.Cartesian3.fromRadians(i[1].longitude,i[1].latitude,i[1].height),n=e.Cartesian3.fromRadians(i[2].longitude,i[2].latitude,i[2].height),a=e.Cartesian3.subtract(o,r,new e.Cartesian3),s=e.Cartesian3.subtract(n,r,new e.Cartesian3),l=e.Cartesian3.magnitude(a),u=e.Cartesian3.magnitude(s);e.Cartesian3.normalize(a,a),e.Cartesian3.normalize(s,s);var h=e.Cartesian3.cross(s,a,new e.Cartesian3);e.Cartesian3.normalize(h,h);var c=e.Cartesian3.dot(s,a)*l,p=Math.max(l,c),d=e.Cartesian3.cross(a,h,new e.Cartesian3);e.Cartesian3.normalize(d,d);var f=e.Cartesian3.dot(s,d)*u;this._xPlane=new e.Cartesian4(a.x,a.y,a.z,-e.Cartesian3.dot(a,r)),this._yPlane=new e.Cartesian4(d.x,d.y,d.z,-e.Cartesian3.dot(d,r)),this._zPlane=new e.Cartesian4(h.x,h.y,h.z,-e.Cartesian3.dot(h,r)),this._xyRange=new e.Cartesian2(p,f)}},t.prototype._createGroundTexture=function(t){if(t.urlGround&&!this._groundTexture){var i=this,r=i._viewer.scene.frameState.context,o=e.buildModuleUrl(t.urlGround);e.Resource.fetchImage(o).then((function(t){i._groundTexture=new e.Texture({context:r,source:t,sampler:new e.Sampler({wrapS:e.TextureWrap.REPEAT,wrapT:e.TextureWrap.REPEAT,minificationFilter:e.TextureMinificationFilter.NEAREST,magnificationFilter:e.TextureMagnificationFilter.NEAREST})},(function(e){}))}))}},t.prototype.destroy=function(){this._fireEffect&&(this._fireEffect.destroy(),this._fireEffect=null),this._postProcess&&(this._postProcess.enabled=!1,this._viewer.scene.postProcessStages.remove(this._postProcess),this._postProcess=null),this._viewMatrix=null;for(var e=0;e<this._assigned.length;e++)this._assigned[e].destroy(),this._assigned[e]=null;this._assigned=null,this._framebuffer&&(this._framebuffer.destroy(),this._framebuffer=null),this._depthAttachment&&(this._depthAttachment.destroy(),this._depthAttachment=null),this._clearCommand=null,this._groundTexture=null,this._xPlane=null,this._yPlane=null,this._zPlane=null,this._xyRange=null,this._viewer=null}}(window.Cesium),function(e){var t=e.GeoScanCircleEffect=function(t){this._viewer=t.viewer,this._radius=t.radius;var i=t.center;this._center=e.Cartesian3.fromRadians(i.longitude,i.latitude,i.height),this._color=t.color.clone(),this._lineWidth=t.lineWidth?t.lineWidth:1,this._speed=t.speed?t.speed:1,this._repeat=!t.repeat||t.repeat,this._scanCirclePostProcess=null,this._scanAperturePostProcess=null,this._lastTime=0;var r=e.Cartesian3.normalize(this._center,new e.Cartesian3);this._normal=function(){return r};var o=this._radius/this._speed;this._life=function(){return o},this._setLife=function(e){o=e};var n=0;this._time=function(){return n},this._setTime=function(e){n=e},this._enabled=!0,this._deathEvent=new e.Event,this._invViewMatrix=null};e.defineProperties(t.prototype,{normal:{get:function(){return this._normal()}},life:{get:function(){return this._life()}},time:{get:function(){return this._time()},set:function(e){this._setTime(e)}},speed:{get:function(){return this._speed},set:function(e){this._speed!=e&&(this._speed=e,this._setLife(this._radius/this._speed))}},lineWidth:{get:function(){return this._lineWidth},set:function(e){this._lineWidth=e}},color:{get:function(){return this._color},set:function(e){this._color=e.clone()}},repeat:{get:function(){return this._repeat},set:function(e){this._repeat=e}},deathEvent:{get:function(){return this._deathEvent}},enabled:{get:function(){return this._enabled},set:function(e){this._enabled=e}},center:{get:function(){return this._center}},invViewMatrix:{get:function(){return this._invViewMatrix}}}),t.prototype.update=function(e){this._enabled?(this._updateTime(),this._enabled&&this._updatePostProcesses(e)):this._scanCirclePostProcess&&(this._scanCirclePostProcess.enabled=!1)},t.prototype.destroy=function(){this._scanCirclePostProcess&&(this._scanCirclePostProcess.enabled=!1,this._viewer.scene.postProcessStages.remove(this._scanCirclePostProcess),this._scanCirclePostProcess=null)},t.prototype._updateTime=function(){var t=e.getTimestamp()/1e3;if(0==this._lastTime)this._lastTime=t,this.time=0;else{var i=t-this._lastTime,r=this.life;r<i&&(i=r),this.time+=i,this.time>r&&(this._repeat||this._death(),this.time=0),this._lastTime=t}},t.prototype._death=function(){this._enabled=!1,this._deathEvent.raiseEvent()},t.prototype._updatePostProcesses=function(e){var t=e.camera;this._invViewMatrix=t.inverseViewMatrix.clone(this._invViewMatrix),this._updateScanCirclePostProcess(e)},t.prototype._updateScanCirclePostProcess=function(t){var i=this;if(i._scanCirclePostProcess)this._scanCirclePostProcess.enabled=!0;else{var r=new e.Cartesian4;i._scanCirclePostProcess=new e.PostProcessStage({fragmentShader:"uniform sampler2D colorTexture;\nuniform sampler2D depthTexture;\nuniform mat4 u_invViewMatrix;\nuniform vec3 u_center;\nuniform vec3 u_normal;\nuniform vec4 u_color;\nuniform vec4 u_param0;\nvarying vec2 v_textureCoordinates;\nvec4 getPosition(vec4 vd, vec2 uv){\n   float zd = czm_unpackDepth(vd);\n   zd = czm_reverseLogDepth(zd);\n   float d = (2.0 * zd - czm_depthRange.near - czm_depthRange.far) / (czm_depthRange.far - czm_depthRange.near);\n   vec2 xy = vec2((uv.x * 2.0 - 1.0), (uv.y * 2.0 - 1.0));\n   vec4 position = czm_inverseProjection * vec4(xy, d, 1.0);\n   position = u_invViewMatrix * position;\n   position /= position.w;\n   return position;\n}\nfloat distance0(vec3 c, vec3 n, vec3 p){\n   vec3 b = normalize(p - c);\n   n = normalize(n);\n   if (all(equal(n, b))){\n       return 0.0;\n   }\n   vec3 nc = cross(b, n);\n   b = cross(n, nc);\n   b = normalize(b);\n   return dot(b, p) - dot(b, c);\n}\nvoid main(){\n   vec4 color = texture2D(colorTexture, v_textureCoordinates);\n   vec4 currD = texture2D(depthTexture, v_textureCoordinates);\n   if(currD.r>=1.0){\n       gl_FragColor = color;\n       return;\n   }\n   vec4 position = getPosition(currD, v_textureCoordinates);\n   float z = distance0(u_center, u_normal, position.xyz);\n   float d = u_param0.z * u_param0.y;\n   float hw = u_param0.w / 2.0;\n   float hd = dot(u_normal, position.xyz) - dot(u_normal, u_center);\n   if (z < (d + hw) && z > (d - hw) && hd > -10000.0){\n       z = abs(z - d) / hw;\n       color.rgb = mix(color.rgb, u_color.rgb, u_color.a * (exp(-(pow(z, 5.0)))));\n   }\n   gl_FragColor = color;\n}",uniforms:{u_invViewMatrix:function(){return i.invViewMatrix},u_center:function(){return i.center},u_normal:function(){return i.normal},u_color:function(){return i.color},u_param0:function(){return r.x=i.life,r.y=i.time,r.z=i.speed,r.w=i.lineWidth,r}}}),i._scanCirclePostProcess.enabled=!1,i._viewer.scene.postProcessStages.add(i._scanCirclePostProcess)}}}(window.Cesium),function(e){var t=e.GeoWind=function(t,i){return this.viewer=t.viewer,this.data=t.data,this.level=t.level,this.rectangle=t.rectangle,this.options=t.options,this.options.velocityScale=e.defaultValue(this.options.velocityScale,.11),this.options.particleMultiplier=e.defaultValue(this.options.particleMultiplier,.002),this.options.maxWindIntensity=e.defaultValue(this.options.maxWindIntensity,30),this.options.lineWidth=e.defaultValue(this.options.lineWidth,2),this.options.opacity=e.defaultValue(this.options.opacity,.6),this.options.colors=e.defaultValue(this.options.colors,["#00ffff","#64f0ff","#87e1ff","#a0d0ff","#b5c0ff","#c6adff","#d49bff","#e185ff","#ec6dff","#ff1edb"]),this.canvas=document.createElement("canvas"),this.canvasContext=this.canvas.getContext("2d"),this._initWindy(),this.setData(this.data),this};t.prototype._initWindy=function(){var e=this;this.Windy=function(){function t(e,t,i,r,o,n){var a=1-e,s=1-t,l=a*s,u=e*s,h=a*t,c=e*t,p=i[0]*l+r[0]*u+o[0]*h+n[0]*c,d=i[1]*l+r[1]*u+o[1]*h+n[1]*c;return[p,d,Math.sqrt(p*p+d*d)]}function i(e){var i=null,r=null;return e.forEach((function(e){switch(e.header.parameterCategory+","+e.header.parameterNumber){case"2,2":i=e;break;case"2,3":r=e}})),function(e,i){var r=e.data,o=i.data;return{header:e.header,data:function(e){return[r[e],o[e]]},interpolate:t}}(i,r)}function r(e){return e/180*Math.PI}function o(e){return e/(Math.PI/180)}function n(e){return Math.log(Math.tan(e/2+Math.PI/4))}function a(e,t,i){var r={},n=s,a=[],l=e.x;function u(i){for(var s,l,u,h,c,p,d,f,g,m,_,v,y,A,b,w,E,G,S,P=[],T=e.y;T<=e.yMax;T+=2){var x=(v=i,y=T,b=(A=t).east-A.west,E=(w=A.width/o(b)*360/(2*Math.PI))/2*Math.log((1+Math.sin(A.south))/(1-Math.sin(A.south))),G=(A.height+E-y)/w,S=180/Math.PI*(2*Math.atan(Math.exp(G))-Math.PI/2),[o(A.west)+v/A.width*o(b),S]),M=x[0],L=x[1];if(isFinite(M)){var N=I(M,L);N&&(s=r,l=M,u=L,h=i,c=T,p=n,f=t,g=(d=N)[0]*p,m=d[1]*p,_=C(s,l,u,h,c,f),d[0]=_[0]*g+_[2]*m,d[1]=_[1]*g+_[3]*m,N=d,P[T+1]=P[T]=N)}}a[i+1]=a[i]=P}!function t(){for(var r=c()();l<e.width;)if(u(l),l+=2,1e3<c()()-r)return void setTimeout(t,25);!function(e,t,i){function r(t,i){var r=e[Math.round(t)];return r&&r[Math.round(i)]||f}r.release=function(){e=[]},r.randomize=function(e){for(var i,o,n=0;null===r(i=Math.round(Math.floor(Math.random()*t.width)+t.x),o=Math.round(Math.floor(Math.random()*t.height)+t.y))[2]&&n++<30;);return e.x=i,e.y=o,e},i(t,r)}(a,e,i)}()}var s=e.options.velocityScale,l=e.options.maxWindIntensity,u=e.options.lineWidth,h=e.options.particleMultiplier,p=e.options.opacity,d=e.options.colors,f=[NaN,NaN,null],m=2*Math.PI,_=Math.pow(10,-5.2),v=function(e){return null!=e},C=function(e,t,i,r,o,n){var a=t<0?_:-_,s=i<0?_:-_,l=y(i,t+a,n),u=y(i+s,t,n),h=Math.cos(i/360*m);return[(l[0]-r)/a/h,(l[1]-o)/a/h,(u[0]-r)/s,(u[1]-o)/s]},y=function(e,t,i){var o=n(i.south),a=n(i.north),s=i.width/(i.east-i.west),l=i.height/(a-o),u=n(r(e));return[(r(t)-i.west)*s,u=(a-u)*l]},A=function(){b.field&&b.field.release(),b.timer&&clearTimeout(b.timer)},I=function(e){var t=i(e),r=t.header,o=r.lo1,n=r.la1,a=r.dx,s=r.dy,l=r.nx,u=r.ny,h=new Date(r.refTime);h.setHours(h.getHours()+r.forecastTime);for(var c=[],p=0,d=360<=Math.floor(l*a),f=0;f<u;f++){for(var g=[],m=0;m<l;m++,p++)g[m]=t.data(p);d&&g.push(g[0]),c[f]=g}return function(e,i){var r,l=function(e,t){return e-t*Math.floor(e/t)}(e-o,360)/a,u=(n-i)/s,h=Math.floor(l),p=h+1,d=Math.floor(u),f=d+1;if(r=c[d]){var g=r[h],m=r[p];if(v(g)&&v(m)&&(r=c[f])){var _=r[h],C=r[p];if(v(_)&&v(C))return t.interpolate(l-h,u-d,g,m,_,C)}}return null}}(e.data),b={start:function(t,i,o,n){var s={south:r(n[0][1]),north:r(n[1][1]),east:r(n[1][0]),west:r(n[0][0]),width:i,height:o};A(),a(function(e,t,i){var r=e[0],o=e[1],n=Math.round(r[0]),a=Math.max(Math.floor(r[1],0),0);return Math.min(Math.ceil(o[0],t),t-1),{x:n,y:a,xMax:t,yMax:Math.min(Math.ceil(o[1],i),i-1),width:t,height:i}}(t,i,o),s,(function(t,i){b.field=i,function(t,i){function r(e){return"#"==e.charAt(0)?e.substring(1,7):e}var o,n,a=(o=l,n=[],d.forEach((function(e){n.push("rgba("+function(e){return g()(r(e).substring(0,2),16)}(e)+", "+function(e){return g()(r(e).substring(2,4),16)}(e)+", "+function(e){return g()(r(e).substring(4,6),16)}(e)+", "+p+")")})),n.indexFor=function(e){return Math.floor(Math.min(e,o)/o*(n.length-1))},n),s=a.map((function(){return[]})),c=Math.round(t.width*t.height*h);/android|blackberry|iemobile|ipad|iphone|ipod|opera mini|webos/i.test(navigator.userAgent)&&(c*=.075);for(var f=[],m=0;m<c;m++)f.push(i.randomize({age:Math.floor(100*Math.random())+0}));var _=e.canvasContext;_.lineWidth=u,_.fillStyle="rgba(0, 0, 0, 0.97)",function e(){try{b.timer=setTimeout((function(){requestAnimationFrame(e),s.forEach((function(e){e.length=0})),f.forEach((function(e){100<e.age&&(i.randomize(e).age=0);var t=e.x,r=e.y,o=i(t,r),n=o[2];if(null===n)e.age=100;else{var l=t+o[0],u=r+o[1];null!==i(l,u)[2]?(e.xt=l,e.yt=u,s[a.indexFor(n)].push(e)):(e.x=l,e.y=u)}e.age+=1})),function(){var e=_.globalCompositeOperation;_.globalCompositeOperation="destination-in",_.fillRect(t.x,t.y,t.width,t.height),_.globalCompositeOperation=e,s.forEach((function(e,t){0<e.length&&(_.beginPath(),_.strokeStyle=a[t],e.forEach((function(e){_.moveTo(e.x,e.y),_.lineTo(e.xt,e.yt),e.x=e.xt,e.y=e.yt})),_.stroke())}))}()}),50)}catch(e){console.error(e)}}()}(t,i)}))},stop:A};return b}},t.prototype._calculateBounds=function(){var t=this.rectangle[0][0],i=this.rectangle[1][1],r=this.rectangle[1][0],o=this.rectangle[0][1],n=this.level,a=this._locationCoordinate(t,o,n),s=this._locationCoordinate(r,i,n);this._size=[512*Math.abs(a[0]-s[0]),512*Math.abs(a[1]-s[1])],this._bounds=[[t,o],[r,i]],this._rectangle=e.Rectangle.fromDegrees(t,o,r,i)},t.prototype._locationCoordinate=function(e,t,i){return[(180+e)*Math.pow(2,i)/360,(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))*Math.pow(2,i)/360]},t.prototype._getCenterPoint=function(){var t=this.viewer.canvas,i=new e.Cartesian2(t.clientWidth/2,t.clientHeight/2),r=this.viewer.camera.getPickRay(i);return this.viewer.scene.globe.pick(r,this.viewer.scene)||this.viewer.camera.pickEllipsoid(i)},t.prototype._getLevel=function(){var t=e.Ellipsoid.WGS84,i=this._getCenterPoint();if(!i){var r=this.viewer.scene.globe,o=this.viewer.camera.positionCartographic.clone(),n=r.getHeight(o);o.height=n||0,i=t.cartographicToCartesian(o)}var a=e.Cartesian3.distance(i,this.viewer.camera.position)/1405.5;return Math.log2(78271.51696402031/a)-1.2},t.prototype.show=function(e){this._layer&&(this._layer.show=e)},t.prototype.remove=function(){this._layer&&this.viewer.entities.remove(this._layer)},t.prototype.updateLayer=function(){var t=this;this._calculateBounds(),this.canvas.width=Math.round(this._size[0]),this.canvas.height=Math.round(this._size[1]),setTimeout((function(){t.windy.start([[0,0],t._size],t._size[0],t._size[1],t._bounds)}),1),this._layer&&this.viewer.entities.remove(this._layer);var i=new e.ImageMaterialProperty({image:new e.CallbackProperty((function(){return t.canvas.toDataURL()}),!1)});"1.21"<=e.VERSION?i.transparent=!0:"1.16"<=e.VERSION&&(i.alpha=.99),this._layer=this.viewer.entities.add({rectangle:{coordinates:this._rectangle,material:i}})},t.prototype.setData=function(e){this.data=e,this.windy=new this.Windy,this.updateLayer()}}(window.Cesium),function(e){var t="GEO_OVERVIEW_ICO_SOURCE",i="GEO_OVERVIEW_ICO_LAYER",r="GEO_OVERVIWE_ICO_ID";function o(t,i){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),this.viewer=t.viewer,this.map2D=null,this.map2DOptions=e.defaultValue(t.map2DOptions,{mapCRS:{topTileExtent:[-180,-270,180,90],coordtransform:"none"},style:{version:8,sources:{tdt_source_overview:{type:"raster",tiles:["http://t3.tianditu.com/vec_c/wmts?SERVICE=WMTS&REQUEST=GetTile&LAYER=vec&TILEMATRIXSET=c&FORMAT=tiles&VERSION=1.0.0&STYLE=default&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&tk=e90d56e5a09d1767899ad45846b0cefd"],tileSize:256}},layers:[{id:"tdt_layer_overview",type:"raster",source:"tdt_source_overview",layout:{visibility:"visible"}}]},zoom:4,center:[112.939,31.377],renderWorldCopies:!1,isIntScrollZoom:!0,isAttributionControl:!1}),this.width=t.width,this.height=t.height,this.layout=e.defaultValue(t.layout,"BR"),this.movingTargetIco=t.movingTargetIco,this.movingTargetIcoSize=e.defaultValue(t.movingTargetIcoSize,1),this.movingTargetZoomLevel=e.defaultValue(t.movingTargetZoomLevel,14),this.callback="function"==typeof i?i:function(){},this.scalable=!1,this._isReady=!1,this._latelyUpdateStamp=0,this._modelType=o.modelType.ROAM,this._initOverview(),this._bindEvent()}o.prototype._initOverview=function(){var e=this.viewer.cesiumWidget.container.parentElement,t=document.createElement("div");t.className="geo-cesium-viewer-overview",t.style.display="block",t.style.position="absolute",t.style.width=this.width+"px",t.style.height=this.height+"px",this.layout.toLocaleUpperCase().startsWith("B")?t.style.bottom="5px":this.layout.toLocaleUpperCase().startsWith("T")&&(t.style.top="5px"),this.layout.toLocaleUpperCase().endsWith("R")?t.style.right="5px":this.layout.toLocaleUpperCase().endsWith("L")&&(t.style.left="5px"),e.appendChild(t);var i=document.createElement("div");i.style.position="absolute",i.style.width=i.style.height="100%",t.appendChild(i),this.map2DOptions.container||(this.map2DOptions.container=i),this.map2D=new GeoGlobe.Map(this.map2DOptions)},o.prototype._bindEvent=function(){var e=this;this.map2D.on("load",(function(){var o=e.map2D;o.loadImage(e.movingTargetIco,(function(n,a){var s=e.movingTargetIcoSize,l=o.getCenter().toArray();o.addImage(r,a),o.addSource(t,{type:"geojson",data:{type:"Point",coordinates:l}}),o.addLayer({id:i,source:t,type:"symbol",layout:{"icon-image":r,"icon-size":s,"icon-rotate":0}}),e._isReady=!0,e.callback&&e.callback(e)}))})),this.viewer.scene.preRender.addEventListener((function(){e.updateAimingRect()}))},o.prototype._unbindEvent=function(){for(var e=this.viewer.scene.preRender._listeners,t=0;t<e.length;t++)"GEOOVERVIEW_3D_RENDER_EVENT"===e[t].name&&e.splice(t,1)},o.prototype.getMap2D=function(){return this.map2D},o.prototype.getMap2DLayer=function(e){return this.map2D?this.map2D.getLayer(e):null},o.prototype.addMap2DLayer=function(e,t){return this.map2D?this.map2D.addLayer(e,t):null},o.prototype.removeMap2DLayer=function(e){return this.map2D?this.map2D.removeLayer(e):null},o.prototype.getMap2DSource=function(e){return this.map2D?this.map2D.getSource(e):null},o.prototype.addMap2DSource=function(e,t){return this.map2D?this.map2D.addSource(e,t):null},o.prototype.removeMap2DSource=function(e){return this.map2D?this.map2D.removeSource(e):null},o.prototype.updateAimingRect=function(){var r=(new Date).getTime();if(!(r-this._latelyUpdateStamp<600)&&(this._latelyUpdateStamp=r,this.viewer&&this._isReady)){this.viewer,this.viewer.scene;var n,a,s=this.viewer.canvas,l=this.viewer.camera,u=this.viewer.scene.globe,h=this.map2D;if(this._modelType===o.modelType.ROAM){var c=e.Ellipsoid.WGS84,p=null,d=new e.Cartesian2(s.clientWidth/2,s.clientHeight/2),f=this.viewer.camera.getPickRay(d);if(!(p=(p=this.viewer.scene.globe.pick(f,this.viewer.scene))||l.pickEllipsoid(d))){var g=l.positionCartographic.clone(),m=u.getHeight(g);g.height=m||0,p=c.cartographicToCartesian(g)}var _=e.Cartesian3.distance(p,l.position)/1405.5;n=Math.log2(78271.51696402031/_)-5.2;var v=c.cartesianToCartographic(p);a=[e.Math.toDegrees(v.longitude),e.Math.toDegrees(v.latitude)],this.scalable||h.setZoom(n),h.setCenter(a),h.getSource(t).setData({type:"Point",coordinates:a})}else this._modelType===o.modelType.WALK&&(n=this.movingTargetZoomLevel,this.scalable||h.setZoom(n),p=l.positionCartographic.clone(),a=[e.Math.toDegrees(p.longitude),e.Math.toDegrees(p.latitude)],h.setCenter(a),h.getSource(t).setData({type:"Point",coordinates:a}));h.setLayoutProperty(i,"icon-rotate",e.Math.toDegrees(l.heading))}},o.prototype.setModel=function(t){0<u()(e.GeoOverviewWidget.modelType).filter((function(i){return e.GeoOverviewWidget.modelType[i]===t})).length&&(this._modelType=t)},o.prototype.setScalable=function(e){this.scalable="boolean"!=typeof e||e},o.modelType={ROAM:0,WALK:1},e.GeoOverviewWidget=o}(window.Cesium),function(e){var t=e.GeoGeographicTilingScheme=function(t){t=e.defaultValue(t,{}),this._numberOfLevelZeroTilesX=e.defaultValue(t.numberOfLevelZeroTilesX,1),this._numberOfLevelZeroTilesY=e.defaultValue(t.numberOfLevelZeroTilesY,.5),this._ellipsoid=e.defaultValue(t.ellipsoid,e.Ellipsoid.WGS84),this._rectangle=e.defaultValue(t.rectangle,e.Rectangle.MAX_VALUE),this._projection=new e.GeographicProjection(this._ellipsoid)};t.prototype=new e.GeographicTilingScheme,delete t.prototype._numberOfLevelZeroTilesX,delete t.prototype._numberOfLevelZeroTilesY,delete t.prototype._ellipsoid,delete t.prototype._rectangle,delete t.prototype._projection,t.prototype.getNumberOfYTilesAtLevel=function(e){return this._numberOfLevelZeroTilesY*Math.pow(2,e)}}(window.Cesium),function(e){var t=e.GeoTerrainProvider=function(i){if(i=e.defaultValue(i,e.defaultValue.EMPTY_OBJECT),!e.defined(i.urls))throw new e.DeveloperError("options.urls is required.");this._dataType=e.defaultValue(i.dataType,e.GeoTerrainProvider.INT),this._tileType=e.defaultValue(i.tileType,t.HEIGHTMAP),this._urls=i.urls,this._urls_length=this._urls.length,this._url_i=0,this._url_step=0,this._maxTerrainLevel=e.defaultValue(i.dataType,e.GeoTerrainProvider.INT),this._errorEvent=new e.Event,this._ready=!1,this._readyPromise=e.when.defer(),this._proxy=i.proxy,this._terrainDataStructure={heightScale:.001,heightOffset:-1e3,elementsPerHeight:3,stride:4,elementMultiplier:256,isBigEndian:!0};var r=i.credit;"string"==typeof r&&(r=new e.Credit(r)),this._credit=r,this._tilingScheme=void 0,this._rectangles=[];var o=e.defaultValue(i.ellipsoid,e.Ellipsoid.WGS84);this._tilingScheme=new e.GeographicTilingScheme({ellipsoid:o}),this._heightmapWidth=64,this._heightmapHeight=64,this._levelZeroMaximumGeometricError=e.TerrainProvider.getEstimatedLevelZeroGeometricErrorForAHeightmap(o,Math.min(this._heightmapWidth,this._heightmapHeight),this._tilingScheme.getNumberOfXTilesAtLevel(0)),this._ready=!0,this._readyPromise.resolve(!0),this._name=i.name,this._opacity=i.opacity,this._maxExtent=i.maxExtent,this._topLevel=e.defaultValue(i.topLevel,5),this._bottomLevel=e.defaultValue(i.bottomLevel,25)};function i(t,i){return(i=e.defined(i)?i:new e.Request).url=t,i.requestFunction=function(){var i=new XMLHttpRequest;return i.open("GET",t,!0),i.responseType="arraybuffer",i.async=!1,i.send(null),function(t){var i=e.when.defer();return t.onreadystatechange=function(){if(4===t.readyState&&200===t.status&&e.defined(t.response)){for(var r=new DataView(t.response),o=new Uint8Array(r.byteLength),n=0;n<r.byteLength;)o[n]=r.getUint8(n,!0),n++;var a=function(t){if(!(t.length<1e3)){var i=new Zlib.Inflate(t);return e.defined(i)?i.decompress():void 0}}(o);e.defined(a)?i.resolve(a):i.reject(void 0)}},i.promise}(i)},e.RequestScheduler.request(i)}e.defineProperties(t.prototype,{errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){return this._credit}},tilingScheme:{get:function(){if(!this.ready)throw new e.DeveloperError("requestTileGeometry must not be called before ready returns true.");return this._tilingScheme}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},hasWaterMask:{get:function(){return!1}},hasVertexNormals:{get:function(){return!1}}}),t.prototype.requestTileGeometry=function(r,n,a,s){if(!this.ready)throw new e.DeveloperError("requestTileGeometry must not be called before ready returns true.");1<this._urls_length&&(this._url_step<8?this._url_step++:(this._url_step=0,this._url_i++,this._url_i>=this._urls_length&&(this._url_i=0)));var l=this._urls[this._url_i];if(this._tilingScheme.getNumberOfYTilesAtLevel(a),a<this._bottomLevel&&a>=this._topLevel){var u,h=-1===l.indexOf("?")?"?":"&",c=l+h+"x="+r+"&y="+n+"&l="+(a+1),p=this._proxy;if(e.defined(p)&&(c=p.getURL(c)),s=e.defaultValue(s,!0)){if(u=i(c,s),!e.defined(u))return}else u=i(c);if(this._tileType==t.QUANTIZED_MESH)return u.then((function(e){return function(e,t,i,r,o,n,a){var s=a.littleEndianExtensionSize,l=0,u=3*Float64Array.BYTES_PER_ELEMENT,h=4*Float64Array.BYTES_PER_ELEMENT,c=3*Uint16Array.BYTES_PER_ELEMENT,p=Uint16Array.BYTES_PER_ELEMENT,d=3*p,f=new DataView(t),g=new Cartesian3(f.getFloat64(l,!0),f.getFloat64(l+8,!0),f.getFloat64(l+16,!0));l+=u;var m=f.getFloat32(l,!0);l+=Float32Array.BYTES_PER_ELEMENT;var _=f.getFloat32(l,!0);l+=Float32Array.BYTES_PER_ELEMENT;var v=new BoundingSphere(new Cartesian3(f.getFloat64(l,!0),f.getFloat64(l+8,!0),f.getFloat64(l+16,!0)),f.getFloat64(l+u,!0));l+=h;var C=new Cartesian3(f.getFloat64(l,!0),f.getFloat64(l+8,!0),f.getFloat64(l+16,!0));l+=u;var y=f.getUint32(l,!0);l+=Uint32Array.BYTES_PER_ELEMENT;var A=new Uint16Array(t,l,3*y);l+=y*c,65536<y&&(d=3*(p=Uint32Array.BYTES_PER_ELEMENT));var I=A.subarray(0,y),b=A.subarray(y,2*y),w=A.subarray(2*y,3*y);AttributeCompression.zigZagDeltaDecode(I,b,w),l%p!=0&&(l+=p-l%p);var E=f.getUint32(l,!0);l+=Uint32Array.BYTES_PER_ELEMENT;var G=IndexDatatype.createTypedArrayFromArrayBuffer(y,t,l,3*E);l+=E*d;for(var S=0,P=G.length,T=0;T<P;++T){var x=G[T];G[T]=S-x,0===x&&++S}var M=f.getUint32(l,!0);l+=Uint32Array.BYTES_PER_ELEMENT;var L=IndexDatatype.createTypedArrayFromArrayBuffer(y,t,l,M);l+=M*p;var N=f.getUint32(l,!0);l+=Uint32Array.BYTES_PER_ELEMENT;var R=IndexDatatype.createTypedArrayFromArrayBuffer(y,t,l,N);l+=N*p;var O=f.getUint32(l,!0);l+=Uint32Array.BYTES_PER_ELEMENT;var D=IndexDatatype.createTypedArrayFromArrayBuffer(y,t,l,O);l+=O*p;var F=f.getUint32(l,!0);l+=Uint32Array.BYTES_PER_ELEMENT;var U,B,k=IndexDatatype.createTypedArrayFromArrayBuffer(y,t,l,F);for(l+=F*p;l<f.byteLength;){var V=f.getUint8(l,!0);l+=Uint8Array.BYTES_PER_ELEMENT;var W=f.getUint32(l,s);if(l+=Uint32Array.BYTES_PER_ELEMENT,V===QuantizedMeshExtensionIds.OCT_VERTEX_NORMALS&&e._requestVertexNormals)U=new Uint8Array(t,l,2*y);else if(V===QuantizedMeshExtensionIds.WATER_MASK&&e._requestWaterMask)B=new Uint8Array(t,l,W);else if(V===QuantizedMeshExtensionIds.METADATA&&e._requestMetadata){var j=f.getUint32(l,!0);if(0<j){var z=getStringFromTypedArray(new Uint8Array(t),l+Uint32Array.BYTES_PER_ELEMENT,j),H=JSON.parse(z).available;if(defined(H))for(var q=0;q<H.length;++q)for(var X=i+q+1,Y=H[q],K=e._tilingScheme.getNumberOfYTilesAtLevel(X),Q=0;Q<Y.length;++Q){var Z=Y[Q],J=K-Z.endY-1,$=K-Z.startY-1;e.availability.addAvailableTileRange(X,Z.startX,J,Z.endX,$),a.availability.addAvailableTileRange(X,Z.startX,J,Z.endX,$)}}a.availabilityTilesLoaded.addAvailableTileRange(i,r,o,r,o)}l+=W}var ee,te=5*e.getLevelMaximumGeometricError(i),ie=e._tilingScheme.tileXYToRectangle(r,o,i);return ie.width<CesiumMath.PI_OVER_TWO+CesiumMath.EPSILON5&&(ee=OrientedBoundingBox.fromRectangle(ie,m,_,e._tilingScheme.ellipsoid)),new QuantizedMeshTerrainData({center:g,minimumHeight:m,maximumHeight:_,boundingSphere:v,orientedBoundingBox:ee,horizonOcclusionPoint:C,quantizedVertices:A,encodedNormals:U,indices:G,westIndices:L,southIndices:R,eastIndices:D,northIndices:k,westSkirtHeight:te,southSkirtHeight:te,eastSkirtHeight:te,northSkirtHeight:te,childTileMask:e.availability.computeChildMaskForTile(i,r,o),waterMask:B,credits:e._tileCredits})}(provider,e,a,r,n)}));var d=this;return e.when(u,(function(t){var i=d.transformBuffer(t);if(e.defined(i)){var s=new e.HeightmapTerrainData({buffer:i,width:d._heightmapWidth,height:d._heightmapHeight,childTileMask:o(d,r,n,a),structure:d._terrainDataStructure});return s._skirtHeight=6e3,s}}))}if(a<this._topLevel){var f=this._heightmapWidth,g=this._heightmapHeight,m=o(this,r,n,a),_=this._terrainDataStructure;return new e.HeightmapTerrainData({buffer:this.getvHeightBuffer(),width:f,height:g,childTileMask:m,structure:_})}},t.prototype.getLevelMaximumGeometricError=function(t){if(!this.ready)throw new e.DeveloperError("requestTileGeometry must not be called before ready returns true.");return this._levelZeroMaximumGeometricError/(1<<t)},t.prototype.getTileDataAvailable=function(e,t,i){if(i<25)return!0},t.prototype.getvHeightBuffer=function(){var t=this._vHeightBuffer;if(!e.defined(t)){t=new Uint8ClampedArray(this._heightmapWidth*this._heightmapHeight*4);for(var i=0;i<this._heightmapWidth*this._heightmapHeight*4;)t[i++]=15,t[i++]=66,t[i++]=64,t[i++]=255;this._vHeightBuffer=t}return t},t.prototype.transformBuffer=function(t){var i=2;this._dataType===e.GeoTerrainProvider.INT?i=2:this._dataType===e.GeoTerrainProvider.FLOAT&&(i=4);var r=t;if(r.length!==22500*i)return null;for(var o,n,a,s,l,u=new ArrayBuffer(i),h=new DataView(u),c=this._heightmapWidth,p=this._heightmapHeight,d=new Uint8Array(c*p*4),f=0;f<p;f++)for(var m=0;m<c;m++){s=g()(149*f/(p-1)),l=g()(149*m/(c-1)),(1e4<(o=4===i?(n=i*(150*s+l),h.setInt8(0,r[n]),h.setInt8(1,r[n+1]),h.setInt8(2,r[n+2]),h.setInt8(3,r[n+3]),h.getFloat32(0,!0)):r[n=i*(150*s+l)]+256*r[n+1])||o<-2e3)&&(o=0);var _=(o+1e3)/.001;d[a=4*(f*c+m)]=_/65536,d[1+a]=(_-256*d[a]*256)/256,d[2+a]=_-256*d[a]*256-256*d[1+a],d[3+a]=255}return d};var r=new e.Rectangle;function o(t,i,o,a){for(var s=t._tilingScheme,l=t._rectangles,u=s.tileXYToRectangle(i,o,a),h=0,c=0;c<l.length&&15!==h;++c){var p=l[c];if(!(p.maxLevel<=a)){var d=p.rectangle,f=e.Rectangle.intersection(d,u,r);e.defined(f)&&(n(s,d,2*i,2*o,a+1)&&(h|=4),n(s,d,2*i+1,2*o,a+1)&&(h|=8),n(s,d,2*i,2*o+1,a+1)&&(h|=1),n(s,d,2*i+1,2*o+1,a+1)&&(h|=2))}}return h}function n(t,i,o,n,a){var s=t.tileXYToRectangle(o,n,a);return e.defined(e.Rectangle.intersection(s,i,r))}t.INT="int",t.FLOAT="float",t.QUANTIZED_MESH="quantized-mesh",t.HEIGHTMAP="heightmap"}(window.Cesium),1.5<=Cesium.VERSION||1.5<=Cesium.VERSION.substring(0,4)){s()(Cesium.Model.prototype,{_cachedGltf:{set:function(e){this._vtxf_cachedGltf=e,this._vtxf_cachedGltf&&this._vtxf_cachedGltf._gltf&&function(e){if(e.extensionsUsed&&(!e.extensionsUsed||-1!=e.extensionsUsed.indexOf("KHR_technique_webgl"))){var t=e.extensionsUsed.indexOf("KHR_technique_webgl"),i=e.extensionsRequired.indexOf("KHR_technique_webgl");if(-1!==t){e.extensionsRequired.splice(i,1,"KHR_techniques_webgl"),e.extensionsUsed.splice(t,1,"KHR_techniques_webgl"),e.extensions=e.extensions||{},e.extensions.KHR_techniques_webgl={},e.extensions.KHR_techniques_webgl.programs=e.programs,e.extensions.KHR_techniques_webgl.shaders=e.shaders,e.extensions.KHR_techniques_webgl.techniques=e.techniques;var r=e.extensions.KHR_techniques_webgl.techniques;e.materials.forEach((function(t,i){e.materials[i]&&e.materials[i].name&&(e.materials[i].extensions={KHR_technique_webgl:{technique:e.materials[i].technique,values:{diffuse:0}}}),void 0===e.materials[i].extensions&&(e.materials[i].extensions={},e.materials[i].extensions.KHR_technique_webgl={}),e.materials[i].extensions.KHR_technique_webgl.values=e.materials[i].values,e.materials[i].extensions.KHR_techniques_webgl=e.materials[i].extensions.KHR_technique_webgl;var o=e.materials[i].extensions.KHR_techniques_webgl;for(var n in o.values){void 0===o.technique&&(o.technique=e.materials[i].technique);var a=r[o.technique].uniforms;for(var s in a)if(a[s]===n){o.values[s]=o.values[n],delete o.values[n];break}}})),r.forEach((function(e){for(var t in e.attributes){var i=e.attributes[t];e.attributes[t]=e.parameters[i]}for(var r in e.uniforms)i=e.uniforms[r],e.uniforms[r]=e.parameters[i]}))}}}(this._vtxf_cachedGltf._gltf)},get:function(){return this._vtxf_cachedGltf}}})}R="function"==typeof w.a&&"symbol"==I()(C.a)?function(e){return I()(e)}:function(e){return e&&"function"==typeof w.a&&e.constructor===w.a&&e!==w.a.prototype?"symbol":I()(e)},function(e){var t=e.defaultValue;function i(i){i=t(i,t.EMPTY_OBJECT),this.viewer=i.viewer,this.tileset=i.tileset,this.source=i.source,this.autoActivate=t(i.autoActivate,!0),this.active=t(i.active,null),this.originalColor=t(i.originalColor,e.Color.fromBytes(255,50,50,1)),this.moveColor=t(i.moveColor,e.Color.fromBytes(255,50,50,122)),this.selectedColor=t(i.selectedColor,e.Color.fromBytes(50,255,50,122)),this.selectedFeature=void 0,this.groundPrimitiveCollection=new e.PrimitiveCollection,this.source&&"geojson"===this.source.type&&this._loadGeoJSON(this.source.data),this.handler=new e.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.autoActivate&&this.activateAction(),this._seletedEvent=new e.Event}e.defined,e.defineProperties(i.prototype,{seletedEvent:{get:function(){return this._seletedEvent}}}),i.prototype._loadGeoJSON=function(e){var t=this;if("object"===(void 0===e?"undefined":R(e)))this._loadGroundPrimitives(e);else if("string"==typeof e){var i=new window.XMLHttpRequest;i.open("GET",e,!0),i.withCredentials=!1,i.setRequestHeader("Accept","application/json"),i.onerror=function(){console.error(i.statusText)},i.onload=function(){if(200<=i.status&&i.status<300&&i.response){var e=JSON.parse(i.response);t._loadGroundPrimitives(e)}},i.send()}else console.warn("data的类型不被支持!")},i.prototype._loadGroundPrimitives=function(t){this.groundPrimitiveCollection.isDestroyed()&&(this.groundPrimitiveCollection=new e.PrimitiveCollection);for(var i=0;i<t.features.length;i++){var r=t.features[i];if("Polygon"===r.geometry.type){for(var o=[],n=0;n<r.geometry.coordinates[0].length;n++)o.push(r.geometry.coordinates[0][n][0]),o.push(r.geometry.coordinates[0][n][1]);var a=new e.GeometryInstance({geometry:e.PolygonGeometry.fromPositions({positions:e.Cartesian3.fromDegreesArray(o),vertexFormat:e.EllipsoidSurfaceAppearance.VERTEX_FORMAT}),attributes:{color:e.ColorGeometryInstanceAttribute.fromColor(this.originalColor)},id:{tag:"GEO_MONOMER_FEATURE",description:r}}),s=new e.GroundPrimitive({geometryInstances:a,appearance:new e.PerInstanceColorAppearance,show:!0,classificationType:e.ClassificationType.BOTH});this.groundPrimitiveCollection.add(s)}else console.warn("要素类型是"+r.geometry.type+"类型，该类型不被支持！")}this.viewer.scene.primitives.add(this.groundPrimitiveCollection)},i.prototype.reloadGeoJSON=function(e){this.groundPrimitiveCollection&&this.groundPrimitiveCollection.destroy(),this._loadGeoJSON(e)},i.prototype.isContaintFeature=function(e){return this.groundPrimitiveCollection.contains(e.primitive)},i.prototype.activateAction=function(){if(!0!==this.active){this.active=!0;var t=this,i=null,r=null;t.handler.setInputAction((function(o){if(i&&i.id&&"GEO_MONOMER_FEATURE"==i.id.tag){if(r&&r.id&&i&&i.id&&i.id.description===r.id.description)return;i.primitive.getGeometryInstanceAttributes(i.id).color=e.ColorGeometryInstanceAttribute.toValue(t.originalColor),i=void 0}for(var n=void 0,a=t.viewer.scene.drillPick(o.endPosition,10),s=0;s<a.length;s++)if(a[s]&&a[s].id&&"GEO_MONOMER_FEATURE"==a[s].id.tag){n=a[s];break}if(e.defined(n)&&(!r&&n&&n.id&&"GEO_MONOMER_FEATURE"==n.id.tag||n&&n.id&&r&&r.id&&n.id.description!==r.id.description)){if(!t.isContaintFeature(n))return;(i=n).primitive.getGeometryInstanceAttributes(n.id).color=e.ColorGeometryInstanceAttribute.toValue(t.moveColor)}}),e.ScreenSpaceEventType.MOUSE_MOVE),t.handler.setInputAction((function(o){r&&(r.primitive.getGeometryInstanceAttributes(r.id).color=e.ColorGeometryInstanceAttribute.toValue(t.originalColor),r=void 0);for(var n=void 0,a=t.viewer.scene.drillPick(o.position,10),s=0;s<a.length;s++)if(a[s]&&a[s].id&&"GEO_MONOMER_FEATURE"==a[s].id.tag){n=a[s];break}if(e.defined(n)&&r!==n){if(n&&n.id&&r!==n){if(!t.isContaintFeature(n))return;(r=n).primitive.getGeometryInstanceAttributes(n.id).color=e.ColorGeometryInstanceAttribute.toValue(t.selectedColor),t.selectedFeature=r}n&&r&&i&&n.id===i.id&&(i=void 0),n&&n.id&&t._seletedEvent.raiseEvent(n)}}),e.ScreenSpaceEventType.LEFT_CLICK)}},i.prototype.deactivateAction=function(){!0===this.active&&(this.active=!1,this.selectedFeature&&this.selectedFeature.id&&(this.selectedFeature.primitive.getGeometryInstanceAttributes(this.selectedFeature.id).color=e.ColorGeometryInstanceAttribute.toValue(this.originalColor),this.selectedFeature=null),this.handler.removeInputAction(e.ScreenSpaceEventType.MOUSE_MOVE),this.handler.removeInputAction(e.ScreenSpaceEventType.LEFT_CLICK))},i.prototype.destroy=function(){this.deactivateAction(),this.handler=this.handler&&this.handler.destroy(),this.groundPrimitiveCollection=this.groundPrimitiveCollection&&this.groundPrimitiveCollection.destroy(),this.viewer=void 0,this.tileset=void 0,this.source=void 0,this.originalColor=void 0,this.moveColor=void 0,this.selectedColor=void 0,this.selectedFeature=void 0},e.Cesium3DTilesetMonomer=i}(window.Cesium),function(e){var t=e.BoundingSphere,i=e.Cartesian2,r=e.Cartesian3,o=e.Cartesian4,n=e.Cartographic,a=e.defaultValue,s=e.defined,l=e.defineProperties,u=e.DeveloperError,h=e.EasingFunction,c=e.Ellipsoid,p=e.EllipsoidGeodesic,d=e.Event,f=e.HeadingPitchRange,g=e.HeadingPitchRoll,m=e.Intersect,_=e.IntersectionTests,v=e.Math,C=e.Matrix3,y=e.Matrix4,A=e.OrthographicFrustum,I=e.OrthographicOffCenterFrustum,b=e.PerspectiveFrustum,w=e.Quaternion,E=e.Ray,G=e.Rectangle,S=e.Transforms,P=e.CameraFlightPath,T=e.MapMode2D,x=e.SceneMode;function M(e){if(!s(e))throw new u("scene is required.");this._scene=e,this._transform=y.clone(y.IDENTITY),this._invTransform=y.clone(y.IDENTITY),this._actualTransform=y.clone(y.IDENTITY),this._actualInvTransform=y.clone(y.IDENTITY),this._transformChanged=!1,this.position=new r,this._position=new r,this._positionWC=new r,this._positionCartographic=new n,this.direction=new r,this._direction=new r,this._directionWC=new r,this.up=new r,this._up=new r,this._upWC=new r,this.right=new r,this._right=new r,this._rightWC=new r,this.frustum=new b,this.frustum.aspectRatio=e.drawingBufferWidth/e.drawingBufferHeight,this.frustum.fov=v.toRadians(60),this.defaultMoveAmount=1e5,this.defaultLookAmount=Math.PI/60,this.defaultRotateAmount=Math.PI/3600,this.defaultZoomAmount=1e5,this.constrainedAxis=void 0,this.maximumZoomFactor=1.5,this._moveStart=new d,this._moveEnd=new d,this._changed=new d,this._changedPosition=void 0,this._changedDirection=void 0,this._changedFrustum=void 0,this.percentageChanged=.5,this._viewMatrix=new y,this._invViewMatrix=new y,L(this),this._mode=x.SCENE3D,this._modeChanged=!0;var t=e.mapProjection;this._projection=t,this._maxCoord=t.project(new n(Math.PI,v.PI_OVER_TWO)),this._max2Dfrustum=void 0,this._suspendTerrainAdjustment=!1,Ke(this,M.DEFAULT_VIEW_RECTANGLE,this.position,!0);var i=r.magnitude(this.position);i+=i*M.DEFAULT_VIEW_FACTOR,r.normalize(this.position,this.position),r.multiplyByScalar(this.position,i,this.position)}function L(e){y.computeView(e._position,e._direction,e._up,e._right,e._viewMatrix),y.multiply(e._viewMatrix,e._actualInvTransform,e._viewMatrix),y.inverseTransformation(e._viewMatrix,e._invViewMatrix)}M.TRANSFORM_2D=new y(0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1),M.TRANSFORM_2D_INVERSE=y.inverseTransformation(M.TRANSFORM_2D,new y),M.DEFAULT_VIEW_RECTANGLE=G.fromDegrees(-95,-20,-70,90),M.DEFAULT_VIEW_FACTOR=.5,M.DEFAULT_OFFSET=new f(0,-v.PI_OVER_FOUR,0),M.prototype._updateCameraChanged=function(){var e=this;if(0!==e._changed.numberOfListeners){var t=e.percentageChanged;if(e._mode!==x.SCENE2D){if(!s(e._changedDirection))return e._changedPosition=r.clone(e.positionWC,e._changedPosition),void(e._changedDirection=r.clone(e.directionWC,e._changedDirection));var i,o=v.acosClamped(r.dot(e.directionWC,e._changedDirection));i=s(e.frustum.fovy)?o/(.5*e.frustum.fovy):o;var n=r.distance(e.positionWC,e._changedPosition)/e.positionCartographic.height;(t<i||t<n)&&(e._changed.raiseEvent(Math.max(i,n)),e._changedPosition=r.clone(e.positionWC,e._changedPosition),e._changedDirection=r.clone(e.directionWC,e._changedDirection))}else{if(!s(e._changedFrustum))return e._changedPosition=r.clone(e.position,e._changedPosition),void(e._changedFrustum=e.frustum.clone());var a,l=e.position,u=e._changedPosition,h=e.frustum,c=e._changedFrustum,p=l.x+h.left,d=l.x+h.right,f=u.x+c.left,g=u.x+c.right,m=l.y+h.bottom,_=l.y+h.top,C=u.y+c.bottom,y=u.y+c.top,A=Math.max(p,f),I=Math.min(d,g),b=Math.max(m,C),w=Math.min(_,y);if(I<=A||_<=b)a=1;else{var E=c;p<f&&g<d&&m<C&&y<_&&(E=h),a=1-(I-A)*(w-b)/((E.right-E.left)*(E.top-E.bottom))}t<a&&(e._changed.raiseEvent(a),e._changedPosition=r.clone(e.position,e._changedPosition),e._changedFrustum=e.frustum.clone(e._changedFrustum))}}};var N=new y,R=new n;M.prototype._adjustHeightForTerrain=function(){var e=this._scene,t=e.screenSpaceCameraController,i=t.enableCollisionDetection,o=t.minimumCollisionTerrainHeight,n=t.minimumZoomDistance;if(!this._suspendTerrainAdjustment&&i){var a=this._mode,l=e.globe;if(s(l)&&a!==x.SCENE2D&&a!==x.MORPHING){var u,h,c=l.ellipsoid,p=e.mapProjection;y.equals(this.transform,y.IDENTITY)||(u=y.clone(this.transform,N),h=r.magnitude(this.position),this._setTransform(y.IDENTITY));var d=R;a===x.SCENE3D?c.cartesianToCartographic(this.position,d):p.unproject(this.position,d);var f=!1;if(d.height<o){var g=l.getHeight(d);s(g)&&(g+=n,d.height<g&&(d.height=g,a===x.SCENE3D?c.cartographicToCartesian(d,this.position):p.project(d,this.position),f=!0))}s(u)&&(this._setTransform(u),f&&(r.normalize(this.position,this.position),r.negate(this.position,this.direction),r.multiplyByScalar(this.position,Math.max(h,n),this.position),r.normalize(this.direction,this.direction),r.cross(this.direction,this.up,this.right),r.cross(this.right,this.direction,this.up)))}}};var O=new n,D=new r,F=new r,U=new o,B=new o,k=new o,V=new o,W=new o,j=new r;function z(e){var t=e._mode,i=!1,n=0;t===x.SCENE2D&&(i=(n=e.frustum.right-e.frustum.left)!==e._positionCartographic.height);var a=e._position,s=!r.equals(a,e.position)||i;s&&(a=r.clone(e.position,e._position));var l=e._direction,u=!r.equals(l,e.direction);u&&(r.normalize(e.direction,e.direction),l=r.clone(e.direction,e._direction));var h=e._up,c=!r.equals(h,e.up);c&&(r.normalize(e.up,e.up),h=r.clone(e.up,e._up));var p=e._right,d=!r.equals(p,e.right);d&&(r.normalize(e.right,e.right),p=r.clone(e.right,e._right));var f=e._transformChanged||e._modeChanged;e._transformChanged=!1,f&&(y.inverseTransformation(e._transform,e._invTransform),e._mode===x.COLUMBUS_VIEW||e._mode===x.SCENE2D?y.equals(y.IDENTITY,e._transform)?y.clone(M.TRANSFORM_2D,e._actualTransform):e._mode===x.COLUMBUS_VIEW?function(e){S.basisTo2D(e._projection,e._transform,e._actualTransform)}(e):function(e){var t=e._projection,i=t.ellipsoid,n=y.getColumn(e._transform,3,U),a=i.cartesianToCartographic(n,O),s=t.project(a,D),l=B;l.x=s.z,l.y=s.x,l.z=s.y,l.w=1;var u=o.clone(o.UNIT_X,W),h=o.add(y.getColumn(e._transform,0,F),n,F);i.cartesianToCartographic(h,a),t.project(a,s);var c=k;c.x=s.z,c.y=s.x,c.z=s.y,c.w=0,r.subtract(c,l,c),c.x=0;var p=V;if(r.magnitudeSquared(c)>v.EPSILON10)r.cross(u,c,p);else{var d=o.add(y.getColumn(e._transform,1,F),n,F);i.cartesianToCartographic(d,a),t.project(a,s),p.x=s.z,p.y=s.x,p.z=s.y,p.w=0,r.subtract(p,l,p),p.x=0,r.magnitudeSquared(p)<v.EPSILON10&&(o.clone(o.UNIT_Y,c),o.clone(o.UNIT_Z,p))}r.cross(p,u,c),r.normalize(c,c),r.cross(u,c,p),r.normalize(p,p),y.setColumn(e._actualTransform,0,c,e._actualTransform),y.setColumn(e._actualTransform,1,p,e._actualTransform),y.setColumn(e._actualTransform,2,u,e._actualTransform),y.setColumn(e._actualTransform,3,l,e._actualTransform)}(e):y.clone(e._transform,e._actualTransform),y.inverseTransformation(e._actualTransform,e._actualInvTransform),e._modeChanged=!1);var g=e._actualTransform;if(s||f)if(e._positionWC=y.multiplyByPoint(g,a,e._positionWC),t===x.SCENE3D||t===x.MORPHING)e._positionCartographic=e._projection.ellipsoid.cartesianToCartographic(e._positionWC,e._positionCartographic);else{var m=j;m.x=e._positionWC.y,m.y=e._positionWC.z,m.z=e._positionWC.x,t===x.SCENE2D&&(m.z=n),e._projection.unproject(m,e._positionCartographic)}if(u||c||d){var _=r.dot(l,r.cross(h,p,j));if(Math.abs(1-_)>v.EPSILON2){var C=1/r.magnitudeSquared(h),A=r.dot(h,l)*C,I=r.multiplyByScalar(l,A,j);h=r.normalize(r.subtract(h,I,e._up),e._up),r.clone(h,e.up),p=r.cross(l,h,e._right),r.clone(p,e.right)}}(u||f)&&(e._directionWC=y.multiplyByPointAsVector(g,l,e._directionWC),r.normalize(e._directionWC,e._directionWC)),(c||f)&&(e._upWC=y.multiplyByPointAsVector(g,h,e._upWC),r.normalize(e._upWC,e._upWC)),(d||f)&&(e._rightWC=y.multiplyByPointAsVector(g,p,e._rightWC),r.normalize(e._rightWC,e._rightWC)),(s||u||c||d||f)&&L(e)}function H(e,t){var i;return i=v.equalsEpsilon(Math.abs(e.z),1,v.EPSILON3)?Math.atan2(t.y,t.x)-v.PI_OVER_TWO:Math.atan2(e.y,e.x)-v.PI_OVER_TWO,v.TWO_PI-v.zeroToTwoPi(i)}function q(e){return v.PI_OVER_TWO-v.acosClamped(e.z)}function X(e,t,i){var r=0;return v.equalsEpsilon(Math.abs(e.z),1,v.EPSILON3)||(r=Math.atan2(-i.z,t.z),r=v.zeroToTwoPi(r+v.TWO_PI)),r}var Y=new y,K=new y;l(M.prototype,{transform:{get:function(){return this._transform}},inverseTransform:{get:function(){return z(this),this._invTransform}},viewMatrix:{get:function(){return z(this),this._viewMatrix}},inverseViewMatrix:{get:function(){return z(this),this._invViewMatrix}},positionCartographic:{get:function(){return z(this),this._positionCartographic}},positionWC:{get:function(){return z(this),this._positionWC}},directionWC:{get:function(){return z(this),this._directionWC}},upWC:{get:function(){return z(this),this._upWC}},rightWC:{get:function(){return z(this),this._rightWC}},heading:{get:function(){if(this._mode!==x.MORPHING){var e=this._projection.ellipsoid,t=y.clone(this._transform,Y),i=S.eastNorthUpToFixedFrame(this.positionWC,e,K);this._setTransform(i);var r=H(this.direction,this.up);return this._setTransform(t),r}}},pitch:{get:function(){if(this._mode!==x.MORPHING){var e=this._projection.ellipsoid,t=y.clone(this._transform,Y),i=S.eastNorthUpToFixedFrame(this.positionWC,e,K);this._setTransform(i);var r=q(this.direction);return this._setTransform(t),r}}},roll:{get:function(){if(this._mode!==x.MORPHING){var e=this._projection.ellipsoid,t=y.clone(this._transform,Y),i=S.eastNorthUpToFixedFrame(this.positionWC,e,K);this._setTransform(i);var r=X(this.direction,this.up,this.right);return this._setTransform(t),r}}},moveStart:{get:function(){return this._moveStart}},moveEnd:{get:function(){return this._moveEnd}},changed:{get:function(){return this._changed}}}),M.prototype.update=function(e){if(!s(e))throw new u("mode is required.");if(e===x.SCENE2D&&!(this.frustum instanceof I))throw new u("An OrthographicOffCenterFrustum is required in 2D.");if(!(e!==x.SCENE3D&&e!==x.COLUMBUS_VIEW||this.frustum instanceof b||this.frustum instanceof A))throw new u("A PerspectiveFrustum or OrthographicFrustum is required in 3D and Columbus view");var t=!1;if(e!==this._mode&&(this._mode=e,this._modeChanged=e!==x.MORPHING,t=this._mode===x.SCENE2D),t){var i=this._max2Dfrustum=this.frustum.clone();if(!(i instanceof I))throw new u("The camera frustum is expected to be orthographic for 2D camera control.");var r=i.top/i.right;i.right=2*this._maxCoord.x,i.left=-i.right,i.top=r*i.right,i.bottom=-i.top}this._mode===x.SCENE2D&&me(this,this.position);var o=this._scene.globe,n=!s(o)||o._surface.tileProvider.ready&&0===o._surface._tileLoadQueueHigh.length&&0===o._surface._tileLoadQueueMedium.length&&0===o._surface._tileLoadQueueLow.length&&0===o._surface._debug.tilesWaitingForChildren;this._suspendTerrainAdjustment&&(this._suspendTerrainAdjustment=!n),this._adjustHeightForTerrain()};var Q=new r,Z=new r,J=new r;M.prototype._setTransform=function(e){var t=r.clone(this.positionWC,Q),i=r.clone(this.upWC,Z),o=r.clone(this.directionWC,J);y.clone(e,this._transform),this._transformChanged=!0,z(this);var n=this._actualInvTransform;y.multiplyByPoint(n,t,this.position),y.multiplyByPointAsVector(n,o,this.direction),y.multiplyByPointAsVector(n,i,this.up),r.cross(this.direction,this.up,this.right),z(this)};var $=new i,ee=new E,te=new r,ie=new r;M.prototype._adjustOrthographicFrustum=function(e){if(this.frustum instanceof A&&(e||!(this._positionCartographic.height<15e4)))if(y.equals(y.IDENTITY,this.transform)){var t,i,o=this._scene,n=o._globe;if(s(n)){var a=$;a.x=o.drawingBufferWidth/2,a.y=o.drawingBufferHeight/2;var l=this.getPickRay(a,ee);if(t=n.pick(l,o,te),o.pickPositionSupported&&(i=o.pickPositionWorldCoordinates(a,ie)),s(t)&&s(i)){var u=s(i)?r.distance(i,this.positionWC):Number.POSITIVE_INFINITY,h=s(t)?r.distance(t,this.positionWC):Number.POSITIVE_INFINITY;this.frustum.width=Math.min(u,h)}else s(i)?this.frustum.width=r.distance(i,this.positionWC):s(t)&&(this.frustum.width=r.distance(t,this.positionWC))}if(!s(n)||!s(t)&&!s(i)){var c=Math.max(this.positionCartographic.height,0);this.frustum.width=c}}else this.frustum.width=r.magnitude(this.position)};var re=new r,oe=new y,ne=new y,ae=new w,se=new C,le=new n,ue=new r,he=new r,ce=new r;function pe(e,t,i,o){var n=r.clone(i.direction,ue),a=r.clone(i.up,he);if(e._scene.mode===x.SCENE3D){var s=e._projection.ellipsoid,l=S.eastNorthUpToFixedFrame(t,s,Y),u=y.inverseTransformation(l,K);y.multiplyByPointAsVector(u,n,n),y.multiplyByPointAsVector(u,a,a)}var h=r.cross(n,a,ce);return o.heading=H(n,a),o.pitch=q(n),o.roll=X(n,a,h),o}var de={destination:void 0,orientation:{direction:void 0,up:void 0,heading:void 0,pitch:void 0,roll:void 0},convert:void 0,endTransform:void 0},fe=new g;M.prototype.setView=function(e){e=a(e,a.EMPTY_OBJECT);var t=a(e.orientation,a.EMPTY_OBJECT),o=this._mode;if(o!==x.MORPHING){s(e.endTransform)&&this._setTransform(e.endTransform);var n=a(e.convert,!0),l=a(e.destination,r.clone(this.positionWC,re));s(l)&&s(l.west)&&(l=this.getRectangleCameraCoordinates(l,re),n=!1),s(t.direction)&&(t=pe(this,l,t,de.orientation)),fe.heading=a(t.heading,0),fe.pitch=a(t.pitch,-v.PI_OVER_TWO),fe.roll=a(t.roll,0),this._suspendTerrainAdjustment=!1,o===x.SCENE3D?function(e,t,i){var o=y.clone(e.transform,oe),n=S.eastNorthUpToFixedFrame(t,e._projection.ellipsoid,ne);e._setTransform(n),r.clone(r.ZERO,e.position),i.heading=i.heading-v.PI_OVER_TWO;var a=w.fromHeadingPitchRoll(i,ae),s=C.fromQuaternion(a,se);C.getColumn(s,0,e.direction),C.getColumn(s,2,e.up),r.cross(e.direction,e.up,e.right),e._setTransform(o),e._adjustOrthographicFrustum(!0)}(this,l,fe):o===x.SCENE2D?function(e,t,o,n){var a=y.clone(e.transform,oe);if(e._setTransform(y.IDENTITY),!r.equals(t,e.positionWC)){if(n){var s=e._projection,l=s.ellipsoid.cartesianToCartographic(t,le);t=s.project(l,re)}i.clone(t,e.position);var u=.5*-t.z,h=-u,c=e.frustum;if(u<h){var p=c.top/c.right;c.right=h,c.left=u,c.top=c.right*p,c.bottom=-c.top}}if(e._scene.mapMode2D===T.ROTATE){o.heading=o.heading-v.PI_OVER_TWO,o.pitch=-v.PI_OVER_TWO,o.roll=0;var d=w.fromHeadingPitchRoll(o,ae),f=C.fromQuaternion(d,se);C.getColumn(f,2,e.up),r.cross(e.direction,e.up,e.right)}e._setTransform(a)}(this,l,fe,n):function(e,t,i,o){var n=y.clone(e.transform,oe);if(e._setTransform(y.IDENTITY),!r.equals(t,e.positionWC)){if(o){var a=e._projection,s=a.ellipsoid.cartesianToCartographic(t,le);t=a.project(s,re)}r.clone(t,e.position)}i.heading=i.heading-v.PI_OVER_TWO;var l=w.fromHeadingPitchRoll(i,ae),u=C.fromQuaternion(l,se);C.getColumn(u,0,e.direction),C.getColumn(u,2,e.up),r.cross(e.direction,e.up,e.right),e._setTransform(n),e._adjustOrthographicFrustum(!0)}(this,l,fe,n)}};var ge=new r;function me(e,t){var i,r,o=e._scene.mapMode2D===T.ROTATE,n=e._maxCoord.x,a=e._maxCoord.y;i=o?-(r=n):(r=t.x-2*n,t.x+2*n),t.x>n&&(t.x=r),t.x<-n&&(t.x=i),t.y>a&&(t.y=a),t.y<-a&&(t.y=-a)}M.prototype.flyHome=function(e){var t=this._mode;if(t===x.MORPHING&&this._scene.completeMorph(),t===x.SCENE2D)this.flyTo({destination:M.DEFAULT_VIEW_RECTANGLE,duration:e,endTransform:y.IDENTITY});else if(t===x.SCENE3D){var i=this.getRectangleCameraCoordinates(M.DEFAULT_VIEW_RECTANGLE),o=r.magnitude(i);o+=o*M.DEFAULT_VIEW_FACTOR,r.normalize(i,i),r.multiplyByScalar(i,o,i),this.flyTo({destination:i,duration:e,endTransform:y.IDENTITY})}else if(t===x.COLUMBUS_VIEW){var n=this._projection.ellipsoid.maximumRadius,a=new r(0,-1,1);a=r.multiplyByScalar(r.normalize(a,a),5*n,a),this.flyTo({destination:a,duration:e,orientation:{heading:0,pitch:-Math.acos(r.normalize(a,ge).z),roll:0},endTransform:y.IDENTITY,convert:!1})}},M.prototype.worldToCameraCoordinates=function(e,t){if(!s(e))throw new u("cartesian is required.");return s(t)||(t=new o),z(this),y.multiplyByVector(this._actualInvTransform,e,t)},M.prototype.worldToCameraCoordinatesPoint=function(e,t){if(!s(e))throw new u("cartesian is required.");return s(t)||(t=new r),z(this),y.multiplyByPoint(this._actualInvTransform,e,t)},M.prototype.worldToCameraCoordinatesVector=function(e,t){if(!s(e))throw new u("cartesian is required.");return s(t)||(t=new r),z(this),y.multiplyByPointAsVector(this._actualInvTransform,e,t)},M.prototype.cameraToWorldCoordinates=function(e,t){if(!s(e))throw new u("cartesian is required.");return s(t)||(t=new o),z(this),y.multiplyByVector(this._actualTransform,e,t)},M.prototype.cameraToWorldCoordinatesPoint=function(e,t){if(!s(e))throw new u("cartesian is required.");return s(t)||(t=new r),z(this),y.multiplyByPoint(this._actualTransform,e,t)},M.prototype.cameraToWorldCoordinatesVector=function(e,t){if(!s(e))throw new u("cartesian is required.");return s(t)||(t=new r),z(this),y.multiplyByPointAsVector(this._actualTransform,e,t)};var _e=new r;M.prototype.move=function(e,t){if(!s(e))throw new u("direction is required.");var i=this.position;r.multiplyByScalar(e,t,_e),r.add(i,_e,i),this._mode===x.SCENE2D&&me(this,i),this._adjustOrthographicFrustum(!0)},M.prototype.moveForward=function(e){e=a(e,this.defaultMoveAmount),this.move(this.direction,e)},M.prototype.moveBackward=function(e){e=a(e,this.defaultMoveAmount),this.move(this.direction,-e)},M.prototype.moveUp=function(e){e=a(e,this.defaultMoveAmount),this.move(this.up,e)},M.prototype.moveDown=function(e){e=a(e,this.defaultMoveAmount),this.move(this.up,-e)},M.prototype.moveRight=function(e){e=a(e,this.defaultMoveAmount),this.move(this.right,e)},M.prototype.moveLeft=function(e){e=a(e,this.defaultMoveAmount),this.move(this.right,-e)},M.prototype.lookLeft=function(e){e=a(e,this.defaultLookAmount),this.look(this.up,-e)},M.prototype.lookRight=function(e){e=a(e,this.defaultLookAmount),this.look(this.up,e)},M.prototype.lookUp=function(e){e=a(e,this.defaultLookAmount),this.look(this.right,-e)},M.prototype.lookDown=function(e){e=a(e,this.defaultLookAmount),this.look(this.right,e)};var ve=new w,Ce=new C;M.prototype.look=function(e,t){if(!s(e))throw new u("axis is required.");var i=a(t,this.defaultLookAmount),r=w.fromAxisAngle(e,-i,ve),o=C.fromQuaternion(r,Ce),n=this.direction,l=this.up,h=this.right;C.multiplyByVector(o,n,n),C.multiplyByVector(o,l,l),C.multiplyByVector(o,h,h)},M.prototype.twistLeft=function(e){e=a(e,this.defaultLookAmount),this.look(this.direction,e)},M.prototype.twistRight=function(e){e=a(e,this.defaultLookAmount),this.look(this.direction,-e)};var ye=new w,Ae=new C;M.prototype.rotate=function(e,t){if(!s(e))throw new u("axis is required.");var i=a(t,this.defaultRotateAmount),o=w.fromAxisAngle(e,-i,ye),n=C.fromQuaternion(o,Ae);C.multiplyByVector(n,this.position,this.position),C.multiplyByVector(n,this.direction,this.direction),C.multiplyByVector(n,this.up,this.up),r.cross(this.direction,this.up,this.right),r.cross(this.right,this.direction,this.up),this._adjustOrthographicFrustum(!1)},M.prototype.rotateDown=function(e){Ge(this,e=a(e,this.defaultRotateAmount))},M.prototype.rotateUp=function(e){Ge(this,-(e=a(e,this.defaultRotateAmount)))};var Ie=new r,be=new r,we=new r,Ee=new r;function Ge(e,t){var i=e.position,o=r.normalize(i,Ie);if(s(e.constrainedAxis)){var n=r.equalsEpsilon(o,e.constrainedAxis,v.EPSILON2),a=r.equalsEpsilon(o,r.negate(e.constrainedAxis,Ee),v.EPSILON2);if(n||a)(n&&t<0||a&&0<t)&&e.rotate(e.right,t);else{var l=r.normalize(e.constrainedAxis,be),u=r.dot(o,l),h=v.acosClamped(u);0<t&&h<t&&(t=h-v.EPSILON4),u=r.dot(o,r.negate(l,Ee)),h=v.acosClamped(u),t<0&&h<-t&&(t=-h+v.EPSILON4);var c=r.cross(l,o,we);e.rotate(c,t)}}else e.rotate(e.right,t)}function Se(e,t){s(e.constrainedAxis)?e.rotate(e.constrainedAxis,t):e.rotate(e.up,t)}function Pe(e,t){var i,r=e.frustum;if(!(r instanceof I&&s(r.left)&&s(r.right)&&s(r.bottom)&&s(r.top)))throw new u("The camera frustum is expected to be orthographic for 2D camera control.");if(t*=.5,Math.abs(r.top)+Math.abs(r.bottom)>Math.abs(r.left)+Math.abs(r.right)){var o=r.top-t,n=r.bottom+t,a=e._maxCoord.y;e._scene.mapMode2D===T.ROTATE&&(a*=e.maximumZoomFactor),a<n&&(o=-(n=a)),o<=n&&(n=-(o=1)),i=r.right/r.top,r.top=o,r.bottom=n,r.right=r.top*i,r.left=-r.right}else{var l=r.right-t,h=r.left+t,c=e._maxCoord.x;e._scene.mapMode2D===T.ROTATE&&(c*=e.maximumZoomFactor),c<l&&(h=-(l=c)),l<=h&&(h=-(l=1)),i=r.top/r.right,r.right=l,r.left=h,r.top=r.right*i,r.bottom=-r.top}}function Te(e,t){e.move(e.direction,t)}M.prototype.rotateRight=function(e){Se(this,-(e=a(e,this.defaultRotateAmount)))},M.prototype.rotateLeft=function(e){Se(this,e=a(e,this.defaultRotateAmount))},M.prototype.zoomIn=function(e){e=a(e,this.defaultZoomAmount),this._mode===x.SCENE2D?Pe(this,e):Te(this,e)},M.prototype.zoomOut=function(e){e=a(e,this.defaultZoomAmount),this._mode===x.SCENE2D?Pe(this,-e):Te(this,-e)},M.prototype.getMagnitude=function(){return this._mode===x.SCENE3D?r.magnitude(this.position):this._mode===x.COLUMBUS_VIEW?Math.abs(this.position.z):this._mode===x.SCENE2D?Math.max(this.frustum.right-this.frustum.left,this.frustum.top-this.frustum.bottom):void 0};var xe=new y;M.prototype.lookAt=function(e,t){if(!s(e))throw new u("target is required");if(!s(t))throw new u("offset is required");if(this._mode===x.MORPHING)throw new u("lookAt is not supported while morphing.");var i=S.eastNorthUpToFixedFrame(e,c.WGS84,xe);this.lookAtTransform(i,t)};var Me=new r,Le=new w,Ne=new w,Re=new C;function Oe(e,t,i){t=v.clamp(t,-v.PI_OVER_TWO,v.PI_OVER_TWO),e=v.zeroToTwoPi(e)-v.PI_OVER_TWO;var o=w.fromAxisAngle(r.UNIT_Y,-t,Le),n=w.fromAxisAngle(r.UNIT_Z,-e,Ne),a=w.multiply(n,o,n),s=C.fromQuaternion(a,Re),l=r.clone(r.UNIT_X,Me);return C.multiplyByVector(s,l,l),r.negate(l,l),r.multiplyByScalar(l,i,l),l}M.prototype.lookAtTransform=function(e,t){if(!s(e))throw new u("transform is required");if(this._mode===x.MORPHING)throw new u("lookAtTransform is not supported while morphing.");if(this._setTransform(e),s(t)){var o;if(o=s(t.heading)?Oe(t.heading,t.pitch,t.range):t,this._mode===x.SCENE2D){i.clone(i.ZERO,this.position),r.negate(o,this.up),this.up.z=0,r.magnitudeSquared(this.up)<v.EPSILON10&&r.clone(r.UNIT_Y,this.up),r.normalize(this.up,this.up),this._setTransform(y.IDENTITY),r.negate(r.UNIT_Z,this.direction),r.cross(this.direction,this.up,this.right),r.normalize(this.right,this.right);var n=this.frustum,a=n.top/n.right;return n.right=.5*r.magnitude(o),n.left=-n.right,n.top=a*n.right,n.bottom=-n.top,void this._setTransform(e)}r.clone(o,this.position),r.negate(this.position,this.direction),r.normalize(this.direction,this.direction),r.cross(this.direction,r.UNIT_Z,this.right),r.magnitudeSquared(this.right)<v.EPSILON10&&r.clone(r.UNIT_X,this.right),r.normalize(this.right,this.right),r.cross(this.right,this.direction,this.up),r.normalize(this.up,this.up),this._adjustOrthographicFrustum(!0)}};var De,Fe=new n,Ue=new n,Be=new r,ke=new r,Ve=new r,We=new r,je=new r,ze=new r,He=new r,qe=new r,Xe={direction:new r,right:new r,up:new r};function Ye(e,t,i,o){return Math.abs(r.dot(t,i))/o-r.dot(e,i)}function Ke(e,t,i,o){var n=e._projection.ellipsoid,a=o?e:Xe,l=t.north,u=t.south,h=t.east,c=t.west;h<c&&(h+=v.TWO_PI);var d,f=.5*(c+h);if(u<-v.PI_OVER_TWO+v.RADIANS_PER_DEGREE&&l>v.PI_OVER_TWO-v.RADIANS_PER_DEGREE)d=0;else{var g=Fe;g.longitude=f,g.latitude=l,g.height=0;var m=Ue;m.longitude=f,m.latitude=u,m.height=0;var _=De;s(_)&&_.ellipsoid===n||(De=_=new p(void 0,void 0,n)),_.setEndPoints(g,m),d=_.interpolateUsingFraction(.5,Fe).latitude}var C=Fe;C.longitude=f,C.latitude=d,C.height=0;var y=n.cartographicToCartesian(C,He),I=Fe;I.longitude=h,I.latitude=l;var b=n.cartographicToCartesian(I,Be);I.longitude=c;var w=n.cartographicToCartesian(I,Ve);I.longitude=f;var E=n.cartographicToCartesian(I,je);I.latitude=u;var G=n.cartographicToCartesian(I,ze);I.longitude=h;var S=n.cartographicToCartesian(I,We);I.longitude=c;var P=n.cartographicToCartesian(I,ke);r.subtract(w,y,w),r.subtract(S,y,S),r.subtract(b,y,b),r.subtract(P,y,P),r.subtract(E,y,E),r.subtract(G,y,G);var T=n.geodeticSurfaceNormal(y,a.direction);r.negate(T,T);var x=r.cross(T,r.UNIT_Z,a.right);r.normalize(x,x);var M,L=r.cross(x,T,a.up);if(e.frustum instanceof A){var N,R,O=Math.max(r.distance(b,w),r.distance(S,P)),D=Math.max(r.distance(b,S),r.distance(w,P)),F=e.frustum._offCenterFrustum.right/e.frustum._offCenterFrustum.top,U=D*F;U<O?R=(N=O)/F:(R=D,N=U),M=Math.max(N,R)}else{var B=Math.tan(.5*e.frustum.fovy),k=e.frustum.aspectRatio*B;if(M=Math.max(Ye(T,L,w,B),Ye(T,L,S,B),Ye(T,L,b,B),Ye(T,L,P,B),Ye(T,L,E,B),Ye(T,L,G,B),Ye(T,x,w,k),Ye(T,x,S,k),Ye(T,x,b,k),Ye(T,x,P,k),Ye(T,x,E,k),Ye(T,x,G,k)),u<0&&0<l){var V=Fe;V.longitude=c,V.latitude=0,V.height=0;var W=n.cartographicToCartesian(V,qe);r.subtract(W,y,W),M=Math.max(M,Ye(T,L,W,B),Ye(T,x,W,k)),V.longitude=h,W=n.cartographicToCartesian(V,qe),r.subtract(W,y,W),M=Math.max(M,Ye(T,L,W,B),Ye(T,x,W,k))}}return r.add(y,r.multiplyByScalar(T,-M,qe),i)}var Qe=new n,Ze=new r,Je=new r,$e=new n,et=new r,tt=new r;M.prototype.getRectangleCameraCoordinates=function(e,t){if(!s(e))throw new u("rectangle is required");var i=this._mode;return s(t)||(t=new r),i===x.SCENE3D?Ke(this,e,t):i===x.COLUMBUS_VIEW?function(e,t,i){var r=e._projection;t.west>t.east&&(t=G.MAX_VALUE);var o=e._actualTransform,n=e._actualInvTransform,a=Qe;a.longitude=t.east,a.latitude=t.north;var l=r.project(a,Ze);y.multiplyByPoint(o,l,l),y.multiplyByPoint(n,l,l),a.longitude=t.west,a.latitude=t.south;var u=r.project(a,Je);if(y.multiplyByPoint(o,u,u),y.multiplyByPoint(n,u,u),i.x=.5*(l.x-u.x)+u.x,i.y=.5*(l.y-u.y)+u.y,s(e.frustum.fovy)){var h=Math.tan(.5*e.frustum.fovy),c=e.frustum.aspectRatio*h;i.z=.5*Math.max((l.x-u.x)/c,(l.y-u.y)/h)}else{var p=l.x-u.x,d=l.y-u.y;i.z=Math.max(p,d)}return i}(this,e,t):i===x.SCENE2D?function(e,t,i){var r=e._projection;t.west>t.east&&(t=G.MAX_VALUE);var o=$e;o.longitude=t.east,o.latitude=t.north;var n=r.project(o,et);o.longitude=t.west,o.latitude=t.south;var a,s,l=r.project(o,tt),u=.5*Math.abs(n.x-l.x),h=.5*Math.abs(n.y-l.y),c=e.frustum.right/e.frustum.top,p=h*c;return p<u?s=(a=u)/c:(s=h,a=p),h=Math.max(2*a,2*s),i.x=.5*(n.x-l.x)+l.x,i.y=.5*(n.y-l.y)+l.y,(o=r.unproject(i,o)).height=h,r.project(o,i)}(this,e,t):void 0};var it=new E,rt=new E,ot=new E;M.prototype.pickEllipsoid=function(e,t,i){if(!s(e))throw new u("windowPosition is required.");var o=this._scene.canvas;if(0!==o.clientWidth&&0!==o.clientHeight){if(s(i)||(i=new r),t=a(t,c.WGS84),this._mode===x.SCENE3D)i=function(e,t,i,r){i=a(i,c.WGS84);var o=e.getPickRay(t,it),n=_.rayEllipsoid(o,i);if(n){var s=0<n.start?n.start:n.stop;return E.getPoint(o,s,r)}}(this,e,t,i);else if(this._mode===x.SCENE2D)i=function(e,t,i,r){var o=e.getPickRay(t,rt).origin;o.z=0;var n=i.unproject(o);if(!(n.latitude<-v.PI_OVER_TWO||n.latitude>v.PI_OVER_TWO))return i.ellipsoid.cartographicToCartesian(n,r)}(this,e,this._projection,i);else{if(this._mode!==x.COLUMBUS_VIEW)return;i=function(e,t,i,o){var n=e.getPickRay(t,ot),a=-n.origin.x/n.direction.x;E.getPoint(n,a,o);var s=i.unproject(new r(o.y,o.z,0));if(!(s.latitude<-v.PI_OVER_TWO||s.latitude>v.PI_OVER_TWO||s.longitude<-Math.PI||s.longitude>Math.PI))return i.ellipsoid.cartographicToCartesian(s,o)}(this,e,this._projection,i)}return i}};var nt=new r,at=new r,st=new r,lt=new r;M.prototype.getPickRay=function(e,t){if(!s(e))throw new u("windowPosition is required.");s(t)||(t=new E);var i=this.frustum;return s(i.aspectRatio)&&s(i.fov)&&s(i.near)?function(e,t,i){var o=e._scene.canvas,n=o.clientWidth,a=o.clientHeight,s=Math.tan(.5*e.frustum.fovy),l=e.frustum.aspectRatio*s,u=e.frustum.near,h=2/n*t.x-1,c=2/a*(a-t.y)-1,p=e.positionWC;r.clone(p,i.origin);var d=r.multiplyByScalar(e.directionWC,u,nt);r.add(p,d,d);var f=r.multiplyByScalar(e.rightWC,h*u*l,at),g=r.multiplyByScalar(e.upWC,c*u*s,st),m=r.add(d,f,i.direction);return r.add(m,g,m),r.subtract(m,p,m),r.normalize(m,m),i}(this,e,t):function(e,t,i){var o=e._scene.canvas,n=o.clientWidth,a=o.clientHeight,l=e.frustum;s(l._offCenterFrustum)&&(l=l._offCenterFrustum);var u=2/n*t.x-1;u*=.5*(l.right-l.left);var h=2/a*(a-t.y)-1;h*=.5*(l.top-l.bottom);var c=i.origin;return r.clone(e.position,c),r.multiplyByScalar(e.right,u,lt),r.add(lt,c,c),r.multiplyByScalar(e.up,h,lt),r.add(lt,c,c),r.clone(e.directionWC,i.direction),e._mode===x.COLUMBUS_VIEW&&r.fromElements(i.origin.z,i.origin.x,i.origin.y,i.origin),i}(this,e,t)};var ut=new r,ht=new r;M.prototype.distanceToBoundingSphere=function(e){if(!s(e))throw new u("boundingSphere is required.");var t=r.subtract(this.positionWC,e.center,ut),i=r.multiplyByScalar(this.directionWC,r.dot(t,this.directionWC),ht);return Math.max(0,r.magnitude(i)-e.radius)};var ct=new i;function pt(e,t,i,o,n,a){var s=r.clone(t);return i.y>o?s.y-=i.y-o:i.y<-o&&(s.y+=-o-i.y),i.z>n?s.z-=i.z-n:i.z<-n&&(s.z+=-n-i.z),{easingFunction:h.EXPONENTIAL_OUT,startObject:{time:0},stopObject:{time:1},duration:a,update:function(i){var o=r.lerp(t,s,i.time,new r);e.worldToCameraCoordinatesPoint(o,e.position)}}}M.prototype.getPixelSize=function(e,t,i){if(!s(e))throw new u("boundingSphere is required.");if(!s(t))throw new u("drawingBufferWidth is required.");if(!s(i))throw new u("drawingBufferHeight is required.");var r=this.distanceToBoundingSphere(e),o=this.frustum.getPixelDimensions(t,i,r,ct);return Math.max(o.x,o.y)};var dt=new r,ft=new r,gt=new r,mt=new r;M.prototype.createCorrectPositionTween=function(e){if(!s(e))throw new u("duration is required.");if(this._mode===x.COLUMBUS_VIEW)return function(e,t){var i=e.position,o=e.direction,n=e.worldToCameraCoordinatesVector(r.UNIT_X,dt),a=-r.dot(n,i)/r.dot(n,o),s=r.add(i,r.multiplyByScalar(o,a,ft),ft);e.cameraToWorldCoordinatesPoint(s,s),i=e.cameraToWorldCoordinatesPoint(e.position,gt);var l=Math.tan(.5*e.frustum.fovy),u=e.frustum.aspectRatio*l,h=r.magnitude(r.subtract(i,s,mt)),c=u*h,p=l*h,d=e._maxCoord.x,f=e._maxCoord.y,g=Math.max(c-d,d),m=Math.max(p-f,f);if(i.z<-g||i.z>g||i.y<-m||i.y>m){var _=s.y<-g||s.y>g,v=s.z<-m||s.z>m;if(_||v)return pt(e,i,s,g,m,t)}}(this,e)};var _t=new r,vt={destination:void 0,heading:void 0,pitch:void 0,roll:void 0,duration:void 0,complete:void 0,cancel:void 0,endTransform:void 0,maximumHeight:void 0,easingFunction:void 0};function Ct(e,t,i){s(i)||(i=f.clone(M.DEFAULT_OFFSET));var r=e._scene.screenSpaceCameraController.minimumZoomDistance,o=e._scene.screenSpaceCameraController.maximumZoomDistance,n=i.range;if(!s(n)||0===n){var a=t.radius;0===a?i.range=100:e.frustum instanceof A||e._mode===x.SCENE2D?i.range=function(e,t){var i,r,o=e.frustum;s(o._offCenterFrustum)&&(o=o._offCenterFrustum);var n=o.right/o.top,a=t*n;return a<t?r=(i=t)/n:(r=t,i=a),1.5*Math.max(i,r)}(e,a):i.range=function(e,t){var i=e.frustum,r=Math.tan(.5*i.fovy),o=i.aspectRatio*r;return Math.max(t/o,t/r)}(e,a),i.range=v.clamp(i.range,r,o)}return i}M.prototype.cancelFlight=function(){s(this._currentFlight)&&(this._currentFlight.cancelTween(),this._currentFlight=void 0)},M.prototype.flyTo=function(e){var t=(e=a(e,a.EMPTY_OBJECT)).destination;if(!s(t))throw new u("destination is required.");if(this._mode!==x.MORPHING){this.cancelFlight();var i=a(e.orientation,a.EMPTY_OBJECT);if(s(i.direction)&&(i=pe(this,t,i,de.orientation)),s(e.duration)&&e.duration<=0){var r=de;return r.destination=e.destination,r.orientation.heading=i.heading,r.orientation.pitch=i.pitch,r.orientation.roll=i.roll,r.convert=e.convert,r.endTransform=e.endTransform,this.setView(r),void("function"==typeof e.complete&&e.complete())}var o=s(t.west);o&&(t=this.getRectangleCameraCoordinates(t,_t));var n,l=this;vt.destination=t,vt.heading=i.heading,vt.pitch=i.pitch,vt.roll=i.roll,vt.duration=e.duration,vt.complete=function(){n===l._currentFlight&&(l._currentFlight=void 0),s(e.complete)&&e.complete()},vt.cancel=e.cancel,vt.endTransform=e.endTransform,vt.convert=!o&&e.convert,vt.maximumHeight=e.maximumHeight,vt.pitchAdjustHeight=e.pitchAdjustHeight,vt.flyOverLongitude=e.flyOverLongitude,vt.flyOverLongitudeWeight=e.flyOverLongitudeWeight,vt.easingFunction=e.easingFunction;var h=this._scene;n=h.tweens.add(P.createTween(h,vt)),this._currentFlight=n}},M.prototype.viewBoundingSphere=function(e,t){if(!s(e))throw new u("boundingSphere is required.");if(this._mode===x.MORPHING)throw new u("viewBoundingSphere is not supported while morphing.");t=Ct(this,e,t),this.lookAt(e.center,t)};var yt=new y,At=new r,It=new r,bt=new r,wt=new r,Et=new o,Gt=new w,St=new C;M.prototype.flyToBoundingSphere=function(e,t){if(!s(e))throw new u("boundingSphere is required.");t=a(t,a.EMPTY_OBJECT);var i=this._mode===x.SCENE2D||this._mode===x.COLUMBUS_VIEW;this._setTransform(y.IDENTITY);var o,n=Ct(this,e,t.offset);o=i?r.multiplyByScalar(r.UNIT_Z,n.range,At):Oe(n.heading,n.pitch,n.range);var l,h,p=S.eastNorthUpToFixedFrame(e.center,c.WGS84,yt);if(y.multiplyByPoint(p,o,o),!i){if(l=r.subtract(e.center,o,It),r.normalize(l,l),h=y.multiplyByPointAsVector(p,r.UNIT_Z,bt),1-Math.abs(r.dot(l,h))<v.EPSILON6){var d=w.fromAxisAngle(l,n.heading,Gt),f=C.fromQuaternion(d,St);r.fromCartesian4(y.getColumn(p,1,Et),h),C.multiplyByVector(f,h,h)}var g=r.cross(l,h,wt);r.cross(g,l,h),r.normalize(h,h)}this.flyTo({destination:o,orientation:{direction:l,up:h},duration:t.duration,complete:t.complete,cancel:t.cancel,endTransform:t.endTransform,maximumHeight:t.maximumHeight,easingFunction:t.easingFunction,flyOverLongitude:t.flyOverLongitude,flyOverLongitudeWeight:t.flyOverLongitudeWeight,pitchAdjustHeight:t.pitchAdjustHeight})};var Pt=new r,Tt=new r,xt=new r,Mt=new r,Lt=[new r,new r,new r,new r],Nt=new i,Rt=new r,Ot=[new n,new n,new n,new n];function Dt(e,t,i,r,o,n){Nt.x=e,Nt.y=t;var a=r.pickEllipsoid(Nt,o,Rt);return s(a)?(Ot[i]=o.cartesianToCartographic(a,Ot[i]),1):(Ot[i]=o.cartesianToCartographic(n[i],Ot[i]),0)}M.prototype.computeViewRectangle=function(e,i){e=a(e,c.WGS84);var o=this.frustum.computeCullingVolume(this.positionWC,this.directionWC,this.upWC),n=new t(r.ZERO,e.maximumRadius);if(o.computeVisibility(n)!==m.OUTSIDE){var s=this._scene.canvas,l=s.clientWidth,u=s.clientHeight,h=0,p=function(e,t){var i,o,n=t.radii,a=e.positionWC,s=r.multiplyComponents(t.oneOverRadii,a,Pt),l=r.magnitude(s),u=r.normalize(s,Tt);o=r.equalsEpsilon(u,r.UNIT_Z,v.EPSILON10)?(i=new r(0,1,0),new r(0,0,1)):(i=r.normalize(r.cross(r.UNIT_Z,u,xt),xt),r.normalize(r.cross(u,i,Mt),Mt));var h=Math.sqrt(r.magnitudeSquared(s)-1),c=r.multiplyByScalar(u,1/l,Pt),p=h/l,d=r.multiplyByScalar(i,p,Tt),f=r.multiplyByScalar(o,p,xt),g=r.add(c,f,Lt[0]);r.subtract(g,d,g),r.multiplyComponents(n,g,g);var m=r.subtract(c,f,Lt[1]);r.subtract(m,d,m),r.multiplyComponents(n,m,m);var _=r.subtract(c,f,Lt[2]);r.add(_,d,_),r.multiplyComponents(n,_,_);var C=r.add(c,f,Lt[3]);return r.add(C,d,C),r.multiplyComponents(n,C,C),Lt}(this,e);if(h+=Dt(0,0,0,this,e,p),h+=Dt(0,u,1,this,e,p),h+=Dt(l,u,2,this,e,p),(h+=Dt(l,0,3,this,e,p))<2)return G.MAX_VALUE;i=G.fromCartographicArray(Ot,i);for(var d=0,f=Ot[3].longitude,g=0;g<4;++g){var _=Ot[g].longitude,C=Math.abs(_-f);C>v.PI?d+=v.TWO_PI-C:d+=C,f=_}return v.equalsEpsilon(Math.abs(d),v.TWO_PI,v.EPSILON9)&&(i.west=-v.PI,i.east=v.PI,0<=Ot[0].latitude?i.north=v.PI_OVER_TWO:i.south=-v.PI_OVER_TWO),i}},M.prototype.switchToPerspectiveFrustum=function(){if(!(this._mode===x.SCENE2D||this.frustum instanceof b)){var e=this._scene;this.frustum=new b,this.frustum.aspectRatio=e.drawingBufferWidth/e.drawingBufferHeight,this.frustum.fov=v.toRadians(60)}},M.prototype.switchToOrthographicFrustum=function(){if(!(this._mode===x.SCENE2D||this.frustum instanceof A)){var e=this._scene;this.frustum=new A,this.frustum.aspectRatio=e.drawingBufferWidth/e.drawingBufferHeight,this.frustum.width=r.magnitude(this.position);var t=this.frustum.projectionMatrix;s(t)&&this._adjustOrthographicFrustum(!0)}},M.clone=function(e,t){return s(t)||(t=new M(e._scene)),r.clone(e.position,t.position),r.clone(e.direction,t.direction),r.clone(e.up,t.up),r.clone(e.right,t.right),y.clone(e._transform,t.transform),t._transformChanged=!0,t},e.GeoCamera=M}(window.Cesium),function(e){var t=e.Cartesian2,i=e.defined,r=e.defineProperties,o=e.destroyObject,n=e.DeveloperError,a=e.KeyboardEventModifier,s=e.Math,l=e.ScreenSpaceEventHandler,u=e.ScreenSpaceEventType,h=e.CameraEventType;function c(e,t){var r=e;return i(t)&&(r+="+"+t),r}function p(e,r,o){var n=c(h.PINCH,r),a=e._update,s=e._isDown,l=e._eventStartPosition,p=e._pressTime,d=e._releaseTime;a[n]=!0,s[n]=!1,l[n]=new t;var f=e._movement[n];i(f)||(f=e._movement[n]={}),f.distance={startPosition:new t,endPosition:new t},f.angleAndHeight={startPosition:new t,endPosition:new t},f.prevAngle=0,e._eventHandler.setInputAction((function(i){e._buttonsDown++,s[n]=!0,p[n]=new Date,t.lerp(i.position1,i.position2,.5,l[n])}),u.PINCH_START,r),e._eventHandler.setInputAction((function(){e._buttonsDown=Math.max(e._buttonsDown-1,0),s[n]=!1,d[n]=new Date}),u.PINCH_END,r),e._eventHandler.setInputAction((function(e){if(s[n]){a[n]?(function(e,i){t.clone(e.distance.startPosition,i.distance.startPosition),t.clone(e.distance.endPosition,i.distance.endPosition),t.clone(e.angleAndHeight.startPosition,i.angleAndHeight.startPosition),t.clone(e.angleAndHeight.endPosition,i.angleAndHeight.endPosition)}(e,f),a[n]=!1,f.prevAngle=f.angleAndHeight.startPosition.x):(t.clone(e.distance.endPosition,f.distance.endPosition),t.clone(e.angleAndHeight.endPosition,f.angleAndHeight.endPosition));for(var i=f.angleAndHeight.endPosition.x,r=f.prevAngle,l=2*Math.PI;i>=r+Math.PI;)i-=l;for(;i<r-Math.PI;)i+=l;f.angleAndHeight.endPosition.x=-i*o.clientWidth/12,f.angleAndHeight.startPosition.x=-r*o.clientWidth/12}}),u.PINCH_MOVE,r)}function d(e,r){var o=c(h.WHEEL,r),n=e._update;n[o]=!0;var a=e._movement[o];i(a)||(a=e._movement[o]={}),a.startPosition=new t,a.endPosition=new t,e._eventHandler.setInputAction((function(e){var i=10*s.toRadians(e);n[o]?(t.clone(t.ZERO,a.startPosition),a.endPosition.x=0,a.endPosition.y=i,n[o]=!1):a.endPosition.y=a.endPosition.y+i}),u.WHEEL,r)}function f(e,r,o){var n=c(o,r),a=e._isDown,s=e._eventStartPosition,l=e._pressTime,p=e._releaseTime;a[n]=!1,s[n]=new t;var d,f,g=e._lastMovement[n];i(g)||(g=e._lastMovement[n]={startPosition:new t,endPosition:new t,valid:!1}),o===h.LEFT_DRAG?(d=u.LEFT_DOWN,f=u.LEFT_UP):o===h.RIGHT_DRAG?(d=u.RIGHT_DOWN,f=u.RIGHT_UP):o===h.MIDDLE_DRAG&&(d=u.MIDDLE_DOWN,f=u.MIDDLE_UP),e._eventHandler.setInputAction((function(i){e._buttonsDown++,g.valid=!1,a[n]=!0,l[n]=new Date,t.clone(i.position,s[n])}),d,r),e._eventHandler.setInputAction((function(){e._buttonsDown=Math.max(e._buttonsDown-1,0),a[n]=!1,p[n]=new Date}),f,r)}function g(e,i){t.clone(e.startPosition,i.startPosition),t.clone(e.endPosition,i.endPosition)}function m(e,r){var o=e._update,n=e._movement,a=e._lastMovement,s=e._isDown;for(var l in h)if(h.hasOwnProperty(l)){var p=h[l];if(i(p)){var d=c(p,r);o[d]=!0,i(e._lastMovement[d])||(e._lastMovement[d]={startPosition:new t,endPosition:new t,valid:!1}),i(e._movement[d])||(e._movement[d]={startPosition:new t,endPosition:new t})}}e._eventHandler.setInputAction((function(l){for(var u in h)if(h.hasOwnProperty(u)){var p=h[u];if(i(p)){var d=c(p,r);s[d]&&(o[d]?(g(n[d],a[d]),a[d].valid=!0,g(l,n[d]),o[d]=!1):t.clone(l.endPosition,n[d].endPosition))}}t.clone(l.endPosition,e._currentMousePosition)}),u.MOUSE_MOVE,r)}function _(e){if(!i(e))throw new n("canvas is required.");for(var r in this._eventHandler=new l(e,!0),this._update={},this._movement={},this._lastMovement={},this._isDown={},this._eventStartPosition={},this._pressTime={},this._releaseTime={},this._buttonsDown=0,this._currentMousePosition=new t,d(this,void 0),p(this,void 0,e),f(this,void 0,h.LEFT_DRAG),f(this,void 0,h.RIGHT_DRAG),f(this,void 0,h.MIDDLE_DRAG),m(this,void 0),a)if(a.hasOwnProperty(r)){var o=a[r];i(o)&&(d(this,o),p(this,o,e),f(this,o,h.LEFT_DRAG),f(this,o,h.RIGHT_DRAG),f(this,o,h.MIDDLE_DRAG),m(this,o))}}r(_.prototype,{currentMousePosition:{get:function(){return this._currentMousePosition}},anyButtonDown:{get:function(){var e=!(this._update[c(h.WHEEL)]&&this._update[c(h.WHEEL,a.SHIFT)]&&this._update[c(h.WHEEL,a.CTRL)]&&this._update[c(h.WHEEL,a.ALT)]);return 0<this._buttonsDown||e}}}),_.prototype.isMoving=function(e,t){if(!i(e))throw new n("type is required.");var r=c(e,t);return!this._update[r]},_.prototype.getMovement=function(e,t){if(!i(e))throw new n("type is required.");var r=c(e,t);return this._movement[r]},_.prototype.getLastMovement=function(e,t){if(!i(e))throw new n("type is required.");var r=c(e,t),o=this._lastMovement[r];if(o.valid)return o},_.prototype.isButtonDown=function(e,t){if(!i(e))throw new n("type is required.");var r=c(e,t);return this._isDown[r]},_.prototype.getStartMousePosition=function(e,t){if(!i(e))throw new n("type is required.");if(e===h.WHEEL)return this._currentMousePosition;var r=c(e,t);return this._eventStartPosition[r]},_.prototype.getButtonPressTime=function(e,t){if(!i(e))throw new n("type is required.");var r=c(e,t);return this._pressTime[r]},_.prototype.getButtonReleaseTime=function(e,t){if(!i(e))throw new n("type is required.");var r=c(e,t);return this._releaseTime[r]},_.prototype.reset=function(){for(var e in this._update)this._update.hasOwnProperty(e)&&(this._update[e]=!0)},_.prototype.isDestroyed=function(){return!1},_.prototype.destroy=function(){return this._eventHandler=this._eventHandler&&this._eventHandler.destroy(),o(this)},e.GeoCameraEventAggregator=_}(window.Cesium),function(e){var t=e.GeoCloudPrimitive=function(t){t=t||{},this._height=e.defaultValue(t.height,9e3);var i=e.defaultValue(t.url,"../../../resource/images/cloud.jpg");this._url_0=e.buildModuleUrl(i),this._speedScale=e.defaultValue(t.speedScale,1),this._base=0,this._step=1e-4,this._gamma=e.defaultValue(t.gamma,new e.Cartesian4(.83,1.03,1.4,.25)),this._isInverse=e.defaultValue(t.isInverse,!1),this._animationMatrix=new e.Matrix4,this._radius=null,this._colorTexture_0=null,this._requestUrl=!1,this._requestCommand=!1,this._actived=!0};e.defineProperties(t.prototype,{actived:{get:function(){return this._actived},set:function(e){this._actived=e}},isInverse:{get:function(){return this._isInverse},set:function(e){this._isInverse=e}},redGamma:{get:function(){return this._gamma.x},set:function(t){t=e.Math.clamp(t,0,2),this._gamma.x=t}},greenGamma:{get:function(){return this._gamma.y},set:function(t){t=e.Math.clamp(t,0,2),this._gamma.y=t}},blueGamma:{get:function(){return this._gamma.z},set:function(t){t=e.Math.clamp(t,0,2),this._gamma.z=t}},alphaGamma:{get:function(){return this._gamma.w},set:function(t){t=e.Math.clamp(t,0,1),this._gamma.w=t}},speedScale:{get:function(){return this._speedScale},set:function(e){this._speedScale=e}},url:{set:function(t){var i=e.defaultValue(t,"../../../resource/images/10.jpg");this._url_0=e.buildModuleUrl(i),this._colorTexture_0&&(this._colorTexture_0.destroy(),this._colorTexture_0=null)}}}),t.prototype._isTexturesReady=function(){return!!this._colorTexture_0},t.prototype._createTexture=function(t){var i=this;i._context=t,i._requestUrl||i._colorTexture_0||(i._requestUrl=!0,e.when(e.Resource.fetchImage({url:this._url_0})).then((function(t){i._colorTexture_0=new e.Texture({context:i._context,source:t,pixelFormat:e.PixelFormat.RGBA,pixelDatatype:e.PixelDatatype.UNSIGNED_BYTE})})).otherwise((function(e){console.log("CloudPrimitive fetchImage is failed!")})))},t.prototype.update=function(e){if(this._actived&&e.passes.render){var t=e.commandList,i=e.context;this._createTexture(i),this._isTexturesReady()&&(this._drawCommand||this._timeoutWorkerCommand(i),this._drawCommand&&(this._updateAnimationMatrix(),t.push(this._drawCommand)))}};var i=new e.Quaternion,r=new e.Matrix3;t.prototype._updateAnimationMatrix=function(){var t=this._base*e.Math.TWO_PI;this._isInverse&&(t=-t);var o=e.Quaternion.fromAxisAngle(e.Cartesian3.UNIT_Z,t,i),n=e.Matrix3.fromQuaternion(o,r);this._animationMatrix=e.Matrix4.fromRotationTranslation(n,void 0,this._animationMatrix),this._base+=this._step*this._speedScale,1<this._base&&(this._base=0)},t.prototype._timeoutWorkerCommand=function(e){var t=this;setTimeout((function(){t._createCommandByWorker(e)}),500)},t.prototype._createCommandByWorker=function(t){var i=this;if(!i._requestCommand){i._requestCommand=!0;var r=t,o=i._height+e.Ellipsoid.WGS84.radii.x+15e4;i._radius=o;var n=new Blob(["var PI = Math.PI;\nvar TWO_PI = PI * 2.0;\nvar PI_OVER_TWO = PI / 2.0;\nonmessage = function (e) {\n   var params = e.data;\n   var xCount = params.xCount;\n   if (!xCount){\n       postMessage({error:true});\n       return;\n   }\n   var yCount = params.yCount;\n   if (!yCount){\n       postMessage({error:true});\n       return;\n   }\n   var radius = params.radius;\n   if (!radius){\n       postMessage({error:true});\n       return;\n   }\n   var pointsCount = (xCount + 1) * (yCount - 1) + 2 * xCount;\n   var pointsArray = new Float32Array(3 * pointsCount);\n   var texcoordArray = new Float32Array(2 * pointsCount);\n   var ptIndex = 0;\n   var tcIndex = 0;\n   var hFovRad = PI * 2.0;\n   var vFovRad = PI;\n   var angleH = 0;\n   var angelV = 0;\n   var stepHRad = hFovRad / xCount;\n   var stepVRad = vFovRad / yCount;\n   for (var F = 0; F < xCount; F++){\n       pointsArray[ptIndex ++] = 0.0;\n       pointsArray[ptIndex ++] = 0.0;\n       pointsArray[ptIndex ++] = -radius;\n       texcoordArray[tcIndex ++] = F / xCount + 1 / (xCount * 2.0);\n       texcoordArray[tcIndex ++] = 0.0;\n   }\n   var startHRad = -PI;\n   var startVRad = -PI_OVER_TWO + stepVRad;\n   var tt = 0.0;\n   for (var U = 0; U < yCount - 1; U++) {\n       angelV = startVRad + U * stepVRad;\n       for (var F = 0; F < xCount + 1; F++) {\n           angleH = startHRad + F * stepHRad;\n           pointsArray[ptIndex ++] = radius * Math.cos(angelV) * Math.cos(angleH);\n           pointsArray[ptIndex ++] = radius * Math.cos(angelV) * Math.sin(angleH);\n           pointsArray[ptIndex ++] = radius * Math.sin(angelV);\n           tt = 0.5 + angleH / hFovRad;\n           texcoordArray[tcIndex ++] = tt;\n           texcoordArray[tcIndex ++] = (U + 1) / yCount;\n       }\n   }\n   for (var F = 0; F < xCount; F++){\n       pointsArray[ptIndex ++] = 0.0;\n       pointsArray[ptIndex ++] = 0.0;\n       pointsArray[ptIndex ++] = radius;\n       texcoordArray[tcIndex ++] = F / xCount + 1 / (xCount * 2.0);\n       texcoordArray[tcIndex ++] = 1.0;\n   }\n   var faceIndexCount = (xCount * (yCount - 2) + xCount) * 6;\n   var faceIndexArray = new Uint16Array(faceIndexCount);\n   var faceIndex = 0;\n   for (var F = 0; F < xCount; F ++){\n       faceIndexArray[faceIndex ++] = F;\n       faceIndexArray[faceIndex ++] = F + xCount + 1;\n       faceIndexArray[faceIndex ++] = F + xCount;\n   }\n   for (var U = 0; U < yCount - 2; U ++){\n       for (var F = 0; F < xCount; F ++){\n           faceIndexArray[faceIndex ++] = F + xCount + U * (xCount + 1);\n           faceIndexArray[faceIndex ++] = F + xCount + 1 + U * (xCount + 1);\n           faceIndexArray[faceIndex ++] = F + xCount + 1 + (U + 1) * (xCount + 1);\n           faceIndexArray[faceIndex ++] = F + xCount + U * (xCount + 1);\n           faceIndexArray[faceIndex ++] = F + xCount + 1 + (U + 1) * (xCount + 1);\n           faceIndexArray[faceIndex ++] = F + xCount + (U + 1) * (xCount + 1);\n       }\n   }\n   for (var F = 0; F < xCount; F ++){\n       faceIndexArray[faceIndex ++] = F + xCount + (yCount - 2) * (xCount + 1);\n       faceIndexArray[faceIndex ++] = F + xCount + 1 + (yCount - 2) * (xCount + 1);\n       faceIndexArray[faceIndex ++] = pointsCount - (xCount - F);\n   }\n   postMessage({\n       pointsArray: pointsArray,\n       texcoordArray: texcoordArray,\n       faceIndexArray: faceIndexArray\n   }, [pointsArray.buffer, texcoordArray.buffer, faceIndexArray.buffer]);\n};\nonerror = function(error){\n   debugger;\n}"],{type:"application/javascript"}),a=new Worker(URL.createObjectURL(n));a.onmessage=function(t){var o=t.data.pointsArray,n=t.data.texcoordArray,s=t.data.faceIndexArray,l=e.Buffer.createIndexBuffer({context:r,typedArray:s,usage:e.BufferUsage.STATIC_DRAW,indexDatatype:e.IndexDatatype.UNSIGNED_SHORT}),u=[],h=e.Buffer.createVertexBuffer({context:r,typedArray:o,usage:e.BufferUsage.STATIC_DRAW});u.push({index:0,vertexBuffer:h,componentsPerAttribute:3,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:12,normalize:!1});var c=e.Buffer.createVertexBuffer({context:r,typedArray:n,usage:e.BufferUsage.STATIC_DRAW});u.push({index:1,vertexBuffer:c,componentsPerAttribute:2,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:8,normalize:!1});var p=new e.VertexArray({context:r,attributes:u,indexBuffer:l}),d=new e.DrawCommand({owner:i,primitiveType:e.PrimitiveType.TRIANGLES});d.vertexArray=p;var f={cull:{enabled:!1},depthMask:!1,depthTest:{enabled:!0},blending:{color:e.Color.WHITE,enabled:!0,equationRgb:e.WebGLConstants.FUNC_ADD,equationAlpha:e.WebGLConstants.FUNC_ADD,functionSourceRgb:e.WebGLConstants.ONE,functionDestinationRgb:e.WebGLConstants.ZERO,functionSourceAlpha:e.WebGLConstants.ZERO,functionDestinationAlpha:e.WebGLConstants.ONE}};d.renderState=e.RenderState.fromCache(f),d.shaderProgram=i._createShaderProgram(r),d.uniformMap={u_colorTexture_0:function(){return i._colorTexture_0},u_animationMatrix:function(){return i._animationMatrix},u_gamma:function(){return i._gamma}},d.pass=e.Pass.TRANSLUCENT,d.cull=!1,d.boundingVolume=new e.BoundingSphere(e.Cartesian3.ZERO,i._radius),d._card="GeoCloudPrimitive",i._drawCommand=d,a.terminate()},a.onerror=function(e){},a.postMessage({xCount:36,yCount:36,radius:o})}},t.prototype._createShaderProgram=function(t){var i="";i=function(e){return e+"        void main()\n        {\n            vec4 p = vec4(a_position, 1.0);\n            v_texcoord_0 = a_texcoord_0;\n            gl_Position = czm_modelViewProjection * u_animationMatrix * p;\n        }\n        "}(i=function(e){return e+"        attribute vec3 a_position;\n        attribute vec2 a_texcoord_0;\n        uniform mat4 u_animationMatrix;\n        varying vec2 v_texcoord_0;\n        "}(i));var r="";return r=function(e){return e+"        float computeW(vec4 color){\n            float w = color.w;\n            if (w == 1.0){\n                //w = min(min(color.r, color.g), color.b);\n                w = sin(color.r * color.g * color.b * 1.5707963);\n            }\n            w = pow(w, u_gamma.w * 10.0);\n            return w;\n        }\n        void main()\n        {\n            vec4 color_0 = texture2D(u_colorTexture_0, v_texcoord_0);\n            color_0.w = computeW(color_0);\n            color_0.rgb *= u_gamma.xyz;\n            gl_FragColor = color_0;\n        }\n        "}(r=function(e){return e+"        uniform sampler2D u_colorTexture_0;\n        uniform vec4 u_gamma;\n        varying vec2 v_texcoord_0;\n        "}(r)),e.ShaderProgram.replaceCache({context:t,shaderProgram:void 0,vertexShaderSource:i,fragmentShaderSource:r,attributeLocations:{a_position:0,a_texcoord_0:1}})}}(window.Cesium),function(e){function t(t,i){if(!e.defined(t))throw new DeveloperError("viewer is required.");if(this._viewer=t,i=e.defaultValue(i,e.defaultValue.EMPTY_OBJECT),!e.defined(i.center))throw new DeveloperError("center is required.");this._center=i.center,this._height=e.defaultValue(i.height,e.GeoDynamicCircle.DEFAULT_HEIGHT),this._radius=e.defaultValue(i.radius,e.GeoDynamicCircle.DEFAULT_RADIUS),this._color=e.defaultValue(i.color,e.GeoDynamicCircle.DEFAULT_COLOR);var r=this._center.x,o=this._center.y,n=e.defaultValue(this._center.z,0),a=e.defaultValue(this._radius,0),s=this._color;this._bottomEllipse=null,this._waveEllipse=null,this._createDynamicCircle(r,o,n,a,s)}t.prototype.removeAll=function(){if(this._viewer){var e=this._viewer.entities;e.remove(this._bottomEllipse),e.remove(this._waveEllipse)}},t.prototype.setColor=function(t){this._color=e.defaultValue(t,e.GeoDynamicCircle.DEFAULT_COLOR),this._bottomEllipse.ellipse.material.color=this._color,this._waveEllipse.ellipse.material.color=this._color},t.prototype.getColor=function(){return this._color},t.prototype.setRadius=function(t){this._radius=e.defaultValue(t,e.GeoDynamicCircle.DEFAULT_RADIUS),this._bottomEllipse.ellipse.semiMajorAxis=this._radius,this._bottomEllipse.ellipse.semiMajorAxis=this._radius,this._waveEllipse.ellipse.semiMajorAxis=this._radius,this._waveEllipse.ellipse.semiMajorAxis=this._radius},t.prototype.getRadius=function(){return this._radius},t.prototype.setCenter=function(t){if(!e.defined(t))throw new DeveloperError("position is required.");this._bottomEllipse.position=position,this._waveEllipse.position=position,this._center=position},t.prototype._createDynamicCircle=function(t,i,r,o,n){var a=this._viewer,s=e.Math.toRadians(30),l=0;if(!this._bottomEllipse){var u=a.entities.add({position:e.Cartesian3.fromDegrees(t,i,r),ellipse:{semiMinorAxis:o,semiMajorAxis:o,material:new e.ImageMaterialProperty({color:n,image:function(){var e=document.createElement("canvas");e.width=512,e.height=512;var t=e.getContext("2d"),i=t.createRadialGradient(256,256,0,256,256,256);return i.addColorStop(.1,"rgba(255, 255, 255, 1.0)"),i.addColorStop(.2,"rgba(255, 255, 255, 0.0)"),i.addColorStop(.3,"rgba(255, 255, 255, 0.9)"),i.addColorStop(.5,"rgba(255, 255, 255, 0.0)"),i.addColorStop(.9,"rgba(255, 255, 255, 0.2)"),i.addColorStop(1,"rgba(255, 255, 255, 1.0)"),t.clearRect(0,0,512,512),t.beginPath(),t.arc(256,256,256,0,2*Math.PI,!0),t.fillStyle=i,t.fill(),t.restore(),e}(),transparent:!0})}});this._bottomEllipse=u}if(!this._waveEllipse){var h=a.entities.add({position:e.Cartesian3.fromDegrees(t,i,r),name:"Wave ellipse on surface",ellipse:{semiMinorAxis:new e.CallbackProperty(p,!1),semiMajorAxis:new e.CallbackProperty(p,!1),rotation:new e.CallbackProperty(c,!1),stRotation:new e.CallbackProperty(c,!1),material:new e.ImageMaterialProperty({color:n,image:function(){var e=document.createElement("canvas");e.width=512,e.height=512;var t=e.getContext("2d");return t.clearRect(0,0,512,512),t.strokeStyle="rgb(255, 255, 255)",t.setLineDash([80,80]),t.lineWidth=30,t.arc(256,256,241,0,2*Math.PI,!0),t.stroke(),e}(),transparent:!0})}});this._waveEllipse=h}function c(){return s+=.05}function p(){return 25e3<=(l+=250)&&(l=0),l}},e.GeoDynamicCircle=t,e.GeoDynamicCircle.DEFAULT_HEIGHT=0,e.GeoDynamicCircle.DEFAULT_RADIUS=25e3,e.GeoDynamicCircle.DEFAULT_COLOR=e.Color.WHITE}(window.Cesium),function(e){var t=e.defaultValue;function i(i){i=t(i,t.EMPTY_OBJECT),this.viewer=i.viewer,this.scene=this.viewer.scene,this.scene.screenSpaceCameraController.enableGeoLocateRatate=!1,this.primitives=this.scene.primitives,this.topCylinderColor=t(i.topCylinderColor,new e.Color(1,0,0,.5)),this.bottomCylinderColor=t(i.bottomCylinderColor,new e.Color(0,1,0,.5)),this.createPrestrainPrimitive(),this.active()}function r(t,i,r,o){return new e.GeometryInstance({geometry:new e.EllipseGeometry({center:t,semiMajorAxis:i,semiMinorAxis:r,height:o,vertexFormat:e.EllipsoidSurfaceAppearance.VERTEXT_FORMAT})})}function o(t,i,r,o,n,a,s,l,u,h){return new e.GeometryInstance({geometry:new e.CylinderGeometry({length:t,topRadius:i,bottomRadius:r,vertexFormat:e.VertexFormat.POSITION_AND_NORMAL}),attributes:{color:new e.ColorGeometryInstanceAttribute(o,n,a,s)},modelMatrix:e.Matrix4.multiplyByTranslation(e.Transforms.eastNorthUpToFixedFrame(e.Cartesian3.fromDegrees(l,u,h)),new e.Cartesian3(0,0,0),new e.Matrix4)})}function n(t,i){return new e.Primitive({allowPicking:!0,geometryInstances:t,vertexCacheOptimize:!0,appearance:i,interleave:!0,asynchronous:!1,cull:!1,releaseGeometryInstances:!0,show:!0})}e.defineProperties(i.prototype,{}),i.prototype.createPrestrainPrimitive=function(){var t=r(e.Cartesian3.UNIT_X,1e-4,1e-4,1e-4);this.ellipseAppearance=new e.EllipsoidSurfaceAppearance({translucent:!0,material:new e.Material({fabric:{type:"Image",uniforms:{image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAA6E2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS41LWMwMTQgNzkuMTUxNDgxLCAyMDEzLzAzLzEzLTEyOjA5OjE1ICAgICAgICAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgICAgICAgICAgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIgogICAgICAgICAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgICAgICAgICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOmV4aWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vZXhpZi8xLjAvIj4KICAgICAgICAgPHhtcDpDcmVhdG9yVG9vbD5BZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpPC94bXA6Q3JlYXRvclRvb2w+CiAgICAgICAgIDx4bXA6Q3JlYXRlRGF0ZT4yMDE5LTA2LTExVDA5OjQ2OjU3KzA4OjAwPC94bXA6Q3JlYXRlRGF0ZT4KICAgICAgICAgPHhtcDpNb2RpZnlEYXRlPjIwMTktMDYtMTFUMTA6MTY6NTMrMDg6MDA8L3htcDpNb2RpZnlEYXRlPgogICAgICAgICA8eG1wOk1ldGFkYXRhRGF0ZT4yMDE5LTA2LTExVDEwOjE2OjUzKzA4OjAwPC94bXA6TWV0YWRhdGFEYXRlPgogICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3BuZzwvZGM6Zm9ybWF0PgogICAgICAgICA8cGhvdG9zaG9wOkNvbG9yTW9kZT4zPC9waG90b3Nob3A6Q29sb3JNb2RlPgogICAgICAgICA8cGhvdG9zaG9wOklDQ1Byb2ZpbGU+c1JHQiBJRUM2MTk2Ni0yLjE8L3Bob3Rvc2hvcDpJQ0NQcm9maWxlPgogICAgICAgICA8eG1wTU06SW5zdGFuY2VJRD54bXAuaWlkOjNkNWU2OTU5LTZiOTMtZTQ0Mi1hNmFkLWVhMmExOWQxZGI0MTwveG1wTU06SW5zdGFuY2VJRD4KICAgICAgICAgPHhtcE1NOkRvY3VtZW50SUQ+eG1wLmRpZDo5ODQ4MzQ2Ny03Mjg5LTUzNGQtOTUyOC05MGY3MWU0MTEwMmU8L3htcE1NOkRvY3VtZW50SUQ+CiAgICAgICAgIDx4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ+eG1wLmRpZDo5ODQ4MzQ2Ny03Mjg5LTUzNGQtOTUyOC05MGY3MWU0MTEwMmU8L3htcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD4KICAgICAgICAgPHhtcE1NOkhpc3Rvcnk+CiAgICAgICAgICAgIDxyZGY6U2VxPgogICAgICAgICAgICAgICA8cmRmOmxpIHJkZjpwYXJzZVR5cGU9IlJlc291cmNlIj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmFjdGlvbj5jcmVhdGVkPC9zdEV2dDphY3Rpb24+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDppbnN0YW5jZUlEPnhtcC5paWQ6OTg0ODM0NjctNzI4OS01MzRkLTk1MjgtOTBmNzFlNDExMDJlPC9zdEV2dDppbnN0YW5jZUlEPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6d2hlbj4yMDE5LTA2LTExVDA5OjQ2OjU3KzA4OjAwPC9zdEV2dDp3aGVuPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6c29mdHdhcmVBZ2VudD5BZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpPC9zdEV2dDpzb2Z0d2FyZUFnZW50PgogICAgICAgICAgICAgICA8L3JkZjpsaT4KICAgICAgICAgICAgICAgPHJkZjpsaSByZGY6cGFyc2VUeXBlPSJSZXNvdXJjZSI+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDphY3Rpb24+c2F2ZWQ8L3N0RXZ0OmFjdGlvbj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0Omluc3RhbmNlSUQ+eG1wLmlpZDozZDVlNjk1OS02YjkzLWU0NDItYTZhZC1lYTJhMTlkMWRiNDE8L3N0RXZ0Omluc3RhbmNlSUQ+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDp3aGVuPjIwMTktMDYtMTFUMTA6MTY6NTMrMDg6MDA8L3N0RXZ0OndoZW4+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDpzb2Z0d2FyZUFnZW50PkFkb2JlIFBob3Rvc2hvcCBDQyAoV2luZG93cyk8L3N0RXZ0OnNvZnR3YXJlQWdlbnQ+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDpjaGFuZ2VkPi88L3N0RXZ0OmNoYW5nZWQ+CiAgICAgICAgICAgICAgIDwvcmRmOmxpPgogICAgICAgICAgICA8L3JkZjpTZXE+CiAgICAgICAgIDwveG1wTU06SGlzdG9yeT4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgICAgPHRpZmY6WFJlc29sdXRpb24+NzIwMDAwLzEwMDAwPC90aWZmOlhSZXNvbHV0aW9uPgogICAgICAgICA8dGlmZjpZUmVzb2x1dGlvbj43MjAwMDAvMTAwMDA8L3RpZmY6WVJlc29sdXRpb24+CiAgICAgICAgIDx0aWZmOlJlc29sdXRpb25Vbml0PjI8L3RpZmY6UmVzb2x1dGlvblVuaXQ+CiAgICAgICAgIDxleGlmOkNvbG9yU3BhY2U+MTwvZXhpZjpDb2xvclNwYWNlPgogICAgICAgICA8ZXhpZjpQaXhlbFhEaW1lbnNpb24+NjQ8L2V4aWY6UGl4ZWxYRGltZW5zaW9uPgogICAgICAgICA8ZXhpZjpQaXhlbFlEaW1lbnNpb24+NjQ8L2V4aWY6UGl4ZWxZRGltZW5zaW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKPD94cGFja2V0IGVuZD0idyI/Pu16zW8AAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAEbhJREFUeNrsW3t0VPWd//x+9955ZDKTyeRNnrxCXEGEgAqyQXqEWmtdtbj0gVsaaVfWB6tSjh5r67J2j0qhPrrWcnqaLisKVK0bLdsKIiBGBOVhSYiERwghk5AQ8pqZ3Dv3/r77x/yGjrOZyUSC7jnu95zfyeP+Ht/f5/5+3/dlRIQvM3F8yenzACAPwDIAc0cwZhyABwBUXGrm1Es4dz6AbwGYB+BvAPzrCMZ6AHwfwE0A3gewGcChS8EkuwQy4DYA1QBKAZwDsA/AWwB2AwiN4GRWArgRwLUACgB0A3gNwDP/VwH4HoD7ANgB/BnAbwHUj9Lc2QDuBPB3AHwAXgHw41GZmYguts0mov1EdISIVozCfMO1hUT0ARE1EdGdFzvfxTKzjoi6ieipz2Hj8W0JEZ0moneJKOPzBiCfiE4Q0SEiKv0CNh/bXiaiEBF97bOM/ywyYB6APwFYB+DeEYzzAZgG4DKp5nwAFPlMABgA0AzgKIADAFpGMPcdAH4H4LERapsRn4BvUoS+l2J/HxEtJaI3iaiXUieLiN4jooeJaGKKa11GRANE9ItLdQVulszNSaFvERE9TUQ9iXZomqZlGIZpGIZlGIY5DCCvSWE73LppRNRBRGtG+wrMBLBXWnO7hun7UwAPAXDE/M+sq6s7vmfPnuaGhgZ/a2tr/7lz53TTNIkxxgCQ1+vVxowZk15eXp47c+bM0qqqqvEulys9bu71cm5/kvVdADoB/ATAz0fDDvDKCX8IoCZJvyskg1Oj//D7/Z01NTUf1NbW1h88eNCv67oBQOGca3a7XeGcI7q+YRjCNE0TQBgAr6ioyLnhhhsmLV68eEZlZeWEmHX6APwjgI1JeJkAoAnAfADbLhaAj+XbX5qkz3cAbLjwuk1z8LHHHvvjunXr9nZ2dp5XFMWTm5vrstvtXModBoDFiyPGGMnx1N3dPRgMBns1TbMtWrRoyqpVq24cO3bsmJj+qwGsTMLTrdJy9ADo/6wAPCIdmaIkfR4AsCb6x7Zt2w7de++9f2hsbDzjdruzc3JynEIIQUQqgHR5Naxij9s2PsOT7rQM5VjfQH/TQCgktYIpGTYUReEDAwPm2bNnz2ZkZLgef/zxr95zzz0LYtZ+CcB3k/D2nwBKkjliyQAoAnAawBQAhxP0uRvAL6N/rFmzZsuKFStqATjHjRvnE0KYROQAkCn9gBYAJwG0PVKcWzY1M+M6h6JkHusPvPPAsdP7pANVJptXAtGvqqra3t4eCAQCnXfcccc169ev/36MI/eyPIGJKCCv74aRAvA2gDapY4eimwC8Ef3jwQcffHnt2rVbMzMzC3w+n900TZKucEA6RB/W3TTvOBgD0zToRw7foR9peJQrWqlWNvZRraT0KTJNgAhzdh/IkzbDLOkIdXLOjXA4zFpbW1vnzp07cevWrcs1TbPL5X8O4EcJ+LwdwAsAskYSD7haSv4fJnheAKA2+sfDDz+8ee3atdvy8/OLvV6vZpqmDcAYadA8DWDT/oeWH3dMvgKOK66E88pKqJneYqurZ6Le3GkTg4ZHzc6C4s2A4s3A+zdd1yGNrdXSk8wQQnhVVbXKyspKdu7ceXzBggXPArAkCysA3JKA199LrbFqJAD8Qh6tRO5rbVSI1dTU7HziiSf+nJeXV+h0OiGEcEvBs1lai60AYLafiTR/K8JtLTarv6+YGCAEQIKXkBAVZFo2CpugsBldZ0B6fr8CoBNRLoBwWVlZ4Y4dO45WV1f/R9xGvQn4/RGAf0oVgHEAxkp9OxQtATADAI4cOXKqurp6o8fjyXW5XFxu3gHg1/HqJ7h/T7R5Qvveuz58+uQk6FL8G+HJYlCvIgE7MQX0v9mql8e8h4jyAFiFhYVFNTU1u2tqanbGBHfWJeD5vwG0A7gnFQAeAvAhgPNDPNPkkQYAWrp06UYAak5OjtOyLLt88+uk6vwUmaeaI635pMc4eaLK6usdz5yAogFWZ+v4cMuxK3m6Q1NzfFAyPUNtokuezBARZdpsNkpPT8+97777Xvf7/V0x9/2KBCDUyCjTsADMTWLwLAOQAQDr169/t66urqm0tDTHNE0BIEfq3Y+HNM+uW4D0r94Mx7SrMkiIKhEIljAVUDIBq/+8xzjdMoMBecxmA1OURIK5W54uuxDClpeX5xoYGAg98sgjb8T0eTLB2BekAzYpGQDXyp+vJdH5ICJz9erVOzVN83LOhYzYHJGRoKGDj3kF0AqLoXgyJtLAwAQYAszOwNI0kA5YXQFP+GzHlHDrKY/RcjKZbXJMCsZc0zTNnJyc3BdffPFAU1NTq3x+QwK7JSBVcHUyAL4rOw1F18g4H2praw8cPnz4TEFBgVsIoch5XkvGdejghwgd+rBcP940R/QEXOAAc6gAY4AJUMDyit7+vwVDCfdmDGedbpF3Ot3tdqvhcNhYt25dXVx4bijaCaBKmspDAjA9ibOzKPrLpk2bDgLQOOdRP/+g9OUTkggFYDQfqzSaPqkSuqlBYQDngACYBpAYzDLbz8xnmlZqGzt2OAAMuRmvZVkiLS3N++abbzbouh7VWt9Mor2yASxMBMDSJFHXrwBAT09Pb11d3SmPx+ORRpQqDZ2k5Jw5C6rbPZkCfdOgQAVnkTAIAJ6pgKm6qh87Osns6ipNMV2xTwpqm8/nczY2Nnbt2rWrST6bJu2QeDog7YXfJwLgsLwr8ZQDYDIA7N27t7mlpaXX4/FoUuV1yChOUhLBwBirp28K6brKnWBMkwAQwO0M4IDoBUSQplJYTEoBgF4AxwG4VVUFALFnz57mOGNuKKqX40aUGKmIgtXQ0NBORJaqqoyI0qTbGRxugv4d7/xDuKmtQnQDzEkAWZHGAMYBywBMAejNLTcyTi0AfpYCX80ApsmTqDU2Np6NeZYKiCkDcEGqnjlzpj/Gh1BlrGBYKszUzgyUF+4z9IIuxcHPCzDBAHAOUlRuWSHdEQ7odueEMW32orxPcOCTVKbtkN4jUxRF8/v9AzHPikcTgAuWSXd3dzhOiwRTmcCVQVudqnoQYZ7GbUwnzgVxBs4AaAohCIX6LZVl2wLwOc6myFcwCoDdbmc9PT1hy7KEoig8ludRzQ3KYManrncq4zb1TW4Ph1m7SRwAg2AcBEABQVEYzNAgwrqBzEAx0vuyU2XnwtqRyBqYEAJKYkPqMwPAYgD4TLm05T3XFrmddpdiU7lOsAQxBgEwEuCWgG6EedgSfFzIo2f3Oc8lMMWHezk0FM+jAYB1wRnQtNiJKSa2n5SKHcZSZuqzLJNl2zjvFWAMBMaIiDOCzdBdImxxj6WccAu8BOD1FPlnACCEgKqqTFEUFs/zaADQfUEf5uTYZfwORCQAuFOZYHJ5vvr2lg8mnT7dWcrcOZZ8ZRH+VQUUDCjcHDQ1jHOEzZzcFPlyyz2QrusiKyvLxjln8TyPBgCnLrzJ4uKMaEJFRnDzU5lg2pVFGz/6+NRXTncZpU63TdEUDi7lAFc4Bp0KINyC2R1vChJvpchXAQCFMUZCCKOwsNATpyJTysOnQo1RaT916tQxmqZp4XCYpNFUImN+yWPr3rQTmT5PPZwOy7QIXFVgd2rQbAoM04RmV5Gd6+lLc9q2M8aaU+RrHIBBeQ3MKVOmFMQZPCMG4FsyGBJPAwA+AoDp06eXlZeXZ/X09AzKE+ADcPmwCDb6RV5W2geluZ5DRm8IpmGBAFiWQDBggCwaTE/TPjQtq30goKfC+xjJ64Cu65bNZrPPmTNnXIyvsHeIMQqAbwO4LhEAj0Zd3iHoLQCw2+2OefPmjQ8Gg33yvgWTmJ0X6Fx3wCwfn7N74rjsAzAFhBDSCmTgjEFV+HFF4X8yDPNsMJgSALMBOBljZmdnZ2D69OkFM2bMGC+f7ZIJlKH8meejEa2hANgcm9mJo5ejvyxevHgGAKbrugDQI83OymTcTqrIM0vLshp9eZ5GxeOEKYDBUBhEBM2mwONxnPT5XNuyfK7urCzXcJvPkrGLLsaYYppm38KFC6+I2c/GJJHsvQB+kwiADQAKE0j24wA+AICrr7560vXXXz+xra2tWxod/TITk1CoGoaFYCgMu11pzc11tUEIMdCvQ9dNKJyhpNh7bOb04voZ04qMyiuLhgNgIQAHY0w/d+5cMDs721tdXT07Gn0DsCnBuFnyJPckAuCYvO9LEkxwwUF59NFH5wPQQ6GQYIz1So8xUSAC7+05ibd3HEVPz2Dz2OLs3RrnvVb3AMIDRrhoTObxMQXew5wzcIUjYskmpCp5hDsYY2pfX1/n/fffPyczMzMaRVkn9xBPpQBy48N9Q630qhQUQ9EbMvSFqqqqy5csWXKV3+9vVxRFlbH3WQC+MdTAvBw3crPTMbY06+SEcdm7HC6tHyAwjetOp7anr09vqD/SjobGDjQeTegKTJa8damqyk6ePNk9adKkwpUrV94Q0+enCcbeD+BEvH0wFABrAYyXKbGh6M7oL88888zf5+fnZ5w4ceK8qqpMhqlulu3TCrvAg4ICD/Lz3B2Zmc73XS77ABw2OF2OQE62e2uG23FIVRRoaqQNQdMRyQoHOOeD3d3dOoBATU3Nt1VVtcVsvisB37dhiHQ5T6Dy3olNeMbR+9Fj5PF43LW1tT8goqDf7w+oqmpKF/UbEqi06KCGI+1oONKOQ385g2PHu7o0RTnPnXZwzvQsb9rHBXme4Ji8DERbHH0dwA8ADHLO+0KhEJ0/f97/3HPPLZw1a1ZFjIxalcgVkY7TllQtwX+WE06UAY94qpa6dOzMmTMnvvLKK0sWLlz4W7/fj4KCApdpmm0ArpJG0lsA3ms44o86LFAUbnrcjsbCPPdVlhBdgaDe390dgG6Y8etcJqO8lwHoUhRFDwQC1NHRcWbFihUL4jLFX0siNx6WexpRcvTf5SZmJnheBuATADYA2Lx58/uLFi1aD8A5fvz4TMuyTCLyylNwTBpSDZVzftwBwMs5+3pPT+iq3t7Qac5ZDSJVpWg/+csMAOUyrjdFWnmdqqryzs7Owb6+vo6VK1cuePLJJxfFGXCJJP8qmTC5bKQAMHkdqpNMfo28EgCA3bt3NyxatGh9W1vb+YKCgnyn08kty4JMpjili9sqZUW/VFlRjzINkWxykdQoFoDznHOLiHhzc3MXAOv555+/ddmyZdfHCbenE/CXK69kJYD9IwUAiNTq/lFuoC9BnznymDsB4Ny5c+eXL1/+yoYNGz4CYCssLPTZbDYuhBDytKTJnzzOZxfStA7Juw4hBFpbW/sty+qdPXv2hGefffbWysrK8pgx9wF4Lgn/hxFJ8y9P+JZTiG/8Th7HqUn6lAP4AyJV4ZHMxZYtH61Zs2bX9u3bjwMQaWlpHq/Xa9c0jUtXeujAg2VRf3+/0dvb2w/AnDx5csFdd901++6774596zoiRRHJkjFPyqtRmjTSk2KApx7AnlgVmODKvIC4moLt27cffvXVVw/u3LnzRFNTU7dhGEaSaA0xxpSSkpKMWbNmldxyyy1Tbr/99umcc3tcdufO2NB2giTORumqd4wGAC5EqkWeSiFcPR/Av0ij6K/Ry2AwsH///pb6+np/S0tLb2dn56BpmtFYHnw+n1ZYWOiuqKjInzZtWnFeXp4vbt4ziFSB/nqY9a9FpDS/CsC7qcTRUm1FRNRPRD9Jsf/tRLSNLp4+JqIHiciRwprziEgQ0W2Xqli6SJa8bhjBmMtlyevbsrJ8OBokon1EtJqI5o5gnbvl+FsudbG0S+blwogUTnePYGyGzMyWIVLOosZogAFEqshOIHkl6FC0AZGPKRYAqBtpKPliytR7R+OjhYto1xDRUSL6CxF5vogPJhYS0Rki2k1E0z7HjfuIaD0RdRHRz77IL0ZivxxpJqLXiejqS7jxQiL6lVxry2h8rDGaH00VSRV5jTR3axEpZe28yHlV6cp+RxpcLQD+DcNXraeW8roEn81lIvIlyXyZoOxApHDqNzK8nuocy6ROL5GW3x5E6gXrR5NZdom/HZ6MSEXGfGnAvJTiuKnSwTkI4L8A7LhUDLL//3j6S05fegD+ZwD3gk1Njxe3yQAAAABJRU5ErkJggg=="}}}),fragmentShaderSource:"varying vec3 v_positionMC;\n\t\t\t\t\tvarying vec3 v_positionEC;\n\t\t\t\t\tvarying vec2 v_st;\n\t\t\t\t\t\n\t\t\t\t\tvoid main()\n\t\t\t\t\t{\n\t\t\t\t\t\tczm_materialInput materialInput;\n\t\t\t\t\t\tvec3 normalEC = normalize(czm_normal3D * czm_geodeticSurfaceNormal(v_positionMC, vec3(0.0), vec3(1.0)));\n\t\t\t\t\t#ifdef FACE_FORWARD\n\t\t\t\t\t\tnormalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n\t\t\t\t\t#endif\n\t\t\t\t\t\tmaterialInput.s = v_st.s;\n\t\t\t\t\t\tmaterialInput.st = v_st;\n\t\t\t\t\t\tmaterialInput.str = vec3(v_st, 0.0);\n\t\t\t\t\t\tmaterialInput.normalEC = normalEC;\n\t\t\t\t\t\tmaterialInput.tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(v_positionMC, materialInput.normalEC);\n\t\t\t\t\t\tvec3 positionToEyeEC = -v_positionEC;\n\t\t\t\t\t\tmaterialInput.positionToEyeEC = positionToEyeEC;\n\t\t\t\t\t\tczm_material material = czm_getMaterial(materialInput);\n\t\t\t\t\t#ifdef FLAT\n\t\t\t\t\t\tgl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n\t\t\t\t\t#else\n\t\t\t\t\t\tgl_FragColor = czm_phong(normalize(positionToEyeEC), material);\n\t\t\t\t\t\tif(gl_FragColor.r==1.0&&gl_FragColor.g==1.0&&gl_FragColor.b==1.0&&gl_FragColor.a==1.0){\n\t\t\t\t\t\t\tgl_FragColor.a = 0.0;\n\t\t\t\t\t\t}\n\t\t\t\t\t#endif\n\t\t\t\t\t}\n\t\t\t\t\t"});var i=n(t,this.ellipseAppearance);this.primitives.add(i),this.prestrainEllipsePrimitive=i;var a=n([o(1e-4,1e-4,0,1,0,0,0,0,0,0),o(1e-4,0,1e-4,1,0,0,0,0,0,0)],new e.PerInstanceColorAppearance);this.primitives.add(a),this.prestrainCylinderPrimitive=a},i.prototype.active=function(){var t=null,i=this,a=new e.ScreenSpaceEventHandler(this.scene.canvas);a.setInputAction((function(a){if(!i.viewer.trackedEntity){i.scene.screenSpaceCameraController.enableInputs=!1;var s;if(s=null==i.scene.pick(a.position)?i.scene.globe.pick(i.viewer.camera.getPickRay(a.position),i.scene):i.scene.pickPosition(a.position)){var l=e.Cartographic.fromCartesian(s),u=e.Math.toDegrees(l.longitude),h=e.Math.toDegrees(l.latitude),c=l.height+.5,p=e.Cartesian3.distance(i.viewer.camera.position,s)/80,d=i.viewer.entities.add({id:"pointEntity",position:s,point:{color:new e.Color(1,1,1,0)}});d.enableGeoLocateRatate=!0,i.viewer.trackedEntity=d,i.scene.screenSpaceCameraController.enableGeoLocateRatate=!0;var f=n(r(s,p,p,c),i.ellipseAppearance);i.primitives.add(f),i.ellipsePrimitive=f;var g=n([o(.3*p,.1*p,0,i.topCylinderColor.red,i.topCylinderColor.green,i.topCylinderColor.blue,i.topCylinderColor.alpha,u,h,c+.2*p),o(.3*p,0,.1*p,i.bottomCylinderColor.red,i.bottomCylinderColor.green,i.bottomCylinderColor.blue,i.bottomCylinderColor.alpha,u,h,c-.2*p)],new e.PerInstanceColorAppearance);i.primitives.add(g),i.cylinderPrimitive=g,i.scene.screenSpaceCameraController.rotateEventTypes=e.CameraEventType.MIDDLE_DRAG,t=setTimeout((function(){i.scene.screenSpaceCameraController.enableInputs=!0}),10),i.scene.globe.depthTestAgainstTerrain=!1}}}),e.ScreenSpaceEventType.MIDDLE_DOWN),a.setInputAction((function(r){i.viewer.trackedEntity.enableGeoLocateRatate&&(clearTimeout(t),i.prestrainEllipsePrimitive&&i.primitives.remove(i.prestrainEllipsePrimitive),i.prestrainCylinderPrimitive&&i.primitives.remove(i.prestrainCylinderPrimitive),i.ellipsePrimitive&&i.primitives.remove(i.ellipsePrimitive),i.cylinderPrimitive&&i.primitives.remove(i.cylinderPrimitive),i.viewer.entities.removeById("pointEntity"),t=null,i.prestrainEllipsePrimitive=null,i.prestrainCylinderPrimitive=null,i.ellipsePrimitive=null,i.cylinderPrimitive=null,i.viewer.trackedEntity=void 0,i.scene.screenSpaceCameraController.enableGeoLocateRatate=!1,i.scene.screenSpaceCameraController.rotateEventTypes=e.CameraEventType.LEFT_DRAG,i.scene.screenSpaceCameraController.enableInputs=!0)}),e.ScreenSpaceEventType.MIDDLE_UP)},e.GeoLocateRatate=i}(window.Cesium),function(e){var t=e.GeoRayPick=function(t,i){if(i=void 0===i||i,this.ready=!1,t){this.ready=!0,this.scene=t,this.isOnly=i;var r=new e.BoundingRectangle(0,0,256,256),o=new e.Camera(t);o.frustum=new e.OrthographicFrustum({width:1,aspectRatio:1,near:.01,far:1e3}),this._pickOffscreenView=new e.View(t,o,r),this.deferred=e.when.defer(),this.promise=this.deferred.promise}};t.prototype.doPick=function(e,t){var i=this;if(!i.ready)return null;var r=null;return i._update(e,t),i.promise.then((function(e){r=i._pick(e)})),r};var i=new e.BoundingSphere;function r(t){var r=t.camera,o=t._frameState;o.commandList.length=0,o.shadowMaps.length=0,o.brdfLutGenerator=t._brdfLutGenerator,o.environmentMap=t.skyBox&&t.skyBox._cubeMap,o.mode=t._mode,o.morphTime=t.morphTime,o.mapProjection=t.mapProjection,o.camera=r,o.cullingVolume=r.frustum.computeCullingVolume(r.positionWC,r.directionWC,r.upWC),o.occluder=function(t){var r=t.globe.ellipsoid;return i.radius=r.minimumRadius,e.Occluder.fromBoundingSphere(i,t.camera.positionWC)}(t),o.terrainExaggeration=t._terrainExaggeration,o.minimumDisableDepthTestDistance=t._minimumDisableDepthTestDistance,o.invertClassification=t.invertClassification,o.useLogDepth=!1,o.sunColor=t._sunColor,t._actualInvertClassificationColor=e.Color.clone(t.invertClassificationColor,t._actualInvertClassificationColor),e.InvertClassification.isTranslucencySupported(t._context)||(t._actualInvertClassificationColor.alpha=1),o.invertClassificationColor=t._actualInvertClassificationColor,o.maximumScreenSpaceError=t.globe.maximumScreenSpaceError,function(e){e.render=!1,e.pick=!1,e.depth=!1,e.postProcess=!1,e.offscreen=!1,e.async=!1}(o.passes)}var o=new e.CullingVolume;function n(t,i,r,o){var n=i._frameState;if(t instanceof e.ClearCommand)t.execute(r,o);else{n.useLogDepth&&e.defined(t.derivedCommands.logDepth)&&(t=t.derivedCommands.logDepth.command);var a=n.passes;if(a.pick||a.depth){if(a.pick&&!a.depth&&e.defined(t.derivedCommands.picking))return void(t=t.derivedCommands.picking.pickCommand).execute(r,o);if(e.defined(t.derivedCommands.depth))return void(t=t.derivedCommands.depth.depthOnlyCommand).execute(r,o)}t.execute(r,o)}}function a(t,i,r){return t.boundingVolume.distanceSquaredTo(r)-i.boundingVolume.distanceSquaredTo(r)+e.Math.EPSILON12}function s(t,i,r,o){var n=t.context;e.mergeSort(o,a,t.camera.positionWC);for(var s=o.length,l=0;l<s;++l)i(o[l],t,n,r)}var l=new e.OrthographicFrustum;var u=new e.Cartesian3,h=new e.Cartesian3,c=new e.BoundingRectangle,p=new e.Color(0,0,0,0);t.prototype._update=function(t,i){var a=this.scene,d=a._context,f=d.uniformState,g=a._frameState,m=this._pickOffscreenView,_=(a._view=m).camera,v=t.direction,C=e.Cartesian3.cross(v,i,u);e.Cartesian3.normalize(C,C),i=e.Cartesian3.clone(i,h),_.position=t.origin,_.direction=v,_.up=i,_.right=C;var y=e.BoundingRectangle.clone(m.viewport,c),A=m.pickFramebuffer.begin(y,m.viewport);a._jobScheduler.disableThisFrame(),r(a),g.invertClassification=!1,g.passes.pick=!0,g.passes.offscreen=!0,g.passes.async=!1,g.pickEx=!0,f.update(g),function(e){var t=e._frameState,i=e._environmentState;i.skyAtmosphereCommand=void 0,i.skyBoxCommand=void 0,i.sunDrawCommand=void 0,i.sunComputeCommand=void 0,i.moonCommand=void 0,i.clearGlobeDepth=!0,(i.useDepthPlane=!0)&&e._depthPlane.update(t),i.renderTranslucentDepthForPick=!1,i.useWebVR=!1;for(var r=t.cullingVolume,n=o.planes,a=0;a<5;++a)n[a]=r.planes[a];r=o}(a),function(t,i,r){var o=t._view;t.frameState.commandList.length=0,function(e){var t=e._frameState;e._groundPrimitives.update(t),e._primitives.update(t),e._globe&&e._globe.render(t)}(t),o.createPotentiallyVisibleSet(t),e.defined(r)&&function(t,i,r){var o=t._context,n=t._environmentState,a=t._view;n.originalFramebuffer=i.framebuffer;var s=t._clearColorCommand;e.Color.clone(r,s.color),s.execute(o,i),n.useGlobeDepthFramebuffer=!0,a.globeDepth.update(o,i,a.viewport,t._hdr),a.globeDepth.clear(o,i,r),n.useOIT=!1,n.usePostProcess=!1,n.usePostProcessSelected=!1,i.framebuffer=a.globeDepth.framebuffer,s.execute(o,i),n.useInvertClassification=!1}(t,i,r),function(t,i){var r=t.camera,o=t.context,a=o.uniformState;a.updateCamera(r);var u=r.frustum.clone(l);u.near=r.frustum.near,u.far=r.frustum.far,a.updateFrustum(u),a.updatePass(e.Pass.ENVIRONMENT);for(var h,c,p,d,f=t._environmentState,g=t._view,m=s,_=f.clearGlobeDepth,v=f.useDepthPlane,C=t._depthClearCommand,y=t._stencilClearCommand,A=t._depthPlane,I=g.frustumCommandsList,b=I.length,w=0;w<b;++w){var E=b-w-1,G=I[E];u.near=0!=E?G.near*t.opaqueFrustumNearOffset:G.near,u.far=G.far,a.updateFrustum(u);var S=g.globeDepth;C.execute(o,i),o.stencilBuffer&&y.execute(o,i),a.updatePass(e.Pass.GLOBE);var P=G.commands[e.Pass.GLOBE],T=G.indices[e.Pass.GLOBE];for(h=0;h<T;++h)n(P[h],t,o,i);for(e.defined(S)&&f.useGlobeDepthFramebuffer&&S.executeCopyDepth(o,i),a.updatePass(e.Pass.TERRAIN_CLASSIFICATION),P=G.commands[e.Pass.TERRAIN_CLASSIFICATION],T=G.indices[e.Pass.TERRAIN_CLASSIFICATION],h=0;h<T;++h)n(P[h],t,o,i);for(a.updatePass(e.Pass.CLASSIFICATION),P=G.commands[e.Pass.CLASSIFICATION],T=G.indices[e.Pass.CLASSIFICATION],h=0;h<T;++h)n(P[h],t,o,i);for(_&&C.execute(o,i),a.updatePass(e.Pass.CESIUM_3D_TILE),P=G.commands[e.Pass.CESIUM_3D_TILE],T=G.indices[e.Pass.CESIUM_3D_TILE],h=0;h<T;++h)n(P[h],t,o,i);for(a.updatePass(e.Pass.CESIUM_3D_TILE_CLASSIFICATION),P=G.commands[e.Pass.CESIUM_3D_TILE_CLASSIFICATION],T=G.indices[e.Pass.CESIUM_3D_TILE_CLASSIFICATION],h=0;h<T;++h)n(P[h],t,o,i);for(a.updatePass(e.Pass.CLASSIFICATION),P=G.commands[e.Pass.CLASSIFICATION],T=G.indices[e.Pass.CLASSIFICATION],h=0;h<T;++h)n(P[h],t,o,i);for(0<T&&o.stencilBuffer&&y.execute(o,i),_&&v&&A.execute(o,i),a.updatePass(e.Pass.OPAQUE),P=G.commands[e.Pass.OPAQUE],T=G.indices[e.Pass.OPAQUE],h=0;h<T;++h)n(P[h],t,o,i);if(0!=E&&(u.near=G.near,a.updateFrustum(u)),a.updatePass(e.Pass.TRANSLUCENT),(P=G.commands[e.Pass.TRANSLUCENT]).length=G.indices[e.Pass.TRANSLUCENT],m(t,n,i,P),o.depthTexture&&t.useDepthPicking&&f.useGlobeDepthFramebuffer){var x=S.framebuffer.depthStencilTexture,M=(c=E,d=p=void 0,d=(p=t._view.pickDepths)[c],e.defined(d)||(d=new e.PickDepth,p[c]=d),d);M.update(o,x),M.executeCopyDepth(o,i)}}}(t,i)}(a,A,p),function(e,t){var i=e._context,r=e._environmentState,o=e._view;t.framebuffer=r.originalFramebuffer,o.globeDepth.executeCopyColor(i,t)}(a,A);var I=m.pickFramebuffer.end(y);g.pickEx=!1,a._view=a._defaultView,d.endFrame(),this.deferred.resolve({object:I,ray:t})},t.prototype._pick=function(t){var i,r,o,n,a=t.object,s=t.ray,l=this._pickOffscreenView,u=this.scene,h=u._context;if(h.depthTexture)for(var c=l.frustumCommandsList.length,p=0;p<c;++p){var d=(r=p,n=o=void 0,o=l.pickDepths,n=o[r],e.defined(n)||(n=new e.PickDepth,o[r]=n),n).getDepthEx(h,0,0,l.viewport.width,l.viewport.height,this.isOnly);if(0<d&&d<=1){var f=l.frustumCommandsList[p],g=f.near*(0!==p?u.opaqueFrustumNearOffset:1),m=g+d*(f.far-g);i=e.Ray.getPoint(s,m);break}}return{object:a,position:i}};var d=new e.Cartesian4,f=new e.Cartesian4(1,1/255,1/65025,1/16581375);function g(t,i){if(!e.defined(t._content)||!e.defined(t._content._model)||!t._content._model.ready)return!1;var r=t._boundingVolume;return i.computeVisibilityWithPlaneMask(r,e.CullingVolume.MASK_INDETERMINATE)!==e.CullingVolume.MASK_OUTSIDE}e.PickDepth.prototype.getDepthEx=function(t,i,r,o,n,a){o=void 0!==o?o:1,n=void 0!==n?n:1,a=void 0===a||a;var s=t.readPixels({x:i,y:r,width:o,height:n,framebuffer:this._framebuffer});if(!s)return 0;for(var l=[],u=0;u<o;u++)for(var h=0;h<n;h++){var c=4*h*o+u,p=e.Cartesian4.unpack(s,c,d);e.Cartesian4.divideByScalar(p,255,p);var g=e.Cartesian4.dot(p,f);l.push(g)}var m=Math.floor(.5*o)+Math.floor(.5*n)*o,_=l[m];if(0<_&&_<=1)return _;if(a)return 0;var v=0,C=0;for(u=0;u<o;u++)for(h=0;h<n;h++)c=h*o+u,0<(_=l[m])&&_<1&&(v+=_,C++);return C<1?0:v/C},e.PickDepth.prototype.getPixelsEx=function(e,t,i,r,o){return r=void 0!==r?r:1,o=void 0!==o?o:1,{arrayBufferView:e.readPixels({x:t,y:i,width:r,height:o,framebuffer:this._framebuffer}),width:r,height:o}},e.PickFramebuffer.prototype.getPixelsEx=function(e,t){return e=void 0!==e?e:1,t=void 0!==t?t:1,{arrayBufferView:this._context.readPixels({x:0,y:0,width:e,height:t,framebuffer:this._fb}),width:e,height:t}},t.pick=function(i,r,o,n){if(n=void 0===n||n,!i)return null;if(i._picker)i._picker.isOnly=n;else{var a=new t(i,n,"watchPlane");i._picker=a,e.Scene.prototype._originalDestory=e.Scene.prototype.destroy,e.Scene.prototype.destroy=function(){this._picker&&(this._picker.destroy(),this._picker=null),this._originalDestory()},e.Cesium3DTile.prototype._visibility_Old=e.Cesium3DTile.prototype.visibility,e.Cesium3DTile.prototype.visibility=function(t,i){var r=t.cullingVolume,o=function(t,i){if(i.mode!==e.SceneMode.SCENE3D&&!e.defined(t._boundingVolume2D)){var r=t._boundingVolume.boundingSphere,o=e.BoundingSphere.projectTo2D(r,i.mapProjection,m);t._boundingVolume2D=new e.TileBoundingSphere(o.center,o.radius)}return i.mode!==e.SceneMode.SCENE3D?t._boundingVolume2D:t._boundingVolume}(this,t),n=this._tileset,a=n.clippingPlanes;if(e.defined(a)&&a.enabled){var s=a.computeIntersectionWithBoundingVolume(o,n.clippingPlanesOriginMatrix);if(this._isClipped=s!==Intersect.INSIDE,s===Intersect.OUTSIDE)return CullingVolume.MASK_OUTSIDE}return t.camera.__proto__._hookUpdate&&!0===t.pickEx?function(t,i,r){if(r===e.CullingVolume.MASK_OUTSIDE||r===e.CullingVolume.MASK_INSIDE)return r;for(var o=e.CullingVolume.MASK_INSIDE,n=t.planes,a=0,s=n.length;a<s;++a){var l=a<31?1<<a:0;if(!(a<31&&0==(r&l))){var u=v(i._orientedBoundingBox,e.Plane.fromCartesian4(n[a],_));if(u===e.Intersect.OUTSIDE)return e.CullingVolume.MASK_OUTSIDE;u===e.Intersect.INTERSECTING&&(o|=l)}}return o}(r,o,i):r.computeVisibilityWithPlaneMask(o,i)}}return i._picker.doPick(r,o)},t.prototype.destroy=function(){this.scene=null,this._pickOffscreenView.destroy(),this._pickOffscreenView=null,e.Cesium3DTile.prototype._visibility_Old&&(e.Cesium3DTile.prototype.visibility=e.Cesium3DTile.prototype._visibility_Old,delete e.Cesium3DTile.__proto__._visibility_Old)},e.Cesium3DTileset.prototype._originalUpdate=e.Cesium3DTileset.prototype.update,e.Cesium3DTileset.prototype.update=function(e){!0===e.passes.pick&&!0===e.pickEx?this._updatePicked(e):this._originalUpdate(e)},e.Cesium3DTileset.prototype._updatePicked=function(e){var t,i,r=this._selectedTiles,o=r.length,n=e.cullingVolume;for(t=0;t<o;++t)(i=r[t])&&g(i,n)&&i.update(this,e)};var m=new e.BoundingSphere,_=new e.Plane(new e.Cartesian3,0);function v(t,i){var r=t.center,o=i.normal,n=t.halfAxes,a=o.x,s=o.y,l=o.z,u=Math.abs(a*n[e.Matrix3.COLUMN0ROW0]+s*n[e.Matrix3.COLUMN0ROW1]+l*n[e.Matrix3.COLUMN0ROW2])+Math.abs(a*n[e.Matrix3.COLUMN1ROW0]+s*n[e.Matrix3.COLUMN1ROW1]+l*n[e.Matrix3.COLUMN1ROW2])+Math.abs(a*n[e.Matrix3.COLUMN2ROW0]+s*n[e.Matrix3.COLUMN2ROW1]+l*n[e.Matrix3.COLUMN2ROW2]),h=e.Cartesian3.dot(o,r)+i.distance;return h<=-(u*=2)?e.Intersect.OUTSIDE:u<=h?e.Intersect.INSIDE:e.Intersect.INTERSECTING}}(window.Cesium),function(e){var t=e.Cartesian2,i=e.Cartesian3,r=e.Cartesian4,o=e.Cartographic,n=e.defaultValue,a=e.defined,s=e.destroyObject,l=e.DeveloperError,u=e.Ellipsoid,h=e.HeadingPitchRoll,c=e.IntersectionTests,p=e.isArray,d=e.KeyboardEventModifier,f=e.Math,g=e.Matrix3,m=e.Matrix4,_=e.OrthographicFrustum,v=e.Plane,C=e.Quaternion,y=e.Ray,A=e.Transforms,I=e.CameraEventAggregator,b=e.CameraEventType,w=e.MapMode2D,E=e.SceneMode,G=e.SceneTransforms,S=e.TweenCollection;function P(r){if(!a(r))throw new l("scene is required.");this.constrainedPitch=-f.PI_OVER_SIX,this.enableInputs=!0,this.enableTranslate=!0,this.enableZoom=!0,this.enableRotate=!0,this.enableTilt=!0,this.enableLook=!0,this.inertiaSpin=.9,this.inertiaTranslate=.9,this.inertiaZoom=.8,this.maximumMovementRatio=.1,this.bounceAnimationTime=3,this.minimumZoomDistance=1,this.maximumZoomDistance=Number.POSITIVE_INFINITY,this.translateEventTypes=b.LEFT_DRAG,this.zoomEventTypes=[b.WHEEL,b.PINCH],this.rotateEventTypes=b.LEFT_DRAG,this.tiltEventTypes=[b.RIGHT_DRAG,b.MIDDLE_DRAG,b.PINCH,{eventType:b.LEFT_DRAG,modifier:d.CTRL},{eventType:b.RIGHT_DRAG,modifier:d.CTRL}],this.lookEventTypes={eventType:b.LEFT_DRAG,modifier:d.SHIFT},this.minimumPickingTerrainHeight=15e4,this._minimumPickingTerrainHeight=this.minimumPickingTerrainHeight,this.minimumCollisionTerrainHeight=15e3,this._minimumCollisionTerrainHeight=this.minimumCollisionTerrainHeight,this.minimumTrackBallHeight=-75e5,this._minimumTrackBallHeight=this.minimumTrackBallHeight,this.enableCollisionDetection=!0,this._scene=r,this._globe=void 0,this._ellipsoid=void 0,e.GeoOption&&e.GeoOption.GeoCameraEventAggregator?this._aggregator=new e.GeoCameraEventAggregator(r.canvas):this._aggregator=new I(r.canvas),this._lastInertiaSpinMovement=void 0,this._lastInertiaZoomMovement=void 0,this._lastInertiaTranslateMovement=void 0,this._lastInertiaTiltMovement=void 0,this._tweens=new S,this._tween=void 0,this._horizontalRotationAxis=void 0,this._tiltCenterMousePosition=new t(-1,-1),this._tiltCenter=new i,this._rotateMousePosition=new t(-1,-1),this._rotateStartPosition=new i,this._strafeStartPosition=new i,this._zoomMouseStart=new t(-1,-1),this._zoomWorldPosition=new i,this._useZoomWorldPosition=!1,this._tiltCVOffMap=!1,this._looking=!1,this._rotating=!1,this._strafing=!1,this._zoomingOnVector=!1,this._rotatingZoom=!1;var n=r.mapProjection;this._maxCoord=n.project(new o(Math.PI,f.PI_OVER_TWO)),this._zoomFactor=5,this._rotateFactor=void 0,this._rotateRateRangeAdjustment=void 0,this._maximumRotateRate=1.77,this._minimumRotateRate=2e-4,this._minimumZoomRate=20,this._maximumZoomRate=5906376272e3}function T(e,i,r,o,n,s,l){var u=s[l];a(u)||(u=s[l]={startPosition:new t,endPosition:new t,motion:new t,active:!1});var h=e.getButtonPressTime(i,r),c=e.getButtonReleaseTime(i,r),p=h&&c&&(c.getTime()-h.getTime())/1e3,d=new Date,g=c&&(d.getTime()-c.getTime())/1e3;if(h&&c&&p<.4){var m=function(e,t){if(e<0)return 0;var i=25*(1-t);return Math.exp(-i*e)}(g,o);if(u.active)u.startPosition=t.clone(u.endPosition,u.startPosition),u.endPosition=t.multiplyByScalar(u.motion,m,u.endPosition),u.endPosition=t.add(u.startPosition,u.endPosition,u.endPosition),u.motion=t.clone(t.ZERO,u.motion);else{var _=e.getLastMovement(i,r);if(!a(_)||function(e){return t.equalsEpsilon(e.startPosition,e.endPosition,f.EPSILON14)}(_))return;u.motion.x=.5*(_.endPosition.x-_.startPosition.x),u.motion.y=.5*(_.endPosition.y-_.startPosition.y),u.startPosition=t.clone(_.startPosition,u.startPosition),u.endPosition=t.multiplyByScalar(u.motion,m,u.endPosition),u.endPosition=t.add(u.startPosition,u.endPosition,u.endPosition),u.active=!0}if(isNaN(u.endPosition.x)||isNaN(u.endPosition.y)||t.distance(u.startPosition,u.endPosition)<.5)return void(u.active=!1);e.isButtonDown(i,r)||n(s,e.getStartMousePosition(i,r),u)}else u.active=!1}var x=[];function M(e,t,i,r,o,n){if(a(i)){var s=e._aggregator;p(i)||(x[0]=i,i=x);for(var l=i.length,u=0;u<l;++u){var h=i[u],c=a(h.eventType)?h.eventType:h,d=h.modifier,f=s.isMoving(c,d)&&s.getMovement(c,d),g=s.getStartMousePosition(c,d);e.enableInputs&&t&&(f?r(e,g,f):o<1&&T(s,c,d,o,r,e,n))}}}var L=new y,N=new i,R=new t,O=new i,D=new t,F=new i,U=new i,B=new i,k=new i,V=new i,W=new i,j=new i,z=new i,H=new i,q=new i,X=new i,Y=new i,K=new i,Q=new i,Z=new i,J=new i,$=new i,ee=new i,te={orientation:new h};function ie(o,n,s,l,u,h){var c=1;a(h)&&(c=f.clamp(Math.abs(h),.25,1));var p=o.minimumZoomDistance*c,d=o.maximumZoomDistance,g=l*(u-p);g=f.clamp(g,o._minimumZoomRate,o._maximumZoomRate);var m=s.endPosition.y-s.startPosition.y;if(!(o.autoResetHeadingPitch&&m<0&&function(t,i){var o=r.clone(r.UNIT_W),n=r.clone(r.UNIT_W),a=t._scene,s=a.globe.ellipsoid,l=a.camera,u=a.canvas;if(1.5<=Math.abs(l.pitch)&&(l.heading<=.25||6.03<=l.heading))return!1;var h=l.pickEllipsoid(new e.Cartesian2(0,u.clientHeight),s,o),c=l.pickEllipsoid(new e.Cartesian2(u.clientWidth,u.clientHeight),s,n);if(h&&c&&Math.abs(h.x-c.x)<8e4&&Math.abs(h.y-c.y)<8e4)return!1;var p=new e.Ray;p=l.getPickRay(i,p);var d=a.globe.pick(p,a);d||(p.origin=l.positionWC,p.direction=l.directionWC,d=a.globe.pick(p,a));var f=s.cartographicToCartesian(viewer.camera.positionCartographic,new e.Cartesian3),g=(s.geodeticSurfaceNormal(d),new e.BoundingSphere(d,0));return l.flyToBoundingSphere(g,{offset:new e.HeadingPitchRange(0,e.Math.toRadians(-90),e.Cartesian3.distance(f,d)),duration:0}),!0}(o,n))){var v=m/o._scene.canvas.clientHeight,C=g*(v=Math.min(v,o.maximumMovementRatio));if(!(0<C&&Math.abs(u-p)<1||C<0&&Math.abs(u-d)<1)){u-C<p?C=u-p-1:d<u-C&&(C=u-d);var y=o._scene,A=y.camera,I=y.mode,b=te.orientation;if(b.heading=A.heading,b.pitch=A.pitch,b.roll=A.roll,A.frustum instanceof _)0<Math.abs(C)&&(A.zoomIn(C),A._adjustOrthographicFrustum());else{var w,S=t.equals(n,o._zoomMouseStart),P=o._zoomingOnVector,T=o._rotatingZoom;if(S||(o._zoomMouseStart=t.clone(n,o._zoomMouseStart),a(o._globe)&&(w=I!==E.SCENE2D?fe(o,n,N):A.getPickRay(n,L).origin),a(w)?(o._useZoomWorldPosition=!0,o._zoomWorldPosition=i.clone(w,o._zoomWorldPosition)):o._useZoomWorldPosition=!1,P=o._zoomingOnVector=!1,T=o._rotatingZoom=!1),o._useZoomWorldPosition){var x=I===E.COLUMBUS_VIEW;if(A.positionCartographic.height<2e6&&(T=!0),!S||T){if(I===E.SCENE2D){var M=o._zoomWorldPosition,ie=A.position;if(!i.equals(M,ie)&&A.positionCartographic.height<2*o._maxCoord.x){var re=A.position.x,oe=i.subtract(M,ie,O);i.normalize(oe,oe);var ne=i.distance(M,ie)*C/(.5*A.getMagnitude());A.move(oe,.5*ne),(A.position.x<0&&0<re||0<A.position.x&&re<0)&&(w=A.getPickRay(n,L).origin,o._zoomWorldPosition=i.clone(w,o._zoomWorldPosition))}}else if(I===E.SCENE3D){var ae=i.normalize(A.position,V);if(A.positionCartographic.height<3e3&&Math.abs(i.dot(A.direction,ae))<.6)x=!0;else{var se=y.canvas,le=D;le.x=se.clientWidth/2,le.y=se.clientHeight/2;var ue=fe(o,le,F);if(a(ue)&&A.positionCartographic.height<1e6){var he=j;i.clone(A.position,he);var ce=o._zoomWorldPosition,pe=W;if(pe=i.normalize(ce,pe),i.dot(pe,ae)<0)return;var de=Z,ge=q;i.clone(A.direction,ge),i.add(he,i.multiplyByScalar(ge,1e3,J),de);var me=X,_e=Y;i.subtract(ce,he,me),i.normalize(me,_e);var ve=i.dot(ae,_e);if(0<=ve)return void(o._zoomMouseStart.x=-1);var Ce=Math.acos(-ve),ye=i.magnitude(he),Ae=i.magnitude(ce),Ie=ye-C,be=i.magnitude(me),we=Math.asin(f.clamp(be/Ae*Math.sin(Ce),-1,1))-Math.asin(f.clamp(Ie/Ae*Math.sin(Ce),-1,1))+Ce,Ee=z;i.normalize(he,Ee);var Ge=H;Ge=i.cross(_e,Ee,Ge),Ge=i.normalize(Ge,Ge),i.normalize(i.cross(Ee,Ge,J),ge),i.multiplyByScalar(i.normalize(de,J),i.magnitude(de)-C,de),i.normalize(he,he),i.multiplyByScalar(he,Ie,he);var Se=K;i.multiplyByScalar(i.add(i.multiplyByScalar(Ee,Math.cos(we)-1,$),i.multiplyByScalar(ge,Math.sin(we),ee),J),Ie,Se),i.add(he,Se,he),i.normalize(de,Ee),i.normalize(i.cross(Ee,Ge,J),ge);var Pe=Q;return i.multiplyByScalar(i.add(i.multiplyByScalar(Ee,Math.cos(we)-1,$),i.multiplyByScalar(ge,Math.sin(we),ee),J),i.magnitude(de),Pe),i.add(de,Pe,de),i.clone(he,A.position),i.normalize(i.subtract(de,he,J),A.direction),i.clone(A.direction,A.direction),i.cross(A.direction,A.up,A.right),i.cross(A.right,A.direction,A.up),void A.setView(te)}if(a(ue)){var Te=i.normalize(ue,U),xe=i.normalize(o._zoomWorldPosition,B),Me=i.dot(xe,Te);if(0<Me&&Me<1){var Le=f.acosClamped(Me),Ne=i.cross(xe,Te,k),Re=C/(Math.abs(Le)>f.toRadians(20)?.75*A.positionCartographic.height:A.positionCartographic.height-C);A.rotate(Ne,Le*Re)}}else x=!0}}o._rotatingZoom=!x}if(!S&&x||P){var Oe=G.wgs84ToWindowCoordinates(y,o._zoomWorldPosition,R),De=(I!==E.COLUMBUS_VIEW&&t.equals(n,o._zoomMouseStart)&&a(Oe)?A.getPickRay(Oe,L):A.getPickRay(n,L)).direction;I===E.COLUMBUS_VIEW&&i.fromElements(De.y,De.z,De.x,De),A.move(De,C),o._zoomingOnVector=!0}else A.zoomIn(C);A.setView(te)}else A.zoomIn(C)}}}}var re=new y,oe=new y,ne=new i;function ae(e,t,r){var o=e._scene.camera,n=o.getPickRay(r.startPosition,re).origin,a=o.getPickRay(r.endPosition,oe).origin,s=i.subtract(n,a,ne),l=i.magnitude(s);0<l&&(i.normalize(s,s),o.move(s,l))}function se(e,t,i){a(i.distance)&&(i=i.distance);var r=e._scene.camera;ie(e,t,i,e._zoomFactor,r.getMagnitude())}var le=new t,ue=new t;function he(e,i,r){if(a(r.angleAndHeight))!function(e,t,i){var r=e._rotateFactor*e._rotateRateRangeAdjustment;r>e._maximumRotateRate&&(r=e._maximumRotateRate),r<e._minimumRotateRate&&(r=e._minimumRotateRate);var o=e._scene,n=o.camera,a=o.canvas,s=(i.endPosition.x-i.startPosition.x)/a.clientWidth,l=r*(s=Math.min(s,e.maximumMovementRatio))*Math.PI*4;n.twistRight(l)}(e,0,r.angleAndHeight);else{var o=e._scene,n=o.camera,s=o.canvas,l=s.clientWidth,u=s.clientHeight,h=le;h.x=2/l*r.startPosition.x-1,h.y=2/u*(u-r.startPosition.y)-1,h=t.normalize(h,h);var c=ue;c.x=2/l*r.endPosition.x-1,c.y=2/u*(u-r.endPosition.y)-1,c=t.normalize(c,c);var p=f.acosClamped(h.x);h.y<0&&(p=f.TWO_PI-p);var d=f.acosClamped(c.x);c.y<0&&(d=f.TWO_PI-d);var g=d-p;n.twistRight(g)}}var ce=new y,pe=new i,de=new i;function fe(e,t,r){var o=e._scene,n=e._globe,s=o.camera;if(a(n)){var l;o.pickPositionSupported&&(l=o.pickPositionWorldCoordinates(t,pe));var u=s.getPickRay(t,ce),h=n.pick(u,o,de);return(a(l)?i.distance(l,s.positionWC):Number.POSITIVE_INFINITY)<(a(h)?i.distance(h,s.positionWC):Number.POSITIVE_INFINITY)?i.clone(l,r):i.clone(h,r)}}var ge=new y,me=new y,_e=new i,ve=new i,Ce=new i,ye=new i,Ae=new v(i.UNIT_X,0),Ie=new t,be=new t;function we(e,r,o){if(i.equals(r,e._translateMousePosition)||(e._looking=!1),i.equals(r,e._strafeMousePosition)||(e._strafing=!1),e._looking)Rt(e,r,o);else if(e._strafing)Ke(e,r,o);else{var n,s=e._scene.camera,l=t.clone(o.startPosition,Ie),u=t.clone(o.endPosition,be),h=s.getPickRay(l,ge),p=i.clone(i.ZERO,ye),d=i.UNIT_X;if(s.position.z<e._minimumPickingTerrainHeight&&(n=fe(e,l,_e),a(n)&&(p.x=n.x)),p.x>s.position.z&&a(n))return i.clone(n,e._strafeStartPosition),e._strafing=!0,Ke(e,r,o),void(e._strafeMousePosition=t.clone(r,e._strafeMousePosition));var g=v.fromPointNormal(p,d,Ae);h=s.getPickRay(l,ge);var m=c.rayPlane(h,g,_e),_=s.getPickRay(u,me),C=c.rayPlane(_,g,ve);if(!a(m)||!a(C))return e._looking=!0,Rt(e,r,o),void t.clone(r,e._translateMousePosition);var y=i.subtract(m,C,Ce),A=y.x;y.x=y.y,y.y=y.z,y.z=A;var I=i.magnitude(y);I>f.EPSILON6&&(i.normalize(y,y),s.move(y,I))}}var Ee=new t,Ge=new y,Se=new i,Pe=new i,Te=new m,xe=new m,Me=new i,Le=new v(i.UNIT_X,0),Ne=new i,Re=new o,Oe=new m,De=new C,Fe=new g,Ue=new i;function Be(e,r,o){if(a(o.angleAndHeight)&&(o=o.angleAndHeight),t.equals(r,e._tiltCenterMousePosition)||(e._tiltCVOffMap=!1,e._looking=!1),e._looking)Rt(e,r,o);else{var n=e._scene.camera,s=e._maxCoord,l=Math.abs(n.position.x)-s.x<0&&Math.abs(n.position.y)-s.y<0;e._tiltCVOffMap||!l||n.position.z>e._minimumPickingTerrainHeight?(e._tiltCVOffMap=!0,function(e,r,o){var n=e._scene,s=n.camera,l=n.canvas,h=Ee;h.x=l.clientWidth/2,h.y=l.clientHeight/2;var c,p=s.getPickRay(h,Ge),d=i.UNIT_X,g=p.origin,_=p.direction,v=i.dot(d,_);if(Math.abs(v)>f.EPSILON6&&(c=-i.dot(d,g)/v),!a(c)||c<=0)return e._looking=!0,Rt(e,r,o),t.clone(r,e._tiltCenterMousePosition);var C=i.multiplyByScalar(_,c,Se);i.add(g,C,C);var y=n.mapProjection,I=y.ellipsoid;i.fromElements(C.y,C.z,C.x,C);var b=y.unproject(C,Re);I.cartographicToCartesian(b,C);var w=A.eastNorthUpToFixedFrame(C,I,Te),E=e._globe,G=e._ellipsoid;e._globe=void 0,e._ellipsoid=u.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;var S=m.clone(s.transform,Oe);s._setTransform(w),it(e,r,o,i.UNIT_Z),s._setTransform(S),e._globe=E;var P=(e._ellipsoid=G).maximumRadius;e._rotateFactor=1/P,e._rotateRateRangeAdjustment=P}(e,r,o)):function(e,r,o){var n,s,l=e._scene,h=l.camera,p=i.UNIT_X;if(t.equals(r,e._tiltCenterMousePosition))n=i.clone(e._tiltCenter,Se);else{if(h.position.z<e._minimumPickingTerrainHeight&&(n=fe(e,r,Se)),!a(n)){var d,_=(s=h.getPickRay(r,Ge)).origin,y=s.direction,I=i.dot(p,y);if(Math.abs(I)>f.EPSILON6&&(d=-i.dot(p,_)/I),!a(d)||d<=0)return e._looking=!0,Rt(e,r,o),t.clone(r,e._tiltCenterMousePosition);n=i.multiplyByScalar(y,d,Se),i.add(_,n,n)}t.clone(r,e._tiltCenterMousePosition),i.clone(n,e._tiltCenter)}var b=l.canvas,w=Ee;w.x=b.clientWidth/2,w.y=e._tiltCenterMousePosition.y,s=h.getPickRay(w,Ge);var E=i.clone(i.ZERO,Me);E.x=n.x;var G=v.fromPointNormal(E,p,Le),S=c.rayPlane(s,G,Pe),P=h._projection,T=P.ellipsoid;i.fromElements(n.y,n.z,n.x,n);var x=P.unproject(n,Re);T.cartographicToCartesian(x,n);var M,L=A.eastNorthUpToFixedFrame(n,T,Te);M=a(S)?(i.fromElements(S.y,S.z,S.x,S),x=P.unproject(S,Re),T.cartographicToCartesian(x,S),A.eastNorthUpToFixedFrame(S,T,xe)):L;var N=e._globe,R=e._ellipsoid;e._globe=void 0,e._ellipsoid=u.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;var O=i.UNIT_Z,D=m.clone(h.transform,Oe);h._setTransform(L);var F=i.cross(i.UNIT_Z,i.normalize(h.position,Ne),Ne),U=i.dot(h.right,F);if(it(e,r,o,O,!1,!0),h._setTransform(M),U<0){o.startPosition.y>o.endPosition.y&&(O=void 0);var B=h.constrainedAxis;h.constrainedAxis=void 0,it(e,r,o,O,!0,!1),h.constrainedAxis=B}else it(e,r,o,O,!0,!1);if(a(h.constrainedAxis)){var k=i.cross(h.direction,h.constrainedAxis,Ue);i.equalsEpsilon(k,i.ZERO,f.EPSILON6)||(i.dot(k,h.right)<0&&i.negate(k,k),i.cross(k,h.direction,h.up),i.cross(h.direction,h.up,h.right),i.normalize(h.up,h.up),i.normalize(h.right,h.right))}h._setTransform(D),e._globe=N;var V=(e._ellipsoid=R).maximumRadius;e._rotateFactor=1/V,e._rotateRateRangeAdjustment=V;var W=i.clone(h.positionWC,Ne);if(h._adjustHeightForTerrain(),!i.equals(h.positionWC,W)){h._setTransform(M),h.worldToCameraCoordinatesPoint(W,W);var j=i.magnitudeSquared(W);i.magnitudeSquared(h.position)>j&&(i.normalize(h.position,h.position),i.multiplyByScalar(h.position,Math.sqrt(j),h.position));var z=i.angleBetween(W,h.position),H=i.cross(W,h.position,W);i.normalize(H,H);var q=C.fromAxisAngle(H,z,De),X=g.fromQuaternion(q,Fe);g.multiplyByVector(X,h.direction,h.direction),g.multiplyByVector(X,h.up,h.up),i.cross(h.direction,h.up,h.right),i.cross(h.right,h.direction,h.up),h._setTransform(D)}}(e,r,o)}}var ke=new t,Ve=new y,We=new i;function je(e,t,r){a(r.distance)&&(r=r.distance);var o=e._scene,n=o.camera,s=o.canvas,l=ke;l.x=s.clientWidth/2,l.y=s.clientHeight/2;var u,h,c=n.getPickRay(l,Ve);if(n.position.z<e._minimumPickingTerrainHeight&&(u=fe(e,l,We)),a(u))h=i.distance(c.origin,u);else{var p=i.UNIT_X,d=c.origin,f=c.direction;h=-i.dot(p,d)/i.dot(p,f)}ie(e,t,r,e._zoomFactor,h)}var ze=new y,He=new v(i.UNIT_X,0),qe=new i,Xe=new i,Ye=new i;function Ke(e,t,r){var o=e._scene,n=o.camera,s=fe(e,r.startPosition,Ye);if(a(s)){var l=r.endPosition,u=n.getPickRay(l,ze),h=i.clone(n.direction,Xe);o.mode===E.COLUMBUS_VIEW&&i.fromElements(h.z,h.x,h.y,h);var p=v.fromPointNormal(s,h,He),d=c.rayPlane(u,p,qe);a(d)&&(h=i.subtract(s,d,h),o.mode===E.COLUMBUS_VIEW&&i.fromElements(h.y,h.z,h.x,h),i.add(n.position,h,n.position))}}var Qe=new i,Ze=new o,Je=new i,$e=new u,et=new i;function tt(e,r,o){var n=e._scene.camera;if(m.equals(n.transform,m.IDENTITY)){var s,l,h,c=e._ellipsoid.geodeticSurfaceNormal(n.position,et),p=e._ellipsoid.cartesianToCartographic(n.positionWC,Ze).height,d=e._globe;if(a(d)&&p<e._minimumPickingTerrainHeight&&(h=fe(e,o.startPosition,Ye),a(h))){var g=n.getPickRay(o.startPosition,ce),_=e._ellipsoid.geodeticSurfaceNormal(h);Math.abs(i.dot(g.direction,_))<.05&&!e._looking&&(e._rotating=!1,e._strafing=!0)}t.equals(r,e._rotateMousePosition)?e._looking?Rt(e,r,o,c):e._rotating?it(e,r,o):e._strafing?(i.clone(h,e._strafeStartPosition),Ke(e,0,o)):(s=i.magnitude(e._rotateStartPosition),(l=Je).x=l.y=l.z=s,ct(e,r,o,u.fromCartesian3(l,$e))):(e._looking=!1,e._rotating=!1,e._strafing=!1,a(d)&&p<e._minimumPickingTerrainHeight?a(h)?i.magnitude(n.position)<i.magnitude(h)?(i.clone(h,e._strafeStartPosition),e._strafing=!0,Ke(e,0,o)):(s=i.magnitude(h),(l=Je).x=l.y=l.z=s,ct(e,r,o,u.fromCartesian3(l,$e)),i.clone(h,e._rotateStartPosition)):(e._looking=!0,Rt(e,r,o,c)):a(n.pickEllipsoid(o.startPosition,e._ellipsoid,Qe))?(ct(e,r,o,e._ellipsoid),i.clone(Qe,e._rotateStartPosition)):p>e._minimumTrackBallHeight?(e._rotating=!0,it(e,r,o)):(e._looking=!0,Rt(e,r,o,c)),t.clone(r,e._rotateMousePosition))}else{o&&o.startPosition&&o.endPosition&&(r=o.endPosition,o.endPosition=o.startPosition,o.startPosition=r,o.endPosition.x=(o.startPosition.x+o.endPosition.x)/2,o.endPosition.y=(o.startPosition.y+o.endPosition.y)/2);var v=function(e){var t=e._scene,r=t.camera,o=t._globe._ellipsoid,n=A.eastNorthUpToFixedFrame(r.position,o,Ct),a=m.clone(r.transform,At);r._setTransform(n);var s=new i;return s=m.multiplyByPoint(r.viewMatrix,s,s),r._setTransform(a),s}(e);n.pitch>f.clamp(e.constrainedPitch,-f.PI,0)&&0<=o.startPosition.y-o.endPosition.y||0<v.y&&o.startPosition.y-o.endPosition.y<=0?it(e,r,o,i.UNIT_Z,!1,!0):it(e,r,o)}}function it(e,t,r,o,s,l){s=n(s,!1),l=n(l,!1);var u=e._scene,h=u.camera,c=u.canvas,p=h.constrainedAxis;a(o)&&(h.constrainedAxis=o);var d=i.magnitude(h.position),f=e._rotateFactor*(d-e._rotateRateRangeAdjustment);f>e._maximumRotateRate&&(f=e._maximumRotateRate),f<e._minimumRotateRate&&(f=e._minimumRotateRate);var g=(r.startPosition.x-r.endPosition.x)/c.clientWidth,m=(r.startPosition.y-r.endPosition.y)/c.clientHeight;g=Math.min(g,e.maximumMovementRatio),m=Math.min(m,e.maximumMovementRatio);var _=f*g*Math.PI*2,v=f*m*Math.PI;s||h.rotateRight(-_),l||(1==e.enableGeoLocateRatate&&(h.constrainedAxis=void 0),h.rotateUp(v)),h.constrainedAxis=p}var rt=r.clone(r.UNIT_W),ot=r.clone(r.UNIT_W),nt=new i,at=new i,st=new i,lt=new i,ut=new t,ht=new t;function ct(e,r,o,n){var s=e._scene.camera,l=t.clone(o.startPosition,ut),u=t.clone(o.endPosition,ht),h=s.pickEllipsoid(l,n,rt),c=s.pickEllipsoid(u,n,ot);if(!a(h)||!a(c))return e._rotating=!0,void it(e,0,o);if(h=s.worldToCameraCoordinates(h,h),c=s.worldToCameraCoordinates(c,c),a(s.constrainedAxis)){var p=s.constrainedAxis,d=i.mostOrthogonalAxis(p,nt);i.cross(d,p,d),i.normalize(d,d);var g=i.cross(p,d,at),m=i.magnitude(h),_=i.dot(p,h),v=Math.acos(_/m),C=i.multiplyByScalar(p,_,st);i.subtract(h,C,C),i.normalize(C,C);var y=i.magnitude(c),A=i.dot(p,c),I=Math.acos(A/y),b=i.multiplyByScalar(p,A,lt);i.subtract(c,b,b),i.normalize(b,b);var w=Math.acos(i.dot(C,d));i.dot(C,g)<0&&(w=f.TWO_PI-w);var E=Math.acos(i.dot(b,d));i.dot(b,g)<0&&(E=f.TWO_PI-E);var G,S=w-E;G=i.equalsEpsilon(p,s.position,f.EPSILON2)?s.right:i.cross(p,s.position,nt);var P,T=i.cross(p,G,nt),x=i.dot(T,i.subtract(h,p,at)),M=i.dot(T,i.subtract(c,p,at));P=0<x&&0<M?I-v:0<x&&M<=0?0<i.dot(s.position,p)?-v-I:v+I:v-I,s.rotateRight(S),s.rotateUp(P)}else{i.normalize(h,h),i.normalize(c,c);var L=i.dot(h,c),N=i.cross(h,c,nt);if(L<1&&!i.equalsEpsilon(N,i.ZERO,f.EPSILON14)){var R=Math.acos(L);s.rotate(N,R)}}}var pt=new i,dt=new o;function ft(e,t,r){a(r.distance)&&(r=r.distance);var o=e._ellipsoid,n=e._scene,s=n.camera,l=n.canvas,u=ke;u.x=l.clientWidth/2,u.y=l.clientHeight/2;var h,c,p=s.getPickRay(u,Ve),d=o.cartesianToCartographic(s.position,dt).height;d<e._minimumPickingTerrainHeight&&(h=fe(e,u,We)),c=a(h)?i.distance(p.origin,h):d;var f=i.normalize(s.position,pt);ie(e,t,r,e._zoomFactor,c,i.dot(f,s.direction))}var gt=new t,mt=new y,_t=new i,vt=new i,Ct=new m,yt=new m,At=new m,It=new C,bt=new g,wt=new o,Et=new i;function Gt(e,r,o){var n=e._scene.camera;if(o&&o.startPosition&&o.endPosition&&(r=o.endPosition,o.endPosition=o.startPosition,o.startPosition=r,o.endPosition.x=(o.startPosition.x+o.endPosition.x)/2,o.endPosition.y=(o.startPosition.y+o.endPosition.y)/2),m.equals(n.transform,m.IDENTITY))if(a(o.angleAndHeight)&&(o=o.angleAndHeight),t.equals(r,e._tiltCenterMousePosition)||(e._tiltOnEllipsoid=!1,e._looking=!1),e._looking){var s=e._ellipsoid.geodeticSurfaceNormal(n.position,Et);Rt(e,r,o,s)}else{var l=e._ellipsoid.cartesianToCartographic(n.position,wt);e._tiltOnEllipsoid||l.height>e._minimumCollisionTerrainHeight?(e._tiltOnEllipsoid=!0,function(e,r,o){var n=e._ellipsoid,s=e._scene,l=s.camera,h=.25*e.minimumZoomDistance,p=n.cartesianToCartographic(l.positionWC,St).height;if(!(p-h-1<f.EPSILON3&&o.endPosition.y-o.startPosition.y<0)){var d=s.canvas,g=gt;g.x=d.clientWidth/2,g.y=d.clientHeight/2;var _,v=l.getPickRay(g,mt),C=c.rayEllipsoid(v,n);if(a(C))_=y.getPoint(v,C.start,_t);else{if(!(p>e._minimumTrackBallHeight)){e._looking=!0;var I=e._ellipsoid.geodeticSurfaceNormal(l.position,Et);return Rt(e,r,o,I),t.clone(r,e._tiltCenterMousePosition)}var b=c.grazingAltitudeLocation(v,n);if(!a(b))return;var w=n.cartesianToCartographic(b,wt);w.height=0,_=n.cartographicToCartesian(w,_t)}var E=A.eastNorthUpToFixedFrame(_,n,Ct),G=e._globe,S=e._ellipsoid;e._globe=void 0,e._ellipsoid=u.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;var P=m.clone(l.transform,At);l._setTransform(E),l.pitch>f.clamp(e.constrainedPitch,-f.PI,0)&&0<=o.startPosition.y-o.endPosition.y?it(e,0,o,i.UNIT_Z,!1,!0):it(e,0,o,i.UNIT_Z),l._setTransform(P),e._globe=G;var T=(e._ellipsoid=S).maximumRadius;e._rotateFactor=1/T,e._rotateRateRangeAdjustment=T}}(e,r,o)):function(e,r,o){var n,s,l,h=e._ellipsoid,p=e._scene,d=p.camera;if(t.equals(r,e._tiltCenterMousePosition))n=i.clone(e._tiltCenter,_t);else{if(n=fe(e,r,_t),!a(n)){if(s=d.getPickRay(r,mt),l=c.rayEllipsoid(s,h),!a(l)){if(h.cartesianToCartographic(d.position,wt).height<=e._minimumTrackBallHeight){e._looking=!0;var _=e._ellipsoid.geodeticSurfaceNormal(d.position,Et);Rt(e,r,o,_),t.clone(r,e._tiltCenterMousePosition)}return}n=y.getPoint(s,l.start,_t)}t.clone(r,e._tiltCenterMousePosition),i.clone(n,e._tiltCenter)}var v=p.canvas,I=gt;I.x=v.clientWidth/2,I.y=e._tiltCenterMousePosition.y,s=d.getPickRay(I,mt);var b=i.magnitude(n),w=i.fromElements(b,b,b,Je),E=u.fromCartesian3(w,$e);if(l=c.rayEllipsoid(s,E),a(l)){var G=i.magnitude(s.origin)>b?l.start:l.stop,S=y.getPoint(s,G,vt),P=A.eastNorthUpToFixedFrame(n,h,Ct),T=A.eastNorthUpToFixedFrame(S,E,yt),x=e._globe,M=e._ellipsoid;e._globe=void 0,e._ellipsoid=u.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;var L=i.UNIT_Z,N=m.clone(d.transform,At);d._setTransform(P);var R=i.cross(S,d.positionWC,Ue),O=i.dot(d.rightWC,R);if(it(e,0,o,L,!1,!0),d._setTransform(T),O<0){o.startPosition.y>o.endPosition.y&&(L=void 0);var D=d.constrainedAxis;d.constrainedAxis=void 0,it(e,0,o,L,!0,!1),d.constrainedAxis=D}else(d.pitch<f.clamp(e.constrainedPitch,-f.PI,0)||o.startPosition.y-o.endPosition.y<=0)&&it(e,0,o,L,!0,!1);if(a(d.constrainedAxis)){var F=i.cross(d.direction,d.constrainedAxis,Ue);i.equalsEpsilon(F,i.ZERO,f.EPSILON6)||(i.dot(F,d.right)<0&&i.negate(F,F),i.cross(F,d.direction,d.up),i.cross(d.direction,d.up,d.right),i.normalize(d.up,d.up),i.normalize(d.right,d.right))}d._setTransform(N),e._globe=x;var U=(e._ellipsoid=M).maximumRadius;e._rotateFactor=1/U,e._rotateRateRangeAdjustment=U;var B=i.clone(d.positionWC,Ue);if(d._adjustHeightForTerrain(),!i.equals(d.positionWC,B)){d._setTransform(T),d.worldToCameraCoordinatesPoint(B,B);var k=i.magnitudeSquared(B);i.magnitudeSquared(d.position)>k&&(i.normalize(d.position,d.position),i.multiplyByScalar(d.position,Math.sqrt(k),d.position));var V=i.angleBetween(B,d.position),W=i.cross(B,d.position,B);i.normalize(W,W);var j=C.fromAxisAngle(W,V,It),z=g.fromQuaternion(j,bt);g.multiplyByVector(z,d.direction,d.direction),g.multiplyByVector(z,d.up,d.up),i.cross(d.direction,d.up,d.right),i.cross(d.right,d.direction,d.up),d._setTransform(N)}}}(e,r,o)}}var St=new o,Pt=new t,Tt=new t,xt=new y,Mt=new y,Lt=new i,Nt=new i;function Rt(e,t,r,o){var s=e._scene.camera,l=Pt;l.x=r.startPosition.x,l.y=0;var u=Tt;u.x=r.endPosition.x,u.y=0;var h,c,p=s.getPickRay(l,xt),d=s.getPickRay(u,Mt),g=0;s.frustum instanceof _?(h=p.origin,c=d.origin,i.add(s.direction,h,h),i.add(s.direction,c,c),i.subtract(h,s.position,h),i.subtract(c,s.position,c),i.normalize(h,h),i.normalize(c,c)):(h=p.direction,c=d.direction);var m=i.dot(h,c);m<1&&(g=Math.acos(m)),g=r.startPosition.x>r.endPosition.x?-g:g;var v=e._horizontalRotationAxis;if(a(o)?s.look(o,-g):a(v)?s.look(v,-g):s.lookLeft(g),l.x=0,l.y=r.startPosition.y,u.x=0,u.y=r.endPosition.y,p=s.getPickRay(l,xt),d=s.getPickRay(u,Mt),g=0,s.frustum instanceof _?(h=p.origin,c=d.origin,i.add(s.direction,h,h),i.add(s.direction,c,c),i.subtract(h,s.position,h),i.subtract(c,s.position,c),i.normalize(h,h),i.normalize(c,c)):(h=p.direction,c=d.direction),(m=i.dot(h,c))<1&&(g=Math.acos(m)),g=r.startPosition.y>r.endPosition.y?-g:g,o=n(o,v),a(o)){var C=s.direction,y=i.negate(o,Lt),A=i.equalsEpsilon(C,o,f.EPSILON2),I=i.equalsEpsilon(C,y,f.EPSILON2);if(A||I)(A&&g<0||I&&0<g)&&s.look(s.right,-g);else{m=i.dot(C,o);var b=f.acosClamped(m);0<g&&b<g&&(g=b-f.EPSILON4),m=i.dot(C,y),b=f.acosClamped(m),g<0&&b<-g&&(g=-b+f.EPSILON4);var w=i.cross(o,C,Nt);s.look(w,g)}}else s.lookUp(g)}P.prototype.update=function(){m.equals(this._scene.camera.transform,m.IDENTITY)?(this._globe=this._scene.globe,this._ellipsoid=a(this._globe)?this._globe.ellipsoid:this._scene.mapProjection.ellipsoid):(this._globe=void 0,this._ellipsoid=u.UNIT_SPHERE),this._minimumCollisionTerrainHeight=this.minimumCollisionTerrainHeight*this._scene.terrainExaggeration,this._minimumPickingTerrainHeight=this.minimumPickingTerrainHeight*this._scene.terrainExaggeration,this._minimumTrackBallHeight=this.minimumTrackBallHeight*this._scene.terrainExaggeration;var e=this._ellipsoid.maximumRadius;this._rotateFactor=1/e,this._rotateRateRangeAdjustment=e;var t=this._scene.mode;t===E.SCENE2D?function(e){var t=e._scene.mapMode2D===w.ROTATE;m.equals(m.IDENTITY,e._scene.camera.transform)?(M(e,e.enableTranslate,e.translateEventTypes,ae,e.inertiaTranslate,"_lastInertiaTranslateMovement"),M(e,e.enableZoom,e.zoomEventTypes,se,e.inertiaZoom,"_lastInertiaZoomMovement"),t&&M(e,e.enableRotate,e.tiltEventTypes,he,e.inertiaSpin,"_lastInertiaTiltMovement")):(M(e,e.enableZoom,e.zoomEventTypes,se,e.inertiaZoom,"_lastInertiaZoomMovement"),t&&M(e,e.enableRotate,e.translateEventTypes,he,e.inertiaSpin,"_lastInertiaSpinMovement"))}(this):t===E.COLUMBUS_VIEW?(this._horizontalRotationAxis=i.UNIT_Z,function(e){var t=e._scene.camera;if(m.equals(m.IDENTITY,t.transform)){var i=e._tweens;if(e._aggregator.anyButtonDown&&i.removeAll(),M(e,e.enableTilt,e.tiltEventTypes,Be,e.inertiaSpin,"_lastInertiaTiltMovement"),M(e,e.enableTranslate,e.translateEventTypes,we,e.inertiaTranslate,"_lastInertiaTranslateMovement"),M(e,e.enableZoom,e.zoomEventTypes,je,e.inertiaZoom,"_lastInertiaZoomMovement"),M(e,e.enableLook,e.lookEventTypes,Rt),!(e._aggregator.anyButtonDown||a(e._lastInertiaZoomMovement)&&e._lastInertiaZoomMovement.active||a(e._lastInertiaTranslateMovement)&&e._lastInertiaTranslateMovement.active||i.contains(e._tween))){var r=t.createCorrectPositionTween(e.bounceAnimationTime);a(r)&&(e._tween=i.add(r))}i.update()}else M(e,e.enableRotate,e.rotateEventTypes,it,e.inertiaSpin,"_lastInertiaSpinMovement"),M(e,e.enableZoom,e.zoomEventTypes,ft,e.inertiaZoom,"_lastInertiaZoomMovement")}(this)):t===E.SCENE3D&&(this._horizontalRotationAxis=void 0,function(e){M(e,e.enableRotate,e.rotateEventTypes,tt,e.inertiaSpin,"_lastInertiaSpinMovement"),M(e,e.enableZoom,e.zoomEventTypes,ft,e.inertiaZoom,"_lastInertiaZoomMovement"),M(e,e.enableTilt,e.tiltEventTypes,Gt,2,"_lastInertiaTiltMovement"),M(e,e.enableLook,e.lookEventTypes,Rt)}(this)),this._aggregator.reset()},P.prototype.isDestroyed=function(){return!1},P.prototype.destroy=function(){return this._tweens.removeAll(),this._aggregator=this._aggregator&&this._aggregator.destroy(),s(this)},e.GeoScreenSpaceCameraController=P}(window.Cesium),function(e){function t(t,i,r,o){var n=this;n._viewer=r,n._source=t,n._videoProject=o,n._context=i,n._canvas=null,n._texture=null,n._context2D=null,n._width=0,n._height=0,n._dirty=!1,n._sampler=null,n._errorEvent=new e.Event,t&&t instanceof HTMLVideoElement&&t.addEventListener("timeupdate",(function e(){n._updateSize(Math.round(.1*t.videoWidth),Math.round(.1*t.videoHeight)),t.removeEventListener("timeupdate",e)})),r.clock.onTick.addEventListener((function(){n._updateTexture()}))}function i(t,i){this._videoProjection=i,this._scene=t,this._fs=null,this._uniforms=null,this._actived=!1,this._postStage=null,this._videoTexture=null,this._createEvent=new e.Event,this._addEvent=new e.Event,this._removeEvent=new e.Event}function r(){this._minFovX=r._MinFovX,this._maxFovX=r._MaxFovX,this._minFovY=r._MinFovY,this._maxFovY=r._MaxFovY,this._minFovDistance=r._MinFovDistance,this._maxFovDistance=r._MaxFovDistance,this._minHeading=r._MinHeading,this._maxHeading=r._MaxHeading,this._minPitch=r._MinPitch,this._maxPitch=r._MaxPitch,this._minRoll=r._MinRoll,this._maxRoll=r._MaxRoll,this._minSegmentCount=r._MinSegmentCount,this._maxSegmentCount=r._MaxSegmentCount,this._isInvSphere=!1,this._isSphereType=!0}function o(t,i,r){this._scene=t,this._position=i?i.clone():null,this._videoProjection=r,this._videoProjectionCamera=null,this._fovX=120,this._fovY=60,this._fovDistance=20,this._heading=0,this._pitch=0,this._roll=0,this._color=e.Color.BLUE.clone(),this._lineWidth=2,this._mixFactor=.8,this._vs=null,this._fs=null,this._boundingVolume=null,this._renderState=null,this._segmentCount=10,this._drawCommand=null,this._isNeedRecreate=!0,this._id=e.createGuid(),this._errorEvent=new e.Event,this._actived=!1,this._visibly=!0}t.prototype._getCurrentTexture=function(){return this._texture},e.defineProperties(t.prototype,{ErrorEvent:{get:function(){return this._errorEvent}}}),t.prototype._updateSize=function(e,t){e&&(this._width=e),t&&(this._height=t),this._dirty=!0},t.prototype._render=function(e){},t.prototype._createSampler=function(){this._sampler||(this._sampler=new e.Sampler)},t.prototype._updateTexture=function(){this._videoProject&&this._videoProject.fillVideo&&(this._context&&this._source?this._source.readyState<2||(!this._source.videoWidth||this._source.videoWidth<10?this._texture&&(this._texture.destroy(),this._texture=null):this._texture?this._texture.copyFrom(this._source):this._texture=new e.Texture({context:this._context,source:this._source,pixelFormat:e.PixelFormat.RGBA,pixelDatatype:e.PixelDatatype.UNSIGNED_BYTE})):this._errorEvent.raiseEvent("params"))},t.prototype._fetchVideo=function(){var t=e.when.defer();if(2<=this._source.readyState){var i=this._source.videoWidth,r=this._source.videoHeight;this._context2D.drawImage(this._source,0,0,i,r,0,0,this._width,this._height),t.resolve(this._canvas)}else t.reject(null);return t},t.prototype._createTexture=function(t){this._texture?this._texture.copyFrom(t):this._texture=new e.Texture({context:this._context,source:t,pixelFormat:e.PixelFormat.RGBA,pixelDatatype:e.PixelDatatype.UNSIGNED_BYTE,sampler:this._sampler})},t.prototype._recreateParseCanvas=function(){this._width<1||this._height<1||(this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.width=e.Math.nextPowerOfTwo(this._width),this._canvas.height=e.Math.nextPowerOfTwo(this._height),this._context2D=this._canvas.getContext("2d"))},t.prototype._readVideoFramePixels=function(){var e=this._source.videoWidth,t=this._source.videoHeight;return this._context2D.drawImage(this._source,0,0,e,t,0,0,this._width,this._height),this._canvas},t.prototype._createSource=function(e){return{arrayBufferView:new Uint8Array(e),width:this._width,height:this._height}},t.prototype.destroy=function(){this._source=null,this._context2D=null,this._context=null,this._canvas=null,this._videoProject=null,this._sampler=null,this._errorEvent=new e.Event,this._texture&&(this._texture.destroy(),this._texture=null)},i.prototype.destroy=function(){this._destroyPostStage(),this._videoProjection=null,this._scene=null,this._createEvent=null,this._addEvent=null,this._removeEvent=null,this._videoTexture=null},i._FS_Cone="uniform float mixNum;\nuniform float videoDistance;\nuniform sampler2D colorTexture;\nuniform sampler2D videoMapTexture;\nuniform sampler2D videoTexture;\nuniform sampler2D depthTexture;\nuniform mat4 videoMapMatrix;\nuniform mat4 videoViewMatrix;\nuniform vec3 videoMapPosition;\nvarying vec2 v_textureCoordinates;\nvec4 toEye(in vec2 uv, in float depth){\n    vec2 xy = vec2((uv.x * 2.0 - 1.0),(uv.y * 2.0 - 1.0));\n    vec4 posInCamera =czm_inverseProjection * vec4(xy, depth, 1.0);\n    posInCamera = posInCamera / posInCamera.w;\n    return posInCamera;\n}\nfloat getDepth(in vec4 depth){\n    float z_window = czm_unpackDepth(depth);\n    z_window = czm_reverseLogDepth(z_window);\n    float n_range = czm_depthRange.near;\n    float f_range = czm_depthRange.far;\n    return (2.0 * z_window - n_range - f_range) / (f_range - n_range);\n}\nbool videoVisibility(sampler2D shadowMap, vec4 position){\n    float visibility = step(position.z, texture2D(shadowMap, position.xy).r);\n    return (visibility == 1.0);\n}\nvoid main()\n{\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\n    vec4 currD = texture2D(depthTexture, v_textureCoordinates);\n    if(currD.r>=1.0){\n        gl_FragColor = color;\n        return;\n    }\n    float depth = getDepth(currD);\n    vec4 positionEC = toEye(v_textureCoordinates, depth);\n    vec4 videoPosition = videoMapMatrix * positionEC;\n    videoPosition /= videoPosition.w;\n    if (any(lessThan(videoPosition.xyz, vec3(0.0))) || any(greaterThan(videoPosition.xyz, vec3(1.0))))\n    {\n        gl_FragColor = color;\n        return;\n    }\n    bool visibility = videoVisibility(videoMapTexture, videoPosition);\n    if(visibility){\n        vec4 videoColor = texture2D(videoTexture, videoPosition.xy);\n        gl_FragColor = vec4(mix(color.rgb, videoColor.rgb, mixNum), 1.0);\n    }else{\n        gl_FragColor = color;\n    }\n}",i._FS_Cone_Fill="uniform float mixNum;\nuniform float videoDistance;\nuniform sampler2D colorTexture;\nuniform sampler2D videoMapTexture;\nuniform sampler2D depthTexture;\nuniform mat4 videoMapMatrix;\nuniform mat4 videoViewMatrix;\nuniform vec3 videoMapPosition;\nuniform vec4 u_videoColor;\nvarying vec2 v_textureCoordinates;\nvec4 toEye(in vec2 uv, in float depth){\n    vec2 xy = vec2((uv.x * 2.0 - 1.0),(uv.y * 2.0 - 1.0));\n    vec4 posInCamera =czm_inverseProjection * vec4(xy, depth, 1.0);\n    posInCamera = posInCamera / posInCamera.w;\n    return posInCamera;\n}\nfloat getDepth(in vec4 depth){\n    float z_window = czm_unpackDepth(depth);\n    z_window = czm_reverseLogDepth(z_window);\n    float n_range = czm_depthRange.near;\n    float f_range = czm_depthRange.far;\n    return (2.0 * z_window - n_range - f_range) / (f_range - n_range);\n}\nbool videoVisibility(sampler2D shadowMap, vec4 position){\n    float visibility = step(position.z, texture2D(shadowMap, position.xy).r);\n    return (visibility == 1.0);\n}\nvoid main()\n{\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\n    vec4 currD = texture2D(depthTexture, v_textureCoordinates);\n    if(currD.r>=1.0){\n        gl_FragColor = color;\n        return;\n    }\n    float depth = getDepth(currD);\n    vec4 positionEC = toEye(v_textureCoordinates, depth);\n    vec4 videoPosition = videoMapMatrix * positionEC;\n    videoPosition /= videoPosition.w;\n    if (any(lessThan(videoPosition.xyz, vec3(0.0))) || any(greaterThan(videoPosition.xyz, vec3(1.0))))\n    {\n        gl_FragColor = color;\n        return;\n    }\n    bool visibility = videoVisibility(videoMapTexture, videoPosition);\n    if(visibility){\n        vec4 videoColor = u_videoColor;\n        gl_FragColor = vec4(mix(color.rgb, videoColor.rgb, mixNum), 1.0);\n    }else{\n        gl_FragColor = color;\n    }\n}",i._FS_Sphere="uniform float mixNum;\nuniform float videoDistance;\nuniform sampler2D colorTexture;\nuniform sampler2D videoMapTexture;\nuniform sampler2D videoTexture;\nuniform sampler2D depthTexture;\nuniform mat4 videoMapMatrix;\nuniform mat4 videoViewMatrix;\nuniform vec3 videoMapPosition;\nuniform vec4 u_videoColor;\nvarying vec2 v_textureCoordinates;\nvec4 toEye(in vec2 uv, in float depth){\n    vec2 xy = vec2((uv.x * 2.0 - 1.0),(uv.y * 2.0 - 1.0));\n    vec4 posInCamera =czm_inverseProjection * vec4(xy, depth, 1.0);\n    posInCamera = posInCamera / posInCamera.w;\n    return posInCamera;\n}\nfloat getDepth(in vec4 depth){\n    float z_window = czm_unpackDepth(depth);\n    z_window = czm_reverseLogDepth(z_window);\n    float n_range = czm_depthRange.near;\n    float f_range = czm_depthRange.far;\n    return (2.0 * z_window - n_range - f_range) / (f_range - n_range);\n}\nbool videoVisibility(sampler2D shadowMap, vec4 position){\n    float visibility = step(position.z, texture2D(shadowMap, position.xy).r);\n    return (visibility == 1.0);\n}\nvoid main()\n{\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\n    vec4 currD = texture2D(depthTexture, v_textureCoordinates);\n    if(currD.r>=1.0){\n        gl_FragColor = color;\n        return;\n    }\n    float depth = getDepth(currD);\n    vec4 positionEC = toEye(v_textureCoordinates, depth);\n    vec4 videoPosition = videoMapMatrix * positionEC;\n    videoPosition /= videoPosition.w;\n    if (any(lessThan(videoPosition.xyz, vec3(0.0))) || any(greaterThan(videoPosition.xyz, vec3(1.0))))\n    {\n        gl_FragColor = color;\n        return;\n    }\n    bool visibility = videoVisibility(videoMapTexture, videoPosition);\n    if(visibility){\n        mat4 viewScene = videoViewMatrix;\n        vec4 positionWC = viewScene * positionEC;\n        positionWC /= positionWC.w;\n        depth = length(videoMapPosition - positionWC.xyz);\n        if(depth - videoDistance > -0.5){\n            gl_FragColor = color;\n            return;\n        }\n        vec4 videoColor = texture2D(videoTexture, videoPosition.xy);\n        gl_FragColor = vec4(mix(color.rgb, videoColor.rgb, mixNum), 1.0);\n    }else{\n        gl_FragColor = color;\n    }\n}",i._FS_Sphere_Fill="uniform float mixNum;\nuniform float videoDistance;\nuniform sampler2D colorTexture;\nuniform sampler2D videoMapTexture;\nuniform sampler2D depthTexture;\nuniform mat4 videoMapMatrix;\nuniform mat4 videoViewMatrix;\nuniform vec3 videoMapPosition;\nuniform vec4 u_videoColor;\nvarying vec2 v_textureCoordinates;\nvec4 toEye(in vec2 uv, in float depth){\n    vec2 xy = vec2((uv.x * 2.0 - 1.0),(uv.y * 2.0 - 1.0));\n    vec4 posInCamera =czm_inverseProjection * vec4(xy, depth, 1.0);\n    posInCamera = posInCamera / posInCamera.w;\n    return posInCamera;\n}\nfloat getDepth(in vec4 depth){\n    float z_window = czm_unpackDepth(depth);\n    z_window = czm_reverseLogDepth(z_window);\n    float n_range = czm_depthRange.near;\n    float f_range = czm_depthRange.far;\n    return (2.0 * z_window - n_range - f_range) / (f_range - n_range);\n}\nbool videoVisibility(sampler2D shadowMap, vec4 position){\n    float visibility = step(position.z, texture2D(shadowMap, position.xy).r);\n    return (visibility == 1.0);\n}\nvoid main()\n{\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\n    vec4 currD = texture2D(depthTexture, v_textureCoordinates);\n    if(currD.r>=1.0){\n        gl_FragColor = color;\n        return;\n    }\n    float depth = getDepth(currD);\n    vec4 positionEC = toEye(v_textureCoordinates, depth);\n    vec4 videoPosition = videoMapMatrix * positionEC;\n    videoPosition /= videoPosition.w;\n    if (any(lessThan(videoPosition.xyz, vec3(0.0))) || any(greaterThan(videoPosition.xyz, vec3(1.0))))\n    {\n        gl_FragColor = color;\n        return;\n    }\n    bool visibility = videoVisibility(videoMapTexture, videoPosition);\n    if(visibility){\n        mat4 viewScene = videoViewMatrix;\n        vec4 positionWC = viewScene * positionEC;\n        positionWC /= positionWC.w;\n        depth = length(videoMapPosition - positionWC.xyz);\n        if(depth - videoDistance > -0.5){\n            gl_FragColor = color;\n            return;\n        }\n        vec4 videoColor = u_videoColor;\n        gl_FragColor = vec4(mix(color.rgb, videoColor.rgb, mixNum), 1.0);\n    }else{\n        gl_FragColor = color;\n    }\n}",e.defineProperties(i.prototype,{CreationEvent:{get:function(){return this._createEvent}},AddToSceneEvent:{get:function(){return this._addEvent}},RemoveFromSceneEvent:{get:function(){return this._removeEvent}}}),i.prototype._updateState=function(){var e=this._videoProjection;if(e){if(this._videoTexture=e._getCurrentVideoTexture(),this._videoTexture)e.fillVideo||(this._videoTexture=null);else if(e.fillVideo)return void this._removeFromScene();this._createUniforms(),this._createPostStage(),this._addToScene()}},i.prototype._clearData=function(){this._uniforms=null,this._removeFromScene()},i.prototype._addToScene=function(){this._postStage&&(this._scene.postProcessStages.contains(this._postStage)||(this._scene.postProcessStages.add(this._postStage),this._addEvent.raiseEvent(this)))},i.prototype._removeFromScene=function(){this._postStage&&this._scene.postProcessStages.contains(this._postStage)&&(this._scene.postProcessStages.remove(this._postStage),this._postStage=null,this._removeEvent.raiseEvent(this))},i.prototype._createUniforms=function(){if(!this._uniforms){var e=this,t=e._videoProjection;e._videoTexture?this._uniforms={mixNum:function(){return t.mixFactor},videoMapTexture:function(){return t._getShadowMapTexture()},videoTexture:function(){return e._videoTexture},videoMapMatrix:function(){return t._getShadowMapMatrix()},videoViewMatrix:function(){return t._getViewMatrix()},videoDistance:function(){return t.fovDistance},videoMapPosition:function(){return t.position},u_videoColor:function(){return t.hitlineColor}}:this._uniforms={mixNum:function(){return t.mixFactor},videoMapTexture:function(){return t._getShadowMapTexture()},videoMapMatrix:function(){return t._getShadowMapMatrix()},videoViewMatrix:function(){return t._getViewMatrix()},videoDistance:function(){return t.fovDistance},videoMapPosition:function(){return t.position},u_videoColor:function(){return t.hitlineColor}}}},i.prototype._updatePost=function(){var e=this._postStage;e&&(e.enabled=this._videoProjection._actived)},i.prototype._createPostStage=function(){if(!this._postStage){var t;t=1==this._videoProjection.hitlineType?this._videoTexture?i._FS_Cone:i._FS_Cone_Fill:this._videoTexture?i._FS_Sphere:i._FS_Sphere_Fill,this._postStage=new e.PostProcessStage({fragmentShader:t,enabled:!1,uniforms:this._uniforms}),this._createEvent.raiseEvent(this)}},i.prototype._destroyPostStage=function(){this._postStage&&this._removeFromScene(),this._uniforms=null},e.defineProperties(r.prototype,{minFovX:{get:function(){return this._minFovX},set:function(e){this._minFovX=e}},maxFovX:{get:function(){return this._maxFovX},set:function(e){this._maxFovX=e}},minFovY:{get:function(){return this._minFovY},set:function(e){this._minFovY=e}},maxFovY:{get:function(){return this._maxFovY},set:function(e){this._maxFovY=e}},minFovDistance:{get:function(){return this._minFovDistance},set:function(e){this._minFovDistance=e}},maxFovDistance:{get:function(){return this._maxFovDistance},set:function(e){this._maxFovDistance=e}},minHeading:{get:function(){return this._minHeading},set:function(e){this._minHeading=e}},maxHeading:{get:function(){return this._maxHeading},set:function(e){this._maxHeading=e}},minPitch:{get:function(){return this._minPitch},set:function(e){this._minPitch=e}},maxPitch:{get:function(){return this._maxPitch},set:function(e){this._maxPitch=e}},minRoll:{get:function(){return this._minRoll},set:function(e){this._minRoll=e}},maxRoll:{get:function(){return this._maxRoll},set:function(e){this._maxRoll=e}},minSegmentCount:{get:function(){return this._minSegmentCount},set:function(e){this._minSegmentCount=e}},maxSegmentCount:{get:function(){return this._maxSegmentCount},set:function(e){this._maxSegmentCount=e}},isInvSphere:{get:function(){return this._isInvSphere},set:function(e){this._isInvSphere=e}},isSphereType:{get:function(){return this._isSphereType},set:function(e){this._isSphereType=e}}}),r._MinSegmentCount=5,r._MaxSegmentCount=10,r._MinFovX=1,r._MaxFovX=160,r._MinFovY=1,r._MaxFovY=90,r._MinFovDistance=1,r._MaxFovDistance=500,r._MinHeading=-180,r._MaxHeading=180,r._MinRoll=-90,r._MaxRoll=90,r._MinPitch=-90,r._MaxPitch=90,r.prototype.clampSegmentCount=function(e){return e?e<this._minSegmentCount?this._minSegmentCount:e>this._maxSegmentCount?this._maxSegmentCount:e:this._minSegmentCount},r.prototype.clampFovX=function(e){return e?e<this._minFovX?this._minFovX:e>this._maxFovX?this._maxFovX:e:this._maxFovX},r.prototype.clampFovY=function(e){return e?e<this._minFovY?this._minFovY:e>this._maxFovY?this._maxFovY:e:this._maxFovY},r.prototype.clampFovDistance=function(e){return e?e<this._minFovDistance?this._minFovDistance:e>this._maxFovDistance?this._maxFovDistance:e:this._minFovDistance},r.prototype.clampHeading=function(e){return e?e<this._minHeading?this._minHeading:e>this._maxHeading?this._maxHeading:e:0},r.prototype.clampPitch=function(e){return e?e<this._minPitch?this._minPitch:e>this._maxPitch?this._maxPitch:e:0},r.prototype.clampRoll=function(e){return e?e<this._minRoll?this._minRoll:e>this._maxRoll?this._maxRoll:e:0},o.prototype.destroy=function(){this._scene=null,this._videoProjection=null,this._id=null,this._errorEvent=null,this._boundingVolume=null,this._videoProjectionCamera=null,this._renderState=null,this._actived=!1,this._visibly=!1,this._drawCommand&&(this._drawCommand._shaderProgram&&(this._drawCommand._shaderProgram.destroy(),this._drawCommand._shaderProgram=null),this._drawCommand._vertexArray&&(this._drawCommand._vertexArray.destroy(),this._drawCommand._vertexArray=null),this._drawCommand=null)},e.defineProperties(o.prototype,{id:{get:function(){return this._id},set:function(e){this._id=e}},actived:{get:function(){return this._actived},set:function(e){this._actived=e}},visibly:{get:function(){return this._visibly},set:function(e){this._visibly=e}},DeveloperErrorEvent:{get:function(){return this._errorEvent}},minFovX:{get:function(){return this._videoProjection.config.minFovX}},maxFovX:{get:function(){return this._videoProjection.config.maxFovX}},minFovY:{get:function(){return this._videoProjection.config.minFovY}},maxFovY:{get:function(){return this._videoProjection.config.maxFovY}},minFovDistance:{get:function(){return this._videoProjection.config.minFovDistance}},maxFovDistance:{get:function(){return this._videoProjection.config.maxFovDistance}},minHeading:{get:function(){return this._videoProjection.config.minHeading}},maxHeading:{get:function(){return this._videoProjection.config.maxHeading}},minPitch:{get:function(){return this._videoProjection.config.minPitch}},maxPitch:{get:function(){return this._videoProjection.config.maxPitch}},minRoll:{get:function(){return this._videoProjection.config.minRoll}},maxRoll:{get:function(){return this._videoProjection.config.maxRoll}},minSegmentCount:{get:function(){return this._videoProjection.config.minSegmentCount}},maxSegmentCount:{get:function(){return this._videoProjection.config.maxSegmentCount}},isSphereType:{get:function(){return this._videoProjection.config.isSphereType}},isInvSphere:{get:function(){return this._videoProjection.config.isInvSphere}},position:{get:function(){return this._position}},fovX:{get:function(){return this._fovX},set:function(e){e<this.minFovX||e>this.maxFovX?this._errorEvent.raiseEvent("fovX!"):this._fovX!==e&&(this._fovX=e,this._isNeedRecreate=!0)}},fovY:{get:function(){return this._fovY},set:function(e){e<this.minFovY||e>this.maxFovY?this._errorEvent.raiseEvent("fovY!"):this._fovY!==e&&(this._fovY=e,this._isNeedRecreate=!0)}},fovDistance:{get:function(){return this._fovDistance},set:function(e){e<this.minFovDistance||e>this.maxFovDistance?this._errorEvent.raiseEvent("fovDistance!"):this._fovDistance!==e&&(this._fovDistance=e,this._isNeedRecreate=!0)}},heading:{get:function(){return this._heading},set:function(e){e<this.minHeading||e>this.maxHeading?this._errorEvent.raiseEvent("heading!"):this._heading!==e&&(this._heading=e,this._isNeedRecreate=!0)}},roll:{get:function(){return this._roll},set:function(e){e<this.minRoll||e>this.maxRoll?this._errorEvent.raiseEvent("roll!"):this._roll!==e&&(this._roll=e,this._isNeedRecreate=!0)}},pitch:{get:function(){return this._pitch},set:function(e){e<this.minPitch||e>this.maxPitch?this._errorEvent.raiseEvent("pitch!"):this._pitch!==e&&(this._pitch=e,this._isNeedRecreate=!0)}},color:{get:function(){return this._color},set:function(e){this._color=e.clone()}},lineWidth:{get:function(){return this._lineWidth},set:function(e){e<1?this._errorEvent.raiseEvent("lineWidth!"):this._lineWidth=e}},mixFactor:{get:function(){return this._mixFactor},set:function(e){e<0||1<e?this._errorEvent.raiseEvent("mixFactor!"):this._mixFactor=e}},drawCommand:{get:function(){return this._drawCommand}}}),o.prototype._render=function(e,t){this._actived&&this._visibly&&(t&&this._videoProjection===t?(t._getProjectionCamera&&(this._videoProjectionCamera=t._getProjectionCamera()),this.update(e),this._videoProjectionCamera=null):this._errorEvent.raiseEvent("render!"))},o.prototype.update=function(e){this._drawCommand&&e?e.commandList.push(this._drawCommand):this._errorEvent.raiseEvent("update!")},o.prototype._updatePosition=function(e){e&&(this._position=e.clone(),this._isNeedRecreate=!0,this._tryCreate())},o.prototype._updateFovX=function(e){e&&(this.fovX=e,this._tryCreate())},o.prototype._updateFovY=function(e){e&&(this.fovY=e,this._tryCreate())},o.prototype._updateFovDistance=function(e){e&&(this.fovDistance=e,this._tryCreate())},o.prototype._updateHeading=function(e){e&&(this.heading=e,this._tryCreate())},o.prototype._updatePitch=function(e){e&&(this.pitch=e,this._tryCreate())},o.prototype._updateRoll=function(e){e&&(this.roll=e,this._tryCreate())},o.prototype._updateParams=function(e,t,i,r,o,n){e&&(this.fovX=e),t&&(this.fovY=t),i&&(this.fovDistance=i),r&&(this.heading=r),o&&(this.pitch=o),n&&(this.roll=n),this._tryCreate()},o.prototype._createUniforms=function(){var e=this;return{uDiffuseColor:function(){return e.color}}},o.prototype._computeTransform=function(){if(!this.position)return this._errorEvent.raiseEvent("_computeTransform!"),null;var t=null;(t=this._videoProjectionCamera?e.Camera.clone(this._videoProjectionCamera,null):e.Camera.clone(this._scene.camera,null)).frustum.aspectRatio=this.fovX/this.fovY,t.frustum.fov=this.fovX*e.Math.RADIANS_PER_DEGREE,t.frustum.near=.1,t.frustum.far=this.fovDistance,t.setView({destination:this.position,orientation:{heading:this.heading*e.Math.RADIANS_PER_DEGREE,pitch:this.pitch*e.Math.RADIANS_PER_DEGREE,roll:this.roll*e.Math.RADIANS_PER_DEGREE}});var i=new e.Matrix4;return i[0]=t.right.x,i[1]=t.right.y,i[2]=t.right.z,i[3]=0,i[4]=t.direction.x,i[5]=t.direction.y,i[6]=t.direction.z,i[7]=0,i[8]=t.up.x,i[9]=t.up.y,i[10]=t.up.z,i[11]=0,i[12]=t.position.x,i[13]=t.position.y,i[14]=t.position.z,i[15]=1,i},o.prototype._computeTransformInv=function(){if(!this.position)return this._errorEvent.raiseEvent("_computeTransform!"),null;var t=null;return(t=this._videoProjectionCamera?e.Camera.clone(this._videoProjectionCamera,null):e.Camera.clone(this._scene.camera,null)).frustum.aspectRatio=this.fovX/this.fovY,t.frustum.fov=this.fovX*e.Math.RADIANS_PER_DEGREE,t.frustum.near=1,t.frustum.far=this.fovDistance,t.setView({destination:this.position,orientation:{heading:this.heading*e.Math.RADIANS_PER_DEGREE,pitch:this.pitch*e.Math.RADIANS_PER_DEGREE,roll:this.roll*e.Math.RADIANS_PER_DEGREE}}),t.inverseViewMatrix.clone()},o.prototype._createVS=function(){return"attribute vec4 aPosition;\nuniform vec4 uDiffuseColor;\nvarying vec4 vColor;\nvarying vec4 clip_vertex;\nvarying float fWindowZ;\nvarying vec3 normal_vertex;\nvec4 depthClampFarPlane(vec4 clipPos)\n{\n    fWindowZ = (0.5 * (clipPos.z / clipPos.w) + 0.5) * clipPos.w;\n    clipPos.z = min(clipPos.z, clipPos.w);\n    return clipPos;\n}\nvoid main()\n{\n    vec4 pos = czm_modelViewProjection * vec4(aPosition.xyz, 1.0);\n    gl_Position = depthClampFarPlane(pos);\n    clip_vertex = czm_modelView * vec4(aPosition.xyz, 1.0);\n    vColor = uDiffuseColor;\n    normal_vertex = aPosition.xyz;\n}"},o.prototype._createFS=function(){return"#extension GL_EXT_frag_depth : enable\n#extension GL_OES_standard_derivatives : enable\nvarying vec4 vColor;\nvarying float fWindowZ;\nvarying vec3 normal_vertex;\nconst vec4 LIGHT_COLOR = vec4(0.8, 0.8, 0.8, 1.0);\nvoid main()\n{\n    gl_FragDepthEXT = min(fWindowZ * gl_FragCoord.w, 1.0);\n    vec3 normal = cross(vec3(dFdx(normal_vertex.x), dFdx(normal_vertex.y), dFdx(normal_vertex.z)), vec3(dFdy(normal_vertex.x), dFdy(normal_vertex.y), dFdy(normal_vertex.z)));\n    normal = normalize(normal);\n    vec4 eyePosition = czm_modelView * vec4(normal_vertex.xyz, 1.0);\n    vec3 lightDirection = normalize(czm_sunPositionWC - vec3(eyePosition));\n    float nDotL = max(dot(lightDirection, normal), 0.0);\n    vec4 diffuse = vColor * LIGHT_COLOR * nDotL;\n    vec4 ambient = vColor * LIGHT_COLOR;\n    gl_FragColor = clamp(diffuse + ambient, vec4(0.0), vec4(1.0));\n}"},o.prototype._createVACone=function(){var t=this._scene.context;if(!t)return this._errorEvent.raiseEvent("_createVA!"),null;var i=this._fovDistance,r=e.ComponentDatatype.createTypedArray(e.ComponentDatatype.FLOAT,15),o=3,n=this._fovX*e.Math.RADIANS_PER_DEGREE,a=this._fovY*e.Math.RADIANS_PER_DEGREE;if(Math.pow(Math.cos(.5*n),2)<.001)return null;var s=i/Math.cos(.5*n),l=i*Math.tan(.5*a);i=Math.sqrt(s*s+l*l);for(var u=e.Math.PI_OVER_TWO+.5*n,h=.5*a,c=0,p=0,d=n/1,f=a/1,g=0;g<2;g++){c=u-g*d;for(var m=0;m<2;m++)p=h-m*f,r[o++]=i*Math.cos(p)*Math.cos(c),r[o++]=i*Math.cos(p)*Math.sin(c),r[o++]=i*Math.sin(p)}var _=e.ComponentDatatype.createTypedArray(e.ComponentDatatype.UNSIGNED_SHORT,16),v=0;for(_[v++]=0,_[v++]=1,_[v++]=0,_[v++]=2,_[v++]=0,_[v++]=3,_[v++]=0,_[v++]=4,g=0;g<2;g++)for(m=0;m<1;m++)_[v++]=1+m+2*g,_[v++]=1+(m+1)+2*g;for(g=0;g<2;g++)for(m=0;m<1;m++)_[v++]=1+2*m+g,_[v++]=1+2*(m+1)+g;var C=e.Buffer.createVertexBuffer({context:t,typedArray:r,usage:e.BufferUsage.STATIC_DRAW}),y=e.Buffer.createIndexBuffer({context:t,typedArray:_,usage:e.BufferUsage.STATIC_DRAW,indexDatatype:e.IndexDatatype.UNSIGNED_SHORT}),A=[];return A.push({index:0,vertexBuffer:C,componentsPerAttribute:3,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:12,normalize:!1}),this._createBoundingVolume(r),new e.VertexArray({context:t,attributes:A,indexBuffer:y})},o.prototype._createVASphere=function(){var t=this._scene.context;if(!t)return this._errorEvent.raiseEvent("_createVA!"),null;var i=Math.max(this._segmentCount,this.minSegmentCount);i=Math.min(i,this.maxSegmentCount);for(var r=this._fovDistance,o=(i+1)*(i+1)+1,n=e.ComponentDatatype.createTypedArray(e.ComponentDatatype.FLOAT,3*o),a=3,s=this._fovX*e.Math.RADIANS_PER_DEGREE,l=this._fovY*e.Math.RADIANS_PER_DEGREE,u=e.Math.PI_OVER_TWO+.5*s,h=.5*l,c=0,p=0,d=s/i,f=l/i,g=0;g<i+1;g++){c=u-g*d;for(var m=0;m<i+1;m++)p=h-m*f,n[a++]=r*Math.cos(p)*Math.cos(c),n[a++]=r*Math.cos(p)*Math.sin(c),n[a++]=r*Math.sin(p)}var _=4*(2+(i+1)*i),v=e.ComponentDatatype.createTypedArray(e.ComponentDatatype.UNSIGNED_SHORT,_),C=0;for(v[C++]=0,v[C++]=1,v[C++]=0,v[C++]=i+1,v[C++]=0,v[C++]=i*(i+1)+1,v[C++]=0,v[C++]=(i+1)*(i+1),g=0;g<i+1;g++)for(m=0;m<i;m++)v[C++]=1+m+(i+1)*g,v[C++]=1+(m+1)+(i+1)*g;for(g=0;g<i+1;g++)for(m=0;m<i;m++)v[C++]=1+(i+1)*m+g,v[C++]=1+(i+1)*(m+1)+g;var y=e.Buffer.createVertexBuffer({context:t,typedArray:n,usage:e.BufferUsage.STATIC_DRAW}),A=e.Buffer.createIndexBuffer({context:t,typedArray:v,usage:e.BufferUsage.STATIC_DRAW,indexDatatype:e.IndexDatatype.UNSIGNED_SHORT}),I=[];return I.push({index:0,vertexBuffer:y,componentsPerAttribute:3,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:12,normalize:!1}),this._createBoundingVolume(n),new e.VertexArray({context:t,attributes:I,indexBuffer:A})},o.prototype._createVASphereInv=function(){var t=this._scene.context;if(!t)return this._errorEvent.raiseEvent("_createVA!"),null;var i=Math.max(this._segmentCount,this.minSegmentCount);i=Math.min(i,this.maxSegmentCount);for(var r=this._fovDistance,o=(i+1)*(i+1)+1,n=e.ComponentDatatype.createTypedArray(e.ComponentDatatype.FLOAT,3*o),a=3,s=this._fovX*e.Math.RADIANS_PER_DEGREE,l=this._fovY*e.Math.RADIANS_PER_DEGREE,u=r*Math.tan(.5*l),h=Math.PI-.5*s,c=0,p=0,d=s/i,f=0;f<i+1;f++){c=h+f*d;for(var g=u/(r/Math.cos(c)),m=Math.atan(g),_=-m,v=2*m/i,C=0;C<i+1;C++)p=_+C*v,n[a++]=r*Math.cos(p)*Math.sin(c),n[a++]=r*Math.sin(p),n[a++]=r*Math.cos(p)*Math.cos(c)}var y=4*(2+(i+1)*i),A=e.ComponentDatatype.createTypedArray(e.ComponentDatatype.UNSIGNED_SHORT,y),I=0;for(A[I++]=0,A[I++]=1,A[I++]=0,A[I++]=i+1,A[I++]=0,A[I++]=i*(i+1)+1,A[I++]=0,A[I++]=(i+1)*(i+1),f=0;f<i+1;f++)for(C=0;C<i;C++)A[I++]=1+C+(i+1)*f,A[I++]=1+(C+1)+(i+1)*f;for(f=0;f<i+1;f++)for(C=0;C<i;C++)A[I++]=1+(i+1)*C+f,A[I++]=1+(i+1)*(C+1)+f;var b=e.Buffer.createVertexBuffer({context:t,typedArray:n,usage:e.BufferUsage.STATIC_DRAW}),w=e.Buffer.createIndexBuffer({context:t,typedArray:A,usage:e.BufferUsage.STATIC_DRAW,indexDatatype:e.IndexDatatype.UNSIGNED_SHORT}),E=[];return E.push({index:0,vertexBuffer:b,componentsPerAttribute:3,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:12,normalize:!1}),this._createBoundingVolume(n),new e.VertexArray({context:t,attributes:E,indexBuffer:w})},o.prototype._createRenderState=function(){return e.RenderState.fromCache({cull:{enabled:!1},depthTest:{enabled:!0}})},o.prototype._createAttributes=function(){return{aPosition:0}},o.prototype._createShadeProgram=function(){var t=this._scene.context;if(!t)return this._errorEvent.raiseEvent("_createShadeProgram!"),null;var i=this._createVS(),r=this._createFS(),o=this._createAttributes();return o?e.ShaderProgram.fromCache({context:t,vertexShaderSource:i,fragmentShaderSource:r,attributeLocations:o}):(this._errorEvent.raiseEvent("_createShadeProgram!"),null)};var n=new e.Cartesian3,a=new e.Cartesian3;o.prototype._createBoundingVolume=function(t){if(t&&t.length&&6<=t.length){for(var i=3,r=t[0],o=t[1],s=t[2],l=t[0],u=t[1],h=t[2],c=0;i<t.length;i+=3)c=t[i],r=Math.min(c,r),l=Math.max(c,l),c=t[i+1],o=Math.min(c,o),u=Math.max(c,u),c=t[i+2],s=Math.min(c,s),h=Math.max(c,h);n.x=r,n.y=o,n.z=s,a.x=l,a.y=u,a.z=h,this._boundingVolume=e.BoundingSphere.fromCornerPoints(n,a)}else this._boundingVolume=new e.BoundingSphere(e.Cartesian3.ZERO,this.fovDistance)};var s=new e.BoundingSphere(e.Cartesian3.ZERO,1);function l(t,i){this._shadowMap=null,this._scene=t,this._owner=i,this._actived=!1,this._updateMatrixEvent=new e.Event,this._updateEvent=new e.Event}function u(){this._base=0}o.prototype._updateBoundingVolume=function(t){var i=this._boundingVolume;return i?(e.BoundingSphere.transform(i,t,s),s):(this._errorEvent.raiseEvent("_updateBoundingVolume!"),null)},o.prototype._tryCreate=function(){try{this._recreate()}catch(e){this._drawCommand=null}},o.prototype._recreate=function(){if(this._isNeedRecreate){this._isNeedRecreate=!1,this._drawCommand&&(this._drawCommand._shaderProgram&&(this._drawCommand._shaderProgram.destroy(),this._drawCommand._shaderProgram=null),this._drawCommand._vertexArray&&(this._drawCommand._vertexArray.destroy(),this._drawCommand._vertexArray=null),this._drawCommand=null);var t;if(t=this.isInvSphere&&this.isSphereType?this._computeTransformInv():this._computeTransform()){var i;if(i=this.isSphereType?this.isInvSphere?this._createVASphereInv():this._createVASphere():this._createVACone()){var r=this._createRenderState();if(r){var o=this._createShadeProgram();if(o){var n=this._createUniforms(),a=this._updateBoundingVolume(t);a?this._drawCommand=new e.DrawCommand({vertexArray:i,primitiveType:e.PrimitiveType.LINES,renderState:r,shaderProgram:o,modelMatrix:t,boundingVolume:a,uniformMap:n,owner:this._videoProjection,pass:e.Pass.OPAQUE}):this._errorEvent.raiseEvent("_recreate!")}else this._errorEvent.raiseEvent("_recreate!")}else this._errorEvent.raiseEvent("_recreate!")}else this._errorEvent.raiseEvent("_recreate!")}else this._errorEvent.raiseEvent("_recreate!")}},e.defineProperties(l.prototype,{UpdateMatrixEvent:{get:function(){return this._updateMatrixEvent}},UpdateEvent:{get:function(){return this._updateEvent}}}),l.prototype._createSampler=function(){return new e.Sampler({wrapS:e.TextureWrap.CLAMP_TO_EDGE,wrapT:e.TextureWrap.CLAMP_TO_EDGE,minificationFilter:e.TextureMinificationFilter.NEAREST,magnificationFilter:e.TextureMagnificationFilter.NEAREST})},l.prototype._createFramebufferDepth=function(t,i){for(var r=new e.Texture({context:i,width:t._textureSize.x,height:t._textureSize.y,pixelFormat:e.PixelFormat.DEPTH_STENCIL,pixelDatatype:e.PixelDatatype.UNSIGNED_INT_24_8,sampler:this._createSampler()}),o=new e.Framebuffer({context:i,depthStencilTexture:r,destroyAttachments:!1}),n=t._passes.length,a=0;a<n;++a){var s=t._passes[a];s.framebuffer=o,s.passState.framebuffer=o}t._shadowMapTexture=r,t._depthAttachment=r},l.prototype._clearFramebuffer=function(e,t){e._clearCommand.framebuffer=e._passes[0].framebuffer,e._clearCommand.execute(t,e._clearPassState)},l.prototype._destroyShadowFramebuffer=function(){var t=this._shadowMap;if(t){for(var i=t._passes.length,r=0;r<i;++r){var o=t._passes[r],n=o.framebuffer;e.defined(n)&&!n.isDestroyed()&&n.destroy(),o.framebuffer=void 0}t._depthAttachment=t._depthAttachment&&t._depthAttachment.destroy(),t._colorAttachment=t._colorAttachment&&t._colorAttachment.destroy();var a=this._scene.frameState.context;this._createFramebufferDepth(t,a),this._clearFramebuffer(t,a)}},l.prototype.build=function(t,i,r,o,n,a,s){if(!this._shadowMap){var l=this._scene;if(l){var u=this,h=new e.Camera(l);h.frustum=new e.PerspectiveFrustum,h.frustum.aspectRatio=i/r,h.frustum.fov=i*e.Math.RADIANS_PER_DEGREE,h.frustum.near=1,h.frustum.far=o,h.setView({destination:t,orientation:{heading:n*e.Math.RADIANS_PER_DEGREE,pitch:a*e.Math.RADIANS_PER_DEGREE,roll:s*e.Math.RADIANS_PER_DEGREE}});var c=this._shadowMap=new e.ShadowMap({lightCamera:h,enable:!1,isPointLight:!1,isSpotLight:!0,cascadesEnabled:!1,context:l.context,pointLightRadius:o});c._updateOri=c.update,c.update=function(e){c._updateOri(e);var t=c._sceneCamera._invViewMatrix;u._updateMatrixEvent.raiseEvent(t),u._updateEvent.raiseEvent()}}}},l.prototype.update=function(t,i,r,o,n,a){if(this._shadowMap){var s=this._shadowMap._lightCamera;s.frustum.aspectRatio=t/i,s.frustum.fov=t*e.Math.RADIANS_PER_DEGREE,s.frustum.near=1,s.frustum.far=r,s.setView({destination:s.position,orientation:{heading:o*e.Math.RADIANS_PER_DEGREE,pitch:n*e.Math.RADIANS_PER_DEGREE,roll:a*e.Math.RADIANS_PER_DEGREE}})}},l.prototype.destroy=function(){this.deactive(),this._shadowMap&&(this._shadowMap.destroy(),this._shadowMap=null),this._scene=null,this._owner=null,this._updateMatrixEvent=null,this._updateEvent=null},l.prototype.active=function(){if(this._shadowMap){var e=this._scene.primitives;this._actived=!0;var t=this._shadowMap,i=t._proxy;i||(i={update:function(e){e.videoProjectionMaps||(e.videoProjectionMaps=[]),t.update(e),e.videoProjectionMaps.indexOf(t)<0&&e.videoProjectionMaps.push(t)},owner:t,destroy:function(){this.owner&&(this.owner._proxy=null,this.owner=null)}},t._proxy=i),e.contains(i)||e.add(i)}},l.prototype.deactive=function(){if(this._actived&&this._shadowMap){var e=this._scene&&this._scene.primitives;this._actived=!1;var t=this._shadowMap,i=t._proxy;i&&(e.contains(i)&&e.remove(i),t._proxy=null);var r=this._scene;if(r){var o=r.frameState.videoProjectionMaps;if(o){var n=o.indexOf(this._shadowMap);0<=n&&o.splice(n,1)}}}},l.prototype.updatePosition=function(t,i,r,o){if(t){var n=this._shadowMap;if(n){i||0===i||(i=a.heading),r||0===r||(r=a.pitch),o||0===o||(o=a.roll);var a=n._lightCamera;a.setView({destination:t,orientation:{heading:i*e.Math.RADIANS_PER_DEGREE,pitch:r*e.Math.RADIANS_PER_DEGREE,roll:o*e.Math.RADIANS_PER_DEGREE}})}}},l.prototype.updateFovX=function(t){if(t){var i=this._shadowMap;if(i){var r=i._lightCamera,o=r.frustum.fov/r.frustum.aspectRatio;r.frustum.fov=t*e.Math.RADIANS_PER_DEGREE,r.frustum.aspectRatio=r.frustum.fov/o}}},l.prototype.updateFovY=function(t){if(t){var i=this._shadowMap;if(i){var r=i._lightCamera;r.frustum.aspectRatio=r.frustum.fov/(t*e.Math.RADIANS_PER_DEGREE)}}},l.prototype.updateFovDistance=function(e){if(e){var t=this._shadowMap;t&&(t._lightCamera.frustum.far=e)}},l.prototype.updateHeadingPitchRoll=function(t,i,r){var o=this._shadowMap;if(o){t||0===t||(t=n.heading),i||0===i||(i=n.pitch),r||0===r||(r=n.roll);var n=o._lightCamera;n.setView({destination:n.position,orientation:{heading:t*e.Math.RADIANS_PER_DEGREE,pitch:i*e.Math.RADIANS_PER_DEGREE,roll:r*e.Math.RADIANS_PER_DEGREE}})}},l.prototype._getShadowMapTexture=function(){return this._shadowMap?this._shadowMap._shadowMapTexture:null},l.prototype._getShadowMapMatrix=function(){return this._shadowMap?this._shadowMap._shadowMapMatrix:null},l.prototype._getProjectionCamera=function(){return this._shadowMap?this._shadowMap._lightCamera:null},u.prototype._nextName=function(e){return e?e="VideoProjection"+e:(e="VideoProjection"+this._base.toString(),this._base+=1),e},u._instance=new u,u.nextName=function(){return u._instance._nextName()};var h=e.GeoVideoProjection=function(t,i,o,n,a){if(!t||!t.scene)throw e.DeveloperError("viewer or viewer.scene is invalid!");var s=t.scene;this._viewer=t,this._scene=s,this._videoProjectionConfig=new r,this._videoProjectionFrustumPrimitive=null,this._videoTextureSource=null,this._videoProjectionPostRender=null,this._videoShadowMap=null,this._invViewMatrix=null,this._fillVideo=!0,this._name=u.nextName(),this._actived=!1,this._owner=null,this._initialize(i,o,n,a)};function c(){this._array=[],this._addEvent=new e.Event,this._removeEvent=new e.Event,this._removeAllEvent=new e.Event,this._projectBackFaces=!1}h.prototype._initialize=function(r,n,a,s){var u=this,h=u._scene;if(r&&!(!r instanceof HTMLVideoElement)){s&&(s.minFovX&&(this._videoProjectionConfig.minFovX=s.minFovX),s.maxFovX&&(this._videoProjectionConfig.maxFovX=s.maxFovX),s.minFovY&&(this._videoProjectionConfig.minFovY=s.minFovY),s.maxFovY&&(this._videoProjectionConfig.maxFovY=s.maxFovY),s.minFovDistance&&(this._videoProjectionConfig.minFovDistance=s.minFovDistance),s.maxFovDistance&&(this._videoProjectionConfig.maxFovDistance=s.maxFovDistance),s.minHeading&&(this._videoProjectionConfig.minHeading=s.minHeading),s.maxHeading&&(this._videoProjectionConfig.maxHeading=s.maxHeading),s.minPitch&&(this._videoProjectionConfig.minPitch=s.minPitch),s.maxPitch&&(this._videoProjectionConfig.maxPitch=s.maxPitch),s.minRoll&&(this._videoProjectionConfig.minRoll=s.minRoll),s.maxRoll&&(this._videoProjectionConfig.maxRoll=s.maxRoll),s.isSphereType&&(this._videoProjectionConfig.isSphereType=s.isSphereType),s.isInvSphere&&(this._videoProjectionConfig.isInvSphere=s.isInvSphere)),(u._videoTextureSource=new t(r,h.context,this._viewer,this)).ErrorEvent.addEventListener((function(e){}));var c=u._videoProjectionFrustumPrimitive=new o(h,n,this);a&&a instanceof e.Color&&(c.color=a),c.DeveloperErrorEvent.addEventListener((function(e){}));var p=u._videoProjectionPostRender=new i(h,this);p.CreationEvent.addEventListener((function(e){})),p.AddToSceneEvent.addEventListener((function(e){})),p.RemoveFromSceneEvent.addEventListener((function(e){}));var d=this._videoShadowMap=new l(h,this);d.UpdateMatrixEvent.addEventListener((function(e){u._invViewMatrix=e})),d.UpdateEvent.addEventListener((function(e){u._videoProjectionPostRender&&u._videoProjectionPostRender._updateState()}))}},h.prototype._rebuildPostRender=function(){if(this._videoProjectionPostRender){this._videoProjectionPostRender.destroy();var e=this._videoProjectionPostRender=new i(this._scene,this);e.CreationEvent.addEventListener((function(e){})),e.AddToSceneEvent.addEventListener((function(e){})),e.RemoveFromSceneEvent.addEventListener((function(e){}))}},h.prototype._render=function(e){var t=this._videoTextureSource;t&&t._render(e);var i=this._videoProjectionFrustumPrimitive;i&&i._render(e,this);var r=this._videoProjectionPostRender;r&&r._updatePost(e)},h.prototype._destroyShadowFramebuffer=function(){this._videoShadowMap&&this._videoShadowMap._destroyShadowFramebuffer()},h.prototype._getShadowMapTexture=function(){return this._videoShadowMap?this._videoShadowMap._getShadowMapTexture():null},h.prototype._getShadowMapMatrix=function(){return this._videoShadowMap?this._videoShadowMap._getShadowMapMatrix():null},h.prototype._getProjectionCamera=function(){return this._videoShadowMap?this._videoShadowMap._getProjectionCamera():null},h.prototype.update=function(e,t,i,r,o,n){var a=this._videoProjectionConfig;e=a.clampFovX(e),t=a.clampFovY(t),i=a.clampFovDistance(i),r=a.clampHeading(r),o=a.clampPitch(o),n=a.clampRoll(n);var s=this._videoProjectionFrustumPrimitive;s&&s._updateParams(e,t,i,r,o,n);var l=this._videoShadowMap;l&&l.update(e,t,i,r,o,n)},h.prototype.active=function(){this._actived=!0;var e=this._videoProjectionFrustumPrimitive;e&&(e.actived=!0);var t=this._createShadowMap();t&&t.active()},h.prototype.deactive=function(){var e=this._videoProjectionFrustumPrimitive;e&&(e.actived=!1);var t=this._videoProjectionPostRender;t&&t._destroyPostStage();var i=this._videoShadowMap;i&&i.deactive(),this._actived=!1},h.prototype.updatePosition=function(e){if(e){var t=this._videoProjectionFrustumPrimitive;t&&t._updatePosition(e);var i=this._videoShadowMap;i&&i.updatePosition(e,t.heading,t.pitch,t.roll)}},h.prototype.updateFovX=function(e){e=this._videoProjectionConfig.clampFovX(e);var t=this._videoProjectionFrustumPrimitive;t&&t._updateFovX(e);var i=this._videoShadowMap;i&&i.update(t.fovX,t.fovY,t.fovDistance,t.heading,t.pitch,t.roll)},h.prototype.updateFovY=function(e){e=this._videoProjectionConfig.clampFovY(e);var t=this._videoProjectionFrustumPrimitive;t&&t._updateFovY(e);var i=this._videoShadowMap;i&&i.update(t.fovX,t.fovY,t.fovDistance,t.heading,t.pitch,t.roll)},h.prototype.updateFovDistance=function(e){e=this._videoProjectionConfig.clampFovDistance(e);var t=this._videoProjectionFrustumPrimitive;t&&t._updateFovDistance(e);var i=this._videoShadowMap;i&&i.updateFovDistance(e)},h.prototype.updateHeading=function(e){e=this._videoProjectionConfig.clampHeading(e);var t=this._videoProjectionFrustumPrimitive;t&&t._updateHeading(e);var i=this._videoShadowMap;i&&i.updateHeadingPitchRoll(t.heading,t.pitch,t.roll)},h.prototype.updatePitch=function(e){e=this._videoProjectionConfig.clampPitch(e);var t=this._videoProjectionFrustumPrimitive;t&&t._updatePitch(e);var i=this._videoShadowMap;i&&i.updateHeadingPitchRoll(t.heading,t.pitch,t.roll)},h.prototype.updateRoll=function(e){e=this._videoProjectionConfig.clampRoll(e);var t=this._videoProjectionFrustumPrimitive;t&&t._updateRoll(e);var i=this._videoShadowMap;i&&i.updateHeadingPitchRoll(t.heading,t.pitch,t.roll)},h.prototype.updateHitLineColor=function(e){if(e){var t=this._videoProjectionFrustumPrimitive;t&&(t.color=e)}},h.prototype.updateMixFactor=function(e){if(e){var t=this._videoProjectionFrustumPrimitive;t&&(t.mixFactor=e)}},h.prototype.updateLineWidth=function(e){if(e){var t=this._videoProjectionFrustumPrimitive;t&&(t.lineWidth=e)}},h.prototype.isSamedName=function(e){if(e)return this._name==e._name},h.prototype.isSelf=function(e){return this._name==e},h.prototype._createShadowMap=function(){if(!this._videoShadowMap)return null;var e=this._videoProjectionFrustumPrimitive;if(!e)return null;var t=e.position,i=e.fovX,r=e.fovY,o=e.fovDistance,n=e.heading,a=e.pitch,s=e.roll;return this._videoShadowMap.build(t,i,r,o,n,a,s),this._videoShadowMap},h.prototype._getCurrentVideoTexture=function(){return this._videoTextureSource?this._videoTextureSource._getCurrentTexture():null},h.prototype._getViewMatrix=function(){return this._videoShadowMap?this._invViewMatrix:e.Matrix4.IDENTITY},h.prototype.destroy=function(){this.deactive(),this._videoProjectionFrustumPrimitive&&(this._videoProjectionFrustumPrimitive.destroy(),this._videoProjectionFrustumPrimitive=null),this._videoShadowMap&&(this._videoShadowMap.destroy(),this._videoShadowMap=null),this._videoProjectionPostRender&&(this._videoProjectionPostRender.destroy(),this._videoProjectionPostRender=null),this._videoTextureSource&&(this._videoTextureSource.destroy(),this._videoTextureSource=null),this._invViewMatrix=null,this._viewer=null,this._scene=null,this._owner=null},e.defineProperties(h.prototype,{name:{get:function(){return this._name}},fillVideo:{get:function(){return this._fillVideo},set:function(e){this._fillVideo!=e&&(this._fillVideo=e,this._rebuildPostRender())}},position:{get:function(){return this._videoProjectionFrustumPrimitive.position}},fovX:{get:function(){return this._videoProjectionFrustumPrimitive.fovX},set:function(e){this.updateFovX(e)}},fovY:{get:function(){return this._videoProjectionFrustumPrimitive.fovY},set:function(e){this.updateFovY(e)}},fovDistance:{get:function(){return this._videoProjectionFrustumPrimitive.fovDistance},set:function(e){this.updateFovDistance(e)}},heading:{get:function(){return this._videoProjectionFrustumPrimitive.heading},set:function(e){this.updateHeading(e)}},pitch:{get:function(){return this._videoProjectionFrustumPrimitive.pitch},set:function(e){this.updatePitch(e)}},roll:{get:function(){return this._videoProjectionFrustumPrimitive.roll},set:function(e){this.updateRoll(e)}},hitlineColor:{get:function(){return this._videoProjectionFrustumPrimitive.color},set:function(e){this.updateHitLineColor(e)}},mixFactor:{get:function(){return this._videoProjectionFrustumPrimitive.mixFactor},set:function(e){this.updateMixFactor(e)}},lineWidth:{get:function(){return this._videoProjectionFrustumPrimitive.lineWidth},set:function(e){this.updateLineWidth(e)}},hitlineType:{get:function(){return this._videoProjectionFrustumPrimitive._type}},hitlineVisibly:{get:function(){return this._videoProjectionFrustumPrimitive.visibly},set:function(e){this._videoProjectionFrustumPrimitive.visibly=e}},config:{get:function(){return this._videoProjectionConfig}},isActived:{get:function(){return this._actived}}}),e.defineProperties(c.prototype,{length:{get:function(){return this._array.length}},AddEvent:{get:function(){return this._addEvent}},RemoveEvent:{get:function(){return this._removeEvent}},RemoveAllEvent:{get:function(){return this._removeAllEvent}},projectBackFaces:{get:function(){return this._projectBackFaces},set:function(e){if(this._projectBackFaces!=e){for(var t=this._array,i=t.length,r=0;r<i;r++)t[r]._destroyShadowFramebuffer();this._projectBackFaces=e}}}}),c.prototype.add=function(e){if(e){var t=e.name;if(!t)throw"noname!";if(this._findByName(t))throw"exist!";this._array.push(e),this._addEvent.raiseEvent(e)}},c.prototype.destoryObject=function(e){if(e){var t=e.name;if(!t)throw"noname!";this._findByName(t)&&this.removeByName(t),e.destroy()}},c.prototype.destroy=function(){this.clear()},c.prototype.getCount=function(){return this._array.length},c.prototype.clear=function(){for(var e=this._array.length,t=0;t<e;t++)this._array[t].destroy(),this._array[t]=null;this.removeAll()},c.prototype._render=function(e){for(var t=this._array,i=t.length,r=0;r<i;r++)t[r]._render(e)},c.prototype.getByIndex=function(e){var t=this._array.length;return e<0||t<=e?null:this._array[e]},c.prototype.getByName=function(e){return this._findByName(e)},c.prototype.removeByIndex=function(e){var t=this._array.length;e<0||t<=e||(this._array.splice(e,1),this._removeEvent.raiseEvent())},c.prototype.removeByName=function(e){for(var t=this._array.length,i=0;i<t;i++)if(this._array[i].isSelf(e))return this._array.splice(i,1),void this._removeEvent.raiseEvent()},c.prototype.removeAll=function(){this._array.length=0,this._removeAllEvent.raiseEvent()},c.prototype._findByName=function(e){if(!e)return null;for(var t=this._array.length,i=0;i<t;i++){var r=this._array[i];if(r.isSelf(e))return r}return null},c.prototype.getNames=function(){for(var e=[],t=this._array.length,i=0;i<t;i++){var r=this._array[i];e.push(r.name)}return e},e.Scene.prototype.getVideoProjectionCollection=function(){return this._videoProjectionCollection||(this._videoProjectionCollection=new c),this._videoProjectionCollection},e.Scene.prototype._renderVideoProjectionCollection=function(e){this._videoProjectionCollection||(this._videoProjectionCollection=new c),this._videoProjectionCollection._render(e)},e.Scene.prototype.destroyAllVideoProjections=function(){this._videoProjectionCollection&&this._videoProjectionCollection.clear()},e.Scene.prototype.destroyVideoProjection=function(e){e&&this._videoProjectionCollection&&this._videoProjectionCollection.destoryObject(e)},e.Scene.prototype.createVideoProjection=function(t,i,r,o){try{var n=new e.GeoVideoProjection(t,i,r,o);if(n){var a=this.getVideoProjectionCollection();a&&a.add(n)}return n}catch(t){return null}},e.Scene.prototype._clearPassesVideoProjectionCommands=function(e){if(e)for(var t=e.passes,i=t.length,r=0;r<i;++r)t[r].commandList.length=0},e.Scene.prototype._executePassesVideoProjectionCommands=function(e,t,i,r,o){for(var n=0;n<t;++n){var a=e.passes[n];i.updateCamera(a.camera),e.updatePass(r,n);for(var s=a.commandList.length,l=0;l<s;++l){var u=a.commandList[l];i.updatePass(u.pass),this._executeVideoProjectionCommand(u.derivedCommands.shadows.castCommands[o],r,a.passState)}}},e.Scene.prototype._executeVideoProjectionCastCommands=function(){var e=this.frameState,t=e.videoProjectionMaps;if(t){var i=this._videoProjectionCollection;if(i&&!i.projectBackFaces)for(var r=t.length,o=this.context,n=o.uniformState,a=0;a<r;++a){var s=t[a];if(!s.outOfView){var l=s.passes.length;this._clearPassesVideoProjectionCommands(s);var u=e.commandList;this._insertVideoProjectionCastCommands(u,s),this._executePassesVideoProjectionCommands(s,l,n,o,a)}}}},e.Scene.prototype._insertVideoProjectionCastCommands=function(t,i){for(var r=i.shadowMapCullingVolume,o=i.passes,n=t.length,a=0;a<n;++a){var s=t[a];this._updateVideoProjectionCommand(s),!s.castShadows||s.pass!==e.Pass.GLOBE&&s.pass!==e.Pass.CESIUM_3D_TILE&&s.pass!==e.Pass.OPAQUE&&s.pass!==e.Pass.TRANSLUCENT||this.isVisible(s,r)&&o[0].commandList.push(s)}},e.Scene.prototype._updateVideoProjectionCommand=function(t){if(e.defined(t.derivedCommands)){var i=this._frameState,r=this._context,o=i.useLogDepth,n=this._hdr,a=t.derivedCommands,s=e.defined(a.originalCommand),l=!(o&&n||s);if(t.dirty=!0,t.dirty){t.dirty=!1;var u=i.videoProjectionMaps;t.castShadows&&(a.shadows=e.ShadowMap.createCastDerivedCommand(u,t,!0,r,a.shadows)),(s||l)&&this._updateVideoProjectionCommands(t)}}},e.Scene.prototype._executeVideoProjectionCommand=function(t,i,r){var o=this._frameState;if(!e.defined(this.debugCommandFilter)||this.debugCommandFilter(t))if(t instanceof e.ClearCommand)t.execute(i,r);else if(!t.debugShowBoundingVolume||!e.defined(t.boundingVolume)){o.useLogDepth&&e.defined(t.derivedCommands.logDepth)&&(t=t.derivedCommands.logDepth.command);var n=o.passes;if(!n.pick&&this._hdr&&e.defined(t.derivedCommands)&&e.defined(t.derivedCommands.hdr)&&(t=t.derivedCommands.hdr.command),n.pick||n.depth){if(n.pick&&!n.depth&&e.defined(t.derivedCommands.picking))return void(t=t.derivedCommands.picking.pickCommand).execute(i,r);if(e.defined(t.derivedCommands.depth))return void(t=t.derivedCommands.depth.depthOnlyCommand).execute(i,r)}this.debugShowCommands||this.debugShowFrustums||(o.shadowState.lightShadowsEnabled&&t.receiveShadows&&e.defined(t.derivedCommands.shadows)?t.derivedCommands.shadows.receiveCommand.execute(i,r):t.execute(i,r))}},e.Scene.prototype._updateVideoProjectionCommands=function(t){var i=this._frameState,r=this._context,o=this._view.oit,n=i.shadowState.lightShadowMaps,a=i.shadowState.lightShadowsEnabled,s=t.derivedCommands;e.defined(t.pickId)&&(s.picking=e.DerivedCommand.createPickDerivedCommand(this,t,r,s.picking)),t.pickOnly||(s.depth=e.DerivedCommand.createDepthOnlyDerivedCommand(this,t,r,s.depth)),s.originalCommand=t,this._hdr&&(s.hdr=e.DerivedCommand.createHdrCommand(t,r,s.hdr),s=(t=s.hdr.command).derivedCommands),a&&t.receiveShadows&&(s.shadows=e.ShadowMap.createReceiveDerivedCommand(n,t,!0,r,s.shadows)),t.pass===e.Pass.TRANSLUCENT&&e.defined(o)&&o.isSupported()&&(a&&t.receiveShadows?(s.oit=e.defined(s.oit)?s.oit:{},s.oit.shadows=o.createDerivedCommands(s.shadows.receiveCommand,r,s.oit.shadows)):s.oit=o.createDerivedCommands(t,r,s.oit))}}(window.Cesium),function(e){var t=e.GeoViewAnalyse=function(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),this._stage=null,this.filterFar=1e6,this.scene=t.scene,this.initStage()};e.defineProperties(t.prototype,{name:{get:function(){return this._stage.name}},inputPreviousStageTexture:{get:function(){return this._stage.inputPreviousStageTexture}},enabled:{set:function(e){this._stage.enabled=e},get:function(){return this._stage.enabled}},_textureCache:{set:function(e){this._stage._textureCache=e},get:function(){return this._stage._textureCache}},outputTexture:{get:function(){return this._stage.outputTexture}},ready:{get:function(){return this._stage.ready}},_index:{set:function(e){this._stage._index=e},get:function(){return this._stage._index}},uniforms:{get:function(){return this._stage.uniforms}},_textureScale:{get:function(){return this._stage.textureScale}},_pixelFormat:{get:function(){return this._stage.pixelFormat}},_forcePowerOfTwo:{get:function(){return this._stage.forcePowerOfTwo}},_pixelDatatype:{get:function(){return this._stage.pixelDatatype}},_clearColor:{get:function(){return this._stage.clearColor}}}),t.prototype.initStage=function(){var t=this,i=new e.PostProcessStage({fragmentShader:"uniform sampler2D colorTexture;\nuniform sampler2D depthTexture;\nvarying vec2 v_textureCoordinates;\nuniform float u_filterFar;\nvec4 clipToEye(vec2 uv, float depth)\n{\n   vec2 xy = vec2((uv.x * 2.0 - 1.0), ((1.0 - uv.y) * 2.0 - 1.0));\n   vec4 posEC = czm_inverseProjection * vec4(xy, depth, 1.0);\n   posEC = posEC / posEC.w;\n   return posEC;\n}\nvoid main() {\n    vec4 color = texture2D(colorTexture, v_textureCoordinates);\n    vec3 hsb = czm_RGBToHSB(color.rgb);\n    hsb.g = clamp(hsb.g + 0.03, 0.0, 1.0);\n    if (hsb.b > 0.5)\n    {\n        hsb.b = clamp(hsb.b + 0.01, 0.0, 1.0);\n    }\n    else\n    {\n        hsb.b = clamp(hsb.b - 0.02, 0.0, 1.0);\n    }\n    color.rgb = czm_HSBToRGB(hsb);\n    float depth = czm_readDepth(depthTexture, v_textureCoordinates);\n    vec4 posInCamera = clipToEye(v_textureCoordinates, depth);\n    float d = length(posInCamera.xyz);\n    if (d > u_filterFar)\n    {\n       gl_FragColor = vec4(mix(color.rgb, vec3(0.8, 0.85, 0.85), 1.0 - u_filterFar / d), 1.0);\n    }\n    else \n    {\n       gl_FragColor = vec4(color.rgb, 1.0);\n    }\n}\n",name:e.createGuid(),inputPreviousStageTexture:!0,uniforms:{u_filterFar:function(){var e=t.scene;if(e){var i=e.camera;if(i.filterFar&&i.enableFilter)return.6*i.filterFar}return t.filterFar}}});(this._stage=i)._ready=!0},t.prototype.update=function(e,t){this._stage.update(e,t)},t.prototype._isSupported=function(e){return this._stage._isSupported(e)},t.prototype.execute=function(e,t,i,r){this._stage.execute(e,t,i,r)},t.prototype.destroy=function(){return this._stage.destroy(),destroyObject(this)}}(window.Cesium),function(e){var t=e.GeoWalkerAnimationCamera=function(t){this.viewer=t.viewer,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.ellipsoid=this.scene.globe.ellipsoid,this.path=e.defaultValue(t.path,null),this.moveStep=e.defaultValue(t.moveStep,2),this.rotateStep=e.defaultValue(t.rotateStep,10),this.frameChange=e.defaultValue(t.frameChange,(function(){})),this._lockCamera=!1,this.walkFrame=new i(this),this.walkFrame.addChangeEventListener(this.frameChange)};t.prototype.activate=function(){(this.camera._hooker=this).scene.logarithmicDepthBuffer=!1,e.Camera.prototype._hookUpdate=e.Camera.prototype.update,e.Camera.prototype.update=function(e){this._hookUpdate(e),this._hooker&&this._hooker.raiseUpdate(this)}},t.prototype.raiseUpdate=function(t){var i={};if(!this._lockCamera){var r=this.walkFrame.next();if(void 0!==r){i.position=e.Cartesian3.clone(r.position),i.geoposition=e.Cartographic.fromCartesian(r.position,this.ellipsoid);var o=e.Transforms.eastNorthUpToFixedFrame(r.position,this.ellipsoid,n),l=r.direction,u=new e.Cartesian3(o[8],o[9],o[10]),h=e.Cartesian3.cross(l,u,a);e.Cartesian3.normalize(h,h),u=e.Cartesian3.cross(h,l,s),e.Cartesian3.normalize(u,u),i.direction=e.Cartesian3.clone(l),i.up=e.Cartesian3.clone(u),i.right=e.Cartesian3.clone(h),this._lockCamera=!0,t.setView({destination:i.position,orientation:{direction:i.direction,up:i.up}}),this._lockCamera=!1}else this._lockCamera=!1}},t.prototype.unactivate=function(){e.Camera.prototype._hookUpdate&&(e.Camera.prototype.update=e.Camera.prototype._hookUpdate),delete this.camera._hooker&&delete this.camera.__proto__._hookUpdate},t.prototype.destroy=function(){e.Camera.prototype.update=e.Camera.prototype._hookUpdate,delete this.camera._hooker&&delete this.camera.__proto__._hookUpdate,this.scene.logarithmicDepthBuffer=!0};var i=function(t){this._walkAnimation=t,this._begin=0,this._isDone=!1,this._isPause=!1,this.changeEvent=new e.Event};function r(e,t,i){return void 0===e||void 0===e.x||void 0===t||void 0===t.x||!!o(e.x,t.x,i)&&!!o(e.y,t.y,i)&&!!o(e.z,t.z,i)}function o(e,t,i){return void 0===i&&(i=1e-7),Math.abs(e-t)<i}i.prototype.addChangeEventListener=function(e){this.changeEvent.addEventListener(e)},i.prototype.raiseChangeEvent=function(e){this.changeEvent.raiseEvent(e)},i.prototype.isDone=function(){return this._isDone},i.prototype.isPause=function(){return this._isPause},i.prototype.start=function(e){this._begin=null==e?0:e,this._isDone=!1,this._isPause=!1},i.prototype.stop=function(){this._toStop()},i.prototype._toStop=function(){this._isDone=!0,this._isPause=!1,this._begin=0,this.state=void 0,this._loadGeoposition=void 0,this._loadDirection=void 0},i.prototype.pause=function(){this._isPause=!0},i.prototype.run=function(){this._isPause=!1},i.ComputeTimeDelta=function(e,t){var i=t,r=i.getMilliseconds()-e.getMilliseconds();return r+=1e3*(i.getSeconds()-e.getSeconds()),(r+=60*(i.getMinutes()-e.getMinutes())*1e3)+60*(i.getHours()-e.getHours())*60*1e3},i.prototype.next=function(){if(!this._isDone){if(void 0===this.state)return this.state=this._createState(),void 0===this.state||(this.state.date=new Date),this.state;if(this._isPause)return this.state.date=new Date,this.state;var t=this.state;if(r(t.position,t.endPosition)&&r(t.direction,t.endDirection))return void 0!==t.next?(this.state=t.next,this.state.date=new Date,this.state):(this._begin++,this._begin>=this._walkAnimation.path.length?(this.raiseChangeEvent(this._begin),void this._toStop()):(this.state=this._createState(),void 0===this.state||(this.state.date=new Date),this.state));if(r(t.direction,t.endDirection)){var o=e.Cartesian3.distance(t.endPosition,t.position),n=this._walkAnimation.moveStep+t.moveSpeed;return l=new Date,u=i.ComputeTimeDelta(t.date,l),t.date=l,o<=(n*=u/1e3)?(t.position=e.Cartesian3.clone(t.endPosition,new e.Cartesian3),t):(a=e.Cartesian3.subtract(t.endPosition,t.position,new e.Cartesian3),e.Cartesian3.normalize(a,a),e.Cartesian3.multiplyByScalar(a,n,a),t.position=e.Cartesian3.add(t.position,a,new e.Cartesian3),t)}var a=e.Cartesian3.cross(t.direction,t.endDirection,new e.Cartesian3);e.Cartesian3.normalize(a,a);var s=e.Math.toRadians(this._walkAnimation.rotateStep+t.rotateSpeed),l=new Date,u=i.ComputeTimeDelta(t.date,l);if(t.date=l,(s*=u/1e3)<e.Cartesian3.angleBetween(t.direction,t.endDirection)){var h=e.Quaternion.fromAxisAngle(a,s,new e.Quaternion),c=e.Matrix3.fromQuaternion(h,new e.Matrix3),p=e.Matrix4.fromRotationTranslation(c,new e.Cartesian3(0,0,0),new e.Matrix4),d=e.Matrix4.multiplyByPointAsVector(p,t.direction,new e.Cartesian3);return t.direction=e.Cartesian3.normalize(d,new e.Cartesian3),t}return t.direction=e.Cartesian3.clone(t.endDirection,new e.Cartesian3),t}},i.prototype._createState=function(){this.raiseChangeEvent(this._begin);var t=this._begin,i=t+1,r=this._walkAnimation.path;if(i>=r.length)return this.raiseChangeEvent(i),void this._toStop();var o={},n=r[t],a=r[i];return o.position=e.Cartesian3.fromDegrees(n.geoposition.longitude,n.geoposition.latitude,n.geoposition.height,this._walkAnimation.ellipsoid,new e.Cartesian3),o.direction=e.Cartesian3.clone(n.direction,new e.Cartesian3),o.moveSpeed=n.moveSpeed,o.rotateSpeed=n.rotateSpeed,o.endPosition=e.Cartesian3.fromDegrees(a.geoposition.longitude,a.geoposition.latitude,a.geoposition.height,this._walkAnimation.ellipsoid,new e.Cartesian3),o.endDirection=e.Cartesian3.clone(a.direction,new e.Cartesian3),o};var n=new e.Matrix4,a=(new e.Cartesian3,new e.Cartesian3),s=new e.Cartesian3}(window.Cesium),function(e){var t=e.GeoWalkerCamera=function(i){this.viewer=i.viewer,this.scene=this.viewer.scene,this.camera=this.viewer.camera,this.stepSize=e.defaultValue(i.stepSize,1),this.rotateSize=e.defaultValue(i.rotateSize,5),this.manHeight=e.defaultValue(i.manHeight,1.6),this.manRange=e.defaultValue(i.manRange,.8),this.state=t.stateType.UNKNOWN,this._lockCamera=!1,this._readyCamera=!1,this._ellipsoid=this.scene.globe.ellipsoid,this._walkQueue=new h,this.canLog=!1,this.filterFar=e.defaultValue(i.filterFar,null),i.filterFog&&this.viewer&&viewer.scene.postProcessStages.add(new e.GeoViewAnalyse({scene:viewer.scene}))};t.prototype.setState=function(t){0<u()(e.GeoWalkerCamera.stateType).filter((function(i){return e.GeoWalkerCamera.stateType[i]===t})).length&&(this.state=t)},t.prototype.activate=function(){this.filterFar&&(this.camera.filterFar=this.filterFar),(this.camera._hooker=this).scene.logarithmicDepthBuffer=!1,e.Camera.prototype._hookUpdate=e.Camera.prototype.update,e.Camera.prototype.update=function(e){this._hookUpdate(e),this._hooker&&this._hooker.raiseUpdate(this)}},t.prototype.unactivate=function(){this.camera&&this.camera.filterFar&&delete this.camera.filterFar,e.Camera.prototype._hookUpdate&&(e.Camera.prototype.update=e.Camera.prototype._hookUpdate),delete this.camera._hooker&&delete this.camera.__proto__._hookUpdate},t.prototype.raiseUpdate=function(e){if(!(!this._readyCamera||this._lockCamera||this.state<1))switch(this.state){case t.stateType.FORWARD:this.computeForeward(e);break;case t.stateType.BACKWARD:this.computeBackward(e);break;case t.stateType.LEFTWARD:case t.stateType.RIGHTWARD:break;case t.stateType.UPWARD:this.computeTrunUp(e);break;case t.stateType.DOWNWARD:this.computeTrunDown(e);break;case t.stateType.LEFT:this.computeTrunLeft(e);break;case t.stateType.RIGHT:this.computeTrunRight(e);break;case t.stateType.UNKNOWN:return}},t.prototype.setView=function(e){this._lockCamera=!0,this.camera.setView(e),this._lockCamera=!1,this._readyCamera=!0},t.prototype.jumpUp=function(e){this._lockCamera=!0,this.camera.moveUp(e||100),this._lockCamera=!1},t.prototype.computeInitialPosition=function(t){this.scene.pick(t);var i=this.scene.pickPosition(t),r=e.Cartographic.fromCartesian(i,this._ellipsoid);if(0<r.height)r.height+=this.manHeight;else{var o=this.scene.globe.getHeight(r);r.height=0<o?o+this.manHeight:1e3}var n=e.Cartesian3.fromRadians(r.longitude,r.latitude,r.height,this._ellipsoid);this._lockCamera=!0,this.camera.setView({destination:n,orientation:{heading:this.camera.heading,pitch:0,up:0}}),this._lockCamera=!1,this._readyCamera=!0,this.camera&&this.filterFar&&(this.enableFilter(!0),this.camera.enableFilter=!0)},t.prototype.computeForeward=function(t){var i=new e.Cartesian3,o=t.position,u=(t.positionWC,t.directionWC.clone()),h=this.getTangentNormal(),c=e.Cartesian3.cross(u,h,a);e.Cartesian3.normalize(c,c),u=e.Cartesian3.cross(h,c,n),e.Cartesian3.normalize(u,u);var p=this._computeCollideDistance(o,u,h,1/r*this.stepSize);e.Cartesian3.multiplyByScalar(u,p,i),e.Cartesian3.add(o,i,o);var d=l;d.origin=o,d.direction=e.Cartesian3.negate(h,s);var f=e.Cartographic.fromCartesian(d.origin,this._ellipsoid),g=e.GeoRayPick.pick(this.scene,d,u,!0);if(g&&g.position&&g.object)(_=e.Cartographic.fromCartesian(g.position,this._ellipsoid)).height+=this.manHeight,(m=f.height-_.height)<3&&-1<m?(this.log("Forward : height = "+m),o=e.Cartesian3.fromRadians(_.longitude,_.latitude,_.height,this._ellipsoid)):this.log("Forward : height = 0");else{var m,_=e.Cartographic.fromCartesian(o,this._ellipsoid),v=this.scene.globe.getHeight(_);_.height=0<v?v+this.manHeight:_.height,(m=f.height-_.height)<3&&-1<m?(this.log("Forward Node : height = "+m),o=e.Cartesian3.fromRadians(_.longitude,_.latitude,_.height,this._ellipsoid)):this.log("Forward Node : height = 0")}this._lockCamera=!0,t.setView({destination:o,orientation:{heading:t.heading,pitch:t.pitch,up:t.up}}),this._lockCamera=!1},t.prototype.computeBackward=function(t){var i=new e.Cartesian3,o=t.position,u=(t.positionWC,t.directionWC.clone()),h=this.getTangentNormal(),c=e.Cartesian3.cross(u,h,a);e.Cartesian3.normalize(c,c),u=e.Cartesian3.cross(h,c,n),e.Cartesian3.normalize(u,u),u=e.Cartesian3.negate(u,n);var p=this._computeCollideDistance(o,u,h,1/r*this.stepSize);e.Cartesian3.multiplyByScalar(u,p,i),e.Cartesian3.add(o,i,o);var d=l;d.origin=o,d.direction=e.Cartesian3.negate(h,s);var f=e.Cartographic.fromCartesian(d.origin,this._ellipsoid),g=e.Cartesian3.negate(u,new e.Cartesian3),m=e.GeoRayPick.pick(this.scene,d,g,!0);if(m&&m.position&&m.object)(v=e.Cartographic.fromCartesian(m.position,this._ellipsoid)).height+=this.manHeight,(_=f.height-v.height)<3&&-1<_?(this.log("Backward : height = "+_),o=e.Cartesian3.fromRadians(v.longitude,v.latitude,v.height,this._ellipsoid)):this.log("Backward : height = 0");else{var _,v=e.Cartographic.fromCartesian(o,this._ellipsoid),C=this.scene.globe.getHeight(v);v.height=0<C?C+this.manHeight:v.height,(_=f.height-v.height)<3&&-1<_?(this.log("Backward Node : height = "+_),o=e.Cartesian3.fromRadians(v.longitude,v.latitude,v.height,this._ellipsoid)):this.log("Backward Node : height = 0")}this._lockCamera=!0,t.setView({destination:o,orientation:{heading:t.heading,pitch:t.pitch,up:t.up}}),this._lockCamera=!1},t.prototype._computeCollideDistance=function(t,i,r,o){var n=l;n.origin=t,n.direction=i;var a=e.GeoRayPick.pick(this.scene,n,r,!1);if(a&&a.position){var s=e.Cartesian3.distance(t,a.position);return s<=this.manRange?s=0:s-=this.manRange,this.log("collide :"+s+" max: "+o),Math.min(s,o)}return this.log("Not collide"),o},t.prototype.log=function(e){this.canLog&&console.log(e)},t.prototype.computeLeftward=function(e){},t.prototype.computeRightward=function(e){},t.prototype.computeTrunLeft=function(t){t.look(this.getTangentNormal(),-e.Math.toRadians(e.defaultValue(this.rotateSize,5))/r)},t.prototype.computeTrunRight=function(t){t.look(this.getTangentNormal(),e.Math.toRadians(e.defaultValue(this.rotateSize,5))/r)},t.prototype.computeTrunUp=function(t){t.look(e.Cartesian3.cross(t.directionWC.clone(),this.getTangentNormal(),a),-e.Math.toRadians(e.defaultValue(this.rotateSize,5))/r)},t.prototype.computeTrunDown=function(t){t.look(e.Cartesian3.cross(t.directionWC.clone(),this.getTangentNormal(),a),e.Math.toRadians(e.defaultValue(this.rotateSize,5))/r)},t.prototype.getTangentNormal=function(){var t=e.Transforms.eastNorthUpToFixedFrame(this.camera.positionWC,this._ellipsoid,o);return new e.Cartesian3(t[8],t[9],t[10])},t.prototype.destroy=function(){e.Camera.prototype.update=e.Camera.prototype._hookUpdate,delete this.camera._hooker&&delete this.camera.__proto__._hookUpdate,this.scene.logarithmicDepthBuffer=!0};var i=new e.Cartesian2;t.prototype.raiseMouseMove=function(t){if(t.startPosition&&t.endPosition){var o=e.Cartesian2.subtract(t.endPosition,t.startPosition,i);if(0!=o.x){var n=e.defaultValue(this.rotateSize,5)*o.x/5;this.camera.look(this.getTangentNormal(),e.Math.toRadians(n)/r)}0!=o.y&&(n=e.defaultValue(this.rotateSize,5)*o.y/5,this.camera.look(e.Cartesian3.cross(this.camera.directionWC.clone(),this.getTangentNormal(),a),e.Math.toRadians(n)/r))}},t.prototype.enableFilter=function(t){t=t||!1,this.camera&&this.filterFar&&1.58<=e.VERSION&&((this.camera.enableFilter=t)?e.Cesium3DTileset.prototype.filterWithCamera=function(t,i){var r=i.camera;if(r.filterFar&&r.enableFilter){var o=r.filterFar,n=t.boundingSphere.radius,a=e.Cartesian3.distance(t.boundingSphere.center,r._positionWC);if(o<(a-=n))return!0}return!1}:e.Cesium3DTileset.prototype.filterWithCamera&&delete e.Cesium3DTileset.__proto__.filterWithCamera)},t.stateType={UNKNOWN:0,FORWARD:1,BACKWARD:2,LEFTWARD:3,RIGHTWARD:4,UPWARD:5,DOWNWARD:6,LEFT:7,RIGHT:8};var r=40,o=new e.Matrix4,n=new e.Cartesian3,a=new e.Cartesian3,s=new e.Cartesian3,l=new e.Ray;function h(){var e=[],t=0;this.push=function(t){return 10<=this.size()&&this.pop(),e.push(t),!0},this.pop=function(){return e.shift()},this.getFront=function(){return e[0]},this.getRear=function(){return e[e.length-1]},this.clear=function(){e=[]},this.size=function(){return e.length},this.getAvgHeight=function(){for(var t=0,i=e.length,r=0;r<i;r++)t+=e[r].height;return t/i},this.getLatelyHeight=function(){return 0<e.length?e[e.length-1].height:null},this.getDropThreshold=function(t){return 0<e.length&&4.5<Math.abs(this.getLatelyHeight()-t.height)},this.preventFalling=function(e){this.getDropThreshold(e)&&(20<t?t=0:(e.height=3<t?this.getAvgHeight():this.getLatelyHeight(),t++),e.height=this.getLatelyHeight()),this.push(e)}}}(window.Cesium),function(e){var t=e.defaultValue,i=e.GeoWater=function(i){var r=(i=t(i,t.EMPTY_OBJECT)).url;this._viewer=i.viewer,this._scene=this._viewer.scene,this._pointsToCartographic=[],this._waterColor=new e.Color(.439,.564,.788,0),this._refractColor=new e.Color(0,0,0,0),this._reflectColor=new e.Color(.439,.564,.788,0),this._waveWidth=.2,this._flowDirection=90,this._flowSpeed=.7,this._normalTexture=void 0,this._m_startTime=0,this._reflectCamera=void 0,this._reflectPassState=void 0,this._initialized=!1,this._drawCommand=void 0,this._isVisible=!0,this._scene._context;var o=this,n=new Image;n.src=r,n.onload=function(){o._normalTexture=new e.Texture({context:o._scene.context,width:n.width,height:n.height,source:n,sampler:new e.Sampler({wrapS:e.TextureWrap.REPEAT,wrapT:e.TextureWrap.REPEAT})}),o._scene.primitives.add(o)}};e.defineProperties(i.prototype,{waterPolygon:{get:function(){return this._waterPolygon},set:function(e){null!=e&&null!=this._waterPolygon&&this.release(),this._waterPolygon=e}},waterColor:{get:function(){return this._waterColor},set:function(e){this._waterColor=e}},flowSpeed:{get:function(){return this._flowSpeed},set:function(e){this._flowSpeed=e}},flowDirection:{get:function(){return this._flowDirection},set:function(e){this._flowDirection=e}},waveWidth:{get:function(){return this._waveWidth},set:function(e){this._waveWidth=e}},isVisible:{get:function(){return this._isVisible},set:function(e){this._isVisible=e}}}),i.prototype._computeBoundingRectangle=function(){this._pointsToCartographic=[];var t=this._waterPolygon._polygonHierarchy.positions,i=e.Cartographic.fromCartesian(t[0]),r=e.Math.toDegrees(i.longitude),o=e.Math.toDegrees(i.latitude),n=e.Math.toDegrees(i.longitude),a=e.Math.toDegrees(i.latitude);this._zFactor=i.height;for(var s=0;s<t.length;s++){var l=e.Cartographic.fromCartesian(t[s]),u=e.Math.toDegrees(l.longitude),h=e.Math.toDegrees(l.latitude),c=new e.Cartesian2(u,h);this._pointsToCartographic.push(c),n<u&&(n=u),u<r&&(r=u),a<h&&(a=h),h<o&&(o=h)}this._lonMin=r,this._latMin=o,this._waterCenterPos=new e.Cartesian3.fromDegrees((r+n)/2,(o+a)/2,this._zFactor)},i.prototype.initialize=function(){var t=this._scene,i=t._context;if(e.defined(this._reflectCamera)||(this._reflectCamera=new e.Camera(t)),!e.defined(this._reflectPassState)){var r=new e.Framebuffer({context:i,colorTextures:[new e.Texture({context:i,width:512,height:512,pixelFormat:e.PixelFormat.RGBA})],depthRenderbuffer:new e.Renderbuffer({context:i,format:e.RenderbufferFormat.DEPTH_COMPONENT16,width:512,height:512})});this._reflectPassState=new e.PassState(i),this._reflectPassState.viewport=new e.BoundingRectangle(0,0,512,512),this._reflectPassState.framebuffer=r}this._initialized=!0,this._computeBoundingRectangle()},i.prototype.update=function(t){if(e.defined(this.waterPolygon)){var i=this._scene;if(0!==i.camera.workingFrustums.length){this._initialized||this.initialize();var r=i._context;this._fScale=1/(.001*this._waveWidth);var o=new e.Cartesian3(this._waterCenterPos.x,this._waterCenterPos.y,this._waterCenterPos.z),n=e.Cartographic.fromCartesian(this._waterCenterPos),a=e.Math.toDegrees(n.longitude),s=e.Math.toDegrees(n.latitude),l=e.Cartesian3.fromDegrees(a,s,0);e.Cartesian3.normalize(l,l);var u=new e.Cartesian3(0,1,0),h=new e.Cartesian3(0,1,0);h=e.Cartesian3.cross(u,l,h),e.Cartesian3.normalize(h,h),u=e.Cartesian3.cross(l,h,u);var c=new e.Matrix3;e.Matrix3.setRow(c,0,h,c),e.Matrix3.setRow(c,1,u,c),e.Matrix3.setRow(c,2,l,c);var p=new e.Cartesian3,d=new e.Cartesian3(-o.x,-o.y,-o.z);e.Matrix3.multiplyByVector(c,d,p);var f=new e.Matrix4(c[0],c[3],c[6],p.x,c[1],c[4],c[7],p.y,c[2],c[5],c[8],p.z,0,0,0,1);this.invWorldViewMatrix=new e.Matrix4,e.Matrix4.multiply(f,t.camera.inverseViewMatrix,this.invWorldViewMatrix),this.modelMatrix=new e.Matrix4(1,0,0,o.x,0,1,0,o.y,0,0,1,o.z,0,0,0,1),this.modelViewMatrix=new e.Matrix4,this.modeiViewProjection=new e.Matrix4,this.modelViewMatrix=e.Matrix4.multiply(t.camera.viewMatrix,this.modelMatrix,this.modelViewMatrix),this.modeiViewProjection=e.Matrix4.multiply(t.camera.workingFrustums[0].projectionMatrix,this.modelViewMatrix,this.modeiViewProjection);var g=e.JulianDate.now();0==this._m_startTime&&(this._m_startTime=g.secondsOfDay);var m=g.secondsOfDay;if(this._fElapse=(m-this._m_startTime)/1,this._frameTime=this._fElapse*this._flowSpeed,this._flowAngle=this._flowDirection*Math.PI/180,null==this._drawCommand){var _=e.ShaderProgram.fromCache({context:r,vertexShaderSource:"attribute vec3 position;\n\t\t\t\t\t\t\t\t\t\t\tattribute vec2 st;\n\t\t\t\t\t\t\t\t\t\t\tuniform mat4 u_modelViewProjectionMatrix;\n\t\t\t\t\t\t\t\t\t\t\tuniform mat4 u_modelViewMatrix;\n\t\t\t\t\t\t\t\t\t\t\tuniform mat4 u_invWorldViewMatrix;\n\t\t\t\t\t\t\t\t\t\t\tuniform vec2 u_texCoordOffset;\n\t\t\t\t\t\t\t\t\t\t\tuniform vec2 u_texCoordScale;\n\t\t\t\t\t\t\t\t\t\t\tuniform float u_frameTime;\n\t\t\t\t\t\t\t\t\t\t\tuniform int u_clampToGroud;\n\t\t\t\t\t\t\t\t\t\t\tuniform vec3 u_camPos;\n\t\t\t\t\t\t\t\t\t\t\tuniform vec3 u_scale;\n\t\t\t\t\t\t\t\t\t\t\tvarying vec3 eyeDir;\n\t\t\t\t\t\t\t\t\t\t\tvarying vec2 texCoord;\n\t\t\t\t\t\t\t\t\t\t\tvarying float myTime;\n\t\t\t\t\t\t\t\t\t\t\tvarying vec4 projectionCoord;\n\t\t\t\t\t\t\t\t\t\t\tvoid main(void)\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t//gl_Position = ftransform();\n\t\t\t\t\t\t\t\t\t\t\t\tgl_Position = u_modelViewProjectionMatrix * vec4(position.xyz,1.0);\n\t\t\t\t\t\t\t\t\t\t\t\tif (u_clampToGroud == 1)\n\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\teyeDir = (u_camPos - position.xyz) * u_scale;\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\tvec4 pos = u_modelViewMatrix * vec4(position.xyz,1.0);\n\t\t\t\t\t\t\t\t\t\t\t\t\teyeDir = vec3(u_invWorldViewMatrix*vec4(pos.xyz,0.0));\n\t\t\t\t\t\t\t\t\t\t\t\t\tprojectionCoord = gl_Position;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\ttexCoord = (st+u_texCoordOffset)*u_texCoordScale;\n\t\t\t\t\t\t\t\t\t\t\t\tmyTime = 0.01 * u_frameTime;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t",fragmentShaderSource:"uniform sampler2D u_normalMap;\n\t\t\t\t\t\t\t\t\t\t\t\tuniform sampler2D u_refractMap;\n\t\t\t\t\t\t\t\t\t\t\t\t//uniform samplerCube u_cubeMap;\n\t\t\t\t\t\t\t\t\t\t\t\tuniform sampler2D u_reflectMap;\n\t\t\t\t\t\t\t\t\t\t\t\t//uniform sampler2D u_flowMap;\n\t\t\t\t\t\t\t\t\t\t\t\tuniform vec4 u_waterColor;\n\t\t\t\t\t\t\t\t\t\t\t\tuniform vec4 u_refractColor;\n\t\t\t\t\t\t\t\t\t\t\t\tuniform int u_useRefractTex;\n\t\t\t\t\t\t\t\t\t\t\t\tuniform vec4 u_reflectColor;\n\t\t\t\t\t\t\t\t\t\t\t\tuniform int u_reflection;\n\t\t\t\t\t\t\t\t\t\t\t\tuniform vec2 u_flowDir;\n\t\t\t\t\t\t\t\t\t\t\t\tvarying vec3 eyeDir;\n\t\t\t\t\t\t\t\t\t\t\t\tvarying vec2 texCoord;\n\t\t\t\t\t\t\t\t\t\t\t\tvarying float myTime;\n\t\t\t\t\t\t\t\t\t\t\t\tvarying vec4 projectionCoord;\n\t\t\t\t\t\t\t\t\t\t\t\tvoid main (void)\n\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t// texScale determines the amount of tiles generated.\n\t\t\t\t\t\t\t\t\t\t\t\t\tfloat texScale = 35.0;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// texScale2 determines the repeat of the water texture (the normalmap) itself\n\t\t\t\t\t\t\t\t\t\t\t\t\tfloat texScale2 = 10.0;\n\t\t\t\t\t\t\t\t\t\t\t\t\tfloat myangle;\n\t\t\t\t\t\t\t\t\t\t\t\t\tfloat transp;\n\t\t\t\t\t\t\t\t\t\t\t\t\tvec3 myNormal;\n\t\t\t\t\t\t\t\t\t\t\t\t\tvec2 mytexFlowCoord = texCoord * texScale;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// ff is the factor that blends the tiles.\n\t\t\t\t\t\t\t\t\t\t\t\t\tvec2 ff = abs(2.0*(fract(mytexFlowCoord)) - 1.0) -0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// take a third power, to make the area with more or less equal contribution\n\t\t\t\t\t\t\t\t\t\t\t\t\t// of more tile bigger\n\t\t\t\t\t\t\t\t\t\t\t\t\tff = 0.5-4.0*ff*ff*ff;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// ffscale is a scaling factor that compensates for the effect that\n\t\t\t\t\t\t\t\t\t\t\t\t\t// adding normal vectors together tends to get them closer to the average normal\n\t\t\t\t\t\t\t\t\t\t\t\t\t// which is a visible effect. For more or less random waves, this factor\n\t\t\t\t\t\t\t\t\t\t\t\t\t// compensates for it\n\t\t\t\t\t\t\t\t\t\t\t\t\tvec2 ffscale = sqrt(ff*ff + (1.0-ff)*(1.0-ff));\n\t\t\t\t\t\t\t\t\t\t\t\t\tvec2 Tcoord = texCoord  * texScale2;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// offset makes the water move\n\t\t\t\t\t\t\t\t\t\t\t\t\tvec2 offset = vec2(myTime,0.0);\n\t\t\t\t\t\t\t\t\t\t\t\t\t// I scale the texFlowCoord and floor the value to create the tiling\n\t\t\t\t\t\t\t\t\t\t\t\t\t// This could have be replace by an extremely lo-res texture lookup\n\t\t\t\t\t\t\t\t\t\t\t\t\t// using NEAREST pixel.\n\t\t\t\t\t\t\t\t\t\t\t\t\tvec3 sample = vec3(u_flowDir, 1.0);//texture2D( u_flowMap, floor(mytexFlowCoord)/ texScale).rgb;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// flowdir is supposed to go from -1 to 1 and the line below\n\t\t\t\t\t\t\t\t\t\t\t\t\t// used to be sample.xy * 2.0 - 1.0, but saves a multiply by\n\t\t\t\t\t\t\t\t\t\t\t\t\t// moving this factor two to the sample.b\n\t\t\t\t\t\t\t\t\t\t\t\t\tvec2 flowdir = sample.xy -0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// sample.b is used for the inverse length of the wave\n\t\t\t\t\t\t\t\t\t\t\t\t\t// could be premultiplied in sample.xy, but this is easier for editing flowtexture\n\t\t\t\t\t\t\t\t\t\t\t\t\tflowdir *= sample.b;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// build the rotation matrix that scales and rotates the complete tile\n\t\t\t\t\t\t\t\t\t\t\t\t\tmat2 rotmat = mat2(flowdir.x, -flowdir.y, flowdir.y ,flowdir.x);\n\t\t\t\t\t\t\t\t\t\t\t\t\t// this is the normal for tile A\n\t\t\t\t\t\t\t\t\t\t\t\t\tvec2 NormalT0 = texture2D(u_normalMap, rotmat * Tcoord - offset).rg;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// for the next tile (B) I shift by half the tile size in the x-direction\n\t\t\t\t\t\t\t\t\t\t\t\t\tsample = vec3(u_flowDir, 1.0);//texture2D( u_flowMap, floor((mytexFlowCoord + vec2(0.5,0)))/ texScale ).rgb;\n\t\t\t\t\t\t\t\t\t\t\t\t\tflowdir = sample.b * (sample.xy - 0.5);\n\t\t\t\t\t\t\t\t\t\t\t\t\trotmat = mat2(flowdir.x, -flowdir.y, flowdir.y ,flowdir.x);\n\t\t\t\t\t\t\t\t\t\t\t\t\t// and the normal for tile B...\n\t\t\t\t\t\t\t\t\t\t\t\t\t// multiply the offset by some number close to 1 to give it a different speed\n\t\t\t\t\t\t\t\t\t\t\t\t\t// The result is that after blending the water starts to animate and look\n\t\t\t\t\t\t\t\t\t\t\t\t\t// realistic, instead of just sliding in some direction.\n\t\t\t\t\t\t\t\t\t\t\t\t\t// This is also why I took the third power of ff above, so the area where the\n\t\t\t\t\t\t\t\t\t\t\t\t\t// water animates is as big as possible\n\t\t\t\t\t\t\t\t\t\t\t\t\t// adding a small arbitrary constant isn't really needed, but helps to show\n\t\t\t\t\t\t\t\t\t\t\t\t\t// a bit less tiling in the beginning of the program. After a few seconds, the\n\t\t\t\t\t\t\t\t\t\t\t\t\t// tiling cannot be seen anymore so this constant could be removed.\n\t\t\t\t\t\t\t\t\t\t\t\t\t// For the quick demo I leave them in. In a simulation that keeps running for\n\t\t\t\t\t\t\t\t\t\t\t\t\t// some time, you could just as well remove these small constant offsets\n\t\t\t\t\t\t\t\t\t\t\t\t\tvec2 NormalT1 = texture2D(u_normalMap, rotmat * Tcoord - offset*1.06+0.62).rg;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// blend them together using the ff factor\n\t\t\t\t\t\t\t\t\t\t\t\t\t// use ff.x because this tile is shifted in the x-direction\n\t\t\t\t\t\t\t\t\t\t\t\t\tvec2 NormalTAB = ff.x * NormalT0 + (1.0-ff.x) * NormalT1;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// the scaling of NormalTab and NormalTCD is moved to a single scale of\n\t\t\t\t\t\t\t\t\t\t\t\t\t// NormalT later in the program, which is mathematically identical to\n\t\t\t\t\t\t\t\t\t\t\t\t\t// NormalTAB = (NormalTAB - 0.5) / ffscale.x + 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// tile C is shifted in the y-direction\n\t\t\t\t\t\t\t\t\t\t\t\t\tsample = vec3(u_flowDir, 1.0);//texture2D( u_flowMap, floor((mytexFlowCoord + vec2(0.0,0.5)))/ texScale ).rgb;\n\t\t\t\t\t\t\t\t\t\t\t\t\tflowdir = sample.b * (sample.xy - 0.5);\n\t\t\t\t\t\t\t\t\t\t\t\t\trotmat = mat2(flowdir.x, -flowdir.y, flowdir.y ,flowdir.x);\n\t\t\t\t\t\t\t\t\t\t\t\t\tNormalT0 = texture2D(u_normalMap, rotmat * Tcoord - offset*1.33+0.27).rg;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// tile D is shifted in both x- and y-direction\n\t\t\t\t\t\t\t\t\t\t\t\t\tsample = vec3(u_flowDir, 1.0);//texture2D( u_flowMap, floor((mytexFlowCoord + vec2(0.5,0.5)))/ texScale ).rgb;\n\t\t\t\t\t\t\t\t\t\t\t\t\tflowdir = sample.b * (sample.xy - 0.5);\n\t\t\t\t\t\t\t\t\t\t\t\t\trotmat = mat2(flowdir.x, -flowdir.y, flowdir.y ,flowdir.x);\n\t\t\t\t\t\t\t\t\t\t\t\t\tNormalT1 = texture2D(u_normalMap, rotmat * Tcoord - offset*1.24).rg ;\n\t\t\t\t\t\t\t\t\t\t\t\t\tvec2 NormalTCD = ff.x * NormalT0 + (1.0-ff.x) * NormalT1;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// NormalTCD = (NormalTCD - 0.5) / ffscale.x + 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// now blend the two values togetherv\n\t\t\t\t\t\t\t\t\t\t\t\t\tvec2 NormalT = ff.y * NormalTAB + (1.0-ff.y) * NormalTCD;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// this line below used to be here for scaling the result\n\t\t\t\t\t\t\t\t\t\t\t\t\t//NormalT = (NormalT - 0.5) / ffscale.y + 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// below the new, direct scaling of NormalT\n\t\t\t\t\t\t\t\t\t\t\t\t\tNormalT = (NormalT - 0.5) / (ffscale.y * ffscale.x);\n\t\t\t\t\t\t\t\t\t\t\t\t\t// scaling by 0.3 is arbritrary, and could be done by just\n\t\t\t\t\t\t\t\t\t\t\t\t\t// changing the values in the normal map\n\t\t\t\t\t\t\t\t\t\t\t\t\t// without this factor, the waves look very strong\n\t\t\t\t\t\t\t\t\t\t\t\t\tNormalT *= 0.3;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// to make the water more transparent\n\t\t\t\t\t\t\t\t\t\t\t\t\ttransp = 1.0;//texture2D( u_flowMap, texFlowCoord ).a;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// and scale the normals with the transparency\n\t\t\t\t\t\t\t\t\t\t\t\t\tNormalT *= transp*transp;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// assume normal of plane is 0,0,1 and produce the normalized sum of adding NormalT to it\n\t\t\t\t\t\t\t\t\t\t\t\t\tmyNormal = vec3(NormalT,sqrt(1.0-NormalT.x*NormalT.x - NormalT.y*NormalT.y));\n\t\t\t\t\t\t\t\t\t\t\t\t\t// 获取反射颜色。\n\t\t\t\t\t\t\t\t\t\t\t\t\tvec3 envColor = u_reflectColor.rgb;//vec3(0.5647, 0.6941, 0.8235);\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (u_reflection == 1)\n\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t//vec3 reflectDir = reflect(eyeDir, myNormal);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t//vec3 envColor = vec3(textureCube(u_cubeMap, -reflectDir));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// 如果要实现反射真实场景，需要把场景渲染5遍构建一个无底的立方体纹理。\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// 目前使用一张反射纹理近似模拟。\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvec2 final = projectionCoord.xy / projectionCoord.w;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfinal = final * 0.5 + 0.5;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfinal.y = 1.0 - final.y;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tenvColor = texture2D(u_reflectMap, final + myNormal.xy/texScale2*transp).rgb;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t// very ugly version of fresnel effect\n\t\t\t\t\t\t\t\t\t\t\t\t\t// but it gives a nice transparent water, but not too transparent\n\t\t\t\t\t\t\t\t\t\t\t\t\tmyangle = dot(myNormal,normalize(eyeDir));\n\t\t\t\t\t\t\t\t\t\t\t\t\tmyangle = 0.95-0.6*myangle*myangle;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// blend in the color of the plane below the water\n\t\t\t\t\t\t\t\t\t\t\t\t\t// add in a little distortion of the colormap for the effect of a refracted\n\t\t\t\t\t\t\t\t\t\t\t\t\t// view of the image below the surface.\n\t\t\t\t\t\t\t\t\t\t\t\t\t// (this isn't really tested, just a last minute addition\n\t\t\t\t\t\t\t\t\t\t\t\t\t// and perhaps should be coded differently\n\t\t\t\t\t\t\t\t\t\t\t\t\t// the correct way, would be to use the refract routine, use the alpha channel for depth of\n\t\t\t\t\t\t\t\t\t\t\t\t\t// the water (and make the water disappear when depth = 0), add some watercolor to the colormap\n\t\t\t\t\t\t\t\t\t\t\t\t\t// depending on the depth, and use the calculated refractdir and the depth to find the right\n\t\t\t\t\t\t\t\t\t\t\t\t\t// pixel in the colormap.... who knows, something for the next version\n\t\t\t\t\t\t\t\t\t\t\t\t\tvec3 base = u_refractColor.rgb;//vec3(0.3, 0.4, 0.5);\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (u_useRefractTex == 1)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tbase = texture2D(u_refractMap,(texCoord + myNormal.xy/texScale2*0.03*transp)*32.0).rgb;\n\t\t\t\t\t\t\t\t\t\t\t\t\tbase = mix(base, u_waterColor.rgb, u_waterColor.a);\n\t\t\t\t\t\t\t\t\t\t\t\t\t// 光照计算\n\t\t\t\t\t\t\t\t\t\t\t\t\tvec3 lightDir = czm_sunDirectionEC;//normalize(vec3(0.0, 0.0, 1.0)); // 光照方向需要从外面传入\n\t\t\t\t\t\t\t\t\t\t\t\t\tvec3 reflectVec = reflect(-lightDir, myNormal);\n\t\t\t\t\t\t\t\t\t\t\t\t\tfloat diffuse = max(0.0, dot(myNormal, lightDir));\n\t\t\t\t\t\t\t\t\t\t\t\t\tfloat spec = max(dot(reflectVec, normalize(-eyeDir)), 0.0);\n\t\t\t\t\t\t\t\t\t\t\t\t\tspec = pow(spec, 128.0);\n\t\t\t\t\t\t\t\t\t\t\t\t\t//float lightIntensity = 0.7 * diffuse + 0.3 * spec;\n\t\t\t\t\t\t\t\t\t\t\t\t\tfloat lightIntensity = 0.3 * spec;\n\t\t\t\t\t\t\t\t\t\t\t\t\tgl_FragColor = vec4(mix(base, envColor, myangle*transp), 1.0);\n\t\t\t\t\t\t\t\t\t\t\t\t\tgl_FragColor += vec4(0.8)*lightIntensity;\n\t\t\t\t\t\t\t\t\t\t\t\t\t// note that smaller waves appear to move slower than bigger waves\n\t\t\t\t\t\t\t\t\t\t\t\t\t// one could use the tiles and give each tile a different speed if that\n\t\t\t\t\t\t\t\t\t\t\t\t\t// is what you want\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t"}),v=e.RenderState.fromCache({depthTest:{enabled:!0}}),C=this;this._uniformMap={u_bgColor:function(){return C._waterColor},u_texCoordOffset:function(){return new e.Cartesian2(-C._lonMin,-C._latMin)},u_texCoordScale:function(){return new e.Cartesian2(C._fScale,C._fScale)},u_scale:function(){return new e.Cartesian3(3,3,3)},u_camPos:function(){return new e.Cartesian3(3,3,3)},u_modelViewProjectionMatrix:function(){return C.modeiViewProjection},u_modelViewMatrix:function(){return C.modelViewMatrix},u_clampToGroud:function(){return 0},u_invWorldViewMatrix:function(){return C.invWorldViewMatrix},u_frameTime:function(){return C._frameTime},u_normalMap:function(){return C._normalTexture},u_refractMap:function(){return C._normalTexture},u_useRefractTex:function(){return 0},u_reflectMap:function(){return C._reflectPassState.framebuffer.getColorTexture(0)},u_reflection:function(){return 1},u_waterColor:function(){return C._waterColor},u_refractColor:function(){return C._refractColor},u_reflectColor:function(){return C._reflectColor},u_flowDir:function(){return new e.Cartesian2(.5*Math.sin(C._flowAngle)+.5,.5*Math.cos(C._flowAngle)+.5)}},this._waterGeometry=e.PolygonGeometry.createGeometry(this._waterPolygon);for(var y=this._waterGeometry.indices,A=this._waterGeometry.attributes.position.values,I=0;I<A.length;I++)I%3==0&&(A[I]=A[I]-o.x),I%3==1&&(A[I]=A[I]-o.y),I%3==2&&(A[I]=A[I]-o.z);for(var b=[],w=0;w<this._pointsToCartographic.length;w++)b.push(this._pointsToCartographic[w].x,this._pointsToCartographic[w].y);var E=new Float64Array(b),G=e.Buffer.createIndexBuffer({context:r,typedArray:new Uint32Array(y),usage:e.BufferUsage.STATIC_DRAW,indexDatatype:e.IndexDatatype.UNSIGNED_INT}),S=e.Buffer.createVertexBuffer({context:r,typedArray:e.ComponentDatatype.createTypedArray(e.ComponentDatatype.FLOAT,A),usage:e.BufferUsage.STATIC_DRAW}),P=e.Buffer.createVertexBuffer({context:r,typedArray:e.ComponentDatatype.createTypedArray(e.ComponentDatatype.FLOAT,E),usage:e.BufferUsage.STATIC_DRAW}),T=[];T.push({index:0,vertexBuffer:S,componentDatatype:e.ComponentDatatype.FLOAT,componentsPerAttribute:3,normalize:!1}),T.push({index:1,vertexBuffer:P,componentDatatype:e.ComponentDatatype.FLOAT,componentsPerAttribute:2,normalize:!1});var x=new e.VertexArray({context:r,attributes:T,indexBuffer:G});this._drawCommand=new e.DrawCommand({boundingVolume:this._waterGeometry.boundingSphere,primitiveType:e.PrimitiveType.TRIANGLES,vertexArray:x,shaderProgram:_,castShadows:!1,receiveShadows:!1,uniformMap:this._uniformMap,renderState:v,pass:e.Pass.OPAQUE}),this._drawCommand.water="water"}null!==this._normalTexture&&1==this._isVisible&&t.commandList.push(this._drawCommand)}}},i.prototype._updateReflectTexture=function(t){if(this._initialized){this.modelViewMatrix=e.Matrix4.multiply(t.camera.viewMatrix,this.modelMatrix,this.modelViewMatrix),this.modeiViewProjection=e.Matrix4.multiply(t.camera.workingFrustums[0].projectionMatrix,this.modelViewMatrix,this.modeiViewProjection);var i=new e.Cartesian3(this._waterCenterPos.x,this._waterCenterPos.y,this._waterCenterPos.z),r=new e.Cartesian3(i.x,i.y,i.z);e.Cartesian3.normalize(r,r);var o=e.Plane.fromPointNormal(i,r),n=new e.Cartesian3(r.x,r.y,r.z),a=-e.Cartesian3.dot(r,i),s=new e.Matrix4(-2*n.x*n.x+1,-2*n.x*n.y,-2*n.x*n.z,-2*n.x*a,-2*n.y*n.x,-2*n.y*n.y+1,-2*n.y*n.z,-2*n.y*a,-2*n.z*n.x,-2*n.z*n.y,-2*n.z*n.z+1,-2*n.z*a,0,0,0,1),l=new e.Cartesian3;e.Cartesian3.clone(t.camera.direction,l);var u=new e.Cartesian3,h=new e.Cartesian3;e.Cartesian3.multiplyByScalar(n,2*e.Cartesian3.dot(l,n),h),e.Cartesian3.subtract(l,h,u),e.Cartesian3.normalize(u,u);var c=new e.Cartesian3;e.Cartesian3.clone(t.camera.up,c);var p=new e.Cartesian3,d=new e.Cartesian3,f=e.Cartesian3.dot(c,n);e.Cartesian3.multiplyByScalar(n,2*f,d),e.Cartesian3.add(c,d,p),e.Cartesian3.normalize(p,p);var g=new e.Cartesian3(-p.x,-p.y,-p.z),m=new e.Cartesian3,_=(e.Cartesian3.clone(t.camera.position,m),new e.Cartesian3(s[0]*m.x+s[4]*m.y+s[8]*m.z+s[12],s[1]*m.x+s[5]*m.y+s[9]*m.z+s[13],s[2]*m.x+s[6]*m.y+s[10]*m.z+s[14])),v=new e.Matrix4;t.camera.frustum.far=1e8,e.Matrix4.clone(t.camera.frustum.projectionMatrix,v),this._reflectCamera.direction=u,f<.5&&(this._reflectCamera.up=g),.5<=f&&(this._reflectCamera.up=p),this._reflectCamera.position=_;var C=new e.Matrix4;e.Matrix4.inverse(this._reflectCamera.viewMatrix,C),e.Matrix4.transpose(C,C);var y=new e.Cartesian4(o.normal.x,o.normal.y,o.normal.z,-e.Cartesian3.dot(r,i));e.Matrix4.multiplyByVector(C,y,y);var A=y.w/Math.sqrt(y.x*y.x+y.y*y.y+y.z*y.z),I=new e.Cartesian3(y.x,y.y,y.z);e.Cartesian3.normalize(I,I);var b=new e.Cartesian3(I.x,I.y,I.z),w=new e.Cartesian4;w.x=(Math.asin(b.x)+v[8])/v[0],w.y=(Math.asin(b.y)+v[9])/v[5],w.z=-1,w.w=(1+v[10])/v[14];var E=new e.Cartesian4(b.x,b.y,b.z,A),G=new e.Cartesian4;e.Cartesian4.multiplyByScalar(E,2/e.Cartesian4.dot(E,w),G),v[2]=G.x,v[6]=G.y,v[10]=G.z+1,v[14]=G.w,e.Matrix4.clone(v,this._reflectCamera.frustum.projectionMatrix);var S=this._scene.frameState,P=this._scene.context,T=P.uniformState;new e.ClearCommand({color:e.Color.fromBytes(14,33,60,255),depth:1,framebuffer:this._reflectPassState.framebuffer}).execute(P,this._reflectPassState);var x=this._reflectCamera;T.updateCamera(x);for(var M=x.frustum.computeCullingVolume(x.positionWC,x.directionWC,x.upWC),L=S.commandList,N=0;N<L.length;N++){var R=L[N];R instanceof e.ComputeCommand||"water"!=R.water&&R.pass!==e.Pass.GLOBE&&t.isVisible(R,M)&&(T.updatePass(R.pass),R.execute(P,this._reflectPassState))}T.updateCamera(t.camera),T.updateFrustum(t.camera.workingFrustums[0])}},i.prototype.release=function(){this._initialized=!1,this._waterPolygon=void 0,this._drawCommand=void 0},i.prototype.destroy=function(){this._scene.primitives.remove(this),e.destroyObject(this)}}(window.Cesium),function(e){var t=e.defaultValue;function i(i){i=t(i,t.EMPTY_OBJECT),this.proxy=i.proxy,this.viewer=i.viewer,this.url=i.url,this.metadata=i.metadata,this.roadMetadata=i.roadMetadata,this.roadUrl=i.roadUrl,this.labelGraphics=i.labelGraphics?i.labelGraphics:{},this.billboardGraphics=i.billboardGraphics?i.billboardGraphics:{},this.aotuCollide=!!i.aotuCollide,this.collisionPadding=i.collisionPadding?i.collisionPadding:[3,5,3,5],this.serverFirstStyle=!!i.serverFirstStyle,this.subdomains=i.subdomains,e.isArray(this.subdomains)?this.subdomains=this.subdomains.slice():e.defined(this.subdomains)&&0<this.subdomains.length?this.subdomains=this.subdomains.split(""):this.subdomains=["a","b","c"],this.tileCache=[],this.labelCache=[],this._isInitial=!1,this._latelyGrid=[],this._latelyRefreshStamp=0,this._latelyCollisionStamp=0;var r=e.createGuid();this._UUID="GEO_WTFS_LABEL_"+r,this._UUIDRoad="GEO_WTFS_LABEL_ROAD_"+r,this.viewer.camera.percentageChanged=.18,this.bindEvent()}function r(e,t){return t.minX>=e.minX&&t.minX<=e.maxX&&t.minY>=e.minY&&t.minY<=e.maxY||t.maxX>=e.minX&&t.maxX<=e.maxX&&t.maxY>=e.minY&&t.maxY<=e.maxY||t.minX>=e.minX&&t.minX<=e.maxX&&t.maxY>=e.minY&&t.maxY<=e.maxY||t.maxX>=e.minX&&t.maxX<=e.maxX&&t.minY>=e.minY&&t.minY<=e.maxY}function o(e,t){var i=e.x,r=e.y,o=e.width,n=e.height,a=t.x,s=t.y,l=t.width,u=t.height;return!(a<=i&&a+l<=i||i<=a&&i+o<=a||s<=r&&s+u<=r||r<=s&&r+n<=s)}e.defined,e.defineProperties(i.prototype,{}),i.prototype.getCacheTile=function(e,t,i,r){for(var o=0;o<this.tileCache.length;o++)if(this.tileCache[o].x===e&&this.tileCache[o].y===t&&this.tileCache[o].z===i&&this.tileCache[o].t===r)return this.tileCache[o];return null},i.prototype.addCacheTile=function(e){999<this.tileCache.length&&this.tileCache.splice(0,500),this.removeCacheTile(e.x,e.y,e.z,e.t),this.tileCache.push(e)},i.prototype.removeCacheTile=function(e,t,i,r){for(var o=0;o<this.tileCache.length;o++)if(this.tileCache[o].x===e&&this.tileCache[o].y===t&&this.tileCache[o].z===i&&this.tileCache[o].t===r){this.tileCache.splice(o,1);break}},i.prototype.getCacheLabel=function(e){for(var t=0;t<this.labelCache.length;t++)if(this.labelCache[t].name===this._UUID&&this.labelCache[t].oid===e)return this.labelCache[t];return null},i.prototype.addCacheLabel=function(e){999<this.labelCache.length&&this.labelCache.splice(0,250),this.removeCacheLabel(e.oid),e.timestamp=(new Date).getTime(),this.labelCache.push(e)},i.prototype.removeCacheLabel=function(e){for(var t=0;t<this.labelCache.length;t++)if(this.labelCache[t].name===this._UUID&&this.labelCache[t].oid===e){this.labelCache.splice(t,1);break}},i.prototype.getTileUrl=function(){return(this.proxy?this.proxy.proxy:"")+this.url+"/GetTiles?lxys={z},{x},{y}"},i.prototype.getIcoUrl=function(){return(this.proxy?this.proxy.proxy:"")+this.url+"/GetIcon?id={id}"},i.prototype.getRoadTileUrl=function(){return(this.proxy?this.proxy.proxy:"")+this.roadUrl},i.prototype._moveEnd=function(){var e=this;clearTimeout(this._timer);var t=this.viewer.scene.globe._surface;if(t._tilesToRender.length<2||0<t._tileLoadQueueHigh.length)this._timer=setTimeout((function(){e._moveEnd()}),100);else{var i=this.getTilesToRender();if(this.compareArray(i,this._latelyGrid))return;this._queueCall(i),e.delaySynchronous()}},i.prototype._changed=function(){var e=(new Date).getTime(),t=e-this._latelyRefreshStamp,i=e-this._latelyCollisionStamp;300<t&&this._moveEnd(),150<i&&this.collisionDetection()},i.prototype._queueCall=function(e){var t=this;t._latelyGrid=e,t._latelyRefreshStamp=(new Date).getTime(),e.forEach((function(e,i,o){if(t.metadata&&r(t.metadata.boundBox,e.boundBox)){if(t.metadata.minLevel>e.level+1||t.metadata.maxLevel<e.level+1)return;var n=t.getCacheTile(e.x,e.y,e.level+1,0);if(n)t.addLabelAndIco(n);else{var s=t.getTileUrl().replace("{z}",e.level+1).replace("{y}",e.y).replace("{x}",e.x).replace("{s}",t.subdomains[(e.x+e.y+e.level)%t.subdomains.length]),l=new XMLHttpRequest;l.open("GET",s,!0),l.responseType="arraybuffer",l.onload=function(){if(!(l.status<200||300<=l.status)){var e=t.CutString(l.response);if(e)(i=a(e)).x=this.tile.x,i.y=this.tile.y,i.z=this.tile.z,i.t=0,t.addCacheTile(i),t.addLabelAndIco(i);else{var i={x:this.tile.x,y:this.tile.y,z:this.tile.z,t:0};t.addCacheTile(i),t.delaySynchronous()}}},l.onerror=function(e){console.error(e)},l.send(),l.tile={x:e.x,y:e.y,z:e.level+1}}}if(t.roadMetadata&&r(t.roadMetadata.boundBox,e.boundBox)){if(t.roadMetadata.minLevel>e.level+1||t.roadMetadata.maxLevel<e.level+1)return;if(n=t.getCacheTile(e.x,e.y,e.level+1,1))t.addLabelAndIco(n);else{var u=t.getRoadTileUrl().replace("{z}",e.level+1).replace("{y}",e.y).replace("{x}",e.x),h=new XMLHttpRequest;h.open("GET",u,!0),h.responseType="json",h.onload=function(){if(!(h.status<200||300<=h.status)){var e=h.response;if(e){var i={pois:e.map((function(e,t,i){return{oid:e.LabelPoint.X+"_"+e.LabelPoint.Y,name:e.Feature.properties.Name,coordinate:[e.LabelPoint.X,e.LabelPoint.Y,e.LabelPoint.Z?e.LabelPoint.Z:0]}})),x:this.tile.x,y:this.tile.y,z:this.tile.z,t:1};t.addCacheTile(i),t.addLabelAndIco(i)}else i={x:this.tile.x,y:this.tile.y,z:this.tile.z,t:1},t.addCacheTile(i),t.delaySynchronous()}},h.onerror=function(e){console.error(e)},h.send(),h.tile={x:e.x,y:e.y,z:e.level+1}}}}))},i.prototype.initTDT=function(e){var t=0,i=this;i._isInitial=!0,i._queueCall(e);var r=setInterval((function(){3<t&&(i._isInitial=!1,clearInterval(r)),t%2==0&&i.aotuCollide&&i.collisionDetection(),t++}),600);return i},i.prototype.getTilesToRender=function(){for(var t=this.viewer.scene.globe._surface._tilesToRender.map((function(t,i,r){return{x:t.x,y:t.y,level:t.level,boundBox:{minX:e.Math.toDegrees(t.rectangle.west),minY:e.Math.toDegrees(t.rectangle.south),maxX:e.Math.toDegrees(t.rectangle.east),maxY:e.Math.toDegrees(t.rectangle.north)}}})).sort((function(e,t){return t.level-e.level})),i=[t[0].level],r=0;r<t.length;r++)t[r].level!=i[i.length-1]&&i.push(t[r].level),4<i.length&&(t.splice(r),r--);return t},i.prototype.addLabelAndIco=function(e){if(e.pois)for(var t=0;t<e.pois.length;t++){var i=this.getCacheLabel(e.pois[t].oid);i=i||this.createLabel(e.pois[t],e),this.addCacheLabel(i)}this.delaySynchronous()},i.prototype.delaySynchronous=function(){var e=this;clearTimeout(e._timer2),e._timer2=setTimeout((function(){e.synchronousLabel()}),100)},i.prototype.synchronousLabel=function(){for(var e=0;e<this.labelCache.length;e++)this.labelCache[e].timestamp>=this._latelyRefreshStamp&&!this.viewer.entities.contains(this.labelCache[e])&&(this._isInitial&&this.aotuCollide&&(this.labelCache[e].show=!1),this.viewer.entities.add(this.labelCache[e]));if(!this._isInitial){for(e=0;e<this.viewer.entities.values.length;e++)!this.viewer.entities.values[e].name||this.viewer.entities.values[e].name!==this._UUID&&this.viewer.entities.values[e].name!==this._UUIDRoad||this.viewer.entities.values[e].timestamp<this._latelyRefreshStamp&&(this.viewer.entities.remove(this.viewer.entities.values[e]),e--);this.aotuCollide&&this.collisionDetection()}},i.prototype.createLabel=function(t,i){if(t){var r,o,n={show:!0,position:e.Cartesian3.fromDegrees(t.coordinate[0],t.coordinate[1],t.coordinate[2]),label:{text:t.name}};this.serverFirstStyle&&void 0!==t.fontSize?(n.label.font=t.fontSize+"px ",void 0!==t.fontNameIndex&&i.stringTable&&i.stringTable[t.fontNameIndex]?n.label.font+=i.stringTable[t.fontNameIndex]:n.label.font+="sans-serif",!this.labelGraphics.bold&&1!==t.fontStyle&&3!==t.fontStyle||(r=!0),2!==t.fontStyle&&3!==t.fontStyle||(o=!0),r&&(n.label.font="bold "+n.label.font),o&&(n.label.font="italic "+n.label.font)):this.labelGraphics.font&&(n.label.font=this.labelGraphics.font),this.serverFirstStyle&&void 0!==t.fontColor?n.label.fillColor=e.Color.fromCssColorString(this.HexadecimalConversion(t.fontColor)):this.labelGraphics.fillColor&&(n.label.fillColor=this.labelGraphics.fillColor),this.serverFirstStyle&&void 0!==t.shiningColor?n.label.outlineColor=e.Color.fromCssColorString(this.HexadecimalConversion(t.shiningColor)):this.labelGraphics.outlineColor&&(n.label.outlineColor=this.labelGraphics.outlineColor),this.serverFirstStyle&&"number"==typeof t.shiningSize?n.label.outlineWidth=t.shiningSize:void 0!==this.labelGraphics.outlineWidth&&(n.label.outlineWidth=this.labelGraphics.outlineWidth),this.serverFirstStyle&&void 0!==t.showBackground?n.label.showBackground=t.showBackground:void 0!==this.labelGraphics.showBackground&&(n.label.showBackground=this.labelGraphics.showBackground),this.serverFirstStyle&&void 0!==t.backgroundColor?n.label.backgroundColor=t.backgroundColor:void 0!==this.labelGraphics.backgroundColor&&(n.label.backgroundColor=this.labelGraphics.backgroundColor),this.serverFirstStyle&&void 0!==t.backgroundPadding?n.label.backgroundPadding=t.backgroundPadding:void 0!==this.labelGraphics.backgroundPadding&&(n.label.backgroundPadding=this.labelGraphics.backgroundPadding),i.t?(n.label.verticalOrigin=e.VerticalOrigin.CENTER,n.label.horizontalOrigin=e.HorizontalOrigin.CENTER):(this.serverFirstStyle&&void 0!==t.verticalOrigin?n.label.verticalOrigin=t.verticalOrigin:void 0!==this.labelGraphics.verticalOrigin&&(n.label.verticalOrigin=this.labelGraphics.verticalOrigin),this.serverFirstStyle&&void 0!==t.horizontalOrigin?n.label.horizontalOrigin=t.horizontalOrigin:void 0!==this.labelGraphics.horizontalOrigin&&(n.label.horizontalOrigin=this.labelGraphics.horizontalOrigin)),this.serverFirstStyle&&void 0!==t.eyeOffset?n.label.eyeOffset=t.eyeOffset:void 0!==this.labelGraphics.eyeOffset&&(n.label.eyeOffset=this.labelGraphics.eyeOffset),this.serverFirstStyle&&void 0!==t.pixelOffset?n.label.pixelOffset=t.pixelOffset:void 0!==this.labelGraphics.pixelOffset&&(n.label.pixelOffset=this.labelGraphics.pixelOffset),this.serverFirstStyle&&void 0!==t.style?n.label.style=t.style:void 0!==this.labelGraphics.style&&(n.label.style=this.labelGraphics.style),this.serverFirstStyle&&void 0!==t.scale?n.label.scale=t.scale:void 0!==this.labelGraphics.scale&&(n.label.scale=this.labelGraphics.scale),n.label.disableDepthTestDistance=this.labelGraphics.disableDepthTestDistance,void 0!==t.symbolID&&-1<t.symbolID&&(n.billboard={image:this.getIcoUrl().replace("{id}",t.symbolID).replace("{s}",this.subdomains[(i.x+i.y+i.z)%this.subdomains.length])},this.serverFirstStyle&&void 0!==t.displayHeight?(n.billboard.width=t.displayHeight,n.billboard.height=t.displayHeight):void 0===this.billboardGraphics.width&&void 0===this.billboardGraphics.height||(n.billboard.width=this.billboardGraphics.width,n.billboard.height=this.billboardGraphics.height),i.t?(n.label.verticalOrigin=e.VerticalOrigin.BOTTOM,n.label.horizontalOrigin=e.HorizontalOrigin.CENTER):(this.serverFirstStyle&&void 0!==t.verticalOrigin?n.billboard.verticalOrigin=t.verticalOrigin:void 0!==this.billboardGraphics.verticalOrigin&&(n.billboard.verticalOrigin=this.billboardGraphics.verticalOrigin),this.serverFirstStyle&&void 0!==t.horizontalOrigin?n.billboard.horizontalOrigin=t.horizontalOrigin:void 0!==this.billboardGraphics.horizontalOrigin&&(n.billboard.horizontalOrigin=this.billboardGraphics.horizontalOrigin)),this.serverFirstStyle&&void 0!==t.eyeOffset?n.billboard.eyeOffset=t.eyeOffset:void 0!==this.billboardGraphics.eyeOffset&&(n.billboard.eyeOffset=this.billboardGraphics.eyeOffset),this.serverFirstStyle&&void 0!==t.pixelOffset?n.billboard.pixelOffset=t.pixelOffset:void 0!==this.billboardGraphics.pixelOffset&&(n.billboard.pixelOffset=this.billboardGraphics.pixelOffset),this.serverFirstStyle&&void 0!==t.rotation?n.billboard.rotation=t.rotation:void 0!==this.billboardGraphics.rotation&&(n.billboard.rotation=this.billboardGraphics.rotation),this.serverFirstStyle&&void 0!==t.alignedAxis?n.billboard.alignedAxis=t.alignedAxis:void 0!==this.billboardGraphics.alignedAxis&&(n.billboard.alignedAxis=this.billboardGraphics.alignedAxis),this.serverFirstStyle&&void 0!==t.color?n.billboard.color=t.color:void 0!==this.billboardGraphics.color&&(n.billboard.color=this.billboardGraphics.color),this.serverFirstStyle&&void 0!==t.scale?n.billboard.scale=t.scale:void 0!==this.billboardGraphics.scale&&(n.billboard.scale=this.billboardGraphics.scale),n.billboard.disableDepthTestDistance=this.billboardGraphics.disableDepthTestDistance);var a=new e.Entity(n);return a.name=i.t?this._UUIDRoad:this._UUID,a.oid=t.oid,a.priority=t.priority?t.priority:0,a.xyz=i.x+"_"+i.y+"_"+(i.z-1),a}},i.prototype.getPropertyValue=function(e,t,i,r){return void 0!==t[e]?t[e]:void 0!==i[e]?i[e]:r},i.prototype.collisionDetection=function(){if(this.debug)for(var t=document.getElementsByClassName("debug"),i=0;i<t.length;i++)this.viewer.container.removeChild(t[i]),i--;var r=[],n=this.viewer.entities.values;for(i=0;i<n.length;i++)if(n[i].name&&(n[i].name===this._UUID||n[i].name===this._UUIDRoad)){var a,s;a=e.SceneTransforms.wgs84ToDrawingBufferCoordinates(this.viewer.scene,n[i].position.getValue(0)),n[i].show=!0,s=this.getLabelReact({point:a,entity:n[i]}),n[i].collisionBox=s;for(var l=null,u=0;u<r.length;u++)if(r[u].xyz===n[i].xyz){l=r[u];break}if(l||(l={xyz:n[i].xyz,entities:[]},r.push(l)),l.entities.push(n[i]),this.debug){var h=document.createElement("div");h.setAttribute("class","debug"),h.style.cssText="position:absolute; top:"+s.y+"px; left:"+s.x+"px; width:"+s.width+"px; height:"+s.height+"px; border: solid 1px red; color: rgba(0,0,0,0);",h.innerHTML=n[i].label.text.getValue(0),this.viewer.container.appendChild(h)}}for(var c=0;c<r.length;c++)for(r[c].entities.sort((function(e,t){return e.priority-t.priority})),i=0;i<r[c].entities.length;i++)if(r[c].entities[i].show)for(u=i+1;u<r[c].entities.length;u++)r[c].entities[u].show&&o(r[c].entities[i].collisionBox,r[c].entities[u].collisionBox)&&(r[c].entities[u].show=!1);var p=[];for(c=0;c<r.length;c++)for(i=0;i<r[c].entities.length;i++)r[c].entities[i].show&&p.push(r[c].entities[i]);for(i=0;i<p.length;i++)if(p[i].show)for(p.sort((function(e,t){return e.priority-t.priority})),u=i+1;u<p.length;u++)p[u].show&&o(p[i].collisionBox,p[u].collisionBox)&&(p[u].show=!1)},i.prototype.bindEvent=function(){this.viewer.scene.camera.moveEnd.addEventListener(this._moveEnd,this),this.viewer.scene.camera.changed.addEventListener(this._changed,this)},i.prototype.unbindEvent=function(){this.viewer.scene.camera.moveEnd.removeEventListener(this._moveEnd,this),this.viewer.scene.camera.changed.removeEventListener(this._changed,this)},i.prototype.activate=function(){this._latelyGrid=[],this._moveEnd()},i.prototype.destroy=function(){for(var e=0;e<this.viewer.entities.values.length;e++)!this.viewer.entities.values[e].name||this.viewer.entities.values[e].name!==this._UUID&&this.viewer.entities.values[e].name!==this._UUIDRoad||(this.viewer.entities.remove(this.viewer.entities.values[e]),e--);this.viewer.camera.percentageChanged=.5,this.unbindEvent(),this.handler=this.handler&&this.handler.destroy(),this.proxy=void 0,this.viewer=void 0,this.url=void 0,this.labelGraphics=void 0,this.billboardGraphics=void 0,this.aotuCollide=void 0,this.collisionPadding=void 0,this.tileCache=void 0,this.labelCache=void 0,this._latelyGrid=void 0,this._latelyRefreshStamp=void 0,this._roadTileset=void 0},i.prototype.compareArray=function(e,t){for(var i=!1,r=0;r<e.length;r++){for(var o=!1,n=0;n<t.length;n++)if(e[r].x===t[n].x&&e[r].y===t[n].y&&e[r].level===t[n].level){o=!0;break}if(!o){i=!0;break}}return!i},i.prototype.getLabelReact=function(e){var t=g()(e.entity.label.font);t=0<t?t:15;for(var i=e.entity.label.text.getValue(0).split("\n"),r=0,o=i.length,a=0;a<i.length;a++){var s=n(i[a])/2;r<s&&(r=s)}var l=e.entity.billboard?e.entity.billboard.width.getValue(0)*e.entity.billboard.scale.getValue(0):1,u=e.entity.billboard?e.entity.billboard.height.getValue(0)*e.entity.billboard.scale.getValue(0):1;return{x:(e.point?e.point.x:-999)-l/2-this.collisionPadding[3],y:(e.point?e.point.y:-999)-u/2-this.collisionPadding[0],width:t*e.entity.label.scale.getValue(0)*r+e.entity.label.pixelOffset.getValue(0).x+l+this.collisionPadding[1],height:t*e.entity.label.scale.getValue(0)*(o+.5*(o-1))+e.entity.label.pixelOffset.getValue(0).y+u/2+this.collisionPadding[2]}},i.prototype.CutString=function(e){if(!e)return"";var t=e.byteLength;return t<=28?"":e.slice(19,t-9)},i.prototype.HexadecimalConversion=function(e){if(4278190080===e)return"#000000";var t=4278190080|g()(-Number(e));if(e="",(t=t.toString(16).substring(1)).length<6)for(var i=6-t.length,r=0;r<i;r++)e+="0";return"#"+e+t},i.prototype.getLabelVisibility=function(e){if(!e)return!1;var t=this.viewer.canvas.getBoundingClientRect();return!(e.x<-10||e.x>t.right+10||e.y<-10||e.y>t.bottom+10)};var n=function(e){for(var t=0,i=0;i<e.length;i++)null!=e.charAt(i).match(/[^\x00-\xff]/gi)?t+=2:t+=1;return t},a=function(e){var t={stringTable:[],pois:[],enumGeometryType:[{ePoint:0},{eMultiLineString:1},{ePolygon:2}],enumZCoordType:[{eCloseGround:0},{eCloseSeaSurface:1},{eRelativelyGround:2},{eAbsolute:3}]},i=function(){if("undefined"==typeof dcodeIO||!dcodeIO.ProtoBuf)throw new Error("ProtoBuf.js is not present. Please see www/index.html for manual setup instructions.");return dcodeIO.ProtoBuf.loadProto("option optimize_for = LITE_RUNTIME;package GEOPOI;enum enumGeometryType {ePoint = 0;eMultiLineString = 1;ePolygon = 2;} ;message PBPOI{required uint64 OID = 1;required string Name =2;repeated double Coordinates =3 [packed=true];required enumGeometryType GeometryType = 4;optional int32 Interate = 5;optional int32 SymbolID = 10  [default = 0];optional double DisplayHeight = 11 [default = 32];optional uint32 ShiningColor=12 [default =0];optional uint32\tFontNameIndex=13 [default =0];optional int32\tFontSize=14 [default =18];optional uint32\tFontColor=15 [default =0];};message StringTable {repeated string s = 1;}message PBPOITile{required int64 Version = 1;required int64 TileKey = 2;required StringTable StringTable = 3;repeated PBPOI POIS = 4;};","GEOPOI","GeoPOI.proto").build("GEOPOI").PBPOITile}(),r=function(){if("undefined"==typeof dcodeIO||!dcodeIO.ProtoBuf)throw new Error("ProtoBuf.js is not present. Please see www/index.html for manual setup instructions.");return dcodeIO.ProtoBuf.loadProto("option optimize_for = LITE_RUNTIME;package GEOPOI;enum enumGeometryType {ePoint = 0;eMultiLineString = 1;ePolygon = 2;};enum enumZCoordType {eCloseGround = 0;eCloseSeaSurface = 1;eRelativelyGround = 2;eAbsolute = 3;};message PBPOI{required uint64 OID = 1;required string Name =2;repeated double Coordinates =3 [packed=true];required enumGeometryType GeometryType = 4;optional int32 Interate = 5;optional int32 SymbolID = 10  [default = 0];optional double DisplayHeight = 11 [default = 32];optional uint32 ShiningColor=12 [default =0];optional uint32\tFontNameIndex=13 [default =0];optional int32\tFontSize=14 [default =18];optional uint32\tFontColor=15 [default =0];optional enumZCoordType ZCoordType = 16 [default = eAbsolute];};message StringTable {repeated string s = 1;}message PBPOITile{required int64 Version = 1;required int64 TileKey = 2;required StringTable StringTable = 3;repeated PBPOI POIS = 4;};","GEOPOI","GeoPOI2.proto").build("GEOPOI").PBPOITile}(),o=function(){if("undefined"==typeof dcodeIO||!dcodeIO.ProtoBuf)throw new Error("ProtoBuf.js is not present. Please see www/index.html for manual setup instructions.");return dcodeIO.ProtoBuf.loadProto("option optimize_for = LITE_RUNTIME;package GEOPOI;enum enumGeometryType {ePoint = 0;eMultiLineString = 1;ePolygon = 2;};enum enumZCoordType {eCloseGround = 0;eCloseSeaSurface = 1;eRelativelyGround = 2;eAbsolute = 3;};message PBPOI{required uint64 OID = 1;required string Name =2;repeated double Coordinates =3 [packed=true];required enumGeometryType GeometryType = 4;optional int32 Priority = 5;repeated int32 Interates =6 [packed=true];optional int32 SymbolID = 10  [default = 0];optional double DisplayHeight = 11 [default = 32];optional uint32 ShiningColor=12 [default =0];optional uint32\tFontNameIndex=13 [default =0];optional int32\tFontSize=14 [default =18];optional uint32\tFontColor=15 [default =0];optional enumZCoordType ZCoordType = 16 [default = eAbsolute];optional int32 FontStyle=17;optional int32 ShiningSize=18;};message StringTable {repeated string s = 1;}message PBPOITile{required int64 Version = 1;required int64 TileKey = 2;required StringTable StringTable = 3;repeated PBPOI POIS = 4;};","GEOPOI","GeoPOI3.proto").build("GEOPOI").PBPOITile}();t.pois.length=0;var n,a=e;try{n=o.decode(a)}catch(e){console.log(e.message)}if(!n)try{n=r.decode(a)}catch(e){console.log(e.message),n=i.decode(a)}t.version=g()(n.Version.toString()),t.titleKey=g()(n.TileKey.toString()),t.stringTable=[];for(var s=n.StringTable.s.length,l=0;l<s;l++)t.stringTable.push(n.StringTable.s[l].toString());return n.POIS.forEach((function(e){var i={};i.oid=g()(e.OID.toString())+"_"+t.titleKey,i.name=e.Name.toString(),i.symbolID=g()(e.SymbolID.toString()),i.displayHeight=e.DisplayHeight,i.shiningColor=e.ShiningColor,i.fontNameIndex=e.FontNameIndex,i.fontSize=e.FontSize,i.fontColor=e.FontColor,e.ZCoordType&&(i.zCoordType=e.ZCoordType),i.geometryType=e.GeometryType,i.coordinate=e.Coordinates,i.priority=void 0===e.Priority?null:e.Priority,i.interates=void 0===e.Interates?null:e.Interates,i.fontStyle=void 0===e.FontStyle?null:e.FontStyle,i.shiningSize=void 0===e.ShiningSize?null:e.ShiningSize,t.pois.push(i)})),t};e.GeoWTFS=i}(window.Cesium),function(e){var t=e.LayerManager=function(t){this.map=t,this.serviceLayerGroup=new e.ServiceLayerGroup(t),this.modelLayerGroup=new e.ModelLayerGroup(t),this.vectorLayerGroup=new e.VectorLayerGroup(t),this.terrainLayerGroup=new e.TerrainLayerGroup(t),this.basicLayerGroup=new e.BasicLayerGroup(t)};t.prototype.getMap=function(){return this.map},t.prototype.getServiceLayerGroup=function(){return this.serviceLayerGroup},t.prototype.getModelLayerGroup=function(){return this.modelLayerGroup},t.prototype.getVectorLayerGroup=function(){return this.vectorLayerGroup},t.prototype.getTerrainLayerGroup=function(){return this.terrainLayerGroup},t.prototype.getBasicLayerGroup=function(){return this.basicLayerGroup},t.prototype.remove=function(t){e.defined(t)?t.removeAll():(this.serviceLayerGroup.removeAll(),this.modelLayerGroup.removeAll(),this.vectorLayerGroup.removeAll(),this.terrainLayerGroup.removeAll(),this.basicLayerGroup.removeAll())}}(window.Cesium),function(e){var t=e.ServiceLayerGroup=function(){};t.prototype=new e.CompositeEntityCollection,t.prototype.addLayer=function(i,r){var o="";return t.add(r)&&(r.name=i,o=e.createGuid(),r.id=o),o},t.prototype.removeLayer=function(e){var i=t.getLayer(e);return t.remove(i)},t.prototype.queryLayerByName=function(e){for(var i=null,r=0;r<t.length;r++){var o=t.get(r);if(e==o.name){i=o;break}}return i},t.prototype.getLayer=function(e){for(var i=null,r=0;r<t.length;r++){var o=t.get(r);if(e==o.id){i=o;break}}return i},t.prototype.showLayer=function(e){t.getLayer(e).show=!0},t.prototype.hideLayer=function(e){t.getLayer(e).show=!1},t.prototype.addChildLayerGroup=function(e){}}(window.Cesium),function(e){var t=e.ModelLayerGroup=function(e){this.map=e};t.prototype=new e.PrimitiveCollection,t.prototype.addLayer=function(e,t){var i=this.map.scene.primitives.add(t),r="";return i&&(t.name=e,null!=$("#model-branch-container .layer-item-title").last()[0]&&(r=$("#model-branch-container .layer-item-title").last()[0].id),t.id=r),i},t.prototype.removeLayer=function(e){for(var t=0;t<this.map.scene.primitives.length;t++){var i=this.map.scene.primitives.get(t);if(e==i.id)break}return this.map.scene.primitives.remove(i)},t.prototype.queryLayerByName=function(e){for(var i=null,r=0;r<t.length;r++){var o=t.get(r);if(e==o.name){i=o;break}}return i},t.prototype.getLayer=function(e){var t=null;if(e)for(var i=1;i<this.map.scene.primitives.length;i++){var r=this.map.scene.primitives.get(i);if(e==r.id){t=r;break}}else t=this.map.scene.primitives._primitives;return t},t.prototype.showLayer=function(e){for(var t=null,i=0;i<this.map.scene.primitives.length;i++){var r=this.map.scene.primitives.get(i);if(e==r.id){t=r;break}}t&&(t.show=!0)},t.prototype.hideLayer=function(e){for(var t=null,i=0;i<this.map.scene.primitives.length;i++){var r=this.map.scene.primitives.get(i);if(e==r.id){t=r;break}}t&&(t.show=!1)}}(window.Cesium),function(e){var t=e.VectorLayerGroup=function(e){this.map=e};t.prototype=new e.DataSourceCollection,t.prototype.addLayer=function(t,i){return i&&(i.id||(i.id=e.createGuid())),this.map.dataSources.add(i),this.map.dataSources.get(this.map.dataSources.length-1).name=t,i.id},t.prototype.removeLayer=function(e){for(var t=null,i=0;i<this.map.dataSources.length;i++)if(e==this.map.dataSources.get(i).id){t=this.map.dataSources.get(i);break}try{this.map.dataSources.remove(t)}catch(e){return void console.log("DeveloperError")}},t.prototype.queryLayerByName=function(e){for(var t=null,i=0;i<this.map.dataSources.length;i++){var r=this.map.dataSources.get(i);if(e==r._name){t=r;break}}return t},t.prototype.getLayer=function(e){for(var t=null,i=0;i<this.map.dataSources.length;i++){var r=this.map.dataSources.get(i);if(e==r.id){t=r;break}}return t},t.prototype.showLayer=function(e){for(var t=null,i=0;i<this.map.dataSources.length;i++){var r=this.map.dataSources.get(i);if(e==r.id){t=r;break}}t&&(t.show=!0)},t.prototype.hideLayer=function(e){for(var t=null,i=0;i<this.map.dataSources.length;i++){var r=this.map.dataSources.get(i);if(e==r.id){t=r;break}}t&&(t.show=!1)}}(window.Cesium),function(e){var t=e.TerrainLayerCollection=function(e){this._layers=[],this.length=this._layers.length,this.map=e};t.prototype.addTerrainProvider=function(t){if(!defined(t))throw new e.DeveloperError("terrainProvider is required.");return this.map.terrainProvider=t,this._layers=[],this._layers.push(t),this.map.terrainProvider},t.prototype.remove=function(){var t=new e.CesiumTerrainProvider({url:""});return this.map.terrainProvider=t,this._layers=[],0==this.map.terrainProvider._url_size},t.prototype.get=function(t){if(!defined(terrainProvider))throw new e.DeveloperError("id is required.");if(t==this._layers[0].id)return this._layers[0]}}(window.Cesium),function(e){var t=e.TerrainLayerGroup=function(e){this.map=e};t.prototype.addLayer=function(t,i){if(i._credit)i.id=i._credit._text;else{var r=e.createGuid();i.id=r}return i.name=t,(this.map.terrainProvider=i).id},t.prototype.removeLayer=function(t){if(t==this.map.terrainProvider.id){var i=new e.GeoTerrainProvider({proxy:new e.DefaultProxy("/proxyHandler?url="),dataType:e.GeoTerrainProvider.FLOAT,urls:[""]});this.map.terrainProvider=i}return!this.map.terrainProvider.id},t.prototype.getLayer=function(t){var i=null;return e.defined(t)?t==this.map.terrainProvider.id&&(i=this.map.terrainProvider):i=this.map.terrainProvider,i},t.prototype.showLayer=function(t){if(t==this.map.terrainProvider.options.credit){var i=new e.GeoTerrainProvider({proxy:new e.DefaultProxy("/proxyHandler?url="),dataType:e.GeoTerrainProvider.FLOAT,urls:this.map.terrainProvider.options._urls,credit:this.map.terrainProvider.options.credit,name:this.map.terrainProvider.options.name,maxExtent:this.map.terrainProvider.options.maxExtent,opacity:this.map.terrainProvider.options.opacity,topLevel:this.map.terrainProvider.options.topLevel,bottomLevel:this.map.terrainProvider.options.bottomLevel});i.id=t,i.name=this.map.terrainProvider.options.name,this.map.terrainProvider=i}},t.prototype.hideLayer=function(t){var i=null;if(t==this.map.terrainProvider.id){var r={_urls:(i=this.map.terrainProvider)._urls,credit:i._credit.text,name:i.name,maxExtent:i._maxExtent,opacity:i._opacity,topLevel:i._topLevel,bottomLevel:i._bottomLevel},o=new e.GeoTerrainProvider({proxy:new e.DefaultProxy("/proxyHandler?url="),dataType:e.GeoTerrainProvider.FLOAT,urls:[""]});this.map.terrainProvider=o,this.map.terrainProvider.options=r}}}(window.Cesium),function(e){var t=e.BasicLayerGroup=function(e){this.map=e};t.prototype=new e.ImageryLayerCollection,t.prototype.addLayer=function(e,t){var i=this.map.imageryLayers.addImageryProvider(t),r="";if(i){i.name=e;for(var o=0;o<$("#imagery-branch-container .layer-item-content div").length;o++)if(e==$("#imagery-branch-container .layer-item-content span")[o].innerText){r=$($("#imagery-branch-container .layer-item-content div")[o]).attr("id");break}i.id=r}return r},t.prototype.removeLayer=function(e){for(var t=null,i=0;i<this.map.imageryLayers.length;i++)if(e==this.map.imageryLayers._layers[i].id){t=this.map.imageryLayers._layers[i];break}try{this.map.imageryLayers.remove(t)}catch(e){return void console.log("DeveloperError")}},t.prototype.queryLayerByName=function(t){if(!e.defined(t))return!1;for(var i=null,r=0;r<this.map.imageryLayers.length;r++)if(t==this.map.imageryLayers._layers[r].name){i=this.map.imageryLayers._layers[r];break}return i},t.prototype.getLayer=function(e){var t=null;if(e){for(var i=0;i<this.map.imageryLayers.length;i++)if(e==this.map.imageryLayers._layers[i].id){t=this.map.imageryLayers._layers[i];break}}else t=this.map.imageryLayers._layers;return t},t.prototype.showLayer=function(e){for(var t=null,i=0;i<this.map.imageryLayers.length;i++)if(e==this.map.imageryLayers._layers[i].id){t=this.map.imageryLayers._layers[i];break}t.show=!0},t.prototype.hideLayer=function(e){for(var t=null,i=0;i<this.map.imageryLayers.length;i++)if(e==this.map.imageryLayers._layers[i].id){t=this.map.imageryLayers._layers[i];break}t.show=!1},t.prototype.moveLayer=function(e,t){for(var i=null,r=null,o=0;o<this.map.imageryLayers.length;o++)if(e==this.map.imageryLayers._layers[o].id){i=this.map.imageryLayers._layers[o];break}for(o=0;o<this.map.imageryLayers.length;o++)if(t==this.map.imageryLayers._layers[o].id){r=this.map.imageryLayers._layers[o];break}var n=this.map.imageryLayers.indexOf(i)-this.map.imageryLayers.indexOf(r);if(0<n)for(o=0;o<n;o++)try{this.map.imageryLayers.raise(i)}catch(e){return void console.log(e)}else console.log("layer located top")},t.prototype.raiseLayer=function(e){for(var t=null,i=0;i<this.map.imageryLayers.length;i++)if(e==this.map.imageryLayers._layers[i].id){t=this.map.imageryLayers._layers[i];break}try{this.map.imageryLayers.raise(t)}catch(e){return void console.log("DeveloperError")}},t.prototype.lowerLayer=function(e){for(var t=null,i=0;i<this.map.imageryLayers.length;i++)if(e==this.map.imageryLayers._layers[i].id){t=this.map.imageryLayers._layers[i];break}try{this.map.imageryLayers.lower(t)}catch(e){return void console.log("DeveloperError")}}}(window.Cesium),function(e){var t=e.Measure=function(e){this.viewer=e.viewer,this.primitives=this.viewer.scene.primitives};t.prototype.distance=function(t,i){if(t.polyline){var r=t.polyline.positions.getValue();if(!(r.length<=1)){for(var o,n=0,a=0,s=new e.EllipsoidGeodesic,l=1;l<r.length;l++){var u=e.Cartographic.fromCartesian(r[l-1]),h=e.Cartographic.fromCartesian(r[l]);s.setEndPoints(u,h),n+=Math.round(s.surfaceDistance);var c=e.Cartographic.fromCartesian(r[l-1]),p=e.Math.toDegrees(c.longitude),d=e.Math.toDegrees(c.latitude),f=e.Cartographic.fromCartesian(r[l]),g=e.Math.toDegrees(f.longitude),m=e.Math.toDegrees(f.latitude),_=turf.point([p,d]),v=turf.point([g,m]);a+=turf.distance(_,v)}return 2==i?o=n<1e3?n.toFixed(2)+"m":(n/1e3).toFixed(2)+"km":1==i&&(o=a<1?(1e3*a).toFixed(2)+"m":a.toFixed(2)+"km"),o}}},t.prototype.area=function(t){if(t.polygon){var i=t.polygon.hierarchy.getValue().positions;if(!(i.length<=2)){for(var r=[],o=0;o<i.length;o++){var n=e.Cartographic.fromCartesian(i[o]),a=e.Math.toDegrees(n.longitude),s=e.Math.toDegrees(n.latitude);r.push([a,s])}r.push(r[0]);var l=turf.polygon([r]),u=turf.area(l);return u<1e6?u.toFixed(2)+"m²":(u/1e6).toFixed(2)+"km²"}}},t.prototype.height=function(t){if(t.polyline){var i=t.polyline.positions.getValue();if(2==(i=[i[0],i[1]]).length){for(var r=[],o=0;o<i.length;o++){var n=e.Cartographic.fromCartesian(i[o]),a=e.Math.toDegrees(n.longitude),s=e.Math.toDegrees(n.latitude),l=n.height;r.push(a),r.push(s),r.push(l)}r[2]>=r[5]?(r.push(r[0]),r.push(r[1]),r.push(r[5])):(r.push(r[3]),r.push(r[4]),r.push(r[2]));var u={horizontalDistance:null,verticalHeight:null,spaceDistance:null},h=1e3*turf.distance(turf.point([r[0],r[1]]),turf.point([r[3],r[4]]));(p=[]).push((r[0]+r[3])/2),p.push((r[1]+r[4])/2),r[2]>=r[5]?p.push(r[5]):p.push(r[2]),u.horizontalDistance=h<1e3?"水平距离："+h.toFixed(2)+"m":"水平距离："+(h/1e3).toFixed(2)+"km";var c=Math.abs(r[2]-r[5]),p=[];r[2]>=r[5]?(p.push(r[0]),p.push(r[1])):(p.push(r[3]),p.push(r[4])),p.push((r[2]+r[5])/2),u.verticalHeight=c<1e3?"垂直高度："+c.toFixed(2)+"m":"垂直高度："+(c/1e3).toFixed(2)+"km";var d=Math.sqrt(Math.pow(h,2)+Math.pow(c,2));return(p=[]).push((r[0]+r[3])/2),p.push((r[1]+r[4])/2),p.push((r[2]+r[5])/2),u.spaceDistance=d<1e3?"空间距离："+d.toFixed(2)+"m":"空间距离："+(d/1e3).toFixed(2)+"km",u}}},t.prototype.elevation=function(t){if(t.point){var i=[t.position._value];1==i.length&&(e.Cartographic.fromCartesian(i[0]).height.toFixed(2),createResultLabel2(this.options,this.primitives,i))}}}(window.Cesium),R="function"==typeof w.a&&"symbol"==I()(C.a)?function(e){return I()(e)}:function(e){return e&&"function"==typeof w.a&&e.constructor===w.a&&e!==w.a.prototype?"symbol":I()(e)},function(e){var t=e.MVTProvider=function(t){t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT),this._viewer=t.viewer,this._tilingScheme=e.defined(t.tilingScheme)?t.tilingScheme:new e.WebMercatorTilingScheme({ellipsoid:t.ellipsoid}),this._tileWidth=e.defaultValue(t.tileWidth,512),this._tileHeight=e.defaultValue(t.tileHeight,512),this._readyPromise=e.when.resolve(!0),this._mvtParser=new ol.format.MVT,this._proxy=t.proxy,this._layer=t.layer,this._styleName=t.styleName,this._tileMatrixSetID=t.tileMatrixSetID,this._tileMatrixLabels=t.tileMatrixLabels,this._format="protobuf",this._minimumLevel=e.defaultValue(t.minimumLevel,0),this._maximumLevel=t.maximumLevel,this._sourceMaxzoom=e.defaultValue(t.sourceMaxzoom,22),this._spriteUrl=void 0,this.enablePickFeatures=e.defaultValue(t.enablePickFeatures,!0),this._pickedEvent=new e.Event,this._key=e.defaultValue(t.key,""),this._url=e.defaultValue(t.url,"https://a.tiles.mapbox.com/v4/mapbox.mapbox-streets-v6/{z}/{x}/{y}.vector.pbf?access_token={k}");var i=this._tilingScheme._rectangleSouthwestInMeters,r=(this._tilingScheme._rectangleNortheastInMeters,null);i||this._tilingScheme.rectangle,this._tilingScheme instanceof e.WebMercatorTilingScheme?r=[-20037508.342789244,-20037508.342789244,20037508.342789244,20037508.342789244]:this._tilingScheme instanceof e.GeographicTilingScheme&&(r=[-180,-270,180,90]),this._resolutions=ol.tilegrid.resolutionsFromExtent(r,22,this._tileWidth),this._pixelRatio=1,this._transform=[.125,0,0,.125,0,0],this._replays=["Default","Image","Polygon","LineString","Text"],this._tileQueue=new e.TileReplacementQueue,this._cacheSize=1e3,this._featuresCache={},this._styles=void 0,this.styleFunc=function(){return[]};var o=this,n=this.getStyleUrl();n=this._proxy.getURL(n),(Number(e.VERSION)<1.42?e.loadJson(n):e.Resource.fetchJson(n)).then((function(i){if(!i.sources){for(var r="mysourceid",n=0;n<i.layers.length;n++)i.layers[n].source=r;i.sources={},i.sources[r]={type:"vector",url:t.url}}(o._styles=i).sprite&&(o._spriteUrl=o._proxy.getURL(i.sprite)),i.glyphs&&o._proxy.getURL(i.glyphs),o._spriteUrl?(Number(e.VERSION)<1.42?e.loadJson(o._spriteUrl+".json"):e.Resource.fetchJson(o._spriteUrl+".json")).then((function(e){o.spriteData=e,o.styleFunc=GeOLMS.stylefunction(i,u()(i.sources),o._resolutions,e,o._spriteUrl+".png")})):(o.spriteData=void 0,o.styleFunc=GeOLMS.stylefunction(i,u()(i.sources),o._resolutions))}))};function i(t){t._viewer.scene.globe._surface.forEachLoadedTile((function(t){for(var i=t.data.imagery,r=0;r<i.length;r++){var o=i[r];(e.defined(o.loadingImagery)?o.loadingImagery:o.readyImagery).imageryLayer._imageryProvider instanceof e.MVTProvider&&(t.state=e.QuadtreeTileLoadState.LOADING,e.defined(o.loadingImagery)||(o.loadingImagery=o.readyImagery,o.loadingImagery.addReference()),o.loadingImagery.state=e.ImageryState.UNLOADED)}}))}function r(e,t,i){for(var r=!1,o=2;o<i.length;o+=2){var n=i[o-2],a=i[o-1],s=i[o],l=i[o+1];t<a!=t<l&&e<(s-n)*(t-a)/(l-a)+n&&(r=!r)}return r}function o(e,t,i,r){for(var o=0,n=0,s=0,l=2,u=i.length;l<u;l+=2){var h=i[l-2],c=i[l-1],p=i[l],d=i[l+1];if(a(e,t,h,c,p,d)&&(s=p-h,0==(n=c-d)&&0===s?o=(e-h)*(e-h)+(t-c)*(t-c):(o=n*e+s*t-(n*h+s*c),o*=o,o/=n*n+s*s),o<=r))return!0}return!1}function a(e,t,i,r,o,n){if(i===o&&r===n)return!0;var a=(e-i)*(e-i)+(t-r)*(t-r),s=(e-o)*(e-o)+(t-n)*(t-n),l=(o-i)*(o-i)+(n-r)*(n-r);return!(s+l<a||a+l<s)}e.defineProperties(t.prototype,{url:{get:function(){return this._url}},proxy:{get:function(){return this._proxy}},tileWidth:{get:function(){return this._tileWidth}},tileHeight:{get:function(){return this._tileHeight}},maximumLevel:{get:function(){return this._maximumLevel}},minimumLevel:{get:function(){return this._minimumLevel}},sourceMaxzoom:{get:function(){return this._sourceMaxzoom}},tilingScheme:{get:function(){return this._tilingScheme}},rectangle:{get:function(){return this._tilingScheme.rectangle}},tileDiscardPolicy:{get:function(){}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return!0}},readyPromise:{get:function(){return this._readyPromise}},credit:{get:function(){}},hasAlphaChannel:{get:function(){return!0}},styles:{get:function(){return this._styles}},pickedEvent:{get:function(){return this._pickedEvent}}}),t.prototype.getTileCredits=function(e,t,i){},t.prototype.requestImage=function(t,i,r,o){var a=this,s=this._tileMatrixLabels,l=e.defined(s)?g()(s[r]):r,u=e.when.defer(),h=n()([t,i,l]),c=this._featuresCache[h];if(e.defined(c)){var p=this.renderCanvas(c,t,i,l);return u.resolve(p),p}for(var d=[],f=t,m=i,_=l;_>a._sourceMaxzoom;){f=f/2|0,m=m/2|0,_-=1;var v=n()([f,m,_]),C=a._featuresCache[v];if(e.defined(C)){var y=e.defined(C.rect)?C.rect:[0,0,4096,4096],A=l-_,I=t-(f<<A),b=i-(m<<A),w=1+I,E=1+b,G=(y[2]-y[0])/(1<<A),S=[y[0]+I*G,y[1]+b*G,y[0]+w*G,y[1]+E*G];d.rect=S;for(var P=0;P<C.length;P++){var T=C[P];if(e.defined(S)){var x=T.getExtent();if(Math.max(S[0],x[0])>Math.min(S[2],x[2]))continue;if(Math.max(S[1],x[1])>Math.min(S[3],x[3]))continue}d.push(T)}break}}if(0<d.length){var M=n()([t,i,l]);return a._featuresCache[M]=d,p=a.renderCanvas(d,t,i,l),u.resolve(p),p}var L=this.getUrlTmpl();return L=L.replace("{x}",f).replace("{y}",m).replace("{z}",_).replace("{k}",this._key),L=this._proxy.getURL(L),(Number(e.VERSION)<1.42?e.loadArrayBuffer(L):e.Resource.fetchArrayBuffer(L)).then((function(r){var o=a._mvtParser.readFeatures(r),s=e.defined(o.rect)?o.rect:[0,0,4096,4096],h=l-_,c=t-(f<<h),p=i-(m<<h),d=1+c,g=1+p,v=(s[2]-s[0])/(1<<h),C=[s[0]+c*v,s[1]+p*v,s[0]+d*v,s[1]+g*v],y=[];y.rect=C;for(var A=0;A<o.length;A++){var I=o[A];if(e.defined(C)){var b=I.getExtent();if(Math.max(C[0],b[0])>Math.min(C[2],b[2]))continue;if(Math.max(C[1],b[1])>Math.min(C[3],b[3]))continue}y.push(I)}var w=n()([t,i,l]);a._featuresCache[w]=y;var E=a.renderCanvas(y,t,i,l);return u.resolve(E),E})).otherwise((function(e){console.error(e)})),u.promise},t.prototype.renderCanvas=function(t,i,r,o){var n=document.createElement("canvas");n.width=512,n.height=512;for(var a=n.getContext("2d"),s=this.styleFunc,l=e.defined(t.rect)?t.rect:[0,0,4096,4096],u=new ol.render.canvas.ReplayGroup(0,l,8,!0,100),h=0;h<t.length;h++)for(var c=t[h],p=s(t[h],o)||[],d=0;d<p.length;d++)ol.renderer.vector.renderFeature_(u,c,p[d],16);u.finish();var f=[this._tileWidth/(l[2]-l[0]),0,0,this._tileHeight/(l[3]-l[1]),-512*l[0]/(l[2]-l[0]),-512*l[1]/(l[3]-l[1])];return u.replay(a,this._pixelRatio,f,0,{},this._replays,!0),u=null,n},t.prototype.setPaintProperty=function(e,t,r){for(var o=this._styles,n=0;n<o.layers.length;n++)if(o.layers[n].id===e){o.layers[n].paint[t]=r;break}this.styleFunc=GeOLMS.stylefunction(o,u()(o.sources),this._resolutions,this.spriteData,this._spriteUrl?this._spriteUrl+".png":this._spriteUrl),i(this)},t.prototype.setLayoutProperty=function(e,t,r){for(var o=this._styles,n=0;n<o.layers.length;n++)if(o.layers[n].id===e){o.layers[n].layout[t]=r;break}this.styleFunc=GeOLMS.stylefunction(o,u()(o.sources),this._resolutions,this.spriteData,this._spriteUrl?this._spriteUrl+".png":this._spriteUrl),i(this)},t.prototype.setStyle=function(t){var r=this;if("string"==typeof t){var o=this._proxy.getURL(t);(Number(e.VERSION)<1.42?e.loadJson(o):e.Resource.fetchJson(o)).then((function(o){if(!o.sources){for(var n="mysourceid",a=0;a<o.layers.length;a++)o.layers[a].source=n;o.sources={};var s=t.split("?");o.sources[n]={type:"vector",url:s[0]}}(r._styles=o).sprite&&(r._spriteUrl=r._proxy.getURL(o.sprite)),o.glyphs&&r._proxy.getURL(o.glyphs),r._spriteUrl?(Number(e.VERSION)<1.42?e.loadJson(spriteUrl+".json"):e.Resource.fetchJson(spriteUrl+".json")).then((function(e){r.spriteData=e,r.styleFunc=GeOLMS.stylefunction(o,u()(o.sources),r._resolutions,e,r._spriteUrl+".png"),i(r)})):(r.spriteData=void 0,r.styleFunc=GeOLMS.stylefunction(o,u()(o.sources),r._resolutions),i(r))}))}else{if(8!=(this._styles=t).version)return void console.error("style version 8 required.");if(!t.sources)return void console.error("sources does not exist");t.sprite&&(this._spriteUrl=this._proxy.getURL(t.sprite)),this._proxy.getURL(t.glyphs),this._spriteUrl?(Number(e.VERSION)<1.42?e.loadJson(spriteUrl+".json"):e.Resource.fetchJson(spriteUrl+".json")).then((function(e){r.spriteData=e,r.styleFunc=GeOLMS.stylefunction(t,u()(t.sources),r._resolutions,e,r._spriteUrl+".png"),i(r)})):(r.spriteData=void 0,r.styleFunc=GeOLMS.stylefunction(t,u()(t.sources),r._resolutions),i(r))}},t.prototype.pickFeatures=function(t,i,a,s,l){if(this.enablePickFeatures){var u=null,h=this._tileMatrixLabels,c=e.defined(h)?g()(h[a]):a,p=null,d=null;if(this._tilingScheme instanceof e.WebMercatorTilingScheme){u=[-20037508.342789244,-20037508.342789244,20037508.342789244,20037508.342789244];var f=this._tilingScheme.projection.project(new e.Cartographic(s,l,0));p=f.x,d=f.y}else this._tilingScheme instanceof e.GeographicTilingScheme&&(u=[-180,-270,180,90],p=e.Math.toDegrees(s),d=e.Math.toDegrees(l));var m=n()([t,i,c]),_=this._featuresCache[m],v=[],C=[];if(e.defined(_)){for(var y=e.defined(_.rect)?_.rect:[0,0,4096,4096],A=c-Math.log(4096/(y[2]-y[0]))/Math.log(2),I=(p-u[0])/(u[2]-u[0])*Math.pow(2,A),b=(u[3]-d)/(u[3]-u[1])*Math.pow(2,A),w=4096*(I-Math.floor(I)),E=4096*(b-Math.floor(b)),G=0;G<_.length;G++)for(var S=(R=_[G]).type_,P=R.ends_,T=0,x=0;x<P.length;T=P[x],x++)if("Polygon"===S||"MultiPolygon"===S){if(r(w,E,R.flatCoordinates_.slice(T,P[x]))){v.push(R);break}}else if("LineString"===S||"MultiLineString"===S){var M=4096;e.defined(_.rect)&&(M=_.rect[2]-_.rect[0]);var L=4*M/512;if(o(w,E,R.flatCoordinates_.slice(T,P[x]),L*L)){v.push(R);break}}v.reverse();for(var N=0;N<v.length;N++){var R=v[N],O=this.featureToGeoJSON(R,Math.floor(I),Math.floor(b),A),D={type:"Feature",id:R.id_,properties:R.properties_,geometry:O.geometry,sourceLayer:R.properties_.layer};C.push(D)}}this._pickedEvent.raiseEvent(C)}},t.prototype.featureToGeoJSON=function(t,i,r,o){for(var n=this,a=4096*Math.pow(2,o),s=4096*i,l=4096*r,u=t.type_,h=t.ends_,c=0,p=[],d=0;d<h.length;c=h[d],d++){for(var f=t.flatCoordinates_.slice(c,h[d]),g=[],m=0;m<f.length;m+=2)g.push({x:f[m],y:f[m+1]});p.push(g)}function _(t){for(var i=0;i<t.length;i++)if(n._tilingScheme instanceof e.GeographicTilingScheme){var r=t[i];t[i]=[360*(r.x+s)/a-180,90-360*(r.y+l)/a]}else{var o=180-360*((r=t[i]).y+l)/a;t[i]=[360*(r.x+s)/a-180,360/Math.PI*Math.atan(Math.exp(o*Math.PI/180))-90]}}if("Polygon"===u||"MultiPolygon"===u){for(var v=[],C=0;C<p.length;C++){var y=[];y.push(p[C]),v.push(y)}for(p=v,d=0;d<p.length;d++)for(m=0;m<p[d].length;m++)_(p[d][m]);1<p.length&&(u="MultiPolygon")}else if("LineString"===u||"MultiLineString"===u)for(d=0;d<p.length;d++)_(p[d]);return 1===p.length&&(p=p[0]),{type:"Feature",geometry:{type:u,coordinates:p},properties:t.properties_}},e.Imagery.prototype.releaseReference=function(){if(--this.referenceCount,0!==this.referenceCount)return this.referenceCount;var t=this.imageryLayer._imageryProvider;if(t instanceof e.MVTProvider){var i=this.level;t._tilingScheme instanceof e.GeographicTilingScheme&&(i+=1);var r=n()([this.x,this.y,i]);e.defined(t._featuresCache[r])&&delete t._featuresCache[r]}return this.imageryLayer.removeImageryFromCache(this),e.defined(this.parent)&&this.parent.releaseReference(),e.defined(this.image)&&e.defined(this.image.destroy)&&this.image.destroy(),e.defined(this.texture)&&this.texture.destroy(),e.defined(this.textureWebMercator)&&this.texture!==this.textureWebMercator&&this.textureWebMercator.destroy(),e.destroyObject(this),0},t.prototype.getUrlTmpl=function(){var t={LAYER:this._layer,TILEMATRIXSET:this._tileMatrixSetID,FORMAT:this._format,TILEMATRIX:"{z}",TILEROW:"{y}",TILECOL:"{x}"},i=this.getParameterString(e.combine({SERVICE:"WMTS",VERSION:"1.0.0",REQUEST:"GetTile"},t));return this._url+"?"+i},t.prototype.getStyleUrl=function(){var t={STYLENAME:this._styleName},i=this.getParameterString(e.combine({SERVICE:"WMTS",VERSION:"1.0.0",REQUEST:"GetStyle"},t));return this._url+"?"+i},t.prototype.getParameterString=function(e){var t=[];for(var i in e){var r=e[i];if(null!=r&&"function"!=typeof r){var o;if("object"==(void 0===r?"undefined":R(r))&&r.constructor==Array){for(var n,a=[],s=0,l=r.length;s<l;s++)n=r[s],a.push(null==n?"":n);o=a.join(",")}else o=r;t.push(i+"="+o)}}return t.join("&")}}(window.Cesium),function(){function e(e){throw e}var t=void 0,i=this;function r(e,r){var o,n=e.split("."),a=i;n[0]in a||!a.execScript||a.execScript("var "+n[0]);for(;n.length&&(o=n.shift());)n.length||r===t?a=a[o]?a[o]:a[o]={}:a[o]=r}var o="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;function n(t,i){this.index="number"==typeof i?i:0,this.i=0,this.buffer=t instanceof(o?Uint8Array:Array)?t:new(o?Uint8Array:Array)(32768),2*this.buffer.length<=this.index&&e(Error("invalid index")),this.buffer.length<=this.index&&this.f()}n.prototype.f=function(){var e,t=this.buffer,i=t.length,r=new(o?Uint8Array:Array)(i<<1);if(o)r.set(t);else for(e=0;e<i;++e)r[e]=t[e];return this.buffer=r},n.prototype.d=function(e,t,i){var r,o=this.buffer,n=this.index,a=this.i,s=o[n];if(i&&1<t&&(e=8<t?(p[255&e]<<24|p[e>>>8&255]<<16|p[e>>>16&255]<<8|p[e>>>24&255])>>32-t:p[e]>>8-t),t+a<8)s=s<<t|e,a+=t;else for(r=0;r<t;++r)s=s<<1|e>>t-r-1&1,8==++a&&(a=0,o[n++]=p[s],s=0,n===o.length&&(o=this.f()));o[n]=s,this.buffer=o,this.i=a,this.index=n},n.prototype.finish=function(){var e=this.buffer,t=this.index;return 0<this.i&&(e[t]<<=8-this.i,e[t]=p[e[t]],t++),o?e.subarray(0,t):(e.length=t,e)};var a,s=new(o?Uint8Array:Array)(256);for(a=0;a<256;++a){for(var l=c=a,h=7,c=c>>>1;c;c>>>=1)l<<=1,l|=1&c,--h;s[a]=(l<<h&255)>>>0}var p=s;function d(e){this.buffer=new(o?Uint16Array:Array)(2*e),this.length=0}function f(e){var t,i,r,n,a,s,l,u,h,c,p=e.length,d=0,f=Number.POSITIVE_INFINITY;for(u=0;u<p;++u)e[u]>d&&(d=e[u]),e[u]<f&&(f=e[u]);for(t=1<<d,i=new(o?Uint32Array:Array)(t),r=1,n=0,a=2;r<=d;){for(u=0;u<p;++u)if(e[u]===r){for(l=n,h=s=0;h<r;++h)s=s<<1|1&l,l>>=1;for(c=r<<16|u,h=s;h<t;h+=a)i[h]=c;++n}++r,n<<=1,a<<=1}return[i,d,f]}function g(e,t){this.h=_,this.w=0,this.input=o&&e instanceof Array?new Uint8Array(e):e,this.b=0,t&&(t.lazy&&(this.w=t.lazy),"number"==typeof t.compressionType&&(this.h=t.compressionType),t.outputBuffer&&(this.a=o&&t.outputBuffer instanceof Array?new Uint8Array(t.outputBuffer):t.outputBuffer),"number"==typeof t.outputIndex&&(this.b=t.outputIndex)),this.a||(this.a=new(o?Uint8Array:Array)(32768))}d.prototype.getParent=function(e){return 2*((e-2)/4|0)},d.prototype.push=function(e,t){var i,r,o,n=this.buffer;for(i=this.length,n[this.length++]=t,n[this.length++]=e;0<i&&(r=this.getParent(i),n[i]>n[r]);)o=n[i],n[i]=n[r],n[r]=o,o=n[i+1],n[i+1]=n[r+1],n[r+1]=o,i=r;return this.length},d.prototype.pop=function(){var e,t,i,r,o,n=this.buffer;for(t=n[0],e=n[1],this.length-=2,n[0]=n[this.length],n[1]=n[this.length+1],o=0;!((r=2*o+2)>=this.length)&&(r+2<this.length&&n[r+2]>n[r]&&(r+=2),n[r]>n[o]);)i=n[o],n[o]=n[r],n[r]=i,i=n[o+1],n[o+1]=n[r+1],n[r+1]=i,o=r;return{index:e,value:t,length:this.length}};var m,_=2,v={NONE:0,r:1,k:_,O:3},C=[];for(m=0;m<288;m++)switch(!0){case m<=143:C.push([m+48,8]);break;case m<=255:C.push([m-144+400,9]);break;case m<=279:C.push([m-256+0,7]);break;case m<=287:C.push([m-280+192,8]);break;default:e("invalid literal: "+m)}function y(e,t){this.length=e,this.H=t}g.prototype.j=function(){var i,r,a,s,l=this.input;switch(this.h){case 0:for(a=0,s=l.length;a<s;){var u,h,c,p=r=o?l.subarray(a,a+65535):l.slice(a,a+65535),d=(a+=r.length)===s,f=t,g=t,m=this.a,v=this.b;if(o){for(m=new Uint8Array(this.a.buffer);m.length<=v+p.length+5;)m=new Uint8Array(m.length<<1);m.set(this.a)}if(u=d?1:0,m[v++]=0|u,c=65536+~(h=p.length)&65535,m[v++]=255&h,m[v++]=h>>>8&255,m[v++]=255&c,m[v++]=c>>>8&255,o)m.set(p,v),v+=p.length,m=m.subarray(0,v);else{for(f=0,g=p.length;f<g;++f)m[v++]=p[f];m.length=v}this.b=v,this.a=m}break;case 1:var y=new n(o?new Uint8Array(this.a.buffer):this.a,this.b);y.d(1,1,!0),y.d(1,2,!0);var A,I,w,S=b(this,l);for(A=0,I=S.length;A<I;A++)if(w=S[A],n.prototype.d.apply(y,C[w]),256<w)y.d(S[++A],S[++A],!0),y.d(S[++A],5),y.d(S[++A],S[++A],!0);else if(256===w)break;this.a=y.finish(),this.b=this.a.length;break;case _:var P,T,x,M,L,N,R,O,D,F,U,B,k,V,W,j=new n(o?new Uint8Array(this.a.buffer):this.a,this.b),z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],H=Array(19);for(P=_,j.d(1,1,!0),j.d(P,2,!0),T=b(this,l),R=G(N=E(this.M,15)),D=G(O=E(this.L,7)),x=286;257<x&&0===N[x-1];x--);for(M=30;1<M&&0===O[M-1];M--);var q,X,Y,K,Q,Z,J=x,$=M,ee=new(o?Uint32Array:Array)(J+$),te=new(o?Uint32Array:Array)(316),ie=new(o?Uint8Array:Array)(19);for(q=X=0;q<J;q++)ee[X++]=N[q];for(q=0;q<$;q++)ee[X++]=O[q];if(!o)for(q=0,K=ie.length;q<K;++q)ie[q]=0;for(q=Q=0,K=ee.length;q<K;q+=X){for(X=1;q+X<K&&ee[q+X]===ee[q];++X);if(Y=X,0===ee[q])if(Y<3)for(;0<Y--;)ie[te[Q++]=0]++;else for(;0<Y;)Y-3<(Z=Y<138?Y:138)&&Z<Y&&(Z=Y-3),Z<=10?(te[Q++]=17,te[Q++]=Z-3,ie[17]++):(te[Q++]=18,te[Q++]=Z-11,ie[18]++),Y-=Z;else if(te[Q++]=ee[q],ie[ee[q]]++,--Y<3)for(;0<Y--;)te[Q++]=ee[q],ie[ee[q]]++;else for(;0<Y;)Y-3<(Z=Y<6?Y:6)&&Z<Y&&(Z=Y-3),te[Q++]=16,te[Q++]=Z-3,ie[16]++,Y-=Z}for(i=o?te.subarray(0,Q):te.slice(0,Q),F=E(ie,7),V=0;V<19;V++)H[V]=F[z[V]];for(L=19;4<L&&0===H[L-1];L--);for(U=G(F),j.d(x-257,5,!0),j.d(M-1,5,!0),j.d(L-4,4,!0),V=0;V<L;V++)j.d(H[V],3,!0);for(V=0,W=i.length;V<W;V++)if(B=i[V],j.d(U[B],F[B],!0),16<=B){switch(V++,B){case 16:k=2;break;case 17:k=3;break;case 18:k=7;break;default:e("invalid code: "+B)}j.d(i[V],k,!0)}var re,oe,ne,ae,se,le,ue,he,ce=[R,N],pe=[D,O];for(se=ce[0],le=ce[1],ue=pe[0],he=pe[1],re=0,oe=T.length;re<oe;++re)if(ne=T[re],j.d(se[ne],le[ne],!0),256<ne)j.d(T[++re],T[++re],!0),ae=T[++re],j.d(ue[ae],he[ae],!0),j.d(T[++re],T[++re],!0);else if(256===ne)break;this.a=j.finish(),this.b=this.a.length;break;default:e("invalid compression type")}return this.a};var A=function(){function t(t){switch(!0){case 3===t:return[257,t-3,0];case 4===t:return[258,t-4,0];case 5===t:return[259,t-5,0];case 6===t:return[260,t-6,0];case 7===t:return[261,t-7,0];case 8===t:return[262,t-8,0];case 9===t:return[263,t-9,0];case 10===t:return[264,t-10,0];case t<=12:return[265,t-11,1];case t<=14:return[266,t-13,1];case t<=16:return[267,t-15,1];case t<=18:return[268,t-17,1];case t<=22:return[269,t-19,2];case t<=26:return[270,t-23,2];case t<=30:return[271,t-27,2];case t<=34:return[272,t-31,2];case t<=42:return[273,t-35,3];case t<=50:return[274,t-43,3];case t<=58:return[275,t-51,3];case t<=66:return[276,t-59,3];case t<=82:return[277,t-67,4];case t<=98:return[278,t-83,4];case t<=114:return[279,t-99,4];case t<=130:return[280,t-115,4];case t<=162:return[281,t-131,5];case t<=194:return[282,t-163,5];case t<=226:return[283,t-195,5];case t<=257:return[284,t-227,5];case 258===t:return[285,t-258,0];default:e("invalid length: "+t)}}var i,r,o=[];for(i=3;i<=258;i++)r=t(i),o[i]=r[2]<<24|r[1]<<16|r[0];return o}(),I=o?new Uint32Array(A):A;function b(i,r){function n(t,i){var r,o,n,a,s=t.H,l=[],u=0;switch(r=I[t.length],l[u++]=65535&r,l[u++]=r>>16&255,l[u++]=r>>24,!0){case 1===s:o=[0,s-1,0];break;case 2===s:o=[1,s-2,0];break;case 3===s:o=[2,s-3,0];break;case 4===s:o=[3,s-4,0];break;case s<=6:o=[4,s-5,1];break;case s<=8:o=[5,s-7,1];break;case s<=12:o=[6,s-9,2];break;case s<=16:o=[7,s-13,2];break;case s<=24:o=[8,s-17,3];break;case s<=32:o=[9,s-25,3];break;case s<=48:o=[10,s-33,4];break;case s<=64:o=[11,s-49,4];break;case s<=96:o=[12,s-65,5];break;case s<=128:o=[13,s-97,5];break;case s<=192:o=[14,s-129,6];break;case s<=256:o=[15,s-193,6];break;case s<=384:o=[16,s-257,7];break;case s<=512:o=[17,s-385,7];break;case s<=768:o=[18,s-513,8];break;case s<=1024:o=[19,s-769,8];break;case s<=1536:o=[20,s-1025,9];break;case s<=2048:o=[21,s-1537,9];break;case s<=3072:o=[22,s-2049,10];break;case s<=4096:o=[23,s-3073,10];break;case s<=6144:o=[24,s-4097,11];break;case s<=8192:o=[25,s-6145,11];break;case s<=12288:o=[26,s-8193,12];break;case s<=16384:o=[27,s-12289,12];break;case s<=24576:o=[28,s-16385,13];break;case s<=32768:o=[29,s-24577,13];break;default:e("invalid distance")}for(r=o,l[u++]=r[0],l[u++]=r[1],l[u++]=r[2],n=0,a=l.length;n<a;++n)m[_++]=l[n];C[l[0]]++,y[l[3]]++,v=t.length+i-1,d=null}var a,s,l,u,h,c,p,d,f,g={},m=o?new Uint16Array(2*r.length):[],_=0,v=0,C=new(o?Uint32Array:Array)(286),y=new(o?Uint32Array:Array)(30),A=i.w;if(!o){for(l=0;l<=285;)C[l++]=0;for(l=0;l<=29;)y[l++]=0}for(C[256]=1,a=0,s=r.length;a<s;++a){for(l=h=0,u=3;l<u&&a+l!==s;++l)h=h<<8|r[a+l];if(g[h]===t&&(g[h]=[]),c=g[h],!(0<v--)){for(;0<c.length&&32768<a-c[0];)c.shift();if(s<=a+3){for(d&&n(d,-1),l=0,u=s-a;l<u;++l)f=r[a+l],m[_++]=f,++C[f];break}0<c.length?(p=w(r,a,c),d?d.length<p.length?(f=r[a-1],m[_++]=f,++C[f],n(p,0)):n(d,-1):p.length<A?d=p:n(p,0)):d?n(d,-1):(f=r[a],m[_++]=f,++C[f])}c.push(a)}return m[_++]=256,C[256]++,i.M=C,i.L=y,o?m.subarray(0,_):m}function w(e,t,i){var r,o,n,a,s,l,u=0,h=e.length;a=0,l=i.length;e:for(;a<l;a++){if(r=i[l-a-1],(n=3)<u){for(s=u;3<s;s--)if(e[r+s-1]!==e[t+s-1])continue e;n=u}for(;n<258&&t+n<h&&e[r+n]===e[t+n];)++n;if(u<n&&(o=r,u=n),258===n)break}return new y(u,t-o)}function E(e,t){var i,r,n,a,s,l=e.length,u=new d(572),h=new(o?Uint8Array:Array)(l);if(!o)for(a=0;a<l;a++)h[a]=0;for(a=0;a<l;++a)0<e[a]&&u.push(a,e[a]);if(i=Array(u.length/2),r=new(o?Uint32Array:Array)(u.length/2),1===i.length)return h[u.pop().index]=1,h;for(a=0,s=u.length/2;a<s;++a)i[a]=u.pop(),r[a]=i[a].value;for(n=function(e,t,i){function r(e){var i=f[e][g[e]];i===t?(r(e+1),r(e+1)):--p[i],++g[e]}var n,a,s,l,u,h=new(o?Uint16Array:Array)(i),c=new(o?Uint8Array:Array)(i),p=new(o?Uint8Array:Array)(t),d=Array(i),f=Array(i),g=Array(i),m=(1<<i)-t,_=1<<i-1;for(h[i-1]=t,a=0;a<i;++a)m<_?c[a]=0:(c[a]=1,m-=_),m<<=1,h[i-2-a]=(h[i-1-a]/2|0)+t;for(h[0]=c[0],d[0]=Array(h[0]),f[0]=Array(h[0]),a=1;a<i;++a)h[a]>2*h[a-1]+c[a]&&(h[a]=2*h[a-1]+c[a]),d[a]=Array(h[a]),f[a]=Array(h[a]);for(n=0;n<t;++n)p[n]=i;for(s=0;s<h[i-1];++s)d[i-1][s]=e[s],f[i-1][s]=s;for(n=0;n<i;++n)g[n]=0;for(1===c[i-1]&&(--p[0],++g[i-1]),a=i-2;0<=a;--a){for(l=n=0,u=g[a+1],s=0;s<h[a];s++)(l=d[a+1][u]+d[a+1][u+1])>e[n]?(d[a][s]=l,f[a][s]=t,u+=2):(d[a][s]=e[n],f[a][s]=n,++n);g[a]=0,1===c[a]&&r(a)}return p}(r,r.length,t),a=0,s=i.length;a<s;++a)h[i[a].index]=n[a];return h}function G(e){var t,i,r,n,a=new(o?Uint16Array:Array)(e.length),s=[],l=[],u=0;for(t=0,i=e.length;t<i;t++)s[e[t]]=1+(0|s[e[t]]);for(t=1,i=16;t<=i;t++)l[t]=u,u+=0|s[t],u<<=1;for(t=0,i=e.length;t<i;t++)for(u=l[e[t]],l[e[t]]+=1,r=a[t]=0,n=e[t];r<n;r++)a[t]=a[t]<<1|1&u,u>>>=1;return a}function S(t,i){switch(this.l=[],this.m=32768,this.e=this.g=this.c=this.q=0,this.input=o?new Uint8Array(t):t,this.s=!1,this.n=T,this.C=!1,(i||(i={},0))&&(i.index&&(this.c=i.index),i.bufferSize&&(this.m=i.bufferSize),i.bufferType&&(this.n=i.bufferType),i.resize&&(this.C=i.resize)),this.n){case P:this.b=32768,this.a=new(o?Uint8Array:Array)(32768+this.m+258);break;case T:this.b=0,this.a=new(o?Uint8Array:Array)(this.m),this.f=this.K,this.t=this.I,this.o=this.J;break;default:e(Error("invalid inflate mode"))}}var P=0,T=1,x=P,M=T;S.prototype.p=function(){for(;!this.s;){var i=Q(this,3);switch(1&i&&(this.s=!0),i>>>=1){case 0:var r=this.input,n=this.c,a=this.a,s=this.b,l=r.length,u=t,h=a.length,c=t;switch(this.e=this.g=0,l<=n+1&&e(Error("invalid uncompressed block header: LEN")),u=r[n++]|r[n++]<<8,l<=n+1&&e(Error("invalid uncompressed block header: NLEN")),u===~(r[n++]|r[n++]<<8)&&e(Error("invalid uncompressed block header: length verify")),n+u>r.length&&e(Error("input buffer is broken")),this.n){case P:for(;s+u>a.length;){if(u-=c=h-s,o)a.set(r.subarray(n,n+c),s),s+=c,n+=c;else for(;c--;)a[s++]=r[n++];this.b=s,a=this.f(),s=this.b}break;case T:for(;s+u>a.length;)a=this.f({v:2});break;default:e(Error("invalid inflate mode"))}if(o)a.set(r.subarray(n,n+u),s),s+=u,n+=u;else for(;u--;)a[s++]=r[n++];this.c=n,this.b=s,this.a=a;break;case 1:this.o(X,K);break;case 2:J(this);break;default:e(Error("unknown BTYPE: "+i))}}return this.t()};var L,N,R=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],O=o?new Uint16Array(R):R,D=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],F=o?new Uint16Array(D):D,U=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],B=o?new Uint8Array(U):U,k=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],V=o?new Uint16Array(k):k,W=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],j=o?new Uint8Array(W):W,z=new(o?Uint8Array:Array)(288);for(L=0,N=z.length;L<N;++L)z[L]=L<=143?8:L<=255?9:L<=279?7:8;var H,q,X=f(z),Y=new(o?Uint8Array:Array)(30);for(H=0,q=Y.length;H<q;++H)Y[H]=5;var K=f(Y);function Q(t,i){for(var r,o=t.g,n=t.e,a=t.input,s=t.c,l=a.length;n<i;)l<=s&&e(Error("input buffer is broken")),o|=a[s++]<<n,n+=8;return r=o&(1<<i)-1,t.g=o>>>i,t.e=n-i,t.c=s,r}function Z(e,t){for(var i,r,o=e.g,n=e.e,a=e.input,s=e.c,l=a.length,u=t[0],h=t[1];n<h&&!(l<=s);)o|=a[s++]<<n,n+=8;return r=(i=u[o&(1<<h)-1])>>>16,e.g=o>>r,e.e=n-r,e.c=s,65535&i}function J(e){function t(e,t,i){var r,o,n,a=this.z;for(n=0;n<e;)switch(r=Z(this,t)){case 16:for(o=3+Q(this,2);o--;)i[n++]=a;break;case 17:for(o=3+Q(this,3);o--;)i[n++]=0;a=0;break;case 18:for(o=11+Q(this,7);o--;)i[n++]=0;a=0;break;default:a=i[n++]=r}return this.z=a,i}var i,r,n,a,s=Q(e,5)+257,l=Q(e,5)+1,u=Q(e,4)+4,h=new(o?Uint8Array:Array)(O.length);for(a=0;a<u;++a)h[O[a]]=Q(e,3);if(!o)for(a=u,u=h.length;a<u;++a)h[O[a]]=0;i=f(h),r=new(o?Uint8Array:Array)(s),n=new(o?Uint8Array:Array)(l),e.z=0,e.o(f(t.call(e,s,i,r)),f(t.call(e,l,i,n)))}function $(e){if("string"==typeof e){var t,i,r=e.split("");for(t=0,i=r.length;t<i;t++)r[t]=(255&r[t].charCodeAt(0))>>>0;e=r}for(var o,n=1,a=0,s=e.length,l=0;0<s;){for(s-=o=1024<s?1024:s;a+=n+=e[l++],--o;);n%=65521,a%=65521}return(a<<16|n)>>>0}function ee(t,i){var r,o;switch(this.input=t,this.c=0,(i||(i={},0))&&(i.index&&(this.c=i.index),i.verify&&(this.N=i.verify)),r=t[this.c++],o=t[this.c++],15&r){case te:this.method=te;break;default:e(Error("unsupported compression method"))}0!=((r<<8)+o)%31&&e(Error("invalid fcheck flag:"+((r<<8)+o)%31)),32&o&&e(Error("fdict flag is not supported")),this.B=new S(t,{index:this.c,bufferSize:i.bufferSize,bufferType:i.bufferType,resize:i.resize})}S.prototype.o=function(e,t){var i=this.a,r=this.b;this.u=e;for(var o,n,a,s,l=i.length-258;256!==(o=Z(this,e));)if(o<256)l<=r&&(this.b=r,i=this.f(),r=this.b),i[r++]=o;else for(s=F[n=o-257],0<B[n]&&(s+=Q(this,B[n])),o=Z(this,t),a=V[o],0<j[o]&&(a+=Q(this,j[o])),l<=r&&(this.b=r,i=this.f(),r=this.b);s--;)i[r]=i[r++-a];for(;8<=this.e;)this.e-=8,this.c--;this.b=r},S.prototype.J=function(e,t){var i=this.a,r=this.b;this.u=e;for(var o,n,a,s,l=i.length;256!==(o=Z(this,e));)if(o<256)l<=r&&(l=(i=this.f()).length),i[r++]=o;else for(s=F[n=o-257],0<B[n]&&(s+=Q(this,B[n])),o=Z(this,t),a=V[o],0<j[o]&&(a+=Q(this,j[o])),l<r+s&&(l=(i=this.f()).length);s--;)i[r]=i[r++-a];for(;8<=this.e;)this.e-=8,this.c--;this.b=r},S.prototype.f=function(){var e,t,i=new(o?Uint8Array:Array)(this.b-32768),r=this.b-32768,n=this.a;if(o)i.set(n.subarray(32768,i.length));else for(e=0,t=i.length;e<t;++e)i[e]=n[e+32768];if(this.l.push(i),this.q+=i.length,o)n.set(n.subarray(r,32768+r));else for(e=0;e<32768;++e)n[e]=n[r+e];return this.b=32768,n},S.prototype.K=function(e){var t,i,r,n=this.input.length/this.c+1|0,a=this.input,s=this.a;return e&&("number"==typeof e.v&&(n=e.v),"number"==typeof e.G&&(n+=e.G)),i=n<2?(r=(a.length-this.c)/this.u[2]/2*258|0)<s.length?s.length+r:s.length<<1:s.length*n,o?(t=new Uint8Array(i)).set(s):t=s,this.a=t},S.prototype.t=function(){var e,t,i,r,n,a=0,s=this.a,l=this.l,u=new(o?Uint8Array:Array)(this.q+(this.b-32768));if(0===l.length)return o?this.a.subarray(32768,this.b):this.a.slice(32768,this.b);for(t=0,i=l.length;t<i;++t)for(r=0,n=(e=l[t]).length;r<n;++r)u[a++]=e[r];for(t=32768,i=this.b;t<i;++t)u[a++]=s[t];return this.l=[],this.buffer=u},S.prototype.I=function(){var e,t=this.b;return o?this.C?(e=new Uint8Array(t)).set(this.a.subarray(0,t)):e=this.a.subarray(0,t):(this.a.length>t&&(this.a.length=t),e=this.a),this.buffer=e},ee.prototype.p=function(){var t,i=this.input;return t=this.B.p(),this.c=this.B.c,this.N&&(i[this.c++]<<24|i[this.c++]<<16|i[this.c++]<<8|i[this.c++])>>>0!==$(t)&&e(Error("invalid adler-32 checksum")),t};var te=8;function ie(e,t){this.input=e,this.a=new(o?Uint8Array:Array)(32768),this.h=re.k;var i,r={};for(i in(t||(t={},0))&&"number"==typeof t.compressionType&&(this.h=t.compressionType),t)r[i]=t[i];r.outputBuffer=this.a,this.A=new g(this.input,r)}var re=v;function oe(e,t){var i,o,n,a;if(u.a)i=u()(t);else for(o in i=[],n=0,t)i[n++]=o;for(n=0,a=i.length;n<a;++n)r(e+"."+(o=i[n]),t[o])}ie.prototype.j=function(){var t,i,r,n,a,s,l,u=0;switch(l=this.a,t=te){case te:i=Math.LOG2E*Math.log(32768)-8;break;default:e(Error("invalid compression method"))}switch(r=i<<4|t,l[u++]=r,t){case te:switch(this.h){case re.NONE:a=0;break;case re.r:a=1;break;case re.k:a=2;break;default:e(Error("unsupported compression type"))}break;default:e(Error("invalid compression method"))}return n=a<<6|0,l[u++]=n|31-(256*r+n)%31,s=$(this.input),this.A.b=u,u=(l=this.A.j()).length,o&&((l=new Uint8Array(l.buffer)).length<=u+4&&(this.a=new Uint8Array(l.length+4),this.a.set(l),l=this.a),l=l.subarray(0,u+4)),l[u++]=s>>24&255,l[u++]=s>>16&255,l[u++]=s>>8&255,l[u++]=255&s,l},r("Zlib.Inflate",ee),r("Zlib.Inflate.prototype.decompress",ee.prototype.p),oe("Zlib.Inflate.BufferType",{ADAPTIVE:M,BLOCK:x}),r("Zlib.Deflate",ie),r("Zlib.Deflate.compress",(function(e,t){return new ie(e,t).j()})),r("Zlib.Deflate.prototype.compress",ie.prototype.j),oe("Zlib.Deflate.CompressionType",{NONE:re.NONE,FIXED:re.r,DYNAMIC:re.k})}.call(window);r(233)}])}));